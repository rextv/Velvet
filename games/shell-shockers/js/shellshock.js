(()=>{var Ml=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(f,c)=>(typeof require<"u"?require:f)[c]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var et={gameNotFound:0,gameFull:0,badName:0,mainMenu:0,gameIdleExceeded:0,corruptedLoginData0:0,corruptedLoginData1:0,corruptedLoginData2:0,corruptedLoginData3:0,corruptedLoginData4:0,corruptedLoginData5:0,gameMaxPlayersExceeded:0,gameDestroyUser:0,joinGameOutOfOrder:0,gameShuttingDown:0,readyBeforeReady:0,booted:0,gameErrorOnUserSocket:0,uuidNotFound:0,sessionNotFound:0,clusterFullCpu:0,clusterFullMem:0,noClustersAvailable:0},Oa=4e3;Object.keys(et).forEach(t=>{et[t]=Oa++});var he={gameJoined:0,socketReady:0,addPlayer:0,removePlayer:0,chat:0,syncThem:0,syncAmmo:0,die:0,hitThem:0,hitMe:0,collectItem:0,spawnItem:0,respawn:0,swapWeapon:0,joinGame:0,observeGame:0,ping:0,pong:0,clientReady:0,requestRespawn:0,joinPublicGame:0,joinPrivateGame:0,createPrivateGame:0,switchTeam:0,changeCharacter:0,pause:0,announcement:0,updateBalance:0,reload:0,refreshGameState:0,switchTeamFail:0,expireUpgrade:0,bootPlayer:0,banPlayer:0,loginRequired:0,gameLocked:0,reportPlayer:0,banned:0,metaGameState:0,syncMe:0,explode:0,keepAlive:0,musicInfo:0,hitMeHardBoiled:0,beginShellStreak:0,endShellStreak:0,startReload:0,fire:0,melee:0,throwGrenade:0,info:0,eventModifier:0,playerInfo:0},Oa=0;Object.keys(he).forEach(t=>{he[t]=Oa++});var Wa={blue:1,red:2},_i={ffa:0,teams:1,ctf:2,king:3},Xa=[{shortName:"FFA",longName:"Free For All",value:0},{shortName:"Teams",longName:"Teams",value:1},{shortName:"Spatula",longName:"Captula the Spatula",value:2},{shortName:"King",longName:"King of the Coop",value:3}],dt=[{name:"Eggk47"},{name:"Scrambler"},{name:"FreeRanger"},{name:"Cluck9mm"},{name:"Rpegg"},{name:"Whipper"},{name:"Crackshot"},{name:"TriHard"},{name:"Grenade"},{name:"Melee"}],Cl=10,Vt=Math.ceil(30/Cl),La={perKill:10,video:100,perKillModTwo:20,discord:"rew_1200",tiktok:"rew_1208",Instagram:"rew_1219",Steam:"rew_1223",Facebook:"rew_1227",Twitter:"rew_1234",Twitch:"rew_twitch_social"},Na={comment:0,feature:1,bug:2,purchase:3,account:4,abuse:5,other:6,deleteAccount:7};var je={HardBoiled:1,EggBreaker:2},gi={dailyLimit:3,cooldown:240,dailyCooldown:86400},nt={Primary:0,Secondary:1},se={Hat:1,Stamp:2,Primary:3,Secondary:4,Grenade:6,Melee:7},vt={Soldier:0,Scrambler:1,Ranger:2,Eggsploder:3,Whipper:4,Crackshot:5,TriHard:6};vt.length=Object.keys(vt).length;var ja=["kills","deaths","streak","killsCluck9mm","killsGrenade","killsRpegg","killsEggk47","killsScrambler","killsFreeRanger","killsWhipper","killsCrackshot","killsTriHard","killsMelee","killsPrivate","killsPublic","killsKing","killsSpatula","killsTeams","killsFFA","deathsCluck9mm","deathsGrenade","deathsRpegg","deathsEggk47","deathsScrambler","deathsFreeRanger","deathsWhipper","deathsCrackshot","deathsTriHard","deathsMelee","deathsPrivate","deathsPublic","deathsKing","deathsSpatula","deathsTeams","deathsFFA","kotcCaptured","kotcWins"];var us="0.46.6";var qt=class{constructor(f,c){this.size=0,this.originalSize=c,this.constructorFn=f,this.objects=[],this.idx=0,this.numActive=0,this.expand(c)}expand(f){for(var c=0;c<f;c++){var r=this.constructorFn();r.id=c+this.size,r.active=!1,this.objects.push(r)}this.size+=f}retrieve(f){if(f!=null){for(;f>=this.size;)this.expand(this.originalSize);return this.numActive++,this.objects[f].active=!0,this.objects[f]}var c=this.idx;do{c=(c+1)%this.size;var r=this.objects[c];if(!r.active)return this.idx=c,this.numActive++,r.active=!0,r}while(c!=this.idx);return this.expand(this.originalSize),console.log("Expanding pool for: "+this.objects[0].constructor.name+" to: "+this.size),this.retrieve()}recycle(f){f.active=!1,this.numActive--}forEachActive(f){for(var c=0;c<this.size;c++){var r=this.objects[c];r.active===!0&&f(r,c)}}};var Ka=class{constructor(f){this.idx=0,this.arrayBuffer=new ArrayBuffer(f),this.buffer=new Uint8Array(this.arrayBuffer,0,f)}send(f){var c=new Uint8Array(this.arrayBuffer,0,this.idx);f.send(c),Ce.bufferPool.recycle(this)}packInt8(f){this.buffer[this.idx]=f&255,this.idx++}packInt16(f){this.buffer[this.idx]=f&255,this.buffer[this.idx+1]=f>>8&255,this.idx+=2}packInt24(f){this.buffer[this.idx]=f&255,this.buffer[this.idx+1]=f>>8&255,this.buffer[this.idx+2]=f>>16&255,this.idx+=3}packInt32(f){this.buffer[this.idx]=f&255,this.buffer[this.idx+1]=f>>8&255,this.buffer[this.idx+2]=f>>16&255,this.buffer[this.idx+3]=f>>24&255,this.idx+=4}packRadU(f){this.packInt24(f*2097152)}packRad(f){this.packInt16((f+Math.PI)*8192)}packFloat(f){this.packInt16(f*256)}packDouble(f){this.packInt32(f*1048576)}packString(f){typeof f!="string"&&(f=""),this.packInt8(f.length);for(var c=0;c<f.length;c++)this.packInt16(f.charCodeAt(c))}packLongString(f){typeof f!="string"&&(f=""),this.packInt16(f.length);for(var c=0;c<f.length;c++)this.packInt16(f.charCodeAt(c))}},Ce=class{static buffer=null;static bufferPool=new qt(()=>new Ka(16384),2);static getBuffer(){var f=this.bufferPool.retrieve();return f.idx=0,f}},Z=class{static buffer;static idx;static init(f){this.buffer=new Uint8Array(f),this.idx=0}static isMoreDataAvailable(){return Math.max(0,this.buffer.length-this.idx)}static peekInt8U(){return this.buffer[this.idx]}static unPackInt8U(){var f=this.idx;return this.idx++,this.buffer[f]}static unPackInt8(){var f=this.unPackInt8U();return(f+128)%256-128}static unPackInt16U(){var f=this.idx;return this.idx+=2,this.buffer[f]+this.buffer[f+1]*256}static unPackInt24U(){var f=this.idx;return this.idx+=3,this.buffer[f]+this.buffer[f+1]*256+this.buffer[f+2]*65536}static unPackInt32U(){var f=this.idx;return this.idx+=4,this.buffer[f]+this.buffer[f+1]*256+this.buffer[f+2]*65536+this.buffer[f+3]*16777216}static unPackInt16(){var f=this.unPackInt16U();return(f+32768)%65536-32768}static unPackInt32(){var f=this.unPackInt32U();return(f+2147483648)%4294967296-2147483648}static unPackRadU(){return this.unPackInt24U()/2097152}static unPackRad(){var f=this.unPackInt16U()/8192;return f-Math.PI}static unPackFloat(){return this.unPackInt16()/256}static unPackDouble(){return this.unPackInt32()/1048576}static unPackString(f){f=f||255;var c=Math.min(this.unPackInt8U(),f);return this.unPackStringHelper(c)}static unPackLongString(f){f=f||16383;var c=Math.min(this.unPackInt16U(),f);return this.unPackStringHelper(c)}static unPackStringHelper(f){if(this.isMoreDataAvailable()<f)return 0;for(var r=new String,i=0;i<f;i++){var a=this.unPackInt16U();a>0&&(r+=String.fromCodePoint(a))}return r}};var wt=class t{static init(){console.log("BAWK! initializing...");var f=new AudioContext;this.audioCtx=f,this.children=[],this.sounds={},this.position={x:0,y:0,z:0},this.orientation={x:0,y:0,z:-1},this.detectFormats(),this.gainNode=f.createGain(),this.compNode=f.createDynamicsCompressor(),this.compNode.connect(this.gainNode),this.gainNode.connect(f.destination),this.inputNode=this.compNode,this.volume!=null&&(this.gainNode.gain.value=this.volume)}static dispose(){this.audioCtx.close()}static setFormats(f){this.formats=f}static detectFormats(){var f=t.formats||{webm:"audio/webm",ogg:"audio/ogg",mp3:"audio/mpeg"};/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&delete f.webm;var c=document.createElement("audio"),r=Object.keys(f);for(var i of r){var a=c.canPlayType(f[i]);if(console.log("BAWK! testing "+i,a),a){t.format=i,console.log("BAWK! selected "+i);break}}}static suspend(){t.audioCtx&&t.audioCtx.suspend()}static resume(){t.audioCtx&&t.audioCtx.resume()}static async load(f,c){t.audioCtx||t.init();var r=f.match(/[^/\\&\?]+\..{1,4}(?=([\?\#&].*$|$))/)[0],i=r.match(/[^\.]*$/).join(""),a=r.replace("."+i,"");i=="json"?await t.loadSprite(f):await t.loadSound(f,c||a)}static async loadSound(f,c){f=f.replace("*",t.format);var r=await t.getAudioBuffer(f);r&&(t.sounds[c]&&console.warn('BAWK! duplicate sound name, "'+c+'" will be over-written'),t.sounds[c]={buffer:r})}static async loadSprite(f){var c=await fetch(f),r=await c.json(),i=await t.loadSpriteBuffer(f,r);Object.keys(r.spritemap).forEach(a=>{var n=r.spritemap[a];t.sounds[a]={buffer:i,start:n.start,end:n.end}})}static async loadSpriteBuffer(f,c){for(var r of c.resources)if(r.endsWith(t.format))break;var i=f.match(/.+\//)+r;return console.log("BAWK! loading "+i),await t.getAudioBuffer(i+"?"+us)}static async getAudioBuffer(f){var c=await t.request(f),r=await new Promise((i,a)=>{t.audioCtx.decodeAudioData(c,i,a)});return r}static request(f){return new Promise((c,r)=>{let i=new XMLHttpRequest;i.open("GET",f,!0),i.responseType="arraybuffer";let a=Loader.addTask();i.onprogress=n=>{a=Loader.progress(a,n.loaded,n.total)},i.onload=()=>{i.status!=200?(console.log("ERROR"),r()):c(i.response),Loader.finish(a)},i.send()})}static setVolume(f){t.volume=f,t.gainNode&&(t.gainNode.gain.value=f)}static getVolume(){return t.volume}static play(f,c,r){var i=t.audioCtx;c=c||t.inputNode,i.state==="suspended"&&t.resume();var a=t.sounds[f];if(!a){let l;if(r&&(l=` or ${r}`,a=t.sounds[r]),!a)return console.error(`BAWK! ${f} ${l} not found. Did you wait for it to load?`),!1}if(a.end)var n=a.start,s=a.end-n;var o=i.createBufferSource();return o.buffer=a.buffer,o.connect(c),s?o.start(0,n,s):o.start(),o}static attach(f,c){t.position=f,t.orientation=c}static detach(){t.position={x:t.position.x,y:t.position.y,z:t.position.z},t.orientation={x:t.orientation.x,y:t.orientation.y,z:t.orientation.z}}static setPosition(f){var c=t.audioCtx.listener;c.positionX?(c.positionX.value=f.x,c.positionY.value=f.y,c.positionZ.value=f.z):c.setPosition(f.x,f.y,f.z)}static setOrientation(f){var c=t.audioCtx.listener;c.forwardX?(c.forwardX.value=f.x,c.forwardY.value=f.y,c.forwardZ.value=f.z):c.setOrientation(f.x,f.y,f.z,0,1,0)}static addChild(f){t.children.push(f)}static removeChild(f){t.children.splice(t.children.indexOf(f),1)}static update(){t.position&&t.setPosition(t.position),t.orientation&&t.setOrientation(t.orientation);for(var f of t.children)f.update()}},Xr=class t{constructor(f,c){wt.addChild(this),f=f||{},this.numChannels=f.numChannels||16,this.numPlaying=0,this.channels=[],this.nextChannelIdx=0,this.gainNode=wt.audioCtx.createGain(),this.gainNode.connect(wt.inputNode);for(var r=0;r<this.numChannels;r++){var i=wt.audioCtx.createPanner(c);i.connect(this.gainNode),this.channels.push({parent:this,source:null,position:{x:0,y:0,z:0},follow:!1,node:i})}}dispose(){this.gainNode.disconnect(),wt.removeChild(this)}setVolume(f){this.gainNode.gain.value=f}getVolume(){return this.gainNode.gain.value}play(f,c,r){if(!wt.sounds[f]){console.error("BAWK! "+f+" not found. Did you wait for it to load?");return}var i=this.findFreeChannel(c);i.source&&i.source.stop();var a=i.node;i.position=c,i.follow=r,t.setNodePosition(a,c),i.source=wt.play(f,a),i.source.channel=i,i.source.onended=t.onEnded,this.numPlaying++}update(){for(var f of this.channels)f.source&&f.follow&&t.setNodePosition(f.node,f.position)}static setNodePosition(f,c){var r=wt.position.y+(c.y-wt.position.y)*4;f.positionX?(f.positionX.value=c.x,f.positionY.value=r,f.positionZ.value=c.z):f.setPosition(c.x,r,c.z)}findFreeChannel(f){var c=this.channels,r=this.numChannels,i=wt.position;if(this.numPlaying<r){for(var a of c)if(!a.source)return a}var n=-1,s;for(var a of c){var o=Math.pow(f.x-i.x,2)+Math.pow(f.y-i.y,2)+Math.pow(f.z-i.z,2);o>n&&(n=o,s=a)}return s}static onEnded(f){f.target.channel.parent.numPlaying--,f.target.channel.source=null,f.target.channel=null}};window.BAWK=wt;var O={productBlockAds:!1,vipSubEnded:!1};var ti=class{constructor(){this.statStateTemp={total:0,mode:{public:0,private:0},dmgType:{pistol:0,grenade:0,rpegg:0,eggk:0,scrambler:0,ranger:0,whipper:0,crackshot:0,trihard:0,melee:0},gameType:{kotc:0,spatula:0,team:0,ffa:0},kdr:{private:0,public:0,ffa:0,teams:0,kotc:0,spatula:0}},this.kills=Object.create(this.statStateTemp),this.deaths=Object.create(this.statStateTemp),this.gameType={kotc:{captured:0,wins:0}},this.streak=0,this.dateReset=null}get(){return{kills:this.kills,deaths:this.deaths,gameType:this.gameType,streak:this.streak,dateReset:this.dateReset}}set(f){if(!f||f.error!==void 0)return vueApp.showGenericPopup("uh_oh","auth_stat_error_msg","ok");f.kills!==void 0&&(this.kills=this.updateStats(f.kills,"kills")),f.deaths!==void 0&&(this.deaths=this.updateStats(f.deaths,"deaths")),f.gameType!==void 0&&(this.gameType={kotc:{captured:f.gameType.kotc.captured!==void 0?f.gameType.kotc.captured:this.gameType.kotc.captured,wins:f.gameType.kotc.wins!==void 0?f.gameType.kotc.wins:this.gameType.kotc.wins}}),f.streak&&(this.streak=f.streak!==void 0?f.streak:this.streak)}updateStats(f,c){return{total:f.total!==void 0?f.total:this[c].deaths,mode:{public:f.mode.public!==void 0?f.mode.public:this[c].mode.public,private:f.mode.private!==void 0?f.mode.private:this[c].mode.private},dmgType:{pistol:f.dmgType.pistol!==void 0?f.dmgType.pistol:this[c].dmgType.pistol,grenade:f.dmgType.grenade!==void 0?f.dmgType.grenade:this[c].dmgType.grenade,rpegg:f.dmgType.rpegg!==void 0?f.dmgType.rpegg:this[c].dmgType.rpegg,eggk:f.dmgType.eggk!==void 0?f.dmgType.eggk:this[c].dmgType.eggk,scrambler:f.dmgType.scrambler!==void 0?f.dmgType.scrambler:this[c].dmgType.scrambler,ranger:f.dmgType.ranger!==void 0?f.dmgType.ranger:this[c].dmgType.ranger,whipper:f.dmgType.whipper!==void 0?f.dmgType.whipper:this[c].dmgType.whipper,crackshot:f.dmgType.crackshot!==void 0?f.dmgType.crackshot:this[c].dmgType.crackshot,trihard:f.dmgType.trihard!==void 0?f.dmgType.trihard:this[c].dmgType.trihard,melee:f.dmgType.melee!==void 0?f.dmgType.melee:this[c].dmgType.melee},gameType:{kotc:f.gameType.kotc!==void 0?f.gameType.kotc:this[c].gameType.kotc,spatula:f.gameType.spatula!==void 0?f.gameType.spatula:this[c].gameType.spatula,team:f.gameType.team!==void 0?f.gameType.team:this[c].gameType.team,ffa:f.gameType.ffa!==void 0?f.gameType.ffa:this[c].gameType.ffa}}}};var Rl=`
var sessionId;
var servicesServer;
var timeout;

onmessage = function (e) {
	servicesServer = e.data.servicesServer;
	sessionId = e.data.sessionId;
	console.log(getTime(), 'Session: worker received session ID:', sessionId);
	clearTimeout(timeout);

	if (sessionId !== null) {
		timeout = setTimeout(() => renewSession(), 600000);
	}
}

function getTime () {
	let d = new Date();
	return d.toTimeString();
}

function renewSession () {
	callRenew(res => {
		console.log(getTime(), 'Session: renew result:', res.data);

		if (res.data === 'renewed') {
			console.log(getTime(), 'Session: session renewed');
			timeout = setTimeout(() => renewSession(), 600000);
		}
		else {
			console.log(getTime(), 'Session: session expired');
			postMessage('expired');
		}
	},
		() => {
			console.log(getTime(), 'Session: failed to renew - Trying again in 30 seconds');
			timeout = setTimeout(() => renewSession(), 30000);
		}
	);
}

function callRenew (successCallback, errorCallback) {
	console.log(getTime(), 'Session: callRenew');

	try {
        var servicesWs = new WebSocket(servicesServer);
	} catch (e) {
		errorCallback();
	}

	servicesWs.onopen = function (e) {
		servicesWs.send(JSON.stringify({
			cmd: 'renewSession',
			sessionId: sessionId
		}));
	};

	servicesWs.onmessage = function (e) {
		var response = null;
		try {
			response = JSON.parse(e.data);
			successCallback(response);
		} catch (e) {
			errorCallback();
		}

		servicesWs.close();
	};

	servicesWs.onerror = function (e) {
		errorCallback();
	};
}
`,wl=new Blob([Rl]),Il=window.URL.createObjectURL(wl),Lr=new Worker(Il);Lr.onmessage=t=>{t.data==="expired"&&vueApp.showGenericPopup("session_expired","session_expired_msg","ok")};var Ji=class{constructor(){this.pickedWeapons=[];for(var f=0;f<vt.length;f++){var c=[O.catalog.forClass[f].primaryWeapons[0],O.catalog.forClass[f].secondaryWeapons[0]];this.pickedWeapons.push(c)}this.firebaseId=null,this.session=null,this.maskedEmail=null,this.classIdx=0,this.inventory=[],this.hatItem=null,this.stampItem=null,this.grenadeItem=O.catalog.grenades[0],this.meleeItem=O.catalog.melee[0],this.colorIdx=0,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.upgradeProductId=null,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.upgradeExpiryDate=null,this.upgradeIsExpired=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.statsCurrent=new ti,this.statsLifetime=new ti,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this._firebaseId,Object.defineProperty(this,"firebaseId",{get:function(){return this._firebaseId},set:function(r){this._firebaseId=r,vueApp.firebaseId=this._firebaseId}}),this._id,Object.defineProperty(this,"id",{get:function(){return this._id},set:function(r){this._id=r,vueApp.id=this._id}}),this._isAnonymous,Object.defineProperty(this,"isAnonymous",{get:function(){return this._isAnonymous},set:function(r){this._isAnonymous=r,vueApp.isAnonymous=this._isAnonymous,vueApp.googleAnalytics.isUser=this._isAnonymous?"Unclaimed":"Claimed",ga("set","dimension1",vueData.googleAnalytics.isUser)}}),this._currentBalance,Object.defineProperty(this,"currentBalance",{get:function(){return this._currentBalance},set:function(r){this._currentBalance=r,vueApp.eggs=this._currentBalance}}),this._kills,Object.defineProperty(this,"kills",{get:function(){return this._kills},set:function(r){this._kills=r,vueApp.kills=this._kills}}),this._deaths,Object.defineProperty(this,"deaths",{get:function(){return this._deaths},set:function(r){this._deaths=r,vueApp.deaths=this._deaths}}),this._kdr,Object.defineProperty(this,"kdr",{get:function(){return this._kdr},set:function(r){this._kdr=r,vueApp.kdr=this._kdr}}),this._kdrLifetime,Object.defineProperty(this,"kdrLifetime",{get:function(){return this._kdrLifetime},set:function(r){this._kdrLifetime=r,vueApp.kdrLifetime=this._kdrLifetime}}),this._streak,Object.defineProperty(this,"streak",{get:function(){return this._streak},set:function(r){this._streak=r,vueApp.streak=this._streak}}),this._statsCurrent=new ti,Object.defineProperty(this,"statsCurrent",{get:function(){return this._statsCurrent},set:function(r){this._statsCurrent.set(r),this.kills=this._statsCurrent.kills.total,this.deaths=this._statsCurrent.deaths.total,this.streak=this._statsCurrent.streak,this.kdr=Math.floor(this._statsCurrent.kills.total/Math.max(this._statsCurrent.deaths.total,1)*100)/100,vueApp.statsCurrent=this._statsCurrent}}),this._statsLifetime=new ti,Object.defineProperty(this,"statsLifetime",{get:function(){return this._statsLifetime},set:function(r){this._statsLifetime.set(r),this.kdrLifetime=Math.floor(this._statsLifetime.kills.total/Math.max(this._statsLifetime.deaths.total,1)*100)/100,vueApp.statsLifetime=this._statsLifetime}}),this._eggsSpent,Object.defineProperty(this,"eggsSpent",{get:function(){return this._eggsSpent},set:function(r){this._eggsSpent=r===null?0:r,vueApp.eggsSpent=this._eggsSpent}}),this._eggsSpentMonthly,Object.defineProperty(this,"eggsSpentMonthly",{get:function(){return this._eggsSpentMonthly},set:function(r){this._eggsSpentMonthly=r,vueApp.eggsSpentMonthly=this._eggsSpentMonthly}}),this._eggsEarnedBalance,Object.defineProperty(this,"eggsEarnedBalance",{get:function(){return this._eggsEarnedBalance},set:function(r){r!==void 0&&(this._eggsEarnedBalance=r===null?0:r,vueApp.eggsEarnedBalance=this._eggsEarnedBalance)}}),this._playerName,Object.defineProperty(this,"playerName",{get:function(){return this._playerName},set:function(r){this._playerName=r,vueApp.playerName=this._playerName}}),this._maskedEmail,Object.defineProperty(this,"maskedEmail",{get:function(){return this._maskedEmail},set:function(r){this._maskedEmail=r,vueApp.maskedEmail=this._maskedEmail}}),this._isEmailVerified,Object.defineProperty(this,"isEmailVerified",{get:function(){return this._isEmailVerified},set:function(r){this._isEmailVerified=r,vueApp.isEmailVerified=this._isEmailVerified}}),this._isSubscriber,Object.defineProperty(this,"isSubscriber",{get:function(){return this._isSubscriber},set:function(r){this._isSubscriber=r,vueApp.isSubscriber=r}}),this._upgradeName,Object.defineProperty(this,"upgradeName",{get:function(){return this._upgradeName},set:function(r){this._upgradeName=r,vueApp.upgradeName=r}}),this._hideAds,Object.defineProperty(this,"hideAds",{get:function(){return this._hideAds},set:function(r){vueApp.hideAds=!!r}}),this._twitchLinked,Object.defineProperty(this,"twitchLinked",{get(){return this._twitchLinked},set(r){this._twitchLinked=r,vueApp.twitchLinked=r}}),this._twitchName,Object.defineProperty(this,"twitchName",{get(){return this._twitchName},set(r){this._twitchName=r,vueApp.twitchName=r}}),this.isItemOwned,Object.defineProperty(this,"isItemOwned",{value:function(r){if(!r)return!1;for(var i=0;i<this.inventory.length;i++)if(this.inventory[i]&&this.inventory[i].id===r.id)return!0;return!1}}),this._contentCreator,Object.defineProperty(this,"contentCreator",{get(){return this._contentCreator},set(r){r&&(this._contentCreator=!0,vueApp.contentCreator=this._contentCreator)}}),this._dateCreated,Object.defineProperty(this,"dateCreated",{get(){return this._dateCreated},set(r){if(r){let i=new Date(r).toLocaleDateString();this._dateCreated=i,vueApp.accountCreated=i}else vueApp.accountCreated=null}})}loggedOut(){this.firebaseId=null,this.id=null,this.session=null,this.sessionId=null,this.kills=0,this.deaths=0,this.streak=0,this.currentBalance=0,this.classIdx=0,this.inventory=[],this.pickedWeapons=[],this.stampItem=null,this.grenadeItem=O.catalog.findItemById(16e3),this.meleeItem=O.catalog.findItemById(15e3),this.hatItem=null,this.colorIdx=0,this.killMultiplier=1,this.hideAds=!1,this.maybeSchoolEmail=!1,this.isAnonymous=!0,this.upgradeIsExpired=null,this.upgradeExpiryDate=null,this.upgradeName="",this.isSubscriber=!1,this.twitchLinked=!1,this.twitchName="",this.contentCreator=!1,this.dateCreated=null,this.eggsSpent=0,this.eggsSpentMonthly=0,this.eggsEarnedBalance=0,this.statsCurrent=new ti,this.statsLifetime=new ti;for(var f=0;f<vt.length;f++){var c=[O.catalog.forClass[f].primaryWeapons[0],O.catalog.forClass[f].secondaryWeapons[0]];this.pickedWeapons.push(c)}Lr.postMessage({sessionId:null}),O.adminRoles=0}loggingOut(){this.loggedOut(),this.applyLoadoutObject(),this.getPrimaryWeapon(),this.getSecondaryWeapon(),this.setClass(this.classIdx),vueApp.signOut()}setClass(f){f>=O.classes.length&&(f=0),this.classIdx=f,vueApp.classIdx=this.classIdx}pickWeapon(f,c){c.item_type_id===ItemType.Primary&&this.setClass(c.exclusive_for_class);var r=O.catalog.findItemInListById(c,O.catalog.forClass[this.classIdx].forWeaponSlot[f]);r===!1&&(c=O.catalog.forClass[this.classIdx].forWeaponSlot[f][0]),this.pickedWeapons[this.classIdx][f]=c}calculateKdr(){this.kdr=Math.floor(this.statsCurrent.kills/Math.max(this.statsCurrent.deaths,1)*100)/100,this.kdrLifetime=Math.floor(this.statslifetime.kills/Math.max(this.statslifetime.deaths,1)*100)/100}getPickedWeaponInSlot(f){return this.pickedWeapons[this.classIdx][f]}getPrimaryWeapon(){return this.getPickedWeaponInSlot(nt.Primary)}getSecondaryWeapon(){return this.getPickedWeaponInSlot(nt.Secondary)}isUpgraded(){return hasValue(this.upgradeProductId)&&!this.upgradeIsExpired}addToInventory(f,c){this.isItemOwned(f)||this.inventory.push(f),c===!0&&this.tryEquipItem(f)}tryEquipItem(f){if(this.isItemOwned(f))switch(f.item_type_id){case ItemType.Hat:this.hatItem=f;break;case ItemType.Stamp:this.stampItem=f;break;case ItemType.Primary:f.exclusive_for_class!==this.classIdx&&this.setClass(f.exclusive_for_class),this.pickWeapon(nt.Primary,f);break;case ItemType.Secondary:this.pickWeapon(nt.Secondary,f);break;case ItemType.Grenade:this.grenadeItem=f;break;case ItemType.Melee:this.meleeItem=f;break}}signedIn(f,c){if(f.uid!==c.firebaseId){console.log("Firebase user ID does not match account returned from API");return}if(this.isAnonymous=f.isAnonymous,this.isEmailVerified=!this.isAnonymous&&c.emailVerified,this.id=c.id,this.firebaseId=c.firebaseId,this.sessionId=c.sessionId,this.session=c.session,this.maskedEmail=c.maskedEmail,this.kills=c.kills,this.deaths=c.deaths,this.streak=c.streak,this.currentBalance=c.currentBalance,this.upgradeProductId=c.upgradeProductId,this.killMultiplier=hasValue(c.upgradeMultiplier)?c.upgradeMultiplier:1,this.upgradeExpiryDate=hasValue(c.upgradeExpiryDate)?c.upgradeExpiryDate:null,this.upgradeIsExpired=hasValue(c.upgradeExpiryDate)?c.upgradeIsExpired:null,this.hideAds=hasValue(c.upgradeAdFree)&&!this.upgradeIsExpired?c.upgradeAdFree:!1,this.isSubscriber=c.upgradeType==="subscription"&&!c.upgradeIsExpired,this.upgradeName=c.upgradeName,this.maybeSchoolEmail=c.maybeSchoolEmail,this.subscriptionEnded=c.subscriptionEnded,this.twitchLinked=c.twitchLinked,this.twitchName=c.twitchName,this.contentCreator=c.social,this.setStats(c.statsLifetime,c.statsCurrent),this.dateCreated=c.dateCreated,this.eggsSpent=c.eggsSpent,this.eggsSpentMonthly=c.eggsSpentMonthly,this.eggsEarnedBalance=this.setEggBalances(this.currentBalance),O.adminRoles=c.adminRoles,hasValue(c.ownedItemIds))for(var r=0;r<c.ownedItemIds.length;r++){var i=O.catalog.findItemById(c.ownedItemIds[r]);this.inventory.push(i)}this.isUpgraded()&&O.checkUpgrade(),this.subscriptionEnded&&(O.vipSubEnded=!0),c.firstSignin&&(O.showSigninBonus=!0),this.applyLoadoutObject(c.loadout),this.applyLocalLoadout(c.loadout),Lr.postMessage({servicesServer:O.servicesServer,sessionId:this.sessionId})}convertLoadout(f){return f||(f=this.generateLoadoutObject()),{primaryId:[f.soldier_primary_item_id,f.scrambler_primary_item_id,f.ranger_primary_item_id,f.eggsploder_primary_item_id,f.whipper_primary_item_id,f.crackshot_primary_item_id,f.trihard_primary_item_id],secondaryId:[f.soldier_secondary_item_id,f.scrambler_secondary_item_id,f.ranger_secondary_item_id,f.eggsploder_secondary_item_id,f.whipper_secondary_item_id,f.crackshot_secondary_item_id,f.trihard_secondary_item_id],hatId:f.hat_id,stampId:f.stamp_id,grenadeId:f.grenade_id,meleeId:f.melee_id,classIdx:f.class_idx,colorIdx:f.color}}setUpgrade(f){this.upgradeProductId=f.upgradeProductId,this.multiplier=f.multiplier,this.hideAds=f.hideAds,this.upgradeIsExpired=f.isExpired,this.upgradeName=f.upgradeName;var c=this.isUpgraded(),r=c?this.upgradeExpiryDate:null;this.colorIdx>=7&&!c&&(this.colorIdx=0),vueApp.setAccountUpgraded(c,r)}generateLoadoutObject(){var f={classIdx:this.classIdx,hatId:hasValue(this.hatItem)?this.hatItem.id:null,stampId:hasValue(this.stampItem)?this.stampItem.id:null,grenadeId:hasValue(this.grenadeItem)?this.grenadeItem.id:null,meleeId:hasValue(this.meleeItem)?this.meleeItem.id:null,colorIdx:this.colorIdx,primaryId:this.pickedWeapons.map(c=>c[nt.Primary].id),secondaryId:this.pickedWeapons.map(c=>c[nt.Secondary].id)};return f}applyLocalLoadout(f){if(!hasValue(f))return;let c=f;f.hasOwnProperty("primaryId")||(c=this.convertLoadout(f));let r={items:c,kills:this.kills?this.kills:0,deaths:this.deaths?this.deaths:0,kdr:this.kdr?this.kdr:0,streak:this.streak?this.streak:0,balance:this._currentBalance};localStore.setItem("localLoadOut",JSON.stringify(r))}applyLoadoutObject(f){if(hasValue(f)){f.classIdx!==void 0&&f.classIdx!==null&&this.setClass(f.classIdx);for(var c=this,r=function(l,u,h){var d=O.catalog.forClass[u].forWeaponSlot[h][0];if(hasValue(l)){let p=O.catalog.findItemById(l);p&&(d=p)}c.pickedWeapons[u][h]=d},i=0;i<vt.length;i++)r(f.primaryId[i],i,nt.Primary),r(f.secondaryId[i],i,nt.Secondary);if(hasValue(f.hatId)){var a=O.catalog.findItemById(f.hatId);this.isItemOwned(a)||(this.hatItem=null),this.hatItem=a}if(hasValue(f.stampId)){var n=O.catalog.findItemById(f.stampId);this.isItemOwned(n)||(this.stampItem=null),this.stampItem=n}if(hasValue(f.grenadeId)){var s=O.catalog.findItemById(f.grenadeId);this.isItemOwned(s)||(s=O.catalog.findItemById(16e3)),this.grenadeItem=s}if(hasValue(f.meleeId)){var o=O.catalog.findItemById(f.meleeId);this.isItemOwned(o)||(o=O.catalog.findItemById(15e3)),this.meleeItem=o}hasValue(f.colorIdx)&&(this.colorIdx=f.colorIdx,this.colorIdx>=7&&this.isUpgraded()===!1&&(this.colorIdx=0))}O.resetPaperDoll()}getEquippedItems(){return{[ItemType.Primary]:this.pickedWeapons[this.classIdx][nt.Primary],[ItemType.Secondary]:this.pickedWeapons[this.classIdx][nt.Secondary],[ItemType.Hat]:this.hatItem,[ItemType.Stamp]:this.stampItem,[ItemType.Grenade]:this.grenadeItem,[ItemType.Melee]:this.meleeItem}}syncToServer(f){var c=this.generateLoadoutObject();O.api_saveLoadout(c,f),c!==null&&this.applyLocalLoadout(c)}setEggBalances(f){this.currentBalance=f,this.eggsEarnedBalance=this.eggsSpent+this.currentBalance}setStats(f,c){this.statsLifetime=f,this.statsCurrent=c}};var A=function(t,f,c,r){var i,a=arguments.length,n=a<3?f:r===null?r=Object.getOwnPropertyDescriptor(f,c):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,f,c,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(n=(a<3?i(n):a>3?i(f,c,n):i(f,c))||n);return a>3&&n&&Object.defineProperty(f,c,n),n},N=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,c){f.__proto__=c}||function(f,c){for(var r in c)c.hasOwnProperty(r)&&(f[r]=c[r])};return function(f,c){function r(){this.constructor=f}t(f,c),f.prototype=c===null?Object.create(c):(r.prototype=c.prototype,new r)}}(),T;(function(t){var f=function(){function i(){this._defines={},this._currentRank=32,this._maxRank=-1}return i.prototype.unBindMesh=function(){this._mesh=null},i.prototype.addFallback=function(a,n){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=new Array),this._defines[a].push(n)},i.prototype.addCPUSkinningFallback=function(a,n){this._mesh=n,a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a)},Object.defineProperty(i.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),i.prototype.reduce=function(a,n){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,a=a.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),n._bonesComputationForcedToCPU=!0;for(var s=this._mesh.getScene(),o=0;o<s.meshes.length;o++){var l=s.meshes[o];if(l.material&&!(!l.computeBonesUsingShaders||l.numBoneInfluencers===0)){if(l.material.getEffect()===n)l.computeBonesUsingShaders=!1;else if(l.subMeshes)for(var u=0,h=l.subMeshes;u<h.length;u++){var d=h[u],p=d.effect;if(p===n){l.computeBonesUsingShaders=!1;break}}}}}else{var m=this._defines[this._currentRank];if(m)for(var o=0;o<m.length;o++)a=a.replace("#define "+m[o],"");this._currentRank++}return a},i}();t.EffectFallbacks=f;var c=function(){function i(){}return i}();t.EffectCreationOptions=c;var r=function(){function i(a,n,s,o,l,u,h,d,p,m){o===void 0&&(o=null),u===void 0&&(u=null),h===void 0&&(h=null),d===void 0&&(d=null),p===void 0&&(p=null);var _=this;if(this.uniqueId=0,this.onCompileObservable=new t.Observable,this.onErrorObservable=new t.Observable,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._isReady=!1,this._compilationError="",this.name=a,n.attributes){var v=n;if(this._engine=s,this._attributesNames=v.attributes,this._uniformsNames=v.uniformsNames.concat(v.samplers),this._samplers=v.samplers.slice(),this.defines=v.defines,this.onError=v.onError,this.onCompiled=v.onCompiled,this._fallbacks=v.fallbacks,this._indexParameters=v.indexParameters,this._transformFeedbackVaryings=v.transformFeedbackVaryings,v.uniformBuffersNames)for(var S=0;S<v.uniformBuffersNames.length;S++)this._uniformBuffersNames[v.uniformBuffersNames[S]]=S}else this._engine=l,this.defines=u,this._uniformsNames=s.concat(o),this._samplers=o?o.slice():[],this._attributesNames=n,this.onError=p,this.onCompiled=d,this._indexParameters=m,this._fallbacks=h;this.uniqueId=i._uniqueIdSeed++;var P,x;a.vertexElement?(P=document.getElementById(a.vertexElement),P||(P=a.vertexElement)):P=a.vertex||a,a.fragmentElement?(x=document.getElementById(a.fragmentElement),x||(x=a.fragmentElement)):x=a.fragment||a,this._loadVertexShader(P,function(R){_._processIncludes(R,function(w){_._processShaderConversion(w,!1,function(I){_._loadFragmentShader(x,function(F){_._processIncludes(F,function(k){_._processShaderConversion(k,!0,function(E){if(a){var g=a.vertexElement||a.vertex||a,y=a.fragmentElement||a.fragment||a;_._vertexSourceCode="#define SHADER_NAME vertex:"+g+`
`+I,_._fragmentSourceCode="#define SHADER_NAME fragment:"+y+`
`+E}else _._vertexSourceCode=I,_._fragmentSourceCode=E;_._prepareEffect()})})})})})})}return Object.defineProperty(i.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new t.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),i.prototype.isReady=function(){return this._isReady},i.prototype.getEngine=function(){return this._engine},i.prototype.getProgram=function(){return this._program},i.prototype.getAttributesNames=function(){return this._attributesNames},i.prototype.getAttributeLocation=function(a){return this._attributes[a]},i.prototype.getAttributeLocationByName=function(a){var n=this._attributesNames.indexOf(a);return this._attributes[n]},i.prototype.getAttributesCount=function(){return this._attributes.length},i.prototype.getUniformIndex=function(a){return this._uniformsNames.indexOf(a)},i.prototype.getUniform=function(a){return this._uniforms[this._uniformsNames.indexOf(a)]},i.prototype.getSamplers=function(){return this._samplers},i.prototype.getCompilationError=function(){return this._compilationError},i.prototype.executeWhenCompiled=function(a){if(this.isReady()){a(this);return}this.onCompileObservable.add(function(n){a(n)})},i.prototype._loadVertexShader=function(a,n){if(t.Tools.IsWindowObjectExist()&&a instanceof HTMLElement){var s=t.Tools.GetDOMTextContent(a);n(s);return}if(a.substr(0,7)==="base64:"){var o=window.atob(a.substr(7));n(o);return}if(i.ShadersStore[a+"VertexShader"]){n(i.ShadersStore[a+"VertexShader"]);return}var l;a[0]==="."||a[0]==="/"||a.indexOf("http")>-1?l=a:l=t.Engine.ShadersRepository+a,this._engine._loadFile(l+".vertex.fx",n)},i.prototype._loadFragmentShader=function(a,n){if(t.Tools.IsWindowObjectExist()&&a instanceof HTMLElement){var s=t.Tools.GetDOMTextContent(a);n(s);return}if(a.substr(0,7)==="base64:"){var o=window.atob(a.substr(7));n(o);return}if(i.ShadersStore[a+"PixelShader"]){n(i.ShadersStore[a+"PixelShader"]);return}if(i.ShadersStore[a+"FragmentShader"]){n(i.ShadersStore[a+"FragmentShader"]);return}var l;a[0]==="."||a[0]==="/"||a.indexOf("http")>-1?l=a:l=t.Engine.ShadersRepository+a,this._engine._loadFile(l+".fragment.fx",n)},i.prototype._dumpShadersSource=function(a,n,s){var o=this._engine.webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",l=o+(s?s+`
`:"");a=l+a,n=l+n;var u=2,h=/\n/gm,d=`
1	`+a.replace(h,function(){return`
`+u+++"	"});u=2;var p=`
1	`+n.replace(h,function(){return`
`+u+++"	"});this.name.vertexElement?(t.Tools.Error("Vertex shader: "+this.name.vertexElement+d),t.Tools.Error("Fragment shader: "+this.name.fragmentElement+p)):this.name.vertex?(t.Tools.Error("Vertex shader: "+this.name.vertex+d),t.Tools.Error("Fragment shader: "+this.name.fragment+p)):(t.Tools.Error("Vertex shader: "+this.name+d),t.Tools.Error("Fragment shader: "+this.name+p))},i.prototype._processShaderConversion=function(a,n,s){var o=this._processPrecision(a);if(this._engine.webGLVersion==1){s(o);return}if(o.indexOf("#version 3")!==-1){s(o.replace("#version 300 es",""));return}var l=o.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,u=/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,h=o.replace(u,"");h=h.replace(/varying(?![\n\r])\s/g,n?"in ":"out "),h=h.replace(/attribute[ \t]/g,"in "),h=h.replace(/[ \t]attribute/g," in"),n&&(h=h.replace(/texture2DLodEXT\s*\(/g,"textureLod("),h=h.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),h=h.replace(/texture2D\s*\(/g,"texture("),h=h.replace(/textureCube\s*\(/g,"texture("),h=h.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),h=h.replace(/gl_FragColor/g,"glFragColor"),h=h.replace(/gl_FragData/g,"glFragData"),h=h.replace(/void\s+?main\s*\(/g,(l?"":`out vec4 glFragColor;
`)+"void main(")),s(h)},i.prototype._processIncludes=function(a,n){for(var s=this,o=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,l=o.exec(a),u=new String(a);l!=null;){var h=l[1];if(h.indexOf("__decl__")!==-1&&(h=h.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(h=h.replace(/Vertex/,"Ubo"),h=h.replace(/Fragment/,"Ubo")),h=h+"Declaration"),i.IncludesShadersStore[h]){var d=i.IncludesShadersStore[h];if(l[2])for(var p=l[3].split(","),m=0;m<p.length;m+=2){var _=new RegExp(p[m],"g"),v=p[m+1];d=d.replace(_,v)}if(l[4]){var S=l[5];if(S.indexOf("..")!==-1){var P=S.split(".."),x=parseInt(P[0]),R=parseInt(P[1]),w=d.slice(0);d="",isNaN(R)&&(R=this._indexParameters[P[1]]);for(var I=x;I<R;I++)this._engine.supportsUniformBuffers||(w=w.replace(/light\{X\}.(\w*)/g,function(k,E){return E+"{X}"})),d+=w.replace(/\{X\}/g,I.toString())+`
`}else this._engine.supportsUniformBuffers||(d=d.replace(/light\{X\}.(\w*)/g,function(k,E){return E+"{X}"})),d=d.replace(/\{X\}/g,S)}u=u.replace(l[0],d)}else{var F=t.Engine.ShadersRepository+"ShadersInclude/"+h+".fx";this._engine._loadFile(F,function(k){i.IncludesShadersStore[h]=k,s._processIncludes(u,n)});return}l=o.exec(a)}n(u)},i.prototype._processPrecision=function(a){return a.indexOf("precision highp float")===-1?this._engine.getCaps().highPrecisionShaderSupported?a=`precision highp float;
`+a:a=`precision mediump float;
`+a:this._engine.getCaps().highPrecisionShaderSupported||(a=a.replace("precision highp float","precision mediump float")),a},i.prototype._rebuildProgram=function(a,n,s,o){var l=this;this._isReady=!1,this._vertexSourceCodeOverride=a,this._fragmentSourceCodeOverride=n,this.onError=function(u,h){o&&o(h)},this.onCompiled=function(){for(var u=l.getEngine().scenes,h=0;h<u.length;h++)u[h].markAllMaterialsAsDirty(t.Material.TextureDirtyFlag);s&&s(l._program)},this._fallbacks=null,this._prepareEffect()},i.prototype.getSpecificUniformLocations=function(a){var n=this._engine;return n.getUniforms(this._program,a)},i.prototype._prepareEffect=function(){var a=this._attributesNames,n=this.defines,s=this._fallbacks;this._valueCache={};var o=this._program;try{var l=this._engine;if(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._program=l.createRawShaderProgram(this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,void 0,this._transformFeedbackVaryings):this._program=l.createShaderProgram(this._vertexSourceCode,this._fragmentSourceCode,n,void 0,this._transformFeedbackVaryings),this._program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this),l.supportsUniformBuffers)for(var u in this._uniformBuffersNames)this.bindUniformBlock(u,this._uniformBuffersNames[u]);this._uniforms=l.getUniforms(this._program,this._uniformsNames),this._attributes=l.getAttributes(this._program,a);var h;for(h=0;h<this._samplers.length;h++){var d=this.getUniform(this._samplers[h]);d==null&&(this._samplers.splice(h,1),h--)}l.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),o&&this.getEngine()._deleteProgram(o)}catch(p){this._compilationError=p.message,t.Tools.Error("Unable to compile effect:"),t.Tools.Error("Uniforms: "+this._uniformsNames.map(function(m){return" "+m})),t.Tools.Error("Attributes: "+a.map(function(m){return" "+m})),t.Tools.Error("Error: "+this._compilationError),o&&(this._program=o,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),s&&s.isMoreFallbacks?(t.Tools.Error("Trying next fallback."),this.defines=s.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!0,configurable:!0}),i.prototype._bindTexture=function(a,n){this._engine._bindTexture(this._samplers.indexOf(a),n)},i.prototype.setTexture=function(a,n){this._engine.setTexture(this._samplers.indexOf(a),this.getUniform(a),n)},i.prototype.setDepthStencilTexture=function(a,n){this._engine.setDepthStencilTexture(this._samplers.indexOf(a),this.getUniform(a),n)},i.prototype.setTextureArray=function(a,n){if(this._samplers.indexOf(a+"Ex")===-1)for(var s=this._samplers.indexOf(a),o=1;o<n.length;o++)this._samplers.splice(s+o,0,a+"Ex");this._engine.setTextureArray(this._samplers.indexOf(a),this.getUniform(a),n)},i.prototype.setTextureFromPostProcess=function(a,n){this._engine.setTextureFromPostProcess(this._samplers.indexOf(a),n)},i.prototype.setTextureFromPostProcessOutput=function(a,n){this._engine.setTextureFromPostProcessOutput(this._samplers.indexOf(a),n)},i.prototype._cacheMatrix=function(a,n){var s=this._valueCache[a],o=n.updateFlag;return s!==void 0&&s===o?!1:(this._valueCache[a]=o,!0)},i.prototype._cacheFloat2=function(a,n,s){var o=this._valueCache[a];if(!o)return o=[n,s],this._valueCache[a]=o,!0;var l=!1;return o[0]!==n&&(o[0]=n,l=!0),o[1]!==s&&(o[1]=s,l=!0),l},i.prototype._cacheFloat3=function(a,n,s,o){var l=this._valueCache[a];if(!l)return l=[n,s,o],this._valueCache[a]=l,!0;var u=!1;return l[0]!==n&&(l[0]=n,u=!0),l[1]!==s&&(l[1]=s,u=!0),l[2]!==o&&(l[2]=o,u=!0),u},i.prototype._cacheFloat4=function(a,n,s,o,l){var u=this._valueCache[a];if(!u)return u=[n,s,o,l],this._valueCache[a]=u,!0;var h=!1;return u[0]!==n&&(u[0]=n,h=!0),u[1]!==s&&(u[1]=s,h=!0),u[2]!==o&&(u[2]=o,h=!0),u[3]!==l&&(u[3]=l,h=!0),h},i.prototype.bindUniformBuffer=function(a,n){var s=this._uniformBuffersNames[n];s===void 0||i._baseCache[s]===a||(i._baseCache[s]=a,this._engine.bindUniformBufferBase(a,s))},i.prototype.bindUniformBlock=function(a,n){this._engine.bindUniformBlock(this._program,a,n)},i.prototype.setInt=function(a,n){var s=this._valueCache[a];return s!==void 0&&s===n?this:(this._valueCache[a]=n,this._engine.setInt(this.getUniform(a),n),this)},i.prototype.setIntArray=function(a,n){return this._valueCache[a]=null,this._engine.setIntArray(this.getUniform(a),n),this},i.prototype.setIntArray2=function(a,n){return this._valueCache[a]=null,this._engine.setIntArray2(this.getUniform(a),n),this},i.prototype.setIntArray3=function(a,n){return this._valueCache[a]=null,this._engine.setIntArray3(this.getUniform(a),n),this},i.prototype.setIntArray4=function(a,n){return this._valueCache[a]=null,this._engine.setIntArray4(this.getUniform(a),n),this},i.prototype.setFloatArray=function(a,n){return this._valueCache[a]=null,this._engine.setFloatArray(this.getUniform(a),n),this},i.prototype.setFloatArray2=function(a,n){return this._valueCache[a]=null,this._engine.setFloatArray2(this.getUniform(a),n),this},i.prototype.setFloatArray3=function(a,n){return this._valueCache[a]=null,this._engine.setFloatArray3(this.getUniform(a),n),this},i.prototype.setFloatArray4=function(a,n){return this._valueCache[a]=null,this._engine.setFloatArray4(this.getUniform(a),n),this},i.prototype.setArray=function(a,n){return this._valueCache[a]=null,this._engine.setArray(this.getUniform(a),n),this},i.prototype.setArray2=function(a,n){return this._valueCache[a]=null,this._engine.setArray2(this.getUniform(a),n),this},i.prototype.setArray3=function(a,n){return this._valueCache[a]=null,this._engine.setArray3(this.getUniform(a),n),this},i.prototype.setArray4=function(a,n){return this._valueCache[a]=null,this._engine.setArray4(this.getUniform(a),n),this},i.prototype.setMatrices=function(a,n){return n?(this._valueCache[a]=null,this._engine.setMatrices(this.getUniform(a),n),this):this},i.prototype.setMatrix=function(a,n){return this._cacheMatrix(a,n)&&this._engine.setMatrix(this.getUniform(a),n),this},i.prototype.setMatrix3x3=function(a,n){return this._valueCache[a]=null,this._engine.setMatrix3x3(this.getUniform(a),n),this},i.prototype.setMatrix2x2=function(a,n){return this._valueCache[a]=null,this._engine.setMatrix2x2(this.getUniform(a),n),this},i.prototype.setFloat=function(a,n){var s=this._valueCache[a];return s!==void 0&&s===n?this:(this._valueCache[a]=n,this._engine.setFloat(this.getUniform(a),n),this)},i.prototype.setBool=function(a,n){var s=this._valueCache[a];return s!==void 0&&s===n?this:(this._valueCache[a]=n,this._engine.setBool(this.getUniform(a),n?1:0),this)},i.prototype.setVector2=function(a,n){return this._cacheFloat2(a,n.x,n.y)&&this._engine.setFloat2(this.getUniform(a),n.x,n.y),this},i.prototype.setFloat2=function(a,n,s){return this._cacheFloat2(a,n,s)&&this._engine.setFloat2(this.getUniform(a),n,s),this},i.prototype.setVector3=function(a,n){return this._cacheFloat3(a,n.x,n.y,n.z)&&this._engine.setFloat3(this.getUniform(a),n.x,n.y,n.z),this},i.prototype.setFloat3=function(a,n,s,o){return this._cacheFloat3(a,n,s,o)&&this._engine.setFloat3(this.getUniform(a),n,s,o),this},i.prototype.setVector4=function(a,n){return this._cacheFloat4(a,n.x,n.y,n.z,n.w)&&this._engine.setFloat4(this.getUniform(a),n.x,n.y,n.z,n.w),this},i.prototype.setFloat4=function(a,n,s,o,l){return this._cacheFloat4(a,n,s,o,l)&&this._engine.setFloat4(this.getUniform(a),n,s,o,l),this},i.prototype.setColor3=function(a,n){return this._cacheFloat3(a,n.r,n.g,n.b)&&this._engine.setColor3(this.getUniform(a),n),this},i.prototype.setColor4=function(a,n,s){return this._cacheFloat4(a,n.r,n.g,n.b,s)&&this._engine.setColor4(this.getUniform(a),n,s),this},i.prototype.setDirectColor4=function(a,n){return this._cacheFloat4(a,n.r,n.g,n.b,n.a)&&this._engine.setDirectColor4(this.getUniform(a),n),this},i.RegisterShader=function(a,n,s){n&&(i.ShadersStore[a+"PixelShader"]=n),s&&(i.ShadersStore[a+"VertexShader"]=s)},i.ResetCache=function(){i._baseCache={}},i._uniqueIdSeed=0,i._baseCache={},i.ShadersStore={},i.IncludesShadersStore={},i}();t.Effect=r})(T||(T={}));var T;(function(t){var f=function(){function i(){}return i.KEYDOWN=1,i.KEYUP=2,i}();t.KeyboardEventTypes=f;var c=function(){function i(a,n){this.type=a,this.event=n}return i}();t.KeyboardInfo=c;var r=function(i){N(a,i);function a(n,s){var o=i.call(this,n,s)||this;return o.type=n,o.event=s,o.skipOnPointerObservable=!1,o}return a}(c);t.KeyboardInfoPre=r})(T||(T={}));var T;(function(t){var f=function(){function a(){}return a.POINTERDOWN=1,a.POINTERUP=2,a.POINTERMOVE=4,a.POINTERWHEEL=8,a.POINTERPICK=16,a.POINTERTAP=32,a.POINTERDOUBLETAP=64,a}();t.PointerEventTypes=f;var c=function(){function a(n,s){this.type=n,this.event=s}return a}();t.PointerInfoBase=c;var r=function(a){N(n,a);function n(s,o,l,u){var h=a.call(this,s,o)||this;return h.ray=null,h.skipOnPointerObservable=!1,h.localPosition=new t.Vector2(l,u),h}return n}(c);t.PointerInfoPre=r;var i=function(a){N(n,a);function n(s,o,l){var u=a.call(this,s,o)||this;return u.pickInfo=l,u}return n}(c);t.PointerInfo=i})(T||(T={}));var T;(function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var f=function(){function E(g,y,M){g===void 0&&(g=0),y===void 0&&(y=0),M===void 0&&(M=0),this.r=g,this.g=y,this.b=M}return E.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},E.prototype.getClassName=function(){return"Color3"},E.prototype.getHashCode=function(){var g=this.r||0;return g=g*397^(this.g||0),g=g*397^(this.b||0),g},E.prototype.toArray=function(g,y){return y===void 0&&(y=0),g[y]=this.r,g[y+1]=this.g,g[y+2]=this.b,this},E.prototype.toColor4=function(g){return g===void 0&&(g=1),new c(this.r,this.g,this.b,g)},E.prototype.asArray=function(){var g=new Array;return this.toArray(g,0),g},E.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},E.prototype.multiply=function(g){return new E(this.r*g.r,this.g*g.g,this.b*g.b)},E.prototype.multiplyToRef=function(g,y){return y.r=this.r*g.r,y.g=this.g*g.g,y.b=this.b*g.b,this},E.prototype.equals=function(g){return g&&this.r===g.r&&this.g===g.g&&this.b===g.b},E.prototype.equalsFloats=function(g,y,M){return this.r===g&&this.g===y&&this.b===M},E.prototype.scale=function(g){return new E(this.r*g,this.g*g,this.b*g)},E.prototype.scaleToRef=function(g,y){return y.r=this.r*g,y.g=this.g*g,y.b=this.b*g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.r+=this.r*g,y.g+=this.g*g,y.b+=this.b*g,this},E.prototype.clampToRef=function(g,y,M){return g===void 0&&(g=0),y===void 0&&(y=1),M.r=t.Scalar.Clamp(this.r,g,y),M.g=t.Scalar.Clamp(this.g,g,y),M.b=t.Scalar.Clamp(this.b,g,y),this},E.prototype.add=function(g){return new E(this.r+g.r,this.g+g.g,this.b+g.b)},E.prototype.addToRef=function(g,y){return y.r=this.r+g.r,y.g=this.g+g.g,y.b=this.b+g.b,this},E.prototype.subtract=function(g){return new E(this.r-g.r,this.g-g.g,this.b-g.b)},E.prototype.subtractToRef=function(g,y){return y.r=this.r-g.r,y.g=this.g-g.g,y.b=this.b-g.b,this},E.prototype.clone=function(){return new E(this.r,this.g,this.b)},E.prototype.copyFrom=function(g){return this.r=g.r,this.g=g.g,this.b=g.b,this},E.prototype.copyFromFloats=function(g,y,M){return this.r=g,this.g=y,this.b=M,this},E.prototype.set=function(g,y,M){return this.copyFromFloats(g,y,M)},E.prototype.toHexString=function(){var g=this.r*255|0,y=this.g*255|0,M=this.b*255|0;return"#"+t.Scalar.ToHex(g)+t.Scalar.ToHex(y)+t.Scalar.ToHex(M)},E.prototype.toLinearSpace=function(){var g=new E;return this.toLinearSpaceToRef(g),g},E.prototype.toLinearSpaceToRef=function(g){return g.r=Math.pow(this.r,t.ToLinearSpace),g.g=Math.pow(this.g,t.ToLinearSpace),g.b=Math.pow(this.b,t.ToLinearSpace),this},E.prototype.toGammaSpace=function(){var g=new E;return this.toGammaSpaceToRef(g),g},E.prototype.toGammaSpaceToRef=function(g){return g.r=Math.pow(this.r,t.ToGammaSpace),g.g=Math.pow(this.g,t.ToGammaSpace),g.b=Math.pow(this.b,t.ToGammaSpace),this},E.FromHexString=function(g){if(g.substring(0,1)!=="#"||g.length!==7)return new E(0,0,0);var y=parseInt(g.substring(1,3),16),M=parseInt(g.substring(3,5),16),C=parseInt(g.substring(5,7),16);return E.FromInts(y,M,C)},E.FromArray=function(g,y){return y===void 0&&(y=0),new E(g[y],g[y+1],g[y+2])},E.FromInts=function(g,y,M){return new E(g/255,y/255,M/255)},E.Lerp=function(g,y,M){var C=new E(0,0,0);return E.LerpToRef(g,y,M,C),C},E.LerpToRef=function(g,y,M,C){C.r=g.r+(y.r-g.r)*M,C.g=g.g+(y.g-g.g)*M,C.b=g.b+(y.b-g.b)*M},E.Red=function(){return new E(1,0,0)},E.Green=function(){return new E(0,1,0)},E.Blue=function(){return new E(0,0,1)},E.Black=function(){return new E(0,0,0)},E.White=function(){return new E(1,1,1)},E.Purple=function(){return new E(.5,0,.5)},E.Magenta=function(){return new E(1,0,1)},E.Yellow=function(){return new E(1,1,0)},E.Gray=function(){return new E(.5,.5,.5)},E.Teal=function(){return new E(0,1,1)},E.Random=function(){return new E(Math.random(),Math.random(),Math.random())},E}();t.Color3=f;var c=function(){function E(g,y,M,C){g===void 0&&(g=0),y===void 0&&(y=0),M===void 0&&(M=0),C===void 0&&(C=1),this.r=g,this.g=y,this.b=M,this.a=C}return E.prototype.addInPlace=function(g){return this.r+=g.r,this.g+=g.g,this.b+=g.b,this.a+=g.a,this},E.prototype.asArray=function(){var g=new Array;return this.toArray(g,0),g},E.prototype.toArray=function(g,y){return y===void 0&&(y=0),g[y]=this.r,g[y+1]=this.g,g[y+2]=this.b,g[y+3]=this.a,this},E.prototype.add=function(g){return new E(this.r+g.r,this.g+g.g,this.b+g.b,this.a+g.a)},E.prototype.subtract=function(g){return new E(this.r-g.r,this.g-g.g,this.b-g.b,this.a-g.a)},E.prototype.subtractToRef=function(g,y){return y.r=this.r-g.r,y.g=this.g-g.g,y.b=this.b-g.b,y.a=this.a-g.a,this},E.prototype.scale=function(g){return new E(this.r*g,this.g*g,this.b*g,this.a*g)},E.prototype.scaleToRef=function(g,y){return y.r=this.r*g,y.g=this.g*g,y.b=this.b*g,y.a=this.a*g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.r+=this.r*g,y.g+=this.g*g,y.b+=this.b*g,y.a+=this.a*g,this},E.prototype.clampToRef=function(g,y,M){return g===void 0&&(g=0),y===void 0&&(y=1),M.r=t.Scalar.Clamp(this.r,g,y),M.g=t.Scalar.Clamp(this.g,g,y),M.b=t.Scalar.Clamp(this.b,g,y),M.a=t.Scalar.Clamp(this.a,g,y),this},E.prototype.multiply=function(g){return new E(this.r*g.r,this.g*g.g,this.b*g.b,this.a*g.a)},E.prototype.multiplyToRef=function(g,y){return y.r=this.r*g.r,y.g=this.g*g.g,y.b=this.b*g.b,y.a=this.a*g.a,y},E.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},E.prototype.getClassName=function(){return"Color4"},E.prototype.getHashCode=function(){var g=this.r||0;return g=g*397^(this.g||0),g=g*397^(this.b||0),g=g*397^(this.a||0),g},E.prototype.clone=function(){return new E(this.r,this.g,this.b,this.a)},E.prototype.copyFrom=function(g){return this.r=g.r,this.g=g.g,this.b=g.b,this.a=g.a,this},E.prototype.copyFromFloats=function(g,y,M,C){return this.r=g,this.g=y,this.b=M,this.a=C,this},E.prototype.set=function(g,y,M,C){return this.copyFromFloats(g,y,M,C)},E.prototype.toHexString=function(){var g=this.r*255|0,y=this.g*255|0,M=this.b*255|0,C=this.a*255|0;return"#"+t.Scalar.ToHex(g)+t.Scalar.ToHex(y)+t.Scalar.ToHex(M)+t.Scalar.ToHex(C)},E.prototype.toLinearSpace=function(){var g=new E;return this.toLinearSpaceToRef(g),g},E.prototype.toLinearSpaceToRef=function(g){return g.r=Math.pow(this.r,t.ToLinearSpace),g.g=Math.pow(this.g,t.ToLinearSpace),g.b=Math.pow(this.b,t.ToLinearSpace),g.a=this.a,this},E.prototype.toGammaSpace=function(){var g=new E;return this.toGammaSpaceToRef(g),g},E.prototype.toGammaSpaceToRef=function(g){return g.r=Math.pow(this.r,t.ToGammaSpace),g.g=Math.pow(this.g,t.ToGammaSpace),g.b=Math.pow(this.b,t.ToGammaSpace),g.a=this.a,this},E.FromHexString=function(g){if(g.substring(0,1)!=="#"||g.length!==9)return new E(0,0,0,0);var y=parseInt(g.substring(1,3),16),M=parseInt(g.substring(3,5),16),C=parseInt(g.substring(5,7),16),D=parseInt(g.substring(7,9),16);return E.FromInts(y,M,C,D)},E.Lerp=function(g,y,M){var C=new E(0,0,0,0);return E.LerpToRef(g,y,M,C),C},E.LerpToRef=function(g,y,M,C){C.r=g.r+(y.r-g.r)*M,C.g=g.g+(y.g-g.g)*M,C.b=g.b+(y.b-g.b)*M,C.a=g.a+(y.a-g.a)*M},E.FromColor3=function(g,y){return y===void 0&&(y=1),new E(g.r,g.g,g.b,y)},E.FromArray=function(g,y){return y===void 0&&(y=0),new E(g[y],g[y+1],g[y+2],g[y+3])},E.FromInts=function(g,y,M,C){return new E(g/255,y/255,M/255,C/255)},E.CheckColors4=function(g,y){if(g.length===y*3){for(var M=[],C=0;C<g.length;C+=3){var D=C/3*4;M[D]=g[C],M[D+1]=g[C+1],M[D+2]=g[C+2],M[D+3]=1}return M}return g},E}();t.Color4=c;var r=function(){function E(g,y){g===void 0&&(g=0),y===void 0&&(y=0),this.x=g,this.y=y}return E.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},E.prototype.getClassName=function(){return"Vector2"},E.prototype.getHashCode=function(){var g=this.x||0;return g=g*397^(this.y||0),g},E.prototype.toArray=function(g,y){return y===void 0&&(y=0),g[y]=this.x,g[y+1]=this.y,this},E.prototype.asArray=function(){var g=new Array;return this.toArray(g,0),g},E.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this},E.prototype.copyFromFloats=function(g,y){return this.x=g,this.y=y,this},E.prototype.set=function(g,y){return this.copyFromFloats(g,y)},E.prototype.add=function(g){return new E(this.x+g.x,this.y+g.y)},E.prototype.addToRef=function(g,y){return y.x=this.x+g.x,y.y=this.y+g.y,this},E.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this},E.prototype.addVector3=function(g){return new E(this.x+g.x,this.y+g.y)},E.prototype.subtract=function(g){return new E(this.x-g.x,this.y-g.y)},E.prototype.subtractToRef=function(g,y){return y.x=this.x-g.x,y.y=this.y-g.y,this},E.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this},E.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this},E.prototype.multiply=function(g){return new E(this.x*g.x,this.y*g.y)},E.prototype.multiplyToRef=function(g,y){return y.x=this.x*g.x,y.y=this.y*g.y,this},E.prototype.multiplyByFloats=function(g,y){return new E(this.x*g,this.y*y)},E.prototype.divide=function(g){return new E(this.x/g.x,this.y/g.y)},E.prototype.divideToRef=function(g,y){return y.x=this.x/g.x,y.y=this.y/g.y,this},E.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},E.prototype.negate=function(){return new E(-this.x,-this.y)},E.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this},E.prototype.scale=function(g){var y=new E(0,0);return this.scaleToRef(g,y),y},E.prototype.scaleToRef=function(g,y){return y.x=this.x*g,y.y=this.y*g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.x+=this.x*g,y.y+=this.y*g,this},E.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y},E.prototype.equalsWithEpsilon=function(g,y){return y===void 0&&(y=t.Epsilon),g&&t.Scalar.WithinEpsilon(this.x,g.x,y)&&t.Scalar.WithinEpsilon(this.y,g.y,y)},E.prototype.floor=function(){return new E(Math.floor(this.x),Math.floor(this.y))},E.prototype.fract=function(){return new E(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},E.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},E.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},E.prototype.normalize=function(){var g=this.length();if(g===0)return this;var y=1/g;return this.x*=y,this.y*=y,this},E.prototype.clone=function(){return new E(this.x,this.y)},E.Zero=function(){return new E(0,0)},E.One=function(){return new E(1,1)},E.FromArray=function(g,y){return y===void 0&&(y=0),new E(g[y],g[y+1])},E.FromArrayToRef=function(g,y,M){M.x=g[y],M.y=g[y+1]},E.CatmullRom=function(g,y,M,C,D){var V=D*D,G=D*V,U=.5*(2*y.x+(-g.x+M.x)*D+(2*g.x-5*y.x+4*M.x-C.x)*V+(-g.x+3*y.x-3*M.x+C.x)*G),z=.5*(2*y.y+(-g.y+M.y)*D+(2*g.y-5*y.y+4*M.y-C.y)*V+(-g.y+3*y.y-3*M.y+C.y)*G);return new E(U,z)},E.Clamp=function(g,y,M){var C=g.x;C=C>M.x?M.x:C,C=C<y.x?y.x:C;var D=g.y;return D=D>M.y?M.y:D,D=D<y.y?y.y:D,new E(C,D)},E.Hermite=function(g,y,M,C,D){var V=D*D,G=D*V,U=2*G-3*V+1,z=-2*G+3*V,H=G-2*V+D,W=G-V,X=g.x*U+M.x*z+y.x*H+C.x*W,K=g.y*U+M.y*z+y.y*H+C.y*W;return new E(X,K)},E.Lerp=function(g,y,M){var C=g.x+(y.x-g.x)*M,D=g.y+(y.y-g.y)*M;return new E(C,D)},E.Dot=function(g,y){return g.x*y.x+g.y*y.y},E.Normalize=function(g){var y=g.clone();return y.normalize(),y},E.Minimize=function(g,y){var M=g.x<y.x?g.x:y.x,C=g.y<y.y?g.y:y.y;return new E(M,C)},E.Maximize=function(g,y){var M=g.x>y.x?g.x:y.x,C=g.y>y.y?g.y:y.y;return new E(M,C)},E.Transform=function(g,y){var M=E.Zero();return E.TransformToRef(g,y,M),M},E.TransformToRef=function(g,y,M){var C=g.x*y.m[0]+g.y*y.m[4]+y.m[12],D=g.x*y.m[1]+g.y*y.m[5]+y.m[13];M.x=C,M.y=D},E.PointInTriangle=function(g,y,M,C){var D=.5*(-M.y*C.x+y.y*(-M.x+C.x)+y.x*(M.y-C.y)+M.x*C.y),V=D<0?-1:1,G=(y.y*C.x-y.x*C.y+(C.y-y.y)*g.x+(y.x-C.x)*g.y)*V,U=(y.x*M.y-y.y*M.x+(y.y-M.y)*g.x+(M.x-y.x)*g.y)*V;return G>0&&U>0&&G+U<2*D*V},E.Distance=function(g,y){return Math.sqrt(E.DistanceSquared(g,y))},E.DistanceSquared=function(g,y){var M=g.x-y.x,C=g.y-y.y;return M*M+C*C},E.Center=function(g,y){var M=g.add(y);return M.scaleInPlace(.5),M},E.DistanceOfPointFromSegment=function(g,y,M){var C=E.DistanceSquared(y,M);if(C===0)return E.Distance(g,y);var D=M.subtract(y),V=Math.max(0,Math.min(1,E.Dot(g.subtract(y),D)/C)),G=y.add(D.multiplyByFloats(V,V));return E.Distance(g,G)},E}();t.Vector2=r;var i=function(){function E(g,y,M){g===void 0&&(g=0),y===void 0&&(y=0),M===void 0&&(M=0),this.x=g,this.y=y,this.z=M}return E.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},E.prototype.getClassName=function(){return"Vector3"},E.prototype.getHashCode=function(){var g=this.x||0;return g=g*397^(this.y||0),g=g*397^(this.z||0),g},E.prototype.asArray=function(){var g=[];return this.toArray(g,0),g},E.prototype.toArray=function(g,y){return y===void 0&&(y=0),g[y]=this.x,g[y+1]=this.y,g[y+2]=this.z,this},E.prototype.toQuaternion=function(){return t.Quaternion.RotationYawPitchRoll(this.x,this.y,this.z)},E.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this},E.prototype.add=function(g){return new E(this.x+g.x,this.y+g.y,this.z+g.z)},E.prototype.addToRef=function(g,y){return y.x=this.x+g.x,y.y=this.y+g.y,y.z=this.z+g.z,this},E.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this},E.prototype.subtract=function(g){return new E(this.x-g.x,this.y-g.y,this.z-g.z)},E.prototype.subtractToRef=function(g,y){return y.x=this.x-g.x,y.y=this.y-g.y,y.z=this.z-g.z,this},E.prototype.subtractFromFloats=function(g,y,M){return new E(this.x-g,this.y-y,this.z-M)},E.prototype.subtractFromFloatsToRef=function(g,y,M,C){return C.x=this.x-g,C.y=this.y-y,C.z=this.z-M,this},E.prototype.negate=function(){return new E(-this.x,-this.y,-this.z)},E.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this},E.prototype.scale=function(g){return new E(this.x*g,this.y*g,this.z*g)},E.prototype.scaleToRef=function(g,y){return y.x=this.x*g,y.y=this.y*g,y.z=this.z*g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.x+=this.x*g,y.y+=this.y*g,y.z+=this.z*g,this},E.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z},E.prototype.equalsWithEpsilon=function(g,y){return y===void 0&&(y=t.Epsilon),g&&t.Scalar.WithinEpsilon(this.x,g.x,y)&&t.Scalar.WithinEpsilon(this.y,g.y,y)&&t.Scalar.WithinEpsilon(this.z,g.z,y)},E.prototype.equalsToFloats=function(g,y,M){return this.x===g&&this.y===y&&this.z===M},E.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this},E.prototype.multiply=function(g){return new E(this.x*g.x,this.y*g.y,this.z*g.z)},E.prototype.multiplyToRef=function(g,y){return y.x=this.x*g.x,y.y=this.y*g.y,y.z=this.z*g.z,this},E.prototype.multiplyByFloats=function(g,y,M){return new E(this.x*g,this.y*y,this.z*M)},E.prototype.divide=function(g){return new E(this.x/g.x,this.y/g.y,this.z/g.z)},E.prototype.divideToRef=function(g,y){return y.x=this.x/g.x,y.y=this.y/g.y,y.z=this.z/g.z,this},E.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},E.prototype.minimizeInPlace=function(g){return this.minimizeInPlaceFromFloats(g.x,g.y,g.z)},E.prototype.maximizeInPlace=function(g){return this.maximizeInPlaceFromFloats(g.x,g.y,g.z)},E.prototype.minimizeInPlaceFromFloats=function(g,y,M){return g<this.x&&(this.x=g),y<this.y&&(this.y=y),M<this.z&&(this.z=M),this},E.prototype.maximizeInPlaceFromFloats=function(g,y,M){return g>this.x&&(this.x=g),y>this.y&&(this.y=y),M>this.z&&(this.z=M),this},Object.defineProperty(E.prototype,"isNonUniform",{get:function(){var g=Math.abs(this.x),y=Math.abs(this.y);if(g!==y)return!0;var M=Math.abs(this.z);return g!==M||y!==M},enumerable:!0,configurable:!0}),E.prototype.floor=function(){return new E(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},E.prototype.fract=function(){return new E(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},E.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},E.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},E.prototype.normalize=function(){var g=this.length();if(g===0||g===1)return this;var y=1/g;return this.x*=y,this.y*=y,this.z*=y,this},E.prototype.normalizeToNew=function(){var g=new E(0,0,0);return this.normalizeToRef(g),g},E.prototype.normalizeToRef=function(g){var y=this.length();if(y===0||y===1)return g.set(this.x,this.y,this.z),g;var M=1/y;return this.scaleToRef(M,g),g},E.prototype.clone=function(){return new E(this.x,this.y,this.z)},E.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this},E.prototype.copyFromFloats=function(g,y,M){return this.x=g,this.y=y,this.z=M,this},E.prototype.set=function(g,y,M){return this.copyFromFloats(g,y,M)},E.GetClipFactor=function(g,y,M,C){var D=E.Dot(g,M)-C,V=E.Dot(y,M)-C,G=D/(D-V);return G},E.GetAngleBetweenVectors=function(g,y,M){var C=k.Vector3[1].copyFrom(g).normalize(),D=k.Vector3[2].copyFrom(y).normalize(),V=E.Dot(C,D),G=k.Vector3[3];return E.CrossToRef(C,D,G),E.Dot(G,M)>0?Math.acos(V):-Math.acos(V)},E.FromArray=function(g,y){return y||(y=0),new E(g[y],g[y+1],g[y+2])},E.FromFloatArray=function(g,y){return E.FromArray(g,y)},E.FromArrayToRef=function(g,y,M){M.x=g[y],M.y=g[y+1],M.z=g[y+2]},E.FromFloatArrayToRef=function(g,y,M){return E.FromArrayToRef(g,y,M)},E.FromFloatsToRef=function(g,y,M,C){C.x=g,C.y=y,C.z=M},E.Zero=function(){return new E(0,0,0)},E.One=function(){return new E(1,1,1)},E.Up=function(){return new E(0,1,0)},E.Down=function(){return new E(0,-1,0)},E.Forward=function(){return new E(0,0,1)},E.Backward=function(){return new E(0,0,-1)},E.Right=function(){return new E(1,0,0)},E.Left=function(){return new E(-1,0,0)},E.TransformCoordinates=function(g,y){var M=E.Zero();return E.TransformCoordinatesToRef(g,y,M),M},E.TransformCoordinatesToRef=function(g,y,M){var C=g.x*y.m[0]+g.y*y.m[4]+g.z*y.m[8]+y.m[12],D=g.x*y.m[1]+g.y*y.m[5]+g.z*y.m[9]+y.m[13],V=g.x*y.m[2]+g.y*y.m[6]+g.z*y.m[10]+y.m[14],G=g.x*y.m[3]+g.y*y.m[7]+g.z*y.m[11]+y.m[15];M.x=C/G,M.y=D/G,M.z=V/G},E.TransformCoordinatesFromFloatsToRef=function(g,y,M,C,D){var V=g*C.m[0]+y*C.m[4]+M*C.m[8]+C.m[12],G=g*C.m[1]+y*C.m[5]+M*C.m[9]+C.m[13],U=g*C.m[2]+y*C.m[6]+M*C.m[10]+C.m[14],z=g*C.m[3]+y*C.m[7]+M*C.m[11]+C.m[15];D.x=V/z,D.y=G/z,D.z=U/z},E.TransformNormal=function(g,y){var M=E.Zero();return E.TransformNormalToRef(g,y,M),M},E.TransformNormalToRef=function(g,y,M){var C=g.x*y.m[0]+g.y*y.m[4]+g.z*y.m[8],D=g.x*y.m[1]+g.y*y.m[5]+g.z*y.m[9],V=g.x*y.m[2]+g.y*y.m[6]+g.z*y.m[10];M.x=C,M.y=D,M.z=V},E.TransformNormalFromFloatsToRef=function(g,y,M,C,D){D.x=g*C.m[0]+y*C.m[4]+M*C.m[8],D.y=g*C.m[1]+y*C.m[5]+M*C.m[9],D.z=g*C.m[2]+y*C.m[6]+M*C.m[10]},E.CatmullRom=function(g,y,M,C,D){var V=D*D,G=D*V,U=.5*(2*y.x+(-g.x+M.x)*D+(2*g.x-5*y.x+4*M.x-C.x)*V+(-g.x+3*y.x-3*M.x+C.x)*G),z=.5*(2*y.y+(-g.y+M.y)*D+(2*g.y-5*y.y+4*M.y-C.y)*V+(-g.y+3*y.y-3*M.y+C.y)*G),H=.5*(2*y.z+(-g.z+M.z)*D+(2*g.z-5*y.z+4*M.z-C.z)*V+(-g.z+3*y.z-3*M.z+C.z)*G);return new E(U,z,H)},E.Clamp=function(g,y,M){var C=g.x;C=C>M.x?M.x:C,C=C<y.x?y.x:C;var D=g.y;D=D>M.y?M.y:D,D=D<y.y?y.y:D;var V=g.z;return V=V>M.z?M.z:V,V=V<y.z?y.z:V,new E(C,D,V)},E.Hermite=function(g,y,M,C,D){var V=D*D,G=D*V,U=2*G-3*V+1,z=-2*G+3*V,H=G-2*V+D,W=G-V,X=g.x*U+M.x*z+y.x*H+C.x*W,K=g.y*U+M.y*z+y.y*H+C.y*W,j=g.z*U+M.z*z+y.z*H+C.z*W;return new E(X,K,j)},E.Lerp=function(g,y,M){var C=new E(0,0,0);return E.LerpToRef(g,y,M,C),C},E.LerpToRef=function(g,y,M,C){C.x=g.x+(y.x-g.x)*M,C.y=g.y+(y.y-g.y)*M,C.z=g.z+(y.z-g.z)*M},E.Dot=function(g,y){return g.x*y.x+g.y*y.y+g.z*y.z},E.Cross=function(g,y){var M=E.Zero();return E.CrossToRef(g,y,M),M},E.CrossToRef=function(g,y,M){k.Vector3[0].x=g.y*y.z-g.z*y.y,k.Vector3[0].y=g.z*y.x-g.x*y.z,k.Vector3[0].z=g.x*y.y-g.y*y.x,M.copyFrom(k.Vector3[0])},E.Normalize=function(g){var y=E.Zero();return E.NormalizeToRef(g,y),y},E.NormalizeToRef=function(g,y){y.copyFrom(g),y.normalize()},E.Project=function(g,y,M,C){var D=C.width,V=C.height,G=C.x,U=C.y,z=E._viewportMatrixCache?E._viewportMatrixCache:E._viewportMatrixCache=new o;o.FromValuesToRef(D/2,0,0,0,0,-V/2,0,0,0,0,.5,0,G+D/2,V/2+U,.5,1,z);var H=k.Matrix[0];return y.multiplyToRef(M,H),H.multiplyToRef(z,H),E.TransformCoordinates(g,H)},E.UnprojectFromTransform=function(g,y,M,C,D){var V=k.Matrix[0];C.multiplyToRef(D,V),V.invert(),g.x=g.x/y*2-1,g.y=-(g.y/M*2-1);var G=E.TransformCoordinates(g,V),U=g.x*V.m[3]+g.y*V.m[7]+g.z*V.m[11]+V.m[15];return t.Scalar.WithinEpsilon(U,1)&&(G=G.scale(1/U)),G},E.Unproject=function(g,y,M,C,D,V){var G=E.Zero();return E.UnprojectToRef(g,y,M,C,D,V,G),G},E.UnprojectToRef=function(g,y,M,C,D,V,G){E.UnprojectFloatsToRef(g.x,g.y,g.z,y,M,C,D,V,G)},E.UnprojectFloatsToRef=function(g,y,M,C,D,V,G,U,z){var H=k.Matrix[0];V.multiplyToRef(G,H),H.multiplyToRef(U,H),H.invert();var W=k.Vector3[0];W.x=g/C*2-1,W.y=-(y/D*2-1),W.z=2*M-1,E.TransformCoordinatesToRef(W,H,z);var X=W.x*H.m[3]+W.y*H.m[7]+W.z*H.m[11]+H.m[15];t.Scalar.WithinEpsilon(X,1)&&z.scaleInPlace(1/X)},E.Minimize=function(g,y){var M=g.clone();return M.minimizeInPlace(y),M},E.Maximize=function(g,y){var M=g.clone();return M.maximizeInPlace(y),M},E.Distance=function(g,y){return Math.sqrt(E.DistanceSquared(g,y))},E.DistanceSquared=function(g,y){var M=g.x-y.x,C=g.y-y.y,D=g.z-y.z;return M*M+C*C+D*D},E.Center=function(g,y){var M=g.add(y);return M.scaleInPlace(.5),M},E.RotationFromAxis=function(g,y,M){var C=E.Zero();return E.RotationFromAxisToRef(g,y,M,C),C},E.RotationFromAxisToRef=function(g,y,M,C){var D=k.Quaternion[0];s.RotationQuaternionFromAxisToRef(g,y,M,D),D.toEulerAnglesToRef(C)},E}();t.Vector3=i;var a=function(){function E(g,y,M,C){this.x=g,this.y=y,this.z=M,this.w=C}return E.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},E.prototype.getClassName=function(){return"Vector4"},E.prototype.getHashCode=function(){var g=this.x||0;return g=g*397^(this.y||0),g=g*397^(this.z||0),g=g*397^(this.w||0),g},E.prototype.asArray=function(){var g=new Array;return this.toArray(g,0),g},E.prototype.toArray=function(g,y){return y===void 0&&(y=0),g[y]=this.x,g[y+1]=this.y,g[y+2]=this.z,g[y+3]=this.w,this},E.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this},E.prototype.add=function(g){return new E(this.x+g.x,this.y+g.y,this.z+g.z,this.w+g.w)},E.prototype.addToRef=function(g,y){return y.x=this.x+g.x,y.y=this.y+g.y,y.z=this.z+g.z,y.w=this.w+g.w,this},E.prototype.subtractInPlace=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this.w-=g.w,this},E.prototype.subtract=function(g){return new E(this.x-g.x,this.y-g.y,this.z-g.z,this.w-g.w)},E.prototype.subtractToRef=function(g,y){return y.x=this.x-g.x,y.y=this.y-g.y,y.z=this.z-g.z,y.w=this.w-g.w,this},E.prototype.subtractFromFloats=function(g,y,M,C){return new E(this.x-g,this.y-y,this.z-M,this.w-C)},E.prototype.subtractFromFloatsToRef=function(g,y,M,C,D){return D.x=this.x-g,D.y=this.y-y,D.z=this.z-M,D.w=this.w-C,this},E.prototype.negate=function(){return new E(-this.x,-this.y,-this.z,-this.w)},E.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},E.prototype.scale=function(g){return new E(this.x*g,this.y*g,this.z*g,this.w*g)},E.prototype.scaleToRef=function(g,y){return y.x=this.x*g,y.y=this.y*g,y.z=this.z*g,y.w=this.w*g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.x+=this.x*g,y.y+=this.y*g,y.z+=this.z*g,y.w+=this.w*g,this},E.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},E.prototype.equalsWithEpsilon=function(g,y){return y===void 0&&(y=t.Epsilon),g&&t.Scalar.WithinEpsilon(this.x,g.x,y)&&t.Scalar.WithinEpsilon(this.y,g.y,y)&&t.Scalar.WithinEpsilon(this.z,g.z,y)&&t.Scalar.WithinEpsilon(this.w,g.w,y)},E.prototype.equalsToFloats=function(g,y,M,C){return this.x===g&&this.y===y&&this.z===M&&this.w===C},E.prototype.multiplyInPlace=function(g){return this.x*=g.x,this.y*=g.y,this.z*=g.z,this.w*=g.w,this},E.prototype.multiply=function(g){return new E(this.x*g.x,this.y*g.y,this.z*g.z,this.w*g.w)},E.prototype.multiplyToRef=function(g,y){return y.x=this.x*g.x,y.y=this.y*g.y,y.z=this.z*g.z,y.w=this.w*g.w,this},E.prototype.multiplyByFloats=function(g,y,M,C){return new E(this.x*g,this.y*y,this.z*M,this.w*C)},E.prototype.divide=function(g){return new E(this.x/g.x,this.y/g.y,this.z/g.z,this.w/g.w)},E.prototype.divideToRef=function(g,y){return y.x=this.x/g.x,y.y=this.y/g.y,y.z=this.z/g.z,y.w=this.w/g.w,this},E.prototype.divideInPlace=function(g){return this.divideToRef(g,this)},E.prototype.minimizeInPlace=function(g){return g.x<this.x&&(this.x=g.x),g.y<this.y&&(this.y=g.y),g.z<this.z&&(this.z=g.z),g.w<this.w&&(this.w=g.w),this},E.prototype.maximizeInPlace=function(g){return g.x>this.x&&(this.x=g.x),g.y>this.y&&(this.y=g.y),g.z>this.z&&(this.z=g.z),g.w>this.w&&(this.w=g.w),this},E.prototype.floor=function(){return new E(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},E.prototype.fract=function(){return new E(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},E.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},E.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},E.prototype.normalize=function(){var g=this.length();if(g===0)return this;var y=1/g;return this.x*=y,this.y*=y,this.z*=y,this.w*=y,this},E.prototype.toVector3=function(){return new i(this.x,this.y,this.z)},E.prototype.clone=function(){return new E(this.x,this.y,this.z,this.w)},E.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w,this},E.prototype.copyFromFloats=function(g,y,M,C){return this.x=g,this.y=y,this.z=M,this.w=C,this},E.prototype.set=function(g,y,M,C){return this.copyFromFloats(g,y,M,C)},E.FromArray=function(g,y){return y||(y=0),new E(g[y],g[y+1],g[y+2],g[y+3])},E.FromArrayToRef=function(g,y,M){M.x=g[y],M.y=g[y+1],M.z=g[y+2],M.w=g[y+3]},E.FromFloatArrayToRef=function(g,y,M){E.FromArrayToRef(g,y,M)},E.FromFloatsToRef=function(g,y,M,C,D){D.x=g,D.y=y,D.z=M,D.w=C},E.Zero=function(){return new E(0,0,0,0)},E.One=function(){return new E(1,1,1,1)},E.Normalize=function(g){var y=E.Zero();return E.NormalizeToRef(g,y),y},E.NormalizeToRef=function(g,y){y.copyFrom(g),y.normalize()},E.Minimize=function(g,y){var M=g.clone();return M.minimizeInPlace(y),M},E.Maximize=function(g,y){var M=g.clone();return M.maximizeInPlace(y),M},E.Distance=function(g,y){return Math.sqrt(E.DistanceSquared(g,y))},E.DistanceSquared=function(g,y){var M=g.x-y.x,C=g.y-y.y,D=g.z-y.z,V=g.w-y.w;return M*M+C*C+D*D+V*V},E.Center=function(g,y){var M=g.add(y);return M.scaleInPlace(.5),M},E.TransformNormal=function(g,y){var M=E.Zero();return E.TransformNormalToRef(g,y,M),M},E.TransformNormalToRef=function(g,y,M){var C=g.x*y.m[0]+g.y*y.m[4]+g.z*y.m[8],D=g.x*y.m[1]+g.y*y.m[5]+g.z*y.m[9],V=g.x*y.m[2]+g.y*y.m[6]+g.z*y.m[10];M.x=C,M.y=D,M.z=V,M.w=g.w},E.TransformNormalFromFloatsToRef=function(g,y,M,C,D,V){V.x=g*D.m[0]+y*D.m[4]+M*D.m[8],V.y=g*D.m[1]+y*D.m[5]+M*D.m[9],V.z=g*D.m[2]+y*D.m[6]+M*D.m[10],V.w=C},E}();t.Vector4=a;var n=function(){function E(g,y){this.width=g,this.height=y}return E.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},E.prototype.getClassName=function(){return"Size"},E.prototype.getHashCode=function(){var g=this.width||0;return g=g*397^(this.height||0),g},E.prototype.copyFrom=function(g){this.width=g.width,this.height=g.height},E.prototype.copyFromFloats=function(g,y){return this.width=g,this.height=y,this},E.prototype.set=function(g,y){return this.copyFromFloats(g,y)},E.prototype.multiplyByFloats=function(g,y){return new E(this.width*g,this.height*y)},E.prototype.clone=function(){return new E(this.width,this.height)},E.prototype.equals=function(g){return g?this.width===g.width&&this.height===g.height:!1},Object.defineProperty(E.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),E.Zero=function(){return new E(0,0)},E.prototype.add=function(g){var y=new E(this.width+g.width,this.height+g.height);return y},E.prototype.subtract=function(g){var y=new E(this.width-g.width,this.height-g.height);return y},E.Lerp=function(g,y,M){var C=g.width+(y.width-g.width)*M,D=g.height+(y.height-g.height)*M;return new E(C,D)},E}();t.Size=n;var s=function(){function E(g,y,M,C){g===void 0&&(g=0),y===void 0&&(y=0),M===void 0&&(M=0),C===void 0&&(C=1),this.x=g,this.y=y,this.z=M,this.w=C}return E.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},E.prototype.getClassName=function(){return"Quaternion"},E.prototype.getHashCode=function(){var g=this.x||0;return g=g*397^(this.y||0),g=g*397^(this.z||0),g=g*397^(this.w||0),g},E.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},E.prototype.equals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},E.prototype.clone=function(){return new E(this.x,this.y,this.z,this.w)},E.prototype.copyFrom=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w,this},E.prototype.copyFromFloats=function(g,y,M,C){return this.x=g,this.y=y,this.z=M,this.w=C,this},E.prototype.set=function(g,y,M,C){return this.copyFromFloats(g,y,M,C)},E.prototype.add=function(g){return new E(this.x+g.x,this.y+g.y,this.z+g.z,this.w+g.w)},E.prototype.addInPlace=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this},E.prototype.subtract=function(g){return new E(this.x-g.x,this.y-g.y,this.z-g.z,this.w-g.w)},E.prototype.scale=function(g){return new E(this.x*g,this.y*g,this.z*g,this.w*g)},E.prototype.scaleToRef=function(g,y){return y.x=this.x*g,y.y=this.y*g,y.z=this.z*g,y.w=this.w*g,this},E.prototype.scaleInPlace=function(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},E.prototype.scaleAndAddToRef=function(g,y){return y.x+=this.x*g,y.y+=this.y*g,y.z+=this.z*g,y.w+=this.w*g,this},E.prototype.multiply=function(g){var y=new E(0,0,0,1);return this.multiplyToRef(g,y),y},E.prototype.multiplyToRef=function(g,y){var M=this.x*g.w+this.y*g.z-this.z*g.y+this.w*g.x,C=-this.x*g.z+this.y*g.w+this.z*g.x+this.w*g.y,D=this.x*g.y-this.y*g.x+this.z*g.w+this.w*g.z,V=-this.x*g.x-this.y*g.y-this.z*g.z+this.w*g.w;return y.copyFromFloats(M,C,D,V),this},E.prototype.multiplyInPlace=function(g){return this.multiplyToRef(g,this),this},E.prototype.conjugateToRef=function(g){return g.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},E.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},E.prototype.conjugate=function(){var g=new E(-this.x,-this.y,-this.z,this.w);return g},E.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},E.prototype.normalize=function(){var g=1/this.length();return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},E.prototype.toEulerAngles=function(g){g===void 0&&(g="YZX");var y=i.Zero();return this.toEulerAnglesToRef(y,g),y},E.prototype.toEulerAnglesToRef=function(g,y){y===void 0&&(y="YZX");var M=this.z,C=this.x,D=this.y,V=this.w,G=V*V,U=M*M,z=C*C,H=D*D,W=D*M-C*V,X=.4999999;return W<-X?(g.y=2*Math.atan2(D,V),g.x=Math.PI/2,g.z=0):W>X?(g.y=2*Math.atan2(D,V),g.x=-Math.PI/2,g.z=0):(g.z=Math.atan2(2*(C*D+M*V),-U-z+H+G),g.x=Math.asin(-2*(M*D-C*V)),g.y=Math.atan2(2*(M*C+D*V),U-z-H+G)),this},E.prototype.toRotationMatrix=function(g){var y=this.x*this.x,M=this.y*this.y,C=this.z*this.z,D=this.x*this.y,V=this.z*this.w,G=this.z*this.x,U=this.y*this.w,z=this.y*this.z,H=this.x*this.w;return g.m[0]=1-2*(M+C),g.m[1]=2*(D+V),g.m[2]=2*(G-U),g.m[3]=0,g.m[4]=2*(D-V),g.m[5]=1-2*(C+y),g.m[6]=2*(z+H),g.m[7]=0,g.m[8]=2*(G+U),g.m[9]=2*(z-H),g.m[10]=1-2*(M+y),g.m[11]=0,g.m[12]=0,g.m[13]=0,g.m[14]=0,g.m[15]=1,g._markAsUpdated(),this},E.prototype.fromRotationMatrix=function(g){return E.FromRotationMatrixToRef(g,this),this},E.FromRotationMatrix=function(g){var y=new E;return E.FromRotationMatrixToRef(g,y),y},E.FromRotationMatrixToRef=function(g,y){var M=g.m,C=M[0],D=M[4],V=M[8],G=M[1],U=M[5],z=M[9],H=M[2],W=M[6],X=M[10],K=C+U+X,j;K>0?(j=.5/Math.sqrt(K+1),y.w=.25/j,y.x=(W-z)*j,y.y=(V-H)*j,y.z=(G-D)*j):C>U&&C>X?(j=2*Math.sqrt(1+C-U-X),y.w=(W-z)/j,y.x=.25*j,y.y=(D+G)/j,y.z=(V+H)/j):U>X?(j=2*Math.sqrt(1+U-C-X),y.w=(V-H)/j,y.x=(D+G)/j,y.y=.25*j,y.z=(z+W)/j):(j=2*Math.sqrt(1+X-C-U),y.w=(G-D)/j,y.x=(V+H)/j,y.y=(z+W)/j,y.z=.25*j)},E.Dot=function(g,y){return g.x*y.x+g.y*y.y+g.z*y.z+g.w*y.w},E.AreClose=function(g,y){var M=E.Dot(g,y);return M>=0},E.Zero=function(){return new E(0,0,0,0)},E.Inverse=function(g){return new E(-g.x,-g.y,-g.z,g.w)},E.Identity=function(){return new E(0,0,0,1)},E.IsIdentity=function(g){return g&&g.x===0&&g.y===0&&g.z===0&&g.w===1},E.RotationAxis=function(g,y){return E.RotationAxisToRef(g,y,new E)},E.RotationAxisToRef=function(g,y,M){var C=Math.sin(y/2);return g.normalize(),M.w=Math.cos(y/2),M.x=g.x*C,M.y=g.y*C,M.z=g.z*C,M},E.FromArray=function(g,y){return y||(y=0),new E(g[y],g[y+1],g[y+2],g[y+3])},E.RotationYawPitchRoll=function(g,y,M){var C=new E;return E.RotationYawPitchRollToRef(g,y,M,C),C},E.RotationYawPitchRollToRef=function(g,y,M,C){var D=M*.5,V=y*.5,G=g*.5,U=Math.sin(D),z=Math.cos(D),H=Math.sin(V),W=Math.cos(V),X=Math.sin(G),K=Math.cos(G);C.x=K*H*z+X*W*U,C.y=X*W*z-K*H*U,C.z=K*W*U-X*H*z,C.w=K*W*z+X*H*U},E.RotationAlphaBetaGamma=function(g,y,M){var C=new E;return E.RotationAlphaBetaGammaToRef(g,y,M,C),C},E.RotationAlphaBetaGammaToRef=function(g,y,M,C){var D=(M+g)*.5,V=(M-g)*.5,G=y*.5;C.x=Math.cos(V)*Math.sin(G),C.y=Math.sin(V)*Math.sin(G),C.z=Math.sin(D)*Math.cos(G),C.w=Math.cos(D)*Math.cos(G)},E.RotationQuaternionFromAxis=function(g,y,M){var C=new E(0,0,0,0);return E.RotationQuaternionFromAxisToRef(g,y,M,C),C},E.RotationQuaternionFromAxisToRef=function(g,y,M,C){var D=k.Matrix[0];o.FromXYZAxesToRef(g.normalize(),y.normalize(),M.normalize(),D),E.FromRotationMatrixToRef(D,C)},E.Slerp=function(g,y,M){var C=E.Identity();return E.SlerpToRef(g,y,M,C),C},E.SlerpToRef=function(g,y,M,C){var D,V,G=g.x*y.x+g.y*y.y+g.z*y.z+g.w*y.w,U=!1;if(G<0&&(U=!0,G=-G),G>.999999)V=1-M,D=U?-M:M;else{var z=Math.acos(G),H=1/Math.sin(z);V=Math.sin((1-M)*z)*H,D=U?-Math.sin(M*z)*H:Math.sin(M*z)*H}C.x=V*g.x+D*y.x,C.y=V*g.y+D*y.y,C.z=V*g.z+D*y.z,C.w=V*g.w+D*y.w},E.Hermite=function(g,y,M,C,D){var V=D*D,G=D*V,U=2*G-3*V+1,z=-2*G+3*V,H=G-2*V+D,W=G-V,X=g.x*U+M.x*z+y.x*H+C.x*W,K=g.y*U+M.y*z+y.y*H+C.y*W,j=g.z*U+M.z*z+y.z*H+C.z*W,ee=g.w*U+M.w*z+y.w*H+C.w*W;return new E(X,K,j,ee)},E}();t.Quaternion=s;var o=function(){function E(){this._isIdentity=!1,this._isIdentityDirty=!0,this.m=new Float32Array(16),this._markAsUpdated()}return E.prototype._markAsUpdated=function(){this.updateFlag=E._updateFlagSeed++,this._isIdentityDirty=!0},E.prototype.isIdentity=function(g){return g===void 0&&(g=!1),this._isIdentityDirty&&(this._isIdentityDirty=!1,this.m[0]!==1||this.m[5]!==1||this.m[15]!==1?this._isIdentity=!1:this.m[1]!==0||this.m[2]!==0||this.m[3]!==0||this.m[4]!==0||this.m[6]!==0||this.m[7]!==0||this.m[8]!==0||this.m[9]!==0||this.m[11]!==0||this.m[12]!==0||this.m[13]!==0||this.m[14]!==0?this._isIdentity=!1:this._isIdentity=!0,!g&&this.m[10]!==1&&(this._isIdentity=!1)),this._isIdentity},E.prototype.determinant=function(){var g=this.m[10]*this.m[15]-this.m[11]*this.m[14],y=this.m[9]*this.m[15]-this.m[11]*this.m[13],M=this.m[9]*this.m[14]-this.m[10]*this.m[13],C=this.m[8]*this.m[15]-this.m[11]*this.m[12],D=this.m[8]*this.m[14]-this.m[10]*this.m[12],V=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*g-this.m[6]*y+this.m[7]*M)-this.m[1]*(this.m[4]*g-this.m[6]*C+this.m[7]*D)+this.m[2]*(this.m[4]*y-this.m[5]*C+this.m[7]*V)-this.m[3]*(this.m[4]*M-this.m[5]*D+this.m[6]*V)},E.prototype.toArray=function(){return this.m},E.prototype.asArray=function(){return this.toArray()},E.prototype.invert=function(){return this.invertToRef(this),this},E.prototype.reset=function(){for(var g=0;g<16;g++)this.m[g]=0;return this._markAsUpdated(),this},E.prototype.add=function(g){var y=new E;return this.addToRef(g,y),y},E.prototype.addToRef=function(g,y){for(var M=0;M<16;M++)y.m[M]=this.m[M]+g.m[M];return y._markAsUpdated(),this},E.prototype.addToSelf=function(g){for(var y=0;y<16;y++)this.m[y]+=g.m[y];return this._markAsUpdated(),this},E.prototype.invertToRef=function(g){var y=this.m[0],M=this.m[1],C=this.m[2],D=this.m[3],V=this.m[4],G=this.m[5],U=this.m[6],z=this.m[7],H=this.m[8],W=this.m[9],X=this.m[10],K=this.m[11],j=this.m[12],ee=this.m[13],$=this.m[14],L=this.m[15],Q=X*L-K*$,J=W*L-K*ee,te=W*$-X*ee,re=H*L-K*j,le=H*$-X*j,ie=H*ee-W*j,ce=G*Q-U*J+z*te,de=-(V*Q-U*re+z*le),_e=V*J-G*re+z*ie,ge=-(V*te-G*le+U*ie),me=1/(y*ce+M*de+C*_e+D*ge),ve=U*L-z*$,be=G*L-z*ee,Te=G*$-U*ee,He=V*L-z*j,De=V*$-U*j,Fe=V*ee-G*j,Qe=U*K-z*X,at=G*K-z*W,Rt=G*X-U*W,Ge=V*K-z*H,Se=V*X-U*H,ze=V*W-G*H;return g.m[0]=ce*me,g.m[4]=de*me,g.m[8]=_e*me,g.m[12]=ge*me,g.m[1]=-(M*Q-C*J+D*te)*me,g.m[5]=(y*Q-C*re+D*le)*me,g.m[9]=-(y*J-M*re+D*ie)*me,g.m[13]=(y*te-M*le+C*ie)*me,g.m[2]=(M*ve-C*be+D*Te)*me,g.m[6]=-(y*ve-C*He+D*De)*me,g.m[10]=(y*be-M*He+D*Fe)*me,g.m[14]=-(y*Te-M*De+C*Fe)*me,g.m[3]=-(M*Qe-C*at+D*Rt)*me,g.m[7]=(y*Qe-C*Ge+D*Se)*me,g.m[11]=-(y*at-M*Ge+D*ze)*me,g.m[15]=(y*Rt-M*Se+C*ze)*me,g._markAsUpdated(),this},E.prototype.setTranslationFromFloats=function(g,y,M){return this.m[12]=g,this.m[13]=y,this.m[14]=M,this._markAsUpdated(),this},E.prototype.setTranslation=function(g){return this.m[12]=g.x,this.m[13]=g.y,this.m[14]=g.z,this._markAsUpdated(),this},E.prototype.getTranslation=function(){return new i(this.m[12],this.m[13],this.m[14])},E.prototype.getTranslationToRef=function(g){return g.x=this.m[12],g.y=this.m[13],g.z=this.m[14],this},E.prototype.removeRotationAndScaling=function(){return this.setRowFromFloats(0,1,0,0,0),this.setRowFromFloats(1,0,1,0,0),this.setRowFromFloats(2,0,0,1,0),this},E.prototype.multiply=function(g){var y=new E;return this.multiplyToRef(g,y),y},E.prototype.copyFrom=function(g){for(var y=0;y<16;y++)this.m[y]=g.m[y];return this._markAsUpdated(),this},E.prototype.copyToArray=function(g,y){y===void 0&&(y=0);for(var M=0;M<16;M++)g[y+M]=this.m[M];return this},E.prototype.multiplyToRef=function(g,y){return this.multiplyToArray(g,y.m,0),y._markAsUpdated(),this},E.prototype.multiplyToArray=function(g,y,M){var C=this.m[0],D=this.m[1],V=this.m[2],G=this.m[3],U=this.m[4],z=this.m[5],H=this.m[6],W=this.m[7],X=this.m[8],K=this.m[9],j=this.m[10],ee=this.m[11],$=this.m[12],L=this.m[13],Q=this.m[14],J=this.m[15],te=g.m[0],re=g.m[1],le=g.m[2],ie=g.m[3],ce=g.m[4],de=g.m[5],_e=g.m[6],ge=g.m[7],me=g.m[8],ve=g.m[9],be=g.m[10],Te=g.m[11],He=g.m[12],De=g.m[13],Fe=g.m[14],Qe=g.m[15];return y[M]=C*te+D*ce+V*me+G*He,y[M+1]=C*re+D*de+V*ve+G*De,y[M+2]=C*le+D*_e+V*be+G*Fe,y[M+3]=C*ie+D*ge+V*Te+G*Qe,y[M+4]=U*te+z*ce+H*me+W*He,y[M+5]=U*re+z*de+H*ve+W*De,y[M+6]=U*le+z*_e+H*be+W*Fe,y[M+7]=U*ie+z*ge+H*Te+W*Qe,y[M+8]=X*te+K*ce+j*me+ee*He,y[M+9]=X*re+K*de+j*ve+ee*De,y[M+10]=X*le+K*_e+j*be+ee*Fe,y[M+11]=X*ie+K*ge+j*Te+ee*Qe,y[M+12]=$*te+L*ce+Q*me+J*He,y[M+13]=$*re+L*de+Q*ve+J*De,y[M+14]=$*le+L*_e+Q*be+J*Fe,y[M+15]=$*ie+L*ge+Q*Te+J*Qe,this},E.prototype.equals=function(g){return g&&this.m[0]===g.m[0]&&this.m[1]===g.m[1]&&this.m[2]===g.m[2]&&this.m[3]===g.m[3]&&this.m[4]===g.m[4]&&this.m[5]===g.m[5]&&this.m[6]===g.m[6]&&this.m[7]===g.m[7]&&this.m[8]===g.m[8]&&this.m[9]===g.m[9]&&this.m[10]===g.m[10]&&this.m[11]===g.m[11]&&this.m[12]===g.m[12]&&this.m[13]===g.m[13]&&this.m[14]===g.m[14]&&this.m[15]===g.m[15]},E.prototype.clone=function(){return E.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},E.prototype.getClassName=function(){return"Matrix"},E.prototype.getHashCode=function(){for(var g=this.m[0]||0,y=1;y<16;y++)g=g*397^(this.m[y]||0);return g},E.prototype.decompose=function(g,y,M){return M&&(M.x=this.m[12],M.y=this.m[13],M.z=this.m[14]),g=g||k.Vector3[0],g.x=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),g.y=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),g.z=Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),this.determinant()<=0&&(g.y*=-1),g.x===0||g.y===0||g.z===0?(y&&(y.x=0,y.y=0,y.z=0,y.w=1),!1):(y&&(E.FromValuesToRef(this.m[0]/g.x,this.m[1]/g.x,this.m[2]/g.x,0,this.m[4]/g.y,this.m[5]/g.y,this.m[6]/g.y,0,this.m[8]/g.z,this.m[9]/g.z,this.m[10]/g.z,0,0,0,0,1,k.Matrix[0]),s.FromRotationMatrixToRef(k.Matrix[0],y)),!0)},E.prototype.getRow=function(g){if(g<0||g>3)return null;var y=g*4;return new a(this.m[y+0],this.m[y+1],this.m[y+2],this.m[y+3])},E.prototype.setRow=function(g,y){if(g<0||g>3)return this;var M=g*4;return this.m[M+0]=y.x,this.m[M+1]=y.y,this.m[M+2]=y.z,this.m[M+3]=y.w,this._markAsUpdated(),this},E.prototype.transpose=function(){return E.Transpose(this)},E.prototype.transposeToRef=function(g){return E.TransposeToRef(this,g),this},E.prototype.setRowFromFloats=function(g,y,M,C,D){if(g<0||g>3)return this;var V=g*4;return this.m[V+0]=y,this.m[V+1]=M,this.m[V+2]=C,this.m[V+3]=D,this._markAsUpdated(),this},E.prototype.scale=function(g){var y=new E;return this.scaleToRef(g,y),y},E.prototype.scaleToRef=function(g,y){for(var M=0;M<16;M++)y.m[M]=this.m[M]*g;return y._markAsUpdated(),this},E.prototype.scaleAndAddToRef=function(g,y){for(var M=0;M<16;M++)y.m[M]+=this.m[M]*g;return y._markAsUpdated(),this},E.prototype.toNormalMatrix=function(g){this.invertToRef(g),g.transpose();var y=g.m;E.FromValuesToRef(y[0],y[1],y[2],0,y[4],y[5],y[6],0,y[8],y[9],y[10],0,0,0,0,1,g)},E.prototype.getRotationMatrix=function(){var g=E.Identity();return this.getRotationMatrixToRef(g),g},E.prototype.getRotationMatrixToRef=function(g){var y=this.m,M=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),C=Math.sqrt(y[4]*y[4]+y[5]*y[5]+y[6]*y[6]),D=Math.sqrt(y[8]*y[8]+y[9]*y[9]+y[10]*y[10]);return this.determinant()<=0&&(C*=-1),M===0||C===0||D===0?E.IdentityToRef(g):E.FromValuesToRef(y[0]/M,y[1]/M,y[2]/M,0,y[4]/C,y[5]/C,y[6]/C,0,y[8]/D,y[9]/D,y[10]/D,0,0,0,0,1,g),this},E.FromArray=function(g,y){var M=new E;return y||(y=0),E.FromArrayToRef(g,y,M),M},E.FromArrayToRef=function(g,y,M){for(var C=0;C<16;C++)M.m[C]=g[C+y];M._markAsUpdated()},E.FromFloat32ArrayToRefScaled=function(g,y,M,C){for(var D=0;D<16;D++)C.m[D]=g[D+y]*M;C._markAsUpdated()},E.FromValuesToRef=function(g,y,M,C,D,V,G,U,z,H,W,X,K,j,ee,$,L){L.m[0]=g,L.m[1]=y,L.m[2]=M,L.m[3]=C,L.m[4]=D,L.m[5]=V,L.m[6]=G,L.m[7]=U,L.m[8]=z,L.m[9]=H,L.m[10]=W,L.m[11]=X,L.m[12]=K,L.m[13]=j,L.m[14]=ee,L.m[15]=$,L._markAsUpdated()},Object.defineProperty(E,"IdentityReadOnly",{get:function(){return E._identityReadOnly},enumerable:!0,configurable:!0}),E.FromValues=function(g,y,M,C,D,V,G,U,z,H,W,X,K,j,ee,$){var L=new E;return L.m[0]=g,L.m[1]=y,L.m[2]=M,L.m[3]=C,L.m[4]=D,L.m[5]=V,L.m[6]=G,L.m[7]=U,L.m[8]=z,L.m[9]=H,L.m[10]=W,L.m[11]=X,L.m[12]=K,L.m[13]=j,L.m[14]=ee,L.m[15]=$,L},E.Compose=function(g,y,M){var C=E.Identity();return E.ComposeToRef(g,y,M,C),C},E.ComposeToRef=function(g,y,M,C){E.FromValuesToRef(g.x,0,0,0,0,g.y,0,0,0,0,g.z,0,0,0,0,1,k.Matrix[1]),y.toRotationMatrix(k.Matrix[0]),k.Matrix[1].multiplyToRef(k.Matrix[0],C),C.setTranslation(M)},E.Identity=function(){return E.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},E.IdentityToRef=function(g){E.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,g)},E.Zero=function(){return E.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},E.RotationX=function(g){var y=new E;return E.RotationXToRef(g,y),y},E.Invert=function(g){var y=new E;return g.invertToRef(y),y},E.RotationXToRef=function(g,y){var M=Math.sin(g),C=Math.cos(g);y.m[0]=1,y.m[15]=1,y.m[5]=C,y.m[10]=C,y.m[9]=-M,y.m[6]=M,y.m[1]=0,y.m[2]=0,y.m[3]=0,y.m[4]=0,y.m[7]=0,y.m[8]=0,y.m[11]=0,y.m[12]=0,y.m[13]=0,y.m[14]=0,y._markAsUpdated()},E.RotationY=function(g){var y=new E;return E.RotationYToRef(g,y),y},E.RotationYToRef=function(g,y){var M=Math.sin(g),C=Math.cos(g);y.m[5]=1,y.m[15]=1,y.m[0]=C,y.m[2]=-M,y.m[8]=M,y.m[10]=C,y.m[1]=0,y.m[3]=0,y.m[4]=0,y.m[6]=0,y.m[7]=0,y.m[9]=0,y.m[11]=0,y.m[12]=0,y.m[13]=0,y.m[14]=0,y._markAsUpdated()},E.RotationZ=function(g){var y=new E;return E.RotationZToRef(g,y),y},E.RotationZToRef=function(g,y){var M=Math.sin(g),C=Math.cos(g);y.m[10]=1,y.m[15]=1,y.m[0]=C,y.m[1]=M,y.m[4]=-M,y.m[5]=C,y.m[2]=0,y.m[3]=0,y.m[6]=0,y.m[7]=0,y.m[8]=0,y.m[9]=0,y.m[11]=0,y.m[12]=0,y.m[13]=0,y.m[14]=0,y._markAsUpdated()},E.RotationAxis=function(g,y){var M=E.Zero();return E.RotationAxisToRef(g,y,M),M},E.RotationAxisToRef=function(g,y,M){var C=Math.sin(-y),D=Math.cos(-y),V=1-D;g.normalize(),M.m[0]=g.x*g.x*V+D,M.m[1]=g.x*g.y*V-g.z*C,M.m[2]=g.x*g.z*V+g.y*C,M.m[3]=0,M.m[4]=g.y*g.x*V+g.z*C,M.m[5]=g.y*g.y*V+D,M.m[6]=g.y*g.z*V-g.x*C,M.m[7]=0,M.m[8]=g.z*g.x*V-g.y*C,M.m[9]=g.z*g.y*V+g.x*C,M.m[10]=g.z*g.z*V+D,M.m[11]=0,M.m[15]=1,M._markAsUpdated()},E.RotationYawPitchRoll=function(g,y,M){var C=new E;return E.RotationYawPitchRollToRef(g,y,M,C),C},E.RotationYawPitchRollToRef=function(g,y,M,C){s.RotationYawPitchRollToRef(g,y,M,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(C)},E.Scaling=function(g,y,M){var C=E.Zero();return E.ScalingToRef(g,y,M,C),C},E.ScalingToRef=function(g,y,M,C){C.m[0]=g,C.m[1]=0,C.m[2]=0,C.m[3]=0,C.m[4]=0,C.m[5]=y,C.m[6]=0,C.m[7]=0,C.m[8]=0,C.m[9]=0,C.m[10]=M,C.m[11]=0,C.m[12]=0,C.m[13]=0,C.m[14]=0,C.m[15]=1,C._markAsUpdated()},E.Translation=function(g,y,M){var C=E.Identity();return E.TranslationToRef(g,y,M,C),C},E.TranslationToRef=function(g,y,M,C){E.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,g,y,M,1,C)},E.Lerp=function(g,y,M){var C=E.Zero();return E.LerpToRef(g,y,M,C),C},E.LerpToRef=function(g,y,M,C){for(var D=0;D<16;D++)C.m[D]=g.m[D]*(1-M)+y.m[D]*M;C._markAsUpdated()},E.DecomposeLerp=function(g,y,M){var C=E.Zero();return E.DecomposeLerpToRef(g,y,M,C),C},E.DecomposeLerpToRef=function(g,y,M,C){var D=k.Vector3[0],V=k.Quaternion[0],G=k.Vector3[1];g.decompose(D,V,G);var U=k.Vector3[2],z=k.Quaternion[1],H=k.Vector3[3];y.decompose(U,z,H);var W=k.Vector3[4];i.LerpToRef(D,U,M,W);var X=k.Quaternion[2];s.SlerpToRef(V,z,M,X);var K=k.Vector3[5];i.LerpToRef(G,H,M,K),E.ComposeToRef(W,X,K,C)},E.LookAtLH=function(g,y,M){var C=E.Zero();return E.LookAtLHToRef(g,y,M,C),C},E.LookAtLHToRef=function(g,y,M,C){y.subtractToRef(g,this._zAxis),this._zAxis.normalize(),i.CrossToRef(M,this._zAxis,this._xAxis),this._xAxis.lengthSquared()===0?this._xAxis.x=1:this._xAxis.normalize(),i.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var D=-i.Dot(this._xAxis,g),V=-i.Dot(this._yAxis,g),G=-i.Dot(this._zAxis,g);return E.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,D,V,G,1,C)},E.LookAtRH=function(g,y,M){var C=E.Zero();return E.LookAtRHToRef(g,y,M,C),C},E.LookAtRHToRef=function(g,y,M,C){g.subtractToRef(y,this._zAxis),this._zAxis.normalize(),i.CrossToRef(M,this._zAxis,this._xAxis),this._xAxis.lengthSquared()===0?this._xAxis.x=1:this._xAxis.normalize(),i.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var D=-i.Dot(this._xAxis,g),V=-i.Dot(this._yAxis,g),G=-i.Dot(this._zAxis,g);return E.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,D,V,G,1,C)},E.OrthoLH=function(g,y,M,C){var D=E.Zero();return E.OrthoLHToRef(g,y,M,C,D),D},E.OrthoLHToRef=function(g,y,M,C,D){var V=M,G=C,U=2/g,z=2/y,H=2/(G-V),W=-(G+V)/(G-V);E.FromValuesToRef(U,0,0,0,0,z,0,0,0,0,H,0,0,0,W,1,D)},E.OrthoOffCenterLH=function(g,y,M,C,D,V){var G=E.Zero();return E.OrthoOffCenterLHToRef(g,y,M,C,D,V,G),G},E.OrthoOffCenterLHToRef=function(g,y,M,C,D,V,G){var U=D,z=V,H=2/(y-g),W=2/(C-M),X=2/(z-U),K=-(z+U)/(z-U),j=(g+y)/(g-y),ee=(C+M)/(M-C);E.FromValuesToRef(H,0,0,0,0,W,0,0,0,0,X,0,j,ee,K,1,G)},E.OrthoOffCenterRH=function(g,y,M,C,D,V){var G=E.Zero();return E.OrthoOffCenterRHToRef(g,y,M,C,D,V,G),G},E.OrthoOffCenterRHToRef=function(g,y,M,C,D,V,G){E.OrthoOffCenterLHToRef(g,y,M,C,D,V,G),G.m[10]*=-1},E.PerspectiveLH=function(g,y,M,C){var D=E.Zero(),V=M,G=C,U=2*V/g,z=2*V/y,H=(G+V)/(G-V),W=-2*G*V/(G-V);return E.FromValuesToRef(U,0,0,0,0,z,0,0,0,0,H,1,0,0,W,0,D),D},E.PerspectiveFovLH=function(g,y,M,C){var D=E.Zero();return E.PerspectiveFovLHToRef(g,y,M,C,D),D},E.PerspectiveFovLHToRef=function(g,y,M,C,D,V){V===void 0&&(V=!0);var G=M,U=C,z=1/Math.tan(g*.5),H=V?z/y:z,W=V?z:z*y,X=(U+G)/(U-G),K=-2*U*G/(U-G);E.FromValuesToRef(H,0,0,0,0,W,0,0,0,0,X,1,0,0,K,0,D)},E.PerspectiveFovRH=function(g,y,M,C){var D=E.Zero();return E.PerspectiveFovRHToRef(g,y,M,C,D),D},E.PerspectiveFovRHToRef=function(g,y,M,C,D,V){V===void 0&&(V=!0);var G=M,U=C,z=1/Math.tan(g*.5),H=V?z/y:z,W=V?z:z*y,X=-(U+G)/(U-G),K=-2*U*G/(U-G);E.FromValuesToRef(H,0,0,0,0,W,0,0,0,0,X,-1,0,0,K,0,D)},E.PerspectiveFovWebVRToRef=function(g,y,M,C,D){D===void 0&&(D=!1);var V=D?-1:1,G=Math.tan(g.upDegrees*Math.PI/180),U=Math.tan(g.downDegrees*Math.PI/180),z=Math.tan(g.leftDegrees*Math.PI/180),H=Math.tan(g.rightDegrees*Math.PI/180),W=2/(z+H),X=2/(G+U);C.m[0]=W,C.m[1]=C.m[2]=C.m[3]=C.m[4]=0,C.m[5]=X,C.m[6]=C.m[7]=0,C.m[8]=(z-H)*W*.5,C.m[9]=-((G-U)*X*.5),C.m[10]=-M/(y-M),C.m[11]=1*V,C.m[12]=C.m[13]=C.m[15]=0,C.m[14]=-(2*M*y)/(M-y),C._markAsUpdated()},E.GetFinalMatrix=function(g,y,M,C,D,V){var G=g.width,U=g.height,z=g.x,H=g.y,W=E.FromValues(G/2,0,0,0,0,-U/2,0,0,0,0,V-D,0,z+G/2,U/2+H,D,1);return y.multiply(M).multiply(C).multiply(W)},E.GetAsMatrix2x2=function(g){return new Float32Array([g.m[0],g.m[1],g.m[4],g.m[5]])},E.GetAsMatrix3x3=function(g){return new Float32Array([g.m[0],g.m[1],g.m[2],g.m[4],g.m[5],g.m[6],g.m[8],g.m[9],g.m[10]])},E.Transpose=function(g){var y=new E;return E.TransposeToRef(g,y),y},E.TransposeToRef=function(g,y){y.m[0]=g.m[0],y.m[1]=g.m[4],y.m[2]=g.m[8],y.m[3]=g.m[12],y.m[4]=g.m[1],y.m[5]=g.m[5],y.m[6]=g.m[9],y.m[7]=g.m[13],y.m[8]=g.m[2],y.m[9]=g.m[6],y.m[10]=g.m[10],y.m[11]=g.m[14],y.m[12]=g.m[3],y.m[13]=g.m[7],y.m[14]=g.m[11],y.m[15]=g.m[15]},E.Reflection=function(g){var y=new E;return E.ReflectionToRef(g,y),y},E.ReflectionToRef=function(g,y){g.normalize();var M=g.normal.x,C=g.normal.y,D=g.normal.z,V=-2*M,G=-2*C,U=-2*D;y.m[0]=V*M+1,y.m[1]=G*M,y.m[2]=U*M,y.m[3]=0,y.m[4]=V*C,y.m[5]=G*C+1,y.m[6]=U*C,y.m[7]=0,y.m[8]=V*D,y.m[9]=G*D,y.m[10]=U*D+1,y.m[11]=0,y.m[12]=V*g.d,y.m[13]=G*g.d,y.m[14]=U*g.d,y.m[15]=1,y._markAsUpdated()},E.FromXYZAxesToRef=function(g,y,M,C){C.m[0]=g.x,C.m[1]=g.y,C.m[2]=g.z,C.m[3]=0,C.m[4]=y.x,C.m[5]=y.y,C.m[6]=y.z,C.m[7]=0,C.m[8]=M.x,C.m[9]=M.y,C.m[10]=M.z,C.m[11]=0,C.m[12]=0,C.m[13]=0,C.m[14]=0,C.m[15]=1,C._markAsUpdated()},E.FromQuaternionToRef=function(g,y){var M=g.x*g.x,C=g.y*g.y,D=g.z*g.z,V=g.x*g.y,G=g.z*g.w,U=g.z*g.x,z=g.y*g.w,H=g.y*g.z,W=g.x*g.w;y.m[0]=1-2*(C+D),y.m[1]=2*(V+G),y.m[2]=2*(U-z),y.m[3]=0,y.m[4]=2*(V-G),y.m[5]=1-2*(D+M),y.m[6]=2*(H+W),y.m[7]=0,y.m[8]=2*(U+z),y.m[9]=2*(H-W),y.m[10]=1-2*(C+M),y.m[11]=0,y.m[12]=0,y.m[13]=0,y.m[14]=0,y.m[15]=1,y._markAsUpdated()},E._tempQuaternion=new s,E._xAxis=i.Zero(),E._yAxis=i.Zero(),E._zAxis=i.Zero(),E._updateFlagSeed=0,E._identityReadOnly=E.Identity(),E}();t.Matrix=o;var l=function(){function E(g,y,M,C){this.normal=new i(g,y,M),this.d=C}return E.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},E.prototype.clone=function(){return new E(this.normal.x,this.normal.y,this.normal.z,this.d)},E.prototype.getClassName=function(){return"Plane"},E.prototype.getHashCode=function(){var g=this.normal.getHashCode();return g=g*397^(this.d||0),g},E.prototype.normalize=function(){var g=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),y=0;return g!==0&&(y=1/g),this.normal.x*=y,this.normal.y*=y,this.normal.z*=y,this.d*=y,this},E.prototype.transform=function(g){var y=o.Transpose(g),M=this.normal.x,C=this.normal.y,D=this.normal.z,V=this.d,G=M*y.m[0]+C*y.m[1]+D*y.m[2]+V*y.m[3],U=M*y.m[4]+C*y.m[5]+D*y.m[6]+V*y.m[7],z=M*y.m[8]+C*y.m[9]+D*y.m[10]+V*y.m[11],H=M*y.m[12]+C*y.m[13]+D*y.m[14]+V*y.m[15];return new E(G,U,z,H)},E.prototype.dotCoordinate=function(g){return this.normal.x*g.x+this.normal.y*g.y+this.normal.z*g.z+this.d},E.prototype.copyFromPoints=function(g,y,M){var C=y.x-g.x,D=y.y-g.y,V=y.z-g.z,G=M.x-g.x,U=M.y-g.y,z=M.z-g.z,H=D*z-V*U,W=V*G-C*z,X=C*U-D*G,K=Math.sqrt(H*H+W*W+X*X),j;return K!==0?j=1/K:j=0,this.normal.x=H*j,this.normal.y=W*j,this.normal.z=X*j,this.d=-(this.normal.x*g.x+this.normal.y*g.y+this.normal.z*g.z),this},E.prototype.isFrontFacingTo=function(g,y){var M=i.Dot(this.normal,g);return M<=y},E.prototype.signedDistanceTo=function(g){return i.Dot(g,this.normal)+this.d},E.FromArray=function(g){return new E(g[0],g[1],g[2],g[3])},E.FromPoints=function(g,y,M){var C=new E(0,0,0,0);return C.copyFromPoints(g,y,M),C},E.FromPositionAndNormal=function(g,y){var M=new E(0,0,0,0);return y.normalize(),M.normal=y,M.d=-(y.x*g.x+y.y*g.y+y.z*g.z),M},E.SignedDistanceToPlaneFromPositionAndNormal=function(g,y,M){var C=-(y.x*g.x+y.y*g.y+y.z*g.z);return i.Dot(M,y)+C},E}();t.Plane=l;var u=function(){function E(g,y,M,C){this.x=g,this.y=y,this.width=M,this.height=C}return E.prototype.toGlobal=function(g,y){if(g.getRenderWidth){var M=g;return this.toGlobal(M.getRenderWidth(),M.getRenderHeight())}var C=g;return new E(this.x*C,this.y*y,this.width*C,this.height*y)},E.prototype.clone=function(){return new E(this.x,this.y,this.width,this.height)},E}();t.Viewport=u;var h=function(){function E(){}return E.GetPlanes=function(g){for(var y=[],M=0;M<6;M++)y.push(new l(0,0,0,0));return E.GetPlanesToRef(g,y),y},E.GetNearPlaneToRef=function(g,y){y.normal.x=g.m[3]+g.m[2],y.normal.y=g.m[7]+g.m[6],y.normal.z=g.m[11]+g.m[10],y.d=g.m[15]+g.m[14],y.normalize()},E.GetFarPlaneToRef=function(g,y){y.normal.x=g.m[3]-g.m[2],y.normal.y=g.m[7]-g.m[6],y.normal.z=g.m[11]-g.m[10],y.d=g.m[15]-g.m[14],y.normalize()},E.GetLeftPlaneToRef=function(g,y){y.normal.x=g.m[3]+g.m[0],y.normal.y=g.m[7]+g.m[4],y.normal.z=g.m[11]+g.m[8],y.d=g.m[15]+g.m[12],y.normalize()},E.GetRightPlaneToRef=function(g,y){y.normal.x=g.m[3]-g.m[0],y.normal.y=g.m[7]-g.m[4],y.normal.z=g.m[11]-g.m[8],y.d=g.m[15]-g.m[12],y.normalize()},E.GetTopPlaneToRef=function(g,y){y.normal.x=g.m[3]-g.m[1],y.normal.y=g.m[7]-g.m[5],y.normal.z=g.m[11]-g.m[9],y.d=g.m[15]-g.m[13],y.normalize()},E.GetBottomPlaneToRef=function(g,y){y.normal.x=g.m[3]+g.m[1],y.normal.y=g.m[7]+g.m[5],y.normal.z=g.m[11]+g.m[9],y.d=g.m[15]+g.m[13],y.normalize()},E.GetPlanesToRef=function(g,y){E.GetNearPlaneToRef(g,y[0]),E.GetFarPlaneToRef(g,y[1]),E.GetLeftPlaneToRef(g,y[2]),E.GetRightPlaneToRef(g,y[3]),E.GetTopPlaneToRef(g,y[4]),E.GetBottomPlaneToRef(g,y[5])},E}();t.Frustum=h;var d;(function(E){E[E.LOCAL=0]="LOCAL",E[E.WORLD=1]="WORLD",E[E.BONE=2]="BONE"})(d=t.Space||(t.Space={}));var p=function(){function E(){}return E.X=new i(1,0,0),E.Y=new i(0,1,0),E.Z=new i(0,0,1),E}();t.Axis=p;var m=function(){function E(){}return E.Interpolate=function(g,y,M,C,D){for(var V=1-3*C+3*y,G=3*C-6*y,U=3*y,z=g,H=0;H<5;H++){var W=z*z,X=W*z,K=V*X+G*W+U*z,j=1/(3*V*W+2*G*z+U);z-=(K-g)*j,z=Math.min(1,Math.max(0,z))}return 3*Math.pow(1-z,2)*z*M+3*(1-z)*Math.pow(z,2)*D+Math.pow(z,3)},E}();t.BezierCurve=m;var _;(function(E){E[E.CW=0]="CW",E[E.CCW=1]="CCW"})(_=t.Orientation||(t.Orientation={}));var v=function(){function E(g){this._radians=g,this._radians<0&&(this._radians+=2*Math.PI)}return E.prototype.degrees=function(){return this._radians*180/Math.PI},E.prototype.radians=function(){return this._radians},E.BetweenTwoPoints=function(g,y){var M=y.subtract(g),C=Math.atan2(M.y,M.x);return new E(C)},E.FromRadians=function(g){return new E(g)},E.FromDegrees=function(g){return new E(g*Math.PI/180)},E}();t.Angle=v;var S=function(){function E(g,y,M){this.startPoint=g,this.midPoint=y,this.endPoint=M;var C=Math.pow(y.x,2)+Math.pow(y.y,2),D=(Math.pow(g.x,2)+Math.pow(g.y,2)-C)/2,V=(C-Math.pow(M.x,2)-Math.pow(M.y,2))/2,G=(g.x-y.x)*(y.y-M.y)-(y.x-M.x)*(g.y-y.y);this.centerPoint=new r((D*(y.y-M.y)-V*(g.y-y.y))/G,((g.x-y.x)*V-(y.x-M.x)*D)/G),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=v.BetweenTwoPoints(this.centerPoint,this.startPoint);var U=this.startAngle.degrees(),z=v.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),H=v.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();z-U>180&&(z-=360),z-U<-180&&(z+=360),H-z>180&&(H-=360),H-z<-180&&(H+=360),this.orientation=z-U<0?_.CW:_.CCW,this.angle=v.FromDegrees(this.orientation===_.CW?U-H:H-U)}return E}();t.Arc2=S;var P=function(){function E(g,y){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(g,y))}return E.prototype.addLineTo=function(g,y){if(this.closed)return this;var M=new r(g,y),C=this._points[this._points.length-1];return this._points.push(M),this._length+=M.subtract(C).length(),this},E.prototype.addArcTo=function(g,y,M,C,D){if(D===void 0&&(D=36),this.closed)return this;var V=this._points[this._points.length-1],G=new r(g,y),U=new r(M,C),z=new S(V,G,U),H=z.angle.radians()/D;z.orientation===_.CW&&(H*=-1);for(var W=z.startAngle.radians()+H,X=0;X<D;X++){var K=Math.cos(W)*z.radius+z.centerPoint.x,j=Math.sin(W)*z.radius+z.centerPoint.y;this.addLineTo(K,j),W+=H}return this},E.prototype.close=function(){return this.closed=!0,this},E.prototype.length=function(){var g=this._length;if(!this.closed){var y=this._points[this._points.length-1],M=this._points[0];g+=M.subtract(y).length()}return g},E.prototype.getPoints=function(){return this._points},E.prototype.getPointAtLengthPosition=function(g){if(g<0||g>1)return r.Zero();for(var y=g*this.length(),M=0,C=0;C<this._points.length;C++){var D=(C+1)%this._points.length,V=this._points[C],G=this._points[D],U=G.subtract(V),z=U.length()+M;if(y>=M&&y<=z){var H=U.normalize(),W=y-M;return new r(V.x+H.x*W,V.y+H.y*W)}M=z}return r.Zero()},E.StartingAt=function(g,y){return new E(g,y)},E}();t.Path2=P;var x=function(){function E(g,y,M){y===void 0&&(y=null),this.path=g,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var C=0;C<g.length;C++)this._curve[C]=g[C].clone();this._raw=M||!1,this._compute(y)}return E.prototype.getCurve=function(){return this._curve},E.prototype.getTangents=function(){return this._tangents},E.prototype.getNormals=function(){return this._normals},E.prototype.getBinormals=function(){return this._binormals},E.prototype.getDistances=function(){return this._distances},E.prototype.update=function(g,y){y===void 0&&(y=null);for(var M=0;M<g.length;M++)this._curve[M].x=g[M].x,this._curve[M].y=g[M].y,this._curve[M].z=g[M].z;return this._compute(y),this},E.prototype._compute=function(g){var y=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[y-1]=this._curve[y-1].subtract(this._curve[y-2]),this._raw||this._tangents[y-1].normalize();var M=this._tangents[0],C=this._normalVector(this._curve[0],M,g);this._normals[0]=C,this._raw||this._normals[0].normalize(),this._binormals[0]=i.Cross(M,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var D,V,G,U,z=1;z<y;z++)D=this._getLastNonNullVector(z),z<y-1&&(V=this._getFirstNonNullVector(z),this._tangents[z]=D.add(V),this._tangents[z].normalize()),this._distances[z]=this._distances[z-1]+D.length(),G=this._tangents[z],U=this._binormals[z-1],this._normals[z]=i.Cross(U,G),this._raw||this._normals[z].normalize(),this._binormals[z]=i.Cross(G,this._normals[z]),this._raw||this._binormals[z].normalize()},E.prototype._getFirstNonNullVector=function(g){for(var y=1,M=this._curve[g+y].subtract(this._curve[g]);M.length()===0&&g+y+1<this._curve.length;)y++,M=this._curve[g+y].subtract(this._curve[g]);return M},E.prototype._getLastNonNullVector=function(g){for(var y=1,M=this._curve[g].subtract(this._curve[g-y]);M.length()===0&&g>y+1;)y++,M=this._curve[g].subtract(this._curve[g-y]);return M},E.prototype._normalVector=function(g,y,M){var C,D=y.length();if(D===0&&(D=1),M==null){var V;t.Scalar.WithinEpsilon(Math.abs(y.y)/D,1,t.Epsilon)?t.Scalar.WithinEpsilon(Math.abs(y.x)/D,1,t.Epsilon)?t.Scalar.WithinEpsilon(Math.abs(y.z)/D,1,t.Epsilon)?V=i.Zero():V=new i(0,0,1):V=new i(1,0,0):V=new i(0,-1,0),C=i.Cross(y,V)}else C=i.Cross(y,M),i.CrossToRef(C,y,C);return C.normalize(),C},E}();t.Path3D=x;var R=function(){function E(g){this._length=0,this._points=g,this._length=this._computeLength(g)}return E.CreateQuadraticBezier=function(g,y,M,C){C=C>2?C:3;for(var D=new Array,V=function(U,z,H,W){var X=(1-U)*(1-U)*z+2*U*(1-U)*H+U*U*W;return X},G=0;G<=C;G++)D.push(new i(V(G/C,g.x,y.x,M.x),V(G/C,g.y,y.y,M.y),V(G/C,g.z,y.z,M.z)));return new E(D)},E.CreateCubicBezier=function(g,y,M,C,D){D=D>3?D:4;for(var V=new Array,G=function(z,H,W,X,K){var j=(1-z)*(1-z)*(1-z)*H+3*z*(1-z)*(1-z)*W+3*z*z*(1-z)*X+z*z*z*K;return j},U=0;U<=D;U++)V.push(new i(G(U/D,g.x,y.x,M.x,C.x),G(U/D,g.y,y.y,M.y,C.y),G(U/D,g.z,y.z,M.z,C.z)));return new E(V)},E.CreateHermiteSpline=function(g,y,M,C,D){for(var V=new Array,G=1/D,U=0;U<=D;U++)V.push(i.Hermite(g,y,M,C,U*G));return new E(V)},E.CreateCatmullRomSpline=function(g,y,M){var C=new Array,D=1/y,V=0;if(M){for(var G=g.length,U=0;U<G;U++){V=0;for(var z=0;z<y;z++)C.push(i.CatmullRom(g[U%G],g[(U+1)%G],g[(U+2)%G],g[(U+3)%G],V)),V+=D}C.push(C[0])}else{var H=new Array;H.push(g[0].clone()),Array.prototype.push.apply(H,g),H.push(g[g.length-1].clone());for(var U=0;U<H.length-3;U++){V=0;for(var z=0;z<y;z++)C.push(i.CatmullRom(H[U],H[U+1],H[U+2],H[U+3],V)),V+=D}U--,C.push(i.CatmullRom(H[U],H[U+1],H[U+2],H[U+3],V))}return new E(C)},E.prototype.getPoints=function(){return this._points},E.prototype.length=function(){return this._length},E.prototype.continue=function(g){for(var y=this._points[this._points.length-1],M=this._points.slice(),C=g.getPoints(),D=1;D<C.length;D++)M.push(C[D].subtract(C[0]).add(y));var V=new E(M);return V},E.prototype._computeLength=function(g){for(var y=0,M=1;M<g.length;M++)y+=g[M].subtract(g[M-1]).length();return y},E}();t.Curve3=R;var w=function(){function E(g,y){g===void 0&&(g=i.Zero()),y===void 0&&(y=i.Up()),this.position=g,this.normal=y}return E.prototype.clone=function(){return new E(this.position.clone(),this.normal.clone())},E}();t.PositionNormalVertex=w;var I=function(){function E(g,y,M){g===void 0&&(g=i.Zero()),y===void 0&&(y=i.Up()),M===void 0&&(M=r.Zero()),this.position=g,this.normal=y,this.uv=M}return E.prototype.clone=function(){return new E(this.position.clone(),this.normal.clone(),this.uv.clone())},E}();t.PositionNormalTextureVertex=I;var F=function(){function E(){}return E.Color3=[f.Black(),f.Black(),f.Black()],E.Color4=[new c(0,0,0,0),new c(0,0,0,0)],E.Vector2=[r.Zero(),r.Zero(),r.Zero()],E.Vector3=[i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero()],E.Vector4=[a.Zero(),a.Zero(),a.Zero()],E.Quaternion=[s.Zero(),s.Zero()],E.Matrix=[o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero()],E}();t.Tmp=F;var k=function(){function E(){}return E.Vector3=[i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero(),i.Zero()],E.Matrix=[o.Zero(),o.Zero()],E.Quaternion=[s.Zero(),s.Zero(),s.Zero()],E}()})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.WithinEpsilon=function(r,i,a){a===void 0&&(a=1401298e-51);var n=r-i;return-a<=n&&n<=a},c.ToHex=function(r){var i=r.toString(16);return r<=15?("0"+i).toUpperCase():i.toUpperCase()},c.Sign=function(r){return r=+r,r===0||isNaN(r)?r:r>0?1:-1},c.Clamp=function(r,i,a){return i===void 0&&(i=0),a===void 0&&(a=1),Math.min(a,Math.max(i,r))},c.Log2=function(r){return Math.log(r)*Math.LOG2E},c.Repeat=function(r,i){return r-Math.floor(r/i)*i},c.Normalize=function(r,i,a){return(r-i)/(a-i)},c.Denormalize=function(r,i,a){return r*(a-i)+i},c.DeltaAngle=function(r,i){var a=c.Repeat(i-r,360);return a>180&&(a-=360),a},c.PingPong=function(r,i){var a=c.Repeat(r,i*2);return i-Math.abs(a-i)},c.SmoothStep=function(r,i,a){var n=c.Clamp(a);return n=-2*n*n*n+3*n*n,i*n+r*(1-n)},c.MoveTowards=function(r,i,a){var n=0;return Math.abs(i-r)<=a?n=i:n=r+c.Sign(i-r)*a,n},c.MoveTowardsAngle=function(r,i,a){var n=c.DeltaAngle(r,i),s=0;return-a<n&&n<a?s=i:(i=r+n,s=c.MoveTowards(r,i,a)),s},c.Lerp=function(r,i,a){return r+(i-r)*a},c.LerpAngle=function(r,i,a){var n=c.Repeat(i-r,360);return n>180&&(n-=360),r+n*c.Clamp(a)},c.InverseLerp=function(r,i,a){var n=0;return r!=i?n=c.Clamp((a-r)/(i-r)):n=0,n},c.Hermite=function(r,i,a,n,s){var o=s*s,l=s*o,u=2*l-3*o+1,h=-2*l+3*o,d=l-2*o+s,p=l-o;return r*u+a*h+i*d+n*p},c.RandomRange=function(r,i){return r===i?r:Math.random()*(i-r)+r},c.RangeToPercent=function(r,i,a){return(r-i)/(a-i)},c.PercentToRange=function(r,i,a){return(a-i)*r+i},c.NormalizeRadians=function(r){return r-=c.TwoPi*Math.floor((r+Math.PI)/c.TwoPi),r},c.TwoPi=Math.PI*2,c}();t.Scalar=f})(T||(T={}));var T;(function(t){var f={},c={},r=function(I,F,k){var E=I();t.Tags&&t.Tags.AddTagsTo(E,F.tags);var g=a(E);for(var y in g){var M=g[y],C=F[y],D=M.type;if(C!=null)switch(D){case 0:case 6:case 11:E[y]=C;break;case 1:E[y]=k||C.isRenderTarget?C:C.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:E[y]=k?C:C.clone();break}}return E};function i(I){var F=I.getClassName();return f[F]||(f[F]={}),f[F]}function a(I){var F=I.getClassName();if(c[F])return c[F];c[F]={};for(var k=c[F],E=I,g=F;g;){var y=f[g];for(var M in y)k[M]=y[M];var C=void 0,D=!1;do{if(C=Object.getPrototypeOf(E),!C.getClassName){D=!0;break}if(C.getClassName()!==g)break;E=C}while(C);if(D)break;g=C.getClassName(),E=C}return k}function n(I,F){return function(k,E){var g=i(k);g[E]||(g[E]={type:I,sourceName:F})}}function s(I,F){return F===void 0&&(F=null),function(k,E){var g=F||"_"+E;Object.defineProperty(k,E,{get:function(){return this[g]},set:function(y){this[g]!==y&&(this[g]=y,k[I].apply(this))},enumerable:!0,configurable:!0})}}function o(I,F){return F===void 0&&(F=null),s(I,F)}t.expandToProperty=o;function l(I){return n(0,I)}t.serialize=l;function u(I){return n(1,I)}t.serializeAsTexture=u;function h(I){return n(2,I)}t.serializeAsColor3=h;function d(I){return n(3,I)}t.serializeAsFresnelParameters=d;function p(I){return n(4,I)}t.serializeAsVector2=p;function m(I){return n(5,I)}t.serializeAsVector3=m;function _(I){return n(6,I)}t.serializeAsMeshReference=_;function v(I){return n(7,I)}t.serializeAsColorCurves=v;function S(I){return n(8,I)}t.serializeAsColor4=S;function P(I){return n(9,I)}t.serializeAsImageProcessingConfiguration=P;function x(I){return n(10,I)}t.serializeAsQuaternion=x;function R(I){return n(11,I)}t.serializeAsCameraReference=R;var w=function(){function I(){}return I.Serialize=function(F,k){k||(k={}),t.Tags&&(k.tags=t.Tags.GetTags(F));var E=a(F);for(var g in E){var y=E[g],M=y.sourceName||g,C=y.type,D=F[g];if(D!=null)switch(C){case 0:k[M]=D;break;case 1:k[M]=D.serialize();break;case 2:k[M]=D.asArray();break;case 3:k[M]=D.serialize();break;case 4:k[M]=D.asArray();break;case 5:k[M]=D.asArray();break;case 6:k[M]=D.id;break;case 7:k[M]=D.serialize();break;case 8:k[M]=D.asArray();break;case 9:k[M]=D.serialize();break;case 10:k[M]=D.asArray();break;case 11:k[M]=D.id;break}}return k},I.Parse=function(F,k,E,g){g===void 0&&(g=null);var y=F();g||(g=""),t.Tags&&t.Tags.AddTagsTo(y,k.tags);var M=a(y);for(var C in M){var D=M[C],V=k[D.sourceName||C],G=D.type;if(V!=null){var U=y;switch(G){case 0:U[C]=V;break;case 1:E&&(U[C]=t.Texture.Parse(V,E,g));break;case 2:U[C]=t.Color3.FromArray(V);break;case 3:U[C]=t.FresnelParameters.Parse(V);break;case 4:U[C]=t.Vector2.FromArray(V);break;case 5:U[C]=t.Vector3.FromArray(V);break;case 6:E&&(U[C]=E.getLastMeshByID(V));break;case 7:U[C]=t.ColorCurves.Parse(V);break;case 8:U[C]=t.Color4.FromArray(V);break;case 9:U[C]=t.ImageProcessingConfiguration.Parse(V);break;case 10:U[C]=t.Quaternion.FromArray(V);break;case 11:E&&(U[C]=E.getCameraByID(V));break}}}return y},I.Clone=function(F,k){return r(F,k,!1)},I.Instanciate=function(F,k){return r(F,k,!0)},I}();t.SerializationHelper=w})(T||(T={}));var T;(function(t){var f=function(){function c(){var r=this;this.promise=new Promise(function(i,a){r._resolve=i,r._reject=a})}return Object.defineProperty(c.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),c}();t.Deferred=f})(T||(T={}));var T;(function(t){var f=function(){function a(n,s,o,l){s===void 0&&(s=!1),this.initalize(n,s,o,l)}return a.prototype.initalize=function(n,s,o,l){return s===void 0&&(s=!1),this.mask=n,this.skipNextObservers=s,this.target=o,this.currentTarget=l,this},a}();t.EventState=f;var c=function(){function a(n,s,o){o===void 0&&(o=null),this.callback=n,this.mask=s,this.scope=o,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}return a}();t.Observer=c;var r=function(){function a(){}return a.prototype.dispose=function(){if(this._observers&&this._observables)for(var n=0;n<this._observers.length;n++)this._observables[n].remove(this._observers[n]);this._observers=null,this._observables=null},a.Watch=function(n,s,o,l){o===void 0&&(o=-1),l===void 0&&(l=null);var u=new a;u._observers=new Array,u._observables=n;for(var h=0,d=n;h<d.length;h++){var p=d[h],m=p.add(s,o,!1,l);m&&u._observers.push(m)}return u},a}();t.MultiObserver=r;var i=function(){function a(n){this._observers=new Array,this._eventState=new f(0),n&&(this._onObserverAdded=n)}return a.prototype.add=function(n,s,o,l,u){if(s===void 0&&(s=-1),o===void 0&&(o=!1),l===void 0&&(l=null),u===void 0&&(u=!1),!n)return null;var h=new c(n,s,l);return h.unregisterOnNextCall=u,o?this._observers.unshift(h):this._observers.push(h),this._onObserverAdded&&this._onObserverAdded(h),h},a.prototype.addOnce=function(n){return this.add(n,void 0,void 0,void 0,!0)},a.prototype.remove=function(n){if(!n)return!1;var s=this._observers.indexOf(n);return s!==-1?(this._deferUnregister(n),!0):!1},a.prototype.removeCallback=function(n,s){for(var o=0;o<this._observers.length;o++)if(this._observers[o].callback===n&&(!s||s===this._observers[o].scope))return this._deferUnregister(this._observers[o]),!0;return!1},a.prototype._deferUnregister=function(n){var s=this;n.unregisterOnNextCall=!1,n._willBeUnregistered=!0,t.Tools.SetImmediate(function(){s._remove(n)})},a.prototype._remove=function(n){if(!n)return!1;var s=this._observers.indexOf(n);return s!==-1?(this._observers.splice(s,1),!0):!1},a.prototype.notifyObservers=function(n,s,o,l){if(s===void 0&&(s=-1),!this._observers.length)return!0;var u=this._eventState;u.mask=s,u.target=o,u.currentTarget=l,u.skipNextObservers=!1,u.lastReturnValue=n;for(var h=0,d=this._observers;h<d.length;h++){var p=d[h];if(!p._willBeUnregistered&&(p.mask&s&&(p.scope?u.lastReturnValue=p.callback.apply(p.scope,[n,u]):u.lastReturnValue=p.callback(n,u),p.unregisterOnNextCall&&this._deferUnregister(p)),u.skipNextObservers))return!1}return!0},a.prototype.notifyObserversWithPromise=function(n,s,o,l){var u=this;s===void 0&&(s=-1);var h=Promise.resolve(n);if(!this._observers.length)return h;var d=this._eventState;return d.mask=s,d.target=o,d.currentTarget=l,d.skipNextObservers=!1,this._observers.forEach(function(p){d.skipNextObservers||p._willBeUnregistered||p.mask&s&&(p.scope?h=h.then(function(m){return d.lastReturnValue=m,p.callback.apply(p.scope,[n,d])}):h=h.then(function(m){return d.lastReturnValue=m,p.callback(n,d)}),p.unregisterOnNextCall&&u._deferUnregister(p))}),h.then(function(){return n})},a.prototype.notifyObserver=function(n,s,o){o===void 0&&(o=-1);var l=this._eventState;l.mask=o,l.skipNextObservers=!1,n.callback(s,l)},a.prototype.hasObservers=function(){return this._observers.length>0},a.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},a.prototype.clone=function(){var n=new a;return n._observers=this._observers.slice(0),n},a.prototype.hasSpecificMask=function(n){n===void 0&&(n=-1);for(var s=0,o=this._observers;s<o.length;s++){var l=o[s];if(l.mask&n||l.mask===n)return!0}return!1},a}();t.Observable=i})(T||(T={}));var T;(function(t){var f=function(){function r(i){this.length=0,this.data=new Array(i),this._id=r._GlobalId++}return r.prototype.push=function(i){this.data[this.length++]=i,this.length>this.data.length&&(this.data.length*=2)},r.prototype.forEach=function(i){for(var a=0;a<this.length;a++)i(this.data[a])},r.prototype.sort=function(i){this.data.sort(i)},r.prototype.reset=function(){this.length=0},r.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},r.prototype.concat=function(i){if(i.length!==0){this.length+i.length>this.data.length&&(this.data.length=(this.length+i.length)*2);for(var a=0;a<i.length;a++)this.data[this.length++]=(i.data||i)[a]}},r.prototype.indexOf=function(i){var a=this.data.indexOf(i);return a>=this.length?-1:a},r.prototype.contains=function(i){return this.indexOf(i)!==-1},r._GlobalId=0,r}();t.SmartArray=f;var c=function(r){N(i,r);function i(){var a=r!==null&&r.apply(this,arguments)||this;return a._duplicateId=0,a}return i.prototype.push=function(a){r.prototype.push.call(this,a),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId},i.prototype.pushNoDuplicate=function(a){return a.__smartArrayFlags&&a.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(a),!0)},i.prototype.reset=function(){r.prototype.reset.call(this),this._duplicateId++},i.prototype.concatWithNoDuplicate=function(a){if(a.length!==0){this.length+a.length>this.data.length&&(this.data.length=(this.length+a.length)*2);for(var n=0;n<a.length;n++){var s=(a.data||a)[n];this.pushNoDuplicate(s)}}},i}(f);t.SmartArrayNoDuplicate=c})(T||(T={}));var T;(function(t){var f=function(){function d(){}return d.prototype.getColorToRef=function(p){if(!this.color2){p.copyFrom(this.color1);return}t.Color4.LerpToRef(this.color1,this.color2,Math.random(),p)},d}();t.ColorGradient=f;var c=function(){function d(){}return d}();t.Color3Gradient=c;var r=function(){function d(){}return d.prototype.getFactor=function(){return this.factor2===void 0?this.factor1:t.Scalar.Lerp(this.factor1,this.factor2,Math.random())},d}();t.FactorGradient=r;var i=function(d){N(p,d);function p(m,_){var v=d.call(this,m)||this;return v.request=_,v.name="LoadFileError",p._setPrototypeOf(v,p.prototype),v}return p._setPrototypeOf=Object.setPrototypeOf||function(m,_){return m.__proto__=_,m},p}(Error);t.LoadFileError=i;var a=function(){function d(){}return d.ExponentialBackoff=function(p,m){return p===void 0&&(p=3),m===void 0&&(m=500),function(_,v,S){return v.status!==0||S>=p||_.indexOf("file:")!==-1?-1:Math.pow(2,S)*m}},d}();t.RetryStrategy=a;var n,s=function(d,p){return!d||d instanceof t.Mesh?null:d instanceof t.SubMesh?d.clone(p):d.clone?d.clone():null},o=function(){function d(){}return d.FetchToRef=function(p,m,_,v,S,P){var x=Math.abs(p)*_%_|0,R=Math.abs(m)*v%v|0,w=(x+R*_)*4;P.r=S[w]/255,P.g=S[w+1]/255,P.b=S[w+2]/255,P.a=S[w+3]/255},d.Mix=function(p,m,_){return p*(1-_)+m*_},d.Instantiate=function(p){if(d.RegisteredExternalClasses&&d.RegisteredExternalClasses[p])return d.RegisteredExternalClasses[p];for(var m=p.split("."),_=window||this,v=0,S=m.length;v<S;v++)_=_[m[v]];return typeof _!="function"?null:_},d.Slice=function(p,m,_){return p.slice?p.slice(m,_):Array.prototype.slice.call(p,m,_)},d.SetImmediate=function(p){d.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(p):setTimeout(p,1)},d.IsExponentOfTwo=function(p){var m=1;do m*=2;while(m<p);return m===p},d.FloatRound=function(p){return Math.fround?Math.fround(p):d._tmpFloatArray[0]=p},d.CeilingPOT=function(p){return p--,p|=p>>1,p|=p>>2,p|=p>>4,p|=p>>8,p|=p>>16,p++,p},d.FloorPOT=function(p){return p=p|p>>1,p=p|p>>2,p=p|p>>4,p=p|p>>8,p=p|p>>16,p-(p>>1)},d.NearestPOT=function(p){var m=d.CeilingPOT(p),_=d.FloorPOT(p);return m-p>p-_?_:m},d.GetExponentOfTwo=function(p,m,_){_===void 0&&(_=t.Engine.SCALEMODE_NEAREST);var v;switch(_){case t.Engine.SCALEMODE_FLOOR:v=d.FloorPOT(p);break;case t.Engine.SCALEMODE_NEAREST:v=d.NearestPOT(p);break;case t.Engine.SCALEMODE_CEILING:default:v=d.CeilingPOT(p);break}return Math.min(v,m)},d.GetFilename=function(p){var m=p.lastIndexOf("/");return m<0?p:p.substring(m+1)},d.GetFolderPath=function(p,m){m===void 0&&(m=!1);var _=p.lastIndexOf("/");return _<0?m?p:"":p.substring(0,_+1)},d.GetDOMTextContent=function(p){for(var m="",_=p.firstChild;_;)_.nodeType===3&&(m+=_.textContent),_=_.nextSibling;return m},d.ToDegrees=function(p){return p*180/Math.PI},d.ToRadians=function(p){return p*Math.PI/180},d.EncodeArrayBufferTobase64=function(p){for(var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_="",v,S,P,x,R,w,I,F=0,k=new Uint8Array(p);F<k.length;)v=k[F++],S=F<k.length?k[F++]:Number.NaN,P=F<k.length?k[F++]:Number.NaN,x=v>>2,R=(v&3)<<4|S>>4,w=(S&15)<<2|P>>6,I=P&63,isNaN(S)?w=I=64:isNaN(P)&&(I=64),_+=m.charAt(x)+m.charAt(R)+m.charAt(w)+m.charAt(I);return"data:image/png;base64,"+_},d.ExtractMinAndMaxIndexed=function(p,m,_,v,S){S===void 0&&(S=null);for(var P=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),R=_;R<_+v;R++){var w=m[R]*3,I=p[w],F=p[w+1],k=p[w+2];P.minimizeInPlaceFromFloats(I,F,k),x.maximizeInPlaceFromFloats(I,F,k)}return S&&(P.x-=P.x*S.x+S.y,P.y-=P.y*S.x+S.y,P.z-=P.z*S.x+S.y,x.x+=x.x*S.x+S.y,x.y+=x.y*S.x+S.y,x.z+=x.z*S.x+S.y),{minimum:P,maximum:x}},d.ExtractMinAndMax=function(p,m,_,v,S){v===void 0&&(v=null);var P=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);S||(S=3);for(var R=m,w=m*S;R<m+_;R++,w+=S){var I=p[w],F=p[w+1],k=p[w+2];P.minimizeInPlaceFromFloats(I,F,k),x.maximizeInPlaceFromFloats(I,F,k)}return v&&(P.x-=P.x*v.x+v.y,P.y-=P.y*v.x+v.y,P.z-=P.z*v.x+v.y,x.x+=x.x*v.x+v.y,x.y+=x.y*v.x+v.y,x.z+=x.z*v.x+v.y),{minimum:P,maximum:x}},d.MakeArray=function(p,m){return m!==!0&&(p===void 0||p==null)?null:Array.isArray(p)?p:[p]},d.GetPointerPrefix=function(){var p="pointer";return d.IsWindowObjectExist()&&!window.PointerEvent&&!navigator.pointerEnabled&&(p="mouse"),p},d.QueueNewFrame=function(p,m){return t.chrome84BugWorkaround?setTimeout(()=>requestAnimationFrame(p),0):d.IsWindowObjectExist()?(m||(m=window),m.requestAnimationFrame?m.requestAnimationFrame(p):m.msRequestAnimationFrame?m.msRequestAnimationFrame(p):m.webkitRequestAnimationFrame?m.webkitRequestAnimationFrame(p):m.mozRequestAnimationFrame?m.mozRequestAnimationFrame(p):m.oRequestAnimationFrame?m.oRequestAnimationFrame(p):window.setTimeout(p,16)):window.setTimeout(p,16)},d.RequestFullscreen=function(p){var m=p.requestFullscreen||p.msRequestFullscreen||p.webkitRequestFullscreen||p.mozRequestFullScreen;m&&m.call(p)},d.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},d.SetCorsBehavior=function(p,m){if(!(p&&p.indexOf("data:")===0)&&d.CorsBehavior)if(typeof d.CorsBehavior=="string"||d.CorsBehavior instanceof String)m.crossOrigin=d.CorsBehavior;else{var _=d.CorsBehavior(p);_&&(m.crossOrigin=_)}},d.CleanUrl=function(p){return p=p.replace(/#/mg,"%23"),p},d.LoadImage=function(p,m,_,v){var S,P=!1;p instanceof ArrayBuffer?(S=URL.createObjectURL(new Blob([p])),P=!0):p instanceof Blob?(S=URL.createObjectURL(p),P=!0):(S=d.CleanUrl(p),S=d.PreprocessUrl(p));var x=new Image;d.SetCorsBehavior(S,x);var R=function(){P&&x.src&&URL.revokeObjectURL(x.src),x.removeEventListener("load",R),x.removeEventListener("error",w),m(x)},w=function(g){P&&x.src&&URL.revokeObjectURL(x.src),x.removeEventListener("load",R),x.removeEventListener("error",w),d.Error("Error while trying to load image: "+p),_&&_("Error while trying to load image: "+p,g)};x.addEventListener("load",R),x.addEventListener("error",w);var I=function(){x.src=S},F=function(){v&&v.loadImageFromDB(S,x)};if(S.substr(0,5)!=="data:"&&v&&v.enableTexturesOffline&&t.Database.IsUASupportingBlobStorage)v.openAsync(F,I);else{if(S.indexOf("file:")!==-1){var k=decodeURIComponent(S.substring(5).toLowerCase());if(t.FilesInput.FilesToLoad[k]){try{var E;try{E=URL.createObjectURL(t.FilesInput.FilesToLoad[k])}catch{E=URL.createObjectURL(t.FilesInput.FilesToLoad[k])}x.src=E,P=!0}catch{x.src=""}return x}}I()}return x},d.LoadFile=function(p,m,_,v,S,P){if(p=d.CleanUrl(p),p=d.PreprocessUrl(p),p.indexOf("file:")!==-1){var x=decodeURIComponent(p.substring(5).toLowerCase());if(t.FilesInput.FilesToLoad[x])return d.ReadFile(t.FilesInput.FilesToLoad[x],m,_,S)}var R=d.BaseUrl+p,w=!1,I={onCompleteObservable:new t.Observable,abort:function(){return w=!0}},F=function(){var g=new XMLHttpRequest,y=null;I.abort=function(){w=!0,g.readyState!==(XMLHttpRequest.DONE||4)&&g.abort(),y!==null&&(clearTimeout(y),y=null)};var M=function(C){g.open("GET",R,!0),S&&(g.responseType="arraybuffer"),_&&g.addEventListener("progress",_);var D=function(){g.removeEventListener("loadend",D),I.onCompleteObservable.notifyObservers(I),I.onCompleteObservable.clear()};g.addEventListener("loadend",D);var V=function(){if(!w&&g.readyState===(XMLHttpRequest.DONE||4)){if(g.removeEventListener("readystatechange",V),g.status>=200&&g.status<300||g.status===0&&(!d.IsWindowObjectExist()||d.IsFileURL())){m(S?g.response:g.responseText,g.responseURL);return}var G=d.DefaultRetryStrategy;if(G){var U=G(R,g,C);if(U!==-1){g.removeEventListener("loadend",D),g=new XMLHttpRequest,y=setTimeout(function(){return M(C+1)},U);return}}var z=new i("Error status: "+g.status+" "+g.statusText+" - Unable to load "+R,g);if(P)P(g,z);else throw z}};g.addEventListener("readystatechange",V),g.send()};M(0)};if(v&&v.enableSceneOffline){var k=function(g){g&&g.status>400?P&&P(g):w||F()},E=function(){w||v&&v.loadFileFromDB(p,function(g){w||m(g),I.onCompleteObservable.notifyObservers(I)},_?function(g){w||_(g)}:void 0,k,S)};v.openAsync(E,k)}else F();return I},d.LoadScript=function(p,m,_){if(d.IsWindowObjectExist()){var v=document.getElementsByTagName("head")[0],S=document.createElement("script");S.type="text/javascript",S.src=p,S.onload=function(){m&&m()},S.onerror=function(P){_&&_("Unable to load script '"+p+"'",P)},v.appendChild(S)}},d.ReadFileAsDataURL=function(p,m,_){var v=new FileReader,S={onCompleteObservable:new t.Observable,abort:function(){return v.abort()}};return v.onloadend=function(P){S.onCompleteObservable.notifyObservers(S)},v.onload=function(P){m(P.target.result)},v.onprogress=_,v.readAsDataURL(p),S},d.ReadFile=function(p,m,_,v){var S=new FileReader,P={onCompleteObservable:new t.Observable,abort:function(){return S.abort()}};return S.onloadend=function(x){return P.onCompleteObservable.notifyObservers(P)},S.onerror=function(x){d.Log("Error while reading file: "+p.name),m(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},S.onload=function(x){m(x.target.result)},_&&(S.onprogress=_),v?S.readAsArrayBuffer(p):S.readAsText(p),P},d.FileAsURL=function(p){var m=new Blob([p]),_=window.URL||window.webkitURL,v=_.createObjectURL(m);return v},d.Format=function(p,m){return m===void 0&&(m=2),p.toFixed(m)},d.CheckExtends=function(p,m,_){p.x<m.x&&(m.x=p.x),p.y<m.y&&(m.y=p.y),p.z<m.z&&(m.z=p.z),p.x>_.x&&(_.x=p.x),p.y>_.y&&(_.y=p.y),p.z>_.z&&(_.z=p.z)},d.DeepCopy=function(p,m,_,v){for(var S in p)if(!(S[0]==="_"&&(!v||v.indexOf(S)===-1))&&!(_&&_.indexOf(S)!==-1)){var P=p[S],x=typeof P;if(x!=="function")try{if(x==="object")if(P instanceof Array){if(m[S]=[],P.length>0)if(typeof P[0]=="object")for(var R=0;R<P.length;R++){var w=s(P[R],m);m[S].indexOf(w)===-1&&m[S].push(w)}else m[S]=P.slice(0)}else m[S]=s(P,m);else m[S]=P}catch{}}},d.IsEmpty=function(p){for(var m in p)if(p.hasOwnProperty(m))return!1;return!0},d.RegisterTopRootEvents=function(p){for(var m=0;m<p.length;m++){var _=p[m];window.addEventListener(_.name,_.handler,!1);try{window.parent&&window.parent.addEventListener(_.name,_.handler,!1)}catch{}}},d.UnregisterTopRootEvents=function(p){for(var m=0;m<p.length;m++){var _=p[m];window.removeEventListener(_.name,_.handler);try{window.parent&&window.parent.removeEventListener(_.name,_.handler)}catch{}}},d.DumpFramebuffer=function(p,m,_,v,S,P){S===void 0&&(S="image/png");for(var x=p*4,R=m/2,w=_.readPixels(0,0,p,m),I=0;I<R;I++)for(var F=0;F<x;F++){var k=F+I*x,E=m-I-1,g=F+E*x,y=w[k];w[k]=w[g],w[g]=y}n||(n=document.createElement("canvas")),n.width=p,n.height=m;var M=n.getContext("2d");if(M){var C=M.createImageData(p,m),D=C.data;D.set(w),M.putImageData(C,0,0),d.EncodeScreenshotCanvasData(v,S,P)}},d.ToBlob=function(p,m,_){_===void 0&&(_="image/png"),p.toBlob||(p.toBlob=function(v,S,P){var x=this;setTimeout(function(){for(var R=atob(x.toDataURL(S,P).split(",")[1]),w=R.length,I=new Uint8Array(w),F=0;F<w;F++)I[F]=R.charCodeAt(F);v(new Blob([I]))})}),p.toBlob(function(v){m(v)},_)},d.EncodeScreenshotCanvasData=function(p,m,_){if(m===void 0&&(m="image/png"),p){var v=n.toDataURL(m);p(v)}else this.ToBlob(n,function(S){if("download"in document.createElement("a")){if(!_){var P=new Date,x=(P.getFullYear()+"-"+(P.getMonth()+1)).slice(2)+"-"+P.getDate()+"_"+P.getHours()+"-"+("0"+P.getMinutes()).slice(-2);_="screenshot_"+x+".png"}d.Download(S,_)}else{var R=URL.createObjectURL(S),w=window.open("");if(!w)return;var I=w.document.createElement("img");I.onload=function(){URL.revokeObjectURL(R)},I.src=R,w.document.body.appendChild(I)}},m)},d.Download=function(p,m){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(p,m);return}var _=window.URL.createObjectURL(p),v=document.createElement("a");document.body.appendChild(v),v.style.display="none",v.href=_,v.download=m,v.addEventListener("click",function(){v.parentElement&&v.parentElement.removeChild(v)}),v.click(),window.URL.revokeObjectURL(_)},d.CreateScreenshot=function(p,m,_,v,S){S===void 0&&(S="image/png");var P,x;if(_.precision)P=Math.round(p.getRenderWidth()*_.precision),x=Math.round(P/p.getAspectRatio(m));else if(_.width&&_.height)P=_.width,x=_.height;else if(_.width&&!_.height)P=_.width,x=Math.round(P/p.getAspectRatio(m));else if(_.height&&!_.width)x=_.height,P=Math.round(x*p.getAspectRatio(m));else if(!isNaN(_))x=_,P=_;else{d.Error("Invalid 'size' parameter !");return}n||(n=document.createElement("canvas")),n.width=P,n.height=x;var R=n.getContext("2d"),w=p.getRenderWidth()/p.getRenderHeight(),I=P,F=I/w;F>x&&(F=x,I=F*w);var k=Math.max(0,P-I)/2,E=Math.max(0,x-F)/2,g=p.getRenderingCanvas();R&&g&&R.drawImage(g,k,E,I,F),d.EncodeScreenshotCanvasData(v,S)},d.CreateScreenshotUsingRenderTarget=function(p,m,_,v,S,P,x,R){S===void 0&&(S="image/png"),P===void 0&&(P=1),x===void 0&&(x=!1);var w,I;if(_.precision)w=Math.round(p.getRenderWidth()*_.precision),I=Math.round(w/p.getAspectRatio(m)),_={width:w,height:I};else if(_.width&&_.height)w=_.width,I=_.height;else if(_.width&&!_.height)w=_.width,I=Math.round(w/p.getAspectRatio(m)),_={width:w,height:I};else if(_.height&&!_.width)I=_.height,w=Math.round(I*p.getAspectRatio(m)),_={width:w,height:I};else if(!isNaN(_))I=_,w=_;else{d.Error("Invalid 'size' parameter !");return}var F=m.getScene(),k=null;F.activeCamera!==m&&(k=F.activeCamera,F.activeCamera=m);var E=new t.RenderTargetTexture("screenShot",_,F,!1,!1,t.Engine.TEXTURETYPE_UNSIGNED_INT,!1,t.Texture.NEAREST_SAMPLINGMODE);E.renderList=null,E.samples=P,x&&E.addPostProcess(new t.FxaaPostProcess("antialiasing",1,F.activeCamera)),E.onAfterRenderObservable.add(function(){d.DumpFramebuffer(w,I,p,v,S,R)}),F.incrementRenderId(),F.resetCachedMaterial(),E.render(!0),E.dispose(),k&&(F.activeCamera=k),m.getProjectionMatrix(!0)},d.ValidateXHRData=function(p,m){m===void 0&&(m=7);try{if(m&1){if(p.responseText&&p.responseText.length>0)return!0;if(m===1)return!1}if(m&2){var _=t.TGATools.GetTGAHeader(p.response);if(_.width&&_.height&&_.width>0&&_.height>0)return!0;if(m===2)return!1}if(m&4){var v=new Uint8Array(p.response,0,3);return v[0]===68&&v[1]===68&&v[2]===83}}catch{}return!1},d.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(p){var m=Math.random()*16|0,_=p==="x"?m:m&3|8;return _.toString(16)})},d.IsBase64=function(p){return p.length<5?!1:p.substr(0,5)==="data:"},d.DecodeBase64=function(p){for(var m=atob(p.split(",")[1]),_=m.length,v=new Uint8Array(new ArrayBuffer(_)),S=0;S<_;S++)v[S]=m.charCodeAt(S);return v.buffer},d._AddLogEntry=function(p){d._LogCache=p+d._LogCache,d.OnNewCacheEntry&&d.OnNewCacheEntry(p)},d._FormatMessage=function(p){var m=function(v){return v<10?"0"+v:""+v},_=new Date;return"["+m(_.getHours())+":"+m(_.getMinutes())+":"+m(_.getSeconds())+"]: "+p},d._LogDisabled=function(p){},d._LogEnabled=function(p){var m=d._FormatMessage(p);console.log("BJS - "+m);var _="<div style='color:white'>"+m+"</div><br>";d._AddLogEntry(_)},d._WarnDisabled=function(p){},d._WarnEnabled=function(p){var m=d._FormatMessage(p);console.warn("BJS - "+m);var _="<div style='color:orange'>"+m+"</div><br>";d._AddLogEntry(_)},d._ErrorDisabled=function(p){},d._ErrorEnabled=function(p){d.errorsCount++;var m=d._FormatMessage(p);console.error("BJS - "+m);var _="<div style='color:red'>"+m+"</div><br>";d._AddLogEntry(_)},Object.defineProperty(d,"LogCache",{get:function(){return d._LogCache},enumerable:!0,configurable:!0}),d.ClearLogCache=function(){d._LogCache="",d.errorsCount=0},Object.defineProperty(d,"LogLevels",{set:function(p){(p&d.MessageLogLevel)===d.MessageLogLevel?d.Log=d._LogEnabled:d.Log=d._LogDisabled,(p&d.WarningLogLevel)===d.WarningLogLevel?d.Warn=d._WarnEnabled:d.Warn=d._WarnDisabled,(p&d.ErrorLogLevel)===d.ErrorLogLevel?d.Error=d._ErrorEnabled:d.Error=d._ErrorDisabled},enumerable:!0,configurable:!0}),d.IsFileURL=function(){return location.protocol==="file:"},d.IsWindowObjectExist=function(){return typeof window<"u"},Object.defineProperty(d,"PerformanceLogLevel",{set:function(p){if((p&d.PerformanceUserMarkLogLevel)===d.PerformanceUserMarkLogLevel){d.StartPerformanceCounter=d._StartUserMark,d.EndPerformanceCounter=d._EndUserMark;return}if((p&d.PerformanceConsoleLogLevel)===d.PerformanceConsoleLogLevel){d.StartPerformanceCounter=d._StartPerformanceConsole,d.EndPerformanceCounter=d._EndPerformanceConsole;return}d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,d.EndPerformanceCounter=d._EndPerformanceCounterDisabled},enumerable:!0,configurable:!0}),d._StartPerformanceCounterDisabled=function(p,m){},d._EndPerformanceCounterDisabled=function(p,m){},d._StartUserMark=function(p,m){if(m===void 0&&(m=!0),!d._performance){if(!d.IsWindowObjectExist())return;d._performance=window.performance}!m||!d._performance.mark||d._performance.mark(p+"-Begin")},d._EndUserMark=function(p,m){m===void 0&&(m=!0),!(!m||!d._performance.mark)&&(d._performance.mark(p+"-End"),d._performance.measure(p,p+"-Begin",p+"-End"))},d._StartPerformanceConsole=function(p,m){m===void 0&&(m=!0),m&&(d._StartUserMark(p,m),console.time&&console.time(p))},d._EndPerformanceConsole=function(p,m){m===void 0&&(m=!0),m&&(d._EndUserMark(p,m),console.time&&console.timeEnd(p))},Object.defineProperty(d,"Now",{get:function(){return d.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),d.GetClassName=function(p,m){m===void 0&&(m=!1);var _=null;if(!m&&p.getClassName)_=p.getClassName();else{if(p instanceof Object){var v=m?p:Object.getPrototypeOf(p);_=v.constructor.__bjsclassName__}_||(_=typeof p)}return _},d.First=function(p,m){for(var _=0,v=p;_<v.length;_++){var S=v[_];if(m(S))return S}return null},d.getFullClassName=function(p,m){m===void 0&&(m=!1);var _=null,v=null;if(!m&&p.getClassName)_=p.getClassName();else{if(p instanceof Object){var S=m?p:Object.getPrototypeOf(p);_=S.constructor.__bjsclassName__,v=S.constructor.__bjsmoduleName__}_||(_=typeof p)}return _?(v!=null?v+".":"")+_:null},d.DelayAsync=function(p){return new Promise(function(m){setTimeout(function(){m()},p)})},d.GetCurrentGradient=function(p,m,_){for(var v=0;v<m.length-1;v++){var S=m[v],P=m[v+1];if(p>=S.gradient&&p<=P.gradient){var x=(p-S.gradient)/(P.gradient-S.gradient);_(S,P,x);return}}var R=m.length-1;_(m[R],m[R],1)},d.BaseUrl="",d.DefaultRetryStrategy=a.ExponentialBackoff(),d.CorsBehavior="anonymous",d.UseFallbackTexture=!0,d.RegisteredExternalClasses={},d.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",d._tmpFloatArray=new Float32Array(1),d.PreprocessUrl=function(p){return p},d.NoneLogLevel=0,d.MessageLogLevel=1,d.WarningLogLevel=2,d.ErrorLogLevel=4,d.AllLogLevel=7,d._LogCache="",d.errorsCount=0,d.Log=d._LogEnabled,d.Warn=d._WarnEnabled,d.Error=d._ErrorEnabled,d.PerformanceNoneLogLevel=0,d.PerformanceUserMarkLogLevel=1,d.PerformanceConsoleLogLevel=2,d.StartPerformanceCounter=d._StartPerformanceCounterDisabled,d.EndPerformanceCounter=d._EndPerformanceCounterDisabled,d}();t.Tools=o;var l=function(){function d(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(d.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),d.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},d.prototype.addCount=function(p,m){d.Enabled&&(this._current+=p,m&&this._fetchResult())},d.prototype.beginMonitoring=function(){d.Enabled&&(this._startMonitoringTime=o.Now)},d.prototype.endMonitoring=function(p){if(p===void 0&&(p=!0),!!d.Enabled){p&&this.fetchNewFrame();var m=o.Now;this._current=m-this._startMonitoringTime,p&&this._fetchResult()}},d.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var p=o.Now;p-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=p,this._lastSecAccumulated=0,this._lastSecValueCount=0)},d.Enabled=!0,d}();t.PerfCounter=l;function u(d,p){return function(m){m.__bjsclassName__=d,m.__bjsmoduleName__=p??null}}t.className=u;var h=function(){function d(p,m,_,v){v===void 0&&(v=0),this.iterations=p,this.index=v-1,this._done=!1,this._fn=m,this._successCallback=_}return d.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},d.prototype.breakLoop=function(){this._done=!0,this._successCallback()},d.Run=function(p,m,_,v){v===void 0&&(v=0);var S=new d(p,m,_,v);return S.executeNext(),S},d.SyncAsyncForLoop=function(p,m,_,v,S,P){return P===void 0&&(P=0),d.Run(Math.ceil(p/m),function(x){S&&S()?x.breakLoop():setTimeout(function(){for(var R=0;R<m;++R){var w=x.index*m+R;if(w>=p)break;if(_(w),S&&S()){x.breakLoop();break}}x.executeNext()},P)},v)},d}();t.AsyncLoop=h})(T||(T={}));var T;(function(t){var f;(function(a){a[a.Pending=0]="Pending",a[a.Fulfilled=1]="Fulfilled",a[a.Rejected=2]="Rejected"})(f||(f={}));var c=function(){function a(){this.count=0,this.target=0,this.results=[]}return a}(),r=function(){function a(n){var s=this;if(this._state=f.Pending,this._children=new Array,this._rejectWasConsumed=!1,!!n)try{n(function(o){s._resolve(o)},function(o){s._reject(o)})}catch(o){this._reject(o)}}return Object.defineProperty(a.prototype,"_result",{get:function(){return this._resultValue},set:function(n){this._resultValue=n,this._parent&&this._parent._result===void 0&&(this._parent._result=n)},enumerable:!0,configurable:!0}),a.prototype.catch=function(n){return this.then(void 0,n)},a.prototype.then=function(n,s){var o=this,l=new a;return l._onFulfilled=n,l._onRejected=s,this._children.push(l),l._parent=this,this._state!==f.Pending&&t.Tools.SetImmediate(function(){if(o._state===f.Fulfilled||o._rejectWasConsumed){var u=l._resolve(o._result);if(u!=null)if(u._state!==void 0){var h=u;l._children.push(h),h._parent=l,l=h}else l._result=u}else l._reject(o._reason)}),l},a.prototype._moveChildren=function(n){var s=this,o;if((o=this._children).push.apply(o,n.splice(0,n.length)),this._children.forEach(function(m){m._parent=s}),this._state===f.Fulfilled)for(var l=0,u=this._children;l<u.length;l++){var h=u[l];h._resolve(this._result)}else if(this._state===f.Rejected)for(var d=0,p=this._children;d<p.length;d++){var h=p[d];h._reject(this._reason)}},a.prototype._resolve=function(n){try{this._state=f.Fulfilled;var s=null;if(this._onFulfilled&&(s=this._onFulfilled(n)),s!=null)if(s._state!==void 0){var o=s;o._parent=this,o._moveChildren(this._children),n=o._result}else n=s;this._result=n;for(var l=0,u=this._children;l<u.length;l++){var h=u[l];h._resolve(n)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(d){this._reject(d,!0)}},a.prototype._reject=function(n,s){if(s===void 0&&(s=!1),this._state=f.Rejected,this._reason=n,this._onRejected&&!s)try{this._onRejected(n),this._rejectWasConsumed=!0}catch(h){n=h}for(var o=0,l=this._children;o<l.length;o++){var u=l[o];this._rejectWasConsumed?u._resolve(null):u._reject(n)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},a.resolve=function(n){var s=new a;return s._resolve(n),s},a._RegisterForFulfillment=function(n,s,o){n.then(function(l){return s.results[o]=l,s.count++,s.count===s.target&&s.rootPromise._resolve(s.results),null},function(l){s.rootPromise._state!==f.Rejected&&s.rootPromise._reject(l)})},a.all=function(n){var s=new a,o=new c;if(o.target=n.length,o.rootPromise=s,n.length)for(var l=0;l<n.length;l++)a._RegisterForFulfillment(n[l],o,l);else s._resolve([]);return s},a.race=function(n){var s=new a;if(n.length)for(var o=0,l=n;o<l.length;o++){var u=l[o];u.then(function(h){return s&&(s._resolve(h),s=null),null},function(h){s&&(s._reject(h),s=null)})}return s},a}(),i=function(){function a(){}return a.Apply=function(n){if(n===void 0&&(n=!1),n||typeof Promise>"u"){var s=window;s.Promise=r}},a}();t.PromisePolyfill=i})(T||(T={}));var T;(function(t){var f=function(){function c(r){this._pendingActions=new Array,this._workerInfos=r.map(function(i){return{worker:i,active:!1}})}return c.prototype.dispose=function(){for(var r=0,i=this._workerInfos;r<i.length;r++){var a=i[r];a.worker.terminate()}delete this._workerInfos,delete this._pendingActions},c.prototype.push=function(r){for(var i=0,a=this._workerInfos;i<a.length;i++){var n=a[i];if(!n.active){this._execute(n,r);return}}this._pendingActions.push(r)},c.prototype._execute=function(r,i){var a=this;r.active=!0,i(r.worker,function(){r.active=!1;var n=a._pendingActions.shift();n&&a._execute(r,n)})},c}();t.WorkerPool=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(r){this._alphaBlend!==r&&(this._alphaBlend=r,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),c.prototype.setAlphaBlendConstants=function(r,i,a,n){this._blendConstants[0]===r&&this._blendConstants[1]===i&&this._blendConstants[2]===a&&this._blendConstants[3]===n||(this._blendConstants[0]=r,this._blendConstants[1]=i,this._blendConstants[2]=a,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)},c.prototype.setAlphaBlendFunctionParameters=function(r,i,a,n){this._blendFunctionParameters[0]===r&&this._blendFunctionParameters[1]===i&&this._blendFunctionParameters[2]===a&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=r,this._blendFunctionParameters[1]=i,this._blendFunctionParameters[2]=a,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},c.prototype.setAlphaEquationParameters=function(r,i){this._blendEquationParameters[0]===r&&this._blendEquationParameters[1]===i||(this._blendEquationParameters[0]=r,this._blendEquationParameters[1]=i,this._isBlendEquationParametersDirty=!0)},c.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},c.prototype.apply=function(r){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?r.enable(r.BLEND):r.disable(r.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(r.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(r.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(r.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},c}();t._AlphaState=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"zOffset",{get:function(){return this._zOffset},set:function(r){this._zOffset!==r&&(this._zOffset=r,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cullFace",{get:function(){return this._cullFace},set:function(r){this._cullFace!==r&&(this._cullFace=r,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cull",{get:function(){return this._cull},set:function(r){this._cull!==r&&(this._cull=r,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(r){this._depthFunc!==r&&(this._depthFunc=r,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthMask",{get:function(){return this._depthMask},set:function(r){this._depthMask!==r&&(this._depthMask=r,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthTest",{get:function(){return this._depthTest},set:function(r){this._depthTest!==r&&(this._depthTest=r,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"frontFace",{get:function(){return this._frontFace},set:function(r){this._frontFace!==r&&(this._frontFace=r,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),c.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},c.prototype.apply=function(r){this.isDirty&&(this._isCullDirty&&(this.cull?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(r.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(r.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(r.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(this.zOffset,0)):r.disable(r.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(r.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},c}();t._DepthCullingState=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(c.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(r){this._stencilFunc!==r&&(this._stencilFunc=r,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(r){this._stencilFuncRef!==r&&(this._stencilFuncRef=r,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(r){this._stencilFuncMask!==r&&(this._stencilFuncMask=r,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(r){this._stencilOpStencilFail!==r&&(this._stencilOpStencilFail=r,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(r){this._stencilOpDepthFail!==r&&(this._stencilOpDepthFail=r,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(r){this._stencilOpStencilDepthPass!==r&&(this._stencilOpStencilDepthPass=r,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(r){this._stencilMask!==r&&(this._stencilMask=r,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(r){this._stencilTest!==r&&(this._stencilTest=r,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),c.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=t.Engine.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=t.Engine.KEEP,this._stencilOpDepthFail=t.Engine.KEEP,this._stencilOpStencilDepthPass=t.Engine.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},c.prototype.apply=function(r){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(r.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(r.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(r.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},c}();t._StencilState=f})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function s(){}return s}(),c=function(){function s(){}return s}();t.InstancingAttributeInfo=c;var r=function(){function s(){}return s}();t.RenderTargetCreationOptions=r;var i=function(){function s(){}return s}();t.DepthTextureCreationOptions=i;var a=function(){function s(){}return s}();t.EngineCapabilities=a;var n=function(){function s(o,l,u,h){h===void 0&&(h=!1);var d=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new t.Observable,this.onCanvasBlurObservable=new t.Observable,this.onCanvasFocusObservable=new t.Observable,this.onCanvasPointerOutObservable=new t.Observable,this.onBeforeTextureInitObservable=new t.Observable,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new t.Observable,this.onEndFrameObservable=new t.Observable,this.onBeforeShaderCompilationObservable=new t.Observable,this.onAfterShaderCompilationObservable=new t.Observable,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.disableTextureBindingOptimization=!1,this.onVRDisplayChangedObservable=new t.Observable,this.onVRRequestPresentComplete=new t.Observable,this.onVRRequestPresentStart=new t.Observable,this._colorWrite=!0,this._drawCalls=new t.PerfCounter,this._textureCollisions=new t.PerfCounter,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new t.Observable,this.onContextRestoredObservable=new t.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new t.PerformanceMonitor,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new t._DepthCullingState,this._stencilState=new t._StencilState,this._alphaState=new t._AlphaState,this._alphaMode=s.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._firstBoundInternalTextureTracker=new t.DummyInternalTextureTracker,this._lastBoundInternalTextureTracker=new t.DummyInternalTextureTracker,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new t.Vector4(0,0,0,0),this._onVRFullScreenTriggered=function(){if(d._vrDisplay&&d._vrDisplay.isPresenting){d._oldSize=new t.Size(d.getRenderWidth(),d.getRenderHeight()),d._oldHardwareScaleFactor=d.getHardwareScalingLevel();var V=d._vrDisplay.getEyeParameters("left");d.setHardwareScalingLevel(1),d.setSize(V.renderWidth*2,V.renderHeight)}else d.setHardwareScalingLevel(d._oldHardwareScaleFactor),d.setSize(d._oldSize.width,d._oldSize.height)},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},t.PromisePolyfill.Apply();var p=null;if(s.Instances.push(this),!!o){if(u=u||{},o.getContext){if(p=o,this._renderingCanvas=p,l!=null&&(u.antialias=l),u.deterministicLockstep===void 0&&(u.deterministicLockstep=!1),u.lockstepMaxSteps===void 0&&(u.lockstepMaxSteps=4),u.preserveDrawingBuffer===void 0&&(u.preserveDrawingBuffer=!1),u.audioEngine===void 0&&(u.audioEngine=!0),u.stencil===void 0&&(u.stencil=!0),u.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),this._deterministicLockstep=u.deterministicLockstep,this._lockstepMaxSteps=u.lockstepMaxSteps,this._doNotHandleContextLost=!!u.doNotHandleContextLost,navigator&&navigator.userAgent)for(var m=navigator.userAgent,_=0,v=s.ExceptionList;_<v.length;_++){var S=v[_],P=S.key,x=S.targets;if(m.indexOf(P)>-1){if(S.capture&&S.captureConstraint){var R=S.capture,w=S.captureConstraint,I=new RegExp(R),F=I.exec(m);if(F&&F.length>0){var k=parseInt(F[F.length-1]);if(k>=w)continue}}for(var E=0,g=x;E<g.length;E++){var y=g[E];switch(y){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"textureBindingOptimization":this.disableTextureBindingOptimization=!0;break}}}}if(!u.disableWebGL2Support)try{this._gl=p.getContext("webgl2",u)||p.getContext("experimental-webgl2",u),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch{}if(!this._gl){if(!p)throw new Error("The provided canvas is null or undefined.");try{this._gl=p.getContext("webgl",u)||p.getContext("experimental-webgl",u)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){d.onCanvasFocusObservable.notifyObservers(d)},this._onCanvasBlur=function(){d.onCanvasBlurObservable.notifyObservers(d)},p.addEventListener("focus",this._onCanvasFocus),p.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){d.disablePerformanceMonitorInBackground&&d._performanceMonitor.disable(),d._windowIsBackground=!0},this._onFocus=function(){d.disablePerformanceMonitorInBackground&&d._performanceMonitor.enable(),d._windowIsBackground=!1},this._onCanvasPointerOut=function(V){d.onCanvasPointerOutObservable.notifyObservers(V)},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),p.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(V){V.preventDefault(),d._contextWasLost=!0,t.Tools.Warn("WebGL context lost."),d.onContextLostObservable.notifyObservers(d)},this._onContextRestored=function(V){setTimeout(function(){d._initGLContext(),d._rebuildEffects(),d._rebuildInternalTextures(),d._rebuildBuffers(),d.wipeCaches(!0),t.Tools.Warn("WebGL context successfully restored."),d.onContextRestoredObservable.notifyObservers(d),d._contextWasLost=!1},0)},p.addEventListener("webglcontextlost",this._onContextLost,!1),p.addEventListener("webglcontextrestored",this._onContextRestored,!1))}else{this._gl=o,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var M=this._gl.getContextAttributes();M&&(u.stencil=M.stencil)}var C=u.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=h?1/Math.min(C,window.devicePixelRatio||1):1,this.resize(),this._isStencilEnable=!!u.stencil,this._initGLContext(),p&&(this._onFullscreenChange=function(){document.fullscreen!==void 0?d.isFullscreen=document.fullscreen:document.mozFullScreen!==void 0?d.isFullscreen=document.mozFullScreen:document.webkitIsFullScreen!==void 0?d.isFullscreen=document.webkitIsFullScreen:document.msIsFullScreen!==void 0&&(d.isFullscreen=document.msIsFullScreen),d.isFullscreen&&d._pointerLockRequested&&p&&(p.requestPointerLock=p.requestPointerLock||p.msRequestPointerLock||p.mozRequestPointerLock||p.webkitRequestPointerLock,p.requestPointerLock&&p.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){d.isPointerLock=document.mozPointerLockElement===p||document.webkitPointerLockElement===p||document.msPointerLockElement===p||document.pointerLockElement===p},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){p&&p.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)),!s.audioEngine&&u.audioEngine&&s.AudioEngineFactory&&(s.audioEngine=s.AudioEngineFactory(this.getRenderingCanvas()));for(var D=0;D<this._caps.maxVertexAttribs;D++)this._currentBufferPointers[D]=new f;this._linkTrackers(this._firstBoundInternalTextureTracker,this._lastBoundInternalTextureTracker),u.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js engine (v"+s.Version+") launched"),this.enableOfflineSupport=t.Database!==void 0}}return Object.defineProperty(s,"LastCreatedEngine",{get:function(){return s.Instances.length===0?null:s.Instances[s.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(s,"LastCreatedScene",{get:function(){var o=s.LastCreatedEngine;return!o||o.scenes.length===0?null:o.scenes[o.scenes.length-1]},enumerable:!0,configurable:!0}),s.MarkAllMaterialsAsDirty=function(o,l){for(var u=0;u<s.Instances.length;u++)for(var h=s.Instances[u],d=0;d<h.scenes.length;d++)h.scenes[d].markAllMaterialsAsDirty(o,l)},Object.defineProperty(s,"Version",{get:function(){return"3.3.0"},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(o){this._doNotHandleContextLost=o},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,s.TEXTUREFORMAT_RGBA,!1,!1,s.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,s.TEXTUREFORMAT_RGBA,!1,!1,s.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var o=new Uint8Array(4),l=[o,o,o,o,o,o];this._emptyCubeTexture=this.createRawCubeTexture(l,1,s.TEXTUREFORMAT_RGBA,s.TEXTURETYPE_UNSIGNED_INT,!1,!1,s.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),s.prototype._rebuildInternalTextures=function(){for(var o=this._internalTexturesCache.slice(),l=0,u=o;l<u.length;l++){var h=u[l];h._rebuild()}},s.prototype._rebuildEffects=function(){for(var o in this._compiledEffects){var l=this._compiledEffects[o];l._prepareEffect()}t.Effect.ResetCache()},s.prototype._rebuildBuffers=function(){for(var o=0,l=this.scenes;o<l.length;o++){var u=l[o];u.resetCachedMaterial(),u._rebuildGeometries(),u._rebuildTextures()}for(var h=0,d=this._uniformBuffers;h<d.length;h++){var p=d[h];p._rebuild()}},s.prototype._initGLContext=function(){this._caps=new a,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var o=this._gl.getExtension("WEBGL_debug_renderer_info");if(o!=null&&(this._glRenderer=this._gl.getParameter(o.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(o.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,this._caps.fragmentDepthSupported=this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,this._caps.highPrecisionShaderSupported=!0,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var l=this._gl.getExtension("WEBGL_draw_buffers");if(l!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=l.drawBuffersWEBGL.bind(l),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var u=0;u<16;u++)this._gl["COLOR_ATTACHMENT"+u+"_WEBGL"]=l["COLOR_ATTACHMENT"+u+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var h=this._gl.getExtension("WEBGL_depth_texture");h!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=h.UNSIGNED_INT_24_8_WEBGL)}if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var d=this._gl.getExtension("OES_vertex_array_object");d!=null?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=d.createVertexArrayOES.bind(d),this._gl.bindVertexArray=d.bindVertexArrayOES.bind(d),this._gl.deleteVertexArray=d.deleteVertexArrayOES.bind(d)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var p=this._gl.getExtension("ANGLE_instanced_arrays");p!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=p.drawArraysInstancedANGLE.bind(p),this._gl.drawElementsInstanced=p.drawElementsInstancedANGLE.bind(p),this._gl.vertexAttribDivisor=p.vertexAttribDivisorANGLE.bind(p)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var m=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);m&&(this._caps.highPrecisionShaderSupported=m.precision!==0)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var _=0;_<this._maxSimultaneousTextures;_++)this._nextFreeTextureSlots.push(_)},Object.defineProperty(s.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),s.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var o=this._workingCanvas.getContext("2d");o&&(this._workingContext=o)}},s.prototype.resetTextureCache=function(){for(var o in this._boundTexturesCache)if(this._boundTexturesCache.hasOwnProperty(o)){var l=this._boundTexturesCache[o];l&&this._removeDesignatedSlot(l),this._boundTexturesCache[o]=null}if(!this.disableTextureBindingOptimization){this._nextFreeTextureSlots=[];for(var u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u)}this._currentTextureChannel=-1},s.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},s.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},s.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},s.prototype.getAspectRatio=function(o,l){l===void 0&&(l=!1);var u=o.viewport;return this.getRenderWidth(l)*u.width/(this.getRenderHeight(l)*u.height)},s.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},s.prototype.getRenderWidth=function(o){return o===void 0&&(o=!1),!o&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},s.prototype.getRenderHeight=function(o){return o===void 0&&(o=!1),!o&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},s.prototype.getRenderingCanvas=function(){return this._renderingCanvas},s.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},s.prototype.setHardwareScalingLevel=function(o){this._hardwareScalingLevel=o,this.resize()},s.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},s.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},s.prototype.getCaps=function(){return this._caps},Object.defineProperty(s.prototype,"drawCalls",{get:function(){return t.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"),0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"drawCallsPerfCounter",{get:function(){return t.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),s.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},s.prototype.setDepthFunction=function(o){this._depthCullingState.depthFunc=o},s.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},s.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},s.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},s.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},s.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},s.prototype.setStencilBuffer=function(o){this._stencilState.stencilTest=o},s.prototype.getStencilMask=function(){return this._stencilState.stencilMask},s.prototype.setStencilMask=function(o){this._stencilState.stencilMask=o},s.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},s.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},s.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},s.prototype.setStencilFunction=function(o){this._stencilState.stencilFunc=o},s.prototype.setStencilFunctionReference=function(o){this._stencilState.stencilFuncRef=o},s.prototype.setStencilFunctionMask=function(o){this._stencilState.stencilFuncMask=o},s.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},s.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},s.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},s.prototype.setStencilOperationFail=function(o){this._stencilState.stencilOpStencilFail=o},s.prototype.setStencilOperationDepthFail=function(o){this._stencilState.stencilOpDepthFail=o},s.prototype.setStencilOperationPass=function(o){this._stencilState.stencilOpStencilDepthPass=o},s.prototype.setDitheringState=function(o){o?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},s.prototype.setRasterizerState=function(o){o?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},s.prototype.stopRenderLoop=function(o){if(!o){this._activeRenderLoops=[];return}var l=this._activeRenderLoops.indexOf(o);l>=0&&this._activeRenderLoops.splice(l,1)},s.prototype._renderLoop=function(){if(!this._contextWasLost){var o=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(o=!1),o){this.beginFrame();for(var l=0;l<this._activeRenderLoops.length;l++){var u=this._activeRenderLoops[l];u()}this.endFrame()}}if(this._activeRenderLoops.length>0){var h=null;this._vrDisplay&&this._vrDisplay.isPresenting&&(h=this._vrDisplay),this._frameHandler=t.Tools.QueueNewFrame(this._bindedRenderFunction,h)}else this._renderingQueueLaunched=!1},s.prototype.runRenderLoop=function(o){this._activeRenderLoops.indexOf(o)===-1&&(this._activeRenderLoops.push(o),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=t.Tools.QueueNewFrame(this._bindedRenderFunction)))},s.prototype.switchFullscreen=function(o){this.isFullscreen?t.Tools.ExitFullscreen():(this._pointerLockRequested=o,this._renderingCanvas&&t.Tools.RequestFullscreen(this._renderingCanvas))},s.prototype.clear=function(o,l,u,h){h===void 0&&(h=!1),this.applyStates();var d=0;l&&o&&(this._gl.clearColor(o.r,o.g,o.b,o.a!==void 0?o.a:1),d|=this._gl.COLOR_BUFFER_BIT),u&&(this._gl.clearDepth(1),d|=this._gl.DEPTH_BUFFER_BIT),h&&(this._gl.clearStencil(0),d|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(d)},s.prototype.scissorClear=function(o,l,u,h,d){var p=this._gl,m=p.getParameter(p.SCISSOR_TEST),_=p.getParameter(p.SCISSOR_BOX);p.enable(p.SCISSOR_TEST),p.scissor(o,l,u,h),this.clear(d,!0,!0,!0),p.scissor(_[0],_[1],_[2],_[3]),m===!0?p.enable(p.SCISSOR_TEST):p.disable(p.SCISSOR_TEST)},s.prototype._viewport=function(o,l,u,h){(o!==this._viewportCached.x||l!==this._viewportCached.y||u!==this._viewportCached.z||h!==this._viewportCached.w)&&(this._viewportCached.x=o,this._viewportCached.y=l,this._viewportCached.z=u,this._viewportCached.w=h,this._gl.viewport(o,l,u,h))},s.prototype.setViewport=function(o,l,u){var h=l||this.getRenderWidth(),d=u||this.getRenderHeight(),p=o.x||0,m=o.y||0;this._cachedViewport=o,this._viewport(p*h,m*d,h*o.width,d*o.height)},s.prototype.setDirectViewport=function(o,l,u,h){var d=this._cachedViewport;return this._cachedViewport=null,this._viewport(o,l,u,h),d},s.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},s.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},s.prototype.resize=function(){if(!(this._vrDisplay&&this._vrDisplay.isPresenting)){var o=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,l=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(o/this._hardwareScalingLevel,l/this._hardwareScalingLevel)}},s.prototype.setSize=function(o,l){if(this._renderingCanvas&&!(this._renderingCanvas.width===o&&this._renderingCanvas.height===l)){this._renderingCanvas.width=o,this._renderingCanvas.height=l;for(var u=0;u<this.scenes.length;u++)for(var h=this.scenes[u],d=0;d<h.cameras.length;d++){var p=h.cameras[d];p._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},s.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},s.prototype.getVRDevice=function(){return this._vrDisplay},s.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},s.prototype.initWebVRAsync=function(){var o=this,l=function(){var u={vrDisplay:o._vrDisplay,vrSupported:o._vrSupported};o.onVRDisplayChangedObservable.notifyObservers(u),o._webVRInitPromise=new Promise(function(h){h(u)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(u){o._vrDisplay=u.display,l()},this._onVrDisplayDisconnect=function(){o._vrDisplay.cancelAnimationFrame(o._frameHandler),o._vrDisplay=void 0,o._frameHandler=t.Tools.QueueNewFrame(o._bindedRenderFunction),l()},this._onVrDisplayPresentChange=function(){o._vrExclusivePointerMode=o._vrDisplay&&o._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(l),this._webVRInitPromise},s.prototype.enableVR=function(){var o=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){var l=function(){o.onVRRequestPresentComplete.notifyObservers(!0),o._onVRFullScreenTriggered()},u=function(){o.onVRRequestPresentComplete.notifyObservers(!1)};this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(l).catch(u)}},s.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},s.prototype._getVRDisplaysAsync=function(){var o=this;return new Promise(function(l,u){navigator.getVRDisplays?navigator.getVRDisplays().then(function(h){o._vrSupported=!0,o._vrDisplay=h[0],l({vrDisplay:o._vrDisplay,vrSupported:o._vrSupported})}):(o._vrDisplay=void 0,o._vrSupported=!1,l({vrDisplay:o._vrDisplay,vrSupported:o._vrSupported}))})},s.prototype.bindFramebuffer=function(o,l,u,h,d,p,m){m===void 0&&(m=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=o,this.bindUnboundFramebuffer(o._MSAAFramebuffer?o._MSAAFramebuffer:o._framebuffer);var _=this._gl;o.isCube&&(l===void 0&&(l=0),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+l,o._webGLTexture,m),p&&(p._generateStencilBuffer?_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.TEXTURE_CUBE_MAP_POSITIVE_X+l,p._webGLTexture,m):_.framebufferTexture2D(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.TEXTURE_CUBE_MAP_POSITIVE_X+l,p._webGLTexture,m))),this._cachedViewport&&!d?this.setViewport(this._cachedViewport,u,h):(u||(u=o.width,m&&(u=u/Math.pow(2,m))),h||(h=o.height,m&&(h=h/Math.pow(2,m))),this._viewport(0,0,u,h)),this.wipeCaches()},s.prototype.bindUnboundFramebuffer=function(o){this._currentFramebuffer!==o&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,o),this._currentFramebuffer=o)},s.prototype.unBindFramebuffer=function(o,l,u){l===void 0&&(l=!1),this._currentRenderTarget=null;var h=this._gl;o._MSAAFramebuffer&&(h.bindFramebuffer(h.READ_FRAMEBUFFER,o._MSAAFramebuffer),h.bindFramebuffer(h.DRAW_FRAMEBUFFER,o._framebuffer),h.blitFramebuffer(0,0,o.width,o.height,0,0,o.width,o.height,h.COLOR_BUFFER_BIT,h.NEAREST)),o.generateMipMaps&&!l&&!o.isCube&&(this._bindTextureDirectly(h.TEXTURE_2D,o,!0),h.generateMipmap(h.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null)),u&&(o._MSAAFramebuffer&&this.bindUnboundFramebuffer(o._framebuffer),u()),this.bindUnboundFramebuffer(null)},s.prototype.unBindMultiColorAttachmentFramebuffer=function(o,l,u){l===void 0&&(l=!1),this._currentRenderTarget=null;var h=this._gl;if(o[0]._MSAAFramebuffer){h.bindFramebuffer(h.READ_FRAMEBUFFER,o[0]._MSAAFramebuffer),h.bindFramebuffer(h.DRAW_FRAMEBUFFER,o[0]._framebuffer);var d=o[0]._attachments;d||(d=new Array(o.length),o[0]._attachments=d);for(var p=0;p<o.length;p++){for(var m=o[p],_=0;_<d.length;_++)d[_]=h.NONE;d[p]=h[this.webGLVersion>1?"COLOR_ATTACHMENT"+p:"COLOR_ATTACHMENT"+p+"_WEBGL"],h.readBuffer(d[p]),h.drawBuffers(d),h.blitFramebuffer(0,0,m.width,m.height,0,0,m.width,m.height,h.COLOR_BUFFER_BIT,h.NEAREST)}for(var p=0;p<d.length;p++)d[p]=h[this.webGLVersion>1?"COLOR_ATTACHMENT"+p:"COLOR_ATTACHMENT"+p+"_WEBGL"];h.drawBuffers(d)}for(var p=0;p<o.length;p++){var m=o[p];m.generateMipMaps&&!l&&!m.isCube&&(this._bindTextureDirectly(h.TEXTURE_2D,m),h.generateMipmap(h.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null))}u&&(o[0]._MSAAFramebuffer&&this.bindUnboundFramebuffer(o[0]._framebuffer),u()),this.bindUnboundFramebuffer(null)},s.prototype.generateMipMapsForCubemap=function(o){if(o.generateMipMaps){var l=this._gl;this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,o,!0),l.generateMipmap(l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null)}},s.prototype.flushFramebuffer=function(){this._gl.flush()},s.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},s.prototype.createUniformBuffer=function(o){var l=this._gl.createBuffer();if(!l)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(l),o instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,o,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(o),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),l.references=1,l},s.prototype.createDynamicUniformBuffer=function(o){var l=this._gl.createBuffer();if(!l)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(l),o instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,o,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(o),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),l.references=1,l},s.prototype.updateUniformBuffer=function(o,l,u,h){this.bindUniformBuffer(o),u===void 0&&(u=0),h===void 0?l instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,u,l):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,u,new Float32Array(l)):l instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,l.subarray(u,u+h)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(l).subarray(u,u+h)),this.bindUniformBuffer(null)},s.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},s.prototype.createVertexBuffer=function(o){var l=this._gl.createBuffer();if(!l)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(l),o instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(o),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,o,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),l.references=1,l},s.prototype.createDynamicVertexBuffer=function(o){var l=this._gl.createBuffer();if(!l)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(l),o instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(o),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,o,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),l.references=1,l},s.prototype.updateDynamicIndexBuffer=function(o,l,u){u===void 0&&(u=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(o);var h;l instanceof Uint16Array||l instanceof Uint32Array?h=l:h=o.is32Bits?new Uint32Array(l):new Uint16Array(l),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},s.prototype.updateDynamicVertexBuffer=function(o,l,u,h){this.bindArrayBuffer(o),u===void 0&&(u=0),h===void 0?l instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,u,new Float32Array(l)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,u,l):l instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(l).subarray(u,u+h)):(l instanceof ArrayBuffer?l=new Uint8Array(l,u,h):l=new Uint8Array(l.buffer,l.byteOffset+u,h),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,l)),this._resetVertexBufferBinding()},s.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},s.prototype.createIndexBuffer=function(o,l){var u=this._gl.createBuffer();if(!u)throw new Error("Unable to create index buffer");this.bindIndexBuffer(u);var h,d=!1;if(o instanceof Uint16Array)h=o;else if(this._caps.uintIndices)if(o instanceof Uint32Array)h=o,d=!0;else{for(var p=0;p<o.length;p++)if(o[p]>65535){d=!0;break}h=d?new Uint32Array(o):new Uint16Array(o)}else h=new Uint16Array(o);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,h,l?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),u.references=1,u.is32Bits=d,u},s.prototype.bindArrayBuffer=function(o){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(o,this._gl.ARRAY_BUFFER)},s.prototype.bindUniformBuffer=function(o){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,o)},s.prototype.bindUniformBufferBase=function(o,l){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,l,o)},s.prototype.bindUniformBlock=function(o,l,u){var h=this._gl.getUniformBlockIndex(o,l);this._gl.uniformBlockBinding(o,h,u)},s.prototype.bindIndexBuffer=function(o){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(o,this._gl.ELEMENT_ARRAY_BUFFER)},s.prototype.bindBuffer=function(o,l){(this._vaoRecordInProgress||this._currentBoundBuffer[l]!==o)&&(this._gl.bindBuffer(l,o),this._currentBoundBuffer[l]=o)},s.prototype.updateArrayBuffer=function(o){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,o)},s.prototype._vertexAttribPointer=function(o,l,u,h,d,p,m){var _=this._currentBufferPointers[l],v=!1;_.active?(_.buffer!==o&&(_.buffer=o,v=!0),_.size!==u&&(_.size=u,v=!0),_.type!==h&&(_.type=h,v=!0),_.normalized!==d&&(_.normalized=d,v=!0),_.stride!==p&&(_.stride=p,v=!0),_.offset!==m&&(_.offset=m,v=!0)):(v=!0,_.active=!0,_.index=l,_.size=u,_.type=h,_.normalized=d,_.stride=p,_.offset=m,_.buffer=o),(v||this._vaoRecordInProgress)&&(this.bindArrayBuffer(o),this._gl.vertexAttribPointer(l,u,h,d,p,m))},s.prototype._bindIndexBufferWithCache=function(o){o!=null&&this._cachedIndexBuffer!==o&&(this._cachedIndexBuffer=o,this.bindIndexBuffer(o),this._uintIndicesCurrentlySet=o.is32Bits)},s.prototype._bindVertexBuffersAttributes=function(o,l){var u=l.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var h=0;h<u.length;h++){var d=l.getAttributeLocation(h);if(d>=0){var p=o[u[h]];if(!p)continue;this._gl.enableVertexAttribArray(d),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[d]=!0);var m=p.getBuffer();m&&(this._vertexAttribPointer(m,d,p.getSize(),p.type,p.normalized,p.byteStride,p.byteOffset),p.getIsInstanced()&&(this._gl.vertexAttribDivisor(d,p.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(m))))}}},s.prototype.recordVertexArrayObject=function(o,l,u){var h=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(h),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(o,u),this.bindIndexBuffer(l),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),h},s.prototype.bindVertexArrayObject=function(o,l){this._cachedVertexArrayObject!==o&&(this._cachedVertexArrayObject=o,this._gl.bindVertexArray(o),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=l!=null&&l.is32Bits,this._mustWipeVertexAttributes=!0)},s.prototype.bindBuffersDirectly=function(o,l,u,h,d){if(this._cachedVertexBuffers!==o||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=o,this._cachedEffectForVertexBuffers=d;var p=d.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var m=0,_=0;_<p;_++)if(_<u.length){var v=d.getAttributeLocation(_);v>=0&&(this._gl.enableVertexAttribArray(v),this._vertexAttribArraysEnabled[v]=!0,this._vertexAttribPointer(o,v,u[_],this._gl.FLOAT,!1,h,m)),m+=u[_]*4}}this._bindIndexBufferWithCache(l)},s.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},s.prototype.bindBuffers=function(o,l,u){(this._cachedVertexBuffers!==o||this._cachedEffectForVertexBuffers!==u)&&(this._cachedVertexBuffers=o,this._cachedEffectForVertexBuffers=u,this._bindVertexBuffersAttributes(o,u)),this._bindIndexBufferWithCache(l)},s.prototype.unbindInstanceAttributes=function(){for(var o,l=0,u=this._currentInstanceLocations.length;l<u;l++){var h=this._currentInstanceBuffers[l];o!=h&&h.references&&(o=h,this.bindArrayBuffer(h));var d=this._currentInstanceLocations[l];this._gl.vertexAttribDivisor(d,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},s.prototype.releaseVertexArrayObject=function(o){this._gl.deleteVertexArray(o)},s.prototype._releaseBuffer=function(o){return o.references--,o.references===0?(this._gl.deleteBuffer(o),!0):!1},s.prototype.createInstancesBuffer=function(o){var l=this._gl.createBuffer();if(!l)throw new Error("Unable to create instance buffer");return l.capacity=o,this.bindArrayBuffer(l),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,this._gl.DYNAMIC_DRAW),l},s.prototype.deleteInstancesBuffer=function(o){this._gl.deleteBuffer(o)},s.prototype.updateAndBindInstancesBuffer=function(o,l,u){if(this.bindArrayBuffer(o),l&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,l),u[0].index!==void 0){for(var h=0,d=0;d<u.length;d++){var p=u[d];h+=p.attributeSize*4}for(var d=0;d<u.length;d++){var p=u[d];this._vertexAttribArraysEnabled[p.index]||(this._gl.enableVertexAttribArray(p.index),this._vertexAttribArraysEnabled[p.index]=!0),this._vertexAttribPointer(o,p.index,p.attributeSize,p.attribyteType||this._gl.FLOAT,p.normalized||!1,h,p.offset),this._gl.vertexAttribDivisor(p.index,1),this._currentInstanceLocations.push(p.index),this._currentInstanceBuffers.push(o)}}else for(var m=0;m<4;m++){var _=u[m];this._vertexAttribArraysEnabled[_]||(this._gl.enableVertexAttribArray(_),this._vertexAttribArraysEnabled[_]=!0),this._vertexAttribPointer(o,_,4,this._gl.FLOAT,!1,64,m*16),this._gl.vertexAttribDivisor(_,1),this._currentInstanceLocations.push(_),this._currentInstanceBuffers.push(o)}},s.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},s.prototype.draw=function(o,l,u,h){this.drawElementsType(o?t.Material.TriangleFillMode:t.Material.WireFrameFillMode,l,u,h)},s.prototype.drawPointClouds=function(o,l,u){this.drawArraysType(t.Material.PointFillMode,o,l,u)},s.prototype.drawUnIndexed=function(o,l,u,h){this.drawArraysType(o?t.Material.TriangleFillMode:t.Material.WireFrameFillMode,l,u,h)},s.prototype.drawElementsType=function(o,l,u,h){this.applyStates(),this._drawCalls.addCount(1,!1);var d=this._drawMode(o),p=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,m=this._uintIndicesCurrentlySet?4:2;h?this._gl.drawElementsInstanced(d,u,p,l*m,h):this._gl.drawElements(d,u,p,l*m)},s.prototype.drawArraysType=function(o,l,u,h){this.applyStates(),this._drawCalls.addCount(1,!1);var d=this._drawMode(o);h?this._gl.drawArraysInstanced(d,l,u,h):this._gl.drawArrays(d,l,u)},s.prototype._drawMode=function(o){switch(o){case t.Material.TriangleFillMode:return this._gl.TRIANGLES;case t.Material.PointFillMode:return this._gl.POINTS;case t.Material.WireFrameFillMode:return this._gl.LINES;case t.Material.PointListDrawMode:return this._gl.POINTS;case t.Material.LineListDrawMode:return this._gl.LINES;case t.Material.LineLoopDrawMode:return this._gl.LINE_LOOP;case t.Material.LineStripDrawMode:return this._gl.LINE_STRIP;case t.Material.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case t.Material.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},s.prototype._releaseEffect=function(o){this._compiledEffects[o._key]&&(delete this._compiledEffects[o._key],this._deleteProgram(o.getProgram()))},s.prototype._deleteProgram=function(o){o&&(o.__SPECTOR_rebuildProgram=null,o.transformFeedback&&(this.deleteTransformFeedback(o.transformFeedback),o.transformFeedback=null),this._gl.deleteProgram(o))},s.prototype.createEffect=function(o,l,u,h,d,p,m,_,v){var S=o.vertexElement||o.vertex||o,P=o.fragmentElement||o.fragment||o,x=S+"+"+P+"@"+(d||l.defines);if(this._compiledEffects[x]){var R=this._compiledEffects[x];return m&&R.isReady()&&m(R),R}var w=new t.Effect(o,l,u,h,this,d,p,m,_,v);return w._key=x,this._compiledEffects[x]=w,w},s.prototype._compileShader=function(o,l,u,h){return this._compileRawShader(h+(u?u+`
`:"")+o,l)},s.prototype._compileRawShader=function(o,l){var u=this._gl,h=u.createShader(l==="vertex"?u.VERTEX_SHADER:u.FRAGMENT_SHADER);if(!h)throw new Error("Something went wrong while compile the shader.");if(u.shaderSource(h,o),u.compileShader(h),!u.getShaderParameter(h,u.COMPILE_STATUS)){var d=u.getShaderInfoLog(h);if(d)throw new Error(d)}return h},s.prototype.createRawShaderProgram=function(o,l,u,h){h===void 0&&(h=null),u=u||this._gl;var d=this._compileRawShader(o,"vertex"),p=this._compileRawShader(l,"fragment");return this._createShaderProgram(d,p,u,h)},s.prototype.createShaderProgram=function(o,l,u,h,d){d===void 0&&(d=null),h=h||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var p=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",m=this._compileShader(o,"vertex",u,p),_=this._compileShader(l,"fragment",u,p),v=this._createShaderProgram(m,_,h,d);return this.onAfterShaderCompilationObservable.notifyObservers(this),v},s.prototype._createShaderProgram=function(o,l,u,h){h===void 0&&(h=null);var d=u.createProgram();if(!d)throw new Error("Unable to create program");if(u.attachShader(d,o),u.attachShader(d,l),this.webGLVersion>1&&h){var p=this.createTransformFeedback();this.bindTransformFeedback(p),this.setTranformFeedbackVaryings(d,h),d.transformFeedback=p}u.linkProgram(d),this.webGLVersion>1&&h&&this.bindTransformFeedback(null);var m=u.getProgramParameter(d,u.LINK_STATUS);if(!m){var _=u.getProgramInfoLog(d);if(_)throw new Error(_)}if(this.validateShaderPrograms){u.validateProgram(d);var v=u.getProgramParameter(d,u.VALIDATE_STATUS);if(!v){var _=u.getProgramInfoLog(d);if(_)throw new Error(_)}}return u.deleteShader(o),u.deleteShader(l),d},s.prototype.getUniforms=function(o,l){for(var u=new Array,h=0;h<l.length;h++)u.push(this._gl.getUniformLocation(o,l[h]));return u},s.prototype.getAttributes=function(o,l){for(var u=[],h=0;h<l.length;h++)try{u.push(this._gl.getAttribLocation(o,l[h]))}catch{u.push(-1)}return u},s.prototype.enableEffect=function(o){!o||o===this._currentEffect||(this.bindSamplers(o),this._currentEffect=o,o.onBind&&o.onBind(o),o._onBindObservable&&o._onBindObservable.notifyObservers(o))},s.prototype.setIntArray=function(o,l){o&&this._gl.uniform1iv(o,l)},s.prototype.setIntArray2=function(o,l){!o||l.length%2!==0||this._gl.uniform2iv(o,l)},s.prototype.setIntArray3=function(o,l){!o||l.length%3!==0||this._gl.uniform3iv(o,l)},s.prototype.setIntArray4=function(o,l){!o||l.length%4!==0||this._gl.uniform4iv(o,l)},s.prototype.setFloatArray=function(o,l){o&&this._gl.uniform1fv(o,l)},s.prototype.setFloatArray2=function(o,l){!o||l.length%2!==0||this._gl.uniform2fv(o,l)},s.prototype.setFloatArray3=function(o,l){!o||l.length%3!==0||this._gl.uniform3fv(o,l)},s.prototype.setFloatArray4=function(o,l){!o||l.length%4!==0||this._gl.uniform4fv(o,l)},s.prototype.setArray=function(o,l){o&&this._gl.uniform1fv(o,l)},s.prototype.setArray2=function(o,l){!o||l.length%2!==0||this._gl.uniform2fv(o,l)},s.prototype.setArray3=function(o,l){!o||l.length%3!==0||this._gl.uniform3fv(o,l)},s.prototype.setArray4=function(o,l){!o||l.length%4!==0||this._gl.uniform4fv(o,l)},s.prototype.setMatrices=function(o,l){o&&this._gl.uniformMatrix4fv(o,!1,l)},s.prototype.setMatrix=function(o,l){o&&this._gl.uniformMatrix4fv(o,!1,l.toArray())},s.prototype.setMatrix3x3=function(o,l){o&&this._gl.uniformMatrix3fv(o,!1,l)},s.prototype.setMatrix2x2=function(o,l){o&&this._gl.uniformMatrix2fv(o,!1,l)},s.prototype.setInt=function(o,l){o&&this._gl.uniform1i(o,l)},s.prototype.setFloat=function(o,l){o&&this._gl.uniform1f(o,l)},s.prototype.setFloat2=function(o,l,u){o&&this._gl.uniform2f(o,l,u)},s.prototype.setFloat3=function(o,l,u,h){o&&this._gl.uniform3f(o,l,u,h)},s.prototype.setBool=function(o,l){o&&this._gl.uniform1i(o,l)},s.prototype.setFloat4=function(o,l,u,h,d){o&&this._gl.uniform4f(o,l,u,h,d)},s.prototype.setColor3=function(o,l){o&&this._gl.uniform3f(o,l.r,l.g,l.b)},s.prototype.setColor4=function(o,l,u){o&&this._gl.uniform4f(o,l.r,l.g,l.b,u)},s.prototype.setDirectColor4=function(o,l){o&&this._gl.uniform4f(o,l.r,l.g,l.b,l.a)},s.prototype.setState=function(o,l,u,h){l===void 0&&(l=0),h===void 0&&(h=!1),(this._depthCullingState.cull!==o||u)&&(this._depthCullingState.cull=o);var d=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==d||u)&&(this._depthCullingState.cullFace=d),this.setZOffset(l);var p=h?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==p||u)&&(this._depthCullingState.frontFace=p)},s.prototype.setZOffset=function(o){this._depthCullingState.zOffset=o},s.prototype.getZOffset=function(){return this._depthCullingState.zOffset},s.prototype.setDepthBuffer=function(o){this._depthCullingState.depthTest=o},s.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},s.prototype.setDepthWrite=function(o){this._depthCullingState.depthMask=o},s.prototype.setColorWrite=function(o){this._gl.colorMask(o,o,o,o),this._colorWrite=o},s.prototype.getColorWrite=function(){return this._colorWrite},s.prototype.setAlphaConstants=function(o,l,u,h){this._alphaState.setAlphaBlendConstants(o,l,u,h)},s.prototype.setAlphaMode=function(o,l){if(l===void 0&&(l=!1),this._alphaMode!==o){switch(o){case s.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case s.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case s.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case s.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case s.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break}l||this.setDepthWrite(o===s.ALPHA_DISABLE),this._alphaMode=o}},s.prototype.getAlphaMode=function(){return this._alphaMode},s.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},s.prototype.wipeCaches=function(o){this.preventCacheWipeBetweenFrames&&!o||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,o&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},s.prototype.setTextureFormatToUse=function(o){for(var l=0,u=this.texturesSupported.length;l<u;l++)for(var h=0,d=o.length;h<d;h++)if(this._texturesSupported[l]===o[h].toLowerCase())return this._textureFormatInUse=this._texturesSupported[l];return this._textureFormatInUse=null,null},s.prototype._getSamplingParameters=function(o,l){var u=this._gl,h=u.NEAREST,d=u.NEAREST;switch(o){case s.TEXTURE_BILINEAR_SAMPLINGMODE:h=u.LINEAR,l?d=u.LINEAR_MIPMAP_NEAREST:d=u.LINEAR;break;case s.TEXTURE_TRILINEAR_SAMPLINGMODE:h=u.LINEAR,l?d=u.LINEAR_MIPMAP_LINEAR:d=u.LINEAR;break;case s.TEXTURE_NEAREST_SAMPLINGMODE:h=u.NEAREST,l?d=u.NEAREST_MIPMAP_LINEAR:d=u.NEAREST;break;case s.TEXTURE_NEAREST_NEAREST_MIPNEAREST:h=u.NEAREST,l?d=u.NEAREST_MIPMAP_NEAREST:d=u.NEAREST;break;case s.TEXTURE_NEAREST_LINEAR_MIPNEAREST:h=u.NEAREST,l?d=u.LINEAR_MIPMAP_NEAREST:d=u.LINEAR;break;case s.TEXTURE_NEAREST_LINEAR_MIPLINEAR:h=u.NEAREST,l?d=u.LINEAR_MIPMAP_LINEAR:d=u.LINEAR;break;case s.TEXTURE_NEAREST_LINEAR:h=u.NEAREST,d=u.LINEAR;break;case s.TEXTURE_NEAREST_NEAREST:h=u.NEAREST,d=u.NEAREST;break;case s.TEXTURE_LINEAR_NEAREST_MIPNEAREST:h=u.LINEAR,l?d=u.NEAREST_MIPMAP_NEAREST:d=u.NEAREST;break;case s.TEXTURE_LINEAR_NEAREST_MIPLINEAR:h=u.LINEAR,l?d=u.NEAREST_MIPMAP_LINEAR:d=u.NEAREST;break;case s.TEXTURE_LINEAR_LINEAR:h=u.LINEAR,d=u.LINEAR;break;case s.TEXTURE_LINEAR_NEAREST:h=u.LINEAR,d=u.NEAREST;break}return{min:d,mag:h}},s.prototype._partialLoadImg=function(o,l,u,h,d,p){p===void 0&&(p=null);var m,_=function(){u[l]=m,u._internalCount++,h&&h._removePendingData(m),u._internalCount===6&&d(u)},v=function(S,P){h&&h._removePendingData(m),p&&p(S,P)};m=t.Tools.LoadImage(o,_,v,h?h.database:null),h&&h._addPendingData(m)},s.prototype._cascadeLoadImgs=function(o,l,u,h,d){d===void 0&&(d=null);var p=[];p._internalCount=0;for(var m=0;m<6;m++)this._partialLoadImg(h[m],m,p,l,u,d)},s.prototype._createTexture=function(){var o=this._gl.createTexture();if(!o)throw new Error("Unable to create texture");return o},s.prototype.createTexture=function(o,l,u,h,d,p,m,_,v,S,P){var x=this;d===void 0&&(d=s.TEXTURE_TRILINEAR_SAMPLINGMODE),p===void 0&&(p=null),m===void 0&&(m=null),_===void 0&&(_=null),v===void 0&&(v=null),S===void 0&&(S=null),P===void 0&&(P=null);for(var R=String(o),w=R.substr(0,5)==="data:",I=R.substr(0,5)==="blob:",F=w&&R.indexOf(";base64,")!==-1,k=v||new t.InternalTexture(this,t.InternalTexture.DATASOURCE_URL),E=R.lastIndexOf("."),g=P||(E>-1?R.substring(E).toLowerCase():""),y=null,M=0,C=s._TextureLoaders;M<C.length;M++){var D=C[M];if(D.canLoad(g,this._textureFormatInUse,v,F,!!_)){y=D;break}}y&&(R=y.transformUrl(R,this._textureFormatInUse)),h&&h._addPendingData(k),k.url=R,k.generateMipMaps=!l,k.samplingMode=d,k.invertY=u,this._doNotHandleContextLost||(k._buffer=_);var V=null;p&&!v&&(V=k.onLoadedObservable.add(p)),v||this._internalTexturesCache.push(k);var G=function(H,W){h&&h._removePendingData(k);var X=!1;if(y){var K=y.getFallbackTextureUrl(R,x._textureFormatInUse);K&&(X=!0,x.createTexture(o,l,u,h,d,null,m,_,k))}X||(V&&k.onLoadedObservable.remove(V),t.Tools.UseFallbackTexture&&x.createTexture(t.Tools.fallbackTexture,l,u,h,d,null,m,_,k)),m&&m(H||"Unknown error",W)};if(y){var U=function(H){y.loadData(H,k,function(W,X,K,j,ee){x._prepareWebGLTexture(k,h,W,X,u,!K,j,function(){return ee(),!1},d)})};_?U(_):this._loadFile(R,U,void 0,h?h.database:void 0,!0,function(H,W){G("Unable to load "+(H&&H.responseURL,W))})}else{var z=function(H){I&&!x._doNotHandleContextLost&&(k._buffer=H),x._prepareWebGLTexture(k,h,H.width,H.height,u,l,!1,function(W,X,K){var j=x._gl,ee=H.width===W&&H.height===X,$=S?x._getInternalFormat(S):g===".jpg"?j.RGB:j.RGBA;if(ee)return j.texImage2D(j.TEXTURE_2D,0,$,$,j.UNSIGNED_BYTE,H),!1;var L=x._caps.maxTextureSize;if(H.width>L||H.height>L)return x._prepareWorkingCanvas(),!x._workingCanvas||!x._workingContext||(x._workingCanvas.width=W,x._workingCanvas.height=X,x._workingContext.drawImage(H,0,0,H.width,H.height,0,0,W,X),j.texImage2D(j.TEXTURE_2D,0,$,$,j.UNSIGNED_BYTE,x._workingCanvas),k.width=W,k.height=X),!1;var Q=new t.InternalTexture(x,t.InternalTexture.DATASOURCE_TEMP);return x._bindTextureDirectly(j.TEXTURE_2D,Q,!0),j.texImage2D(j.TEXTURE_2D,0,$,$,j.UNSIGNED_BYTE,H),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),x._rescaleTexture(Q,k,h,$,function(){x._releaseTexture(Q),x._bindTextureDirectly(j.TEXTURE_2D,k,!0),K()}),!0},d)};!w||F?_ instanceof HTMLImageElement?z(_):t.Tools.LoadImage(R,z,G,h?h.database:null):typeof _=="string"||_ instanceof ArrayBuffer||_ instanceof Blob?t.Tools.LoadImage(_,z,G,h?h.database:null):z(_)}return k},s.prototype._rescaleTexture=function(o,l,u,h,d){var p=this,m=this.createRenderTargetTexture({width:l.width,height:l.height},{generateMipMaps:!1,type:s.TEXTURETYPE_UNSIGNED_INT,samplingMode:s.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});this._rescalePostProcess||(this._rescalePostProcess=new t.PassPostProcess("rescale",1,null,s.TEXTURE_BILINEAR_SAMPLINGMODE,this,!1,s.TEXTURETYPE_UNSIGNED_INT)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){p._rescalePostProcess.onApply=function(v){v._bindTexture("textureSampler",o)};var _=u;_||(_=p.scenes[p.scenes.length-1]),_.postProcessManager.directRender([p._rescalePostProcess],m,!0),p._bindTextureDirectly(p._gl.TEXTURE_2D,l,!0),p._gl.copyTexImage2D(p._gl.TEXTURE_2D,0,h,0,0,l.width,l.height,0),p.unBindFramebuffer(m),p._releaseTexture(m),d&&d()})},s.prototype.updateRawTexture=function(o,l,u,h,d,p){if(d===void 0&&(d=null),p===void 0&&(p=s.TEXTURETYPE_UNSIGNED_INT),!!o){var m=this._getRGBABufferInternalSizedFormat(p,u),_=this._getInternalFormat(u),v=this._getWebGLTextureType(p);this._bindTextureDirectly(this._gl.TEXTURE_2D,o,!0),this._unpackFlipY(h===void 0?!0:!!h),this._doNotHandleContextLost||(o._bufferView=l,o.format=u,o.type=p,o.invertY=h,o._compression=d),o.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&l?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[d],o.width,o.height,0,l):this._gl.texImage2D(this._gl.TEXTURE_2D,0,m,o.width,o.height,0,_,v,l),o.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),o.isReady=!0}},s.prototype.createRawTexture=function(o,l,u,h,d,p,m,_,v){_===void 0&&(_=null),v===void 0&&(v=s.TEXTURETYPE_UNSIGNED_INT);var S=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_RAW);S.baseWidth=l,S.baseHeight=u,S.width=l,S.height=u,S.format=h,S.generateMipMaps=d,S.samplingMode=m,S.invertY=p,S._compression=_,S.type=v,this._doNotHandleContextLost||(S._bufferView=o),this.updateRawTexture(S,o,h,p,_,v),this._bindTextureDirectly(this._gl.TEXTURE_2D,S,!0);var P=this._getSamplingParameters(m,d);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,P.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,P.min),d&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(S),S},s.prototype._unpackFlipY=function(o){this._unpackFlipYCached!==o&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,o?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=o))},s.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},s.prototype.createDynamicTexture=function(o,l,u,h){var d=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_DYNAMIC);return d.baseWidth=o,d.baseHeight=l,u&&(o=this.needPOTTextures?t.Tools.GetExponentOfTwo(o,this._caps.maxTextureSize):o,l=this.needPOTTextures?t.Tools.GetExponentOfTwo(l,this._caps.maxTextureSize):l),d.width=o,d.height=l,d.isReady=!1,d.generateMipMaps=u,d.samplingMode=h,this.updateTextureSamplingMode(h,d),this._internalTexturesCache.push(d),d},s.prototype.updateTextureSamplingMode=function(o,l){var u=this._getSamplingParameters(o,l.generateMipMaps);l.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,u.mag,l),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,u.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):l.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,u.mag,l),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,u.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,u.mag,l),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,u.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),l.samplingMode=o},s.prototype.updateDynamicTexture=function(o,l,u,h,d){if(h===void 0&&(h=!1),!!o){this._bindTextureDirectly(this._gl.TEXTURE_2D,o,!0),this._unpackFlipY(u),h&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var p=d?this._getInternalFormat(d):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,p,p,this._gl.UNSIGNED_BYTE,l),o.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),h&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o.isReady=!0}},s.prototype.updateVideoTexture=function(o,l,u){if(!(!o||o._isDisabled)){var h=this._bindTextureDirectly(this._gl.TEXTURE_2D,o,!0);this._unpackFlipY(!u);try{if(this._videoTextureSupported===void 0&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,l),this._gl.getError()!==0?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,l);else{if(!o._workingCanvas){o._workingCanvas=document.createElement("canvas");var d=o._workingCanvas.getContext("2d");if(!d)throw new Error("Unable to get 2d context");o._workingContext=d,o._workingCanvas.width=o.width,o._workingCanvas.height=o.height}o._workingContext.drawImage(l,0,0,l.videoWidth,l.videoHeight,0,0,o.width,o.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,o._workingCanvas)}o.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),h||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),o.isReady=!0}catch{o._isDisabled=!0}}},s.prototype.updateTextureComparisonFunction=function(o,l){if(this.webGLVersion===1){t.Tools.Error("WebGL 1 does not support texture comparison.");return}var u=this._gl;o.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o,!0),l===0?(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_COMPARE_FUNC,s.LEQUAL),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_COMPARE_FUNC,l),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,o,!0),l===0?(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_COMPARE_FUNC,s.LEQUAL),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_COMPARE_MODE,u.NONE)):(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_COMPARE_FUNC,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),o._comparisonFunction=l},s.prototype._setupDepthStencilTexture=function(o,l,u,h,d){var p=l.width||l,m=l.height||l;o.baseWidth=p,o.baseHeight=m,o.width=p,o.height=m,o.isReady=!0,o.samples=1,o.generateMipMaps=!1,o._generateDepthBuffer=!0,o._generateStencilBuffer=u,o.samplingMode=h?s.TEXTURE_BILINEAR_SAMPLINGMODE:s.TEXTURE_NEAREST_SAMPLINGMODE,o.type=s.TEXTURETYPE_UNSIGNED_INT,o._comparisonFunction=d;var _=this._gl,v=o.isCube?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D,S=this._getSamplingParameters(o.samplingMode,!1);_.texParameteri(v,_.TEXTURE_MAG_FILTER,S.mag),_.texParameteri(v,_.TEXTURE_MIN_FILTER,S.min),_.texParameteri(v,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(v,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),d===0?(_.texParameteri(v,_.TEXTURE_COMPARE_FUNC,s.LEQUAL),_.texParameteri(v,_.TEXTURE_COMPARE_MODE,_.NONE)):(_.texParameteri(v,_.TEXTURE_COMPARE_FUNC,d),_.texParameteri(v,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE))},s.prototype.createDepthStencilTexture=function(o,l){if(l.isCube){var u=o.width||o;return this._createDepthStencilCubeTexture(u,l)}else return this._createDepthStencilTexture(o,l)},s.prototype._createDepthStencilTexture=function(o,l){var u=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return t.Tools.Error("Depth texture is not supported by your browser or hardware."),u;var h=Ve({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},l),d=this._gl;return this._bindTextureDirectly(d.TEXTURE_2D,u,!0),this._setupDepthStencilTexture(u,o,h.generateStencil,h.bilinearFiltering,h.comparisonFunction),this.webGLVersion>1?h.generateStencil?d.texImage2D(d.TEXTURE_2D,0,d.DEPTH24_STENCIL8,u.width,u.height,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_2D,0,d.DEPTH_COMPONENT24,u.width,u.height,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null):h.generateStencil?d.texImage2D(d.TEXTURE_2D,0,d.DEPTH_STENCIL,u.width,u.height,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_2D,0,d.DEPTH_COMPONENT,u.width,u.height,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null),this._bindTextureDirectly(d.TEXTURE_2D,null),u},s.prototype._createDepthStencilCubeTexture=function(o,l){var u=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_UNKNOWN);if(u.isCube=!0,this.webGLVersion===1)return t.Tools.Error("Depth cube texture is not supported by WebGL 1."),u;var h=Ve({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},l),d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,u,!0),this._setupDepthStencilTexture(u,o,h.generateStencil,h.bilinearFiltering,h.comparisonFunction);for(var p=0;p<6;p++)h.generateStencil?d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,d.DEPTH24_STENCIL8,o,o,0,d.DEPTH_STENCIL,d.UNSIGNED_INT_24_8,null):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,d.DEPTH_COMPONENT24,o,o,0,d.DEPTH_COMPONENT,d.UNSIGNED_INT,null);return this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),u},s.prototype.setFrameBufferDepthStencilTexture=function(o){var l=o.getInternalTexture();if(!(!l||!l._framebuffer||!o.depthStencilTexture)){var u=this._gl,h=o.depthStencilTexture;this.bindUnboundFramebuffer(l._framebuffer),h.isCube?h._generateStencilBuffer?u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_CUBE_MAP_POSITIVE_X,h._webGLTexture,0):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_CUBE_MAP_POSITIVE_X,h._webGLTexture,0):h._generateStencilBuffer?u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.TEXTURE_2D,h._webGLTexture,0):u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.TEXTURE_2D,h._webGLTexture,0),this.bindUnboundFramebuffer(null)}},s.prototype.createRenderTargetTexture=function(o,l){var u=new r;l!==void 0&&typeof l=="object"?(u.generateMipMaps=l.generateMipMaps,u.generateDepthBuffer=l.generateDepthBuffer===void 0?!0:l.generateDepthBuffer,u.generateStencilBuffer=u.generateDepthBuffer&&l.generateStencilBuffer,u.type=l.type===void 0?s.TEXTURETYPE_UNSIGNED_INT:l.type,u.samplingMode=l.samplingMode===void 0?s.TEXTURE_TRILINEAR_SAMPLINGMODE:l.samplingMode,u.format=l.format===void 0?s.TEXTUREFORMAT_RGBA:l.format):(u.generateMipMaps=l,u.generateDepthBuffer=!0,u.generateStencilBuffer=!1,u.type=s.TEXTURETYPE_UNSIGNED_INT,u.samplingMode=s.TEXTURE_TRILINEAR_SAMPLINGMODE,u.format=s.TEXTUREFORMAT_RGBA),(u.type===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloatLinearFiltering||u.type===s.TEXTURETYPE_HALF_FLOAT&&!this._caps.textureHalfFloatLinearFiltering)&&(u.samplingMode=s.TEXTURE_NEAREST_SAMPLINGMODE);var h=this._gl,d=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(h.TEXTURE_2D,d,!0);var p=o.width||o,m=o.height||o,_=this._getSamplingParameters(u.samplingMode,!!u.generateMipMaps);u.type===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloat&&(u.type=s.TEXTURETYPE_UNSIGNED_INT,t.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,_.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,_.min),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(u.type,u.format),p,m,0,this._getInternalFormat(u.format),this._getWebGLTextureType(u.type),null);var v=this._currentFramebuffer,S=h.createFramebuffer();return this.bindUnboundFramebuffer(S),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,d._webGLTexture,0),d._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!u.generateStencilBuffer,u.generateDepthBuffer,p,m),u.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),h.bindRenderbuffer(h.RENDERBUFFER,null),this.bindUnboundFramebuffer(v),d._framebuffer=S,d.baseWidth=p,d.baseHeight=m,d.width=p,d.height=m,d.isReady=!0,d.samples=1,d.generateMipMaps=!!u.generateMipMaps,d.samplingMode=u.samplingMode,d.type=u.type,d.format=u.format,d._generateDepthBuffer=u.generateDepthBuffer,d._generateStencilBuffer=!!u.generateStencilBuffer,this._internalTexturesCache.push(d),d},s.prototype.createMultipleRenderTarget=function(o,l){var u=!1,h=!0,d=!1,p=!1,m=1,_=s.TEXTURETYPE_UNSIGNED_INT,v=s.TEXTURE_TRILINEAR_SAMPLINGMODE,S=new Array,P=new Array;l!==void 0&&(u=l.generateMipMaps===void 0?!1:l.generateMipMaps,h=l.generateDepthBuffer===void 0?!0:l.generateDepthBuffer,d=l.generateStencilBuffer===void 0?!1:l.generateStencilBuffer,p=l.generateDepthTexture===void 0?!1:l.generateDepthTexture,m=l.textureCount||1,l.types&&(S=l.types),l.samplingModes&&(P=l.samplingModes));var x=this._gl,R=x.createFramebuffer();this.bindUnboundFramebuffer(R);for(var w=o.width||o,I=o.height||o,F=[],k=[],E=this._setupFramebufferDepthAttachments(d,h,w,I),g=0;g<m;g++){var y=P[g]||v,M=S[g]||_;(M===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloatLinearFiltering||M===s.TEXTURETYPE_HALF_FLOAT&&!this._caps.textureHalfFloatLinearFiltering)&&(y=s.TEXTURE_NEAREST_SAMPLINGMODE);var C=this._getSamplingParameters(y,u);M===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloat&&(M=s.TEXTURETYPE_UNSIGNED_INT,t.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var D=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_MULTIRENDERTARGET),V=x[this.webGLVersion>1?"COLOR_ATTACHMENT"+g:"COLOR_ATTACHMENT"+g+"_WEBGL"];F.push(D),k.push(V),x.activeTexture(x["TEXTURE"+g]),x.bindTexture(x.TEXTURE_2D,D._webGLTexture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,C.mag),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,C.min),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texImage2D(x.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(M),w,I,0,x.RGBA,this._getWebGLTextureType(M),null),x.framebufferTexture2D(x.DRAW_FRAMEBUFFER,V,x.TEXTURE_2D,D._webGLTexture,0),u&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(x.TEXTURE_2D,null),D._framebuffer=R,D._depthStencilBuffer=E,D.baseWidth=w,D.baseHeight=I,D.width=w,D.height=I,D.isReady=!0,D.samples=1,D.generateMipMaps=u,D.samplingMode=y,D.type=M,D._generateDepthBuffer=h,D._generateStencilBuffer=d,D._attachments=k,this._internalTexturesCache.push(D)}if(p&&this._caps.depthTextureExtension){var G=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_MULTIRENDERTARGET);x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,G._webGLTexture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texImage2D(x.TEXTURE_2D,0,this.webGLVersion<2?x.DEPTH_COMPONENT:x.DEPTH_COMPONENT16,w,I,0,x.DEPTH_COMPONENT,x.UNSIGNED_SHORT,null),x.framebufferTexture2D(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.TEXTURE_2D,G._webGLTexture,0),G._framebuffer=R,G.baseWidth=w,G.baseHeight=I,G.width=w,G.height=I,G.isReady=!0,G.samples=1,G.generateMipMaps=u,G.samplingMode=x.NEAREST,G._generateDepthBuffer=h,G._generateStencilBuffer=d,F.push(G),this._internalTexturesCache.push(G)}return x.drawBuffers(k),x.bindRenderbuffer(x.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),F},s.prototype._setupFramebufferDepthAttachments=function(o,l,u,h,d){d===void 0&&(d=1);var p=null,m=this._gl;return o?(p=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,p),d>1?m.renderbufferStorageMultisample(m.RENDERBUFFER,d,m.DEPTH24_STENCIL8,u,h):m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,u,h),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,p)):l&&(p=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,p),d>1?m.renderbufferStorageMultisample(m.RENDERBUFFER,d,m.DEPTH_COMPONENT16,u,h):m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_COMPONENT16,u,h),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,p)),p},s.prototype.updateRenderTargetTextureSampleCount=function(o,l){if(this.webGLVersion<2||!o)return 1;if(o.samples===l)return l;var u=this._gl;if(l=Math.min(l,u.getParameter(u.MAX_SAMPLES)),o._depthStencilBuffer&&(u.deleteRenderbuffer(o._depthStencilBuffer),o._depthStencilBuffer=null),o._MSAAFramebuffer&&(u.deleteFramebuffer(o._MSAAFramebuffer),o._MSAAFramebuffer=null),o._MSAARenderBuffer&&(u.deleteRenderbuffer(o._MSAARenderBuffer),o._MSAARenderBuffer=null),l>1){var h=u.createFramebuffer();if(!h)throw new Error("Unable to create multi sampled framebuffer");o._MSAAFramebuffer=h,this.bindUnboundFramebuffer(o._MSAAFramebuffer);var d=u.createRenderbuffer();if(!d)throw new Error("Unable to create multi sampled framebuffer");u.bindRenderbuffer(u.RENDERBUFFER,d),u.renderbufferStorageMultisample(u.RENDERBUFFER,l,this._getRGBAMultiSampleBufferFormat(o.type),o.width,o.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.RENDERBUFFER,d),o._MSAARenderBuffer=d}else this.bindUnboundFramebuffer(o._framebuffer);return o.samples=l,o._depthStencilBuffer=this._setupFramebufferDepthAttachments(o._generateStencilBuffer,o._generateDepthBuffer,o.width,o.height,l),u.bindRenderbuffer(u.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),l},s.prototype.updateMultipleRenderTargetTextureSampleCount=function(o,l){if(this.webGLVersion<2||!o||o.length==0)return 1;if(o[0].samples===l)return l;var u=this._gl;l=Math.min(l,u.getParameter(u.MAX_SAMPLES)),o[0]._depthStencilBuffer&&(u.deleteRenderbuffer(o[0]._depthStencilBuffer),o[0]._depthStencilBuffer=null),o[0]._MSAAFramebuffer&&(u.deleteFramebuffer(o[0]._MSAAFramebuffer),o[0]._MSAAFramebuffer=null);for(var h=0;h<o.length;h++)o[h]._MSAARenderBuffer&&(u.deleteRenderbuffer(o[h]._MSAARenderBuffer),o[h]._MSAARenderBuffer=null);if(l>1){var d=u.createFramebuffer();if(!d)throw new Error("Unable to create multi sampled framebuffer");this.bindUnboundFramebuffer(d);for(var p=this._setupFramebufferDepthAttachments(o[0]._generateStencilBuffer,o[0]._generateDepthBuffer,o[0].width,o[0].height,l),m=[],h=0;h<o.length;h++){var _=o[h],v=u[this.webGLVersion>1?"COLOR_ATTACHMENT"+h:"COLOR_ATTACHMENT"+h+"_WEBGL"],S=u.createRenderbuffer();if(!S)throw new Error("Unable to create multi sampled framebuffer");u.bindRenderbuffer(u.RENDERBUFFER,S),u.renderbufferStorageMultisample(u.RENDERBUFFER,l,this._getRGBAMultiSampleBufferFormat(_.type),_.width,_.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,v,u.RENDERBUFFER,S),_._MSAAFramebuffer=d,_._MSAARenderBuffer=S,_.samples=l,_._depthStencilBuffer=p,u.bindRenderbuffer(u.RENDERBUFFER,null),m.push(v)}u.drawBuffers(m)}else this.bindUnboundFramebuffer(o[0]._framebuffer);return this.bindUnboundFramebuffer(null),l},s.prototype._uploadCompressedDataToTextureDirectly=function(o,l,u,h,d,p,m){p===void 0&&(p=0),m===void 0&&(m=0);var _=this._gl,v=_.TEXTURE_2D;o.isCube&&(v=_.TEXTURE_CUBE_MAP_POSITIVE_X+p),this._gl.compressedTexImage2D(v,m,l,u,h,0,d)},s.prototype._uploadDataToTextureDirectly=function(o,l,u,h){u===void 0&&(u=0),h===void 0&&(h=0);var d=this._gl,p=this._getWebGLTextureType(o.type),m=this._getInternalFormat(o.format),_=this._getRGBABufferInternalSizedFormat(o.type,m);this._unpackFlipY(o.invertY);var v=d.TEXTURE_2D;o.isCube&&(v=d.TEXTURE_CUBE_MAP_POSITIVE_X+u);var S=Math.round(t.Scalar.Log2(o.width)),P=Math.round(t.Scalar.Log2(o.height)),x=Math.pow(2,Math.max(S-h,0)),R=Math.pow(2,Math.max(P-h,0));d.texImage2D(v,h,_,x,R,0,m,p,l)},s.prototype._uploadArrayBufferViewToTexture=function(o,l,u,h){u===void 0&&(u=0),h===void 0&&(h=0);var d=this._gl,p=o.isCube?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._bindTextureDirectly(p,o,!0),this._uploadDataToTextureDirectly(o,l,u,h),this._bindTextureDirectly(p,null,!0)},s.prototype._uploadImageToTexture=function(o,l,u,h){u===void 0&&(u=0),h===void 0&&(h=0);var d=this._gl,p=this._getWebGLTextureType(o.type),m=this._getInternalFormat(o.format),_=this._getRGBABufferInternalSizedFormat(o.type,m),v=o.isCube?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._bindTextureDirectly(v,o,!0),this._unpackFlipY(o.invertY);var S=d.TEXTURE_2D;o.isCube&&(S=d.TEXTURE_CUBE_MAP_POSITIVE_X+u),d.texImage2D(S,h,_,m,p,l),this._bindTextureDirectly(v,null,!0)},s.prototype.createRenderTargetCubeTexture=function(o,l){var u=Ve({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:s.TEXTURETYPE_UNSIGNED_INT,samplingMode:s.TEXTURE_TRILINEAR_SAMPLINGMODE,format:s.TEXTUREFORMAT_RGBA},l);u.generateStencilBuffer=u.generateDepthBuffer&&u.generateStencilBuffer,(u.type===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloatLinearFiltering||u.type===s.TEXTURETYPE_HALF_FLOAT&&!this._caps.textureHalfFloatLinearFiltering)&&(u.samplingMode=s.TEXTURE_NEAREST_SAMPLINGMODE);var h=this._gl,d=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,d,!0);var p=this._getSamplingParameters(u.samplingMode,u.generateMipMaps);u.type===s.TEXTURETYPE_FLOAT&&!this._caps.textureFloat&&(u.type=s.TEXTURETYPE_UNSIGNED_INT,t.Tools.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,p.mag),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,p.min),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);for(var m=0;m<6;m++)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,this._getRGBABufferInternalSizedFormat(u.type,u.format),o,o,0,this._getInternalFormat(u.format),this._getWebGLTextureType(u.type),null);var _=h.createFramebuffer();return this.bindUnboundFramebuffer(_),d._depthStencilBuffer=this._setupFramebufferDepthAttachments(u.generateStencilBuffer,u.generateDepthBuffer,o,o),u.generateMipMaps&&h.generateMipmap(h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null),h.bindRenderbuffer(h.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),d._framebuffer=_,d.width=o,d.height=o,d.isReady=!0,d.isCube=!0,d.samples=1,d.generateMipMaps=u.generateMipMaps,d.samplingMode=u.samplingMode,d.type=u.type,d.format=u.format,d._generateDepthBuffer=u.generateDepthBuffer,d._generateStencilBuffer=u.generateStencilBuffer,this._internalTexturesCache.push(d),d},s.prototype.createPrefilteredCubeTexture=function(o,l,u,h,d,p,m,_,v){var S=this;d===void 0&&(d=null),p===void 0&&(p=null),_===void 0&&(_=null),v===void 0&&(v=!0);var P=function(x){if(!x){d&&d(null);return}var R=x.texture;if(v?x.info.sphericalPolynomial&&(R._sphericalPolynomial=x.info.sphericalPolynomial):R._sphericalPolynomial=new t.SphericalPolynomial,R._dataSource=t.InternalTexture.DATASOURCE_CUBEPREFILTERED,S._caps.textureLOD){d&&d(R);return}var w=3,I=S._gl,F=x.width;if(F){for(var k=[],E=0;E<w;E++){var g=E/(w-1),y=1-g,M=h,C=t.Scalar.Log2(F)*u+h,D=M+(C-M)*y,V=Math.round(Math.min(Math.max(D,0),C)),G=new t.InternalTexture(S,t.InternalTexture.DATASOURCE_TEMP);if(G.type=R.type,G.format=R.format,G.width=Math.pow(2,Math.max(t.Scalar.Log2(F)-V,0)),G.height=G.width,G.isCube=!0,S._bindTextureDirectly(I.TEXTURE_CUBE_MAP,G,!0),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),x.isDDS){var U=x.info,z=x.data;S._unpackFlipY(U.isCompressed),t.DDSTools.UploadDDSLevels(S,G,z,U,!0,6,V)}else t.Tools.Warn("DDS is the only prefiltered cube map supported so far.");S._bindTextureDirectly(I.TEXTURE_CUBE_MAP,null);var H=new t.BaseTexture(l);H.isCube=!0,H._texture=G,G.isReady=!0,k.push(H)}R._lodTextureHigh=k[2],R._lodTextureMid=k[1],R._lodTextureLow=k[0],d&&d(R)}};return this.createCubeTexture(o,l,null,!1,P,p,m,_,v,u,h)},s.prototype.createCubeTexture=function(o,l,u,h,d,p,m,_,v,S,P,x){var R=this;d===void 0&&(d=null),p===void 0&&(p=null),_===void 0&&(_=null),v===void 0&&(v=!1),S===void 0&&(S=0),P===void 0&&(P=0),x===void 0&&(x=null);var w=this._gl,I=x||new t.InternalTexture(this,t.InternalTexture.DATASOURCE_CUBE);I.isCube=!0,I.url=o,I.generateMipMaps=!h,I._lodGenerationScale=S,I._lodGenerationOffset=P,this._doNotHandleContextLost||(I._extension=_,I._files=u);for(var F=o.lastIndexOf("."),k=_||(F>-1?o.substring(F).toLowerCase():""),E=null,g=0,y=s._TextureLoaders;g<y.length;g++){var M=y[g];if(M.canLoad(k,this._textureFormatInUse,x,!1,!1)){E=M;break}}var C=function(V,G){if(E){var U=E.getFallbackTextureUrl(o,R._textureFormatInUse);U&&R.createCubeTexture(U,l,u,h,d,p,m,k,v,S,P,I)}p&&V&&p(V.status+" "+V.statusText,G)};if(E){o=E.transformUrl(o,this._textureFormatInUse);var D=function(V){R._bindTextureDirectly(w.TEXTURE_CUBE_MAP,I,!0),E.loadCubeData(V,I,v,d,p)};u&&u.length===6?E.supportCascades?this._cascadeLoadFiles(l,D,u,p):p&&p("Textures type does not support cascades."):this._loadFile(o,D,void 0,void 0,!0,C)}else{if(!u)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(o,l,function(V){var G=R.needPOTTextures?t.Tools.GetExponentOfTwo(V[0].width,R._caps.maxCubemapTextureSize):V[0].width,U=G;if(R._prepareWorkingCanvas(),!(!R._workingCanvas||!R._workingContext)){R._workingCanvas.width=G,R._workingCanvas.height=U;var z=[w.TEXTURE_CUBE_MAP_POSITIVE_X,w.TEXTURE_CUBE_MAP_POSITIVE_Y,w.TEXTURE_CUBE_MAP_POSITIVE_Z,w.TEXTURE_CUBE_MAP_NEGATIVE_X,w.TEXTURE_CUBE_MAP_NEGATIVE_Y,w.TEXTURE_CUBE_MAP_NEGATIVE_Z];R._bindTextureDirectly(w.TEXTURE_CUBE_MAP,I,!0),R._unpackFlipY(!1);for(var H=m?R._getInternalFormat(m):R._gl.RGBA,W=0;W<z.length;W++)R._workingContext.drawImage(V[W],0,0,V[W].width,V[W].height,0,0,G,U),w.texImage2D(z[W],0,H,H,w.UNSIGNED_BYTE,R._workingCanvas);h||w.generateMipmap(w.TEXTURE_CUBE_MAP),R._setCubeMapTextureParams(!h),I.width=G,I.height=U,I.isReady=!0,m&&(I.format=m),I.onLoadedObservable.notifyObservers(I),I.onLoadedObservable.clear(),d&&d()}},u,p)}return this._internalTexturesCache.push(I),I},s.prototype._setCubeMapTextureParams=function(o){var l=this._gl;l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,o?l.LINEAR_MIPMAP_LINEAR:l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null)},s.prototype.updateRawCubeTexture=function(o,l,u,h,d,p,m){p===void 0&&(p=null),m===void 0&&(m=0),o._bufferViewArray=l,o.format=u,o.type=h,o.invertY=d,o._compression=p;var _=this._gl,v=this._getWebGLTextureType(h),S=this._getInternalFormat(u),P=this._getRGBABufferInternalSizedFormat(h),x=!1;S===_.RGB&&(S=_.RGBA,x=!0),this._bindTextureDirectly(_.TEXTURE_CUBE_MAP,o,!0),this._unpackFlipY(d===void 0?!0:!!d),o.width%4!==0&&_.pixelStorei(_.UNPACK_ALIGNMENT,1);for(var R=0;R<6;R++){var w=l[R];p?_.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+R,m,this.getCaps().s3tc[p],o.width,o.height,0,w):(x&&(w=this._convertRGBtoRGBATextureData(w,o.width,o.height,h)),_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+R,m,P,o.width,o.height,0,S,v,w))}var I=!this.needPOTTextures||t.Tools.IsExponentOfTwo(o.width)&&t.Tools.IsExponentOfTwo(o.height);I&&o.generateMipMaps&&m===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),o.isReady=!0},s.prototype.createRawCubeTexture=function(o,l,u,h,d,p,m,_){_===void 0&&(_=null);var v=this._gl,S=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_CUBERAW);S.isCube=!0,S.format=u,S.type=h,this._doNotHandleContextLost||(S._bufferViewArray=o);var P=this._getWebGLTextureType(h),x=this._getInternalFormat(u);x===v.RGB&&(x=v.RGBA),P===v.FLOAT&&!this._caps.textureFloatLinearFiltering?(d=!1,m=s.TEXTURE_NEAREST_SAMPLINGMODE,t.Tools.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):P===this._gl.HALF_FLOAT_OES&&!this._caps.textureHalfFloatLinearFiltering?(d=!1,m=s.TEXTURE_NEAREST_SAMPLINGMODE,t.Tools.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):P===v.FLOAT&&!this._caps.textureFloatRender?(d=!1,t.Tools.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):P===v.HALF_FLOAT&&!this._caps.colorBufferFloat&&(d=!1,t.Tools.Warn("Render to half float textures is not supported. Mipmap generation forced to false."));var R=l,w=R;S.width=R,S.height=w;var I=!this.needPOTTextures||t.Tools.IsExponentOfTwo(S.width)&&t.Tools.IsExponentOfTwo(S.height);I||(d=!1),o&&this.updateRawCubeTexture(S,o,u,h,p,_),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,S,!0),o&&d&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var F=this._getSamplingParameters(m,d);return v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,F.mag),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,F.min),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),this._bindTextureDirectly(v.TEXTURE_CUBE_MAP,null),S.generateMipMaps=d,S},s.prototype.createRawCubeTextureFromUrl=function(o,l,u,h,d,p,m,_,v,S,P,x){var R=this;v===void 0&&(v=null),S===void 0&&(S=null),P===void 0&&(P=s.TEXTURE_TRILINEAR_SAMPLINGMODE),x===void 0&&(x=!1);var w=this._gl,I=this.createRawCubeTexture(null,u,h,d,!p,x,P);l._addPendingData(I),I.url=o,this._internalTexturesCache.push(I);var F=function(E,g){l._removePendingData(I),S&&E&&S(E.status+" "+E.statusText,g)},k=function(E){var g=I.width,y=m(E);if(y){if(_){var M=R._getWebGLTextureType(d),C=R._getInternalFormat(h),D=R._getRGBABufferInternalSizedFormat(d),V=!1;C===w.RGB&&(C=w.RGBA,V=!0),R._bindTextureDirectly(w.TEXTURE_CUBE_MAP,I,!0),R._unpackFlipY(!1);for(var G=_(y),U=0;U<G.length;U++)for(var z=g>>U,H=0;H<6;H++){var W=G[U][H];V&&(W=R._convertRGBtoRGBATextureData(W,z,z,d)),w.texImage2D(H,U,D,z,z,0,C,M,W)}R._bindTextureDirectly(w.TEXTURE_CUBE_MAP,null)}else R.updateRawCubeTexture(I,y,h,d,x);I.isReady=!0,l._removePendingData(I),v&&v()}};return this._loadFile(o,function(E){k(E)},void 0,l.database,!0,F),I},s.prototype.updateRawTexture3D=function(o,l,u,h,d,p){d===void 0&&(d=null),p===void 0&&(p=s.TEXTURETYPE_UNSIGNED_INT);var m=this._getWebGLTextureType(p),_=this._getInternalFormat(u),v=this._getRGBABufferInternalSizedFormat(p,u);this._bindTextureDirectly(this._gl.TEXTURE_3D,o,!0),this._unpackFlipY(h===void 0?!0:!!h),this._doNotHandleContextLost||(o._bufferView=l,o.format=u,o.invertY=h,o._compression=d),o.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),d&&l?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[d],o.width,o.height,o.depth,0,l):this._gl.texImage3D(this._gl.TEXTURE_3D,0,v,o.width,o.height,o.depth,0,_,m,l),o.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),o.isReady=!0},s.prototype.createRawTexture3D=function(o,l,u,h,d,p,m,_,v,S){v===void 0&&(v=null),S===void 0&&(S=s.TEXTURETYPE_UNSIGNED_INT);var P=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_RAW3D);P.baseWidth=l,P.baseHeight=u,P.baseDepth=h,P.width=l,P.height=u,P.depth=h,P.format=d,P.type=S,P.generateMipMaps=p,P.samplingMode=_,P.is3D=!0,this._doNotHandleContextLost||(P._bufferView=o),this.updateRawTexture3D(P,o,d,m,v,S),this._bindTextureDirectly(this._gl.TEXTURE_3D,P,!0);var x=this._getSamplingParameters(_,p);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,x.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,x.min),p&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(P),P},s.prototype._prepareWebGLTextureContinuation=function(o,l,u,h,d){var p=this._gl;if(p){var m=this._getSamplingParameters(d,!u);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,m.mag),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,m.min),!u&&!h&&p.generateMipmap(p.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null),l&&l._removePendingData(o),o.onLoadedObservable.notifyObservers(o),o.onLoadedObservable.clear()}},s.prototype._prepareWebGLTexture=function(o,l,u,h,d,p,m,_,v){var S=this;v===void 0&&(v=s.TEXTURE_TRILINEAR_SAMPLINGMODE);var P=this.getCaps().maxTextureSize,x=Math.min(P,this.needPOTTextures?t.Tools.GetExponentOfTwo(u,P):u),R=Math.min(P,this.needPOTTextures?t.Tools.GetExponentOfTwo(h,P):h),w=this._gl;if(w){if(!o._webGLTexture){l&&l._removePendingData(o);return}this._bindTextureDirectly(w.TEXTURE_2D,o,!0),this._unpackFlipY(d===void 0?!0:!!d),o.baseWidth=u,o.baseHeight=h,o.width=x,o.height=R,o.isReady=!0,!_(x,R,function(){S._prepareWebGLTextureContinuation(o,l,p,m,v)})&&this._prepareWebGLTextureContinuation(o,l,p,m,v)}},s.prototype._convertRGBtoRGBATextureData=function(o,l,u,h){var d;h===s.TEXTURETYPE_FLOAT?d=new Float32Array(l*u*4):d=new Uint32Array(l*u*4);for(var p=0;p<l;p++)for(var m=0;m<u;m++){var _=(m*l+p)*3,v=(m*l+p)*4;d[v+0]=o[_+0],d[v+1]=o[_+1],d[v+2]=o[_+2],d[v+3]=1}return d},s.prototype._releaseFramebufferObjects=function(o){var l=this._gl;o._framebuffer&&(l.deleteFramebuffer(o._framebuffer),o._framebuffer=null),o._depthStencilBuffer&&(l.deleteRenderbuffer(o._depthStencilBuffer),o._depthStencilBuffer=null),o._MSAAFramebuffer&&(l.deleteFramebuffer(o._MSAAFramebuffer),o._MSAAFramebuffer=null),o._MSAARenderBuffer&&(l.deleteRenderbuffer(o._MSAARenderBuffer),o._MSAARenderBuffer=null)},s.prototype._releaseTexture=function(o){var l=this._gl;this._releaseFramebufferObjects(o),l.deleteTexture(o._webGLTexture),this.unbindAllTextures();var u=this._internalTexturesCache.indexOf(o);u!==-1&&this._internalTexturesCache.splice(u,1),o._lodTextureHigh&&o._lodTextureHigh.dispose(),o._lodTextureMid&&o._lodTextureMid.dispose(),o._lodTextureLow&&o._lodTextureLow.dispose(),this.scenes.forEach(function(h){h.postProcesses.forEach(function(d){d._outputTexture==o&&(d._outputTexture=null)}),h.cameras.forEach(function(d){d._postProcesses.forEach(function(p){p&&p._outputTexture==o&&(p._outputTexture=null)})})})},s.prototype.setProgram=function(o){this._currentProgram!==o&&(this._gl.useProgram(o),this._currentProgram=o)},s.prototype.bindSamplers=function(o){this.setProgram(o.getProgram());for(var l=o.getSamplers(),u=0;u<l.length;u++){var h=o.getUniform(l[u]);h&&(this._boundUniforms[u]=h)}this._currentEffect=null},s.prototype._moveBoundTextureOnTop=function(o){this.disableTextureBindingOptimization||this._lastBoundInternalTextureTracker.previous===o||(this._linkTrackers(o.previous,o.next),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,o),this._linkTrackers(o,this._lastBoundInternalTextureTracker))},s.prototype._getCorrectTextureChannel=function(o,l){if(!l)return-1;if(l._initialSlot=o,this.disableTextureBindingOptimization)o!==l._designatedSlot&&this._textureCollisions.addCount(1,!1);else if(o!==l._designatedSlot)return l._designatedSlot>-1?l._designatedSlot:this._nextFreeTextureSlots.length?this._nextFreeTextureSlots[0]:(this._textureCollisions.addCount(1,!1),this._removeDesignatedSlot(this._firstBoundInternalTextureTracker.next));return o},s.prototype._linkTrackers=function(o,l){o.next=l,l.previous=o},s.prototype._removeDesignatedSlot=function(o){var l=o._designatedSlot;return l===-1||(o._designatedSlot=-1,this.disableTextureBindingOptimization)?-1:(this._linkTrackers(o.previous,o.next),this._boundTexturesCache[l]=null,this._nextFreeTextureSlots.push(l),l)},s.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},s.prototype._bindTextureDirectly=function(o,l,u,h){u===void 0&&(u=!1),h===void 0&&(h=!1);var d=!1;u&&l&&l._designatedSlot>-1&&(this._activeChannel=l._designatedSlot);var p=this._boundTexturesCache[this._activeChannel],m=l&&l._initialSlot>-1;if(p!==l||h){if(p&&this._removeDesignatedSlot(p),this._activateCurrentTexture(),this._gl.bindTexture(o,l?l._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=l,l){if(!this.disableTextureBindingOptimization){var _=this._nextFreeTextureSlots.indexOf(this._activeChannel);_>-1&&this._nextFreeTextureSlots.splice(_,1),this._linkTrackers(this._lastBoundInternalTextureTracker.previous,l),this._linkTrackers(l,this._lastBoundInternalTextureTracker)}l._designatedSlot=this._activeChannel}}else u&&(d=!0,this._activateCurrentTexture());return m&&!u&&this._bindSamplerUniformToChannel(l._initialSlot,this._activeChannel),d},s.prototype._bindTexture=function(o,l){o<0||(l&&(o=this._getCorrectTextureChannel(o,l)),this._activeChannel=o,this._bindTextureDirectly(this._gl.TEXTURE_2D,l))},s.prototype.setTextureFromPostProcess=function(o,l){this._bindTexture(o,l?l._textures.data[l._currentRenderTextureInd]:null)},s.prototype.setTextureFromPostProcessOutput=function(o,l){this._bindTexture(o,l?l._outputTexture:null)},s.prototype.unbindAllTextures=function(){for(var o=0;o<this._maxSimultaneousTextures;o++)this._activeChannel=o,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},s.prototype.setTexture=function(o,l,u){o<0||(l&&(this._boundUniforms[o]=l),this._setTexture(o,u))},s.prototype.setDepthStencilTexture=function(o,l,u){o<0||(l&&(this._boundUniforms[o]=l),!u||!u.depthStencilTexture?this._setTexture(o,null):this._setTexture(o,u,!1,!0))},s.prototype._bindSamplerUniformToChannel=function(o,l){var u=this._boundUniforms[o];u._currentState!==l&&(this._gl.uniform1i(u,l),u._currentState=l)},s.prototype._getTextureWrapMode=function(o){switch(o){case s.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case s.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case s.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},s.prototype._setTexture=function(o,l,u,h){if(u===void 0&&(u=!1),h===void 0&&(h=!1),!l)return this._boundTexturesCache[o]!=null&&(this._activeChannel=o,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(l.video)this._activeChannel=o,l.update();else if(l.delayLoadState===s.DELAYLOADSTATE_NOTLOADED)return l.delayLoad(),!1;var d;h?d=l.depthStencilTexture:l.isReady()?d=l.getInternalTexture():l.isCube?d=this.emptyCubeTexture:l.is3D?d=this.emptyTexture3D:d=this.emptyTexture,u||(o=this._getCorrectTextureChannel(o,d));var p=!0;if(this._boundTexturesCache[o]===d&&(this._moveBoundTextureOnTop(d),u||this._bindSamplerUniformToChannel(d._initialSlot,o),p=!1),this._activeChannel=o,d&&d.is3D)p&&this._bindTextureDirectly(this._gl.TEXTURE_3D,d,u),d&&d._cachedWrapU!==l.wrapU&&(d._cachedWrapU=l.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(l.wrapU),d)),d&&d._cachedWrapV!==l.wrapV&&(d._cachedWrapV=l.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(l.wrapV),d)),d&&d._cachedWrapR!==l.wrapR&&(d._cachedWrapR=l.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(l.wrapR),d)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,l);else if(d&&d.isCube){if(p&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,d,u),d._cachedCoordinatesMode!==l.coordinatesMode){d._cachedCoordinatesMode=l.coordinatesMode;var m=l.coordinatesMode!==s.TEXTURE_CUBIC_MODE&&l.coordinatesMode!==s.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,m,d),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,m)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,l)}else p&&this._bindTextureDirectly(this._gl.TEXTURE_2D,d,u),d&&d._cachedWrapU!==l.wrapU&&(d._cachedWrapU=l.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(l.wrapU),d)),d&&d._cachedWrapV!==l.wrapV&&(d._cachedWrapV=l.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(l.wrapV),d)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,l);return!0},s.prototype.setTextureArray=function(o,l,u){if(!(o<0||!l)){(!this._textureUnits||this._textureUnits.length!==u.length)&&(this._textureUnits=new Int32Array(u.length));for(var h=0;h<u.length;h++)this._textureUnits[h]=this._getCorrectTextureChannel(o+h,u[h].getInternalTexture());this._gl.uniform1iv(l,this._textureUnits);for(var d=0;d<u.length;d++)this._setTexture(this._textureUnits[d],u[d],!0)}},s.prototype._setAnisotropicLevel=function(o,l){var u=l.getInternalTexture();if(u){var h=this._caps.textureAnisotropicFilterExtension,d=l.anisotropicFilteringLevel;u.samplingMode!==s.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&u.samplingMode!==s.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&u.samplingMode!==s.TEXTURE_LINEAR_LINEAR&&(d=1),h&&u._cachedAnisotropicFilteringLevel!==d&&(this._setTextureParameterFloat(o,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(d,this._caps.maxAnisotropy),u),u._cachedAnisotropicFilteringLevel=d)}},s.prototype._setTextureParameterFloat=function(o,l,u,h){this._bindTextureDirectly(o,h,!0,!0),this._gl.texParameterf(o,l,u)},s.prototype._setTextureParameterInteger=function(o,l,u,h){h&&this._bindTextureDirectly(o,h,!0,!0),this._gl.texParameteri(o,l,u)},s.prototype.readPixels=function(o,l,u,h){var d=new Uint8Array(h*u*4);return this._gl.readPixels(o,l,u,h,this._gl.RGBA,this._gl.UNSIGNED_BYTE,d),d},s.prototype.addExternalData=function(o,l){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.add(o,l)},s.prototype.getExternalData=function(o){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.get(o)},s.prototype.getOrAddExternalDataWithFactory=function(o,l){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.getOrAddWithFactory(o,l)},s.prototype.removeExternalData=function(o){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.remove(o)},s.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var o=0;o<this._caps.maxVertexAttribs;o++)this._gl.disableVertexAttribArray(o),this._vertexAttribArraysEnabled[o]=!1,this._currentBufferPointers[o].active=!1;return}for(var o=0,l=this._vertexAttribArraysEnabled.length;o<l;o++)o>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[o]||(this._gl.disableVertexAttribArray(o),this._vertexAttribArraysEnabled[o]=!1,this._currentBufferPointers[o].active=!1)},s.prototype.releaseEffects=function(){for(var o in this._compiledEffects)this._deleteProgram(this._compiledEffects[o]._program);this._compiledEffects={}},s.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();s.Instances.length===1&&s.audioEngine&&s.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),t.Tools.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var o=s.Instances.indexOf(this);o>=0&&s.Instances.splice(o,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),t.Effect.ResetCache();for(var l=0,u=this._activeRequests;l<u.length;l++){var h=u[l];h.abort()}},s.prototype.displayLoadingUI=function(){if(t.Tools.IsWindowObjectExist()){var o=this.loadingScreen;o&&o.displayLoadingUI()}},s.prototype.hideLoadingUI=function(){if(t.Tools.IsWindowObjectExist()){var o=this.loadingScreen;o&&o.hideLoadingUI()}},Object.defineProperty(s.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&t.DefaultLoadingScreen&&this._renderingCanvas&&(this._loadingScreen=new t.DefaultLoadingScreen(this._renderingCanvas)),this._loadingScreen},set:function(o){this._loadingScreen=o},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loadingUIText",{set:function(o){this.loadingScreen.loadingUIText=o},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"loadingUIBackgroundColor",{set:function(o){this.loadingScreen.loadingUIBackgroundColor=o},enumerable:!0,configurable:!0}),s.prototype.attachContextLostEvent=function(o){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",o,!1)},s.prototype.attachContextRestoredEvent=function(o){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",o,!1)},s.prototype.getVertexShaderSource=function(o){var l=this._gl.getAttachedShaders(o);return l?this._gl.getShaderSource(l[0]):null},s.prototype.getFragmentShaderSource=function(o){var l=this._gl.getAttachedShaders(o);return l?this._gl.getShaderSource(l[1]):null},s.prototype.getError=function(){return this._gl.getError()},s.prototype.getFps=function(){return this._fps},s.prototype.getDeltaTime=function(){return this._deltaTime},s.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},s.prototype._readTexturePixels=function(o,l,u,h,d,p){h===void 0&&(h=-1),d===void 0&&(d=0),p===void 0&&(p=null);var m=this._gl;if(!this._dummyFramebuffer){var _=m.createFramebuffer();if(!_)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=_}m.bindFramebuffer(m.FRAMEBUFFER,this._dummyFramebuffer),h>-1?m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+h,o._webGLTexture,d):m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,o._webGLTexture,d);var v=o.type!==void 0?this._getWebGLTextureType(o.type):m.UNSIGNED_BYTE;switch(v){case m.UNSIGNED_BYTE:p||(p=new Uint8Array(4*l*u)),v=m.UNSIGNED_BYTE;break;default:p||(p=new Float32Array(4*l*u)),v=m.FLOAT;break}return m.readPixels(0,0,l,u,m.RGBA,v,p),m.bindFramebuffer(m.FRAMEBUFFER,this._currentFramebuffer),p},s.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(s.TEXTURETYPE_FLOAT)},s.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(s.TEXTURETYPE_HALF_FLOAT)},s.prototype._canRenderToFramebuffer=function(o){for(var l=this._gl;l.getError()!==l.NO_ERROR;);var u=!0,h=l.createTexture();l.bindTexture(l.TEXTURE_2D,h),l.texImage2D(l.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(o),1,1,0,l.RGBA,this._getWebGLTextureType(o),null),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);var d=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,d),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0);var p=l.checkFramebufferStatus(l.FRAMEBUFFER);if(u=u&&p===l.FRAMEBUFFER_COMPLETE,u=u&&l.getError()===l.NO_ERROR,u&&(l.clear(l.COLOR_BUFFER_BIT),u=u&&l.getError()===l.NO_ERROR),u){l.bindFramebuffer(l.FRAMEBUFFER,null);var m=l.RGBA,_=l.UNSIGNED_BYTE,v=new Uint8Array(4);l.readPixels(0,0,1,1,m,_,v),u=u&&l.getError()===l.NO_ERROR}for(l.deleteTexture(h),l.deleteFramebuffer(d),l.bindFramebuffer(l.FRAMEBUFFER,null);!u&&l.getError()!==l.NO_ERROR;);return u},s.prototype._getWebGLTextureType=function(o){if(this._webGLVersion===1){switch(o){case s.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case s.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case s.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(o){case s.TEXTURETYPE_BYTE:return this._gl.BYTE;case s.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case s.TEXTURETYPE_SHORT:return this._gl.SHORT;case s.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case s.TEXTURETYPE_INT:return this._gl.INT;case s.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case s.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case s.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case s.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case s.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case s.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case s.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case s.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case s.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case s.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case s.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},s.prototype._getInternalFormat=function(o){var l=this._gl.RGBA;switch(o){case s.TEXTUREFORMAT_ALPHA:l=this._gl.ALPHA;break;case s.TEXTUREFORMAT_LUMINANCE:l=this._gl.LUMINANCE;break;case s.TEXTUREFORMAT_LUMINANCE_ALPHA:l=this._gl.LUMINANCE_ALPHA;break;case s.TEXTUREFORMAT_RED:l=this._gl.RED;break;case s.TEXTUREFORMAT_RG:l=this._gl.RG;break;case s.TEXTUREFORMAT_RGB:l=this._gl.RGB;break;case s.TEXTUREFORMAT_RGBA:l=this._gl.RGBA;break}if(this._webGLVersion>1)switch(o){case s.TEXTUREFORMAT_RED_INTEGER:l=this._gl.RED_INTEGER;break;case s.TEXTUREFORMAT_RG_INTEGER:l=this._gl.RG_INTEGER;break;case s.TEXTUREFORMAT_RGB_INTEGER:l=this._gl.RGB_INTEGER;break;case s.TEXTUREFORMAT_RGBA_INTEGER:l=this._gl.RGBA_INTEGER;break}return l},s.prototype._getRGBABufferInternalSizedFormat=function(o,l){if(this._webGLVersion===1){if(l!==void 0)switch(l){case s.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case s.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case s.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(o){case s.TEXTURETYPE_BYTE:switch(l){case s.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case s.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case s.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case s.TEXTURETYPE_UNSIGNED_BYTE:switch(l){case s.TEXTUREFORMAT_RED:return this._gl.R8;case s.TEXTUREFORMAT_RG:return this._gl.RG8;case s.TEXTUREFORMAT_RGB:return this._gl.RGB8;case s.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;default:return this._gl.RGBA8}case s.TEXTURETYPE_SHORT:switch(l){case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case s.TEXTURETYPE_UNSIGNED_SHORT:switch(l){case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case s.TEXTURETYPE_INT:switch(l){case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case s.TEXTURETYPE_UNSIGNED_INTEGER:switch(l){case s.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case s.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case s.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case s.TEXTURETYPE_FLOAT:switch(l){case s.TEXTUREFORMAT_RED:return this._gl.R32F;case s.TEXTUREFORMAT_RG:return this._gl.RG32F;case s.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case s.TEXTUREFORMAT_RGBA:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case s.TEXTURETYPE_HALF_FLOAT:switch(l){case s.TEXTUREFORMAT_RED:return this._gl.R16F;case s.TEXTUREFORMAT_RG:return this._gl.RG16F;case s.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case s.TEXTUREFORMAT_RGBA:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case s.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case s.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case s.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case s.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case s.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case s.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(l){case s.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case s.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},s.prototype._getRGBAMultiSampleBufferFormat=function(o){return o===s.TEXTURETYPE_FLOAT?this._gl.RGBA32F:o===s.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},s.prototype._loadFile=function(o,l,u,h,d,p){var m=this,_=t.Tools.LoadFile(o,l,u,h,d,p);return this._activeRequests.push(_),_.onCompleteObservable.add(function(v){m._activeRequests.splice(m._activeRequests.indexOf(v),1)}),_},s.prototype._loadFileAsync=function(o,l,u){var h=this;return new Promise(function(d,p){h._loadFile(o,function(m){d(m)},void 0,l,u,function(m,_){p(_)})})},s.prototype._partialLoadFile=function(o,l,u,h,d,p){p===void 0&&(p=null);var m=function(v){u[l]=v,u._internalCount++,u._internalCount===6&&d(u)},_=function(v,S){p&&v&&p(v.status+" "+v.statusText,S)};this._loadFile(o,m,void 0,void 0,!0,_)},s.prototype._cascadeLoadFiles=function(o,l,u,h){h===void 0&&(h=null);var d=[];d._internalCount=0;for(var p=0;p<6;p++)this._partialLoadFile(u[p],p,d,o,l,h)},s.isSupported=function(){try{var o=document.createElement("canvas"),l=o.getContext("webgl")||o.getContext("experimental-webgl");return l!=null&&!!window.WebGLRenderingContext}catch{return!1}},s.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Macintosh",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPhone",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]},{key:"iPad",capture:null,captureConstraint:null,targets:["textureBindingOptimization"]}],s.Instances=new Array,s._TextureLoaders=[],s.ALPHA_DISABLE=0,s.ALPHA_ADD=1,s.ALPHA_COMBINE=2,s.ALPHA_SUBTRACT=3,s.ALPHA_MULTIPLY=4,s.ALPHA_MAXIMIZED=5,s.ALPHA_ONEONE=6,s.ALPHA_PREMULTIPLIED=7,s.ALPHA_PREMULTIPLIED_PORTERDUFF=8,s.ALPHA_INTERPOLATE=9,s.ALPHA_SCREENMODE=10,s.DELAYLOADSTATE_NONE=0,s.DELAYLOADSTATE_LOADED=1,s.DELAYLOADSTATE_LOADING=2,s.DELAYLOADSTATE_NOTLOADED=4,s.NEVER=512,s.ALWAYS=519,s.LESS=513,s.EQUAL=514,s.LEQUAL=515,s.GREATER=516,s.GEQUAL=518,s.NOTEQUAL=517,s.KEEP=7680,s.REPLACE=7681,s.INCR=7682,s.DECR=7683,s.INVERT=5386,s.INCR_WRAP=34055,s.DECR_WRAP=34056,s.TEXTURE_CLAMP_ADDRESSMODE=0,s.TEXTURE_WRAP_ADDRESSMODE=1,s.TEXTURE_MIRROR_ADDRESSMODE=2,s.TEXTUREFORMAT_ALPHA=0,s.TEXTUREFORMAT_LUMINANCE=1,s.TEXTUREFORMAT_LUMINANCE_ALPHA=2,s.TEXTUREFORMAT_RGB=4,s.TEXTUREFORMAT_RGBA=5,s.TEXTUREFORMAT_RED=6,s.TEXTUREFORMAT_R=6,s.TEXTUREFORMAT_RG=7,s.TEXTUREFORMAT_RED_INTEGER=8,s.TEXTUREFORMAT_R_INTEGER=8,s.TEXTUREFORMAT_RG_INTEGER=9,s.TEXTUREFORMAT_RGB_INTEGER=10,s.TEXTUREFORMAT_RGBA_INTEGER=11,s.TEXTURETYPE_UNSIGNED_BYTE=0,s.TEXTURETYPE_UNSIGNED_INT=0,s.TEXTURETYPE_FLOAT=1,s.TEXTURETYPE_HALF_FLOAT=2,s.TEXTURETYPE_BYTE=3,s.TEXTURETYPE_SHORT=4,s.TEXTURETYPE_UNSIGNED_SHORT=5,s.TEXTURETYPE_INT=6,s.TEXTURETYPE_UNSIGNED_INTEGER=7,s.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,s.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,s.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,s.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,s.TEXTURETYPE_UNSIGNED_INT_24_8=12,s.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,s.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,s.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,s.TEXTURE_NEAREST_SAMPLINGMODE=1,s.TEXTURE_BILINEAR_SAMPLINGMODE=2,s.TEXTURE_TRILINEAR_SAMPLINGMODE=3,s.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,s.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,s.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,s.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,s.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,s.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,s.TEXTURE_NEAREST_LINEAR=7,s.TEXTURE_NEAREST_NEAREST=8,s.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,s.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,s.TEXTURE_LINEAR_LINEAR=11,s.TEXTURE_LINEAR_NEAREST=12,s.TEXTURE_EXPLICIT_MODE=0,s.TEXTURE_SPHERICAL_MODE=1,s.TEXTURE_PLANAR_MODE=2,s.TEXTURE_CUBIC_MODE=3,s.TEXTURE_PROJECTION_MODE=4,s.TEXTURE_SKYBOX_MODE=5,s.TEXTURE_INVCUBIC_MODE=6,s.TEXTURE_EQUIRECTANGULAR_MODE=7,s.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,s.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,s.SCALEMODE_FLOOR=1,s.SCALEMODE_NEAREST=2,s.SCALEMODE_CEILING=3,s.CollisionsEpsilon=.001,s.CodeRepository="src/",s.ShadersRepository="src/Shaders/",s}();t.Engine=n})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){i===void 0&&(i=null),this.state="",this.metadata=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this._childRenderId=-1,this._worldMatrix=t.Matrix.Identity(),this._worldMatrixDeterminant=0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this.onDisposeObservable=new t.Observable,this._behaviors=new Array,this.name=r,this.id=r,this._scene=i||t.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),this.addToSceneRootNodes()}return c.AddNodeConstructor=function(r,i){this._NodeConstructors[r]=i},c.Construct=function(r,i,a,n){var s=this._NodeConstructors[r];return s?s(i,a,n):null},c.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(c.prototype,"parent",{get:function(){return this._parentNode},set:function(r){if(this._parentNode!==r){var i=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var a=this._parentNode._children.indexOf(this);a!==-1&&this._parentNode._children.splice(a,1),r||this.addToSceneRootNodes()}this._parentNode=r,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),i||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),c.prototype.addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},c.prototype.removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var r=this._scene.rootNodes,i=r.length-1;r[this._sceneRootNodesIndex]=r[i],r[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(c.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(r){this._animationPropertiesOverride=r},enumerable:!0,configurable:!0}),c.prototype.getClassName=function(){return"Node"},Object.defineProperty(c.prototype,"onDispose",{set:function(r){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(r)},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},c.prototype.getEngine=function(){return this._scene.getEngine()},c.prototype.addBehavior=function(r,i){var a=this;i===void 0&&(i=!1);var n=this._behaviors.indexOf(r);return n!==-1?this:(r.init(),this._scene.isLoading&&!i?this._scene.onDataLoadedObservable.addOnce(function(){r.attach(a)}):r.attach(this),this._behaviors.push(r),this)},c.prototype.removeBehavior=function(r){var i=this._behaviors.indexOf(r);return i===-1?this:(this._behaviors[i].detach(),this._behaviors.splice(i,1),this)},Object.defineProperty(c.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),c.prototype.getBehaviorByName=function(r){for(var i=0,a=this._behaviors;i<a.length;i++){var n=a[i];if(n.name===r)return n}return null},c.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},c.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminant},Object.defineProperty(c.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),c.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},c.prototype.updateCache=function(r){!r&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},c.prototype._updateCache=function(r){},c.prototype._isSynchronized=function(){return!0},c.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentRenderId=this._parentNode._childRenderId)},c.prototype.isSynchronizedWithParent=function(){return this._parentNode?this._parentRenderId!==this._parentNode._childRenderId?!1:this._parentNode.isSynchronized():!0},c.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()},c.prototype.isReady=function(r){return r===void 0&&(r=!1),this._isReady},c.prototype.isEnabled=function(r){return r===void 0&&(r=!0),r===!1?this._isEnabled:this._isEnabled?this._isParentEnabled:!1},c.prototype._syncParentEnabledState=function(){this._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(function(r){r._syncParentEnabledState()})},c.prototype.setEnabled=function(r){this._isEnabled=r,this._syncParentEnabledState()},c.prototype.isDescendantOf=function(r){return this.parent?this.parent===r?!0:this.parent.isDescendantOf(r):!1},c.prototype._getDescendants=function(r,i,a){if(i===void 0&&(i=!1),!!this._children)for(var n=0;n<this._children.length;n++){var s=this._children[n];(!a||a(s))&&r.push(s),i||s._getDescendants(r,!1,a)}},c.prototype.getDescendants=function(r,i){var a=new Array;return this._getDescendants(a,r,i),a},c.prototype.getChildMeshes=function(r,i){var a=[];return this._getDescendants(a,r,function(n){return(!i||i(n))&&n instanceof t.AbstractMesh}),a},c.prototype.getChildTransformNodes=function(r,i){var a=[];return this._getDescendants(a,r,function(n){return(!i||i(n))&&n instanceof t.TransformNode}),a},c.prototype.getChildren=function(r){return this.getDescendants(!0,r)},c.prototype._setReady=function(r){if(r!==this._isReady){if(!r){this._isReady=!1;return}this.onReady&&this.onReady(this),this._isReady=!0}},c.prototype.getAnimationByName=function(r){for(var i=0;i<this.animations.length;i++){var a=this.animations[i];if(a.name===r)return a}return null},c.prototype.createAnimationRange=function(r,i,a){if(!this._ranges[r]){this._ranges[r]=new t.AnimationRange(r,i,a);for(var n=0,s=this.animations.length;n<s;n++)this.animations[n]&&this.animations[n].createRange(r,i,a)}},c.prototype.deleteAnimationRange=function(r,i){i===void 0&&(i=!0);for(var a=0,n=this.animations.length;a<n;a++)this.animations[a]&&this.animations[a].deleteRange(r,i);this._ranges[r]=null},c.prototype.getAnimationRange=function(r){return this._ranges[r]},c.prototype.beginAnimation=function(r,i,a,n){var s=this.getAnimationRange(r);return s?this._scene.beginAnimation(this,s.from,s.to,i,a,n):null},c.prototype.serializeAnimationRanges=function(){var r=[];for(var i in this._ranges){var a=this._ranges[i];if(a){var n={};n.name=i,n.from=a.from,n.to=a.to,r.push(n)}}return r},c.prototype.computeWorldMatrix=function(r){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix},c.prototype.dispose=function(r,i){if(i===void 0&&(i=!1),r)for(var l=this.getChildTransformNodes(!0),u=0,h=l;u<h.length;u++){var d=h[u];d.parent=null,d.computeWorldMatrix(!0)}else for(var a=this.getDescendants(!0),n=0,s=a;n<s.length;n++){var o=s[n];o.dispose(r,i)}this.parent?this.parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var p=0,m=this._behaviors;p<m.length;p++){var _=m[p];_.detach()}this._behaviors=[],this._isDisposed=!0},c.ParseAnimationRanges=function(r,i,a){if(i.ranges)for(var n=0;n<i.ranges.length;n++){var s=i.ranges[n];r.createAnimationRange(s.name,s.from,s.to)}},c._NodeConstructors={},A([t.serialize()],c.prototype,"name",void 0),A([t.serialize()],c.prototype,"id",void 0),A([t.serialize()],c.prototype,"uniqueId",void 0),A([t.serialize()],c.prototype,"state",void 0),A([t.serialize()],c.prototype,"metadata",void 0),c}();t.Node=f})(T||(T={}));var T;(function(t){var f=t.Matrix.Identity(),c=function(){function r(i,a){this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(i,a)}return r.prototype.reConstruct=function(i,a){this.minimum.copyFrom(i),this.maximum.copyFrom(a);var n=t.Vector3.Distance(i,a);t.Vector3.LerpToRef(i,a,.5,this.center),this.radius=n*.5,this.centerWorld.set(0,0,0),this._update(f)},r.prototype.scale=function(i){var a=this.radius*i,n=t.Tmp.Vector3[0].set(a,a,a),s=t.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(n),o=t.Tmp.Vector3[2].copyFrom(this.center).addInPlace(n);return this.reConstruct(s,o),this},r.prototype._update=function(i){t.Vector3.TransformCoordinatesToRef(this.center,i,this.centerWorld);var a=t.Tmp.Vector3[0];t.Vector3.TransformNormalFromFloatsToRef(1,1,1,i,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius},r.prototype.isInFrustum=function(i){for(var a=0;a<6;a++)if(i[a].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},r.prototype.intersectsPoint=function(i){var a=this.centerWorld.x-i.x,n=this.centerWorld.y-i.y,s=this.centerWorld.z-i.z,o=Math.sqrt(a*a+n*n+s*s);return!(this.radiusWorld<o)},r.Intersects=function(i,a){var n=i.centerWorld.x-a.centerWorld.x,s=i.centerWorld.y-a.centerWorld.y,o=i.centerWorld.z-a.centerWorld.z,l=Math.sqrt(n*n+s*s+o*o);return!(i.radiusWorld+a.radiusWorld<l)},r}();t.BoundingSphere=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.vectors=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],this.center=t.Vector3.Zero(),this.centerWorld=t.Vector3.Zero(),this.extendSize=t.Vector3.Zero(),this.extendSizeWorld=t.Vector3.Zero(),this.directions=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],this.vectorsWorld=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],this.minimumWorld=t.Vector3.Zero(),this.maximumWorld=t.Vector3.Zero(),this.minimum=t.Vector3.Zero(),this.maximum=t.Vector3.Zero(),this.reConstruct(r,i)}return c.prototype.reConstruct=function(r,i){this.minimum.copyFrom(r),this.maximum.copyFrom(i),this.vectors[0].copyFrom(this.minimum),this.vectors[1].copyFrom(this.maximum),this.vectors[2].copyFrom(this.minimum),this.vectors[3].copyFrom(this.minimum),this.vectors[4].copyFrom(this.minimum),this.vectors[5].copyFrom(this.maximum),this.vectors[6].copyFrom(this.maximum),this.vectors[7].copyFrom(this.maximum),this.vectors[2].x=this.maximum.x,this.vectors[3].y=this.maximum.y,this.vectors[4].z=this.maximum.z,this.vectors[5].z=this.minimum.z,this.vectors[6].x=this.minimum.x,this.vectors[7].y=this.minimum.y,this.center.copyFrom(this.maximum).addInPlace(this.minimum).scaleInPlace(.5),this.extendSize.copyFrom(this.maximum).subtractInPlace(this.minimum).scaleInPlace(.5);for(var a=0;a<3;a++)this.directions[a].copyFromFloats(0,0,0);for(var a=0;a<8;a++)this.vectorsWorld[a].copyFromFloats(0,0,0);this.minimumWorld.copyFromFloats(0,0,0),this.maximumWorld.copyFromFloats(0,0,0),this.centerWorld.copyFromFloats(0,0,0),this.extendSizeWorld.copyFromFloats(0,0,0),this._update(this._worldMatrix||t.Matrix.Identity())},c.prototype.scale=function(r){var i=t.Tmp.Vector3[0].copyFrom(this.maximum).subtractInPlace(this.minimum),a=i.length()*r;i.normalize();var n=i.scaleInPlace(a*.5),s=t.Tmp.Vector3[1].copyFrom(this.center).subtractInPlace(n),o=t.Tmp.Vector3[2].copyFrom(this.center).addInPlace(n);return this.reConstruct(s,o),this},c.prototype.getWorldMatrix=function(){return this._worldMatrix},c.prototype.setWorldMatrix=function(r){return this._worldMatrix.copyFrom(r),this},c.prototype._update=function(r){t.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),t.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<8;i++){var a=this.vectorsWorld[i];t.Vector3.TransformCoordinatesToRef(this.vectors[i],r,a),this.minimumWorld.minimizeInPlace(a),this.maximumWorld.maximizeInPlace(a)}this.maximumWorld.subtractToRef(this.minimumWorld,this.extendSizeWorld),this.extendSizeWorld.scaleInPlace(.5),this.maximumWorld.addToRef(this.minimumWorld,this.centerWorld),this.centerWorld.scaleInPlace(.5),t.Vector3.FromFloatArrayToRef(r.m,0,this.directions[0]),t.Vector3.FromFloatArrayToRef(r.m,4,this.directions[1]),t.Vector3.FromFloatArrayToRef(r.m,8,this.directions[2]),this._worldMatrix=r},c.prototype.isInFrustum=function(r){return c.IsInFrustum(this.vectorsWorld,r)},c.prototype.isCompletelyInFrustum=function(r){return c.IsCompletelyInFrustum(this.vectorsWorld,r)},c.prototype.intersectsPoint=function(r,i){var a=i?this.minimum:this.minimumWorld,n=i?this.maximum:this.maximumWorld,s=-t.Epsilon;return!(n.x-r.x<s||s>r.x-a.x||n.y-r.y<s||s>r.y-a.y||n.z-r.z<s||s>r.z-a.z)},c.prototype.intersectsSphere=function(r){return c.IntersectsSphere(this.minimumWorld,this.maximumWorld,r.centerWorld,r.radiusWorld)},c.prototype.intersectsMinMax=function(r,i){return!(this.maximumWorld.x<r.x||this.minimumWorld.x>i.x||this.maximumWorld.y<r.y||this.minimumWorld.y>i.y||this.maximumWorld.z<r.z||this.minimumWorld.z>i.z)},c.Intersects=function(r,i){return!(r.maximumWorld.x<i.minimumWorld.x||r.minimumWorld.x>i.maximumWorld.x||r.maximumWorld.y<i.minimumWorld.y||r.minimumWorld.y>i.maximumWorld.y||r.maximumWorld.z<i.minimumWorld.z||r.minimumWorld.z>i.maximumWorld.z)},c.IntersectsSphere=function(r,i,a,n){var s=t.Vector3.Clamp(a,r,i),o=t.Vector3.DistanceSquared(a,s);return o<=n*n},c.IsCompletelyInFrustum=function(r,i){for(var a=0;a<6;a++)for(var n=0;n<8;n++)if(i[a].dotCoordinate(r[n])<0)return!1;return!0},c.IsInFrustum=function(r,i){for(var a=0;a<6;a++){for(var n=8,s=0;s<8&&i[a].dotCoordinate(r[s])<0;s++)--n;if(n===0)return!1}return!0},c}();t.BoundingBox=f})(T||(T={}));var T;(function(t){var f=function(a,n){var s=t.Vector3.Dot(n.centerWorld,a),o=Math.abs(t.Vector3.Dot(n.directions[0],a))*n.extendSize.x,l=Math.abs(t.Vector3.Dot(n.directions[1],a))*n.extendSize.y,u=Math.abs(t.Vector3.Dot(n.directions[2],a))*n.extendSize.z,h=o+l+u;return{min:s-h,max:s+h}},c=function(a,n,s,o){return!(a>o||s>n)},r=function(a,n,s){var o=f(a,n),l=f(a,s);return c(o.min,o.max,l.min,l.max)},i=function(){function a(n,s){this._isLocked=!1,this.boundingBox=new t.BoundingBox(n,s),this.boundingSphere=new t.BoundingSphere(n,s)}return Object.defineProperty(a.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isLocked",{get:function(){return this._isLocked},set:function(n){this._isLocked=n},enumerable:!0,configurable:!0}),a.prototype.update=function(n){this._isLocked||(this.boundingBox._update(n),this.boundingSphere._update(n))},a.prototype.centerOn=function(n,s){var o=t.Tmp.Vector3[0].copyFrom(n).subtractInPlace(s),l=t.Tmp.Vector3[1].copyFrom(n).addInPlace(s);return this.boundingBox.reConstruct(o,l),this.boundingSphere.reConstruct(o,l),this},a.prototype.scale=function(n){return this.boundingBox.scale(n),this.boundingSphere.scale(n),this},a.prototype.isInFrustum=function(n,s){return s===void 0&&(s=t.AbstractMesh.CULLINGSTRATEGY_STANDARD),this.boundingSphere.isInFrustum(n)?s===t.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY?!0:this.boundingBox.isInFrustum(n):!1},Object.defineProperty(a.prototype,"diagonalLength",{get:function(){var n=this.boundingBox,s=n.maximumWorld.subtract(n.minimumWorld);return s.length()},enumerable:!0,configurable:!0}),a.prototype.isCompletelyInFrustum=function(n){return this.boundingBox.isCompletelyInFrustum(n)},a.prototype._checkCollision=function(n){return n._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},a.prototype.intersectsPoint=function(n,s){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(n)||!this.boundingBox.intersectsPoint(n,s))},a.prototype.intersects=function(n,s){if(!this.boundingSphere.centerWorld||!n.boundingSphere.centerWorld||!t.BoundingSphere.Intersects(this.boundingSphere,n.boundingSphere)||!t.BoundingBox.Intersects(this.boundingBox,n.boundingBox))return!1;if(!s)return!0;var o=this.boundingBox,l=n.boundingBox;return!(!r(o.directions[0],o,l)||!r(o.directions[1],o,l)||!r(o.directions[2],o,l)||!r(l.directions[0],o,l)||!r(l.directions[1],o,l)||!r(l.directions[2],o,l)||!r(t.Vector3.Cross(o.directions[0],l.directions[0]),o,l)||!r(t.Vector3.Cross(o.directions[0],l.directions[1]),o,l)||!r(t.Vector3.Cross(o.directions[0],l.directions[2]),o,l)||!r(t.Vector3.Cross(o.directions[1],l.directions[0]),o,l)||!r(t.Vector3.Cross(o.directions[1],l.directions[1]),o,l)||!r(t.Vector3.Cross(o.directions[1],l.directions[2]),o,l)||!r(t.Vector3.Cross(o.directions[2],l.directions[0]),o,l)||!r(t.Vector3.Cross(o.directions[2],l.directions[1]),o,l)||!r(t.Vector3.Cross(o.directions[2],l.directions[2]),o,l))},a}();t.BoundingInfo=i})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n){a===void 0&&(a=null),n===void 0&&(n=!0);var s=c.call(this,i,a)||this;return s._forward=new t.Vector3(0,0,1),s._forwardInverted=new t.Vector3(0,0,-1),s._up=new t.Vector3(0,1,0),s._right=new t.Vector3(1,0,0),s._rightInverted=new t.Vector3(-1,0,0),s._position=t.Vector3.Zero(),s._rotation=t.Vector3.Zero(),s._scaling=t.Vector3.One(),s._isDirty=!1,s.billboardMode=r.BILLBOARDMODE_NONE,s.scalingDeterminant=1,s.infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s._localWorld=t.Matrix.Zero(),s._absolutePosition=t.Vector3.Zero(),s._pivotMatrix=t.Matrix.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s.onAfterWorldMatrixUpdateObservable=new t.Observable,s._nonUniformScaling=!1,n&&s.getScene().addTransformNode(s),s}return r.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(i){this._position=i,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this._rotation},set:function(i){this._rotation=i,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaling",{get:function(){return this._scaling},set:function(i){this._scaling=i,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(i){this._rotationQuaternion=i,i&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"forward",{get:function(){return t.Vector3.Normalize(t.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"up",{get:function(){return t.Vector3.Normalize(t.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return t.Vector3.Normalize(t.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),r.prototype.updatePoseMatrix=function(i){return this._poseMatrix.copyFrom(i),this},r.prototype.getPoseMatrix=function(){return this._poseMatrix},r.prototype._isSynchronized=function(){return!(this._isDirty||this.billboardMode!==this._cache.billboardMode||this.billboardMode!==r.BILLBOARDMODE_NONE||this._cache.pivotMatrixUpdated||this.infiniteDistance||!this._cache.position.equals(this._position)||this._rotationQuaternion&&!this._cache.rotationQuaternion.equals(this._rotationQuaternion)||!this._cache.rotation.equals(this._rotation)||!this._cache.scaling.equals(this._scaling))},r.prototype._initCache=function(){c.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=t.Vector3.Zero(),this._cache.scaling=t.Vector3.Zero(),this._cache.rotation=t.Vector3.Zero(),this._cache.rotationQuaternion=new t.Quaternion(0,0,0,0),this._cache.billboardMode=-1},r.prototype.markAsDirty=function(i){return i==="rotation"&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(r.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),r.prototype.setPreTransformMatrix=function(i){return this.setPivotMatrix(i,!1)},r.prototype.setPivotMatrix=function(i,a){return a===void 0&&(a=!0),this._pivotMatrix=i.clone(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=a,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=t.Matrix.Invert(this._pivotMatrix)),this},r.prototype.getPivotMatrix=function(){return this._pivotMatrix},r.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},r.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(r.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),r.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},r.prototype.setAbsolutePosition=function(i){if(!i)return this;var a,n,s;if(i.x===void 0){if(arguments.length<3)return this;a=arguments[0],n=arguments[1],s=arguments[2]}else a=i.x,n=i.y,s=i.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var l=new t.Vector3(a,n,s);this.position=t.Vector3.TransformCoordinates(l,o)}else this.position.x=a,this.position.y=n,this.position.z=s;return this},r.prototype.setPositionWithLocalVector=function(i){return this.computeWorldMatrix(),this.position=t.Vector3.TransformNormal(i,this._localWorld),this},r.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var i=this._localWorld.clone();return i.invert(),t.Vector3.TransformNormal(this.position,i)},r.prototype.locallyTranslate=function(i){return this.computeWorldMatrix(!0),this.position=t.Vector3.TransformCoordinates(i,this._localWorld),this},r.prototype.lookAt=function(i,a,n,s,o){a===void 0&&(a=0),n===void 0&&(n=0),s===void 0&&(s=0),o===void 0&&(o=t.Space.LOCAL);var l=r._lookAtVectorCache,u=o===t.Space.LOCAL?this.position:this.getAbsolutePosition();i.subtractToRef(u,l);var h=-Math.atan2(l.z,l.x)-Math.PI/2,d=Math.sqrt(l.x*l.x+l.z*l.z),p=Math.atan2(l.y,d);return this.rotationQuaternion?t.Quaternion.RotationYawPitchRollToRef(h+a,p+n,s,this.rotationQuaternion):(this.rotation.x=p+n,this.rotation.y=h+a,this.rotation.z=s),this},r.prototype.getDirection=function(i){var a=t.Vector3.Zero();return this.getDirectionToRef(i,a),a},r.prototype.getDirectionToRef=function(i,a){return t.Vector3.TransformNormalToRef(i,this.getWorldMatrix(),a),this},r.prototype.setPivotPoint=function(i,a){a===void 0&&(a=t.Space.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(a==t.Space.WORLD){var s=t.Tmp.Matrix[0];n.invertToRef(s),i=t.Vector3.TransformCoordinates(i,s)}return this.setPivotMatrix(t.Matrix.Translation(-i.x,-i.y,-i.z),!0)},r.prototype.getPivotPoint=function(){var i=t.Vector3.Zero();return this.getPivotPointToRef(i),i},r.prototype.getPivotPointToRef=function(i){return i.x=-this._pivotMatrix.m[12],i.y=-this._pivotMatrix.m[13],i.z=-this._pivotMatrix.m[14],this},r.prototype.getAbsolutePivotPoint=function(){var i=t.Vector3.Zero();return this.getAbsolutePivotPointToRef(i),i},r.prototype.getAbsolutePivotPointToRef=function(i){return i.x=this._pivotMatrix.m[12],i.y=this._pivotMatrix.m[13],i.z=this._pivotMatrix.m[14],this.getPivotPointToRef(i),t.Vector3.TransformCoordinatesToRef(i,this.getWorldMatrix(),i),this},r.prototype.setParent=function(i){if(!i&&!this.parent)return this;if(i){var a=t.Tmp.Quaternion[0],n=t.Tmp.Vector3[0],s=t.Tmp.Vector3[1],o=t.Tmp.Matrix[0],l=t.Tmp.Matrix[1];this.computeWorldMatrix(!0),i.computeWorldMatrix(!0),i.getWorldMatrix().invertToRef(l),this.getWorldMatrix().multiplyToRef(l,o),o.decompose(s,a,n),this.rotationQuaternion?this.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(this.rotation),this.position.x=n.x,this.position.y=n.y,this.position.z=n.z,this.scaling.x=s.x,this.scaling.y=s.y,this.scaling.z=s.z}else{var a=t.Tmp.Quaternion[0],n=t.Tmp.Vector3[0],s=t.Tmp.Vector3[1];this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(s,a,n),this.rotationQuaternion?this.rotationQuaternion.copyFrom(a):a.toEulerAnglesToRef(this.rotation),this.scaling.x=s.x,this.scaling.y=s.y,this.scaling.z=s.z,this.position.x=n.x,this.position.y=n.y,this.position.z=n.z}return this.parent=i,this},Object.defineProperty(r.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),r.prototype._updateNonUniformScalingState=function(i){return this._nonUniformScaling===i?!1:(this._nonUniformScaling=i,!0)},r.prototype.attachToBone=function(i,a){return this._transformToBoneReferal=a,this.parent=i,i.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},r.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},r.prototype.rotate=function(i,a,n){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=t.Vector3.Zero());var s;if(!n||n===t.Space.LOCAL)s=t.Quaternion.RotationAxisToRef(i,a,r._rotationAxisCache),this.rotationQuaternion.multiplyToRef(s,this.rotationQuaternion);else{if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert(),i=t.Vector3.TransformNormal(i,o)}s=t.Quaternion.RotationAxisToRef(i,a,r._rotationAxisCache),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},r.prototype.rotateAround=function(i,a,n){return a.normalize(),this.rotationQuaternion||(this.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.copyFromFloats(0,0,0)),i.subtractToRef(this.position,t.Tmp.Vector3[0]),t.Matrix.TranslationToRef(t.Tmp.Vector3[0].x,t.Tmp.Vector3[0].y,t.Tmp.Vector3[0].z,t.Tmp.Matrix[0]),t.Tmp.Matrix[0].invertToRef(t.Tmp.Matrix[2]),t.Matrix.RotationAxisToRef(a,n,t.Tmp.Matrix[1]),t.Tmp.Matrix[2].multiplyToRef(t.Tmp.Matrix[1],t.Tmp.Matrix[2]),t.Tmp.Matrix[2].multiplyToRef(t.Tmp.Matrix[0],t.Tmp.Matrix[2]),t.Tmp.Matrix[2].decompose(t.Tmp.Vector3[0],t.Tmp.Quaternion[0],t.Tmp.Vector3[1]),this.position.addInPlace(t.Tmp.Vector3[1]),t.Tmp.Quaternion[0].multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},r.prototype.translate=function(i,a,n){var s=i.scale(a);if(!n||n===t.Space.LOCAL){var o=this.getPositionExpressedInLocalSpace().add(s);this.setPositionWithLocalVector(o)}else this.setAbsolutePosition(this.getAbsolutePosition().add(s));return this},r.prototype.addRotation=function(i,a,n){var s;this.rotationQuaternion?s=this.rotationQuaternion:(s=t.Tmp.Quaternion[1],t.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,s));var o=t.Tmp.Quaternion[0];return t.Quaternion.RotationYawPitchRollToRef(a,i,n,o),s.multiplyInPlace(o),this.rotationQuaternion||s.toEulerAnglesToRef(this.rotation),this},r.prototype.computeWorldMatrix=function(i){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!i&&this.isSynchronized())return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._updateCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this.getScene().getRenderId(),this._isDirty=!1,t.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,t.Tmp.Matrix[1]),this.rotationQuaternion){var a=this.rotation.length();a&&(this.rotationQuaternion.multiplyInPlace(t.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0))}this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(t.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,t.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var n=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&n){var s=n.getWorldMatrix();t.Tmp.Vector3[0].set(s.m[12],s.m[13],s.m[14]),t.Matrix.TranslationToRef(this.position.x+t.Tmp.Vector3[0].x,this.position.y+t.Tmp.Vector3[0].y,this.position.z+t.Tmp.Vector3[0].z,t.Tmp.Matrix[2])}else t.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,t.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(t.Tmp.Matrix[1],t.Tmp.Matrix[4]),t.Tmp.Matrix[4].multiplyToRef(t.Tmp.Matrix[0],t.Tmp.Matrix[5]),this.billboardMode!==r.BILLBOARDMODE_NONE&&n){if((this.billboardMode&r.BILLBOARDMODE_ALL)!==r.BILLBOARDMODE_ALL){var o=t.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),t.Tmp.Matrix[6]),t.Vector3.TransformCoordinatesToRef(this.position,t.Tmp.Matrix[6],o)):t.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),o):o.copyFrom(this.position),o.subtractInPlace(n.globalPosition);var l=t.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&r.BILLBOARDMODE_X)===r.BILLBOARDMODE_X&&(l.x=Math.atan2(-o.y,o.z)),(this.billboardMode&r.BILLBOARDMODE_Y)===r.BILLBOARDMODE_Y&&(l.y=Math.atan2(o.x,o.z)),(this.billboardMode&r.BILLBOARDMODE_Z)===r.BILLBOARDMODE_Z&&(l.z=Math.atan2(o.y,o.x)),t.Matrix.RotationYawPitchRollToRef(l.y,l.x,l.z,t.Tmp.Matrix[0])}else t.Tmp.Matrix[1].copyFrom(n.getViewMatrix()),t.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),t.Tmp.Matrix[1].invertToRef(t.Tmp.Matrix[0]);t.Tmp.Matrix[1].copyFrom(t.Tmp.Matrix[5]),t.Tmp.Matrix[1].multiplyToRef(t.Tmp.Matrix[0],t.Tmp.Matrix[5])}return this._postMultiplyPivotMatrix&&t.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse,t.Tmp.Matrix[5]),t.Tmp.Matrix[5].multiplyToRef(t.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==r.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),t.Tmp.Matrix[6]),t.Tmp.Matrix[5].copyFrom(t.Tmp.Matrix[6])):t.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localWorld.getTranslationToRef(t.Tmp.Vector3[5]),t.Vector3.TransformCoordinatesToRef(t.Tmp.Vector3[5],t.Tmp.Matrix[5],t.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localWorld),this._worldMatrix.setTranslation(t.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),t.Tmp.Matrix[6]),t.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localWorld),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=t.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix},r.prototype._afterComputeWorldMatrix=function(){},r.prototype.registerAfterWorldMatrixUpdate=function(i){return this.onAfterWorldMatrixUpdateObservable.add(i),this},r.prototype.unregisterAfterWorldMatrixUpdate=function(i){return this.onAfterWorldMatrixUpdateObservable.removeCallback(i),this},r.prototype.clone=function(i,a,n){var s=this,o=t.SerializationHelper.Clone(function(){return new r(i,s.getScene())},this);if(o.name=i,o.id=i,a&&(o.parent=a),!n)for(var l=this.getDescendants(!0),u=0;u<l.length;u++){var h=l[u];h.clone&&h.clone(i+"."+h.name,o)}return o},r.prototype.serialize=function(i){var a=t.SerializationHelper.Serialize(this,i);return a.type=this.getClassName(),this.parent&&(a.parentId=this.parent.id),t.Tags&&t.Tags.HasTags(this)&&(a.tags=t.Tags.GetTags(this)),a.localMatrix=this.getPivotMatrix().asArray(),a.isEnabled=this.isEnabled(),this.parent&&(a.parentId=this.parent.id),a},r.Parse=function(i,a,n){var s=t.SerializationHelper.Parse(function(){return new r(i.name,a)},i,a,n);return t.Tags&&t.Tags.AddTagsTo(s,i.tags),i.localMatrix?s.setPreTransformMatrix(t.Matrix.FromArray(i.localMatrix)):i.pivotMatrix&&s.setPivotMatrix(t.Matrix.FromArray(i.pivotMatrix)),s.setEnabled(i.isEnabled),i.parentId&&(s._waitingParentId=i.parentId),s},r.prototype.dispose=function(i,a){a===void 0&&(a=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),c.prototype.dispose.call(this,i,a)},r.BILLBOARDMODE_NONE=0,r.BILLBOARDMODE_X=1,r.BILLBOARDMODE_Y=2,r.BILLBOARDMODE_Z=4,r.BILLBOARDMODE_ALL=7,r._lookAtVectorCache=new t.Vector3(0,0,0),r._rotationAxisCache=new t.Quaternion,A([t.serializeAsVector3("position")],r.prototype,"_position",void 0),A([t.serializeAsVector3("rotation")],r.prototype,"_rotation",void 0),A([t.serializeAsQuaternion("rotationQuaternion")],r.prototype,"_rotationQuaternion",void 0),A([t.serializeAsVector3("scaling")],r.prototype,"_scaling",void 0),A([t.serialize()],r.prototype,"billboardMode",void 0),A([t.serialize()],r.prototype,"scalingDeterminant",void 0),A([t.serialize()],r.prototype,"infiniteDistance",void 0),A([t.serialize()],r.prototype,"ignoreNonUniformScaling",void 0),r}(t.Node);t.TransformNode=f})(T||(T={}));var T;(function(t){var f=function(){function r(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=t.Vector3.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return r}(),c=function(r){N(i,r);function i(a,n){n===void 0&&(n=null);var s=r.call(this,a,n,!1)||this;return s._facetData=new f,s.cullingStrategy=i.CULLINGSTRATEGY_STANDARD,s.onCollideObservable=new t.Observable,s.onCollisionPositionChangeObservable=new t.Observable,s.onMaterialChangedObservable=new t.Observable,s.definedFacingForward=!0,s._visibility=1,s.alphaIndex=Number.MAX_VALUE,s.isVisible=!0,s.isPickable=!0,s.showSubMeshesBoundingBox=!1,s.isBlocker=!1,s.enablePointerMoveEvents=!1,s.renderingGroupId=0,s._receiveShadows=!1,s.outlineColor=t.Color3.Red(),s.outlineWidth=.02,s.overlayColor=t.Color3.Red(),s.overlayAlpha=.5,s._hasVertexAlpha=!1,s._useVertexColors=!0,s._computeBonesUsingShaders=!0,s._numBoneInfluencers=4,s._applyFog=!0,s.useOctreeForRenderingSelection=!0,s.useOctreeForPicking=!0,s.useOctreeForCollisions=!0,s._layerMask=268435455,s.alwaysSelectAsActiveMesh=!1,s.actionManager=null,s._checkCollisions=!1,s._collisionMask=-1,s._collisionGroup=-1,s.ellipsoid=new t.Vector3(.5,1,.5),s.ellipsoidOffset=new t.Vector3(0,0,0),s._oldPositionForCollisions=new t.Vector3(0,0,0),s._diffPositionForCollisions=new t.Vector3(0,0,0),s.edgesWidth=1,s.edgesColor=new t.Color4(1,0,0,1),s._renderId=0,s._intersectionsInProgress=new Array,s._unIndexed=!1,s._lightSources=new Array,s.onRebuildObservable=new t.Observable,s._onCollisionPositionChange=function(o,l,u){u===void 0&&(u=null),s.getScene().workerCollisions&&l.multiplyInPlace(s._collider._radius),l.subtractToRef(s._oldPositionForCollisions,s._diffPositionForCollisions),s._diffPositionForCollisions.length()>t.Engine.CollisionsEpsilon&&s.position.addInPlace(s._diffPositionForCollisions),u&&s.onCollideObservable.notifyObservers(u),s.onCollisionPositionChangeObservable.notifyObservers(s.position)},s.getScene().addMesh(s),s._resyncLightSources(),s}return Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return t.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return t.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return t.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return t.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return t.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"facetNb",{get:function(){return this._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"partitioningSubdivisions",{get:function(){return this._facetData.partitioningSubdivisions},set:function(a){this._facetData.partitioningSubdivisions=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"partitioningBBoxRatio",{get:function(){return this._facetData.partitioningBBoxRatio},set:function(a){this._facetData.partitioningBBoxRatio=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mustDepthSortFacets",{get:function(){return this._facetData.facetDepthSort},set:function(a){this._facetData.facetDepthSort=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"facetDepthSortFrom",{get:function(){return this._facetData.facetDepthSortFrom},set:function(a){this._facetData.facetDepthSortFrom=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFacetDataEnabled",{get:function(){return this._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),i.prototype._updateNonUniformScalingState=function(a){return r.prototype._updateNonUniformScalingState.call(this,a)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(i.prototype,"onCollide",{set:function(a){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onCollisionPositionChange",{set:function(a){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._visibility},set:function(a){this._visibility!==a&&(this._visibility=a,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(a){this._material!==a&&(this._material=a,this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(a){this._receiveShadows!==a&&(this._receiveShadows=a,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasVertexAlpha",{get:function(){return this._hasVertexAlpha},set:function(a){this._hasVertexAlpha!==a&&(this._hasVertexAlpha=a,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useVertexColors",{get:function(){return this._useVertexColors},set:function(a){this._useVertexColors!==a&&(this._useVertexColors=a,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"computeBonesUsingShaders",{get:function(){return this._computeBonesUsingShaders},set:function(a){this._computeBonesUsingShaders!==a&&(this._computeBonesUsingShaders=a,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numBoneInfluencers",{get:function(){return this._numBoneInfluencers},set:function(a){this._numBoneInfluencers!==a&&(this._numBoneInfluencers=a,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"applyFog",{get:function(){return this._applyFog},set:function(a){this._applyFog!==a&&(this._applyFog=a,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerMask",{get:function(){return this._layerMask},set:function(a){a!==this._layerMask&&(this._layerMask=a,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(a){this._collisionMask=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(a){this._collisionGroup=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},set:function(a){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),a&&a.needInitialSkinMatrix&&a._registerMeshWithPoseMatrix(this),this._skeleton=a,this._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"AbstractMesh"},i.prototype.toString=function(a){var n="Name: "+this.name+", isInstance: "+(this instanceof t.InstancedMesh?"YES":"NO");return n+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(n+=", skeleton: "+this._skeleton.name),a&&(n+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],n+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),n},i.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),!!this.subMeshes)for(var a=0,n=this.subMeshes;a<n.length;a++){var s=n[a];s._rebuild()}},i.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var a=0,n=this.getScene().lights;a<n.length;a++){var s=n[a];s.isEnabled()&&s.canAffectMesh(this)&&this._lightSources.push(s)}this._markSubMeshesAsLightDirty()},i.prototype._resyncLighSource=function(a){var n=a.isEnabled()&&a.canAffectMesh(this),s=this._lightSources.indexOf(a);if(s===-1){if(!n)return;this._lightSources.push(a)}else{if(n)return;this._lightSources.splice(s,1)}this._markSubMeshesAsLightDirty()},i.prototype._unBindEffect=function(){for(var a=0,n=this.subMeshes;a<n.length;a++){var s=n[a];s.setEffect(null)}},i.prototype._removeLightSource=function(a){var n=this._lightSources.indexOf(a);n!==-1&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty())},i.prototype._markSubMeshesAsDirty=function(a){if(this.subMeshes)for(var n=0,s=this.subMeshes;n<s.length;n++){var o=s[n];o._materialDefines&&a(o._materialDefines)}},i.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(a){return a.markAsLightDirty()})},i.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(a){return a.markAsAttributesDirty()})},i.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var a=0,n=this.subMeshes;a<n.length;a++){var s=n[a],o=s.getMaterial();o&&o.markAsDirty(t.Material.MiscDirtyFlag)}},Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(a){this._scaling=a,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(a){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(a){return null},i.prototype.setVerticesData=function(a,n,s,o){return this},i.prototype.updateVerticesData=function(a,n,s,o){return this},i.prototype.setIndices=function(a,n){return this},i.prototype.isVerticesDataPresent=function(a){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},i.prototype.normalizeToUnitCube=function(a){a===void 0&&(a=!0);var n=this.getHierarchyBoundingVectors(a),s=n.max.subtract(n.min),o=Math.max(s.x,s.y,s.z);if(o===0)return this;var l=1/o;return this.scaling.scaleInPlace(l),this},i.prototype.setBoundingInfo=function(a){return this._boundingInfo=a,this},Object.defineProperty(i.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._preActivateForIntermediateRendering=function(a){},i.prototype._activate=function(a){this._renderId=a},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():r.prototype.getWorldMatrix.call(this)},i.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():r.prototype._getWorldMatrixDeterminant.call(this)},i.prototype.movePOV=function(a,n,s){return this.position.addInPlace(this.calcMovePOV(a,n,s)),this},i.prototype.calcMovePOV=function(a,n,s){var o=new t.Matrix,l=this.rotationQuaternion?this.rotationQuaternion:t.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);l.toRotationMatrix(o);var u=t.Vector3.Zero(),h=this.definedFacingForward?-1:1;return t.Vector3.TransformCoordinatesFromFloatsToRef(a*h,n,s*h,o,u),u},i.prototype.rotatePOV=function(a,n,s){return this.rotation.addInPlace(this.calcRotatePOV(a,n,s)),this},i.prototype.calcRotatePOV=function(a,n,s){var o=this.definedFacingForward?1:-1;return new t.Vector3(a*o,n,s*o)},i.prototype.getHierarchyBoundingVectors=function(a,n){a===void 0&&(a=!0),n===void 0&&(n=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var s,o,l=this.getBoundingInfo();if(this.subMeshes?(s=l.boundingBox.minimumWorld,o=l.boundingBox.maximumWorld):(s=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),a)for(var u=this.getDescendants(!1),h=0,d=u;h<d.length;h++){var p=d[h],m=p;if(m.computeWorldMatrix(!0),!(n&&!n(m))&&!(!m.getBoundingInfo||m.getTotalVertices()===0)){var _=m.getBoundingInfo(),v=_.boundingBox,S=v.minimumWorld,P=v.maximumWorld;t.Tools.CheckExtends(S,s,o),t.Tools.CheckExtends(P,s,o)}}return{min:s,max:o}},i.prototype._updateBoundingInfo=function(){return this._boundingInfo=this._boundingInfo||new t.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},i.prototype._updateSubMeshesBoundingInfo=function(a){if(!this.subMeshes)return this;for(var n=this.subMeshes.length,s=0;s<n;s++){var o=this.subMeshes[s];(n>1||!o.IsGlobal)&&o.updateBoundingInfo(a)}return this},i.prototype._afterComputeWorldMatrix=function(){this._updateBoundingInfo()},i.prototype.isInFrustum=function(a){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(a,this.cullingStrategy)},i.prototype.isCompletelyInFrustum=function(a){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(a)},i.prototype.intersectsMesh=function(a,n,s){if(n===void 0&&(n=!1),!this._boundingInfo||!a._boundingInfo)return!1;if(this._boundingInfo.intersects(a._boundingInfo,n))return this;if(s)for(var o=0,l=this.getChildMeshes();o<l.length;o++){var u=l[o];if(u.intersectsMesh(a,n,!0))return u}return!1},i.prototype.intersectsPoint=function(a,n){return this._boundingInfo?this._boundingInfo.intersectsPoint(a,n):!1},i.prototype.getPositionInCameraSpace=function(a){return a===void 0&&(a=null),a||(a=this.getScene().activeCamera),t.Vector3.TransformCoordinates(this.absolutePosition,a.getViewMatrix())},i.prototype.getDistanceToCamera=function(a){return a===void 0&&(a=null),a||(a=this.getScene().activeCamera),this.absolutePosition.subtract(a.position).length()},Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(a){this._checkCollisions=a,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(a){var n=this.getAbsolutePosition();return n.addToRef(this.ellipsoidOffset,this._oldPositionForCollisions),this._collider||(this._collider=new t.Collider),this._collider._radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,a,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},i.prototype._collideForSubMesh=function(a,n,s){if(this._generatePointsArray(),!this._positions)return this;if(!a._lastColliderWorldVertices||!a._lastColliderTransformMatrix.equals(n)){a._lastColliderTransformMatrix=n.clone(),a._lastColliderWorldVertices=[],a._trianglePlanes=[];for(var o=a.verticesStart,l=a.verticesStart+a.verticesCount,u=o;u<l;u++)a._lastColliderWorldVertices.push(t.Vector3.TransformCoordinates(this._positions[u],n))}return s._collide(a._trianglePlanes,a._lastColliderWorldVertices,this.getIndices(),a.indexStart,a.indexStart+a.indexCount,a.verticesStart,!!a.getMaterial()),s.collisionFound&&(s.collidedMesh=this),this},i.prototype._processCollisionsForSubMeshes=function(a,n){for(var s=this._scene.getCollidingSubMeshCandidates(this,a),o=s.length,l=0;l<o;l++){var u=s.data[l];o>1&&!u._checkCollision(a)||this._collideForSubMesh(u,n,a)}return this},i.prototype._checkCollision=function(a){if(!this._boundingInfo||!this._boundingInfo._checkCollision(a))return this;var n=t.Tmp.Matrix[0],s=t.Tmp.Matrix[1];return t.Matrix.ScalingToRef(1/a._radius.x,1/a._radius.y,1/a._radius.z,n),this.worldMatrixFromCache.multiplyToRef(n,s),this._processCollisionsForSubMeshes(a,s),this},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(a,n){var s=new t.PickingInfo;if(!this.subMeshes||!this._boundingInfo||!a.intersectsSphere(this._boundingInfo.boundingSphere)||!a.intersectsBox(this._boundingInfo.boundingBox)||!this._generatePointsArray())return s;for(var o=null,l=this._scene.getIntersectingSubMeshCandidates(this,a),u=l.length,h=0;h<u;h++){var d=l.data[h];if(!(u>1&&!d.canIntersects(a))){var p=d.intersects(a,this._positions,this.getIndices(),n);if(p&&(n||!o||p.distance<o.distance)&&(o=p,o.subMeshId=h,n))break}}if(o){var m=this.getWorldMatrix(),_=t.Vector3.TransformCoordinates(a.origin,m),v=a.direction.clone();v=v.scale(o.distance);var S=t.Vector3.TransformNormal(v,m),P=_.add(S);return s.hit=!0,s.distance=t.Vector3.Distance(_,P),s.pickedPoint=P,s.pickedMesh=this,s.bu=o.bu||0,s.bv=o.bv||0,s.faceId=o.faceId,s.subMeshId=o.subMeshId,s}return s},i.prototype.clone=function(a,n,s){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},i.prototype.dispose=function(a,n){var s=this;n===void 0&&(n=!1);var o;for(this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._skeleton=null,o=0;o<this._intersectionsInProgress.length;o++){var l=this._intersectionsInProgress[o],u=l._intersectionsInProgress.indexOf(this);l._intersectionsInProgress.splice(u,1)}this._intersectionsInProgress=[];var h=this.getScene().lights;h.forEach(function(p){var m=p.includedOnlyMeshes.indexOf(s);m!==-1&&p.includedOnlyMeshes.splice(m,1),m=p.excludedMeshes.indexOf(s),m!==-1&&p.excludedMeshes.splice(m,1);var _=p.getShadowGenerator();if(_){var v=_.getShadowMap();v&&v.renderList&&(m=v.renderList.indexOf(s),m!==-1&&v.renderList.splice(m,1))}}),this.getClassName()!=="InstancedMesh"&&this.releaseSubMeshes();var d=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,d.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),d.wipeCaches(),this.getScene().removeMesh(this),n&&this.material&&this.material.dispose(!1,!0),!a)for(o=0;o<this.getScene().particleSystems.length;o++)this.getScene().particleSystems[o].emitter===this&&(this.getScene().particleSystems[o].dispose(),o--);this._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),r.prototype.dispose.call(this,a,n)},i.prototype.addChild=function(a){return a.setParent(this),this},i.prototype.removeChild=function(a){return a.setParent(null),this},i.prototype._initFacetData=function(){var a=this._facetData;a.facetNormals||(a.facetNormals=new Array),a.facetPositions||(a.facetPositions=new Array),a.facetPartitioning||(a.facetPartitioning=new Array),a.facetNb=this.getIndices().length/3|0,a.partitioningSubdivisions=a.partitioningSubdivisions?a.partitioningSubdivisions:10,a.partitioningBBoxRatio=a.partitioningBBoxRatio?a.partitioningBBoxRatio:1.01;for(var n=0;n<a.facetNb;n++)a.facetNormals[n]=t.Vector3.Zero(),a.facetPositions[n]=t.Vector3.Zero();return a.facetDataEnabled=!0,this},i.prototype.updateFacetData=function(){var a=this._facetData;a.facetDataEnabled||this._initFacetData();var n=this.getVerticesData(t.VertexBuffer.PositionKind),s=this.getIndices(),o=this.getVerticesData(t.VertexBuffer.NormalKind),l=this.getBoundingInfo();if(a.facetDepthSort&&!a.facetDepthSortEnabled){if(a.facetDepthSortEnabled=!0,s instanceof Uint16Array)a.depthSortedIndices=new Uint16Array(s);else if(s instanceof Uint32Array)a.depthSortedIndices=new Uint32Array(s);else{for(var u=!1,h=0;h<s.length;h++)if(s[h]>65535){u=!0;break}u?a.depthSortedIndices=new Uint32Array(s):a.depthSortedIndices=new Uint16Array(s)}if(a.facetDepthSortFunction=function(P,x){return x.sqDistance-P.sqDistance},!a.facetDepthSortFrom){var d=this.getScene().activeCamera;a.facetDepthSortFrom=d?d.position:t.Vector3.Zero()}a.depthSortedFacets=[];for(var p=0;p<a.facetNb;p++){var m={ind:p*3,sqDistance:0};a.depthSortedFacets.push(m)}a.invertedMatrix=t.Matrix.Identity(),a.facetDepthSortOrigin=t.Vector3.Zero()}a.bbSize.x=l.maximum.x-l.minimum.x>t.Epsilon?l.maximum.x-l.minimum.x:t.Epsilon,a.bbSize.y=l.maximum.y-l.minimum.y>t.Epsilon?l.maximum.y-l.minimum.y:t.Epsilon,a.bbSize.z=l.maximum.z-l.minimum.z>t.Epsilon?l.maximum.z-l.minimum.z:t.Epsilon;var _=a.bbSize.x>a.bbSize.y?a.bbSize.x:a.bbSize.y;if(_=_>a.bbSize.z?_:a.bbSize.z,a.subDiv.max=a.partitioningSubdivisions,a.subDiv.X=Math.floor(a.subDiv.max*a.bbSize.x/_),a.subDiv.Y=Math.floor(a.subDiv.max*a.bbSize.y/_),a.subDiv.Z=Math.floor(a.subDiv.max*a.bbSize.z/_),a.subDiv.X=a.subDiv.X<1?1:a.subDiv.X,a.subDiv.Y=a.subDiv.Y<1?1:a.subDiv.Y,a.subDiv.Z=a.subDiv.Z<1?1:a.subDiv.Z,a.facetParameters.facetNormals=this.getFacetLocalNormals(),a.facetParameters.facetPositions=this.getFacetLocalPositions(),a.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),a.facetParameters.bInfo=l,a.facetParameters.bbSize=a.bbSize,a.facetParameters.subDiv=a.subDiv,a.facetParameters.ratio=this.partitioningBBoxRatio,a.facetParameters.depthSort=a.facetDepthSort,a.facetDepthSort&&a.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(a.invertedMatrix),t.Vector3.TransformCoordinatesToRef(a.facetDepthSortFrom,a.invertedMatrix,a.facetDepthSortOrigin),a.facetParameters.distanceTo=a.facetDepthSortOrigin),a.facetParameters.depthSortedFacets=a.depthSortedFacets,t.VertexData.ComputeNormals(n,s,o,a.facetParameters),a.facetDepthSort&&a.facetDepthSortEnabled){a.depthSortedFacets.sort(a.facetDepthSortFunction);for(var v=a.depthSortedIndices.length/3|0,p=0;p<v;p++){var S=a.depthSortedFacets[p].ind;a.depthSortedIndices[p*3]=s[S],a.depthSortedIndices[p*3+1]=s[S+1],a.depthSortedIndices[p*3+2]=s[S+2]}this.updateIndices(a.depthSortedIndices)}return this},i.prototype.getFacetLocalNormals=function(){return this._facetData.facetNormals||this.updateFacetData(),this._facetData.facetNormals},i.prototype.getFacetLocalPositions=function(){return this._facetData.facetPositions||this.updateFacetData(),this._facetData.facetPositions},i.prototype.getFacetLocalPartitioning=function(){return this._facetData.facetPartitioning||this.updateFacetData(),this._facetData.facetPartitioning},i.prototype.getFacetPosition=function(a){var n=t.Vector3.Zero();return this.getFacetPositionToRef(a,n),n},i.prototype.getFacetPositionToRef=function(a,n){var s=this.getFacetLocalPositions()[a],o=this.getWorldMatrix();return t.Vector3.TransformCoordinatesToRef(s,o,n),this},i.prototype.getFacetNormal=function(a){var n=t.Vector3.Zero();return this.getFacetNormalToRef(a,n),n},i.prototype.getFacetNormalToRef=function(a,n){var s=this.getFacetLocalNormals()[a];return t.Vector3.TransformNormalToRef(s,this.getWorldMatrix(),n),this},i.prototype.getFacetsAtLocalCoordinates=function(a,n,s){var o=this.getBoundingInfo(),l=this._facetData,u=Math.floor((a-o.minimum.x*l.partitioningBBoxRatio)*l.subDiv.X*l.partitioningBBoxRatio/l.bbSize.x),h=Math.floor((n-o.minimum.y*l.partitioningBBoxRatio)*l.subDiv.Y*l.partitioningBBoxRatio/l.bbSize.y),d=Math.floor((s-o.minimum.z*l.partitioningBBoxRatio)*l.subDiv.Z*l.partitioningBBoxRatio/l.bbSize.z);return u<0||u>l.subDiv.max||h<0||h>l.subDiv.max||d<0||d>l.subDiv.max?null:l.facetPartitioning[u+l.subDiv.max*h+l.subDiv.max*l.subDiv.max*d]},i.prototype.getClosestFacetAtCoordinates=function(a,n,s,o,l,u){l===void 0&&(l=!1),u===void 0&&(u=!0);var h=this.getWorldMatrix(),d=t.Tmp.Matrix[5];h.invertToRef(d);var p=t.Tmp.Vector3[8];t.Vector3.TransformCoordinatesFromFloatsToRef(a,n,s,d,p);var m=this.getClosestFacetAtLocalCoordinates(p.x,p.y,p.z,o,l,u);return o&&t.Vector3.TransformCoordinatesFromFloatsToRef(o.x,o.y,o.z,h,o),m},i.prototype.getClosestFacetAtLocalCoordinates=function(a,n,s,o,l,u){l===void 0&&(l=!1),u===void 0&&(u=!0);var h=null,d=0,p=0,m=0,_=0,v=0,S=0,P=0,x=0,R=this.getFacetLocalPositions(),w=this.getFacetLocalNormals(),I=this.getFacetsAtLocalCoordinates(a,n,s);if(!I)return null;for(var F=Number.MAX_VALUE,k=F,E,g,y,M=0;M<I.length;M++)E=I[M],g=w[E],y=R[E],_=(a-y.x)*g.x+(n-y.y)*g.y+(s-y.z)*g.z,(!l||l&&u&&_>=0||l&&!u&&_<=0)&&(_=g.x*y.x+g.y*y.y+g.z*y.z,v=-(g.x*a+g.y*n+g.z*s-_)/(g.x*g.x+g.y*g.y+g.z*g.z),S=a+g.x*v,P=n+g.y*v,x=s+g.z*v,d=S-a,p=P-n,m=x-s,k=d*d+p*p+m*m,k<F&&(F=k,h=E,o&&(o.x=S,o.y=P,o.z=x)));return h},i.prototype.getFacetDataParameters=function(){return this._facetData.facetParameters},i.prototype.disableFacetData=function(){return this._facetData.facetDataEnabled&&(this._facetData.facetDataEnabled=!1,this._facetData.facetPositions=new Array,this._facetData.facetNormals=new Array,this._facetData.facetPartitioning=new Array,this._facetData.facetParameters=null,this._facetData.depthSortedIndices=new Uint32Array(0)),this},i.prototype.updateIndices=function(a){return this},i.prototype.createNormals=function(a){var n=this.getVerticesData(t.VertexBuffer.PositionKind),s=this.getIndices(),o;return this.isVerticesDataPresent(t.VertexBuffer.NormalKind)?o=this.getVerticesData(t.VertexBuffer.NormalKind):o=[],t.VertexData.ComputeNormals(n,s,o,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(t.VertexBuffer.NormalKind,o,a),this},i.prototype.alignWithNormal=function(a,n){n||(n=t.Axis.Y);var s=t.Tmp.Vector3[0],o=t.Tmp.Vector3[1];return t.Vector3.CrossToRef(n,a,o),t.Vector3.CrossToRef(a,o,s),this.rotationQuaternion?t.Quaternion.RotationQuaternionFromAxisToRef(s,a,o,this.rotationQuaternion):t.Vector3.RotationFromAxisToRef(s,a,o,this.rotation),this},i.prototype._checkOcclusionQuery=function(){return!1},i.OCCLUSION_TYPE_NONE=0,i.OCCLUSION_TYPE_OPTIMISTIC=1,i.OCCLUSION_TYPE_STRICT=2,i.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,i.CULLINGSTRATEGY_STANDARD=0,i.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,i}(t.TransformNode);t.AbstractMesh=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n.diffuse=new t.Color3(1,1,1),n.specular=new t.Color3(1,1,1),n.falloffType=r.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=r.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n.getScene().addLight(n),n._uniformBuffer=new t.UniformBuffer(n.getScene().getEngine()),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return Object.defineProperty(r.prototype,"range",{get:function(){return this._range},set:function(i){this._range=i,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(i){this._intensityMode=i,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"radius",{get:function(){return this._radius},set:function(i){this._radius=i,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(i){this._shadowEnabled!==i&&(this._shadowEnabled=i,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(i){this._includedOnlyMeshes=i,this._hookArrayForIncludedOnly(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(i){this._excludedMeshes=i,this._hookArrayForExcluded(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(i){this._excludeWithLayerMask=i,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(i){this._includeOnlyWithLayerMask=i,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(i){this._lightmapMode!==i&&(this._lightmapMode=i,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"Light"},r.prototype.toString=function(i){var a="Name: "+this.name;if(a+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)a+=", animation[0]: "+this.animations[n].toString(i);return a},r.prototype._syncParentEnabledState=function(){c.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},r.prototype.setEnabled=function(i){c.prototype.setEnabled.call(this,i),this._resyncMeshes()},r.prototype.getShadowGenerator=function(){return this._shadowGenerator},r.prototype.getAbsolutePosition=function(){return t.Vector3.Zero()},r.prototype.canAffectMesh=function(i){return i?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(i)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(i)!==-1||this.includeOnlyWithLayerMask!==0&&!(this.includeOnlyWithLayerMask&i.layerMask)||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&i.layerMask):!0},r.CompareLightsPriority=function(i,a){return i.shadowEnabled!==a.shadowEnabled?(a.shadowEnabled?1:0)-(i.shadowEnabled?1:0):a.renderPriority-i.renderPriority},r.prototype.dispose=function(i,a){a===void 0&&(a=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var n=0,s=this.getScene().meshes;n<s.length;n++){var o=s[n];o._removeLightSource(this)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),c.prototype.dispose.call(this,i,a)},r.prototype.getTypeID=function(){return 0},r.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},r.prototype.clone=function(i){var a=r.GetConstructorFromName(this.getTypeID(),i,this.getScene());return a?t.SerializationHelper.Clone(a,this):null},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.type=this.getTypeID(),this.parent&&(i.parentId=this.parent.id),this.excludedMeshes.length>0&&(i.excludedMeshesIds=[],this.excludedMeshes.forEach(function(a){i.excludedMeshesIds.push(a.id)})),this.includedOnlyMeshes.length>0&&(i.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(a){i.includedOnlyMeshesIds.push(a.id)})),t.Animation.AppendSerializedAnimations(this,i),i.ranges=this.serializeAnimationRanges(),i},r.GetConstructorFromName=function(i,a,n){var s=t.Node.Construct("Light_Type_"+i,a,n);return s||null},r.Parse=function(i,a){var n=r.GetConstructorFromName(i.type,i.name,a);if(!n)return null;var s=t.SerializationHelper.Parse(n,i,a);if(i.excludedMeshesIds&&(s._excludedMeshesIds=i.excludedMeshesIds),i.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=i.includedOnlyMeshesIds),i.parentId&&(s._waitingParentId=i.parentId),i.animations){for(var o=0;o<i.animations.length;o++){var l=i.animations[o];s.animations.push(t.Animation.Parse(l))}t.Node.ParseAnimationRanges(s,i,a)}return i.autoAnimate&&a.beginAnimation(s,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1),s},r.prototype._hookArrayForExcluded=function(i){var a=this,n=i.push;i.push=function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];for(var p=n.apply(i,h),m=0,_=h;m<_.length;m++){var v=_[m];v._resyncLighSource(a)}return p};var s=i.splice;i.splice=function(h,d){for(var p=s.apply(i,[h,d]),m=0,_=p;m<_.length;m++){var v=_[m];v._resyncLighSource(a)}return p};for(var o=0,l=i;o<l.length;o++){var u=l[o];u._resyncLighSource(this)}},r.prototype._hookArrayForIncludedOnly=function(i){var a=this,n=i.push;i.push=function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];var u=n.apply(i,o);return a._resyncMeshes(),u};var s=i.splice;i.splice=function(o,l){var u=s.apply(i,[o,l]);return a._resyncMeshes(),u},this._resyncMeshes()},r.prototype._resyncMeshes=function(){for(var i=0,a=this.getScene().meshes;i<a.length;i++){var n=a[i];n._resyncLighSource(this)}},r.prototype._markMeshesAsLightDirty=function(){for(var i=0,a=this.getScene().meshes;i<a.length;i++){var n=a[i];n._lightSources.indexOf(this)!==-1&&n._markSubMeshesAsLightDirty()}},r.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},r.prototype._getPhotometricScale=function(){var i=0,a=this.getTypeID(),n=this.intensityMode;switch(n===r.INTENSITYMODE_AUTOMATIC&&(a===r.LIGHTTYPEID_DIRECTIONALLIGHT?n=r.INTENSITYMODE_ILLUMINANCE:n=r.INTENSITYMODE_LUMINOUSINTENSITY),a){case r.LIGHTTYPEID_POINTLIGHT:case r.LIGHTTYPEID_SPOTLIGHT:switch(n){case r.INTENSITYMODE_LUMINOUSPOWER:i=1/(4*Math.PI);break;case r.INTENSITYMODE_LUMINOUSINTENSITY:i=1;break;case r.INTENSITYMODE_LUMINANCE:i=this.radius*this.radius;break}break;case r.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case r.INTENSITYMODE_ILLUMINANCE:i=1;break;case r.INTENSITYMODE_LUMINANCE:var s=this.radius;s=Math.max(s,.001);var o=2*Math.PI*(1-Math.cos(s));i=o;break}break;case r.LIGHTTYPEID_HEMISPHERICLIGHT:i=1;break}return i},r.prototype._reorderLightsInScene=function(){var i=this.getScene();this._renderPriority!=0&&(i.requireLightSorting=!0),this.getScene().sortLightsByPriority()},r.FALLOFF_DEFAULT=0,r.FALLOFF_PHYSICAL=1,r.FALLOFF_GLTF=2,r.FALLOFF_STANDARD=3,r.LIGHTMAP_DEFAULT=0,r.LIGHTMAP_SPECULAR=1,r.LIGHTMAP_SHADOWSONLY=2,r.INTENSITYMODE_AUTOMATIC=0,r.INTENSITYMODE_LUMINOUSPOWER=1,r.INTENSITYMODE_LUMINOUSINTENSITY=2,r.INTENSITYMODE_ILLUMINANCE=3,r.INTENSITYMODE_LUMINANCE=4,r.LIGHTTYPEID_POINTLIGHT=0,r.LIGHTTYPEID_DIRECTIONALLIGHT=1,r.LIGHTTYPEID_SPOTLIGHT=2,r.LIGHTTYPEID_HEMISPHERICLIGHT=3,A([t.serializeAsColor3()],r.prototype,"diffuse",void 0),A([t.serializeAsColor3()],r.prototype,"specular",void 0),A([t.serialize()],r.prototype,"falloffType",void 0),A([t.serialize()],r.prototype,"intensity",void 0),A([t.serialize()],r.prototype,"range",null),A([t.serialize()],r.prototype,"intensityMode",null),A([t.serialize()],r.prototype,"radius",null),A([t.serialize()],r.prototype,"_renderPriority",void 0),A([t.expandToProperty("_reorderLightsInScene")],r.prototype,"renderPriority",void 0),A([t.serialize("shadowEnabled")],r.prototype,"_shadowEnabled",void 0),A([t.serialize("excludeWithLayerMask")],r.prototype,"_excludeWithLayerMask",void 0),A([t.serialize("includeOnlyWithLayerMask")],r.prototype,"_includeOnlyWithLayerMask",void 0),A([t.serialize("lightmapMode")],r.prototype,"_lightmapMode",void 0),r}(t.Node);t.Light=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s=!0);var o=c.call(this,i,n)||this;return o.upVector=t.Vector3.Up(),o.orthoLeft=null,o.orthoRight=null,o.orthoBottom=null,o.orthoTop=null,o.fov=.8,o.minZ=1,o.maxZ=1e4,o.inertia=.9,o.mode=r.PERSPECTIVE_CAMERA,o.isIntermediate=!1,o.viewport=new t.Viewport(0,0,1,1),o.layerMask=268435455,o.fovMode=r.FOVMODE_VERTICAL_FIXED,o.cameraRigMode=r.RIG_MODE_NONE,o.customRenderTargets=new Array,o.onViewMatrixChangedObservable=new t.Observable,o.onProjectionMatrixChangedObservable=new t.Observable,o.onAfterCheckInputsObservable=new t.Observable,o.onRestoreStateObservable=new t.Observable,o._rigCameras=new Array,o._webvrViewMatrix=t.Matrix.Identity(),o._skipRendering=!1,o._projectionMatrix=new t.Matrix,o._postProcesses=new Array,o._activeMeshes=new t.SmartArray(256),o._globalPosition=t.Vector3.Zero(),o._computedViewMatrix=t.Matrix.Identity(),o._doNotComputeProjectionMatrix=!1,o._transformMatrix=t.Matrix.Zero(),o._refreshFrustumPlanes=!0,o.autoClear=!0,o.getScene().addCamera(o),s&&!o.getScene().activeCamera&&(o.getScene().activeCamera=o),o.position=a,o}return r.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},r.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},r.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},r.prototype.getClassName=function(){return"Camera"},r.prototype.toString=function(i){var a="Name: "+this.name;if(a+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)a+=", animation[0]: "+this.animations[n].toString(i);return a},Object.defineProperty(r.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),r.prototype.getActiveMeshes=function(){return this._activeMeshes},r.prototype.isActiveMesh=function(i){return this._activeMeshes.indexOf(i)!==-1},r.prototype.isReady=function(i){if(i===void 0&&(i=!1),i)for(var a=0,n=this._postProcesses;a<n.length;a++){var s=n[a];if(s&&!s.isReady())return!1}return c.prototype.isReady.call(this,i)},r.prototype._initCache=function(){c.prototype._initCache.call(this),this._cache.position=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},r.prototype._updateCache=function(i){i||c.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},r.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},r.prototype._isSynchronizedViewMatrix=function(){return c.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},r.prototype._isSynchronizedProjectionMatrix=function(){var i=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!i)return!1;var a=this.getEngine();return this.mode===r.PERSPECTIVE_CAMERA?i=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===a.getAspectRatio(this):i=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===a.getRenderWidth()&&this._cache.renderHeight===a.getRenderHeight(),i},r.prototype.attachControl=function(i,a){},r.prototype.detachControl=function(i){},r.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==r.RIG_MODE_NONE&&this._updateRigCameras()},r.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(r.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),r.prototype._getFirstPostProcess=function(){for(var i=0;i<this._postProcesses.length;i++)if(this._postProcesses[i]!==null)return this._postProcesses[i];return null},r.prototype._cascadePostProcessesToRigCams=function(){var i=this._getFirstPostProcess();i&&i.markTextureDirty();for(var a=0,n=this._rigCameras.length;a<n;a++){var s=this._rigCameras[a],o=s._rigPostProcess;if(o){var l=o instanceof t.PassPostProcess;l&&(s.isIntermediate=this._postProcesses.length===0),s._postProcesses=this._postProcesses.slice(0).concat(o),o.markTextureDirty()}else s._postProcesses=this._postProcesses.slice(0)}},r.prototype.attachPostProcess=function(i,a){return a===void 0&&(a=null),!i.isReusable()&&this._postProcesses.indexOf(i)>-1?(t.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(a==null||a<0?this._postProcesses.push(i):this._postProcesses[a]===null?this._postProcesses[a]=i:this._postProcesses.splice(a,0,i),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(i))},r.prototype.detachPostProcess=function(i){var a=this._postProcesses.indexOf(i);a!==-1&&(this._postProcesses[a]=null),this._cascadePostProcessesToRigCams()},r.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},r.prototype._getViewMatrix=function(){return t.Matrix.Identity()},r.prototype.getViewMatrix=function(i){return!i&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this._currentRenderId,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},r.prototype.freezeProjectionMatrix=function(i){this._doNotComputeProjectionMatrix=!0,i!==void 0&&(this._projectionMatrix=i)},r.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},r.prototype.getProjectionMatrix=function(i){if(this._doNotComputeProjectionMatrix||!i&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var a=this.getEngine(),n=this.getScene();if(this.mode===r.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=a.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),n.useRightHandedSystem?t.Matrix.PerspectiveFovRHToRef(this.fov,a.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===r.FOVMODE_VERTICAL_FIXED):t.Matrix.PerspectiveFovLHToRef(this.fov,a.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===r.FOVMODE_VERTICAL_FIXED);else{var s=a.getRenderWidth()/2,o=a.getRenderHeight()/2;n.useRightHandedSystem?t.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-s,this.orthoRight||s,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix):t.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-s,this.orthoRight||s,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=a.getRenderWidth(),this._cache.renderHeight=a.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},r.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},r.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?t.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=t.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},r.prototype.isInFrustum=function(i){return this._updateFrustumPlanes(),i.isInFrustum(this._frustumPlanes)},r.prototype.isCompletelyInFrustum=function(i){return this._updateFrustumPlanes(),i.isCompletelyInFrustum(this._frustumPlanes)},r.prototype.getForwardRay=function(i,a,n){i===void 0&&(i=100),a||(a=this.getWorldMatrix()),n||(n=this.position);var s=this._scene.useRightHandedSystem?new t.Vector3(0,0,-1):new t.Vector3(0,0,1),o=t.Vector3.TransformNormal(s,a),l=t.Vector3.Normalize(o);return new t.Ray(n,l,i)},r.prototype.dispose=function(i,a){for(a===void 0&&(a=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==r.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var o=this._postProcesses.length;--o>=0;){var s=this._postProcesses[o];s&&s.dispose(this)}for(var o=this.customRenderTargets.length;--o>=0;)this.customRenderTargets[o].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),c.prototype.dispose.call(this,i,a)},Object.defineProperty(r.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),r.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},r.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},r.prototype.setCameraRigMode=function(i,a){if(this.cameraRigMode!==i){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=i,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=a.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=t.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==r.RIG_MODE_NONE){var s=this.createRigCamera(this.name+"_L",0),o=this.createRigCamera(this.name+"_R",1);s&&o&&(this._rigCameras.push(s),this._rigCameras.push(o))}switch(this.cameraRigMode){case r.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new t.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new t.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case r.RIG_MODE_STEREOSCOPIC_OVERUNDER:var l=this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new t.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new t.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,l);break;case r.RIG_MODE_VR:var u=a.vrCameraMetrics||t.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=u,this._rigCameras[0].viewport=new t.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new t.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=u.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=u.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=u,this._rigCameras[1].viewport=new t.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new t.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=u.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=u.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,u.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new t.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,u),this._rigCameras[1]._rigPostProcess=new t.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,u));break;case r.RIG_MODE_WEBVR:if(a.vrDisplay){var h=a.vrDisplay.getEyeParameters("left"),d=a.vrDisplay.getEyeParameters("right");this._rigCameras[0].viewport=new t.Viewport(0,0,.5,1),this._rigCameras[0].setCameraRigParameter("left",!0),this._rigCameras[0].setCameraRigParameter("specs",a.specs),this._rigCameras[0].setCameraRigParameter("eyeParameters",h),this._rigCameras[0].setCameraRigParameter("frameData",a.frameData),this._rigCameras[0].setCameraRigParameter("parentCamera",a.parentCamera),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new t.Matrix,this._rigCameras[0].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[0].parent=this,this._rigCameras[0]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[1].viewport=new t.Viewport(.5,0,.5,1),this._rigCameras[1].setCameraRigParameter("eyeParameters",d),this._rigCameras[1].setCameraRigParameter("specs",a.specs),this._rigCameras[1].setCameraRigParameter("frameData",a.frameData),this._rigCameras[1].setCameraRigParameter("parentCamera",a.parentCamera),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new t.Matrix,this._rigCameras[1].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[1].parent=this,this._rigCameras[1]._getViewMatrix=this._getWebVRViewMatrix,r.UseAlternateWebVRRendering&&(this._rigCameras[1]._skipRendering=!0,this._rigCameras[0]._alternateCamera=this._rigCameras[1])}break}this._cascadePostProcessesToRigCams(),this.update()}},r.prototype._getVRProjectionMatrix=function(){return t.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},r.prototype._updateCameraRotationMatrix=function(){},r.prototype._updateWebVRCameraRotationMatrix=function(){},r.prototype._getWebVRProjectionMatrix=function(){return t.Matrix.Identity()},r.prototype._getWebVRViewMatrix=function(){return t.Matrix.Identity()},r.prototype.setCameraRigParameter=function(i,a){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[i]=a,i==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=t.Tools.ToRadians(a/.0637))},r.prototype.createRigCamera=function(i,a){return null},r.prototype._updateRigCameras=function(){for(var i=0;i<this._rigCameras.length;i++)this._rigCameras[i].minZ=this.minZ,this._rigCameras[i].maxZ=this.maxZ,this._rigCameras[i].fov=this.fov;this.cameraRigMode===r.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},r.prototype._setupInputs=function(){},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.type=this.getClassName(),this.parent&&(i.parentId=this.parent.id),this.inputs&&this.inputs.serialize(i),t.Animation.AppendSerializedAnimations(this,i),i.ranges=this.serializeAnimationRanges(),i},r.prototype.clone=function(i){return t.SerializationHelper.Clone(r.GetConstructorFromName(this.getClassName(),i,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},r.prototype.getDirection=function(i){var a=t.Vector3.Zero();return this.getDirectionToRef(i,a),a},r.prototype.getDirectionToRef=function(i,a){t.Vector3.TransformNormalToRef(i,this.getWorldMatrix(),a)},r.GetConstructorFromName=function(i,a,n,s,o){s===void 0&&(s=0),o===void 0&&(o=!0);var l=t.Node.Construct(i,a,n,{interaxial_distance:s,isStereoscopicSideBySide:o});return l||function(){return new t.UniversalCamera(a,t.Vector3.Zero(),n)}},r.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},r.Parse=function(i,a){var n=i.type,s=r.GetConstructorFromName(n,i.name,a,i.interaxial_distance,i.isStereoscopicSideBySide),o=t.SerializationHelper.Parse(s,i,a);if(i.parentId&&(o._waitingParentId=i.parentId),o.inputs&&(o.inputs.parse(i),o._setupInputs()),o.setPosition&&(o.position.copyFromFloats(0,0,0),o.setPosition(t.Vector3.FromArray(i.position))),i.target&&o.setTarget&&o.setTarget(t.Vector3.FromArray(i.target)),i.cameraRigMode){var l=i.interaxial_distance?{interaxialDistance:i.interaxial_distance}:{};o.setCameraRigMode(i.cameraRigMode,l)}if(i.animations){for(var u=0;u<i.animations.length;u++){var h=i.animations[u];o.animations.push(t.Animation.Parse(h))}t.Node.ParseAnimationRanges(o,i,a)}return i.autoAnimate&&a.beginAnimation(o,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1),o},r.PERSPECTIVE_CAMERA=0,r.ORTHOGRAPHIC_CAMERA=1,r.FOVMODE_VERTICAL_FIXED=0,r.FOVMODE_HORIZONTAL_FIXED=1,r.RIG_MODE_NONE=0,r.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,r.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,r.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,r.RIG_MODE_VR=20,r.RIG_MODE_WEBVR=21,r.ForceAttachControlToAlwaysPreventDefault=!1,r.UseAlternateWebVRRendering=!1,A([t.serializeAsVector3()],r.prototype,"position",void 0),A([t.serializeAsVector3()],r.prototype,"upVector",void 0),A([t.serialize()],r.prototype,"orthoLeft",void 0),A([t.serialize()],r.prototype,"orthoRight",void 0),A([t.serialize()],r.prototype,"orthoBottom",void 0),A([t.serialize()],r.prototype,"orthoTop",void 0),A([t.serialize()],r.prototype,"fov",void 0),A([t.serialize()],r.prototype,"minZ",void 0),A([t.serialize()],r.prototype,"maxZ",void 0),A([t.serialize()],r.prototype,"inertia",void 0),A([t.serialize()],r.prototype,"mode",void 0),A([t.serialize()],r.prototype,"layerMask",void 0),A([t.serialize()],r.prototype,"fovMode",void 0),A([t.serialize()],r.prototype,"cameraRigMode",void 0),A([t.serialize()],r.prototype,"interaxialDistance",void 0),A([t.serialize()],r.prototype,"isStereoscopicSideBySide",void 0),r}(t.Node);t.Camera=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new t.RenderingGroupInfo,this._scene=r;for(var i=c.MIN_RENDERINGGROUPS;i<c.MAX_RENDERINGGROUPS;i++)this._autoClearDepthStencil[i]={autoClear:!0,depth:!0,stencil:!0}}return c.prototype._clearDepthStencilBuffer=function(r,i){r===void 0&&(r=!0),i===void 0&&(i=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,r,i),this._depthStencilBufferAlreadyCleaned=!0)},c.prototype.render=function(r,i,a,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var o=0;o<this._scene.spriteManagers.length;o++){var l=this._scene.spriteManagers[o];this.dispatchSprites(l)}for(var o=c.MIN_RENDERINGGROUPS;o<c.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===c.MIN_RENDERINGGROUPS;var u=this._renderingGroups[o];if(u){var h=Math.pow(2,o);if(s.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,h),c.AUTOCLEAR){var d=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];d&&d.autoClear&&this._clearDepthStencilBuffer(d.depth,d.stencil)}for(var p=0,m=this._scene._beforeRenderingGroupDrawStage;p<m.length;p++){var _=m[p];_.action(o)}u.render(r,n,a,i);for(var v=0,S=this._scene._afterRenderingGroupDrawStage;v<S.length;v++){var _=S[v];_.action(o)}this._scene.onAfterRenderingGroupObservable.notifyObservers(s,h)}}},c.prototype.reset=function(){for(var r=c.MIN_RENDERINGGROUPS;r<c.MAX_RENDERINGGROUPS;r++){var i=this._renderingGroups[r];i&&i.prepare()}},c.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},c.prototype.freeRenderingGroups=function(){for(var r=c.MIN_RENDERINGGROUPS;r<c.MAX_RENDERINGGROUPS;r++){var i=this._renderingGroups[r];i&&i.dispose()}},c.prototype._prepareRenderingGroup=function(r){this._renderingGroups[r]===void 0&&(this._renderingGroups[r]=new t.RenderingGroup(r,this._scene,this._customOpaqueSortCompareFn[r],this._customAlphaTestSortCompareFn[r],this._customTransparentSortCompareFn[r]))},c.prototype.dispatchSprites=function(r){var i=r.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatchSprites(r)},c.prototype.dispatchParticles=function(r){var i=r.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatchParticles(r)},c.prototype.dispatch=function(r,i,a){i===void 0&&(i=r.getMesh());var n=i.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(r,i,a)},c.prototype.setRenderingOrder=function(r,i,a,n){if(i===void 0&&(i=null),a===void 0&&(a=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[r]=i,this._customAlphaTestSortCompareFn[r]=a,this._customTransparentSortCompareFn[r]=n,this._renderingGroups[r]){var s=this._renderingGroups[r];s.opaqueSortCompareFn=this._customOpaqueSortCompareFn[r],s.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[r],s.transparentSortCompareFn=this._customTransparentSortCompareFn[r]}},c.prototype.setRenderingAutoClearDepthStencil=function(r,i,a,n){a===void 0&&(a=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[r]={autoClear:i,depth:a,stencil:n}},c.prototype.getAutoClearDepthStencilSetup=function(r){return this._autoClearDepthStencil[r]},c.MAX_RENDERINGGROUPS=4,c.MIN_RENDERINGGROUPS=0,c.AUTOCLEAR=!0,c}();t.RenderingManager=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s){a===void 0&&(a=null),n===void 0&&(n=null),s===void 0&&(s=null),this.index=r,this._opaqueSubMeshes=new t.SmartArray(256),this._transparentSubMeshes=new t.SmartArray(256),this._alphaTestSubMeshes=new t.SmartArray(256),this._depthOnlySubMeshes=new t.SmartArray(256),this._particleSystems=new t.SmartArray(256),this._spriteManagers=new t.SmartArray(256),this._edgesRenderers=new t.SmartArray(16),this._scene=i,this.opaqueSortCompareFn=a,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=s}return Object.defineProperty(c.prototype,"opaqueSortCompareFn",{set:function(r){this._opaqueSortCompareFn=r,r?this._renderOpaque=this.renderOpaqueSorted:this._renderOpaque=c.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"alphaTestSortCompareFn",{set:function(r){this._alphaTestSortCompareFn=r,r?this._renderAlphaTest=this.renderAlphaTestSorted:this._renderAlphaTest=c.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transparentSortCompareFn",{set:function(r){r?this._transparentSortCompareFn=r:this._transparentSortCompareFn=c.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),c.prototype.render=function(r,i,a,n){if(r){r(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var s=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(s.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),s.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var o=s.getStencilBuffer();if(s.setStencilBuffer(!1),i&&this._renderSprites(),a&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(this._renderTransparent(this._transparentSubMeshes),s.setAlphaMode(t.Engine.ALPHA_DISABLE)),s.setStencilBuffer(!1),this._edgesRenderers.length){for(var l=0;l<this._edgesRenderers.length;l++)this._edgesRenderers.data[l].render();s.setAlphaMode(t.Engine.ALPHA_DISABLE)}s.setStencilBuffer(o)},c.prototype.renderOpaqueSorted=function(r){return c.renderSorted(r,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},c.prototype.renderAlphaTestSorted=function(r){return c.renderSorted(r,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},c.prototype.renderTransparentSorted=function(r){return c.renderSorted(r,this._transparentSortCompareFn,this._scene.activeCamera,!0)},c.renderSorted=function(r,i,a,n){for(var s=0,o,l=a?a.globalPosition:t.Vector3.Zero();s<r.length;s++)o=r.data[s],o._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=o.getBoundingInfo().boundingSphere.centerWorld.subtract(l).length();var u=r.data.slice(0,r.length);for(i&&u.sort(i),s=0;s<u.length;s++){if(o=u[s],n){var h=o.getMaterial();if(h&&h.needDepthPrePass){var d=h.getScene().getEngine();d.setColorWrite(!1),d.setAlphaMode(t.Engine.ALPHA_DISABLE),o.render(!1),d.setColorWrite(!0)}}o.render(n)}},c.renderUnsorted=function(r){for(var i=0;i<r.length;i++){var a=r.data[i];a.render(!1)}},c.defaultTransparentSortCompare=function(r,i){return r._alphaIndex>i._alphaIndex?1:r._alphaIndex<i._alphaIndex?-1:c.backToFrontSortCompare(r,i)},c.backToFrontSortCompare=function(r,i){return r._distanceToCamera<i._distanceToCamera?1:r._distanceToCamera>i._distanceToCamera?-1:0},c.frontToBackSortCompare=function(r,i){return r._distanceToCamera<i._distanceToCamera?-1:r._distanceToCamera>i._distanceToCamera?1:0},c.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},c.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},c.prototype.dispatch=function(r,i,a){i===void 0&&(i=r.getMesh()),a===void 0&&(a=r.getMaterial()),a!=null&&(a.needAlphaBlendingForMesh(i)?this._transparentSubMeshes.push(r):a.needAlphaTesting()?(a.needDepthPrePass&&this._depthOnlySubMeshes.push(r),this._alphaTestSubMeshes.push(r)):(a.needDepthPrePass&&this._depthOnlySubMeshes.push(r),this._opaqueSubMeshes.push(r)),i._edgesRenderer&&i._edgesRenderer.isEnabled&&this._edgesRenderers.push(i._edgesRenderer))},c.prototype.dispatchSprites=function(r){this._spriteManagers.push(r)},c.prototype.dispatchParticles=function(r){this._particleSystems.push(r)},c.prototype._renderParticles=function(r){if(this._particleSystems.length!==0){var i=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var a=0;a<this._particleSystems.length;a++){var n=this._particleSystems.data[a];if((i&&i.layerMask&n.layerMask)!==0){var s=n.emitter;(!s.position||!r||r.indexOf(s)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},c.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var r=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._spriteManagers.length;i++){var a=this._spriteManagers.data[i];(r&&r.layerMask&a.layerMask)!==0&&a.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},c}();t.RenderingGroup=f})(T||(T={}));var T;(function(t){var f=function(){function r(){}return r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,r.STEP_BEFORECAMERADRAW_LAYER=1,r.STEP_BEFORERENDERINGMESH_OUTLINE=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=0,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,r.STEP_AFTERCAMERADRAW_LAYER=3,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0,r}();t.SceneComponentConstants=f;var c=function(r){N(i,r);function i(a){return r.apply(this,a)||this}return i.Create=function(){return Object.create(i.prototype)},i.prototype.registerStep=function(a,n,s){for(var o=0,l=Number.MAX_VALUE;o<this.length;o++){var u=this[o];if(l=u.index,a<l)break}this.splice(o,0,{index:a,component:n,action:s.bind(n)})},i.prototype.clear=function(){this.length=0},i}(Array);t.Stage=c})(T||(T={}));var T;(function(t){var f=function(){function c(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array}return c.AddParser=function(r,i){this._BabylonFileParsers[r]=i},c.GetParser=function(r){return this._BabylonFileParsers[r]?this._BabylonFileParsers[r]:null},c.AddIndividualParser=function(r,i){this._IndividualBabylonFileParsers[r]=i},c.GetIndividualParser=function(r){return this._IndividualBabylonFileParsers[r]?this._IndividualBabylonFileParsers[r]:null},c.Parse=function(r,i,a,n){for(var s in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(s)&&this._BabylonFileParsers[s](r,i,a,n)},c._BabylonFileParsers={},c._IndividualBabylonFileParsers={},c}();t.AbstractScene=f})(T||(T={}));var T;(function(t){var f=function(){function i(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(i.prototype,"singleClick",{get:function(){return this._singleClick},set:function(a){this._singleClick=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(a){this._doubleClick=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(a){this._hasSwiped=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ignore",{get:function(){return this._ignore},set:function(a){this._ignore=a},enumerable:!0,configurable:!0}),i}(),c=function(){function i(){}return i}();t.RenderingGroupInfo=c;var r=function(i){N(a,i);function a(n){var s=i.call(this)||this;return s.autoClear=!0,s.autoClearDepthAndStencil=!0,s.clearColor=new t.Color4(.2,.2,.3,1),s.ambientColor=new t.Color3(0,0,0),s._forceWireframe=!1,s._forcePointsCloud=!1,s.animationsEnabled=!0,s._animationPropertiesOverride=null,s.useConstantAnimationDeltaTime=!1,s.constantlyUpdateMeshUnderPointer=!1,s.hoverCursor="pointer",s.defaultCursor="",s.preventDefaultOnPointerDown=!0,s.metadata=null,s.disableOfflineSupportExceptionRules=new Array,s.onDisposeObservable=new t.Observable,s._onDisposeObserver=null,s.onBeforeRenderObservable=new t.Observable,s._onBeforeRenderObserver=null,s.onAfterRenderObservable=new t.Observable,s._onAfterRenderObserver=null,s.onBeforeAnimationsObservable=new t.Observable,s.onAfterAnimationsObservable=new t.Observable,s.onBeforeDrawPhaseObservable=new t.Observable,s.onAfterDrawPhaseObservable=new t.Observable,s.onReadyObservable=new t.Observable,s.onBeforeCameraRenderObservable=new t.Observable,s._onBeforeCameraRenderObserver=null,s.onAfterCameraRenderObservable=new t.Observable,s._onAfterCameraRenderObserver=null,s.onBeforeActiveMeshesEvaluationObservable=new t.Observable,s.onAfterActiveMeshesEvaluationObservable=new t.Observable,s.onBeforeParticlesRenderingObservable=new t.Observable,s.onAfterParticlesRenderingObservable=new t.Observable,s.onDataLoadedObservable=new t.Observable,s.onNewCameraAddedObservable=new t.Observable,s.onCameraRemovedObservable=new t.Observable,s.onNewLightAddedObservable=new t.Observable,s.onLightRemovedObservable=new t.Observable,s.onNewGeometryAddedObservable=new t.Observable,s.onGeometryRemovedObservable=new t.Observable,s.onNewTransformNodeAddedObservable=new t.Observable,s.onTransformNodeRemovedObservable=new t.Observable,s.onNewMeshAddedObservable=new t.Observable,s.onMeshRemovedObservable=new t.Observable,s.onNewMaterialAddedObservable=new t.Observable,s.onMaterialRemovedObservable=new t.Observable,s.onNewTextureAddedObservable=new t.Observable,s.onTextureRemovedObservable=new t.Observable,s.onBeforeRenderTargetsRenderObservable=new t.Observable,s.onAfterRenderTargetsRenderObservable=new t.Observable,s.onBeforeStepObservable=new t.Observable,s.onAfterStepObservable=new t.Observable,s.onBeforeRenderingGroupObservable=new t.Observable,s.onAfterRenderingGroupObservable=new t.Observable,s.onMeshImportedObservable=new t.Observable,s._registeredForLateAnimationBindings=new t.SmartArrayNoDuplicate(256),s.onPrePointerObservable=new t.Observable,s.onPointerObservable=new t.Observable,s._meshPickProceed=!1,s._currentPickResult=null,s._previousPickResult=null,s._totalPointersPressed=0,s._doubleClickOccured=!1,s.cameraToUseForPointers=null,s._pointerX=0,s._pointerY=0,s._startingPointerPosition=new t.Vector2(0,0),s._previousStartingPointerPosition=new t.Vector2(0,0),s._startingPointerTime=0,s._previousStartingPointerTime=0,s._pointerCaptures={},s._timeAccumulator=0,s._currentStepId=0,s._currentInternalStep=0,s.onPreKeyboardObservable=new t.Observable,s.onKeyboardObservable=new t.Observable,s._useRightHandedSystem=!1,s._fogEnabled=!0,s._fogMode=a.FOGMODE_NONE,s.fogColor=new t.Color3(.2,.2,.3),s.fogDensity=.1,s.fogStart=0,s.fogEnd=1e3,s._shadowsEnabled=!0,s._lightsEnabled=!0,s.activeCameras=new Array,s._texturesEnabled=!0,s.particlesEnabled=!0,s.spritesEnabled=!0,s._skeletonsEnabled=!0,s.lensFlaresEnabled=!0,s.collisionsEnabled=!0,s.gravity=new t.Vector3(0,-9.807,0),s.postProcessesEnabled=!0,s.postProcesses=new Array,s.renderTargetsEnabled=!0,s.dumpNextRenderTargets=!1,s.customRenderTargets=new Array,s.importedMeshesFiles=new Array,s.probesEnabled=!0,s._meshesForIntersections=new t.SmartArrayNoDuplicate(256),s.proceduralTexturesEnabled=!0,s._totalVertices=new t.PerfCounter,s._activeIndices=new t.PerfCounter,s._activeParticles=new t.PerfCounter,s._activeBones=new t.PerfCounter,s._animationTime=0,s.animationTimeScale=1,s._renderId=0,s._frameId=0,s._executeWhenReadyTimeoutId=-1,s._intermediateRendering=!1,s._viewUpdateFlag=-1,s._projectionUpdateFlag=-1,s._alternateViewUpdateFlag=-1,s._alternateProjectionUpdateFlag=-1,s._toBeDisposed=new Array(256),s._activeRequests=new Array,s._pendingData=new Array,s._isDisposed=!1,s.dispatchAllSubMeshesOfActiveMeshes=!1,s._activeMeshes=new t.SmartArray(256),s._processedMaterials=new t.SmartArray(256),s._renderTargets=new t.SmartArrayNoDuplicate(256),s._activeParticleSystems=new t.SmartArray(256),s._activeSkeletons=new t.SmartArrayNoDuplicate(32),s._softwareSkinnedMeshes=new t.SmartArrayNoDuplicate(32),s._activeAnimatables=new Array,s._transformMatrix=t.Matrix.Zero(),s._useAlternateCameraConfiguration=!1,s._alternateRendering=!1,s.requireLightSorting=!1,s._components=[],s._serializableComponents=[],s._transientComponents=[],s._beforeCameraUpdateStage=t.Stage.Create(),s._beforeClearStage=t.Stage.Create(),s._gatherRenderTargetsStage=t.Stage.Create(),s._gatherActiveCameraRenderTargetsStage=t.Stage.Create(),s._isReadyForMeshStage=t.Stage.Create(),s._beforeEvaluateActiveMeshStage=t.Stage.Create(),s._evaluateSubMeshStage=t.Stage.Create(),s._activeMeshStage=t.Stage.Create(),s._cameraDrawRenderTargetStage=t.Stage.Create(),s._beforeCameraDrawStage=t.Stage.Create(),s._beforeRenderingGroupDrawStage=t.Stage.Create(),s._beforeRenderingMeshStage=t.Stage.Create(),s._afterRenderingMeshStage=t.Stage.Create(),s._afterRenderingGroupDrawStage=t.Stage.Create(),s._afterCameraDrawStage=t.Stage.Create(),s._afterRenderStage=t.Stage.Create(),s._pointerMoveStage=t.Stage.Create(),s._pointerDownStage=t.Stage.Create(),s._pointerUpStage=t.Stage.Create(),s._defaultMeshCandidates={data:[],length:0},s._defaultSubMeshCandidates={data:[],length:0},s._activeMeshesFrozen=!1,s._allowPostProcessClearColor=!0,s.getDeterministicFrameTime=function(){return 1e3/60},s._tempPickingRay=t.Ray?t.Ray.Zero():null,s._blockMaterialDirtyMechanism=!1,s._engine=n||t.Engine.LastCreatedEngine,s._engine.scenes.push(s),s._uid=null,s._renderingManager=new t.RenderingManager(s),t.PostProcessManager&&(s.postProcessManager=new t.PostProcessManager(s)),t.Tools.IsWindowObjectExist(),s.workerCollisions=!1,s._createUbo(),t.ImageProcessingConfiguration&&(s._imageProcessingConfiguration=new t.ImageProcessingConfiguration),s.setDefaultCandidateProviders(),s}return Object.defineProperty(a.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(n){this._environmentTexture!==n&&(this._environmentTexture=n,this.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(n){this._forceWireframe!==n&&(this._forceWireframe=n,this.markAllMaterialsAsDirty(t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(n){this._forcePointsCloud!==n&&(this._forcePointsCloud=n,this.markAllMaterialsAsDirty(t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(n){this._animationPropertiesOverride=n},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onDispose",{set:function(n){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"beforeRender",{set:function(n){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),n&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(n))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"afterRender",{set:function(n){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),n&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(n))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"beforeCameraRender",{set:function(n){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"afterCameraRender",{set:function(n){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(n)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"unTranslatedPointer",{get:function(){return new t.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(n){this._useRightHandedSystem!==n&&(this._useRightHandedSystem=n,this.markAllMaterialsAsDirty(t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),a.prototype.setStepId=function(n){this._currentStepId=n},a.prototype.getStepId=function(){return this._currentStepId},a.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(a.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(n){this._fogEnabled!==n&&(this._fogEnabled=n,this.markAllMaterialsAsDirty(t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fogMode",{get:function(){return this._fogMode},set:function(n){this._fogMode!==n&&(this._fogMode=n,this.markAllMaterialsAsDirty(t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(n){this._shadowsEnabled!==n&&(this._shadowsEnabled=n,this.markAllMaterialsAsDirty(t.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(n){this._lightsEnabled!==n&&(this._lightsEnabled=n,this.markAllMaterialsAsDirty(t.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=new t.StandardMaterial("default material",this)),this._defaultMaterial},set:function(n){this._defaultMaterial=n},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(n){this._texturesEnabled!==n&&(this._texturesEnabled=n,this.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(n){this._skeletonsEnabled!==n&&(this._skeletonsEnabled=n,this.markAllMaterialsAsDirty(t.Material.AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_isAlternateRenderingEnabled",{get:function(){return this._alternateRendering},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),a.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var n=0,s=this._transientComponents;n<s.length;n++){var o=s[n];o.register()}this._transientComponents=[]}},a.prototype._addComponent=function(n){this._components.push(n),this._transientComponents.push(n);var s=n;s.addFromContainer&&this._serializableComponents.push(s)},a.prototype._getComponent=function(n){for(var s=0,o=this._components;s<o.length;s++){var l=o[s];if(l.name===n)return l}return null},a.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},a.prototype._getDefaultSubMeshCandidates=function(n){return this._defaultSubMeshCandidates.data=n.subMeshes,this._defaultSubMeshCandidates.length=n.subMeshes.length,this._defaultSubMeshCandidates},a.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(a.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(n){t.CollisionCoordinatorLegacy&&(n=n&&!!Worker&&!!t.CollisionWorker,this._workerCollisions=n,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=n?new t.CollisionCoordinatorWorker:new t.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),a.prototype.getCachedMaterial=function(){return this._cachedMaterial},a.prototype.getCachedEffect=function(){return this._cachedEffect},a.prototype.getCachedVisibility=function(){return this._cachedVisibility},a.prototype.isCachedMaterialInvalid=function(n,s,o){return o===void 0&&(o=1),this._cachedEffect!==s||this._cachedMaterial!==n||this._cachedVisibility!==o},a.prototype.getEngine=function(){return this._engine},a.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(a.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),a.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(a.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),a.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(a.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),a.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(a.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),a.prototype.getInterFramePerfCounter=function(){return t.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"interFramePerfCounter",{get:function(){return t.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getLastFrameDuration=function(){return t.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"lastFramePerfCounter",{get:function(){return t.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getEvaluateActiveMeshesDuration=function(){return t.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"evaluateActiveMeshesDurationPerfCounter",{get:function(){return t.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getActiveMeshes=function(){return this._activeMeshes},a.prototype.getRenderTargetsDuration=function(){return t.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"),0},a.prototype.getRenderDuration=function(){return t.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"renderDurationPerfCounter",{get:function(){return t.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getParticlesDuration=function(){return t.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"particlesDurationPerfCounter",{get:function(){return t.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getSpritesDuration=function(){return t.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(a.prototype,"spriteDuractionPerfCounter",{get:function(){return t.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),a.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},a.prototype.getRenderId=function(){return this._renderId},a.prototype.getFrameId=function(){return this._frameId},a.prototype.incrementRenderId=function(){this._renderId++},a.prototype._updatePointerPosition=function(n){var s=this._engine.getRenderingCanvasClientRect();s&&(this._pointerX=n.clientX-s.left,this._pointerY=n.clientY-s.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},a.prototype._createUbo=function(){this._sceneUbo=new t.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},a.prototype._createAlternateUbo=function(){this._alternateSceneUbo=new t.UniformBuffer(this._engine,void 0,!0),this._alternateSceneUbo.addUniform("viewProjection",16),this._alternateSceneUbo.addUniform("view",16)},a.prototype._setRayOnPointerInfo=function(n){n.pickInfo&&(n.pickInfo.ray||(n.pickInfo.ray=this.createPickingRay(n.event.offsetX,n.event.offsetY,t.Matrix.Identity(),this.activeCamera)))},a.prototype.simulatePointerMove=function(n,s){var o=new PointerEvent("pointermove",s);return this._checkPrePointerObservable(n,o,t.PointerEventTypes.POINTERMOVE)?this:this._processPointerMove(n,o)},a.prototype._processPointerMove=function(n,s){var o=this._engine.getRenderingCanvas();if(!o)return this;o.style.cursor=this.defaultCursor;var l=!!(n&&n.hit&&n.pickedMesh);l?(this.setPointerOverMesh(n.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(this._pointerOverMesh.actionManager.hoverCursor?o.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:o.style.cursor=this.hoverCursor)):this.setPointerOverMesh(null);for(var u=0,h=this._pointerMoveStage;u<h.length;u++){var d=h[u];n=d.action(this._unTranslatedPointerX,this._unTranslatedPointerY,n,l,o)}if(n){var p=s.type==="mousewheel"||s.type==="DOMMouseScroll"?t.PointerEventTypes.POINTERWHEEL:t.PointerEventTypes.POINTERMOVE;if(this.onPointerMove&&this.onPointerMove(s,n,p),this.onPointerObservable.hasObservers()){var m=new t.PointerInfo(p,s,n);this._setRayOnPointerInfo(m),this.onPointerObservable.notifyObservers(m,p)}}return this},a.prototype._checkPrePointerObservable=function(n,s,o){var l=new t.PointerInfoPre(o,s,this._unTranslatedPointerX,this._unTranslatedPointerY);return n&&(l.ray=n.ray),this.onPrePointerObservable.notifyObservers(l,o),!!l.skipOnPointerObservable},a.prototype.simulatePointerDown=function(n,s){var o=new PointerEvent("pointerdown",s);return this._checkPrePointerObservable(n,o,t.PointerEventTypes.POINTERDOWN)?this:this._processPointerDown(n,o)},a.prototype._processPointerDown=function(n,s){var o=this;if(n&&n.hit&&n.pickedMesh){this._pickedDownMesh=n.pickedMesh;var l=n.pickedMesh.actionManager;if(l){if(l.hasPickTriggers)switch(l.processTrigger(t.ActionManager.OnPickDownTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s)),s.button){case 0:l.processTrigger(t.ActionManager.OnLeftPickTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s));break;case 1:l.processTrigger(t.ActionManager.OnCenterPickTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s));break;case 2:l.processTrigger(t.ActionManager.OnRightPickTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s));break}l.hasSpecificTrigger(t.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var _=o.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,function(v){return v.isPickable&&v.isVisible&&v.isReady()&&v.actionManager&&v.actionManager.hasSpecificTrigger(t.ActionManager.OnLongPressTrigger)&&v==o._pickedDownMesh},!1,o.cameraToUseForPointers);_&&_.hit&&_.pickedMesh&&l&&o._totalPointersPressed!==0&&Date.now()-o._startingPointerTime>a.LongPressDelay&&!o._isPointerSwiping()&&(o._startingPointerTime=0,l.processTrigger(t.ActionManager.OnLongPressTrigger,t.ActionEvent.CreateNew(_.pickedMesh,s)))},a.LongPressDelay)}}else for(var u=0,h=this._pointerDownStage;u<h.length;u++){var d=h[u];n=d.action(this._unTranslatedPointerX,this._unTranslatedPointerY,n,s)}if(n){var p=t.PointerEventTypes.POINTERDOWN;if(this.onPointerDown&&this.onPointerDown(s,n,p),this.onPointerObservable.hasObservers()){var m=new t.PointerInfo(p,s,n);this._setRayOnPointerInfo(m),this.onPointerObservable.notifyObservers(m,p)}}return this},a.prototype.simulatePointerUp=function(n,s){var o=new PointerEvent("pointerup",s),l=new f;return l.singleClick=!0,l.ignore=!0,this._checkPrePointerObservable(n,o,t.PointerEventTypes.POINTERUP)?this:this._processPointerUp(n,o,l)},a.prototype._processPointerUp=function(n,s,o){if(n&&n&&n.pickedMesh){if(this._pickedUpMesh=n.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(this.onPointerPick&&this.onPointerPick(s,n),o.singleClick&&!o.ignore&&this.onPointerObservable.hasObservers())){var l=t.PointerEventTypes.POINTERPICK,u=new t.PointerInfo(l,s,n);this._setRayOnPointerInfo(u),this.onPointerObservable.notifyObservers(u,l)}n.pickedMesh.actionManager&&(o.ignore&&n.pickedMesh.actionManager.processTrigger(t.ActionManager.OnPickUpTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s)),!o.hasSwiped&&!o.ignore&&o.singleClick&&n.pickedMesh.actionManager.processTrigger(t.ActionManager.OnPickTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s)),o.doubleClick&&!o.ignore&&n.pickedMesh.actionManager.hasSpecificTrigger(t.ActionManager.OnDoublePickTrigger)&&n.pickedMesh.actionManager.processTrigger(t.ActionManager.OnDoublePickTrigger,t.ActionEvent.CreateNew(n.pickedMesh,s)))}else if(!o.ignore)for(var h=0,d=this._pointerUpStage;h<d.length;h++){var p=d[h];n=p.action(this._unTranslatedPointerX,this._unTranslatedPointerY,n,s)}this._pickedDownMesh&&this._pickedDownMesh.actionManager&&this._pickedDownMesh.actionManager.hasSpecificTrigger(t.ActionManager.OnPickOutTrigger)&&this._pickedDownMesh!==this._pickedUpMesh&&this._pickedDownMesh.actionManager.processTrigger(t.ActionManager.OnPickOutTrigger,t.ActionEvent.CreateNew(this._pickedDownMesh,s));var m=t.PointerEventTypes.POINTERUP;if(this.onPointerObservable.hasObservers()){if(o.ignore){var u=new t.PointerInfo(m,s,n);this._setRayOnPointerInfo(u),this.onPointerObservable.notifyObservers(u,m)}else if(!o.hasSwiped){if(o.singleClick&&this.onPointerObservable.hasSpecificMask(t.PointerEventTypes.POINTERTAP)){var _=t.PointerEventTypes.POINTERTAP,u=new t.PointerInfo(_,s,n);this._setRayOnPointerInfo(u),this.onPointerObservable.notifyObservers(u,_)}if(o.doubleClick&&this.onPointerObservable.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP)){var v=t.PointerEventTypes.POINTERDOUBLETAP,u=new t.PointerInfo(v,s,n);this._setRayOnPointerInfo(u),this.onPointerObservable.notifyObservers(u,v)}}}return this.onPointerUp&&this.onPointerUp(s,n,m),this},a.prototype.isPointerCaptured=function(n){return n===void 0&&(n=0),this._pointerCaptures[n]},a.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>a.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>a.DragMovementThreshold},a.prototype.attachControl=function(n,s,o){var l=this;n===void 0&&(n=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),this._initActionManager=function(p,m){if(!l._meshPickProceed){var _=l.pick(l._unTranslatedPointerX,l._unTranslatedPointerY,l.pointerDownPredicate,!1,l.cameraToUseForPointers);l._currentPickResult=_,_&&(p=_.hit&&_.pickedMesh?_.pickedMesh.actionManager:null),l._meshPickProceed=!0}return p},this._delayedSimpleClick=function(p,m,_){(Date.now()-l._previousStartingPointerTime>a.DoubleClickDelay&&!l._doubleClickOccured||p!==l._previousButtonPressed)&&(l._doubleClickOccured=!1,m.singleClick=!0,m.ignore=!1,_(m,l._currentPickResult))},this._initClickEvent=function(p,m,_,v){var S=new f;l._currentPickResult=null;var P=null,x=p.hasSpecificMask(t.PointerEventTypes.POINTERPICK)||m.hasSpecificMask(t.PointerEventTypes.POINTERPICK)||p.hasSpecificMask(t.PointerEventTypes.POINTERTAP)||m.hasSpecificMask(t.PointerEventTypes.POINTERTAP)||p.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP)||m.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP);if(!x&&t.ActionManager&&t.ActionManager.HasPickTriggers&&(P=l._initActionManager(P,S),P&&(x=P.hasPickTriggers)),x){var R=_.button;if(S.hasSwiped=l._isPointerSwiping(),!S.hasSwiped){var w=!a.ExclusiveDoubleClickMode;w||(w=!p.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP)&&!m.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP),w&&!t.ActionManager.HasSpecificTrigger(t.ActionManager.OnDoublePickTrigger)&&(P=l._initActionManager(P,S),P&&(w=!P.hasSpecificTrigger(t.ActionManager.OnDoublePickTrigger)))),w?(Date.now()-l._previousStartingPointerTime>a.DoubleClickDelay||R!==l._previousButtonPressed)&&(S.singleClick=!0,v(S,l._currentPickResult)):(l._previousDelayedSimpleClickTimeout=l._delayedSimpleClickTimeout,l._delayedSimpleClickTimeout=window.setTimeout(l._delayedSimpleClick.bind(l,R,S,v),a.DoubleClickDelay));var I=p.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP)||m.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP);!I&&t.ActionManager.HasSpecificTrigger(t.ActionManager.OnDoublePickTrigger)&&(P=l._initActionManager(P,S),P&&(I=P.hasSpecificTrigger(t.ActionManager.OnDoublePickTrigger))),I&&(R===l._previousButtonPressed&&Date.now()-l._previousStartingPointerTime<a.DoubleClickDelay&&!l._doubleClickOccured?!S.hasSwiped&&!l._isPointerSwiping()?(l._previousStartingPointerTime=0,l._doubleClickOccured=!0,S.doubleClick=!0,S.ignore=!1,a.ExclusiveDoubleClickMode&&l._previousDelayedSimpleClickTimeout&&clearTimeout(l._previousDelayedSimpleClickTimeout),l._previousDelayedSimpleClickTimeout=l._delayedSimpleClickTimeout,v(S,l._currentPickResult)):(l._doubleClickOccured=!1,l._previousStartingPointerTime=l._startingPointerTime,l._previousStartingPointerPosition.x=l._startingPointerPosition.x,l._previousStartingPointerPosition.y=l._startingPointerPosition.y,l._previousButtonPressed=R,a.ExclusiveDoubleClickMode?(l._previousDelayedSimpleClickTimeout&&clearTimeout(l._previousDelayedSimpleClickTimeout),l._previousDelayedSimpleClickTimeout=l._delayedSimpleClickTimeout,v(S,l._previousPickResult)):v(S,l._currentPickResult)):(l._doubleClickOccured=!1,l._previousStartingPointerTime=l._startingPointerTime,l._previousStartingPointerPosition.x=l._startingPointerPosition.x,l._previousStartingPointerPosition.y=l._startingPointerPosition.y,l._previousButtonPressed=R))}}S.ignore=!0,v(S,l._currentPickResult)},this._onPointerMove=function(p){if(l._updatePointerPosition(p),!l._checkPrePointerObservable(null,p,p.type==="mousewheel"||p.type==="DOMMouseScroll"?t.PointerEventTypes.POINTERWHEEL:t.PointerEventTypes.POINTERMOVE)&&!(!l.cameraToUseForPointers&&!l.activeCamera)){l.pointerMovePredicate||(l.pointerMovePredicate=function(_){return _.isPickable&&_.isVisible&&_.isReady()&&_.isEnabled()&&(_.enablePointerMoveEvents||l.constantlyUpdateMeshUnderPointer||_.actionManager!==null&&_.actionManager!==void 0)});var m=l.pick(l._unTranslatedPointerX,l._unTranslatedPointerY,l.pointerMovePredicate,!1,l.cameraToUseForPointers);l._processPointerMove(m,p)}},this._onPointerDown=function(p){if(l._totalPointersPressed++,l._pickedDownMesh=null,l._meshPickProceed=!1,l._updatePointerPosition(p),l.preventDefaultOnPointerDown&&d&&(p.preventDefault(),d.focus()),!l._checkPrePointerObservable(null,p,t.PointerEventTypes.POINTERDOWN)&&!(!l.cameraToUseForPointers&&!l.activeCamera)){l._pointerCaptures[p.pointerId]=!0,l._startingPointerPosition.x=l._pointerX,l._startingPointerPosition.y=l._pointerY,l._startingPointerTime=Date.now(),l.pointerDownPredicate||(l.pointerDownPredicate=function(_){return _.isPickable&&_.isVisible&&_.isReady()&&_.isEnabled()}),l._pickedDownMesh=null;var m=l.pick(l._unTranslatedPointerX,l._unTranslatedPointerY,l.pointerDownPredicate,!1,l.cameraToUseForPointers);l._processPointerDown(m,p)}},this._onPointerUp=function(p){l._totalPointersPressed!==0&&(l._totalPointersPressed--,l._pickedUpMesh=null,l._meshPickProceed=!1,l._updatePointerPosition(p),l._initClickEvent(l.onPrePointerObservable,l.onPointerObservable,p,function(m,_){if(l.onPrePointerObservable.hasObservers()){if(m.ignore){if(l._checkPrePointerObservable(null,p,t.PointerEventTypes.POINTERUP))return}else if(!m.hasSwiped&&(m.singleClick&&l.onPrePointerObservable.hasSpecificMask(t.PointerEventTypes.POINTERTAP)&&l._checkPrePointerObservable(null,p,t.PointerEventTypes.POINTERTAP)||m.doubleClick&&l.onPrePointerObservable.hasSpecificMask(t.PointerEventTypes.POINTERDOUBLETAP)&&l._checkPrePointerObservable(null,p,t.PointerEventTypes.POINTERDOUBLETAP)))return}!l.cameraToUseForPointers&&!l.activeCamera||(l._pointerCaptures[p.pointerId]=!1,l.pointerUpPredicate||(l.pointerUpPredicate=function(v){return v.isPickable&&v.isVisible&&v.isReady()&&v.isEnabled()}),!l._meshPickProceed&&(t.ActionManager&&t.ActionManager.HasTriggers||l.onPointerObservable.hasObservers())&&l._initActionManager(null,m),_||(_=l._currentPickResult),l._processPointerUp(_,p,m),l._previousPickResult=l._currentPickResult)}))},this._onKeyDown=function(p){var m=t.KeyboardEventTypes.KEYDOWN;if(l.onPreKeyboardObservable.hasObservers()){var _=new t.KeyboardInfoPre(m,p);if(l.onPreKeyboardObservable.notifyObservers(_,m),_.skipOnPointerObservable)return}if(l.onKeyboardObservable.hasObservers()){var _=new t.KeyboardInfo(m,p);l.onKeyboardObservable.notifyObservers(_,m)}l.actionManager&&l.actionManager.processTrigger(t.ActionManager.OnKeyDownTrigger,t.ActionEvent.CreateNewFromScene(l,p))},this._onKeyUp=function(p){var m=t.KeyboardEventTypes.KEYUP;if(l.onPreKeyboardObservable.hasObservers()){var _=new t.KeyboardInfoPre(m,p);if(l.onPreKeyboardObservable.notifyObservers(_,m),_.skipOnPointerObservable)return}if(l.onKeyboardObservable.hasObservers()){var _=new t.KeyboardInfo(m,p);l.onKeyboardObservable.notifyObservers(_,m)}l.actionManager&&l.actionManager.processTrigger(t.ActionManager.OnKeyUpTrigger,t.ActionEvent.CreateNewFromScene(l,p))};var u=this.getEngine();this._onCanvasFocusObserver=u.onCanvasFocusObservable.add(function(){d&&(d.addEventListener("keydown",l._onKeyDown,!1),d.addEventListener("keyup",l._onKeyUp,!1))}),this._onCanvasBlurObserver=u.onCanvasBlurObservable.add(function(){d&&(d.removeEventListener("keydown",l._onKeyDown),d.removeEventListener("keyup",l._onKeyUp))});var h=t.Tools.GetPointerPrefix(),d=this._engine.getRenderingCanvas();d&&(o&&(d.addEventListener(h+"move",this._onPointerMove,!1),d.addEventListener("mousewheel",this._onPointerMove,!1),d.addEventListener("DOMMouseScroll",this._onPointerMove,!1)),s&&d.addEventListener(h+"down",this._onPointerDown,!1),n&&window.addEventListener(h+"up",this._onPointerUp,!1),d.tabIndex=1)},a.prototype.detachControl=function(){var n=this.getEngine(),s=t.Tools.GetPointerPrefix(),o=n.getRenderingCanvas();o&&(o.removeEventListener(s+"move",this._onPointerMove),o.removeEventListener(s+"down",this._onPointerDown),window.removeEventListener(s+"up",this._onPointerUp),this._onCanvasBlurObserver&&n.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&n.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),o.removeEventListener("mousewheel",this._onPointerMove),o.removeEventListener("DOMMouseScroll",this._onPointerMove),o.removeEventListener("keydown",this._onKeyDown),o.removeEventListener("keyup",this._onKeyUp),this.onKeyboardObservable.clear(),this.onPreKeyboardObservable.clear(),this.onPointerObservable.clear(),this.onPrePointerObservable.clear())},a.prototype.isReady=function(){if(this._isDisposed||this._pendingData.length>0)return!1;var n,s=this.getEngine();for(n=0;n<this.geometries.length;n++){var o=this.geometries[n];if(o.delayLoadState===t.Engine.DELAYLOADSTATE_LOADING)return!1}for(n=0;n<this.meshes.length;n++){var l=this.meshes[n];if(l.isEnabled()&&!(!l.subMeshes||l.subMeshes.length===0)){if(!l.isReady(!0))return!1;for(var u=l.getClassName()==="InstancedMesh"||s.getCaps().instancedArrays&&l.instances.length>0,h=0,d=this._isReadyForMeshStage;h<d.length;h++){var p=d[h];if(!p.action(l,u))return!1}}}if(this.activeCameras&&this.activeCameras.length>0)for(var m=0,_=this.activeCameras;m<_.length;m++){var v=_[m];if(!v.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var S=0,P=this.particleSystems;S<P.length;S++){var x=P[S];if(!x.isReady())return!1}return!0},a.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},a.prototype.registerBeforeRender=function(n){this.onBeforeRenderObservable.add(n)},a.prototype.unregisterBeforeRender=function(n){this.onBeforeRenderObservable.removeCallback(n)},a.prototype.registerAfterRender=function(n){this.onAfterRenderObservable.add(n)},a.prototype.unregisterAfterRender=function(n){this.onAfterRenderObservable.removeCallback(n)},a.prototype._executeOnceBeforeRender=function(n){var s=this,o=function(){n(),setTimeout(function(){s.unregisterBeforeRender(o)})};this.registerBeforeRender(o)},a.prototype.executeOnceBeforeRender=function(n,s){var o=this;s!==void 0?setTimeout(function(){o._executeOnceBeforeRender(n)},s):this._executeOnceBeforeRender(n)},a.prototype._addPendingData=function(n){this._pendingData.push(n)},a.prototype._removePendingData=function(n){var s=this.isLoading,o=this._pendingData.indexOf(n);o!==-1&&this._pendingData.splice(o,1),s&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},a.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(a.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),a.prototype.executeWhenReady=function(n){var s=this;this.onReadyObservable.add(n),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){s._checkIsReady()},150))},a.prototype.whenReadyAsync=function(){var n=this;return new Promise(function(s){n.executeWhenReady(function(){s()})})},a.prototype._checkIsReady=function(){var n=this;if(this._registerTransientComponents(),this.isReady()){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}this._executeWhenReadyTimeoutId=setTimeout(function(){n._checkIsReady()},150)},a.prototype.beginWeightedAnimation=function(n,s,o,l,u,h,d,p,m){l===void 0&&(l=1),h===void 0&&(h=1);var _=this.beginAnimation(n,s,o,u,h,d,p,!1,m);return _.weight=l,_},a.prototype.beginAnimation=function(n,s,o,l,u,h,d,p,m){u===void 0&&(u=1),p===void 0&&(p=!0),s>o&&u>0&&(u*=-1),p&&this.stopAnimation(n,void 0,m),d||(d=new t.Animatable(this,n,s,o,l,u,h));var _=m?m(n):!0;if(n.animations&&_&&d.appendAnimations(n,n.animations),n.getAnimatables)for(var v=n.getAnimatables(),S=0;S<v.length;S++)this.beginAnimation(v[S],s,o,l,u,h,d,p,m);return d.reset(),d},a.prototype.beginDirectAnimation=function(n,s,o,l,u,h,d){h===void 0&&(h=1);var p=new t.Animatable(this,n,o,l,u,h,d,s);return p},a.prototype.beginDirectHierarchyAnimation=function(n,s,o,l,u,h,d,p){var m=n.getDescendants(s),_=[];_.push(this.beginDirectAnimation(n,o,l,u,h,d,p));for(var v=0,S=m;v<S.length;v++){var P=S[v];_.push(this.beginDirectAnimation(P,o,l,u,h,d,p))}return _},a.prototype.getAnimatableByTarget=function(n){for(var s=0;s<this._activeAnimatables.length;s++)if(this._activeAnimatables[s].target===n)return this._activeAnimatables[s];return null},a.prototype.getAllAnimatablesByTarget=function(n){for(var s=[],o=0;o<this._activeAnimatables.length;o++)this._activeAnimatables[o].target===n&&s.push(this._activeAnimatables[o]);return s},Object.defineProperty(a.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),a.prototype.stopAnimation=function(n,s,o){for(var l=this.getAllAnimatablesByTarget(n),u=0,h=l;u<h.length;u++){var d=h[u];d.stop(s,o)}},a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n].stop();this._activeAnimatables=[]}for(var s=0,o=this.animationGroups;s<o.length;s++){var l=o[s];l.stop()}},a.prototype._animate=function(){if(!(!this.animationsEnabled||this._activeAnimatables.length===0)){var n=t.Tools.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=n}var s=this.useConstantAnimationDeltaTime?16:(n-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=s,this._animationTimeLast=n;for(var o=0;o<this._activeAnimatables.length;o++)this._activeAnimatables[o]._animate(this._animationTime);this._processLateAnimationBindings()}},a.prototype._registerTargetForLateAnimationBinding=function(n,s){var o=n.target;this._registeredForLateAnimationBindings.pushNoDuplicate(o),o._lateAnimationHolders||(o._lateAnimationHolders={}),o._lateAnimationHolders[n.targetPath]||(o._lateAnimationHolders[n.targetPath]={totalWeight:0,animations:[],originalValue:s}),o._lateAnimationHolders[n.targetPath].animations.push(n),o._lateAnimationHolders[n.targetPath].totalWeight+=n.weight},a.prototype._processLateAnimationBindingsForMatrices=function(n){var s=1,o=t.Tmp.Vector3[0],l=t.Tmp.Vector3[1],u=t.Tmp.Quaternion[0],h=0,d=n.animations[0],p=n.originalValue,m=1;if(n.totalWeight<1)p.decompose(l,u,o),m=1-n.totalWeight;else if(h=1,s=n.totalWeight,d.currentValue.decompose(l,u,o),m=d.weight/s,m==1)return d.currentValue;l.scaleInPlace(m),o.scaleInPlace(m),u.scaleInPlace(m);for(var _=h;_<n.animations.length;_++){var v=n.animations[_],m=v.weight/s,S=t.Tmp.Vector3[2],P=t.Tmp.Vector3[3],x=t.Tmp.Quaternion[1];v.currentValue.decompose(P,x,S),P.scaleAndAddToRef(m,l),x.scaleAndAddToRef(m,u),S.scaleAndAddToRef(m,o)}return t.Matrix.ComposeToRef(l,u,o,d._workValue),d._workValue},a.prototype._processLateAnimationBindingsForQuaternions=function(n,s){var o=n.animations[0],l=n.originalValue;if(n.animations.length===1)return t.Quaternion.SlerpToRef(l,o.currentValue,Math.min(1,n.totalWeight),s),s;var u=1,h,d;if(n.totalWeight<1){var p=1-n.totalWeight;h=[],d=[],h.push(l),d.push(p)}else{if(n.animations.length===2)return t.Quaternion.SlerpToRef(n.animations[0].currentValue,n.animations[1].currentValue,n.animations[1].weight/n.totalWeight,s),s;h=[],d=[],u=n.totalWeight}for(var m=0;m<n.animations.length;m++){var _=n.animations[m];h.push(_.currentValue),d.push(_.weight/u)}for(var v=0,S=null,P=0;P<h.length;){if(!S){t.Quaternion.SlerpToRef(h[P],h[P+1],d[P+1]/(d[P]+d[P+1]),s),S=s,v=d[P]+d[P+1],P+=2;continue}v+=d[P],t.Quaternion.SlerpToRef(S,h[P],d[P]/v,S),P++}return S},a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var n=0;n<this._registeredForLateAnimationBindings.length;n++){var s=this._registeredForLateAnimationBindings.data[n];for(var o in s._lateAnimationHolders){var l=s._lateAnimationHolders[o],u=l.animations[0],h=l.originalValue,d=t.Animation.AllowMatrixDecomposeForInterpolation&&h.m,p=s[o];if(d)p=this._processLateAnimationBindingsForMatrices(l);else{var m=h.w!==void 0;if(m)p=this._processLateAnimationBindingsForQuaternions(l,p||t.Quaternion.Identity());else{var _=0,v=1;if(l.totalWeight<1)h.scale?p=h.scale(1-l.totalWeight):p=h*(1-l.totalWeight);else{v=l.totalWeight;var S=u.weight/v;S!==1?u.currentValue.scale?p=u.currentValue.scale(S):p=u.currentValue*S:p=u.currentValue,_=1}for(var P=_;P<l.animations.length;P++){var x=l.animations[P],R=x.weight/v;x.currentValue.scaleAndAddToRef?x.currentValue.scaleAndAddToRef(R,p):p+=x.currentValue*R}}}s[o]=p}s._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},a.prototype._switchToAlternateCameraConfiguration=function(n){this._useAlternateCameraConfiguration=n},a.prototype.getViewMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateViewMatrix:this._viewMatrix},a.prototype.getProjectionMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateProjectionMatrix:this._projectionMatrix},a.prototype.getTransformMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateTransformMatrix:this._transformMatrix},a.prototype.setTransformMatrix=function(n,s){if(!(this._viewUpdateFlag===n.updateFlag&&this._projectionUpdateFlag===s.updateFlag)){if(this._viewUpdateFlag=n.updateFlag,this._projectionUpdateFlag=s.updateFlag,this._viewMatrix=n,this._projectionMatrix=s,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?t.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=t.Frustum.GetPlanes(this._transformMatrix),this.activeCamera&&this.activeCamera._alternateCamera){var o=this.activeCamera._alternateCamera;o.getViewMatrix().multiplyToRef(o.getProjectionMatrix(),t.Tmp.Matrix[0]),t.Frustum.GetRightPlaneToRef(t.Tmp.Matrix[0],this._frustumPlanes[3])}this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update())}},a.prototype._setAlternateTransformMatrix=function(n,s){this._alternateViewUpdateFlag===n.updateFlag&&this._alternateProjectionUpdateFlag===s.updateFlag||(this._alternateViewUpdateFlag=n.updateFlag,this._alternateProjectionUpdateFlag=s.updateFlag,this._alternateViewMatrix=n,this._alternateProjectionMatrix=s,this._alternateTransformMatrix||(this._alternateTransformMatrix=t.Matrix.Zero()),this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix,this._alternateTransformMatrix),this._alternateSceneUbo||this._createAlternateUbo(),this._alternateSceneUbo.useUbo&&(this._alternateSceneUbo.updateMatrix("viewProjection",this._alternateTransformMatrix),this._alternateSceneUbo.updateMatrix("view",this._alternateViewMatrix),this._alternateSceneUbo.update()))},a.prototype.getSceneUniformBuffer=function(){return this._useAlternateCameraConfiguration?this._alternateSceneUbo:this._sceneUbo},a.prototype.getUniqueId=function(){var n=a._uniqueIdCounter;return a._uniqueIdCounter++,n},a.prototype.addMesh=function(n,s){var o=this;s===void 0&&(s=!1),this.meshes.push(n),this.collisionCoordinator&&this.collisionCoordinator.onMeshAdded(n),n._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(n),s&&n.getChildMeshes().forEach(function(l){o.addMesh(l)})},a.prototype.removeMesh=function(n,s){var o=this;s===void 0&&(s=!1);var l=this.meshes.indexOf(n);return l!==-1&&this.meshes.splice(l,1),this.onMeshRemovedObservable.notifyObservers(n),s&&n.getChildMeshes().forEach(function(u){o.removeMesh(u)}),l},a.prototype.addTransformNode=function(n){this.transformNodes.push(n),this.onNewTransformNodeAddedObservable.notifyObservers(n)},a.prototype.removeTransformNode=function(n){var s=this.transformNodes.indexOf(n);return s!==-1&&this.transformNodes.splice(s,1),this.onTransformNodeRemovedObservable.notifyObservers(n),s},a.prototype.removeSkeleton=function(n){var s=this.skeletons.indexOf(n);return s!==-1&&this.skeletons.splice(s,1),s},a.prototype.removeMorphTargetManager=function(n){var s=this.morphTargetManagers.indexOf(n);return s!==-1&&this.morphTargetManagers.splice(s,1),s},a.prototype.removeLight=function(n){var s=this.lights.indexOf(n);if(s!==-1){for(var o=0,l=this.meshes;o<l.length;o++){var u=l[o];u._removeLightSource(n)}this.lights.splice(s,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(n),s},a.prototype.removeCamera=function(n){var s=this.cameras.indexOf(n);s!==-1&&this.cameras.splice(s,1);var o=this.activeCameras.indexOf(n);return o!==-1&&this.activeCameras.splice(o,1),this.activeCamera===n&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(n),s},a.prototype.removeParticleSystem=function(n){var s=this.particleSystems.indexOf(n);return s!==-1&&this.particleSystems.splice(s,1),s},a.prototype.removeAnimation=function(n){var s=this.animations.indexOf(n);return s!==-1&&this.animations.splice(s,1),s},a.prototype.removeAnimationGroup=function(n){var s=this.animationGroups.indexOf(n);return s!==-1&&this.animationGroups.splice(s,1),s},a.prototype.removeMultiMaterial=function(n){var s=this.multiMaterials.indexOf(n);return s!==-1&&this.multiMaterials.splice(s,1),s},a.prototype.removeMaterial=function(n){var s=this.materials.indexOf(n);return s!==-1&&this.materials.splice(s,1),this.onMaterialRemovedObservable.notifyObservers(n),s},a.prototype.removeActionManager=function(n){var s=this.actionManagers.indexOf(n);return s!==-1&&this.actionManagers.splice(s,1),s},a.prototype.removeTexture=function(n){var s=this.textures.indexOf(n);return s!==-1&&this.textures.splice(s,1),this.onTextureRemovedObservable.notifyObservers(n),s},a.prototype.addLight=function(n){this.lights.push(n),this.sortLightsByPriority();for(var s=0,o=this.meshes;s<o.length;s++){var l=o[s];l._lightSources.indexOf(n)===-1&&(l._lightSources.push(n),l._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(n)},a.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(t.Light.CompareLightsPriority)},a.prototype.addCamera=function(n){this.cameras.push(n),this.onNewCameraAddedObservable.notifyObservers(n)},a.prototype.addSkeleton=function(n){this.skeletons.push(n)},a.prototype.addParticleSystem=function(n){this.particleSystems.push(n)},a.prototype.addAnimation=function(n){this.animations.push(n)},a.prototype.addAnimationGroup=function(n){this.animationGroups.push(n)},a.prototype.addMultiMaterial=function(n){this.multiMaterials.push(n)},a.prototype.addMaterial=function(n){this.materials.push(n),this.onNewMaterialAddedObservable.notifyObservers(n)},a.prototype.addMorphTargetManager=function(n){this.morphTargetManagers.push(n)},a.prototype.addGeometry=function(n){this.geometries.push(n)},a.prototype.addActionManager=function(n){this.actionManagers.push(n)},a.prototype.addTexture=function(n){this.textures.push(n),this.onNewTextureAddedObservable.notifyObservers(n)},a.prototype.switchActiveCamera=function(n,s){s===void 0&&(s=!0);var o=this._engine.getRenderingCanvas();o&&(this.activeCamera&&this.activeCamera.detachControl(o),this.activeCamera=n,s&&n.attachControl(o))},a.prototype.setActiveCameraByID=function(n){var s=this.getCameraByID(n);return s?(this.activeCamera=s,s):null},a.prototype.setActiveCameraByName=function(n){var s=this.getCameraByName(n);return s?(this.activeCamera=s,s):null},a.prototype.getAnimationGroupByName=function(n){for(var s=0;s<this.animationGroups.length;s++)if(this.animationGroups[s].name===n)return this.animationGroups[s];return null},a.prototype.getMaterialByID=function(n){for(var s=0;s<this.materials.length;s++)if(this.materials[s].id===n)return this.materials[s];return null},a.prototype.getMaterialByName=function(n){for(var s=0;s<this.materials.length;s++)if(this.materials[s].name===n)return this.materials[s];return null},a.prototype.getCameraByID=function(n){for(var s=0;s<this.cameras.length;s++)if(this.cameras[s].id===n)return this.cameras[s];return null},a.prototype.getCameraByUniqueID=function(n){for(var s=0;s<this.cameras.length;s++)if(this.cameras[s].uniqueId===n)return this.cameras[s];return null},a.prototype.getCameraByName=function(n){for(var s=0;s<this.cameras.length;s++)if(this.cameras[s].name===n)return this.cameras[s];return null},a.prototype.getBoneByID=function(n){for(var s=0;s<this.skeletons.length;s++)for(var o=this.skeletons[s],l=0;l<o.bones.length;l++)if(o.bones[l].id===n)return o.bones[l];return null},a.prototype.getBoneByName=function(n){for(var s=0;s<this.skeletons.length;s++)for(var o=this.skeletons[s],l=0;l<o.bones.length;l++)if(o.bones[l].name===n)return o.bones[l];return null},a.prototype.getLightByName=function(n){for(var s=0;s<this.lights.length;s++)if(this.lights[s].name===n)return this.lights[s];return null},a.prototype.getLightByID=function(n){for(var s=0;s<this.lights.length;s++)if(this.lights[s].id===n)return this.lights[s];return null},a.prototype.getLightByUniqueID=function(n){for(var s=0;s<this.lights.length;s++)if(this.lights[s].uniqueId===n)return this.lights[s];return null},a.prototype.getParticleSystemByID=function(n){for(var s=0;s<this.particleSystems.length;s++)if(this.particleSystems[s].id===n)return this.particleSystems[s];return null},a.prototype.getGeometryByID=function(n){for(var s=0;s<this.geometries.length;s++)if(this.geometries[s].id===n)return this.geometries[s];return null},a.prototype.pushGeometry=function(n,s){return!s&&this.getGeometryByID(n.id)?!1:(this.geometries.push(n),this.collisionCoordinator&&this.collisionCoordinator.onGeometryAdded(n),this.onNewGeometryAddedObservable.notifyObservers(n),!0)},a.prototype.removeGeometry=function(n){var s=this.geometries.indexOf(n);return s>-1?(this.geometries.splice(s,1),this.collisionCoordinator&&this.collisionCoordinator.onGeometryDeleted(n),this.onGeometryRemovedObservable.notifyObservers(n),!0):!1},a.prototype.getGeometries=function(){return this.geometries},a.prototype.getMeshByID=function(n){for(var s=0;s<this.meshes.length;s++)if(this.meshes[s].id===n)return this.meshes[s];return null},a.prototype.getMeshesByID=function(n){return this.meshes.filter(function(s){return s.id===n})},a.prototype.getTransformNodeByID=function(n){for(var s=0;s<this.transformNodes.length;s++)if(this.transformNodes[s].id===n)return this.transformNodes[s];return null},a.prototype.getTransformNodesByID=function(n){return this.transformNodes.filter(function(s){return s.id===n})},a.prototype.getMeshByUniqueID=function(n){for(var s=0;s<this.meshes.length;s++)if(this.meshes[s].uniqueId===n)return this.meshes[s];return null},a.prototype.getLastMeshByID=function(n){for(var s=this.meshes.length-1;s>=0;s--)if(this.meshes[s].id===n)return this.meshes[s];return null},a.prototype.getLastEntryByID=function(n){var s;for(s=this.meshes.length-1;s>=0;s--)if(this.meshes[s].id===n)return this.meshes[s];for(s=this.transformNodes.length-1;s>=0;s--)if(this.transformNodes[s].id===n)return this.transformNodes[s];for(s=this.cameras.length-1;s>=0;s--)if(this.cameras[s].id===n)return this.cameras[s];for(s=this.lights.length-1;s>=0;s--)if(this.lights[s].id===n)return this.lights[s];return null},a.prototype.getNodeByID=function(n){var s=this.getMeshByID(n);if(s)return s;var o=this.getLightByID(n);if(o)return o;var l=this.getCameraByID(n);if(l)return l;var u=this.getBoneByID(n);return u},a.prototype.getNodeByName=function(n){var s=this.getMeshByName(n);if(s)return s;var o=this.getLightByName(n);if(o)return o;var l=this.getCameraByName(n);if(l)return l;var u=this.getBoneByName(n);return u},a.prototype.getMeshByName=function(n){for(var s=0;s<this.meshes.length;s++)if(this.meshes[s].name===n)return this.meshes[s];return null},a.prototype.getTransformNodeByName=function(n){for(var s=0;s<this.transformNodes.length;s++)if(this.transformNodes[s].name===n)return this.transformNodes[s];return null},a.prototype.getLastSkeletonByID=function(n){for(var s=this.skeletons.length-1;s>=0;s--)if(this.skeletons[s].id===n)return this.skeletons[s];return null},a.prototype.getSkeletonById=function(n){for(var s=0;s<this.skeletons.length;s++)if(this.skeletons[s].id===n)return this.skeletons[s];return null},a.prototype.getSkeletonByName=function(n){for(var s=0;s<this.skeletons.length;s++)if(this.skeletons[s].name===n)return this.skeletons[s];return null},a.prototype.getMorphTargetManagerById=function(n){for(var s=0;s<this.morphTargetManagers.length;s++)if(this.morphTargetManagers[s].uniqueId===n)return this.morphTargetManagers[s];return null},a.prototype.isActiveMesh=function(n){return this._activeMeshes.indexOf(n)!==-1},Object.defineProperty(a.prototype,"uid",{get:function(){return this._uid||(this._uid=t.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),a.prototype.addExternalData=function(n,s){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.add(n,s)},a.prototype.getExternalData=function(n){return this._externalData?this._externalData.get(n):null},a.prototype.getOrAddExternalDataWithFactory=function(n,s){return this._externalData||(this._externalData=new t.StringDictionary),this._externalData.getOrAddWithFactory(n,s)},a.prototype.removeExternalData=function(n){return this._externalData.remove(n)},a.prototype._evaluateSubMesh=function(n,s){if(this.dispatchAllSubMeshesOfActiveMeshes||s.alwaysSelectAsActiveMesh||s.subMeshes.length===1||n.isInFrustum(this._frustumPlanes)){for(var o=0,l=this._evaluateSubMeshStage;o<l.length;o++){var u=l[o];u.action(s,n)}var h=n.getMaterial();h!=null&&(h.hasRenderTargetTextures&&h.getRenderTargetTextures!==void 0&&this._processedMaterials.indexOf(h)===-1&&(this._processedMaterials.push(h),this._renderTargets.concatWithNoDuplicate(h.getRenderTargetTextures())),this._activeIndices.addCount(n.indexCount,!1),this._renderingManager.dispatch(n,s,h))}},a.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},a.prototype.freeActiveMeshes=function(){if(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras)for(var n=0;n<this.activeCameras.length;n++){var s=this.activeCameras[n];s&&s._activeMeshes&&s._activeMeshes.dispose()}},a.prototype.freeRenderingGroups=function(){if(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures)for(var n=0;n<this.textures.length;n++){var s=this.textures[n];s&&s.renderList&&s.freeRenderingGroups()}},a.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},a.prototype.freezeActiveMeshes=function(){return this.activeCamera?(this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this):this},a.prototype.unfreezeActiveMeshes=function(){return this._activeMeshesFrozen=!1,this},a.prototype._evaluateActiveMeshes=function(){if(!(this._activeMeshesFrozen&&this._activeMeshes.length)&&this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var n=0,s=this._beforeEvaluateActiveMeshStage;n<s.length;n++){var o=s[n];o.action()}for(var l=this.getActiveMeshCandidates(),u=l.length,h=0;h<u;h++){var d=l.data[h];if(!d.isBlocked&&(this._totalVertices.addCount(d.getTotalVertices(),!1),!(!d.isReady()||!d.isEnabled()))){d.computeWorldMatrix(),d.actionManager&&d.actionManager.hasSpecificTriggers2(t.ActionManager.OnIntersectionEnterTrigger,t.ActionManager.OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(d);var p=d.getLOD(this.activeCamera);p!=null&&(d._preActivate(),d.isVisible&&d.visibility>0&&(d.alwaysSelectAsActiveMesh||d.layerMask&this.activeCamera.layerMask&&d.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(d),this.activeCamera._activeMeshes.push(d),d._activate(this._renderId),p!==d&&p._activate(this._renderId),this._activeMesh(d,p)))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var m=0;m<this.particleSystems.length;m++){var _=this.particleSystems[m];if(!(!_.isStarted()||!_.emitter)){var v=_.emitter;(!v.position||v.isEnabled())&&(this._activeParticleSystems.push(_),_.animate(),this._renderingManager.dispatchParticles(_))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},a.prototype._activeMesh=function(n,s){this._skeletonsEnabled&&s.skeleton!==null&&s.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(s.skeleton)&&s.skeleton.prepare(),s.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(s));for(var o=0,l=this._activeMeshStage;o<l.length;o++){var u=l[o];u.action(n,s)}if(s!=null&&s.subMeshes!==void 0&&s.subMeshes!==null&&s.subMeshes.length>0)for(var h=this.getActiveSubMeshCandidates(s),d=h.length,p=0;p<d;p++){var m=h.data[p];this._evaluateSubMesh(m,s)}},a.prototype.updateTransformMatrix=function(n){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(n))},a.prototype.updateAlternateTransformMatrix=function(n){this._setAlternateTransformMatrix(n.getViewMatrix(),n.getProjectionMatrix())},a.prototype._renderForCamera=function(n,s){if(!(n&&n._skipRendering)){var o=this._engine;if(this.activeCamera=n,!this.activeCamera)throw new Error("Active camera not set");o.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),n._alternateCamera&&(this.updateAlternateTransformMatrix(n._alternateCamera),this._alternateRendering=!0),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var l=0;l<this._softwareSkinnedMeshes.length;l++){var u=this._softwareSkinnedMeshes.data[l];u.applySkeleton(u.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),n.customRenderTargets&&n.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(n.customRenderTargets),s&&s.customRenderTargets&&s.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(s.customRenderTargets);for(var h=0,d=this._gatherActiveCameraRenderTargetsStage;h<d.length;h++){var p=d[h];p.action(this._renderTargets)}if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){t.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var m=0;m<this._renderTargets.length;m++){var _=this._renderTargets.data[m];if(_._shouldRender()){this._renderId++;var v=_.activeCamera&&_.activeCamera!==this.activeCamera;_.render(v,this.dumpNextRenderTargets)}}t.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var S=0,P=this._cameraDrawRenderTargetStage;S<P.length;S++){var p=P[S];p.action(this.activeCamera)}this._intermediateRendering=!1,o.restoreDefaultFramebuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&this.postProcessManager._prepareFrame();for(var x=0,R=this._beforeCameraDrawStage;x<R.length;x++){var p=R[x];p.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var w=0,I=this._afterCameraDrawStage;w<I.length;w++){var p=I[w];p.action(this.activeCamera)}this.postProcessManager&&this.postProcessManager._finalizeFrame(n.isIntermediate),this._renderTargets.reset(),this._alternateRendering=!1,this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},a.prototype._processSubCameras=function(n){if(n.cameraRigMode===t.Camera.RIG_MODE_NONE){this._renderForCamera(n);return}for(var s=0;s<n._rigCameras.length;s++)this._renderForCamera(n._rigCameras[s],n);this.activeCamera=n,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix())},a.prototype._checkIntersections=function(){for(var n=0;n<this._meshesForIntersections.length;n++){var s=this._meshesForIntersections.data[n];if(s.actionManager)for(var o=0;o<s.actionManager.actions.length;o++){var l=s.actionManager.actions[o];if(l.trigger===t.ActionManager.OnIntersectionEnterTrigger||l.trigger===t.ActionManager.OnIntersectionExitTrigger){var u=l.getTriggerParameter(),h=u instanceof t.AbstractMesh?u:u.mesh,d=h.intersectsMesh(s,u.usePreciseIntersection),p=s._intersectionsInProgress.indexOf(h);d&&p===-1?l.trigger===t.ActionManager.OnIntersectionEnterTrigger?(l._executeCurrent(t.ActionEvent.CreateNew(s,void 0,h)),s._intersectionsInProgress.push(h)):l.trigger===t.ActionManager.OnIntersectionExitTrigger&&s._intersectionsInProgress.push(h):!d&&p>-1&&(l.trigger===t.ActionManager.OnIntersectionExitTrigger&&l._executeCurrent(t.ActionEvent.CreateNew(s,void 0,h)),(!s.actionManager.hasSpecificTrigger(t.ActionManager.OnIntersectionExitTrigger,function(m){var _=m instanceof t.AbstractMesh?m:m.mesh;return h===_})||l.trigger===t.ActionManager.OnIntersectionExitTrigger)&&s._intersectionsInProgress.splice(p,1))}}}},a.prototype._advancePhysicsEngineStep=function(n){},a.prototype.render=function(n){if(n===void 0&&(n=!0),!this.isDisposed){if(this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(t.ActionManager.OnEveryFrameTrigger),this._engine.isDeterministicLockStep()){var s=Math.max(a.MinDeltaTime,Math.min(this._engine.getDeltaTime(),a.MaxDeltaTime))+this._timeAccumulator,o=60/1e3,l=this.getDeterministicFrameTime(),u=0,h=this._engine.getLockstepMaxSteps(),d=Math.floor(s/(1e3*o));d=Math.min(d,h);do this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=l*o,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(l),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,u++,s-=l;while(s>0&&u<d);this._timeAccumulator=s<0?0:s}else{var s=this.useConstantAnimationDeltaTime?16:Math.max(a.MinDeltaTime,Math.min(this._engine.getDeltaTime(),a.MaxDeltaTime));this._animationRatio=s*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(s)}for(var p=0,m=this._beforeCameraUpdateStage;p<m.length;p++){var _=m[p];_.action()}if(n){if(this.activeCameras.length>0)for(var v=0;v<this.activeCameras.length;v++){var S=this.activeCameras[v];if(S.update(),S.cameraRigMode!==t.Camera.RIG_MODE_NONE)for(var P=0;P<S._rigCameras.length;P++)S._rigCameras[P].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==t.Camera.RIG_MODE_NONE))for(var P=0;P<this.activeCamera._rigCameras.length;P++)this.activeCamera._rigCameras[P].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var x=this.getEngine(),R=this.activeCamera;if(this.renderTargetsEnabled){t.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var w=0;w<this.customRenderTargets.length;w++){var I=this.customRenderTargets[w];if(I._shouldRender()){if(this._renderId++,this.activeCamera=I.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");x.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),I.render(R!==this.activeCamera,this.dumpNextRenderTargets)}}t.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.customRenderTargets.length>0&&x.restoreDefaultFramebuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.activeCamera=R;for(var F=0,k=this._beforeClearStage;F<k.length;F++){var _=k[F];_.action()}(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var E=0,g=this._gatherRenderTargetsStage;E<g.length;E++){var _=g[E];_.action(this._renderTargets)}if(this.activeCameras.length>0)for(var v=0;v<this.activeCameras.length;v++)v>0&&this.activeCameras[v].autoClear&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[v]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var y=0,M=this._afterRenderStage;y<M.length;y++){var _=M[y];_.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var P=0;P<this._toBeDisposed.length;P++){var C=this._toBeDisposed[P];C&&C.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},a.prototype.freezeMaterials=function(){for(var n=0;n<this.materials.length;n++)this.materials[n].freeze()},a.prototype.unfreezeMaterials=function(){for(var n=0;n<this.materials.length;n++)this.materials[n].unfreeze()},a.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var n=0,s=this._components;n<s.length;n++){var o=s[n];o.dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var l=0,u=this._activeRequests;l<u.length;l++){var h=u[l];h.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.detachControl();var d=this._engine.getRenderingCanvas();if(d){var p;for(p=0;p<this.cameras.length;p++)this.cameras[p].detachControl(d)}for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.removeTransformNode(this.transformNodes[0]);for(;this.cameras.length;)this.cameras[0].dispose();for(this.defaultMaterial&&this.defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._alternateSceneUbo&&this._alternateSceneUbo.dispose(),this.postProcessManager.dispose(),p=this._engine.scenes.indexOf(this),p>-1&&this._engine.scenes.splice(p,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(a.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),a.prototype.clearCachedVertexData=function(){for(var n=0;n<this.meshes.length;n++){var s=this.meshes[n],o=s.geometry;if(o){o._indices=[];for(var l in o._vertexBuffers)o._vertexBuffers.hasOwnProperty(l)&&(o._vertexBuffers[l]._buffer._data=null)}}},a.prototype.cleanCachedTextureBuffer=function(){for(var n=0,s=this.textures;n<s.length;n++){var o=s[n],l=o._buffer;l&&(o._buffer=null)}},a.prototype.getWorldExtends=function(n){var s=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n=n||function(){return!0},this.meshes.filter(n).forEach(function(l){if(l.computeWorldMatrix(!0),!(!l.subMeshes||l.subMeshes.length===0||l.infiniteDistance)){var u=l.getBoundingInfo(),h=u.boundingBox.minimumWorld,d=u.boundingBox.maximumWorld;t.Tools.CheckExtends(h,s,o),t.Tools.CheckExtends(d,s,o)}}),{min:s,max:o}},a.prototype.createPickingRay=function(n,s,o,l,u){u===void 0&&(u=!1);var h=t.Ray.Zero();return this.createPickingRayToRef(n,s,o,h,l,u),h},a.prototype.createPickingRayToRef=function(n,s,o,l,u,h){h===void 0&&(h=!1);var d=this._engine;if(!u){if(!this.activeCamera)throw new Error("Active camera not set");u=this.activeCamera}var p=u.viewport,m=p.toGlobal(d.getRenderWidth(),d.getRenderHeight());return n=n/this._engine.getHardwareScalingLevel()-m.x,s=s/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-m.y-m.height),l.update(n,s,m.width,m.height,o||t.Matrix.Identity(),h?t.Matrix.Identity():u.getViewMatrix(),u.getProjectionMatrix()),this},a.prototype.createPickingRayInCameraSpace=function(n,s,o){var l=t.Ray.Zero();return this.createPickingRayInCameraSpaceToRef(n,s,l,o),l},a.prototype.createPickingRayInCameraSpaceToRef=function(n,s,o,l){if(!t.PickingInfo)return this;var u=this._engine;if(!l){if(!this.activeCamera)throw new Error("Active camera not set");l=this.activeCamera}var h=l.viewport,d=h.toGlobal(u.getRenderWidth(),u.getRenderHeight()),p=t.Matrix.Identity();return n=n/this._engine.getHardwareScalingLevel()-d.x,s=s/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-d.y-d.height),o.update(n,s,d.width,d.height,p,p,l.getProjectionMatrix()),this},a.prototype._internalPick=function(n,s,o){if(!t.PickingInfo)return null;for(var l=null,u=0;u<this.meshes.length;u++){var h=this.meshes[u];if(s){if(!s(h))continue}else if(!h.isEnabled()||!h.isVisible||!h.isPickable)continue;var d=h.getWorldMatrix(),p=n(d),m=h.intersects(p,o);if(!(!m||!m.hit)&&!(!o&&l!=null&&m.distance>=l.distance)&&(l=m,o))break}return l||new t.PickingInfo},a.prototype._internalMultiPick=function(n,s){if(!t.PickingInfo)return null;for(var o=new Array,l=0;l<this.meshes.length;l++){var u=this.meshes[l];if(s){if(!s(u))continue}else if(!u.isEnabled()||!u.isVisible||!u.isPickable)continue;var h=u.getWorldMatrix(),d=n(h),p=u.intersects(d,!1);!p||!p.hit||o.push(p)}return o},a.prototype.pick=function(n,s,o,l,u){var h=this;if(!t.PickingInfo)return null;var d=this._internalPick(function(p){return h.createPickingRayToRef(n,s,p,h._tempPickingRay,u||null),h._tempPickingRay},o,l);return d&&(d.ray=this.createPickingRay(n,s,t.Matrix.Identity(),u||null)),d},a.prototype.pickWithRay=function(n,s,o){var l=this,u=this._internalPick(function(h){return l._pickWithRayInverseMatrix||(l._pickWithRayInverseMatrix=t.Matrix.Identity()),h.invertToRef(l._pickWithRayInverseMatrix),l._cachedRayForTransform||(l._cachedRayForTransform=t.Ray.Zero()),t.Ray.TransformToRef(n,l._pickWithRayInverseMatrix,l._cachedRayForTransform),l._cachedRayForTransform},s,o);return u&&(u.ray=n),u},a.prototype.multiPick=function(n,s,o,l){var u=this;return this._internalMultiPick(function(h){return u.createPickingRay(n,s,h,l||null)},o)},a.prototype.multiPickWithRay=function(n,s){var o=this;return this._internalMultiPick(function(l){return o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=t.Matrix.Identity()),l.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=t.Ray.Zero()),t.Ray.TransformToRef(n,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform},s)},a.prototype.setPointerOverMesh=function(n){this._pointerOverMesh!==n&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(t.ActionManager.OnPointerOutTrigger,t.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=n,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(t.ActionManager.OnPointerOverTrigger,t.ActionEvent.CreateNew(this._pointerOverMesh)))},a.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},a.prototype._rebuildGeometries=function(){for(var n=0,s=this.geometries;n<s.length;n++){var o=s[n];o._rebuild()}for(var l=0,u=this.meshes;l<u.length;l++){var h=u[l];h._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var d=0,p=this._components;d<p.length;d++){var m=p[d];m.rebuild()}for(var _=0,v=this.particleSystems;_<v.length;_++){var S=v[_];S.rebuild()}},a.prototype._rebuildTextures=function(){for(var n=0,s=this.textures;n<s.length;n++){var o=s[n];o._rebuild()}this.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag)},a.prototype._getByTags=function(n,s,o){if(s===void 0)return n;var l=[];o=o||function(d){};for(var u in n){var h=n[u];t.Tags&&t.Tags.MatchesQuery(h,s)&&(l.push(h),o(h))}return l},a.prototype.getMeshesByTags=function(n,s){return this._getByTags(this.meshes,n,s)},a.prototype.getCamerasByTags=function(n,s){return this._getByTags(this.cameras,n,s)},a.prototype.getLightsByTags=function(n,s){return this._getByTags(this.lights,n,s)},a.prototype.getMaterialByTags=function(n,s){return this._getByTags(this.materials,n,s).concat(this._getByTags(this.multiMaterials,n,s))},a.prototype.setRenderingOrder=function(n,s,o,l){s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),this._renderingManager.setRenderingOrder(n,s,o,l)},a.prototype.setRenderingAutoClearDepthStencil=function(n,s,o,l){o===void 0&&(o=!0),l===void 0&&(l=!0),this._renderingManager.setRenderingAutoClearDepthStencil(n,s,o,l)},a.prototype.getAutoClearDepthStencilSetup=function(n){return this._renderingManager.getAutoClearDepthStencilSetup(n)},Object.defineProperty(a.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(n){this._blockMaterialDirtyMechanism!==n&&(this._blockMaterialDirtyMechanism=n,n||this.markAllMaterialsAsDirty(t.Material.AllDirtyFlag))},enumerable:!0,configurable:!0}),a.prototype.markAllMaterialsAsDirty=function(n,s){if(!this._blockMaterialDirtyMechanism)for(var o=0,l=this.materials;o<l.length;o++){var u=l[o];s&&!s(u)||u.markAsDirty(n)}},a.prototype._loadFile=function(n,s,o,l,u,h){var d=this,p=t.Tools.LoadFile(n,s,o,l?this.database:void 0,u,h);return this._activeRequests.push(p),p.onCompleteObservable.add(function(m){d._activeRequests.splice(d._activeRequests.indexOf(m),1)}),p},a.prototype._loadFileAsync=function(n,s,o){var l=this;return new Promise(function(u,h){l._loadFile(n,function(d){u(d)},void 0,s,o,function(d,p){h(p)})})},a._uniqueIdCounter=0,a.FOGMODE_NONE=0,a.FOGMODE_EXP=1,a.FOGMODE_EXP2=2,a.FOGMODE_LINEAR=3,a.MinDeltaTime=1,a.MaxDeltaTime=1e3,a.DragMovementThreshold=10,a.LongPressDelay=500,a.DoubleClickDelay=300,a.ExclusiveDoubleClickMode=!1,a}(t.AbstractScene);t.Scene=r})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(){return r!==null&&r.apply(this,arguments)||this}return i}(t.AbstractScene);t.KeepAssets=f;var c=function(r){N(i,r);function i(a){var n=r.call(this)||this;return n.scene=a,n}return i.prototype.addAllToScene=function(){var a=this;this.cameras.forEach(function(l){a.scene.addCamera(l)}),this.lights.forEach(function(l){a.scene.addLight(l)}),this.meshes.forEach(function(l){a.scene.addMesh(l)}),this.skeletons.forEach(function(l){a.scene.addSkeleton(l)}),this.animations.forEach(function(l){a.scene.addAnimation(l)}),this.animationGroups.forEach(function(l){a.scene.addAnimationGroup(l)}),this.multiMaterials.forEach(function(l){a.scene.addMultiMaterial(l)}),this.materials.forEach(function(l){a.scene.addMaterial(l)}),this.morphTargetManagers.forEach(function(l){a.scene.addMorphTargetManager(l)}),this.geometries.forEach(function(l){a.scene.addGeometry(l)}),this.transformNodes.forEach(function(l){a.scene.addTransformNode(l)}),this.actionManagers.forEach(function(l){a.scene.addActionManager(l)}),this.textures.forEach(function(l){a.scene.addTexture(l)});for(var n=0,s=this.scene._serializableComponents;n<s.length;n++){var o=s[n];o.addFromContainer(this.scene)}},i.prototype.removeAllFromScene=function(){var a=this;this.cameras.forEach(function(l){a.scene.removeCamera(l)}),this.lights.forEach(function(l){a.scene.removeLight(l)}),this.meshes.forEach(function(l){a.scene.removeMesh(l)}),this.skeletons.forEach(function(l){a.scene.removeSkeleton(l)}),this.animations.forEach(function(l){a.scene.removeAnimation(l)}),this.animationGroups.forEach(function(l){a.scene.removeAnimationGroup(l)}),this.multiMaterials.forEach(function(l){a.scene.removeMultiMaterial(l)}),this.materials.forEach(function(l){a.scene.removeMaterial(l)}),this.morphTargetManagers.forEach(function(l){a.scene.removeMorphTargetManager(l)}),this.geometries.forEach(function(l){a.scene.removeGeometry(l)}),this.transformNodes.forEach(function(l){a.scene.removeTransformNode(l)}),this.actionManagers.forEach(function(l){a.scene.removeActionManager(l)}),this.textures.forEach(function(l){a.scene.removeTexture(l)});for(var n=0,s=this.scene._serializableComponents;n<s.length;n++){var o=s[n];o.removeFromContainer(this.scene)}},i.prototype._moveAssets=function(a,n,s){if(a)for(var o=0,l=a;o<l.length;o++){var u=l[o],h=!0;if(s)for(var d=0,p=s;d<p.length;d++){var m=p[d];if(u===m){h=!1;break}}h&&n.push(u)}},i.prototype.moveAllFromScene=function(a){a===void 0&&(a=new f);for(var n in this)this.hasOwnProperty(n)&&(this[n]=this[n]||[],this._moveAssets(this.scene[n],this[n],a[n]));this.removeAllFromScene()},i.prototype.createRootMesh=function(){var a=new t.Mesh("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(n){n.parent||a.addChild(n)}),this.meshes.unshift(a),a},i}(t.AbstractScene);t.AssetContainer=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l){n===void 0&&(n=0),s===void 0&&(s=!1),o===void 0&&(o=!1),l===void 0&&(l=!1),r instanceof t.Mesh?this._engine=r.getScene().getEngine():this._engine=r,this._updatable=a,this._instanced=o,this._data=i,this.byteStride=l?n:n*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return c.prototype.createVertexBuffer=function(r,i,a,n,s,o){o===void 0&&(o=!1);var l=o?i:i*Float32Array.BYTES_PER_ELEMENT,u=n?o?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new t.VertexBuffer(this._engine,this,r,this._updatable,!0,u,s===void 0?this._instanced:s,l,a,void 0,void 0,!0)},c.prototype.isUpdatable=function(){return this._updatable},c.prototype.getData=function(){return this._data},c.prototype.getBuffer=function(){return this._buffer},c.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},c.prototype.create=function(r){r===void 0&&(r=null),!(!r&&this._buffer)&&(r=r||this._data,r&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r),this._data=r):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(r),this._data=r):this._buffer=this._engine.createVertexBuffer(r)))},c.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},c.prototype.update=function(r){this.create(r)},c.prototype.updateDirectly=function(r,i,a,n){n===void 0&&(n=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r,n?i:i*Float32Array.BYTES_PER_ELEMENT,a?a*this.byteStride:void 0),this._data=null)},c.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},c}();t.Buffer=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l,u,h,d,p,m){if(p===void 0&&(p=!1),m===void 0&&(m=!1),i instanceof t.Buffer?(this._buffer=i,this._ownsBuffer=!1):(this._buffer=new t.Buffer(r,i,n,o,s,l,m),this._ownsBuffer=!0),this._kind=a,d==null){var _=this.getData();this.type=c.FLOAT,_ instanceof Int8Array?this.type=c.BYTE:_ instanceof Uint8Array?this.type=c.UNSIGNED_BYTE:_ instanceof Int16Array?this.type=c.SHORT:_ instanceof Uint16Array?this.type=c.UNSIGNED_SHORT:_ instanceof Int32Array?this.type=c.INT:_ instanceof Uint32Array&&(this.type=c.UNSIGNED_INT)}else this.type=d;var v=c.GetTypeByteLength(this.type);m?(this._size=h||(o?o/v:c.DeduceStride(a)),this.byteStride=o||this._buffer.byteStride||this._size*v,this.byteOffset=u||0):(this._size=h||o||c.DeduceStride(a),this.byteStride=o?o*v:this._buffer.byteStride||this._size*v,this.byteOffset=(u||0)*v),this.normalized=p,this._instanced=l!==void 0?l:!1,this._instanceDivisor=l?1:0}return Object.defineProperty(c.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(r){this._instanceDivisor=r,r==0?this._instanced=!1:this._instanced=!0},enumerable:!0,configurable:!0}),c.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},c.prototype.getKind=function(){return this._kind},c.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},c.prototype.getData=function(){return this._buffer.getData()},c.prototype.getBuffer=function(){return this._buffer.getBuffer()},c.prototype.getStrideSize=function(){return this.byteStride/c.GetTypeByteLength(this.type)},c.prototype.getOffset=function(){return this.byteOffset/c.GetTypeByteLength(this.type)},c.prototype.getSize=function(){return this._size},c.prototype.getIsInstanced=function(){return this._instanced},c.prototype.getInstanceDivisor=function(){return this._instanceDivisor},c.prototype.create=function(r){this._buffer.create(r)},c.prototype.update=function(r){this._buffer.update(r)},c.prototype.updateDirectly=function(r,i,a){a===void 0&&(a=!1),this._buffer.updateDirectly(r,i,void 0,a)},c.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},c.prototype.forEach=function(r,i){c.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,r,this.normalized,i)},c.DeduceStride=function(r){switch(r){case c.UVKind:case c.UV2Kind:case c.UV3Kind:case c.UV4Kind:case c.UV5Kind:case c.UV6Kind:return 2;case c.NormalKind:case c.PositionKind:return 3;case c.ColorKind:case c.MatricesIndicesKind:case c.MatricesIndicesExtraKind:case c.MatricesWeightsKind:case c.MatricesWeightsExtraKind:case c.TangentKind:return 4;default:throw new Error("Invalid kind '"+r+"'")}},c.GetTypeByteLength=function(r){switch(r){case c.BYTE:case c.UNSIGNED_BYTE:return 1;case c.SHORT:case c.UNSIGNED_SHORT:return 2;case c.INT:case c.FLOAT:return 4;default:throw new Error("Invalid type '"+r+"'")}},c.ForEach=function(r,i,a,n,s,o,l,u){if(r instanceof Array)for(var h=i/4,d=a/4,p=0;p<o;p+=n){for(var m=0;m<n;m++)u(r[h+m],p+m);h+=d}else for(var _=r instanceof ArrayBuffer?new DataView(r):new DataView(r.buffer,r.byteOffset,r.byteLength),v=c.GetTypeByteLength(s),p=0;p<o;p+=n){for(var S=i,m=0;m<n;m++){var P=c._GetFloatValue(_,s,S,l);u(P,p+m),S+=v}i+=a}},c._GetFloatValue=function(r,i,a,n){switch(i){case c.BYTE:{var s=r.getInt8(a);return n&&(s=Math.max(s/127,-1)),s}case c.UNSIGNED_BYTE:{var s=r.getUint8(a);return n&&(s=s/255),s}case c.SHORT:{var s=r.getInt16(a,!0);return n&&(s=Math.max(s/16383,-1)),s}case c.UNSIGNED_SHORT:{var s=r.getUint16(a,!0);return n&&(s=s/65535),s}case c.FLOAT:return r.getFloat32(a,!0);default:throw new Error("Invalid component type "+i)}},c.BYTE=5120,c.UNSIGNED_BYTE=5121,c.SHORT=5122,c.UNSIGNED_SHORT=5123,c.INT=5124,c.UNSIGNED_INT=5125,c.FLOAT=5126,c.PositionKind="position",c.NormalKind="normal",c.TangentKind="tangent",c.UVKind="uv",c.UV2Kind="uv2",c.UV3Kind="uv3",c.UV4Kind="uv4",c.UV5Kind="uv5",c.UV6Kind="uv6",c.ColorKind="color",c.MatricesIndicesKind="matricesIndices",c.MatricesWeightsKind="matricesWeights",c.MatricesIndicesExtraKind="matricesIndicesExtra",c.MatricesWeightsExtraKind="matricesWeightsExtra",c}();t.VertexBuffer=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.previous=null,this.next=null}return c}();t.DummyInternalTextureTracker=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.onLoadedObservable=new t.Observable,this.previous=null,this.next=null,this._initialSlot=-1,this._designatedSlot=-1,this._dataSource=c.DATASOURCE_UNKNOWN,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._isRGBD=!1,this._references=1,this._engine=r,this._dataSource=i,this._webGLTexture=r._createTexture()}return c.prototype.getEngine=function(){return this._engine},Object.defineProperty(c.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),c.prototype.incrementReferences=function(){this._references++},c.prototype.updateSize=function(r,i,a){a===void 0&&(a=1),this.width=r,this.height=i,this.depth=a,this.baseWidth=r,this.baseHeight=i,this.baseDepth=a,this._size=r*i*a},c.prototype._rebuild=function(){var r=this,i;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case c.DATASOURCE_TEMP:return;case c.DATASOURCE_URL:i=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){r.isReady=!0},null,this._buffer,void 0,this.format),i._swapAndDie(this);return;case c.DATASOURCE_RAW:i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case c.DATASOURCE_RAW3D:i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case c.DATASOURCE_DYNAMIC:i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),i._swapAndDie(this);return;case c.DATASOURCE_RENDERTARGET:var a=new t.RenderTargetCreationOptions;if(a.generateDepthBuffer=this._generateDepthBuffer,a.generateMipMaps=this.generateMipMaps,a.generateStencilBuffer=this._generateStencilBuffer,a.samplingMode=this.samplingMode,a.type=this.type,this.isCube)i=this._engine.createRenderTargetCubeTexture(this.width,a);else{var n={width:this.width,height:this.height};i=this._engine.createRenderTargetTexture(n,a)}i._swapAndDie(this),this.isReady=!0;return;case c.DATASOURCE_DEPTHTEXTURE:var s={bilinearFiltering:this.samplingMode!==t.Texture.BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};i=this._engine.createDepthStencilTexture({width:this.width,height:this.height},s),i._swapAndDie(this),this.isReady=!0;return;case c.DATASOURCE_CUBE:i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){r.isReady=!0},null,this.format,this._extension),i._swapAndDie(this);return;case c.DATASOURCE_CUBERAW:i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case c.DATASOURCE_CUBERAW_RGBD:i=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),t.RawCubeTexture._UpdateRGBDAsync(i,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){r.isReady=!0}),i._swapAndDie(this);return;case c.DATASOURCE_CUBEPREFILTERED:i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(o){o&&o._swapAndDie(r),r.isReady=!0},null,this.format,this._extension),i._sphericalPolynomial=this._sphericalPolynomial;return}},c.prototype._swapAndDie=function(r){r._webGLTexture=this._webGLTexture,this._framebuffer&&(r._framebuffer=this._framebuffer),this._depthStencilBuffer&&(r._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(r._lodTextureHigh&&r._lodTextureHigh.dispose(),r._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(r._lodTextureMid&&r._lodTextureMid.dispose(),r._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(r._lodTextureLow&&r._lodTextureLow.dispose(),r._lodTextureLow=this._lodTextureLow);var i=this._engine.getLoadedTexturesCache(),a=i.indexOf(this);a!==-1&&i.splice(a,1)},c.prototype.dispose=function(){this._webGLTexture&&(this._references--,this._references===0&&(this._engine._releaseTexture(this),this._webGLTexture=null,this.previous=null,this.next=null))},c.DATASOURCE_UNKNOWN=0,c.DATASOURCE_URL=1,c.DATASOURCE_TEMP=2,c.DATASOURCE_RAW=3,c.DATASOURCE_DYNAMIC=4,c.DATASOURCE_RENDERTARGET=5,c.DATASOURCE_MULTIRENDERTARGET=6,c.DATASOURCE_CUBE=7,c.DATASOURCE_CUBERAW=8,c.DATASOURCE_CUBEPREFILTERED=9,c.DATASOURCE_RAW3D=10,c.DATASOURCE_DEPTHTEXTURE=11,c.DATASOURCE_CUBERAW_RGBD=12,c}();t.InternalTexture=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=t.Texture.EXPLICIT_MODE,this.wrapU=t.Texture.WRAP_ADDRESSMODE,this.wrapV=t.Texture.WRAP_ADDRESSMODE,this.wrapR=t.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.isCube=!1,this.is3D=!1,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new t.Observable,this.delayLoadState=t.Engine.DELAYLOADSTATE_NONE,this._cachedSize=t.Size.Zero(),this._scene=r||t.Engine.LastCreatedScene,this._scene&&(this._scene.textures.push(this),this._scene.onNewTextureAddedObservable.notifyObservers(this)),this._uid=null}return Object.defineProperty(c.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(r){this._hasAlpha!==r&&(this._hasAlpha=r,this._scene&&this._scene.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag|t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(r){this._coordinatesMode!==r&&(this._coordinatesMode=r,this._scene&&this._scene.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(r){this._texture&&(this._texture._lodGenerationOffset=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(r){this._texture&&(this._texture._lodGenerationScale=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"uid",{get:function(){return this._uid||(this._uid=t.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this.name},c.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(c.prototype,"onDispose",{set:function(r){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},c.prototype.getTextureMatrix=function(){return t.Matrix.IdentityReadOnly},c.prototype.getReflectionTextureMatrix=function(){return t.Matrix.IdentityReadOnly},c.prototype.getInternalTexture=function(){return this._texture},c.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},c.prototype.isReady=function(){return this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1},c.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},c.prototype.getBaseSize=function(){return!this.isReady()||!this._texture?t.Size.Zero():this._texture._size?new t.Size(this._texture._size,this._texture._size):new t.Size(this._texture.baseWidth,this._texture.baseHeight)},c.prototype.scale=function(r){},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype._getFromCache=function(r,i,a){if(!this._scene)return null;for(var n=this._scene.getEngine().getLoadedTexturesCache(),s=0;s<n.length;s++){var o=n[s];if(o.url===r&&o.generateMipMaps===!i&&(!a||a===o.samplingMode))return o.incrementReferences(),o}return null},c.prototype._rebuild=function(){},c.prototype.delayLoad=function(){},c.prototype.clone=function(){return null},Object.defineProperty(c.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:t.Engine.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:t.Engine.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),c.prototype.readPixels=function(r,i,a){if(r===void 0&&(r=0),i===void 0&&(i=0),a===void 0&&(a=null),!this._texture)return null;var n=this.getSize(),s=n.width,o=n.height,l=this.getScene();if(!l)return null;var u=l.getEngine();return i!=0&&(s=s/Math.pow(2,i),o=o/Math.pow(2,i),s=Math.round(s),o=Math.round(o)),this._texture.isCube?u._readTexturePixels(this._texture,s,o,r,i,a):u._readTexturePixels(this._texture,s,o,-1,i,a)},c.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(c.prototype,"sphericalPolynomial",{get:function(){return!this._texture||!t.CubeMapToSphericalPolynomialTools||!this.isReady()?null:(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=t.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial)},set:function(r){this._texture&&(this._texture._sphericalPolynomial=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation(this),this._scene._removePendingData(this);var r=this._scene.textures.indexOf(this);r>=0&&this._scene.textures.splice(r,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._texture!==void 0&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},c.prototype.serialize=function(){if(!this.name)return null;var r=t.SerializationHelper.Serialize(this);return t.Animation.AppendSerializedAnimations(this,r),r},c.WhenAllReady=function(r,i){var a=r.length;if(a===0){i();return}for(var n=function(){if(s=r[l],s.isReady())--a===0&&i();else{o=s.onLoadObservable;var u=function(){o.removeCallback(u),--a===0&&i()};o.add(u)}},s,o,l=0;l<r.length;l++)n()},c.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,A([t.serialize()],c.prototype,"name",void 0),A([t.serialize("hasAlpha")],c.prototype,"_hasAlpha",void 0),A([t.serialize()],c.prototype,"getAlphaFromRGB",void 0),A([t.serialize()],c.prototype,"level",void 0),A([t.serialize()],c.prototype,"coordinatesIndex",void 0),A([t.serialize("coordinatesMode")],c.prototype,"_coordinatesMode",void 0),A([t.serialize()],c.prototype,"wrapU",void 0),A([t.serialize()],c.prototype,"wrapV",void 0),A([t.serialize()],c.prototype,"wrapR",void 0),A([t.serialize()],c.prototype,"anisotropicFilteringLevel",void 0),A([t.serialize()],c.prototype,"isCube",void 0),A([t.serialize()],c.prototype,"is3D",void 0),A([t.serialize()],c.prototype,"gammaSpace",void 0),A([t.serialize()],c.prototype,"invertZ",void 0),A([t.serialize()],c.prototype,"lodLevelInAlpha",void 0),A([t.serialize()],c.prototype,"lodGenerationOffset",null),A([t.serialize()],c.prototype,"lodGenerationScale",null),A([t.serialize()],c.prototype,"isRenderTarget",void 0),c}();t.BaseTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p){n===void 0&&(n=!1),s===void 0&&(s=!0),o===void 0&&(o=r.TRILINEAR_SAMPLINGMODE),l===void 0&&(l=null),u===void 0&&(u=null),h===void 0&&(h=null),d===void 0&&(d=!1);var m=c.call(this,a)||this;if(m.uOffset=0,m.vOffset=0,m.uScale=1,m.vScale=1,m.uAng=0,m.vAng=0,m.wAng=0,m.uRotationCenter=.5,m.vRotationCenter=.5,m.wRotationCenter=.5,m.onLoadObservable=new t.Observable,m._isBlocking=!0,m.name=i||"",m.url=i,m._noMipmap=n,m._invertY=s,m._samplingMode=o,m._buffer=h,m._deleteBuffer=d,p&&(m._format=p),a=m.getScene(),!a)return m;a.getEngine().onBeforeTextureInitObservable.notifyObservers(m);var _=function(){m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m),l&&l(),!m.isBlocking&&a&&a.resetCachedMaterial()};return m.url?(m._texture=m._getFromCache(m.url,n,o),m._texture?m._texture.isReady?t.Tools.SetImmediate(function(){return _()}):m._texture.onLoadedObservable.add(_):a.useDelayedTextureLoading?(m.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED,m._delayedOnLoad=_,m._delayedOnError=u):(m._texture=a.getEngine().createTexture(m.url,n,s,a,m._samplingMode,_,u,m._buffer,void 0,m._format),d&&delete m._buffer),m):(m._delayedOnLoad=_,m._delayedOnError=u,m)}return Object.defineProperty(r.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(i){this._isBlocking=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"samplingMode",{get:function(){return this._samplingMode},enumerable:!0,configurable:!0}),r.prototype.updateURL=function(i,a){if(a===void 0&&(a=null),this.url)throw new Error("URL is already set");this.url=i,this._buffer=a,this.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED,this.delayLoad()},r.prototype.delayLoad=function(){if(this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED){var i=this.getScene();i&&(this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture?this._delayedOnLoad&&(this._texture.isReady?t.Tools.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=i.getEngine().createTexture(this.url,this._noMipmap,this._invertY,i,this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},r.prototype.updateSamplingMode=function(i){if(this._texture){var a=this.getScene();a&&(this._samplingMode=i,a.getEngine().updateTextureSamplingMode(i,this._texture))}},r.prototype._prepareRowForTextureGeneration=function(i,a,n,s){i*=this.uScale,a*=this.vScale,i-=this.uRotationCenter*this.uScale,a-=this.vRotationCenter*this.vScale,n-=this.wRotationCenter,t.Vector3.TransformCoordinatesFromFloatsToRef(i,a,n,this._rowGenerationMatrix,s),s.x+=this.uRotationCenter*this.uScale+this.uOffset,s.y+=this.vRotationCenter*this.vScale+this.vOffset,s.z+=this.wRotationCenter},r.prototype.getTextureMatrix=function(){var i=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=t.Matrix.Zero(),this._rowGenerationMatrix=new t.Matrix,this._t0=t.Vector3.Zero(),this._t1=t.Vector3.Zero(),this._t2=t.Vector3.Zero()),t.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),t.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z;var a=this.getScene();return a?(a.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag,function(n){return n.hasTexture(i)}),this._cachedTextureMatrix):this._cachedTextureMatrix},r.prototype.getReflectionTextureMatrix=function(){var i=this,a=this.getScene();if(!a)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)if(this.coordinatesMode===r.PROJECTION_MODE){if(this._cachedProjectionMatrixId===a.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}else return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=t.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=t.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case r.PLANAR_MODE:t.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case r.PROJECTION_MODE:t.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1;var n=a.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:t.Matrix.IdentityToRef(this._cachedTextureMatrix);break}return a.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag,function(s){return s.getActiveTextures().indexOf(i)!==-1}),this._cachedTextureMatrix},r.prototype.clone=function(){var i=this;return t.SerializationHelper.Clone(function(){return new r(i._texture?i._texture.url:null,i.getScene(),i._noMipmap,i._invertY,i._samplingMode)},this)},r.prototype.serialize=function(){var i=c.prototype.serialize.call(this);return typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"&&(i.base64String=this._buffer,i.name=i.name.replace("data:","")),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i},r.prototype.getClassName=function(){return"Texture"},r.prototype.dispose=function(){c.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},r.Parse=function(i,a,n){if(i.customType){var s=t.Tools.Instantiate(i.customType),o=s.Parse(i,a,n);return i.samplingMode&&o.updateSamplingMode&&o._samplingMode&&o._samplingMode!==i.samplingMode&&o.updateSamplingMode(i.samplingMode),o}if(i.isCube)return t.CubeTexture.Parse(i,a,n);if(!i.name&&!i.isRenderTarget)return null;var l=t.SerializationHelper.Parse(function(){var p=!0;if(i.noMipmap&&(p=!1),i.mirrorPlane){var m=new t.MirrorTexture(i.name,i.renderTargetSize,a,p);return m._waitingRenderList=i.renderList,m.mirrorPlane=t.Plane.FromArray(i.mirrorPlane),m}else if(i.isRenderTarget){var _=new t.RenderTargetTexture(i.name,i.renderTargetSize,a,p);return _._waitingRenderList=i.renderList,_}else{var v;if(i.base64String)v=r.CreateFromBase64String(i.base64String,i.name,a,!p);else{var S=n+i.name;r.UseSerializedUrlIfAny&&i.url&&(S=i.url),v=new r(S,a,!p,i.invertY)}return v}},i,a);if(i.samplingMode){var u=i.samplingMode;l._samplingMode!==u&&l.updateSamplingMode(u)}if(i.animations)for(var h=0;h<i.animations.length;h++){var d=i.animations[h];l.animations.push(t.Animation.Parse(d))}return l},r.CreateFromBase64String=function(i,a,n,s,o,l,u,h,d){return l===void 0&&(l=r.TRILINEAR_SAMPLINGMODE),u===void 0&&(u=null),h===void 0&&(h=null),d===void 0&&(d=t.Engine.TEXTUREFORMAT_RGBA),new r("data:"+a,n,s,o,l,u,h,i,!1,d)},r.LoadFromDataString=function(i,a,n,s,o,l,u,h,d,p){return s===void 0&&(s=!1),o===void 0&&(o=!1),l===void 0&&(l=!0),u===void 0&&(u=r.TRILINEAR_SAMPLINGMODE),h===void 0&&(h=null),d===void 0&&(d=null),p===void 0&&(p=t.Engine.TEXTUREFORMAT_RGBA),i.substr(0,5)!=="data:"&&(i="data:"+i),new r(i,n,o,l,u,h,d,a,s,p)},r.NEAREST_SAMPLINGMODE=t.Engine.TEXTURE_NEAREST_SAMPLINGMODE,r.NEAREST_NEAREST_MIPLINEAR=t.Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR,r.BILINEAR_SAMPLINGMODE=t.Engine.TEXTURE_BILINEAR_SAMPLINGMODE,r.LINEAR_LINEAR_MIPNEAREST=t.Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST,r.TRILINEAR_SAMPLINGMODE=t.Engine.TEXTURE_TRILINEAR_SAMPLINGMODE,r.LINEAR_LINEAR_MIPLINEAR=t.Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR,r.NEAREST_NEAREST_MIPNEAREST=t.Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST,r.NEAREST_LINEAR_MIPNEAREST=t.Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST,r.NEAREST_LINEAR_MIPLINEAR=t.Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR,r.NEAREST_LINEAR=t.Engine.TEXTURE_NEAREST_LINEAR,r.NEAREST_NEAREST=t.Engine.TEXTURE_NEAREST_NEAREST,r.LINEAR_NEAREST_MIPNEAREST=t.Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST,r.LINEAR_NEAREST_MIPLINEAR=t.Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR,r.LINEAR_LINEAR=t.Engine.TEXTURE_LINEAR_LINEAR,r.LINEAR_NEAREST=t.Engine.TEXTURE_LINEAR_NEAREST,r.EXPLICIT_MODE=t.Engine.TEXTURE_EXPLICIT_MODE,r.SPHERICAL_MODE=t.Engine.TEXTURE_SPHERICAL_MODE,r.PLANAR_MODE=t.Engine.TEXTURE_PLANAR_MODE,r.CUBIC_MODE=t.Engine.TEXTURE_CUBIC_MODE,r.PROJECTION_MODE=t.Engine.TEXTURE_PROJECTION_MODE,r.SKYBOX_MODE=t.Engine.TEXTURE_SKYBOX_MODE,r.INVCUBIC_MODE=t.Engine.TEXTURE_INVCUBIC_MODE,r.EQUIRECTANGULAR_MODE=t.Engine.TEXTURE_EQUIRECTANGULAR_MODE,r.FIXED_EQUIRECTANGULAR_MODE=t.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,r.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=t.Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,r.CLAMP_ADDRESSMODE=t.Engine.TEXTURE_CLAMP_ADDRESSMODE,r.WRAP_ADDRESSMODE=t.Engine.TEXTURE_WRAP_ADDRESSMODE,r.MIRROR_ADDRESSMODE=t.Engine.TEXTURE_MIRROR_ADDRESSMODE,r.UseSerializedUrlIfAny=!1,A([t.serialize()],r.prototype,"url",void 0),A([t.serialize()],r.prototype,"uOffset",void 0),A([t.serialize()],r.prototype,"vOffset",void 0),A([t.serialize()],r.prototype,"uScale",void 0),A([t.serialize()],r.prototype,"vScale",void 0),A([t.serialize()],r.prototype,"uAng",void 0),A([t.serialize()],r.prototype,"vAng",void 0),A([t.serialize()],r.prototype,"wAng",void 0),A([t.serialize()],r.prototype,"uRotationCenter",void 0),A([t.serialize()],r.prototype,"vRotationCenter",void 0),A([t.serialize()],r.prototype,"wRotationCenter",void 0),A([t.serialize()],r.prototype,"isBlocking",null),r}(t.BaseTexture);t.Texture=f})(T||(T={}));var T;(function(t){var f=function(){function a(){}return a}();t._CreationDataStorage=f;var c=function(){function a(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new r,this.instancesBufferSize=32*16*4}return a}(),r=function(){function a(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return a}();t._InstancesBatch=r;var i=function(a){N(n,a);function n(s,o,l,u,h,d){o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),d===void 0&&(d=!0);var p=a.call(this,s,o)||this;if(p.delayLoadState=t.Engine.DELAYLOADSTATE_NONE,p.instances=new Array,p._LODLevels=new Array,p._instanceDataStorage=new c,p._originalBuilderSideOrientation=n.DEFAULTSIDE,p.overrideMaterialSideOrientation=null,p._areNormalsFrozen=!1,p._source=null,o=p.getScene(),u){if(u._geometry&&u._geometry.applyToMesh(p),t.Tools.DeepCopy(u,p,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw"],["_poseMatrix"]),p._source=u,p._originalBuilderSideOrientation=u._originalBuilderSideOrientation,p._creationDataStorage=u._creationDataStorage,p._source._ranges){var m=p._source._ranges;for(var s in m)m.hasOwnProperty(s)&&m[s]&&p.createAnimationRange(s,m[s].from,m[s].to)}u.metadata&&u.metadata.clone?p.metadata=u.metadata.clone():p.metadata=u.metadata,t.Tags&&t.Tags.HasTags(u)&&t.Tags.AddTagsTo(p,t.Tags.GetTags(u,!0)),p.parent=u.parent,p.setPivotMatrix(u.getPivotMatrix()),p.id=s+"."+u.id,p.material=u.material;var _;if(!h)for(var v=u.getDescendants(!0),S=0;S<v.length;S++){var P=v[S];P.clone&&P.clone(s+"."+P.name,p)}var x=p.getScene().getPhysicsEngine();if(d&&x){var R=x.getImpostorForPhysicsObject(u);R&&(p.physicsImpostor=R.clone(p))}for(_=0;_<o.particleSystems.length;_++){var w=o.particleSystems[_];w.emitter===u&&w.clone(w.name,p)}p.refreshBoundingInfo(),p.computeWorldMatrix(!0)}return l!==null&&(p.parent=l),p}return Object.defineProperty(n.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new t.Observable),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new t.Observable),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new t.Observable),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onBeforeDraw",{set:function(s){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(s)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(s){this._morphTargetManager!==s&&(this._morphTargetManager=s,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(s){this._unIndexed!==s&&(this._unIndexed=s,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),n.prototype.getClassName=function(){return"Mesh"},n.prototype.toString=function(s){var o=a.prototype.toString.call(this,s);if(o+=", n vertices: "+this.getTotalVertices(),o+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var l=0;l<this.animations.length;l++)o+=", animation[0]: "+this.animations[l].toString(s);if(s)if(this._geometry){var u=this.getIndices(),h=this.getVerticesData(t.VertexBuffer.PositionKind);h&&u&&(o+=", flat shading: "+(h.length/3===u.length?"YES":"NO"))}else o+=", flat shading: UNKNOWN";return o},n.prototype._unBindEffect=function(){a.prototype._unBindEffect.call(this);for(var s=0,o=this.instances;s<o.length;s++){var l=o[s];l._unBindEffect()}},Object.defineProperty(n.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),n.prototype.getLODLevels=function(){return this._LODLevels},n.prototype._sortLODLevels=function(){this._LODLevels.sort(function(s,o){return s.distance<o.distance?1:s.distance>o.distance?-1:0})},n.prototype.addLODLevel=function(s,o){if(o&&o._masterMesh)return t.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var l=new t.MeshLODLevel(s,o);return this._LODLevels.push(l),o&&(o._masterMesh=this),this._sortLODLevels(),this},n.prototype.getLODLevelAtDistance=function(s){for(var o=0;o<this._LODLevels.length;o++){var l=this._LODLevels[o];if(l.distance===s)return l.mesh}return null},n.prototype.removeLODLevel=function(s){for(var o=0;o<this._LODLevels.length;o++)this._LODLevels[o].mesh===s&&(this._LODLevels.splice(o,1),s&&(s._masterMesh=null));return this._sortLODLevels(),this},n.prototype.getLOD=function(s,o){if(!this._LODLevels||this._LODLevels.length===0)return this;var l;if(o)l=o;else{var u=this.getBoundingInfo();l=u.boundingSphere}var h=l.centerWorld.subtract(s.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>h)return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var d=0;d<this._LODLevels.length;d++){var p=this._LODLevels[d];if(p.distance<h)return p.mesh&&(p.mesh._preActivate(),p.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(h,this,p.mesh),p.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(h,this,this),this},Object.defineProperty(n.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),n.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},n.prototype.getVerticesData=function(s,o,l){return this._geometry?this._geometry.getVerticesData(s,o,l):null},n.prototype.getVertexBuffer=function(s){return this._geometry?this._geometry.getVertexBuffer(s):null},n.prototype.isVerticesDataPresent=function(s){return this._geometry?this._geometry.isVerticesDataPresent(s):this._delayInfo?this._delayInfo.indexOf(s)!==-1:!1},n.prototype.isVertexBufferUpdatable=function(s){return this._geometry?this._geometry.isVertexBufferUpdatable(s):this._delayInfo?this._delayInfo.indexOf(s)!==-1:!1},n.prototype.getVerticesDataKinds=function(){if(!this._geometry){var s=new Array;return this._delayInfo&&this._delayInfo.forEach(function(o,l,u){s.push(o)}),s}return this._geometry.getVerticesDataKinds()},n.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},n.prototype.getIndices=function(s,o){return this._geometry?this._geometry.getIndices(s,o):[]},Object.defineProperty(n.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!0,configurable:!0}),n.prototype.isReady=function(s,o){if(s===void 0&&(s=!1),o===void 0&&(o=!1),this.delayLoadState===t.Engine.DELAYLOADSTATE_LOADING||!a.prototype.isReady.call(this,s))return!1;if(!this.subMeshes||this.subMeshes.length===0||!s)return!0;var l=this.getEngine(),u=this.getScene(),h=o||l.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var d=this.material||u.defaultMaterial;if(d){if(d.storeEffectOnSubMeshes)for(var p=0,m=this.subMeshes;p<m.length;p++){var _=m[p],v=_.getMaterial();if(v){if(v.storeEffectOnSubMeshes){if(!v.isReadyForSubMesh(this,_,h))return!1}else if(!v.isReady(this,h))return!1}}else if(!d.isReady(this,h))return!1}for(var S=0,P=this._lightSources;S<P.length;S++){var x=P[S],R=x.getShadowGenerator();if(R)for(var w=0,I=this.subMeshes;w<I.length;w++){var _=I[w];if(!R.isReady(_,h))return!1}}for(var F=0,k=this._LODLevels;F<k.length;F++){var E=k[F];if(E.mesh&&!E.mesh.isReady(h))return!1}return!0},Object.defineProperty(n.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),n.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},n.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(n.prototype,"overridenInstanceCount",{set:function(s){this._instanceDataStorage.overridenInstanceCount=s},enumerable:!0,configurable:!0}),n.prototype._preActivate=function(){var s=this.getScene().getRenderId();return this._preActivateId===s?this:(this._preActivateId=s,this._instanceDataStorage.visibleInstances=null,this)},n.prototype._preActivateForIntermediateRendering=function(s){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=s),this},n.prototype._registerInstanceForRenderId=function(s,o){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={},this._instanceDataStorage.visibleInstances.defaultRenderId=o,this._instanceDataStorage.visibleInstances.selfDefaultRenderId=this._renderId),this._instanceDataStorage.visibleInstances[o]||(this._instanceDataStorage.visibleInstances[o]=new Array),this._instanceDataStorage.visibleInstances[o].push(s),this},n.prototype.refreshBoundingInfo=function(){return this._refreshBoundingInfo(!1)},n.prototype._refreshBoundingInfo=function(s){if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var o=this._getPositionData(s);if(o){var l=this.geometry?this.geometry.boundingBias:null,u=t.Tools.ExtractMinAndMax(o,0,this.getTotalVertices(),l);this._boundingInfo=new t.BoundingInfo(u.minimum,u.maximum)}if(this.subMeshes)for(var h=0;h<this.subMeshes.length;h++)this.subMeshes[h].refreshBoundingInfo();return this._updateBoundingInfo(),this},n.prototype._getPositionData=function(s){var o=this.getVerticesData(t.VertexBuffer.PositionKind);if(o&&s&&this.skeleton){o=t.Tools.Slice(o);var l=this.getVerticesData(t.VertexBuffer.MatricesIndicesKind),u=this.getVerticesData(t.VertexBuffer.MatricesWeightsKind);if(u&&l)for(var h=this.numBoneInfluencers>4,d=h?this.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind):null,p=h?this.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind):null,m=this.skeleton.getTransformMatrices(this),_=t.Tmp.Vector3[0],v=t.Tmp.Matrix[0],S=t.Tmp.Matrix[1],P=0,x=0;x<o.length;x+=3,P+=4){v.reset();var R,w;for(R=0;R<4;R++)w=u[P+R],w>0&&(t.Matrix.FromFloat32ArrayToRefScaled(m,Math.floor(l[P+R]*16),w,S),v.addToSelf(S));if(h)for(R=0;R<4;R++)w=p[P+R],w>0&&(t.Matrix.FromFloat32ArrayToRefScaled(m,Math.floor(d[P+R]*16),w,S),v.addToSelf(S));t.Vector3.TransformCoordinatesFromFloatsToRef(o[x],o[x+1],o[x+2],v,_),_.toArray(o,x)}}return o},n.prototype._createGlobalSubMesh=function(s){var o=this.getTotalVertices();if(!o||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var l=this.getIndices();if(!l)return null;var u=l.length,h=!1;if(s)h=!0;else for(var d=0,p=this.subMeshes;d<p.length;d++){var m=p[d];if(m.indexStart+m.indexCount>=u){h=!0;break}if(m.verticesStart+m.verticesCount>=o){h=!0;break}}if(!h)return this.subMeshes[0]}return this.releaseSubMeshes(),new t.SubMesh(0,0,o,0,this.getTotalIndices(),this)},n.prototype.subdivide=function(s){if(!(s<1)){for(var o=this.getTotalIndices(),l=o/s|0,u=0;l%3!==0;)l++;this.releaseSubMeshes();for(var h=0;h<s&&!(u>=o);h++)t.SubMesh.CreateFromIndices(0,u,Math.min(l,o-u),this),u+=l;this.synchronizeInstances()}},n.prototype.setVerticesData=function(s,o,l,u){if(l===void 0&&(l=!1),this._geometry)this._geometry.setVerticesData(s,o,l,u);else{var h=new t.VertexData;h.set(o,s);var d=this.getScene();new t.Geometry(t.Geometry.RandomId(),d,h,l,this)}return this},n.prototype.markVerticesDataAsUpdatable=function(s,o){o===void 0&&(o=!0);var l=this.getVertexBuffer(s);!l||l.isUpdatable()===o||this.setVerticesData(s,this.getVerticesData(s),o)},n.prototype.setVerticesBuffer=function(s){return this._geometry||(this._geometry=t.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(s),this},n.prototype.updateVerticesData=function(s,o,l,u){return this._geometry?(u?(this.makeGeometryUnique(),this.updateVerticesData(s,o,l,!1)):this._geometry.updateVerticesData(s,o,l),this):this},n.prototype.updateMeshPositions=function(s,o){o===void 0&&(o=!0);var l=this.getVerticesData(t.VertexBuffer.PositionKind);if(!l)return this;if(s(l),this.updateVerticesData(t.VertexBuffer.PositionKind,l,!1,!1),o){var u=this.getIndices(),h=this.getVerticesData(t.VertexBuffer.NormalKind);if(!h)return this;t.VertexData.ComputeNormals(l,u,h),this.updateVerticesData(t.VertexBuffer.NormalKind,h,!1,!1)}return this},n.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var s=this._geometry,o=this._geometry.copy(t.Geometry.RandomId());return s.releaseForMesh(this,!0),o.applyToMesh(this),this},n.prototype.setIndices=function(s,o,l){if(o===void 0&&(o=null),l===void 0&&(l=!1),this._geometry)this._geometry.setIndices(s,o,l);else{var u=new t.VertexData;u.indices=s;var h=this.getScene();new t.Geometry(t.Geometry.RandomId(),h,u,l,this)}return this},n.prototype.updateIndices=function(s,o){return this._geometry?(this._geometry.updateIndices(s,o),this):this},n.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},n.prototype._bind=function(s,o,l){if(!this._geometry)return this;var u=this.getScene().getEngine(),h;if(this._unIndexed)h=null;else switch(l){case t.Material.PointFillMode:h=null;break;case t.Material.WireFrameFillMode:h=s._getLinesIndexBuffer(this.getIndices(),u);break;default:case t.Material.TriangleFillMode:h=this._unIndexed?null:this._geometry.getIndexBuffer();break}return this._geometry._bind(o,h),this},n.prototype._draw=function(s,o,l,u){if(u===void 0&&(u=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var h=this.getScene(),d=h.getEngine();if(this._unIndexed||o==t.Material.PointFillMode?d.drawArraysType(o,s.verticesStart,s.verticesCount,l):o==t.Material.WireFrameFillMode?d.drawElementsType(o,0,s._linesIndexCount,l):d.drawElementsType(o,s.indexStart,s.indexCount,l),h._isAlternateRenderingEnabled&&!u){var p=s.effect||this._effectiveMaterial.getEffect();if(!p||!h.activeCamera)return this;h._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(p),this._effectiveMaterial.bindViewProjection(p),d.setViewport(h.activeCamera._alternateCamera.viewport),this._draw(s,o,l,!0),d.setViewport(h.activeCamera.viewport),h._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(p),this._effectiveMaterial.bindViewProjection(p)}return this},n.prototype.registerBeforeRender=function(s){return this.onBeforeRenderObservable.add(s),this},n.prototype.unregisterBeforeRender=function(s){return this.onBeforeRenderObservable.removeCallback(s),this},n.prototype.registerAfterRender=function(s){return this.onAfterRenderObservable.add(s),this},n.prototype.unregisterAfterRender=function(s){return this.onAfterRenderObservable.removeCallback(s),this},n.prototype._getInstancesRenderList=function(s){var o=this.getScene(),l=this._instanceDataStorage.batchCache;if(l.mustReturn=!1,l.renderSelf[s]=this.isEnabled()&&this.isVisible,l.visibleInstances[s]=null,this._instanceDataStorage.visibleInstances){var u=this._instanceDataStorage.visibleInstances,h=o.getRenderId(),d=o._isInIntermediateRendering()?u.intermediateDefaultRenderId:u.defaultRenderId;l.visibleInstances[s]=u[h];var p=this._renderId;!l.visibleInstances[s]&&d&&(l.visibleInstances[s]=u[d],h=Math.max(d,h),p=Math.max(u.selfDefaultRenderId,h));var m=l.visibleInstances[s];if(m&&m.length){if(this._instanceDataStorage.renderIdForInstances[s]===h)return l.mustReturn=!0,l;h!==p&&(l.renderSelf[s]=!1)}this._instanceDataStorage.renderIdForInstances[s]=h}return l},n.prototype._renderWithInstances=function(s,o,l,u,h){var d=l.visibleInstances[s._id];if(!d)return this;for(var p=d.length+1,m=p*16*4,_=this._instanceDataStorage,v=_.instancesBufferSize,S=_.instancesBuffer;_.instancesBufferSize<m;)_.instancesBufferSize*=2;(!_.instancesData||v!=_.instancesBufferSize)&&(_.instancesData=new Float32Array(_.instancesBufferSize/4));var P=0,x=0,R=this.getWorldMatrix();if(l.renderSelf[s._id]&&(R.copyToArray(_.instancesData,P),P+=16,x++),d)for(var w=0;w<d.length;w++){var I=d[w];I.getWorldMatrix().copyToArray(_.instancesData,P),P+=16,x++}return!S||v!=_.instancesBufferSize?(S&&S.dispose(),S=new t.Buffer(h,_.instancesData,!0,16,!1,!0),_.instancesBuffer=S,this.setVerticesBuffer(S.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(S.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(S.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(S.createVertexBuffer("world3",12,4))):S.updateDirectly(_.instancesData,0,x),this._bind(s,u,o),this._draw(s,o,x),h.unbindInstanceAttributes(),this},n.prototype._processRendering=function(s,o,l,u,h,d,p){var m=this.getScene(),_=m.getEngine();if(h)this._renderWithInstances(s,l,u,o,_);else{u.renderSelf[s._id]&&(d&&d(!1,this.getWorldMatrix(),p),this._draw(s,l,this._instanceDataStorage.overridenInstanceCount));var v=u.visibleInstances[s._id];if(v)for(var S=0;S<v.length;S++){var P=v[S],x=P.getWorldMatrix();d&&d(!0,x,p),this._draw(s,l)}}return this},n.prototype.render=function(s,o){if(this._checkOcclusionQuery())return this;var l=this.getScene(),u=this._getInstancesRenderList(s._id);if(u.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var h=l.getEngine(),d=h.getCaps().instancedArrays&&u.visibleInstances[s._id]!==null&&u.visibleInstances[s._id]!==void 0,p=s.getMaterial();if(!p)return this;if(this._effectiveMaterial=p,this._effectiveMaterial.storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,s,d))return this}else if(!this._effectiveMaterial.isReady(this,d))return this;o&&h.setAlphaMode(this._effectiveMaterial.alphaMode);for(var m=0,_=l._beforeRenderingMeshStage;m<_.length;m++){var v=_[m];v.action(this,s,u)}var S;if(this._effectiveMaterial.storeEffectOnSubMeshes?S=s.effect:S=this._effectiveMaterial.getEffect(),!S)return this;var P=this.overrideMaterialSideOrientation;P==null&&(P=this._effectiveMaterial.sideOrientation,this._getWorldMatrixDeterminant()<0&&(P=P===t.Material.ClockWiseSideOrientation?t.Material.CounterClockWiseSideOrientation:t.Material.ClockWiseSideOrientation));var x=this._effectiveMaterial._preBind(S,P);this._effectiveMaterial.forceDepthWrite&&h.setDepthWrite(!0);var R=l.forcePointsCloud?t.Material.PointFillMode:l.forceWireframe?t.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;d||this._bind(s,S,R);var w=this.getWorldMatrix();this._effectiveMaterial.storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(w,this,s):this._effectiveMaterial.bind(w,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(h.setState(!0,this._effectiveMaterial.zOffset,!1,!x),this._processRendering(s,S,R,u,d,this._onBeforeDraw,this._effectiveMaterial),h.setState(!0,this._effectiveMaterial.zOffset,!1,x)),this._processRendering(s,S,R,u,d,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var I=0,F=l._afterRenderingMeshStage;I<F.length;I++){var v=F[I];v.action(this,s,u)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},n.prototype._onBeforeDraw=function(s,o,l){s&&l&&l.bindOnlyWorldMatrix(o)},n.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)&&(this.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},n.prototype.normalizeSkinFourWeights=function(){for(var s=this.getVerticesData(t.VertexBuffer.MatricesWeightsKind),o=s.length,l=0;l<o;l+=4){var u=s[l]+s[l+1]+s[l+2]+s[l+3];if(u===0)s[l]=1;else{var h=1/u;s[l]*=h,s[l+1]*=h,s[l+2]*=h,s[l+3]*=h}}this.setVerticesData(t.VertexBuffer.MatricesWeightsKind,s)},n.prototype.normalizeSkinWeightsAndExtra=function(){for(var s=this.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind),o=this.getVerticesData(t.VertexBuffer.MatricesWeightsKind),l=o.length,u=0;u<l;u+=4){var h=o[u]+o[u+1]+o[u+2]+o[u+3];if(h+=s[u]+s[u+1]+s[u+2]+s[u+3],h===0)o[u]=1;else{var d=1/h;o[u]*=d,o[u+1]*=d,o[u+2]*=d,o[u+3]*=d,s[u]*=d,s[u+1]*=d,s[u+2]*=d,s[u+3]*=d}}this.setVerticesData(t.VertexBuffer.MatricesWeightsKind,o),this.setVerticesData(t.VertexBuffer.MatricesWeightsKind,s)},n.prototype.validateSkinning=function(){var s=this.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind),o=this.getVerticesData(t.VertexBuffer.MatricesWeightsKind);if(o===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var l=o.length,u=0,h=0,d=0,p=0,m=s===null?4:8,_=new Array,v=0;v<=m;v++)_[v]=0;for(var S=.001,v=0;v<l;v+=4){for(var P=o[v],x=P,R=x===0?0:1,w=1;w<m;w++){var I=w<4?o[v+w]:s[v+w-4];I>P&&u++,I!==0&&R++,x+=I,P=I}if(_[R]++,R>d&&(d=R),x===0)h++;else{var F=1/x,k=0;for(w=0;w<m;w++)w<4?k+=Math.abs(o[v+w]-o[v+w]*F):k+=Math.abs(s[v+w-4]-s[v+w-4]*F);k>S&&p++}}for(var E=this.skeleton.bones.length,g=this.getVerticesData(t.VertexBuffer.MatricesIndicesKind),y=this.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind),M=0,v=0;v<l;v++)for(var w=0;w<m;w++){var C=w<4?g[w]:y[w-4];(C>=E||C<0)&&M++}var D="Number of Weights = "+l/4+`
Maximum influences = `+d+`
Missing Weights = `+h+`
Not Sorted = `+u+`
Not Normalized = `+p+`
WeightCounts = [`+_+`]
Number of bones = `+E+`
Bad Bone Indices = `+M;return{skinned:!0,valid:h===0&&p===0&&M===0,report:D}},n.prototype._checkDelayState=function(){var s=this.getScene();return this._geometry?this._geometry.load(s):this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(s)),this},n.prototype._queueLoad=function(s){var o=this;s._addPendingData(this);var l=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return t.Tools.LoadFile(this.delayLoadingFile,function(u){u instanceof ArrayBuffer?o._delayLoadingFunction(u,o):o._delayLoadingFunction(JSON.parse(u),o),o.instances.forEach(function(h){h._syncSubMeshes()}),o.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,s._removePendingData(o)},function(){},s.database,l),this},n.prototype.isInFrustum=function(s){return this.delayLoadState===t.Engine.DELAYLOADSTATE_LOADING||!a.prototype.isInFrustum.call(this,s)?!1:(this._checkDelayState(),!0)},n.prototype.setMaterialByID=function(s){var o=this.getScene().materials,l;for(l=o.length-1;l>-1;l--)if(o[l].id===s)return this.material=o[l],this;var u=this.getScene().multiMaterials;for(l=u.length-1;l>-1;l--)if(u[l].id===s)return this.material=u[l],this;return this},n.prototype.getAnimatables=function(){var s=new Array;return this.material&&s.push(this.material),this.skeleton&&s.push(this.skeleton),s},n.prototype.bakeTransformIntoVertices=function(s){if(!this.isVerticesDataPresent(t.VertexBuffer.PositionKind))return this;var o=this.subMeshes.splice(0);this._resetPointsArrayCache();var l=this.getVerticesData(t.VertexBuffer.PositionKind),u=new Array,h;for(h=0;h<l.length;h+=3)t.Vector3.TransformCoordinates(t.Vector3.FromArray(l,h),s).toArray(u,h);if(this.setVerticesData(t.VertexBuffer.PositionKind,u,this.getVertexBuffer(t.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(t.VertexBuffer.NormalKind)){for(l=this.getVerticesData(t.VertexBuffer.NormalKind),u=[],h=0;h<l.length;h+=3)t.Vector3.TransformNormal(t.Vector3.FromArray(l,h),s).normalize().toArray(u,h);this.setVerticesData(t.VertexBuffer.NormalKind,u,this.getVertexBuffer(t.VertexBuffer.NormalKind).isUpdatable())}return s.m[0]*s.m[5]*s.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=o,this},n.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=t.Quaternion.Identity()),this._worldMatrix=t.Matrix.Identity(),this},Object.defineProperty(n.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),n.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},n.prototype._generatePointsArray=function(){return this._geometry?this._geometry._generatePointsArray():!1},n.prototype.clone=function(s,o,l,u){return s===void 0&&(s=""),u===void 0&&(u=!0),new n(s,this.getScene(),o,this,l,u)},n.prototype.dispose=function(s,o){var l=this;o===void 0&&(o=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear();var u=this.getScene().meshes;for(u.forEach(function(h){var d=h;d._source&&d._source===l&&(d._source=null)}),this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();a.prototype.dispose.call(this,s,o)},n.prototype.applyDisplacementMap=function(s,o,l,u,h,d,p){var m=this;p===void 0&&(p=!1);var _=this.getScene(),v=function(S){var P=document.createElement("canvas"),x=P.getContext("2d"),R=S.width,w=S.height;P.width=R,P.height=w,x.drawImage(S,0,0);var I=x.getImageData(0,0,R,w).data;m.applyDisplacementMapFromBuffer(I,R,w,o,l,h,d,p),u&&u(m)};return t.Tools.LoadImage(s,v,function(){},_.database),this},n.prototype.applyDisplacementMapFromBuffer=function(s,o,l,u,h,d,p,m){if(m===void 0&&(m=!1),!this.isVerticesDataPresent(t.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(t.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(t.VertexBuffer.UVKind))return t.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var _=this.getVerticesData(t.VertexBuffer.PositionKind,!0,!0),v=this.getVerticesData(t.VertexBuffer.NormalKind),S=this.getVerticesData(t.VertexBuffer.UVKind),P=t.Vector3.Zero(),x=t.Vector3.Zero(),R=t.Vector2.Zero();d=d||t.Vector2.Zero(),p=p||new t.Vector2(1,1);for(var w=0;w<_.length;w+=3){t.Vector3.FromArrayToRef(_,w,P),t.Vector3.FromArrayToRef(v,w,x),t.Vector2.FromArrayToRef(S,w/3*2,R);var I=Math.abs(R.x*p.x+d.x)*o%o|0,F=Math.abs(R.y*p.y+d.y)*l%l|0,k=(I+F*o)*4,E=s[k]/255,g=s[k+1]/255,y=s[k+2]/255,M=E*.3+g*.59+y*.11;x.normalize(),x.scaleInPlace(u+(h-u)*M),P=P.add(x),P.toArray(_,w)}return t.VertexData.ComputeNormals(_,this.getIndices(),v),m?(this.setVerticesData(t.VertexBuffer.PositionKind,_),this.setVerticesData(t.VertexBuffer.NormalKind,v)):(this.updateVerticesData(t.VertexBuffer.PositionKind,_),this.updateVerticesData(t.VertexBuffer.NormalKind,v)),this},n.prototype.convertToFlatShadedMesh=function(){var s=this.getVerticesDataKinds(),o={},l={},u={},h=!1,d,p;for(d=0;d<s.length;d++){p=s[d];var m=this.getVertexBuffer(p);if(p===t.VertexBuffer.NormalKind){h=m.isUpdatable(),s.splice(d,1),d--;continue}o[p]=m,l[p]=o[p].getData(),u[p]=[]}var _=this.subMeshes.slice(0),v=this.getIndices(),S=this.getTotalIndices(),P;for(P=0;P<S;P++){var x=v[P];for(d=0;d<s.length;d++){p=s[d];for(var R=o[p].getStrideSize(),w=0;w<R;w++)u[p].push(l[p][x*R+w])}}var I=[],F=u[t.VertexBuffer.PositionKind];for(P=0;P<S;P+=3){v[P]=P,v[P+1]=P+1,v[P+2]=P+2;for(var k=t.Vector3.FromArray(F,P*3),E=t.Vector3.FromArray(F,(P+1)*3),g=t.Vector3.FromArray(F,(P+2)*3),y=k.subtract(E),M=g.subtract(E),C=t.Vector3.Normalize(t.Vector3.Cross(y,M)),D=0;D<3;D++)I.push(C.x),I.push(C.y),I.push(C.z)}for(this.setIndices(v),this.setVerticesData(t.VertexBuffer.NormalKind,I,h),d=0;d<s.length;d++)p=s[d],this.setVerticesData(p,u[p],o[p].isUpdatable());this.releaseSubMeshes();for(var V=0;V<_.length;V++){var G=_[V];t.SubMesh.AddToMesh(G.materialIndex,G.indexStart,G.indexCount,G.indexStart,G.indexCount,this)}return this.synchronizeInstances(),this},n.prototype.convertToUnIndexedMesh=function(){var s=this.getVerticesDataKinds(),o={},l={},u={},h,d;for(h=0;h<s.length;h++){d=s[h];var p=this.getVertexBuffer(d);o[d]=p,l[d]=o[d].getData(),u[d]=[]}var m=this.subMeshes.slice(0),_=this.getIndices(),v=this.getTotalIndices(),S;for(S=0;S<v;S++){var P=_[S];for(h=0;h<s.length;h++){d=s[h];for(var x=o[d].getStrideSize(),R=0;R<x;R++)u[d].push(l[d][P*x+R])}}for(S=0;S<v;S+=3)_[S]=S,_[S+1]=S+1,_[S+2]=S+2;for(this.setIndices(_),h=0;h<s.length;h++)d=s[h],this.setVerticesData(d,u[d],o[d].isUpdatable());this.releaseSubMeshes();for(var w=0;w<m.length;w++){var I=m[w];t.SubMesh.AddToMesh(I.materialIndex,I.indexStart,I.indexCount,I.indexStart,I.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},n.prototype.flipFaces=function(s){s===void 0&&(s=!1);var o=t.VertexData.ExtractFromMesh(this),l;if(s&&this.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&o.normals)for(l=0;l<o.normals.length;l++)o.normals[l]*=-1;if(o.indices){var u;for(l=0;l<o.indices.length;l+=3)u=o.indices[l+1],o.indices[l+1]=o.indices[l+2],o.indices[l+2]=u}return o.applyToMesh(this),this},n.prototype.createInstance=function(s){return new t.InstancedMesh(s,this)},n.prototype.synchronizeInstances=function(){for(var s=0;s<this.instances.length;s++){var o=this.instances[s];o._syncSubMeshes()}return this},n.prototype.optimizeIndices=function(s){var o=this,l=this.getIndices(),u=this.getVerticesData(t.VertexBuffer.PositionKind);if(!u||!l)return this;for(var h=new Array,d=0;d<u.length;d=d+3)h.push(t.Vector3.FromArray(u,d));var p=new Array;return t.AsyncLoop.SyncAsyncForLoop(h.length,40,function(m){for(var _=h.length-1-m,v=h[_],S=0;S<_;++S){var P=h[S];if(v.equals(P)){p[_]=S;break}}},function(){for(var m=0;m<l.length;++m)l[m]=p[l[m]]||l[m];var _=o.subMeshes.slice(0);o.setIndices(l),o.subMeshes=_,s&&s(o)}),this},n.prototype.serialize=function(s){s.name=this.name,s.id=this.id,s.type=this.getClassName(),t.Tags&&t.Tags.HasTags(this)&&(s.tags=t.Tags.GetTags(this)),s.position=this.position.asArray(),this.rotationQuaternion?s.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(s.rotation=this.rotation.asArray()),s.scaling=this.scaling.asArray(),s.localMatrix=this.getPivotMatrix().asArray(),s.isEnabled=this.isEnabled(!1),s.isVisible=this.isVisible,s.infiniteDistance=this.infiniteDistance,s.pickable=this.isPickable,s.receiveShadows=this.receiveShadows,s.billboardMode=this.billboardMode,s.visibility=this.visibility,s.checkCollisions=this.checkCollisions,s.isBlocker=this.isBlocker,this.parent&&(s.parentId=this.parent.id),s.isUnIndexed=this.isUnIndexed;var o=this._geometry;if(o){var l=o.id;s.geometryId=l,s.subMeshes=[];for(var u=0;u<this.subMeshes.length;u++){var h=this.subMeshes[u];s.subMeshes.push({materialIndex:h.materialIndex,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount})}}this.material?s.materialId=this.material.id:this.material=null,this.morphTargetManager&&(s.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(s.skeletonId=this.skeleton.id);var d=this.getPhysicsImpostor();d&&(s.physicsMass=d.getParam("mass"),s.physicsFriction=d.getParam("friction"),s.physicsRestitution=d.getParam("mass"),s.physicsImpostor=d.type),this.metadata&&(s.metadata=this.metadata),s.instances=[];for(var p=0;p<this.instances.length;p++){var m=this.instances[p];if(!m.doNotSerialize){var _={name:m.name,id:m.id,position:m.position.asArray(),scaling:m.scaling.asArray()};m.parent&&(_.parentId=m.parent.id),m.rotationQuaternion?_.rotationQuaternion=m.rotationQuaternion.asArray():m.rotation&&(_.rotation=m.rotation.asArray()),s.instances.push(_),t.Animation.AppendSerializedAnimations(m,_),_.ranges=m.serializeAnimationRanges()}}t.Animation.AppendSerializedAnimations(this,s),s.ranges=this.serializeAnimationRanges(),s.layerMask=this.layerMask,s.alphaIndex=this.alphaIndex,s.hasVertexAlpha=this.hasVertexAlpha,s.overlayAlpha=this.overlayAlpha,s.overlayColor=this.overlayColor.asArray(),s.renderOverlay=this.renderOverlay,s.applyFog=this.applyFog,this.actionManager&&(s.actions=this.actionManager.serialize(this.name))},n.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var s=this._morphTargetManager;if(s&&s.vertexCount){if(s.vertexCount!==this.getTotalVertices()){t.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}for(var o=0;o<s.numInfluencers;o++){var l=s.getActiveTarget(o),u=l.getPositions();if(!u){t.Tools.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(t.VertexBuffer.PositionKind+o,u,!1,3);var h=l.getNormals();h&&this.geometry.setVerticesData(t.VertexBuffer.NormalKind+o,h,!1,3);var d=l.getTangents();d&&this.geometry.setVerticesData(t.VertexBuffer.TangentKind+o,d,!1,3)}}else for(var o=0;this.geometry.isVerticesDataPresent(t.VertexBuffer.PositionKind+o);)this.geometry.removeVerticesData(t.VertexBuffer.PositionKind+o),this.geometry.isVerticesDataPresent(t.VertexBuffer.NormalKind+o)&&this.geometry.removeVerticesData(t.VertexBuffer.NormalKind+o),this.geometry.isVerticesDataPresent(t.VertexBuffer.TangentKind+o)&&this.geometry.removeVerticesData(t.VertexBuffer.TangentKind+o),o++}},n.Parse=function(s,o,l){var u;if(s.type&&s.type==="GroundMesh"?u=t.GroundMesh.Parse(s,o):u=new n(s.name,o),u.id=s.id,t.Tags&&t.Tags.AddTagsTo(u,s.tags),u.position=t.Vector3.FromArray(s.position),s.metadata!==void 0&&(u.metadata=s.metadata),s.rotationQuaternion?u.rotationQuaternion=t.Quaternion.FromArray(s.rotationQuaternion):s.rotation&&(u.rotation=t.Vector3.FromArray(s.rotation)),u.scaling=t.Vector3.FromArray(s.scaling),s.localMatrix?u.setPreTransformMatrix(t.Matrix.FromArray(s.localMatrix)):s.pivotMatrix&&u.setPivotMatrix(t.Matrix.FromArray(s.pivotMatrix)),u.setEnabled(s.isEnabled),u.isVisible=s.isVisible,u.infiniteDistance=s.infiniteDistance,u.showBoundingBox=s.showBoundingBox,u.showSubMeshesBoundingBox=s.showSubMeshesBoundingBox,s.applyFog!==void 0&&(u.applyFog=s.applyFog),s.pickable!==void 0&&(u.isPickable=s.pickable),s.alphaIndex!==void 0&&(u.alphaIndex=s.alphaIndex),u.receiveShadows=s.receiveShadows,u.billboardMode=s.billboardMode,s.visibility!==void 0&&(u.visibility=s.visibility),u.checkCollisions=s.checkCollisions,s.isBlocker!==void 0&&(u.isBlocker=s.isBlocker),u._shouldGenerateFlatShading=s.useFlatShading,s.freezeWorldMatrix&&(u._waitingFreezeWorldMatrix=s.freezeWorldMatrix),s.parentId&&(u._waitingParentId=s.parentId),s.actions!==void 0&&(u._waitingActions=s.actions),s.overlayAlpha!==void 0&&(u.overlayAlpha=s.overlayAlpha),s.overlayColor!==void 0&&(u.overlayColor=t.Color3.FromArray(s.overlayColor)),s.renderOverlay!==void 0&&(u.renderOverlay=s.renderOverlay),u.isUnIndexed=!!s.isUnIndexed,u.hasVertexAlpha=s.hasVertexAlpha,s.delayLoadingFile?(u.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED,u.delayLoadingFile=l+s.delayLoadingFile,u._boundingInfo=new t.BoundingInfo(t.Vector3.FromArray(s.boundingBoxMinimum),t.Vector3.FromArray(s.boundingBoxMaximum)),s._binaryInfo&&(u._binaryInfo=s._binaryInfo),u._delayInfo=[],s.hasUVs&&u._delayInfo.push(t.VertexBuffer.UVKind),s.hasUVs2&&u._delayInfo.push(t.VertexBuffer.UV2Kind),s.hasUVs3&&u._delayInfo.push(t.VertexBuffer.UV3Kind),s.hasUVs4&&u._delayInfo.push(t.VertexBuffer.UV4Kind),s.hasUVs5&&u._delayInfo.push(t.VertexBuffer.UV5Kind),s.hasUVs6&&u._delayInfo.push(t.VertexBuffer.UV6Kind),s.hasColors&&u._delayInfo.push(t.VertexBuffer.ColorKind),s.hasMatricesIndices&&u._delayInfo.push(t.VertexBuffer.MatricesIndicesKind),s.hasMatricesWeights&&u._delayInfo.push(t.VertexBuffer.MatricesWeightsKind),u._delayLoadingFunction=t.Geometry._ImportGeometry,t.SceneLoader.ForceFullSceneLoadingForIncremental&&u._checkDelayState()):t.Geometry._ImportGeometry(s,u),s.materialId?u.setMaterialByID(s.materialId):u.material=null,s.morphTargetManagerId>-1&&(u.morphTargetManager=o.getMorphTargetManagerById(s.morphTargetManagerId)),s.skeletonId>-1&&(u.skeleton=o.getLastSkeletonByID(s.skeletonId),s.numBoneInfluencers&&(u.numBoneInfluencers=s.numBoneInfluencers)),s.animations){for(var h=0;h<s.animations.length;h++){var d=s.animations[h];u.animations.push(t.Animation.Parse(d))}t.Node.ParseAnimationRanges(u,s,o)}if(s.autoAnimate&&o.beginAnimation(u,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),s.layerMask&&!isNaN(s.layerMask)?u.layerMask=Math.abs(parseInt(s.layerMask)):u.layerMask=268435455,s.physicsImpostor&&(u.physicsImpostor=new t.PhysicsImpostor(u,s.physicsImpostor,{mass:s.physicsMass,friction:s.physicsFriction,restitution:s.physicsRestitution},o)),s.instances)for(var p=0;p<s.instances.length;p++){var m=s.instances[p],_=u.createInstance(m.name);if(m.id&&(_.id=m.id),t.Tags&&(m.tags?t.Tags.AddTagsTo(_,m.tags):t.Tags.AddTagsTo(_,s.tags)),_.position=t.Vector3.FromArray(m.position),m.parentId&&(_._waitingParentId=m.parentId),m.rotationQuaternion?_.rotationQuaternion=t.Quaternion.FromArray(m.rotationQuaternion):m.rotation&&(_.rotation=t.Vector3.FromArray(m.rotation)),_.scaling=t.Vector3.FromArray(m.scaling),m.checkCollisions!=null&&m.checkCollisions!=null&&(_.checkCollisions=m.checkCollisions),m.pickable!=null&&m.pickable!=null&&(_.isPickable=m.pickable),m.showBoundingBox!=null&&m.showBoundingBox!=null&&(_.showBoundingBox=m.showBoundingBox),m.showSubMeshesBoundingBox!=null&&m.showSubMeshesBoundingBox!=null&&(_.showSubMeshesBoundingBox=m.showSubMeshesBoundingBox),m.alphaIndex!=null&&m.showSubMeshesBoundingBox!=null&&(_.alphaIndex=m.alphaIndex),m.physicsImpostor&&(_.physicsImpostor=new t.PhysicsImpostor(_,m.physicsImpostor,{mass:m.physicsMass,friction:m.physicsFriction,restitution:m.physicsRestitution},o)),m.animations){for(h=0;h<m.animations.length;h++)d=m.animations[h],_.animations.push(t.Animation.Parse(d));t.Node.ParseAnimationRanges(_,m,o),m.autoAnimate&&o.beginAnimation(_,m.autoAnimateFrom,m.autoAnimateTo,m.autoAnimateLoop,m.autoAnimateSpeed||1)}}return u},n.CreateRibbon=function(s,o,l,u,h,d,p,m,_){return l===void 0&&(l=!1),p===void 0&&(p=!1),t.MeshBuilder.CreateRibbon(s,{pathArray:o,closeArray:l,closePath:u,offset:h,updatable:p,sideOrientation:m,instance:_},d)},n.CreateDisc=function(s,o,l,u,h,d){u===void 0&&(u=null);var p={radius:o,tessellation:l,sideOrientation:d,updatable:h};return t.MeshBuilder.CreateDisc(s,p,u)},n.CreateBox=function(s,o,l,u,h){l===void 0&&(l=null);var d={size:o,sideOrientation:h,updatable:u};return t.MeshBuilder.CreateBox(s,d,l)},n.CreateSphere=function(s,o,l,u,h,d){var p={segments:o,diameterX:l,diameterY:l,diameterZ:l,sideOrientation:d,updatable:h};return t.MeshBuilder.CreateSphere(s,p,u)},n.CreateCylinder=function(s,o,l,u,h,d,p,m,_){(p===void 0||!(p instanceof t.Scene))&&(p!==void 0&&(_=m||n.DEFAULTSIDE,m=p),p=d,d=1);var v={height:o,diameterTop:l,diameterBottom:u,tessellation:h,subdivisions:d,sideOrientation:_,updatable:m};return t.MeshBuilder.CreateCylinder(s,v,p)},n.CreateTorus=function(s,o,l,u,h,d,p){var m={diameter:o,thickness:l,tessellation:u,sideOrientation:p,updatable:d};return t.MeshBuilder.CreateTorus(s,m,h)},n.CreateTorusKnot=function(s,o,l,u,h,d,p,m,_,v){var S={radius:o,tube:l,radialSegments:u,tubularSegments:h,p:d,q:p,sideOrientation:v,updatable:_};return t.MeshBuilder.CreateTorusKnot(s,S,m)},n.CreateLines=function(s,o,l,u,h){l===void 0&&(l=null),u===void 0&&(u=!1),h===void 0&&(h=null);var d={points:o,updatable:u,instance:h};return t.MeshBuilder.CreateLines(s,d,l)},n.CreateDashedLines=function(s,o,l,u,h,d,p,m){d===void 0&&(d=null);var _={points:o,dashSize:l,gapSize:u,dashNb:h,updatable:p,instance:m};return t.MeshBuilder.CreateDashedLines(s,_,d)},n.CreatePolygon=function(s,o,l,u,h,d){var p={shape:o,holes:u,updatable:h,sideOrientation:d};return t.MeshBuilder.CreatePolygon(s,p,l)},n.ExtrudePolygon=function(s,o,l,u,h,d,p){var m={shape:o,holes:h,depth:l,updatable:d,sideOrientation:p};return t.MeshBuilder.ExtrudePolygon(s,m,u)},n.ExtrudeShape=function(s,o,l,u,h,d,p,m,_,v){p===void 0&&(p=null);var S={shape:o,path:l,scale:u,rotation:h,cap:d===0?0:d||n.NO_CAP,sideOrientation:_,instance:v,updatable:m};return t.MeshBuilder.ExtrudeShape(s,S,p)},n.ExtrudeShapeCustom=function(s,o,l,u,h,d,p,m,_,v,S,P){var x={shape:o,path:l,scaleFunction:u,rotationFunction:h,ribbonCloseArray:d,ribbonClosePath:p,cap:m===0?0:m||n.NO_CAP,sideOrientation:S,instance:P,updatable:v};return t.MeshBuilder.ExtrudeShapeCustom(s,x,_)},n.CreateLathe=function(s,o,l,u,h,d,p){var m={shape:o,radius:l,tessellation:u,sideOrientation:p,updatable:d};return t.MeshBuilder.CreateLathe(s,m,h)},n.CreatePlane=function(s,o,l,u,h){var d={size:o,width:o,height:o,sideOrientation:h,updatable:u};return t.MeshBuilder.CreatePlane(s,d,l)},n.CreateGround=function(s,o,l,u,h,d){var p={width:o,height:l,subdivisions:u,updatable:d};return t.MeshBuilder.CreateGround(s,p,h)},n.CreateTiledGround=function(s,o,l,u,h,d,p,m,_){var v={xmin:o,zmin:l,xmax:u,zmax:h,subdivisions:d,precision:p,updatable:_};return t.MeshBuilder.CreateTiledGround(s,v,m)},n.CreateGroundFromHeightMap=function(s,o,l,u,h,d,p,m,_,v,S){var P={width:l,height:u,subdivisions:h,minHeight:d,maxHeight:p,updatable:_,onReady:v,alphaFilter:S};return t.MeshBuilder.CreateGroundFromHeightMap(s,o,P,m)},n.CreateTube=function(s,o,l,u,h,d,p,m,_,v){var S={path:o,radius:l,tessellation:u,radiusFunction:h,arc:1,cap:d,updatable:m,sideOrientation:_,instance:v};return t.MeshBuilder.CreateTube(s,S,p)},n.CreatePolyhedron=function(s,o,l){return t.MeshBuilder.CreatePolyhedron(s,o,l)},n.CreateIcoSphere=function(s,o,l){return t.MeshBuilder.CreateIcoSphere(s,o,l)},n.CreateDecal=function(s,o,l,u,h,d){var p={position:l,normal:u,size:h,angle:d};return t.MeshBuilder.CreateDecal(s,o,p)},n.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var s=this.getVerticesData(t.VertexBuffer.PositionKind);if(!s)return this._sourcePositions;this._sourcePositions=new Float32Array(s),this.isVertexBufferUpdatable(t.VertexBuffer.PositionKind)||this.setVerticesData(t.VertexBuffer.PositionKind,s,!0)}return this._sourcePositions},n.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var s=this.getVerticesData(t.VertexBuffer.NormalKind);if(!s)return this._sourceNormals;this._sourceNormals=new Float32Array(s),this.isVertexBufferUpdatable(t.VertexBuffer.NormalKind)||this.setVerticesData(t.VertexBuffer.NormalKind,s,!0)}return this._sourceNormals},n.prototype.applySkeleton=function(s){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(t.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(t.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var o=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=o}this._sourceNormals||this.setNormalsForCPUSkinning();var l=this.getVerticesData(t.VertexBuffer.PositionKind);if(!l)return this;l instanceof Float32Array||(l=new Float32Array(l));var u=this.getVerticesData(t.VertexBuffer.NormalKind);if(!u)return this;u instanceof Float32Array||(u=new Float32Array(u));var h=this.getVerticesData(t.VertexBuffer.MatricesIndicesKind),d=this.getVerticesData(t.VertexBuffer.MatricesWeightsKind);if(!d||!h)return this;for(var p=this.numBoneInfluencers>4,m=p?this.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind):null,_=p?this.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind):null,v=s.getTransformMatrices(this),S=t.Vector3.Zero(),P=new t.Matrix,x=new t.Matrix,R=0,w,I=0;I<l.length;I+=3,R+=4){var F;for(w=0;w<4;w++)F=d[R+w],F>0&&(t.Matrix.FromFloat32ArrayToRefScaled(v,Math.floor(h[R+w]*16),F,x),P.addToSelf(x));if(p)for(w=0;w<4;w++)F=_[R+w],F>0&&(t.Matrix.FromFloat32ArrayToRefScaled(v,Math.floor(m[R+w]*16),F,x),P.addToSelf(x));t.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[I],this._sourcePositions[I+1],this._sourcePositions[I+2],P,S),S.toArray(l,I),t.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[I],this._sourceNormals[I+1],this._sourceNormals[I+2],P,S),S.toArray(u,I),P.reset()}return this.updateVerticesData(t.VertexBuffer.PositionKind,l),this.updateVerticesData(t.VertexBuffer.NormalKind,u),this},n.MinMax=function(s){var o=null,l=null;return s.forEach(function(u,h,d){var p=u.getBoundingInfo(),m=p.boundingBox;!o||!l?(o=m.minimumWorld,l=m.maximumWorld):(o.minimizeInPlace(m.minimumWorld),l.maximizeInPlace(m.maximumWorld))}),!o||!l?{min:t.Vector3.Zero(),max:t.Vector3.Zero()}:{min:o,max:l}},n.Center=function(s){var o=s instanceof Array?n.MinMax(s):s;return t.Vector3.Center(o.min,o.max)},n.MergeMeshes=function(s,o,l,u,h){o===void 0&&(o=!0);var d;if(!l){var p=0;for(d=0;d<s.length;d++)if(s[d]&&(p+=s[d].getTotalVertices(),p>65536))return t.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var m=null,_,v=new Array,S=null;for(d=0;d<s.length;d++)if(s[d]){var P=s[d].computeWorldMatrix(!0);_=t.VertexData.ExtractFromMesh(s[d],!0,!0),_.transform(P),m?m.merge(_,l):(m=_,S=s[d]),h&&v.push(s[d].getTotalIndices())}if(S=S,u||(u=new n(S.name+"_merged",S.getScene())),m.applyToMesh(u),u.material=S.material,u.checkCollisions=S.checkCollisions,o)for(d=0;d<s.length;d++)s[d]&&s[d].dispose();if(h){u.releaseSubMeshes(),d=0;for(var x=0;d<v.length;)t.SubMesh.CreateFromIndices(0,x,v[d],u),x+=v[d],d++}return u},n.FRONTSIDE=0,n.BACKSIDE=1,n.DOUBLESIDE=2,n.DEFAULTSIDE=0,n.NO_CAP=0,n.CAP_START=1,n.CAP_END=2,n.CAP_ALL=3,n}(t.AbstractMesh);t.Mesh=i})(T||(T={}));var T;(function(t){var f=function(){function r(){}return Object.defineProperty(r.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),r.prototype.setEffect=function(i,a){if(a===void 0&&(a=null),this._materialEffect===i){i||(this._materialDefines=null);return}this._materialDefines=a,this._materialEffect=i},r}();t.BaseSubMesh=f;var c=function(r){N(i,r);function i(a,n,s,o,l,u,h,d){d===void 0&&(d=!0);var p=r.call(this)||this;return p.materialIndex=a,p.verticesStart=n,p.verticesCount=s,p.indexStart=o,p.indexCount=l,p._renderId=0,p._mesh=u,p._renderingMesh=h||u,u.subMeshes.push(p),p._trianglePlanes=[],p._id=u.subMeshes.length-1,d&&(p.refreshBoundingInfo(),u.computeWorldMatrix(!0)),p}return i.AddToMesh=function(a,n,s,o,l,u,h,d){return d===void 0&&(d=!0),new i(a,n,s,o,l,u,h,d)},Object.defineProperty(i.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),i.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},i.prototype.setBoundingInfo=function(a){return this._boundingInfo=a,this},i.prototype.getMesh=function(){return this._mesh},i.prototype.getRenderingMesh=function(){return this._renderingMesh},i.prototype.getMaterial=function(){var a=this._renderingMesh.material;if(a==null)return this._mesh.getScene().defaultMaterial;if(a.getSubMaterial){var n=a,s=n.getSubMaterial(this.materialIndex);return this._currentMaterial!==s&&(this._currentMaterial=s,this._materialDefines=null),s}return a},i.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var a=this._renderingMesh.getVerticesData(t.VertexBuffer.PositionKind);if(!a)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var n=this._renderingMesh.getIndices(),s;if(this.indexStart===0&&this.indexCount===n.length){var o=this._renderingMesh.getBoundingInfo();s={minimum:o.minimum.clone(),maximum:o.maximum.clone()}}else s=t.Tools.ExtractMinAndMaxIndexed(a,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo=new t.BoundingInfo(s.minimum,s.maximum),this},i.prototype._checkCollision=function(a){var n=this.getBoundingInfo();return n._checkCollision(a)},i.prototype.updateBoundingInfo=function(a){var n=this.getBoundingInfo();return n||(this.refreshBoundingInfo(),n=this.getBoundingInfo()),n.update(a),this},i.prototype.isInFrustum=function(a){var n=this.getBoundingInfo();return n?n.isInFrustum(a,this._mesh.cullingStrategy):!1},i.prototype.isCompletelyInFrustum=function(a){var n=this.getBoundingInfo();return n?n.isCompletelyInFrustum(a):!1},i.prototype.render=function(a){return this._renderingMesh.render(this,a),this},i.prototype._getLinesIndexBuffer=function(a,n){if(!this._linesIndexBuffer){for(var s=[],o=this.indexStart;o<this.indexStart+this.indexCount;o+=3)s.push(a[o],a[o+1],a[o+1],a[o+2],a[o+2],a[o]);this._linesIndexBuffer=n.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer},i.prototype.canIntersects=function(a){var n=this.getBoundingInfo();return n?a.intersectsBox(n.boundingBox):!1},i.prototype.intersects=function(a,n,s,o){var l=this.getMaterial();if(!l)return null;switch(l.fillMode){case t.Material.PointListDrawMode:case t.Material.LineListDrawMode:case t.Material.LineLoopDrawMode:case t.Material.LineStripDrawMode:case t.Material.TriangleFanDrawMode:case t.Material.TriangleStripDrawMode:return null}if(t.LinesMesh){var u=this._mesh instanceof t.InstancedMesh?this._mesh.sourceMesh:this._mesh;if(u instanceof t.LinesMesh){var h=u;return this._intersectLines(a,n,s,h.intersectionThreshold,o)}}return this._intersectTriangles(a,n,s,o)},i.prototype._intersectLines=function(a,n,s,o,l){for(var u=null,h=this.indexStart;h<this.indexStart+this.indexCount;h+=2){var d=n[s[h]],p=n[s[h+1]],m=a.intersectionSegment(d,p,o);if(!(m<0)&&(l||!u||m<u.distance)&&(u=new t.IntersectionInfo(null,null,m),l))break}return u},i.prototype._intersectTriangles=function(a,n,s,o){for(var l=null,u=this.indexStart;u<this.indexStart+this.indexCount;u+=3){var h=n[s[u]],d=n[s[u+1]],p=n[s[u+2]],m=a.intersectsTriangle(h,d,p);if(m){if(m.distance<0)continue;if((o||!l||m.distance<l.distance)&&(l=m,l.faceId=u/3,o))break}}return l},i.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},i.prototype.clone=function(a,n){var s=new i(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,a,n,!1);if(!this.IsGlobal){var o=this.getBoundingInfo();if(!o)return s;s._boundingInfo=new t.BoundingInfo(o.minimum,o.maximum)}return s},i.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var a=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(a,1)},i.CreateFromIndices=function(a,n,s,o,l){var u=Number.MAX_VALUE,h=-Number.MAX_VALUE;l=l||o;for(var d=l.getIndices(),p=n;p<n+s;p++){var m=d[p];m<u&&(u=m),m>h&&(h=m)}return new i(a,u,h-u+1,n,s,o,l)},i}(f);t.SubMesh=c})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function r(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),r.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},r.prototype.markAsUnprocessed=function(){this._isDirty=!0},r.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},r.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},r.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},r.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},r.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},r.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var i=0,a=Object.keys(this);i<a.length;i++){var n=a[i];n[0]!=="_"&&this._keys.push(n)}},r.prototype.isEqual=function(i){if(this._keys.length!==i._keys.length)return!1;for(var a=0;a<this._keys.length;a++){var n=this._keys[a];if(this[n]!==i[n])return!1}return!0},r.prototype.cloneTo=function(i){this._keys.length!==i._keys.length&&(i._keys=this._keys.slice(0));for(var a=0;a<this._keys.length;a++){var n=this._keys[a];i[n]=this[n]}},r.prototype.reset=function(){for(var i=0;i<this._keys.length;i++){var a=this._keys[i],n=typeof this[a];switch(n){case"number":this[a]=0;break;case"string":this[a]="";break;default:this[a]=!1;break}}},r.prototype.toString=function(){for(var i="",a=0;a<this._keys.length;a++){var n=this._keys[a],s=this[n],o=typeof s;switch(o){case"number":case"string":i+="#define "+n+" "+s+`
`;break;default:s&&(i+="#define "+n+`
`);break}}return i},r}();t.MaterialDefines=f;var c=function(){function r(i,a,n){this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.doNotSerialize=!1,this.storeEffectOnSubMeshes=!1,this.onDisposeObservable=new t.Observable,this._alphaMode=t.Engine.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=r.TriangleFillMode,this.name=i,this.id=i||t.Tools.RandomId(),this._scene=a||t.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=r.ClockWiseSideOrientation:this.sideOrientation=r.CounterClockWiseSideOrientation,this._uniformBuffer=new t.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||(this._scene.materials.push(this),this._scene.onNewMaterialAddedObservable.notifyObservers(this))}return Object.defineProperty(r,"TriangleFillMode",{get:function(){return r._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WireFrameFillMode",{get:function(){return r._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PointFillMode",{get:function(){return r._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"PointListDrawMode",{get:function(){return r._PointListDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LineListDrawMode",{get:function(){return r._LineListDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LineLoopDrawMode",{get:function(){return r._LineLoopDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LineStripDrawMode",{get:function(){return r._LineStripDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"TriangleStripDrawMode",{get:function(){return r._TriangleStripDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"TriangleFanDrawMode",{get:function(){return r._TriangleFanDrawMode},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ClockWiseSideOrientation",{get:function(){return r._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(r,"CounterClockWiseSideOrientation",{get:function(){return r._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(i){this._alpha!==i&&(this._alpha=i,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(i){this._backFaceCulling!==i&&(this._backFaceCulling=i,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onDispose",{set:function(i){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new t.Observable),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBind",{set:function(i){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new t.Observable),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(i){this._alphaMode!==i&&(this._alphaMode=i,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(i){this._needDepthPrePass!==i&&(this._needDepthPrePass=i,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(i){this._fogEnabled!==i&&(this._fogEnabled=i,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wireframe",{get:function(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(i){this.fillMode=i?r.WireFrameFillMode:r.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(i){this.fillMode=i?r.PointFillMode:r.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillMode",{get:function(){return this._fillMode},set:function(i){this._fillMode!==i&&(this._fillMode=i,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!0,configurable:!0}),r.prototype.toString=function(i){var a="Name: "+this.name;return a},r.prototype.getClassName=function(){return"Material"},Object.defineProperty(r.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),r.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},r.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},r.prototype.isReady=function(i,a){return!0},r.prototype.isReadyForSubMesh=function(i,a,n){return!1},r.prototype.getEffect=function(){return this._effect},r.prototype.getScene=function(){return this._scene},r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaBlendingForMesh=function(i){return this.needAlphaBlending()||i.visibility<1||i.hasVertexAlpha},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.markDirty=function(){this._wasPreviouslyReady=!1},r.prototype._preBind=function(i,a){a===void 0&&(a=null);var n=this._scene.getEngine(),s=a??this.sideOrientation,o=s===r.ClockWiseSideOrientation;return n.enableEffect(i||this._effect),n.setState(this.backFaceCulling,this.zOffset,!1,o),o},r.prototype.bind=function(i,a){},r.prototype.bindForSubMesh=function(i,a,n){},r.prototype.bindOnlyWorldMatrix=function(i){},r.prototype.bindSceneUniformBuffer=function(i,a){a.bindToEffect(i,"Scene")},r.prototype.bindView=function(i){this._useUBO?this.bindSceneUniformBuffer(i,this.getScene().getSceneUniformBuffer()):i.setMatrix("view",this.getScene().getViewMatrix())},r.prototype.bindViewProjection=function(i){this._useUBO?this.bindSceneUniformBuffer(i,this.getScene().getSceneUniformBuffer()):i.setMatrix("viewProjection",this.getScene().getTransformMatrix())},r.prototype._shouldTurnAlphaTestOn=function(i){return!this.needAlphaBlendingForMesh(i)&&this.needAlphaTesting()},r.prototype._afterBind=function(i){if(this._scene._cachedMaterial=this,i?this._scene._cachedVisibility=i.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&i&&this._onBindObservable.notifyObservers(i),this.disableDepthWrite){var a=this._scene.getEngine();this._cachedDepthWriteState=a.getDepthWrite(),a.setDepthWrite(!1)}},r.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite){var i=this._scene.getEngine();i.setDepthWrite(this._cachedDepthWriteState)}},r.prototype.getActiveTextures=function(){return[]},r.prototype.hasTexture=function(i){return!1},r.prototype.clone=function(i){return null},r.prototype.getBindedMeshes=function(){for(var i=new Array,a=0;a<this._scene.meshes.length;a++){var n=this._scene.meshes[a];n.material===this&&i.push(n)}return i},r.prototype.forceCompilation=function(i,a,n){var s=this,o=Ve({clipPlane:!1},n),l=new t.BaseSubMesh,u=this.getScene(),h=function(){if(!(!s._scene||!s._scene.getEngine())){l._materialDefines&&(l._materialDefines._renderId=-1);var d=u.clipPlane;o.clipPlane&&(u.clipPlane=new t.Plane(0,0,0,1)),s.storeEffectOnSubMeshes?s.isReadyForSubMesh(i,l)?a&&a(s):setTimeout(h,16):s.isReady(i)?a&&a(s):setTimeout(h,16),o.clipPlane&&(u.clipPlane=d)}};h()},r.prototype.forceCompilationAsync=function(i,a){var n=this;return new Promise(function(s){n.forceCompilation(i,function(){s()},a)})},r.prototype.markAsDirty=function(i){i&r.TextureDirtyFlag&&this._markAllSubMeshesAsTexturesDirty(),i&r.LightDirtyFlag&&this._markAllSubMeshesAsLightsDirty(),i&r.FresnelDirtyFlag&&this._markAllSubMeshesAsFresnelDirty(),i&r.AttributesDirtyFlag&&this._markAllSubMeshesAsAttributesDirty(),i&r.MiscDirtyFlag&&this._markAllSubMeshesAsMiscDirty(),this.getScene().resetCachedMaterial()},r.prototype._markAllSubMeshesAsDirty=function(i){for(var a=0,n=this.getScene().meshes;a<n.length;a++){var s=n[a];if(s.subMeshes)for(var o=0,l=s.subMeshes;o<l.length;o++){var u=l[o];u.getMaterial()===this&&u._materialDefines&&i(u._materialDefines)}}},r.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsImageProcessingDirty()})},r.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsTexturesDirty()})},r.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsFresnelDirty()})},r.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(function(i){i.markAsFresnelDirty(),i.markAsMiscDirty()})},r.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsLightDirty()})},r.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsAttributesDirty()})},r.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(function(i){return i.markAsMiscDirty()})},r.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(function(i){i.markAsTexturesDirty(),i.markAsMiscDirty()})},r.prototype.dispose=function(i,a){this.getScene().stopAnimation(this),this.getScene().freeProcessedMaterials();var n=this._scene.materials.indexOf(this);for(n>=0&&this._scene.materials.splice(n,1),this._scene.onMaterialRemovedObservable.notifyObservers(this),n=0;n<this._scene.meshes.length;n++){var s=this._scene.meshes[n];if(s.material===this&&(s.material=null,s.geometry)){var o=s.geometry;if(this.storeEffectOnSubMeshes)for(var l=0,u=s.subMeshes;l<u.length;l++){var h=u[l];o._releaseVertexArrayObject(h._materialEffect),i&&h._materialEffect&&this._scene.getEngine()._releaseEffect(h._materialEffect)}else o._releaseVertexArrayObject(this._effect)}}this._uniformBuffer.dispose(),i&&this._effect&&(this.storeEffectOnSubMeshes||this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},r.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},r.ParseMultiMaterial=function(i,a){var n=new t.MultiMaterial(i.name,a);n.id=i.id,t.Tags&&t.Tags.AddTagsTo(n,i.tags);for(var s=0;s<i.materials.length;s++){var o=i.materials[s];o?n.subMaterials.push(a.getMaterialByID(o)):n.subMaterials.push(null)}return n},r.Parse=function(i,a,n){if(!i.customType||i.customType==="BABYLON.StandardMaterial")return t.StandardMaterial.Parse(i,a,n);if(i.customType==="BABYLON.PBRMaterial"&&i.overloadedAlbedo&&(i.customType="BABYLON.LegacyPBRMaterial",!t.LegacyPBRMaterial)){t.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.");return}var s=t.Tools.Instantiate(i.customType);return s.Parse(i,a,n)},r._TriangleFillMode=0,r._WireFrameFillMode=1,r._PointFillMode=2,r._PointListDrawMode=3,r._LineListDrawMode=4,r._LineLoopDrawMode=5,r._LineStripDrawMode=6,r._TriangleStripDrawMode=7,r._TriangleFanDrawMode=8,r._ClockWiseSideOrientation=0,r._CounterClockWiseSideOrientation=1,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.AllDirtyFlag=31,A([t.serialize()],r.prototype,"id",void 0),A([t.serialize()],r.prototype,"uniqueId",void 0),A([t.serialize()],r.prototype,"name",void 0),A([t.serialize()],r.prototype,"checkReadyOnEveryCall",void 0),A([t.serialize()],r.prototype,"checkReadyOnlyOnce",void 0),A([t.serialize()],r.prototype,"state",void 0),A([t.serialize("alpha")],r.prototype,"_alpha",void 0),A([t.serialize("backFaceCulling")],r.prototype,"_backFaceCulling",void 0),A([t.serialize()],r.prototype,"sideOrientation",void 0),A([t.serialize("alphaMode")],r.prototype,"_alphaMode",void 0),A([t.serialize()],r.prototype,"_needDepthPrePass",void 0),A([t.serialize()],r.prototype,"disableDepthWrite",void 0),A([t.serialize()],r.prototype,"forceDepthWrite",void 0),A([t.serialize()],r.prototype,"separateCullingPass",void 0),A([t.serialize("fogEnabled")],r.prototype,"_fogEnabled",void 0),A([t.serialize()],r.prototype,"pointSize",void 0),A([t.serialize()],r.prototype,"zOffset",void 0),A([t.serialize()],r.prototype,"wireframe",null),A([t.serialize()],r.prototype,"pointsCloud",null),A([t.serialize()],r.prototype,"fillMode",null),r}();t.Material=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){this._engine=r,this._noUBO=!r.supportsUniformBuffers,this._dynamic=a,this._data=i||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(c.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),c.prototype.isDynamic=function(){return this._dynamic!==void 0},c.prototype.getData=function(){return this._bufferData},c.prototype.getBuffer=function(){return this._buffer},c.prototype._fillAlignment=function(r){var i;if(r<=2?i=r:i=4,this._uniformLocationPointer%i!==0){var a=this._uniformLocationPointer;this._uniformLocationPointer+=i-this._uniformLocationPointer%i;for(var n=this._uniformLocationPointer-a,s=0;s<n;s++)this._data.push(0)}},c.prototype.addUniform=function(r,i){if(!this._noUBO&&this._uniformLocations[r]===void 0){var a;if(i instanceof Array)a=i,i=a.length;else{i=i,a=[];for(var n=0;n<i;n++)a.push(0)}this._fillAlignment(i),this._uniformSizes[r]=i,this._uniformLocations[r]=this._uniformLocationPointer,this._uniformLocationPointer+=i;for(var n=0;n<i;n++)this._data.push(a[n]);this._needSync=!0}},c.prototype.addMatrix=function(r,i){this.addUniform(r,Array.prototype.slice.call(i.toArray()))},c.prototype.addFloat2=function(r,i,a){var n=[i,a];this.addUniform(r,n)},c.prototype.addFloat3=function(r,i,a,n){var s=[i,a,n];this.addUniform(r,s)},c.prototype.addColor3=function(r,i){var a=new Array;i.toArray(a),this.addUniform(r,a)},c.prototype.addColor4=function(r,i,a){var n=new Array;i.toArray(n),n.push(a),this.addUniform(r,n)},c.prototype.addVector3=function(r,i){var a=new Array;i.toArray(a),this.addUniform(r,a)},c.prototype.addMatrix3x3=function(r){this.addUniform(r,12)},c.prototype.addMatrix2x2=function(r){this.addUniform(r,8)},c.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},c.prototype._rebuild=function(){this._noUBO||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},c.prototype.update=function(){if(!this._buffer){this.create();return}!this._dynamic&&!this._needSync||(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1)},c.prototype.updateUniform=function(r,i,a){var n=this._uniformLocations[r];if(n===void 0){if(this._buffer){t.Tools.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(r,a),n=this._uniformLocations[r]}if(this._buffer||this.create(),this._dynamic)for(var o=0;o<a;o++)this._bufferData[n+o]=i[o];else{for(var s=!1,o=0;o<a;o++)this._bufferData[n+o]!==i[o]&&(s=!0,this._bufferData[n+o]=i[o]);this._needSync=this._needSync||s}},c.prototype._updateMatrix3x3ForUniform=function(r,i){for(var a=0;a<3;a++)c._tempBuffer[a*4]=i[a*3],c._tempBuffer[a*4+1]=i[a*3+1],c._tempBuffer[a*4+2]=i[a*3+2],c._tempBuffer[a*4+3]=0;this.updateUniform(r,c._tempBuffer,12)},c.prototype._updateMatrix3x3ForEffect=function(r,i){this._currentEffect.setMatrix3x3(r,i)},c.prototype._updateMatrix2x2ForEffect=function(r,i){this._currentEffect.setMatrix2x2(r,i)},c.prototype._updateMatrix2x2ForUniform=function(r,i){for(var a=0;a<2;a++)c._tempBuffer[a*4]=i[a*2],c._tempBuffer[a*4+1]=i[a*2+1],c._tempBuffer[a*4+2]=0,c._tempBuffer[a*4+3]=0;this.updateUniform(r,c._tempBuffer,8)},c.prototype._updateFloatForEffect=function(r,i){this._currentEffect.setFloat(r,i)},c.prototype._updateFloatForUniform=function(r,i){c._tempBuffer[0]=i,this.updateUniform(r,c._tempBuffer,1)},c.prototype._updateFloat2ForEffect=function(r,i,a,n){n===void 0&&(n=""),this._currentEffect.setFloat2(r+n,i,a)},c.prototype._updateFloat2ForUniform=function(r,i,a,n){n===void 0&&(n=""),c._tempBuffer[0]=i,c._tempBuffer[1]=a,this.updateUniform(r,c._tempBuffer,2)},c.prototype._updateFloat3ForEffect=function(r,i,a,n,s){s===void 0&&(s=""),this._currentEffect.setFloat3(r+s,i,a,n)},c.prototype._updateFloat3ForUniform=function(r,i,a,n,s){s===void 0&&(s=""),c._tempBuffer[0]=i,c._tempBuffer[1]=a,c._tempBuffer[2]=n,this.updateUniform(r,c._tempBuffer,3)},c.prototype._updateFloat4ForEffect=function(r,i,a,n,s,o){o===void 0&&(o=""),this._currentEffect.setFloat4(r+o,i,a,n,s)},c.prototype._updateFloat4ForUniform=function(r,i,a,n,s,o){o===void 0&&(o=""),c._tempBuffer[0]=i,c._tempBuffer[1]=a,c._tempBuffer[2]=n,c._tempBuffer[3]=s,this.updateUniform(r,c._tempBuffer,4)},c.prototype._updateMatrixForEffect=function(r,i){this._currentEffect.setMatrix(r,i)},c.prototype._updateMatrixForUniform=function(r,i){this.updateUniform(r,i.toArray(),16)},c.prototype._updateVector3ForEffect=function(r,i){this._currentEffect.setVector3(r,i)},c.prototype._updateVector3ForUniform=function(r,i){i.toArray(c._tempBuffer),this.updateUniform(r,c._tempBuffer,3)},c.prototype._updateVector4ForEffect=function(r,i){this._currentEffect.setVector4(r,i)},c.prototype._updateVector4ForUniform=function(r,i){i.toArray(c._tempBuffer),this.updateUniform(r,c._tempBuffer,4)},c.prototype._updateColor3ForEffect=function(r,i,a){a===void 0&&(a=""),this._currentEffect.setColor3(r+a,i)},c.prototype._updateColor3ForUniform=function(r,i,a){a===void 0&&(a=""),i.toArray(c._tempBuffer),this.updateUniform(r,c._tempBuffer,3)},c.prototype._updateColor4ForEffect=function(r,i,a,n){n===void 0&&(n=""),this._currentEffect.setColor4(r+n,i,a)},c.prototype._updateColor4ForUniform=function(r,i,a,n){n===void 0&&(n=""),i.toArray(c._tempBuffer),c._tempBuffer[3]=a,this.updateUniform(r,c._tempBuffer,4)},c.prototype.setTexture=function(r,i){this._currentEffect.setTexture(r,i)},c.prototype.updateUniformDirectly=function(r,i){this.updateUniform(r,i,i.length),this.update()},c.prototype.bindToEffect=function(r,i){this._currentEffect=r,!(this._noUBO||!this._buffer)&&r.bindUniformBuffer(this._buffer,i)},c.prototype.dispose=function(){if(!this._noUBO){var r=this._engine._uniformBuffers.indexOf(this);r!==-1&&this._engine._uniformBuffers.splice(r,1),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},c._MAX_UNIFORM_SIZE=256,c._tempBuffer=new Float32Array(c._MAX_UNIFORM_SIZE),c}();t.UniformBuffer=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.prototype.set=function(r,i){switch(i){case t.VertexBuffer.PositionKind:this.positions=r;break;case t.VertexBuffer.NormalKind:this.normals=r;break;case t.VertexBuffer.TangentKind:this.tangents=r;break;case t.VertexBuffer.UVKind:this.uvs=r;break;case t.VertexBuffer.UV2Kind:this.uvs2=r;break;case t.VertexBuffer.UV3Kind:this.uvs3=r;break;case t.VertexBuffer.UV4Kind:this.uvs4=r;break;case t.VertexBuffer.UV5Kind:this.uvs5=r;break;case t.VertexBuffer.UV6Kind:this.uvs6=r;break;case t.VertexBuffer.ColorKind:this.colors=r;break;case t.VertexBuffer.MatricesIndicesKind:this.matricesIndices=r;break;case t.VertexBuffer.MatricesWeightsKind:this.matricesWeights=r;break;case t.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=r;break;case t.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=r;break}},c.prototype.applyToMesh=function(r,i){return this._applyTo(r,i),this},c.prototype.applyToGeometry=function(r,i){return this._applyTo(r,i),this},c.prototype.updateMesh=function(r,i,a){return this._update(r),this},c.prototype.updateGeometry=function(r,i,a){return this._update(r),this},c.prototype._applyTo=function(r,i){return i===void 0&&(i=!1),this.positions&&r.setVerticesData(t.VertexBuffer.PositionKind,this.positions,i),this.normals&&r.setVerticesData(t.VertexBuffer.NormalKind,this.normals,i),this.tangents&&r.setVerticesData(t.VertexBuffer.TangentKind,this.tangents,i),this.uvs&&r.setVerticesData(t.VertexBuffer.UVKind,this.uvs,i),this.uvs2&&r.setVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,i),this.uvs3&&r.setVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,i),this.uvs4&&r.setVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,i),this.uvs5&&r.setVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,i),this.uvs6&&r.setVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,i),this.colors&&r.setVerticesData(t.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&r.setVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&r.setVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&r.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&r.setVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices?r.setIndices(this.indices,null,i):r.setIndices([],null),this},c.prototype._update=function(r,i,a){return this.positions&&r.updateVerticesData(t.VertexBuffer.PositionKind,this.positions,i,a),this.normals&&r.updateVerticesData(t.VertexBuffer.NormalKind,this.normals,i,a),this.tangents&&r.updateVerticesData(t.VertexBuffer.TangentKind,this.tangents,i,a),this.uvs&&r.updateVerticesData(t.VertexBuffer.UVKind,this.uvs,i,a),this.uvs2&&r.updateVerticesData(t.VertexBuffer.UV2Kind,this.uvs2,i,a),this.uvs3&&r.updateVerticesData(t.VertexBuffer.UV3Kind,this.uvs3,i,a),this.uvs4&&r.updateVerticesData(t.VertexBuffer.UV4Kind,this.uvs4,i,a),this.uvs5&&r.updateVerticesData(t.VertexBuffer.UV5Kind,this.uvs5,i,a),this.uvs6&&r.updateVerticesData(t.VertexBuffer.UV6Kind,this.uvs6,i,a),this.colors&&r.updateVerticesData(t.VertexBuffer.ColorKind,this.colors,i,a),this.matricesIndices&&r.updateVerticesData(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,a),this.matricesWeights&&r.updateVerticesData(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,a),this.matricesIndicesExtra&&r.updateVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,a),this.matricesWeightsExtra&&r.updateVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,a),this.indices&&r.setIndices(this.indices,null),this},c.prototype.transform=function(r){var i=r.m[0]*r.m[5]*r.m[10]<0,a=t.Vector3.Zero(),n;if(this.positions){var s=t.Vector3.Zero();for(n=0;n<this.positions.length;n+=3)t.Vector3.FromArrayToRef(this.positions,n,s),t.Vector3.TransformCoordinatesToRef(s,r,a),this.positions[n]=a.x,this.positions[n+1]=a.y,this.positions[n+2]=a.z}if(this.normals){var o=t.Vector3.Zero();for(n=0;n<this.normals.length;n+=3)t.Vector3.FromArrayToRef(this.normals,n,o),t.Vector3.TransformNormalToRef(o,r,a),this.normals[n]=a.x,this.normals[n+1]=a.y,this.normals[n+2]=a.z}if(this.tangents){var l=t.Vector4.Zero(),u=t.Vector4.Zero();for(n=0;n<this.tangents.length;n+=4)t.Vector4.FromArrayToRef(this.tangents,n,l),t.Vector4.TransformNormalToRef(l,r,u),this.tangents[n]=u.x,this.tangents[n+1]=u.y,this.tangents[n+2]=u.z,this.tangents[n+3]=u.w}if(i&&this.indices)for(n=0;n<this.indices.length;n+=3){var h=this.indices[n+1];this.indices[n+1]=this.indices[n+2],this.indices[n+2]=h}return this},c.prototype.merge=function(r,i){if(i===void 0&&(i=!1),this._validate(),r._validate(),!this.normals!=!r.normals||!this.tangents!=!r.tangents||!this.uvs!=!r.uvs||!this.uvs2!=!r.uvs2||!this.uvs3!=!r.uvs3||!this.uvs4!=!r.uvs4||!this.uvs5!=!r.uvs5||!this.uvs6!=!r.uvs6||!this.colors!=!r.colors||!this.matricesIndices!=!r.matricesIndices||!this.matricesWeights!=!r.matricesWeights||!this.matricesIndicesExtra!=!r.matricesIndicesExtra||!this.matricesWeightsExtra!=!r.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(r.indices){this.indices||(this.indices=[]);var a=this.positions?this.positions.length/3:0,n=this.indices.BYTES_PER_ELEMENT!==void 0;if(n){var s=this.indices.length+r.indices.length,o=i||this.indices instanceof Uint32Array?new Uint32Array(s):new Uint16Array(s);o.set(this.indices);for(var l=this.indices.length,u=0;u<r.indices.length;u++)o[l+u]=r.indices[u]+a;this.indices=o}else for(var u=0;u<r.indices.length;u++)this.indices.push(r.indices[u]+a)}return this.positions=this._mergeElement(this.positions,r.positions),this.normals=this._mergeElement(this.normals,r.normals),this.tangents=this._mergeElement(this.tangents,r.tangents),this.uvs=this._mergeElement(this.uvs,r.uvs),this.uvs2=this._mergeElement(this.uvs2,r.uvs2),this.uvs3=this._mergeElement(this.uvs3,r.uvs3),this.uvs4=this._mergeElement(this.uvs4,r.uvs4),this.uvs5=this._mergeElement(this.uvs5,r.uvs5),this.uvs6=this._mergeElement(this.uvs6,r.uvs6),this.colors=this._mergeElement(this.colors,r.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,r.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,r.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,r.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,r.matricesWeightsExtra),this},c.prototype._mergeElement=function(r,i){if(!r)return i;if(!i)return r;var a=i.length+r.length,n=r instanceof Float32Array,s=i instanceof Float32Array;if(n){var o=new Float32Array(a);return o.set(r),o.set(i,r.length),o}else if(s){for(var l=r.slice(0),u=0,a=i.length;u<a;u++)l.push(i[u]);return l}else return r.concat(i)},c.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var r=function(n,s){var o=t.VertexBuffer.DeduceStride(n);if(s.length%o!==0)throw new Error("The "+n+"s array count must be a multiple of "+o);return s.length/o},i=r(t.VertexBuffer.PositionKind,this.positions),a=function(n,s){var o=r(n,s);if(o!==i)throw new Error("The "+n+"s element count ("+o+") does not match the positions count ("+i+")")};this.normals&&a(t.VertexBuffer.NormalKind,this.normals),this.tangents&&a(t.VertexBuffer.TangentKind,this.tangents),this.uvs&&a(t.VertexBuffer.UVKind,this.uvs),this.uvs2&&a(t.VertexBuffer.UV2Kind,this.uvs2),this.uvs3&&a(t.VertexBuffer.UV3Kind,this.uvs3),this.uvs4&&a(t.VertexBuffer.UV4Kind,this.uvs4),this.uvs5&&a(t.VertexBuffer.UV5Kind,this.uvs5),this.uvs6&&a(t.VertexBuffer.UV6Kind,this.uvs6),this.colors&&a(t.VertexBuffer.ColorKind,this.colors),this.matricesIndices&&a(t.VertexBuffer.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&a(t.VertexBuffer.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&a(t.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&a(t.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra)},c.prototype.serialize=function(){var r=this.serialize();return this.positions&&(r.positions=this.positions),this.normals&&(r.normals=this.normals),this.tangents&&(r.tangents=this.tangents),this.uvs&&(r.uvs=this.uvs),this.uvs2&&(r.uvs2=this.uvs2),this.uvs3&&(r.uvs3=this.uvs3),this.uvs4&&(r.uvs4=this.uvs4),this.uvs5&&(r.uvs5=this.uvs5),this.uvs6&&(r.uvs6=this.uvs6),this.colors&&(r.colors=this.colors),this.matricesIndices&&(r.matricesIndices=this.matricesIndices,r.matricesIndices._isExpanded=!0),this.matricesWeights&&(r.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(r.matricesIndicesExtra=this.matricesIndicesExtra,r.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(r.matricesWeightsExtra=this.matricesWeightsExtra),r.indices=this.indices,r},c.ExtractFromMesh=function(r,i,a){return c._ExtractFrom(r,i,a)},c.ExtractFromGeometry=function(r,i,a){return c._ExtractFrom(r,i,a)},c._ExtractFrom=function(r,i,a){var n=new c;return r.isVerticesDataPresent(t.VertexBuffer.PositionKind)&&(n.positions=r.getVerticesData(t.VertexBuffer.PositionKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(n.normals=r.getVerticesData(t.VertexBuffer.NormalKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(n.tangents=r.getVerticesData(t.VertexBuffer.TangentKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(n.uvs=r.getVerticesData(t.VertexBuffer.UVKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(n.uvs2=r.getVerticesData(t.VertexBuffer.UV2Kind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UV3Kind)&&(n.uvs3=r.getVerticesData(t.VertexBuffer.UV3Kind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UV4Kind)&&(n.uvs4=r.getVerticesData(t.VertexBuffer.UV4Kind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UV5Kind)&&(n.uvs5=r.getVerticesData(t.VertexBuffer.UV5Kind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.UV6Kind)&&(n.uvs6=r.getVerticesData(t.VertexBuffer.UV6Kind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.ColorKind)&&(n.colors=r.getVerticesData(t.VertexBuffer.ColorKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind)&&(n.matricesIndices=r.getVerticesData(t.VertexBuffer.MatricesIndicesKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)&&(n.matricesWeights=r.getVerticesData(t.VertexBuffer.MatricesWeightsKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=r.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,i,a)),r.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=r.getVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,i,a)),n.indices=r.getIndices(i,a),n},c.CreateRibbon=function(r){var i=r.pathArray,a=r.closeArray||!1,n=r.closePath||!1,s=r.invertUV||!1,o=Math.floor(i[0].length/2),l=r.offset||o;l=l>o?o:Math.floor(l);var u=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,h=r.uvs,d=r.colors,p=[],m=[],_=[],v=[],S=[],P=[],x=[],R=[],w,I=[],F=[],k,E,g;if(i.length<2){var y=[],M=[];for(E=0;E<i[0].length-l;E++)y.push(i[0][E]),M.push(i[0][E+l]);i=[y,M]}var C=0,D=n?1:0,V,G;w=i[0].length;var U,z;for(k=0;k<i.length;k++){for(x[k]=0,S[k]=[0],V=i[k],G=V.length,w=w<G?w:G,g=0;g<G;)p.push(V[g].x,V[g].y,V[g].z),g>0&&(U=V[g].subtract(V[g-1]).length(),z=U+x[k],S[k].push(z),x[k]=z),g++;n&&(g--,p.push(V[0].x,V[0].y,V[0].z),U=V[g].subtract(V[0]).length(),z=U+x[k],S[k].push(z),x[k]=z),I[k]=G+D,F[k]=C,C+=G+D}var H,W,X=null,K=null;for(E=0;E<w+D;E++){for(R[E]=0,P[E]=[0],k=0;k<i.length-1;k++)H=i[k],W=i[k+1],E===w?(X=H[0],K=W[0]):(X=H[E],K=W[E]),U=K.subtract(X).length(),z=U+R[E],P[E].push(z),R[E]=z;a&&K&&X&&(H=i[k],W=i[0],E===w&&(K=W[0]),U=K.subtract(X).length(),z=U+R[E],R[E]=z)}var j,ee;if(h)for(k=0;k<h.length;k++)v.push(h[k].x,h[k].y);else for(k=0;k<i.length;k++)for(E=0;E<w+D;E++)j=x[k]!=0?S[k][E]/x[k]:0,ee=R[E]!=0?P[E][k]/R[E]:0,s?v.push(ee,j):v.push(j,ee);k=0;for(var $=0,L=I[k]-1,Q=I[k+1]-1,J=L<Q?L:Q,te=F[1]-F[0],re=a?I.length:I.length-1;$<=J&&k<re;)m.push($,$+te,$+1),m.push($+te+1,$+1,$+te),$+=1,$===J&&(k++,k===I.length-1?(te=F[0]-F[k],L=I[k]-1,Q=I[0]-1):(te=F[k+1]-F[k],L=I[k]-1,Q=I[k+1]-1),$=F[k],J=L<Q?L+$:Q+$);if(c.ComputeNormals(p,m,_),n){var le=0,ie=0;for(k=0;k<i.length;k++)le=F[k]*3,k+1<i.length?ie=(F[k+1]-1)*3:ie=_.length-3,_[le]=(_[le]+_[ie])*.5,_[le+1]=(_[le+1]+_[ie+1])*.5,_[le+2]=(_[le+2]+_[ie+2])*.5,_[ie]=_[le],_[ie+1]=_[le+1],_[ie+2]=_[le+2]}c._ComputeSides(u,p,m,_,v,r.frontUVs,r.backUVs);var ce=null;if(d){ce=new Float32Array(d.length*4);for(var de=0;de<d.length;de++)ce[de*4]=d[de].r,ce[de*4+1]=d[de].g,ce[de*4+2]=d[de].b,ce[de*4+3]=d[de].a}var _e=new c,ge=new Float32Array(p),me=new Float32Array(_),ve=new Float32Array(v);return _e.indices=m,_e.positions=ge,_e.normals=me,_e.uvs=ve,ce&&_e.set(ce,t.VertexBuffer.ColorKind),n&&(_e._idx=F),_e},c.CreateBox=function(r){for(var i=[new t.Vector3(0,0,1),new t.Vector3(0,0,-1),new t.Vector3(1,0,0),new t.Vector3(-1,0,0),new t.Vector3(0,1,0),new t.Vector3(0,-1,0)],a=[],n=[],s=[],o=[],l=r.width||r.size||1,u=r.height||r.size||1,h=r.depth||r.size||1,d=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,p=r.faceUV||new Array(6),m=r.faceColors,_=[],v=0;v<6;v++)p[v]===void 0&&(p[v]=new t.Vector4(0,0,1,1)),m&&m[v]===void 0&&(m[v]=new t.Color4(1,1,1,1));for(var S=new t.Vector3(l/2,u/2,h/2),P=0;P<i.length;P++){var x=i[P],R=new t.Vector3(x.y,x.z,x.x),w=t.Vector3.Cross(x,R),I=n.length/3;a.push(I),a.push(I+1),a.push(I+2),a.push(I),a.push(I+2),a.push(I+3);var F=x.subtract(R).subtract(w).multiply(S);n.push(F.x,F.y,F.z),s.push(x.x,x.y,x.z),o.push(p[P].z,p[P].w),m&&_.push(m[P].r,m[P].g,m[P].b,m[P].a),F=x.subtract(R).add(w).multiply(S),n.push(F.x,F.y,F.z),s.push(x.x,x.y,x.z),o.push(p[P].x,p[P].w),m&&_.push(m[P].r,m[P].g,m[P].b,m[P].a),F=x.add(R).add(w).multiply(S),n.push(F.x,F.y,F.z),s.push(x.x,x.y,x.z),o.push(p[P].x,p[P].y),m&&_.push(m[P].r,m[P].g,m[P].b,m[P].a),F=x.add(R).subtract(w).multiply(S),n.push(F.x,F.y,F.z),s.push(x.x,x.y,x.z),o.push(p[P].z,p[P].y),m&&_.push(m[P].r,m[P].g,m[P].b,m[P].a)}c._ComputeSides(d,n,a,s,o,r.frontUVs,r.backUVs);var k=new c;if(k.indices=a,k.positions=n,k.normals=s,k.uvs=o,m){var E=d===t.Mesh.DOUBLESIDE?_.concat(_):_;k.colors=E}return k},c.CreateSphere=function(r){for(var i=r.segments||32,a=r.diameterX||r.diameter||1,n=r.diameterY||r.diameter||1,s=r.diameterZ||r.diameter||1,o=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,l=r.slice&&r.slice<=0?1:r.slice||1,u=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,h=new t.Vector3(a/2,n/2,s/2),d=2+i,p=2*d,m=[],_=[],v=[],S=[],P=0;P<=d;P++){for(var x=P/d,R=x*Math.PI*l,w=0;w<=p;w++){var I=w/p,F=I*Math.PI*2*o,k=t.Matrix.RotationZ(-R),E=t.Matrix.RotationY(F),g=t.Vector3.TransformCoordinates(t.Vector3.Up(),k),y=t.Vector3.TransformCoordinates(g,E),M=y.multiply(h),C=y.divide(h).normalize();_.push(M.x,M.y,M.z),v.push(C.x,C.y,C.z),S.push(I,x)}if(P>0)for(var D=_.length/3,V=D-2*(p+1);V+p+2<D;V++)m.push(V),m.push(V+1),m.push(V+p+1),m.push(V+p+1),m.push(V+1),m.push(V+p+2)}c._ComputeSides(u,_,m,v,S,r.frontUVs,r.backUVs);var G=new c;return G.indices=m,G.positions=_,G.normals=v,G.uvs=S,G},c.CreateCylinder=function(r){var i=r.height||2,a=r.diameterTop===0?0:r.diameterTop||r.diameter||1,n=r.diameterBottom===0?0:r.diameterBottom||r.diameter||1,s=r.tessellation||24,o=r.subdivisions||1,l=!!r.hasRings,u=!!r.enclose,h=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,d=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,p=r.faceUV||new Array(3),m=r.faceColors,_=h!==1&&u?2:0,v=l?o:1,S=2+(1+_)*v,P;for(P=0;P<S;P++)m&&m[P]===void 0&&(m[P]=new t.Color4(1,1,1,1));for(P=0;P<S;P++)p&&p[P]===void 0&&(p[P]=new t.Vector4(0,0,1,1));var x=new Array,R=new Array,w=new Array,I=new Array,F=new Array,k=Math.PI*2*h/s,E,g,y,M=(n-a)/2/i,C=t.Vector3.Zero(),D=t.Vector3.Zero(),V=t.Vector3.Zero(),G=t.Vector3.Zero(),U=t.Vector3.Zero(),z=t.Axis.Y,H,W,X,K=1,L=1,j=0,ee=0;for(H=0;H<=o;H++)for(g=H/o,y=(g*(a-n)+n)/2,K=l&&H!==0&&H!==o?2:1,X=0;X<K;X++){for(l&&(L+=X),u&&(L+=2*X),W=0;W<=s;W++)E=W*k,C.x=Math.cos(-E)*y,C.y=-i/2+g*i,C.z=Math.sin(-E)*y,a===0&&H===o?(D.x=w[w.length-(s+1)*3],D.y=w[w.length-(s+1)*3+1],D.z=w[w.length-(s+1)*3+2]):(D.x=C.x,D.z=C.z,D.y=Math.sqrt(D.x*D.x+D.z*D.z)*M,D.normalize()),W===0&&(V.copyFrom(C),G.copyFrom(D)),R.push(C.x,C.y,C.z),w.push(D.x,D.y,D.z),l?ee=j!==L?p[L].y:p[L].w:ee=p[L].y+(p[L].w-p[L].y)*g,I.push(p[L].x+(p[L].z-p[L].x)*W/s,ee),m&&F.push(m[L].r,m[L].g,m[L].b,m[L].a);h!==1&&u&&(R.push(C.x,C.y,C.z),R.push(0,C.y,0),R.push(0,C.y,0),R.push(V.x,V.y,V.z),t.Vector3.CrossToRef(z,D,U),U.normalize(),w.push(U.x,U.y,U.z,U.x,U.y,U.z),t.Vector3.CrossToRef(G,z,U),U.normalize(),w.push(U.x,U.y,U.z,U.x,U.y,U.z),l?ee=j!==L?p[L+1].y:p[L+1].w:ee=p[L+1].y+(p[L+1].w-p[L+1].y)*g,I.push(p[L+1].x,ee),I.push(p[L+1].z,ee),l?ee=j!==L?p[L+2].y:p[L+2].w:ee=p[L+2].y+(p[L+2].w-p[L+2].y)*g,I.push(p[L+2].x,ee),I.push(p[L+2].z,ee),m&&(F.push(m[L+1].r,m[L+1].g,m[L+1].b,m[L+1].a),F.push(m[L+1].r,m[L+1].g,m[L+1].b,m[L+1].a),F.push(m[L+2].r,m[L+2].g,m[L+2].b,m[L+2].a),F.push(m[L+2].r,m[L+2].g,m[L+2].b,m[L+2].a))),j!==L&&(j=L)}var $=h!==1&&u?s+4:s,L;for(H=0,L=0;L<o;L++){var Q=0,J=0,te=0,re=0;for(W=0;W<s;W++)Q=H*($+1)+W,J=(H+1)*($+1)+W,te=H*($+1)+(W+1),re=(H+1)*($+1)+(W+1),x.push(Q,J,te),x.push(re,te,J);h!==1&&u&&(x.push(Q+2,J+2,te+2),x.push(re+2,te+2,J+2),x.push(Q+4,J+4,te+4),x.push(re+4,te+4,J+4)),H=l?H+2:H+1}var le=function(ce){var de=ce?a/2:n/2;if(de!==0){var _e,ge,me,ve=ce?p[S-1]:p[0],be=null;m&&(be=ce?m[S-1]:m[0]);var Te=R.length/3,He=ce?i/2:-i/2,De=new t.Vector3(0,He,0);R.push(De.x,De.y,De.z),w.push(0,ce?1:-1,0),I.push(ve.x+(ve.z-ve.x)*.5,ve.y+(ve.w-ve.y)*.5),be&&F.push(be.r,be.g,be.b,be.a);var Fe=new t.Vector2(.5,.5);for(me=0;me<=s;me++){_e=Math.PI*2*me*h/s;var Qe=Math.cos(-_e),at=Math.sin(-_e);ge=new t.Vector3(Qe*de,He,at*de);var Rt=new t.Vector2(Qe*Fe.x+.5,at*Fe.y+.5);R.push(ge.x,ge.y,ge.z),w.push(0,ce?1:-1,0),I.push(ve.x+(ve.z-ve.x)*Rt.x,ve.y+(ve.w-ve.y)*Rt.y),be&&F.push(be.r,be.g,be.b,be.a)}for(me=0;me<s;me++)ce?(x.push(Te),x.push(Te+(me+2)),x.push(Te+(me+1))):(x.push(Te),x.push(Te+(me+1)),x.push(Te+(me+2)))}};le(!1),le(!0),c._ComputeSides(d,R,x,w,I,r.frontUVs,r.backUVs);var ie=new c;return ie.indices=x,ie.positions=R,ie.normals=w,ie.uvs=I,m&&(ie.colors=F),ie},c.CreateTorus=function(r){for(var i=[],a=[],n=[],s=[],o=r.diameter||1,l=r.thickness||.5,u=r.tessellation||16,h=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,d=u+1,p=0;p<=u;p++)for(var m=p/u,_=p*Math.PI*2/u-Math.PI/2,v=t.Matrix.Translation(o/2,0,0).multiply(t.Matrix.RotationY(_)),S=0;S<=u;S++){var P=1-S/u,x=S*Math.PI*2/u+Math.PI,R=Math.cos(x),w=Math.sin(x),I=new t.Vector3(R,w,0),F=I.scale(l/2),k=new t.Vector2(m,P);F=t.Vector3.TransformCoordinates(F,v),I=t.Vector3.TransformNormal(I,v),a.push(F.x,F.y,F.z),n.push(I.x,I.y,I.z),s.push(k.x,k.y);var E=(p+1)%d,g=(S+1)%d;i.push(p*d+S),i.push(p*d+g),i.push(E*d+S),i.push(p*d+g),i.push(E*d+g),i.push(E*d+S)}c._ComputeSides(h,a,i,n,s,r.frontUVs,r.backUVs);var y=new c;return y.indices=i,y.positions=a,y.normals=n,y.uvs=s,y},c.CreateLineSystem=function(r){for(var i=[],a=[],n=r.lines,s=r.colors,o=[],l=0,u=0;u<n.length;u++)for(var h=n[u],d=0;d<h.length;d++){if(a.push(h[d].x,h[d].y,h[d].z),s){var p=s[u];o.push(p[d].r,p[d].g,p[d].b,p[d].a)}d>0&&(i.push(l-1),i.push(l)),l++}var m=new c;return m.indices=i,m.positions=a,s&&(m.colors=o),m},c.CreateDashedLines=function(r){var i=r.dashSize||3,a=r.gapSize||1,n=r.dashNb||200,s=r.points,o=new Array,l=new Array,u=t.Vector3.Zero(),h=0,d=0,p=0,m=0,_=0,v=0,S=0;for(S=0;S<s.length-1;S++)s[S+1].subtractToRef(s[S],u),h+=u.length();for(p=h/n,m=i*p/(i+a),S=0;S<s.length-1;S++){s[S+1].subtractToRef(s[S],u),d=Math.floor(u.length()/p),u.normalize();for(var P=0;P<d;P++)_=p*P,o.push(s[S].x+_*u.x,s[S].y+_*u.y,s[S].z+_*u.z),o.push(s[S].x+(_+m)*u.x,s[S].y+(_+m)*u.y,s[S].z+(_+m)*u.z),l.push(v,v+1),v+=2}var x=new c;return x.positions=o,x.indices=l,x},c.CreateGround=function(r){var i=[],a=[],n=[],s=[],o,l,u=r.width||1,h=r.height||1,d=r.subdivisionsX||r.subdivisions||1,p=r.subdivisionsY||r.subdivisions||1;for(o=0;o<=p;o++)for(l=0;l<=d;l++){var m=new t.Vector3(l*u/d-u/2,0,(p-o)*h/p-h/2),_=new t.Vector3(0,1,0);a.push(m.x,m.y,m.z),n.push(_.x,_.y,_.z),s.push(l/d,1-o/p)}for(o=0;o<p;o++)for(l=0;l<d;l++)i.push(l+1+(o+1)*(d+1)),i.push(l+1+o*(d+1)),i.push(l+o*(d+1)),i.push(l+(o+1)*(d+1)),i.push(l+1+(o+1)*(d+1)),i.push(l+o*(d+1));var v=new c;return v.indices=i,v.positions=a,v.normals=n,v.uvs=s,v},c.CreateTiledGround=function(r){var i=r.xmin!==void 0&&r.xmin!==null?r.xmin:-1,a=r.zmin!==void 0&&r.zmin!==null?r.zmin:-1,n=r.xmax!==void 0&&r.xmax!==null?r.xmax:1,s=r.zmax!==void 0&&r.zmax!==null?r.zmax:1,o=r.subdivisions||{w:1,h:1},l=r.precision||{w:1,h:1},u=new Array,h=new Array,d=new Array,p=new Array,m,_,v,S;o.h=o.h<1?1:o.h,o.w=o.w<1?1:o.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;var P={w:(n-i)/o.w,h:(s-a)/o.h};function x(w,I,F,k){var E=h.length/3,g=l.w+1;for(m=0;m<l.h;m++)for(_=0;_<l.w;_++){var y=[E+_+m*g,E+(_+1)+m*g,E+(_+1)+(m+1)*g,E+_+(m+1)*g];u.push(y[1]),u.push(y[2]),u.push(y[3]),u.push(y[0]),u.push(y[1]),u.push(y[3])}var M=t.Vector3.Zero(),C=new t.Vector3(0,1,0);for(m=0;m<=l.h;m++)for(M.z=m*(k-I)/l.h+I,_=0;_<=l.w;_++)M.x=_*(F-w)/l.w+w,M.y=0,h.push(M.x,M.y,M.z),d.push(C.x,C.y,C.z),p.push(_/l.w,m/l.h)}for(v=0;v<o.h;v++)for(S=0;S<o.w;S++)x(i+S*P.w,a+v*P.h,i+(S+1)*P.w,a+(v+1)*P.h);var R=new c;return R.indices=u,R.positions=h,R.normals=d,R.uvs=p,R},c.CreateGroundFromHeightMap=function(r){var i=[],a=[],n=[],s=[],o,l,u=r.colorFilter||new t.Color3(.3,.59,.11),h=r.alphaFilter||0;for(o=0;o<=r.subdivisions;o++)for(l=0;l<=r.subdivisions;l++){var d=new t.Vector3(l*r.width/r.subdivisions-r.width/2,0,(r.subdivisions-o)*r.height/r.subdivisions-r.height/2),p=(d.x+r.width/2)/r.width*(r.bufferWidth-1)|0,m=(1-(d.z+r.height/2)/r.height)*(r.bufferHeight-1)|0,_=(p+m*r.bufferWidth)*4,v=r.buffer[_]/255,S=r.buffer[_+1]/255,P=r.buffer[_+2]/255,x=r.buffer[_+3]/255,R=v*u.r+S*u.g+P*u.b;x>=h?d.y=r.minHeight+(r.maxHeight-r.minHeight)*R:d.y=r.minHeight-t.Epsilon,a.push(d.x,d.y,d.z),n.push(0,0,0),s.push(l/r.subdivisions,1-o/r.subdivisions)}for(o=0;o<r.subdivisions;o++)for(l=0;l<r.subdivisions;l++){var w=l+1+(o+1)*(r.subdivisions+1),I=l+1+o*(r.subdivisions+1),F=l+o*(r.subdivisions+1),k=l+(o+1)*(r.subdivisions+1),E=a[w*3+1]>=r.minHeight,g=a[I*3+1]>=r.minHeight,y=a[F*3+1]>=r.minHeight;E&&g&&y&&(i.push(w),i.push(I),i.push(F));var M=a[k*3+1]>=r.minHeight;M&&E&&y&&(i.push(k),i.push(w),i.push(F))}c.ComputeNormals(a,i,n);var C=new c;return C.indices=i,C.positions=a,C.normals=n,C.uvs=s,C},c.CreatePlane=function(r){var i=[],a=[],n=[],s=[],o=r.width||r.size||1,l=r.height||r.size||1,u=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,h=o/2,d=l/2;a.push(-h,-d,0),n.push(0,0,-1),s.push(0,0),a.push(h,-d,0),n.push(0,0,-1),s.push(1,0),a.push(h,d,0),n.push(0,0,-1),s.push(1,1),a.push(-h,d,0),n.push(0,0,-1),s.push(0,1),i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),c._ComputeSides(u,a,i,n,s,r.frontUVs,r.backUVs);var p=new c;return p.indices=i,p.positions=a,p.normals=n,p.uvs=s,p},c.CreateDisc=function(r){var i=new Array,a=new Array,n=new Array,s=new Array,o=r.radius||.5,l=r.tessellation||64,u=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1,h=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE;i.push(0,0,0),s.push(.5,.5);for(var d=Math.PI*2*u,p=d/l,m=0;m<d;m+=p){var _=Math.cos(m),v=Math.sin(m),S=(_+1)/2,P=(1-v)/2;i.push(o*_,o*v,0),s.push(S,P)}u===1&&(i.push(i[3],i[4],i[5]),s.push(s[2],s[3]));for(var x=i.length/3,R=1;R<x-1;R++)a.push(R+1,0,R);c.ComputeNormals(i,a,n),c._ComputeSides(h,i,a,n,s,r.frontUVs,r.backUVs);var w=new c;return w.indices=a,w.positions=i,w.normals=n,w.uvs=s,w},c.CreatePolygon=function(r,i,a,n,s,o){for(var l=a||new Array(3),u=n,h=[],d=0;d<3;d++)l[d]===void 0&&(l[d]=new t.Vector4(0,0,1,1)),u&&u[d]===void 0&&(u[d]=new t.Color4(1,1,1,1));for(var p=r.getVerticesData(t.VertexBuffer.PositionKind),m=r.getVerticesData(t.VertexBuffer.NormalKind),_=r.getVerticesData(t.VertexBuffer.UVKind),v=r.getIndices(),S=0,P=0,x=0;x<m.length;x+=3)Math.abs(m[x+1])<.001&&(P=1),Math.abs(m[x+1]-1)<.001&&(P=0),Math.abs(m[x+1]+1)<.001&&(P=2),S=x/3,_[2*S]=(1-_[2*S])*l[P].x+_[2*S]*l[P].z,_[2*S+1]=(1-_[2*S+1])*l[P].y+_[2*S+1]*l[P].w,u&&h.push(u[P].r,u[P].g,u[P].b,u[P].a);c._ComputeSides(i,p,v,m,_,s,o);var R=new c;if(R.indices=v,R.positions=p,R.normals=m,R.uvs=_,u){var w=i===t.Mesh.DOUBLESIDE?h.concat(h):h;R.colors=w}return R},c.CreateIcoSphere=function(r){var i=r.sideOrientation||t.Mesh.DEFAULTSIDE,a=r.radius||1,n=r.flat===void 0?!0:r.flat,s=r.subdivisions||4,o=r.radiusX||a,l=r.radiusY||a,u=r.radiusZ||a,h=(1+Math.sqrt(5))/2,d=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],p=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],m=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],_=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],v=138/1024,S=239/1024,P=60/1024,x=26/1024,R=-40/1024,w=20/1024,I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],F=new Array,k=new Array,E=new Array,g=new Array,y=0,M=new Array(3),C=new Array(3),D;for(D=0;D<3;D++)M[D]=t.Vector3.Zero(),C[D]=t.Vector2.Zero();for(var V=0;V<20;V++){for(D=0;D<3;D++){var G=p[3*V+D];M[D].copyFromFloats(d[3*m[G]],d[3*m[G]+1],d[3*m[G]+2]),M[D].normalize().scaleInPlace(a),C[D].copyFromFloats(_[2*G]*v+P+I[V]*R,_[2*G+1]*S+x+I[V]*w)}for(var U=function(X,K,j,ee){var $=t.Vector3.Lerp(M[0],M[2],K/s),L=t.Vector3.Lerp(M[1],M[2],K/s),Q=s===K?M[2]:t.Vector3.Lerp($,L,X/(s-K));Q.normalize();var J;if(n){var te=t.Vector3.Lerp(M[0],M[2],ee/s),re=t.Vector3.Lerp(M[1],M[2],ee/s);J=t.Vector3.Lerp(te,re,j/(s-ee))}else J=new t.Vector3(Q.x,Q.y,Q.z);J.x/=o,J.y/=l,J.z/=u,J.normalize();var le=t.Vector2.Lerp(C[0],C[2],K/s),ie=t.Vector2.Lerp(C[1],C[2],K/s),ce=s===K?C[2]:t.Vector2.Lerp(le,ie,X/(s-K));k.push(Q.x*o,Q.y*l,Q.z*u),E.push(J.x,J.y,J.z),g.push(ce.x,ce.y),F.push(y),y++},z=0;z<s;z++)for(var H=0;H+z<s;H++)U(H,z,H+.3333333333333333,z+.3333333333333333),U(H+1,z,H+.3333333333333333,z+.3333333333333333),U(H,z+1,H+.3333333333333333,z+.3333333333333333),H+z+1<s&&(U(H+1,z,H+.6666666666666666,z+.6666666666666666),U(H+1,z+1,H+.6666666666666666,z+.6666666666666666),U(H,z+1,H+.6666666666666666,z+.6666666666666666))}c._ComputeSides(i,k,F,E,g,r.frontUVs,r.backUVs);var W=new c;return W.indices=F,W.positions=k,W.normals=E,W.uvs=g,W},c.CreatePolyhedron=function(r){var i=[];i[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},i[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},i[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},i[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},i[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},i[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},i[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},i[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},i[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},i[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},i[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},i[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},i[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},i[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},i[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var a=r.type&&(r.type<0||r.type>=i.length)?0:r.type||0,n=r.size,s=r.sizeX||n||1,o=r.sizeY||n||1,l=r.sizeZ||n||1,u=r.custom||i[a],h=u.face.length,d=r.faceUV||new Array(h),p=r.faceColors,m=r.flat===void 0?!0:r.flat,_=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,v=new Array,S=new Array,P=new Array,x=new Array,R=new Array,w=0,I=0,F=new Array,k=0,E=0,g,y,M,C,D,V;if(m)for(E=0;E<h;E++)p&&p[E]===void 0&&(p[E]=new t.Color4(1,1,1,1)),d&&d[E]===void 0&&(d[E]=new t.Vector4(0,0,1,1));if(m)for(E=0;E<h;E++){var G=u.face[E].length;for(M=2*Math.PI/G,C=.5*Math.tan(M/2),D=.5,k=0;k<G;k++)v.push(u.vertex[u.face[E][k]][0]*s,u.vertex[u.face[E][k]][1]*o,u.vertex[u.face[E][k]][2]*l),F.push(w),w++,g=d[E].x+(d[E].z-d[E].x)*(.5+C),y=d[E].y+(d[E].w-d[E].y)*(D-.5),x.push(g,y),V=C*Math.cos(M)-D*Math.sin(M),D=C*Math.sin(M)+D*Math.cos(M),C=V,p&&R.push(p[E].r,p[E].g,p[E].b,p[E].a);for(k=0;k<G-2;k++)S.push(F[0+I],F[k+2+I],F[k+1+I]);I+=G}else{for(k=0;k<u.vertex.length;k++)v.push(u.vertex[k][0]*s,u.vertex[k][1]*o,u.vertex[k][2]*l),x.push(0,0);for(E=0;E<h;E++)for(k=0;k<u.face[E].length-2;k++)S.push(u.face[E][0],u.face[E][k+2],u.face[E][k+1])}c.ComputeNormals(v,S,P),c._ComputeSides(_,v,S,P,x,r.frontUVs,r.backUVs);var U=new c;return U.positions=v,U.indices=S,U.normals=P,U.uvs=x,p&&m&&(U.colors=R),U},c.CreateTorusKnot=function(r){var i=new Array,a=new Array,n=new Array,s=new Array,o=r.radius||2,l=r.tube||.5,u=r.radialSegments||32,h=r.tubularSegments||32,d=r.p||2,p=r.q||3,m=r.sideOrientation===0?0:r.sideOrientation||t.Mesh.DEFAULTSIDE,_=function(H){var W=Math.cos(H),X=Math.sin(H),K=p/d*H,j=Math.cos(K),ee=o*(2+j)*.5*W,$=o*(2+j)*X*.5,L=o*Math.sin(K)*.5;return new t.Vector3(ee,$,L)},v,S;for(v=0;v<=u;v++){var P=v%u,x=P/u*2*d*Math.PI,R=_(x),w=_(x+.01),I=w.subtract(R),F=w.add(R),k=t.Vector3.Cross(I,F);for(F=t.Vector3.Cross(k,I),k.normalize(),F.normalize(),S=0;S<h;S++){var E=S%h,g=E/h*2*Math.PI,y=-l*Math.cos(g),M=l*Math.sin(g);a.push(R.x+y*F.x+M*k.x),a.push(R.y+y*F.y+M*k.y),a.push(R.z+y*F.z+M*k.z),s.push(v/u),s.push(S/h)}}for(v=0;v<u;v++)for(S=0;S<h;S++){var C=(S+1)%h,D=v*h+S,V=(v+1)*h+S,G=(v+1)*h+C,U=v*h+C;i.push(U),i.push(V),i.push(D),i.push(U),i.push(G),i.push(V)}c.ComputeNormals(a,i,n),c._ComputeSides(m,a,i,n,s,r.frontUVs,r.backUVs);var z=new c;return z.indices=i,z.positions=a,z.normals=n,z.uvs=s,z},c.ComputeNormals=function(r,i,a,n){var s=0,o=0,l=0,u=0,h=0,d=0,p=0,m=0,_=0,v=0,S=0,P=0,x=0,R=0,w=0,I=0,F=0,k=0,E=0,g=0,y=!1,M=!1,C=!1,D=!1,V=1,G=0,U=null;if(n&&(y=!!n.facetNormals,M=!!n.facetPositions,C=!!n.facetPartitioning,V=n.useRightHandedSystem===!0?-1:1,G=n.ratio||0,D=!!n.depthSort,U=n.distanceTo,D)){U===void 0&&(U=t.Vector3.Zero());var z=n.depthSortedFacets}var H=0,W=0,X=0,K=0;if(C&&n&&n.bbSize){var j=0,ee=0,$=0,L=0,Q=0,J=0,te=0,re=0,le=0,ie=0,ce=0,de=0,_e=0,ge=0,me=0,ve=0,be=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;be=be>n.bbSize.z?be:n.bbSize.z,H=n.subDiv.X*G/n.bbSize.x,W=n.subDiv.Y*G/n.bbSize.y,X=n.subDiv.Z*G/n.bbSize.z,K=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(s=0;s<r.length;s++)a[s]=0;var Te=i.length/3|0;for(s=0;s<Te;s++){if(P=i[s*3]*3,x=P+1,R=P+2,w=i[s*3+1]*3,I=w+1,F=w+2,k=i[s*3+2]*3,E=k+1,g=k+2,o=r[P]-r[w],l=r[x]-r[I],u=r[R]-r[F],h=r[k]-r[w],d=r[E]-r[I],p=r[g]-r[F],m=V*(l*p-u*d),_=V*(u*h-o*p),v=V*(o*d-l*h),S=Math.sqrt(m*m+_*_+v*v),S=S===0?1:S,m/=S,_/=S,v/=S,y&&n&&(n.facetNormals[s].x=m,n.facetNormals[s].y=_,n.facetNormals[s].z=v),M&&n&&(n.facetPositions[s].x=(r[P]+r[w]+r[k])/3,n.facetPositions[s].y=(r[x]+r[I]+r[E])/3,n.facetPositions[s].z=(r[R]+r[F]+r[g])/3),C&&n&&(j=Math.floor((n.facetPositions[s].x-n.bInfo.minimum.x*G)*H),ee=Math.floor((n.facetPositions[s].y-n.bInfo.minimum.y*G)*W),$=Math.floor((n.facetPositions[s].z-n.bInfo.minimum.z*G)*X),L=Math.floor((r[P]-n.bInfo.minimum.x*G)*H),Q=Math.floor((r[x]-n.bInfo.minimum.y*G)*W),J=Math.floor((r[R]-n.bInfo.minimum.z*G)*X),te=Math.floor((r[w]-n.bInfo.minimum.x*G)*H),re=Math.floor((r[I]-n.bInfo.minimum.y*G)*W),le=Math.floor((r[F]-n.bInfo.minimum.z*G)*X),ie=Math.floor((r[k]-n.bInfo.minimum.x*G)*H),ce=Math.floor((r[E]-n.bInfo.minimum.y*G)*W),de=Math.floor((r[g]-n.bInfo.minimum.z*G)*X),ge=L+n.subDiv.max*Q+K*J,me=te+n.subDiv.max*re+K*le,ve=ie+n.subDiv.max*ce+K*de,_e=j+n.subDiv.max*ee+K*$,n.facetPartitioning[_e]=n.facetPartitioning[_e]?n.facetPartitioning[_e]:new Array,n.facetPartitioning[ge]=n.facetPartitioning[ge]?n.facetPartitioning[ge]:new Array,n.facetPartitioning[me]=n.facetPartitioning[me]?n.facetPartitioning[me]:new Array,n.facetPartitioning[ve]=n.facetPartitioning[ve]?n.facetPartitioning[ve]:new Array,n.facetPartitioning[ge].push(s),me!=ge&&n.facetPartitioning[me].push(s),ve==me||ve==ge||n.facetPartitioning[ve].push(s),_e==ge||_e==me||_e==ve||n.facetPartitioning[_e].push(s)),D&&n&&n.facetPositions){var He=z[s];He.ind=s*3,He.sqDistance=t.Vector3.DistanceSquared(n.facetPositions[s],U)}a[P]+=m,a[x]+=_,a[R]+=v,a[w]+=m,a[I]+=_,a[F]+=v,a[k]+=m,a[E]+=_,a[g]+=v}for(s=0;s<a.length/3;s++)m=a[s*3],_=a[s*3+1],v=a[s*3+2],S=Math.sqrt(m*m+_*_+v*v),S=S===0?1:S,m/=S,_/=S,v/=S,a[s*3]=m,a[s*3+1]=_,a[s*3+2]=v},c._ComputeSides=function(r,i,a,n,s,o,l){var u=a.length,h=n.length,d,p;switch(r=r||t.Mesh.DEFAULTSIDE,r){case t.Mesh.FRONTSIDE:break;case t.Mesh.BACKSIDE:var m;for(d=0;d<u;d+=3)m=a[d],a[d]=a[d+2],a[d+2]=m;for(p=0;p<h;p++)n[p]=-n[p];break;case t.Mesh.DOUBLESIDE:for(var _=i.length,v=_/3,S=0;S<_;S++)i[_+S]=i[S];for(d=0;d<u;d+=3)a[d+u]=a[d+2]+v,a[d+1+u]=a[d+1]+v,a[d+2+u]=a[d]+v;for(p=0;p<h;p++)n[h+p]=-n[p];var P=s.length,x=0;for(x=0;x<P;x++)s[x+P]=s[x];for(o=o||new t.Vector4(0,0,1,1),l=l||new t.Vector4(0,0,1,1),x=0,d=0;d<P/2;d++)s[x]=o.x+(o.z-o.x)*s[x],s[x+1]=o.y+(o.w-o.y)*s[x+1],s[x+P]=l.x+(l.z-l.x)*s[x+P],s[x+P+1]=l.y+(l.w-l.y)*s[x+P+1],x+=2;break}},c.ImportVertexData=function(r,i){var a=new c,n=r.positions;n&&a.set(n,t.VertexBuffer.PositionKind);var s=r.normals;s&&a.set(s,t.VertexBuffer.NormalKind);var o=r.tangents;o&&a.set(o,t.VertexBuffer.TangentKind);var l=r.uvs;l&&a.set(l,t.VertexBuffer.UVKind);var u=r.uv2s;u&&a.set(u,t.VertexBuffer.UV2Kind);var h=r.uv3s;h&&a.set(h,t.VertexBuffer.UV3Kind);var d=r.uv4s;d&&a.set(d,t.VertexBuffer.UV4Kind);var p=r.uv5s;p&&a.set(p,t.VertexBuffer.UV5Kind);var m=r.uv6s;m&&a.set(m,t.VertexBuffer.UV6Kind);var _=r.colors;_&&a.set(t.Color4.CheckColors4(_,n.length/3),t.VertexBuffer.ColorKind);var v=r.matricesIndices;v&&a.set(v,t.VertexBuffer.MatricesIndicesKind);var S=r.matricesWeights;S&&a.set(S,t.VertexBuffer.MatricesWeightsKind);var P=r.indices;P&&(a.indices=P),i.setAllVerticesData(a,r.updatable)},c}();t.VertexData=f})(T||(T={}));var T;(function(t){var f=function(){function p(m,_,v,S,P){S===void 0&&(S=!1),P===void 0&&(P=null),this.delayLoadState=t.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=m,this._engine=_.getEngine(),this._meshes=[],this._scene=_,this._vertexBuffers={},this._indices=[],this._updatable=S,v?this.setAllVerticesData(v,S):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),P&&(P.getClassName()==="LinesMesh"&&(this.boundingBias=new t.Vector2(0,P.intersectionThreshold),this._updateExtend()),this.applyToMesh(P),P.computeWorldMatrix(!0))}return Object.defineProperty(p.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(m){if(this._boundingBias){if(this._boundingBias.equals(m))return;this._boundingBias.copyFrom(m)}else this._boundingBias=m.clone();this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),p.CreateGeometryForMesh=function(m){var _=new p(p.RandomId(),m.getScene());return _.applyToMesh(m),_},Object.defineProperty(p.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),p.prototype.getScene=function(){return this._scene},p.prototype.getEngine=function(){return this._engine},p.prototype.isReady=function(){return this.delayLoadState===t.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===t.Engine.DELAYLOADSTATE_NONE},Object.defineProperty(p.prototype,"doNotSerialize",{get:function(){for(var m=0;m<this._meshes.length;m++)if(!this._meshes[m].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),p.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var m in this._vertexBuffers){var _=this._vertexBuffers[m];_._rebuild()}},p.prototype.setAllVerticesData=function(m,_){m.applyToGeometry(this,_),this.notifyUpdate()},p.prototype.setVerticesData=function(m,_,v,S){v===void 0&&(v=!1);var P=new t.VertexBuffer(this._engine,_,m,v,this._meshes.length===0,S);this.setVerticesBuffer(P)},p.prototype.removeVerticesData=function(m){this._vertexBuffers[m]&&(this._vertexBuffers[m].dispose(),delete this._vertexBuffers[m])},p.prototype.setVerticesBuffer=function(m,_){_===void 0&&(_=null);var v=m.getKind();if(this._vertexBuffers[v]&&this._vertexBuffers[v].dispose(),this._vertexBuffers[v]=m,v===t.VertexBuffer.PositionKind){var S=m.getData();_!=null?this._totalVertices=_:S!=null&&(this._totalVertices=S.length/(m.byteStride/4)),this._updateExtend(S),this._resetPointsArrayCache();for(var P=this._meshes,x=P.length,R=0;R<x;R++){var w=P[R];w._boundingInfo=new t.BoundingInfo(this._extend.minimum,this._extend.maximum),w._createGlobalSubMesh(!1),w.computeWorldMatrix(!0)}}this.notifyUpdate(v),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},p.prototype.updateVerticesDataDirectly=function(m,_,v,S){S===void 0&&(S=!1);var P=this.getVertexBuffer(m);P&&(P.updateDirectly(_,v,S),this.notifyUpdate(m))},p.prototype.updateVerticesData=function(m,_,v){v===void 0&&(v=!1);var S=this.getVertexBuffer(m);S&&(S.update(_),m===t.VertexBuffer.PositionKind&&this._updateBoundingInfo(v,_),this.notifyUpdate(m))},p.prototype._updateBoundingInfo=function(m,_){m&&this._updateExtend(_);var v=this._meshes,S=v.length;this._resetPointsArrayCache();for(var P=0;P<S;P++){var x=v[P];if(m){x._boundingInfo=new t.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var R=0;R<x.subMeshes.length;R++){var w=x.subMeshes[R];w.refreshBoundingInfo()}}}},p.prototype._bind=function(m,_){if(m){_===void 0&&(_=this._indexBuffer);var v=this.getVertexBuffers();if(v){if(_!=this._indexBuffer||!this._vertexArrayObjects){this._engine.bindBuffers(v,_,m);return}this._vertexArrayObjects[m.key]||(this._vertexArrayObjects[m.key]=this._engine.recordVertexArrayObject(v,_,m)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[m.key],_)}}},p.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},p.prototype.getVerticesData=function(m,_,v){var S=this.getVertexBuffer(m);if(!S)return null;var P=S.getData();if(!P)return null;var x=S.getSize()*t.VertexBuffer.GetTypeByteLength(S.type),R=this._totalVertices*S.getSize();if(S.type!==t.VertexBuffer.FLOAT||S.byteStride!==x){var w=new Array(R);return S.forEach(R,function(E,g){w[g]=E}),w}if(!(P instanceof Array||P instanceof Float32Array)||S.byteOffset!==0||P.length!==R)if(P instanceof Array){var I=S.byteOffset/4;return t.Tools.Slice(P,I,I+R)}else{if(P instanceof ArrayBuffer)return new Float32Array(P,S.byteOffset,R);var I=P.byteOffset+S.byteOffset;if(v||_&&this._meshes.length!==1){var F=new Float32Array(R),k=new Float32Array(P.buffer,I,R);return F.set(k),F}return new Float32Array(P.buffer,I,Math.min(R,P.buffer.byteLength/4))}return v||_&&this._meshes.length!==1?t.Tools.Slice(P):P},p.prototype.isVertexBufferUpdatable=function(m){var _=this._vertexBuffers[m];return _?_.isUpdatable():!1},p.prototype.getVertexBuffer=function(m){return this.isReady()?this._vertexBuffers[m]:null},p.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},p.prototype.isVerticesDataPresent=function(m){return this._vertexBuffers?this._vertexBuffers[m]!==void 0:this._delayInfo?this._delayInfo.indexOf(m)!==-1:!1},p.prototype.getVerticesDataKinds=function(){var m=[],_;if(!this._vertexBuffers&&this._delayInfo)for(_ in this._delayInfo)m.push(_);else for(_ in this._vertexBuffers)m.push(_);return m},p.prototype.updateIndices=function(m,_){this._indexBuffer&&(this._indexBufferIsUpdatable?this._engine.updateDynamicIndexBuffer(this._indexBuffer,m,_):this.setIndices(m,null,!0))},p.prototype.setIndices=function(m,_,v){_===void 0&&(_=null),v===void 0&&(v=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=m,this._indexBufferIsUpdatable=v,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,v)),_!=null&&(this._totalVertices=_);for(var S=this._meshes,P=S.length,x=0;x<P;x++)S[x]._createGlobalSubMesh(!0);this.notifyUpdate()},p.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},p.prototype.getIndices=function(m,_){if(!this.isReady())return null;var v=this._indices;if(!_&&(!m||this._meshes.length===1))return v;for(var S=v.length,P=[],x=0;x<S;x++)P.push(v[x]);return P},p.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},p.prototype._releaseVertexArrayObject=function(m){m===void 0&&(m=null),!(!m||!this._vertexArrayObjects)&&this._vertexArrayObjects[m.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[m.key]),delete this._vertexArrayObjects[m.key])},p.prototype.releaseForMesh=function(m,_){var v=this._meshes,S=v.indexOf(m);S!==-1&&(v.splice(S,1),m._geometry=null,v.length===0&&_&&this.dispose())},p.prototype.applyToMesh=function(m){if(m._geometry!==this){var _=m._geometry;_&&_.releaseForMesh(m);var v=this._meshes;m._geometry=this,this._scene.pushGeometry(this),v.push(m),this.isReady()?this._applyToMesh(m):m._boundingInfo=this._boundingInfo}},p.prototype._updateExtend=function(m){m===void 0&&(m=null),m||(m=this.getVerticesData(t.VertexBuffer.PositionKind)),this._extend=t.Tools.ExtractMinAndMax(m,0,this._totalVertices,this.boundingBias,3)},p.prototype._applyToMesh=function(m){var _=this._meshes.length;for(var v in this._vertexBuffers){_===1&&this._vertexBuffers[v].create();var S=this._vertexBuffers[v].getBuffer();S&&(S.references=_),v===t.VertexBuffer.PositionKind&&(this._extend||this._updateExtend(),m._boundingInfo=new t.BoundingInfo(this._extend.minimum,this._extend.maximum),m._createGlobalSubMesh(!1),m._updateBoundingInfo())}_===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=_),m._syncGeometryWithMorphTargetManager()},p.prototype.notifyUpdate=function(m){this.onGeometryUpdated&&this.onGeometryUpdated(this,m);for(var _=0,v=this._meshes;_<v.length;_++){var S=v[_];S._markSubMeshesAsAttributesDirty()}},p.prototype.load=function(m,_){if(this.delayLoadState!==t.Engine.DELAYLOADSTATE_LOADING){if(this.isReady()){_&&_();return}this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(m,_)}},p.prototype._queueLoad=function(m,_){var v=this;this.delayLoadingFile&&(m._addPendingData(this),m._loadFile(this.delayLoadingFile,function(S){if(v._delayLoadingFunction){v._delayLoadingFunction(JSON.parse(S),v),v.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,v._delayInfo=[],m._removePendingData(v);for(var P=v._meshes,x=P.length,R=0;R<x;R++)v._applyToMesh(P[R]);_&&_()}},void 0,!0))},p.prototype.toLeftHanded=function(){var m=this.getIndices(!1);if(m!=null&&m.length>0){for(var _=0;_<m.length;_+=3){var v=m[_+0];m[_+0]=m[_+2],m[_+2]=v}this.setIndices(m)}var S=this.getVerticesData(t.VertexBuffer.PositionKind,!1);if(S!=null&&S.length>0){for(var _=0;_<S.length;_+=3)S[_+2]=-S[_+2];this.setVerticesData(t.VertexBuffer.PositionKind,S,!1)}var P=this.getVerticesData(t.VertexBuffer.NormalKind,!1);if(P!=null&&P.length>0){for(var _=0;_<P.length;_+=3)P[_+2]=-P[_+2];this.setVerticesData(t.VertexBuffer.NormalKind,P,!1)}},p.prototype._resetPointsArrayCache=function(){this._positions=null},p.prototype._generatePointsArray=function(){if(this._positions)return!0;var m=this.getVerticesData(t.VertexBuffer.PositionKind);if(!m||m.length===0)return!1;this._positions=[];for(var _=0;_<m.length;_+=3)this._positions.push(t.Vector3.FromArray(m,_));return!0},p.prototype.isDisposed=function(){return this._isDisposed},p.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var m in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[m]);this._vertexArrayObjects={}}},p.prototype.dispose=function(){var m=this._meshes,_=m.length,v;for(v=0;v<_;v++)this.releaseForMesh(m[v]);this._meshes=[],this._disposeVertexArrayObjects();for(var S in this._vertexBuffers)this._vertexBuffers[S].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=t.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},p.prototype.copy=function(m){var _=new t.VertexData;_.indices=[];var v=this.getIndices();if(v)for(var S=0;S<v.length;S++)_.indices.push(v[S]);var P=!1,x=!1,R;for(R in this._vertexBuffers){var w=this.getVerticesData(R);if(w instanceof Float32Array?_.set(new Float32Array(w),R):_.set(w.slice(0),R),!x){var I=this.getVertexBuffer(R);I&&(P=I.isUpdatable(),x=!P)}}var F=new p(m,this._scene,_,P);F.delayLoadState=this.delayLoadState,F.delayLoadingFile=this.delayLoadingFile,F._delayLoadingFunction=this._delayLoadingFunction;for(R in this._delayInfo)F._delayInfo=F._delayInfo||[],F._delayInfo.push(R);return F._boundingInfo=new t.BoundingInfo(this._extend.minimum,this._extend.maximum),F},p.prototype.serialize=function(){var m={};return m.id=this.id,m.updatable=this._updatable,t.Tags&&t.Tags.HasTags(this)&&(m.tags=t.Tags.GetTags(this)),m},p.prototype.toNumberArray=function(m){return Array.isArray(m)?m:Array.prototype.slice.call(m)},p.prototype.serializeVerticeData=function(){var m=this.serialize();return this.isVerticesDataPresent(t.VertexBuffer.PositionKind)&&(m.positions=this.toNumberArray(this.getVerticesData(t.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(t.VertexBuffer.PositionKind)&&(m.positions._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(m.normals=this.toNumberArray(this.getVerticesData(t.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(t.VertexBuffer.NormalKind)&&(m.normals._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(m.tangets=this.toNumberArray(this.getVerticesData(t.VertexBuffer.TangentKind)),this.isVertexBufferUpdatable(t.VertexBuffer.TangentKind)&&(m.tangets._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(m.uvs=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(t.VertexBuffer.UVKind)&&(m.uvs._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(m.uv2s=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(t.VertexBuffer.UV2Kind)&&(m.uv2s._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UV3Kind)&&(m.uv3s=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(t.VertexBuffer.UV3Kind)&&(m.uv3s._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UV4Kind)&&(m.uv4s=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(t.VertexBuffer.UV4Kind)&&(m.uv4s._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UV5Kind)&&(m.uv5s=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(t.VertexBuffer.UV5Kind)&&(m.uv5s._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.UV6Kind)&&(m.uv6s=this.toNumberArray(this.getVerticesData(t.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(t.VertexBuffer.UV6Kind)&&(m.uv6s._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.ColorKind)&&(m.colors=this.toNumberArray(this.getVerticesData(t.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(t.VertexBuffer.ColorKind)&&(m.colors._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.MatricesIndicesKind)&&(m.matricesIndices=this.toNumberArray(this.getVerticesData(t.VertexBuffer.MatricesIndicesKind)),m.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(t.VertexBuffer.MatricesIndicesKind)&&(m.matricesIndices._updatable=!0)),this.isVerticesDataPresent(t.VertexBuffer.MatricesWeightsKind)&&(m.matricesWeights=this.toNumberArray(this.getVerticesData(t.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(t.VertexBuffer.MatricesWeightsKind)&&(m.matricesWeights._updatable=!0)),m.indices=this.toNumberArray(this.getIndices()),m},p.ExtractFromMesh=function(m,_){var v=m._geometry;return v?v.copy(_):null},p.RandomId=function(){return t.Tools.RandomId()},p._ImportGeometry=function(m,_){var v=_.getScene(),S=m.geometryId;if(S){var P=v.getGeometryByID(S);P&&P.applyToMesh(_)}else if(m instanceof ArrayBuffer){var x=_._binaryInfo;if(x.positionsAttrDesc&&x.positionsAttrDesc.count>0){var R=new Float32Array(m,x.positionsAttrDesc.offset,x.positionsAttrDesc.count);_.setVerticesData(t.VertexBuffer.PositionKind,R,!1)}if(x.normalsAttrDesc&&x.normalsAttrDesc.count>0){var w=new Float32Array(m,x.normalsAttrDesc.offset,x.normalsAttrDesc.count);_.setVerticesData(t.VertexBuffer.NormalKind,w,!1)}if(x.tangetsAttrDesc&&x.tangetsAttrDesc.count>0){var I=new Float32Array(m,x.tangetsAttrDesc.offset,x.tangetsAttrDesc.count);_.setVerticesData(t.VertexBuffer.TangentKind,I,!1)}if(x.uvsAttrDesc&&x.uvsAttrDesc.count>0){var F=new Float32Array(m,x.uvsAttrDesc.offset,x.uvsAttrDesc.count);_.setVerticesData(t.VertexBuffer.UVKind,F,!1)}if(x.uvs2AttrDesc&&x.uvs2AttrDesc.count>0){var k=new Float32Array(m,x.uvs2AttrDesc.offset,x.uvs2AttrDesc.count);_.setVerticesData(t.VertexBuffer.UV2Kind,k,!1)}if(x.uvs3AttrDesc&&x.uvs3AttrDesc.count>0){var E=new Float32Array(m,x.uvs3AttrDesc.offset,x.uvs3AttrDesc.count);_.setVerticesData(t.VertexBuffer.UV3Kind,E,!1)}if(x.uvs4AttrDesc&&x.uvs4AttrDesc.count>0){var g=new Float32Array(m,x.uvs4AttrDesc.offset,x.uvs4AttrDesc.count);_.setVerticesData(t.VertexBuffer.UV4Kind,g,!1)}if(x.uvs5AttrDesc&&x.uvs5AttrDesc.count>0){var y=new Float32Array(m,x.uvs5AttrDesc.offset,x.uvs5AttrDesc.count);_.setVerticesData(t.VertexBuffer.UV5Kind,y,!1)}if(x.uvs6AttrDesc&&x.uvs6AttrDesc.count>0){var M=new Float32Array(m,x.uvs6AttrDesc.offset,x.uvs6AttrDesc.count);_.setVerticesData(t.VertexBuffer.UV6Kind,M,!1)}if(x.colorsAttrDesc&&x.colorsAttrDesc.count>0){var C=new Float32Array(m,x.colorsAttrDesc.offset,x.colorsAttrDesc.count);_.setVerticesData(t.VertexBuffer.ColorKind,C,!1,x.colorsAttrDesc.stride)}if(x.matricesIndicesAttrDesc&&x.matricesIndicesAttrDesc.count>0){for(var D=new Int32Array(m,x.matricesIndicesAttrDesc.offset,x.matricesIndicesAttrDesc.count),V=[],G=0;G<D.length;G++){var U=D[G];V.push(U&255),V.push((U&65280)>>8),V.push((U&16711680)>>16),V.push(U>>24)}_.setVerticesData(t.VertexBuffer.MatricesIndicesKind,V,!1)}if(x.matricesWeightsAttrDesc&&x.matricesWeightsAttrDesc.count>0){var z=new Float32Array(m,x.matricesWeightsAttrDesc.offset,x.matricesWeightsAttrDesc.count);_.setVerticesData(t.VertexBuffer.MatricesWeightsKind,z,!1)}if(x.indicesAttrDesc&&x.indicesAttrDesc.count>0){var H=new Int32Array(m,x.indicesAttrDesc.offset,x.indicesAttrDesc.count);_.setIndices(H,null)}if(x.subMeshesAttrDesc&&x.subMeshesAttrDesc.count>0){var W=new Int32Array(m,x.subMeshesAttrDesc.offset,x.subMeshesAttrDesc.count*5);_.subMeshes=[];for(var G=0;G<x.subMeshesAttrDesc.count;G++){var X=W[G*5+0],K=W[G*5+1],j=W[G*5+2],ee=W[G*5+3],$=W[G*5+4];t.SubMesh.AddToMesh(X,K,j,ee,$,_)}}}else if(m.positions&&m.normals&&m.indices){if(_.setVerticesData(t.VertexBuffer.PositionKind,m.positions,m.positions._updatable),_.setVerticesData(t.VertexBuffer.NormalKind,m.normals,m.normals._updatable),m.tangents&&_.setVerticesData(t.VertexBuffer.TangentKind,m.tangents,m.tangents._updatable),m.uvs&&_.setVerticesData(t.VertexBuffer.UVKind,m.uvs,m.uvs._updatable),m.uvs2&&_.setVerticesData(t.VertexBuffer.UV2Kind,m.uvs2,m.uvs2._updatable),m.uvs3&&_.setVerticesData(t.VertexBuffer.UV3Kind,m.uvs3,m.uvs3._updatable),m.uvs4&&_.setVerticesData(t.VertexBuffer.UV4Kind,m.uvs4,m.uvs4._updatable),m.uvs5&&_.setVerticesData(t.VertexBuffer.UV5Kind,m.uvs5,m.uvs5._updatable),m.uvs6&&_.setVerticesData(t.VertexBuffer.UV6Kind,m.uvs6,m.uvs6._updatable),m.colors&&_.setVerticesData(t.VertexBuffer.ColorKind,t.Color4.CheckColors4(m.colors,m.positions.length/3),m.colors._updatable),m.matricesIndices)if(m.matricesIndices._isExpanded)delete m.matricesIndices._isExpanded,_.setVerticesData(t.VertexBuffer.MatricesIndicesKind,m.matricesIndices,m.matricesIndices._updatable);else{for(var V=[],G=0;G<m.matricesIndices.length;G++){var L=m.matricesIndices[G];V.push(L&255),V.push((L&65280)>>8),V.push((L&16711680)>>16),V.push(L>>24)}_.setVerticesData(t.VertexBuffer.MatricesIndicesKind,V,m.matricesIndices._updatable)}if(m.matricesIndicesExtra)if(m.matricesIndicesExtra._isExpanded)delete m.matricesIndices._isExpanded,_.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,m.matricesIndicesExtra,m.matricesIndicesExtra._updatable);else{for(var V=[],G=0;G<m.matricesIndicesExtra.length;G++){var L=m.matricesIndicesExtra[G];V.push(L&255),V.push((L&65280)>>8),V.push((L&16711680)>>16),V.push(L>>24)}_.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,V,m.matricesIndicesExtra._updatable)}m.matricesWeights&&(p._CleanMatricesWeights(m,_),_.setVerticesData(t.VertexBuffer.MatricesWeightsKind,m.matricesWeights,m.matricesWeights._updatable)),m.matricesWeightsExtra&&_.setVerticesData(t.VertexBuffer.MatricesWeightsExtraKind,m.matricesWeightsExtra,m.matricesWeights._updatable),_.setIndices(m.indices,null)}if(m.subMeshes){_.subMeshes=[];for(var Q=0;Q<m.subMeshes.length;Q++){var J=m.subMeshes[Q];t.SubMesh.AddToMesh(J.materialIndex,J.verticesStart,J.verticesCount,J.indexStart,J.indexCount,_)}}_._shouldGenerateFlatShading&&(_.convertToFlatShadedMesh(),delete _._shouldGenerateFlatShading),_.computeWorldMatrix(!0),v.onMeshImportedObservable.notifyObservers(_)},p._CleanMatricesWeights=function(m,_){var v=.001;if(t.SceneLoader.CleanBoneMatrixWeights){var S=0;if(m.skeletonId>-1){var P=_.getScene().getLastSkeletonByID(m.skeletonId);if(!P)return;S=P.bones.length}else return;for(var x=_.getVerticesData(t.VertexBuffer.MatricesIndicesKind),R=_.getVerticesData(t.VertexBuffer.MatricesIndicesExtraKind),w=m.matricesWeights,I=m.matricesWeightsExtra,F=m.numBoneInfluencer,k=w.length,E=0;E<k;E+=4){for(var g=0,y=-1,M=0;M<4;M++){var C=w[E+M];g+=C,C<v&&y<0&&(y=M)}if(I)for(var M=0;M<4;M++){var C=I[E+M];g+=C,C<v&&y<0&&(y=M+4)}if((y<0||y>F-1)&&(y=F-1),g>v){for(var D=1/g,M=0;M<4;M++)w[E+M]*=D;if(I)for(var M=0;M<4;M++)I[E+M]*=D}else y>=4?(I[E+y-4]=1-g,R[E+y-4]=S):(w[E+y]=1-g,x[E+y]=S)}_.setVerticesData(t.VertexBuffer.MatricesIndicesKind,x),m.matricesWeightsExtra&&_.setVerticesData(t.VertexBuffer.MatricesIndicesExtraKind,R)}},p.Parse=function(m,_,v){if(_.getGeometryByID(m.id))return null;var S=new p(m.id,_,void 0,m.updatable);return t.Tags&&t.Tags.AddTagsTo(S,m.tags),m.delayLoadingFile?(S.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED,S.delayLoadingFile=v+m.delayLoadingFile,S._boundingInfo=new t.BoundingInfo(t.Vector3.FromArray(m.boundingBoxMinimum),t.Vector3.FromArray(m.boundingBoxMaximum)),S._delayInfo=[],m.hasUVs&&S._delayInfo.push(t.VertexBuffer.UVKind),m.hasUVs2&&S._delayInfo.push(t.VertexBuffer.UV2Kind),m.hasUVs3&&S._delayInfo.push(t.VertexBuffer.UV3Kind),m.hasUVs4&&S._delayInfo.push(t.VertexBuffer.UV4Kind),m.hasUVs5&&S._delayInfo.push(t.VertexBuffer.UV5Kind),m.hasUVs6&&S._delayInfo.push(t.VertexBuffer.UV6Kind),m.hasColors&&S._delayInfo.push(t.VertexBuffer.ColorKind),m.hasMatricesIndices&&S._delayInfo.push(t.VertexBuffer.MatricesIndicesKind),m.hasMatricesWeights&&S._delayInfo.push(t.VertexBuffer.MatricesWeightsKind),S._delayLoadingFunction=t.VertexData.ImportVertexData):t.VertexData.ImportVertexData(m,S),_.pushGeometry(S,!0),S},p}();t.Geometry=f;var c=function(p){N(m,p);function m(_,v,S,P){S===void 0&&(S=!1),P===void 0&&(P=null);var x=p.call(this,_,v,void 0,!1,P)||this;return x._canBeRegenerated=S,x._beingRegenerated=!0,x.regenerate(),x._beingRegenerated=!1,x}return m.prototype.canBeRegenerated=function(){return this._canBeRegenerated},m.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},m.prototype.asNewGeometry=function(_){return p.prototype.copy.call(this,_)},m.prototype.setAllVerticesData=function(_,v){this._beingRegenerated&&p.prototype.setAllVerticesData.call(this,_,!1)},m.prototype.setVerticesData=function(_,v,S){this._beingRegenerated&&p.prototype.setVerticesData.call(this,_,v,!1)},m.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},m.prototype.copy=function(_){throw new Error("Must be overriden in sub-classes.")},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.canBeRegenerated=this.canBeRegenerated(),_},m}(f);t._PrimitiveGeometry=c;var r=function(p){N(m,p);function m(_,v,S,P,x,R,w,I,F){F===void 0&&(F=t.Mesh.DEFAULTSIDE);var k=p.call(this,_,v,w,I)||this;return k.pathArray=S,k.closeArray=P,k.closePath=x,k.offset=R,k.side=F,k}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},m}(c);t.RibbonGeometry=r;var i=function(p){N(m,p);function m(_,v,S,P,x,R){x===void 0&&(x=null),R===void 0&&(R=t.Mesh.DEFAULTSIDE);var w=p.call(this,_,v,P,x)||this;return w.size=S,w.side=R,w}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.size=this.size,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.size,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.BoxGeometry=i;var a=function(p){N(m,p);function m(_,v,S,P,x,R,w){R===void 0&&(R=null),w===void 0&&(w=t.Mesh.DEFAULTSIDE);var I=p.call(this,_,v,x,R)||this;return I.segments=S,I.diameter=P,I.side=w,I}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.segments=this.segments,_.diameter=this.diameter,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.segments,_.diameter,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.SphereGeometry=a;var n=function(p){N(m,p);function m(_,v,S,P,x,R,w){R===void 0&&(R=null),w===void 0&&(w=t.Mesh.DEFAULTSIDE);var I=p.call(this,_,v,x,R)||this;return I.radius=S,I.tessellation=P,I.side=w,I}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},m}(c);t.DiscGeometry=n;var s=function(p){N(m,p);function m(_,v,S,P,x,R,w,I,F,k){w===void 0&&(w=1),F===void 0&&(F=null),k===void 0&&(k=t.Mesh.DEFAULTSIDE);var E=p.call(this,_,v,I,F)||this;return E.height=S,E.diameterTop=P,E.diameterBottom=x,E.tessellation=R,E.subdivisions=w,E.side=k,E}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.height=this.height,_.diameterTop=this.diameterTop,_.diameterBottom=this.diameterBottom,_.tessellation=this.tessellation,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.height,_.diameterTop,_.diameterBottom,_.tessellation,_.subdivisions,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.CylinderGeometry=s;var o=function(p){N(m,p);function m(_,v,S,P,x,R,w,I){w===void 0&&(w=null),I===void 0&&(I=t.Mesh.DEFAULTSIDE);var F=p.call(this,_,v,R,w)||this;return F.diameter=S,F.thickness=P,F.tessellation=x,F.side=I,F}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.diameter=this.diameter,_.thickness=this.thickness,_.tessellation=this.tessellation,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.diameter,_.thickness,_.tessellation,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.TorusGeometry=o;var l=function(p){N(m,p);function m(_,v,S,P,x,R,w){w===void 0&&(w=null);var I=p.call(this,_,v,R,w)||this;return I.width=S,I.height=P,I.subdivisions=x,I}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.width=this.width,_.height=this.height,_.subdivisions=this.subdivisions,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.width,_.height,_.subdivisions,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.GroundGeometry=l;var u=function(p){N(m,p);function m(_,v,S,P,x,R,w,I,F,k){k===void 0&&(k=null);var E=p.call(this,_,v,F,k)||this;return E.xmin=S,E.zmin=P,E.xmax=x,E.zmax=R,E.subdivisions=w,E.precision=I,E}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},m}(c);t.TiledGroundGeometry=u;var h=function(p){N(m,p);function m(_,v,S,P,x,R){x===void 0&&(x=null),R===void 0&&(R=t.Mesh.DEFAULTSIDE);var w=p.call(this,_,v,P,x)||this;return w.size=S,w.side=R,w}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.size=this.size,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.size,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.PlaneGeometry=h;var d=function(p){N(m,p);function m(_,v,S,P,x,R,w,I,F,k,E){k===void 0&&(k=null),E===void 0&&(E=t.Mesh.DEFAULTSIDE);var g=p.call(this,_,v,F,k)||this;return g.radius=S,g.tube=P,g.radialSegments=x,g.tubularSegments=R,g.p=w,g.q=I,g.side=E,g}return m.prototype._regenerateVertexData=function(){return t.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},m.prototype.copy=function(_){return new m(_,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},m.prototype.serialize=function(){var _=p.prototype.serialize.call(this);return _.radius=this.radius,_.tube=this.tube,_.radialSegments=this.radialSegments,_.tubularSegments=this.tubularSegments,_.p=this.p,_.q=this.q,_},m.Parse=function(_,v){if(v.getGeometryByID(_.id))return null;var S=new m(_.id,v,_.radius,_.tube,_.radialSegments,_.tubularSegments,_.p,_.q,_.canBeRegenerated,null);return t.Tags&&t.Tags.AddTagsTo(S,_.tags),v.pushGeometry(S,!0),S},m}(c);t.TorusKnotGeometry=d})(T||(T={}));var T;(function(t){var f=function(){function r(i){i===void 0&&(i=30),this._enabled=!0,this._rollingFrameTime=new c(i)}return r.prototype.sampleFrame=function(i){if(i===void 0&&(i=t.Tools.Now),!!this._enabled){if(this._lastFrameTimeMs!=null){var a=i-this._lastFrameTimeMs;this._rollingFrameTime.add(a)}this._lastFrameTimeMs=i}},Object.defineProperty(r.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFPS",{get:function(){var i=this._rollingFrameTime.history(0);return i===0?0:1e3/i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),r.prototype.enable=function(){this._enabled=!0},r.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},r}();t.PerformanceMonitor=f;var c=function(){function r(i){this._samples=new Array(i),this.reset()}return r.prototype.add=function(i){var a;if(this.isSaturated()){var n=this._samples[this._pos];a=n-this.average,this.average-=a/(this._sampleCount-1),this._m2-=a*(n-this.average)}else this._sampleCount++;a=i-this.average,this.average+=a/this._sampleCount,this._m2+=a*(i-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=i,this._pos++,this._pos%=this._samples.length},r.prototype.history=function(i){if(i>=this._sampleCount||i>=this._samples.length)return 0;var a=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(a-i)]},r.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},r.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},r.prototype._wrapPosition=function(i){var a=this._samples.length;return(i%a+a)%a},r}();t.RollingAverage=c})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.BindEyePosition=function(r,i){if(i._forcedViewPosition){r.setVector3("vEyePosition",i._forcedViewPosition);return}r.setVector3("vEyePosition",i._mirroredCameraPosition?i._mirroredCameraPosition:i.activeCamera.globalPosition)},c.PrepareDefinesForMergedUV=function(r,i,a){i._needUVs=!0,i[a]=!0,r.getTextureMatrix().isIdentity(!0)?(i[a+"DIRECTUV"]=r.coordinatesIndex+1,r.coordinatesIndex===0?i.MAINUV1=!0:i.MAINUV2=!0):i[a+"DIRECTUV"]=0},c.BindTextureMatrix=function(r,i,a){var n=r.getTextureMatrix();n.isIdentity(!0)||i.updateMatrix(a+"Matrix",n)},c.PrepareDefinesForMisc=function(r,i,a,n,s,o,l){l._areMiscDirty&&(l.LOGARITHMICDEPTH=a,l.POINTSIZE=n,l.FOG=i.fogEnabled&&r.applyFog&&i.fogMode!==t.Scene.FOGMODE_NONE&&s,l.NONUNIFORMSCALING=r.nonUniformScaling,l.ALPHATEST=o)},c.PrepareDefinesForFrameBoundValues=function(r,i,a,n,s){s===void 0&&(s=null);var o=!1,l=!1,u=!1,h=!1,d=!1;l=s??(r.clipPlane!==void 0&&r.clipPlane!==null),u=s??(r.clipPlane2!==void 0&&r.clipPlane2!==null),h=s??(r.clipPlane3!==void 0&&r.clipPlane3!==null),d=s??(r.clipPlane4!==void 0&&r.clipPlane4!==null),a.CLIPPLANE!==l&&(a.CLIPPLANE=l,o=!0),a.CLIPPLANE2!==u&&(a.CLIPPLANE2=u,o=!0),a.CLIPPLANE3!==h&&(a.CLIPPLANE3=h,o=!0),a.CLIPPLANE4!==d&&(a.CLIPPLANE4=d,o=!0),a.DEPTHPREPASS!==!i.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,o=!0),a.INSTANCES!==n&&(a.INSTANCES=n,o=!0),o&&a.markAsUnprocessed()},c.PrepareDefinesForAttributes=function(r,i,a,n,s,o){if(s===void 0&&(s=!1),o===void 0&&(o=!0),!i._areAttributesDirty&&i._needNormals===i._normals&&i._needUVs===i._uvs)return!1;if(i._normals=i._needNormals,i._uvs=i._needUVs,i.NORMAL=i._needNormals&&r.isVerticesDataPresent(t.VertexBuffer.NormalKind),i._needNormals&&r.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&(i.TANGENT=!0),i._needUVs?(i.UV1=r.isVerticesDataPresent(t.VertexBuffer.UVKind),i.UV2=r.isVerticesDataPresent(t.VertexBuffer.UV2Kind)):(i.UV1=!1,i.UV2=!1),a){var l=r.useVertexColors&&r.isVerticesDataPresent(t.VertexBuffer.ColorKind);i.VERTEXCOLOR=l,i.VERTEXALPHA=r.hasVertexAlpha&&l&&o}if(n&&(r.useBones&&r.computeBonesUsingShaders&&r.skeleton?(i.NUM_BONE_INFLUENCERS=r.numBoneInfluencers,i.BonesPerMesh=r.skeleton.bones.length+1):(i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0)),s){var u=r.morphTargetManager;u?(i.MORPHTARGETS_TANGENT=u.supportsTangents&&i.TANGENT,i.MORPHTARGETS_NORMAL=u.supportsNormals&&i.NORMAL,i.MORPHTARGETS=u.numInfluencers>0,i.NUM_MORPH_INFLUENCERS=u.numInfluencers):(i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS=!1,i.NUM_MORPH_INFLUENCERS=0)}return!0},c.PrepareDefinesForLights=function(r,i,a,n,s,o){if(s===void 0&&(s=4),o===void 0&&(o=!1),!a._areLightsDirty)return a._needNormals;var l=0,u=!1,h=!1,d=!1,p=!1,m=!1;if(r.lightsEnabled&&!o)for(var _=0,v=i._lightSources;_<v.length;_++){var S=v[_];switch(u=!0,a["LIGHT"+l]===void 0&&(h=!0),a["LIGHT"+l]=!0,a["SPOTLIGHT"+l]=!1,a["HEMILIGHT"+l]=!1,a["POINTLIGHT"+l]=!1,a["DIRLIGHT"+l]=!1,S.prepareLightSpecificDefines(a,l),a["LIGHT_FALLOFF_PHYSICAL"+l]=!1,a["LIGHT_FALLOFF_GLTF"+l]=!1,a["LIGHT_FALLOFF_STANDARD"+l]=!1,S.falloffType){case t.Light.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+l]=!0;break;case t.Light.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+l]=!0;break;case t.Light.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+l]=!0;break}if(n&&!S.specular.equalsFloats(0,0,0)&&(m=!0),a["SHADOW"+l]=!1,a["SHADOWPCF"+l]=!1,a["SHADOWPCSS"+l]=!1,a["SHADOWPOISSON"+l]=!1,a["SHADOWESM"+l]=!1,a["SHADOWCUBE"+l]=!1,a["SHADOWLOWQUALITY"+l]=!1,a["SHADOWMEDIUMQUALITY"+l]=!1,i&&i.receiveShadows&&r.shadowsEnabled&&S.shadowEnabled){var P=S.getShadowGenerator();if(P){var x=P.getShadowMap();x&&x.renderList&&x.renderList.length>0&&(p=!0,P.prepareDefines(a,l))}}if(S.lightmapMode!=t.Light.LIGHTMAP_DEFAULT?(d=!0,a["LIGHTMAPEXCLUDED"+l]=!0,a["LIGHTMAPNOSPECULAR"+l]=S.lightmapMode==t.Light.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+l]=!1,a["LIGHTMAPNOSPECULAR"+l]=!1),l++,l===s)break}a.SPECULARTERM=m,a.SHADOWS=p;for(var R=l;R<s;R++)a["LIGHT"+R]!==void 0&&(a["LIGHT"+R]=!1,a["HEMILIGHT"+l]=!1,a["POINTLIGHT"+l]=!1,a["DIRLIGHT"+l]=!1,a["SPOTLIGHT"+l]=!1,a["SHADOW"+l]=!1);var w=r.getEngine().getCaps();return a.SHADOWFLOAT===void 0&&(h=!0),a.SHADOWFLOAT=p&&(w.textureFloatRender&&w.textureFloatLinearFiltering||w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering),a.LIGHTMAPEXCLUDED=d,h&&a.rebuild(),u},c.PrepareUniformsAndSamplersList=function(r,i,a,n){n===void 0&&(n=4);var s,o=null;if(r.uniformsNames){var l=r;s=l.uniformsNames,o=l.uniformBuffersNames,i=l.samplers,a=l.defines,n=l.maxSimultaneousLights}else s=r,i||(i=[]);for(var u=0;u<n&&a["LIGHT"+u];u++)s.push("vLightData"+u,"vLightDiffuse"+u,"vLightSpecular"+u,"vLightDirection"+u,"vLightFalloff"+u,"vLightGround"+u,"lightMatrix"+u,"shadowsInfo"+u,"depthValues"+u),o&&o.push("Light"+u),i.push("shadowSampler"+u),i.push("depthSampler"+u),a["PROJECTEDLIGHTTEXTURE"+u]&&(i.push("projectionLightSampler"+u),s.push("textureProjectionMatrix"+u));a.NUM_MORPH_INFLUENCERS&&s.push("morphTargetInfluences")},c.HandleFallbacksForShadows=function(r,i,a,n){a===void 0&&(a=4),n===void 0&&(n=0);for(var s=0,o=0;o<a&&r["LIGHT"+o];o++)o>0&&(s=n+o,i.addFallback(s,"LIGHT"+o)),r.SHADOWS||(r["SHADOW"+o]&&i.addFallback(n,"SHADOW"+o),r["SHADOWPCF"+o]&&i.addFallback(n,"SHADOWPCF"+o),r["SHADOWPCSS"+o]&&i.addFallback(n,"SHADOWPCSS"+o),r["SHADOWPOISSON"+o]&&i.addFallback(n,"SHADOWPOISSON"+o),r["SHADOWESM"+o]&&i.addFallback(n,"SHADOWESM"+o));return s++},c.PrepareAttributesForMorphTargets=function(r,i,a){var n=a.NUM_MORPH_INFLUENCERS;if(n>0&&t.Engine.LastCreatedEngine)for(var s=t.Engine.LastCreatedEngine.getCaps().maxVertexAttribs,o=i.morphTargetManager,l=o&&o.supportsNormals&&a.NORMAL,u=o&&o.supportsTangents&&a.TANGENT,h=0;h<n;h++)r.push(t.VertexBuffer.PositionKind+h),l&&r.push(t.VertexBuffer.NormalKind+h),u&&r.push(t.VertexBuffer.TangentKind+h),r.length>s&&t.Tools.Error("Cannot add more vertex attributes for mesh "+i.name)},c.PrepareAttributesForBones=function(r,i,a,n){a.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,i),r.push(t.VertexBuffer.MatricesIndicesKind),r.push(t.VertexBuffer.MatricesWeightsKind),a.NUM_BONE_INFLUENCERS>4&&(r.push(t.VertexBuffer.MatricesIndicesExtraKind),r.push(t.VertexBuffer.MatricesWeightsExtraKind)))},c.PrepareAttributesForInstances=function(r,i){i.INSTANCES&&(r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"))},c.BindLightShadow=function(r,i,a,n,s){if(r.shadowEnabled&&a.receiveShadows){var o=r.getShadowGenerator();o&&o.bindShadowLight(n,s)}},c.BindLightProperties=function(r,i,a){r.transferToEffect(i,a+"")},c.BindLights=function(r,i,a,n,s,o){s===void 0&&(s=4),o===void 0&&(o=!1);for(var l=Math.min(i._lightSources.length,s),u=0;u<l;u++){var h=i._lightSources[u],d=u.toString(),p=h.getScaledIntensity();h._uniformBuffer.bindToEffect(a,"Light"+u),c.BindLightProperties(h,a,u),h.diffuse.scaleToRef(p,t.Tmp.Color3[0]),h._uniformBuffer.updateColor4("vLightDiffuse",t.Tmp.Color3[0],o?h.radius:h.range,d),n.SPECULARTERM&&(h.specular.scaleToRef(p,t.Tmp.Color3[1]),h._uniformBuffer.updateColor3("vLightSpecular",t.Tmp.Color3[1],d)),r.shadowsEnabled&&this.BindLightShadow(h,r,i,d,a),h._uniformBuffer.update()}},c.BindFogParameters=function(r,i,a,n){n===void 0&&(n=!1),r.fogEnabled&&i.applyFog&&r.fogMode!==t.Scene.FOGMODE_NONE&&(a.setFloat4("vFogInfos",r.fogMode,r.fogStart,r.fogEnd,r.fogDensity),n?(r.fogColor.toLinearSpaceToRef(this._tempFogColor),a.setColor3("vFogColor",this._tempFogColor)):a.setColor3("vFogColor",r.fogColor))},c.BindBonesParameters=function(r,i){if(!(!i||!r)&&(r.computeBonesUsingShaders&&i._bonesComputationForcedToCPU&&(r.computeBonesUsingShaders=!1),r.useBones&&r.computeBonesUsingShaders&&r.skeleton)){var a=r.skeleton.getTransformMatrices(r);a&&i.setMatrices("mBones",a)}},c.BindMorphTargetParameters=function(r,i){var a=r.morphTargetManager;!r||!a||i.setFloatArray("morphTargetInfluences",a.influences)},c.BindLogDepth=function(r,i,a){r.LOGARITHMICDEPTH&&i.setFloat("logarithmicDepthConstant",2/(Math.log(a.activeCamera.maxZ+1)/Math.LN2))},c.BindClipPlane=function(r,i){if(i.clipPlane){var a=i.clipPlane;r.setFloat4("vClipPlane",a.normal.x,a.normal.y,a.normal.z,a.d)}if(i.clipPlane2){var a=i.clipPlane2;r.setFloat4("vClipPlane2",a.normal.x,a.normal.y,a.normal.z,a.d)}if(i.clipPlane3){var a=i.clipPlane3;r.setFloat4("vClipPlane3",a.normal.x,a.normal.y,a.normal.z,a.d)}if(i.clipPlane4){var a=i.clipPlane4;r.setFloat4("vClipPlane4",a.normal.x,a.normal.y,a.normal.z,a.d)}},c._tempFogColor=t.Color3.Black(),c}();t.MaterialHelper=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n._normalMatrix=new t.Matrix,n.storeEffectOnSubMeshes=!0,n}return r.prototype.getEffect=function(){return this._activeEffect},r.prototype.isReady=function(i,a){return i?!i.subMeshes||i.subMeshes.length===0?!0:this.isReadyForSubMesh(i,i.subMeshes[0],a):!1},r.prototype.bindOnlyWorldMatrix=function(i){this._activeEffect.setMatrix("world",i)},r.prototype.bindOnlyNormalMatrix=function(i){this._activeEffect.setMatrix("normalMatrix",i)},r.prototype.bind=function(i,a){a&&this.bindForSubMesh(i,a,a.subMeshes[0])},r.prototype._afterBind=function(i,a){a===void 0&&(a=null),c.prototype._afterBind.call(this,i),this.getScene()._cachedEffect=a},r.prototype._mustRebind=function(i,a,n){return n===void 0&&(n=1),i.isCachedMaterialInvalid(this,a,n)},r}(t.Material);t.PushMaterial=f})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(){var a=r.call(this)||this;return a.MAINUV1=!1,a.MAINUV2=!1,a.DIFFUSE=!1,a.DIFFUSEDIRECTUV=0,a.AMBIENT=!1,a.AMBIENTDIRECTUV=0,a.OPACITY=!1,a.OPACITYDIRECTUV=0,a.OPACITYRGB=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.EMISSIVEDIRECTUV=0,a.SPECULAR=!1,a.SPECULARDIRECTUV=0,a.BUMP=!1,a.BUMPDIRECTUV=0,a.PARALLAX=!1,a.PARALLAXOCCLUSION=!1,a.SPECULAROVERALPHA=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.ALPHAFROMDIFFUSE=!1,a.POINTSIZE=!1,a.FOG=!1,a.SPECULARTERM=!1,a.DIFFUSEFRESNEL=!1,a.OPACITYFRESNEL=!1,a.REFLECTIONFRESNEL=!1,a.REFRACTIONFRESNEL=!1,a.EMISSIVEFRESNEL=!1,a.FRESNEL=!1,a.NORMAL=!1,a.UV1=!1,a.UV2=!1,a.VERTEXCOLOR=!1,a.VERTEXALPHA=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.GLOSSINESS=!1,a.ROUGHNESS=!1,a.EMISSIVEASILLUMINATION=!1,a.LINKEMISSIVEWITHDIFFUSE=!1,a.REFLECTIONFRESNELFROMSPECULAR=!1,a.LIGHTMAP=!1,a.LIGHTMAPDIRECTUV=0,a.OBJECTSPACE_NORMALMAP=!1,a.USELIGHTMAPASSHADOWMAP=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.LOGARITHMICDEPTH=!1,a.REFRACTION=!1,a.REFRACTIONMAP_3D=!1,a.REFLECTIONOVERALPHA=!1,a.TWOSIDEDLIGHTING=!1,a.SHADOWFLOAT=!1,a.MORPHTARGETS=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_TANGENT=!1,a.NUM_MORPH_INFLUENCERS=0,a.NONUNIFORMSCALING=!1,a.PREMULTIPLYALPHA=!1,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.IS_REFLECTION_LINEAR=!1,a.IS_REFRACTION_LINEAR=!1,a.EXPOSURE=!1,a.rebuild(),a}return i.prototype.setReflectionMode=function(a){for(var n=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"],s=0,o=n;s<o.length;s++){var l=o[s];this[l]=l===a}},i}(t.MaterialDefines);t.StandardMaterialDefines=f;var c=function(r){N(i,r);function i(a,n){var s=r.call(this,a,n)||this;return s.ambientColor=new t.Color3(0,0,0),s.diffuseColor=new t.Color3(1,1,1),s.specularColor=new t.Color3(1,1,1),s.emissiveColor=new t.Color3(0,0,0),s.specularPower=64,s._useAlphaFromDiffuseTexture=!1,s._useEmissiveAsIllumination=!1,s._linkEmissiveWithDiffuse=!1,s._useSpecularOverAlpha=!1,s._useReflectionOverAlpha=!1,s._disableLighting=!1,s._useObjectSpaceNormalMap=!1,s._useParallax=!1,s._useParallaxOcclusion=!1,s.parallaxScaleBias=.05,s._roughness=0,s.indexOfRefraction=.98,s.invertRefractionY=!0,s.alphaCutOff=.4,s._useLightmapAsShadowmap=!1,s._useReflectionFresnelFromSpecular=!1,s._useGlossinessFromSpecularMapAlpha=!1,s._maxSimultaneousLights=4,s._invertNormalMapX=!1,s._invertNormalMapY=!1,s._twoSidedLighting=!1,s._renderTargets=new t.SmartArray(16),s._worldViewProjectionMatrix=t.Matrix.Zero(),s._globalAmbientColor=new t.Color3(0,0,0),s._attachImageProcessingConfiguration(null),s.getRenderTargetTextures=function(){return s._renderTargets.reset(),i.ReflectionTextureEnabled&&s._reflectionTexture&&s._reflectionTexture.isRenderTarget&&s._renderTargets.push(s._reflectionTexture),i.RefractionTextureEnabled&&s._refractionTexture&&s._refractionTexture.isRenderTarget&&s._renderTargets.push(s._refractionTexture),s._renderTargets},s}return Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(a){var n=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),a?this._imageProcessingConfiguration=a:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(s){n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(a){this._imageProcessingConfiguration.exposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(a){this._imageProcessingConfiguration.contrast=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(a){this._imageProcessingConfiguration.colorGradingTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(a){this._imageProcessingConfiguration.colorCurves=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(i.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||i.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(i.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),i.prototype.needAlphaBlending=function(){return this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},i.prototype.needAlphaTesting=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha},i.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},i.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},i.prototype.isReadyForSubMesh=function(a,n,s){if(s===void 0&&(s=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new f);var o=this.getScene(),l=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&l._renderId===o.getRenderId())return!0;var u=o.getEngine();if(l._needNormals=t.MaterialHelper.PrepareDefinesForLights(o,a,l,!0,this._maxSimultaneousLights,this._disableLighting),l._areTexturesDirty){if(l._needUVs=!1,l.MAINUV1=!1,l.MAINUV2=!1,o.texturesEnabled){if(this._diffuseTexture&&i.DiffuseTextureEnabled)if(this._diffuseTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,l,"DIFFUSE");else return!1;else l.DIFFUSE=!1;if(this._ambientTexture&&i.AmbientTextureEnabled)if(this._ambientTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,l,"AMBIENT");else return!1;else l.AMBIENT=!1;if(this._opacityTexture&&i.OpacityTextureEnabled)if(this._opacityTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,l,"OPACITY"),l.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else return!1;else l.OPACITY=!1;if(this._reflectionTexture&&i.ReflectionTextureEnabled)if(this._reflectionTexture.isReadyOrNotBlocking()){switch(l._needNormals=!0,l.REFLECTION=!0,l.ROUGHNESS=this._roughness>0,l.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,l.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===t.Texture.INVCUBIC_MODE,l.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case t.Texture.EXPLICIT_MODE:l.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case t.Texture.PLANAR_MODE:l.setReflectionMode("REFLECTIONMAP_PLANAR");break;case t.Texture.PROJECTION_MODE:l.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case t.Texture.SKYBOX_MODE:l.setReflectionMode("REFLECTIONMAP_SKYBOX"),l.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case t.Texture.SPHERICAL_MODE:l.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case t.Texture.EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case t.Texture.FIXED_EQUIRECTANGULAR_MODE:l.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case t.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:l.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case t.Texture.CUBIC_MODE:case t.Texture.INVCUBIC_MODE:default:l.setReflectionMode("REFLECTIONMAP_CUBIC");break}l.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else return!1;else l.REFLECTION=!1;if(this._emissiveTexture&&i.EmissiveTextureEnabled)if(this._emissiveTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,l,"EMISSIVE");else return!1;else l.EMISSIVE=!1;if(this._lightmapTexture&&i.LightmapTextureEnabled)if(this._lightmapTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,l,"LIGHTMAP"),l.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap;else return!1;else l.LIGHTMAP=!1;if(this._specularTexture&&i.SpecularTextureEnabled)if(this._specularTexture.isReadyOrNotBlocking())t.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,l,"SPECULAR"),l.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else return!1;else l.SPECULAR=!1;if(o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&i.BumpTextureEnabled){if(this._bumpTexture.isReady())t.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,l,"BUMP"),l.PARALLAX=this._useParallax,l.PARALLAXOCCLUSION=this._useParallaxOcclusion;else return!1;l.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else l.BUMP=!1;if(this._refractionTexture&&i.RefractionTextureEnabled)if(this._refractionTexture.isReadyOrNotBlocking())l._needUVs=!0,l.REFRACTION=!0,l.REFRACTIONMAP_3D=this._refractionTexture.isCube;else return!1;else l.REFRACTION=!1;l.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else l.DIFFUSE=!1,l.AMBIENT=!1,l.OPACITY=!1,l.REFLECTION=!1,l.EMISSIVE=!1,l.LIGHTMAP=!1,l.BUMP=!1,l.REFRACTION=!1;l.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),l.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,l.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,l.SPECULAROVERALPHA=this._useSpecularOverAlpha,l.PREMULTIPLYALPHA=this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF}if(l._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(l),l.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,l.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if(l._areFresnelDirty&&(i.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(l.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,l.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,l.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,l.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,l.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,l.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,l._needNormals=!0,l.FRESNEL=!0):l.FRESNEL=!1),t.MaterialHelper.PrepareDefinesForMisc(a,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),l),t.MaterialHelper.PrepareDefinesForAttributes(a,l,!0,!0,!0),t.MaterialHelper.PrepareDefinesForFrameBoundValues(o,u,l,s),l.isDirty){l.markAsProcessed(),o.resetCachedMaterial();var h=new t.EffectFallbacks;l.REFLECTION&&h.addFallback(0,"REFLECTION"),l.SPECULAR&&h.addFallback(0,"SPECULAR"),l.BUMP&&h.addFallback(0,"BUMP"),l.PARALLAX&&h.addFallback(1,"PARALLAX"),l.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),l.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),l.FOG&&h.addFallback(1,"FOG"),l.POINTSIZE&&h.addFallback(0,"POINTSIZE"),l.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),t.MaterialHelper.HandleFallbacksForShadows(l,h,this._maxSimultaneousLights),l.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),l.DIFFUSEFRESNEL&&h.addFallback(1,"DIFFUSEFRESNEL"),l.OPACITYFRESNEL&&h.addFallback(2,"OPACITYFRESNEL"),l.REFLECTIONFRESNEL&&h.addFallback(3,"REFLECTIONFRESNEL"),l.EMISSIVEFRESNEL&&h.addFallback(4,"EMISSIVEFRESNEL"),l.FRESNEL&&h.addFallback(4,"FRESNEL");var d=[t.VertexBuffer.PositionKind];l.NORMAL&&d.push(t.VertexBuffer.NormalKind),l.UV1&&d.push(t.VertexBuffer.UVKind),l.UV2&&d.push(t.VertexBuffer.UV2Kind),l.VERTEXCOLOR&&d.push(t.VertexBuffer.ColorKind),t.MaterialHelper.PrepareAttributesForBones(d,a,l,h),t.MaterialHelper.PrepareAttributesForInstances(d,l),t.MaterialHelper.PrepareAttributesForMorphTargets(d,a,l);var p="default",m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff"],_=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"],v=["Material","Scene"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareUniforms(m,l),t.ImageProcessingConfiguration.PrepareSamplers(_,l)),t.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:v,samplers:_,defines:l,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(p=this.customShaderNameResolve(p,m,v,_,l));var S=l.toString();n.setEffect(o.getEngine().createEffect(p,{attributes:d,uniformsNames:m,uniformBuffersNames:v,samplers:_,defines:S,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:l.NUM_MORPH_INFLUENCERS}},u),l),this.buildUniformLayout()}return!n.effect||!n.effect.isReady()?!1:(l._renderId=o.getRenderId(),this._wasPreviouslyReady=!0,!0)},i.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},i.prototype.unbind=function(){if(this._activeEffect){var a=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),a=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),a=!0),a&&this._markAllSubMeshesAsTexturesDirty()}r.prototype.unbind.call(this)},i.prototype.bindForSubMesh=function(a,n,s){var o=this.getScene(),l=s._materialDefines;if(l){var u=s.effect;if(u){this._activeEffect=u,this.bindOnlyWorldMatrix(a),l.OBJECTSPACE_NORMALMAP&&(a.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var h=this._mustRebind(o,u,n.visibility);if(t.MaterialHelper.BindBonesParameters(n,u),h){if(this._uniformBuffer.bindToEffect(u,"Material"),this.bindViewProjection(u),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(i.FresnelEnabled&&l.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new t.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),o.texturesEnabled){if(this._diffuseTexture&&i.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),t.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse"),this._diffuseTexture.hasAlpha&&u.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&i.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),t.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&i.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),t.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),this._reflectionTexture&&i.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var d=this._reflectionTexture;this._uniformBuffer.updateVector3("vReflectionPosition",d.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",d.boundingBoxSize)}if(this._emissiveTexture&&i.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),t.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&i.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),t.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),this._specularTexture&&i.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),t.MaterialHelper.BindTextureMatrix(this._specularTexture,this._uniformBuffer,"specular")),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&i.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),t.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),o._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&i.RefractionTextureEnabled){var p=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(p=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,p,this.invertRefractionY?-1:1)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),l.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",this.emissiveColor),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*n.visibility)}if(o.texturesEnabled&&(this._diffuseTexture&&i.DiffuseTextureEnabled&&u.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&i.AmbientTextureEnabled&&u.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&i.OpacityTextureEnabled&&u.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&i.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?u.setTexture("reflectionCubeSampler",this._reflectionTexture):u.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&i.EmissiveTextureEnabled&&u.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&i.LightmapTextureEnabled&&u.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&i.SpecularTextureEnabled&&u.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&i.BumpTextureEnabled&&u.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&i.RefractionTextureEnabled)){var p=1;this._refractionTexture.isCube?u.setTexture("refractionCubeSampler",this._refractionTexture):u.setTexture("refraction2DSampler",this._refractionTexture)}t.MaterialHelper.BindClipPlane(u,o),o.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),t.MaterialHelper.BindEyePosition(u,o),u.setColor3("vAmbientColor",this._globalAmbientColor)}(h||!this.isFrozen)&&(o.lightsEnabled&&!this._disableLighting&&t.MaterialHelper.BindLights(o,n,u,l,this._maxSimultaneousLights),(o.fogEnabled&&n.applyFog&&o.fogMode!==t.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(u),t.MaterialHelper.BindFogParameters(o,n,u),l.NUM_MORPH_INFLUENCERS&&t.MaterialHelper.BindMorphTargetParameters(n,u),t.MaterialHelper.BindLogDepth(l,u,o),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},i.prototype.getAnimatables=function(){var a=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&a.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&a.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&a.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&a.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&a.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&a.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&a.push(this._refractionTexture),a},i.prototype.getActiveTextures=function(){var a=r.prototype.getActiveTextures.call(this);return this._diffuseTexture&&a.push(this._diffuseTexture),this._ambientTexture&&a.push(this._ambientTexture),this._opacityTexture&&a.push(this._opacityTexture),this._reflectionTexture&&a.push(this._reflectionTexture),this._emissiveTexture&&a.push(this._emissiveTexture),this._specularTexture&&a.push(this._specularTexture),this._bumpTexture&&a.push(this._bumpTexture),this._lightmapTexture&&a.push(this._lightmapTexture),this._refractionTexture&&a.push(this._refractionTexture),a},i.prototype.hasTexture=function(a){return!!(r.prototype.hasTexture.call(this,a)||this._diffuseTexture===a||this._ambientTexture===a||this._opacityTexture===a||this._reflectionTexture===a||this._emissiveTexture===a||this._specularTexture===a||this._bumpTexture===a||this._lightmapTexture===a||this._refractionTexture===a)},i.prototype.dispose=function(a,n){n&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),r.prototype.dispose.call(this,a,n)},i.prototype.clone=function(a,n){var s=this,o=t.SerializationHelper.Clone(function(){return new i(a,n||s.getScene())},this);return o.name=a,o.id=a,o},i.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},i.Parse=function(a,n,s){return t.SerializationHelper.Parse(function(){return new i(a.name,n)},a,n,s)},Object.defineProperty(i,"DiffuseTextureEnabled",{get:function(){return i._DiffuseTextureEnabled},set:function(a){i._DiffuseTextureEnabled!==a&&(i._DiffuseTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"AmbientTextureEnabled",{get:function(){return i._AmbientTextureEnabled},set:function(a){i._AmbientTextureEnabled!==a&&(i._AmbientTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"OpacityTextureEnabled",{get:function(){return i._OpacityTextureEnabled},set:function(a){i._OpacityTextureEnabled!==a&&(i._OpacityTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ReflectionTextureEnabled",{get:function(){return i._ReflectionTextureEnabled},set:function(a){i._ReflectionTextureEnabled!==a&&(i._ReflectionTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"EmissiveTextureEnabled",{get:function(){return i._EmissiveTextureEnabled},set:function(a){i._EmissiveTextureEnabled!==a&&(i._EmissiveTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SpecularTextureEnabled",{get:function(){return i._SpecularTextureEnabled},set:function(a){i._SpecularTextureEnabled!==a&&(i._SpecularTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BumpTextureEnabled",{get:function(){return i._BumpTextureEnabled},set:function(a){i._BumpTextureEnabled!==a&&(i._BumpTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LightmapTextureEnabled",{get:function(){return i._LightmapTextureEnabled},set:function(a){i._LightmapTextureEnabled!==a&&(i._LightmapTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RefractionTextureEnabled",{get:function(){return i._RefractionTextureEnabled},set:function(a){i._RefractionTextureEnabled!==a&&(i._RefractionTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ColorGradingTextureEnabled",{get:function(){return i._ColorGradingTextureEnabled},set:function(a){i._ColorGradingTextureEnabled!==a&&(i._ColorGradingTextureEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FresnelEnabled",{get:function(){return i._FresnelEnabled},set:function(a){i._FresnelEnabled!==a&&(i._FresnelEnabled=a,t.Engine.MarkAllMaterialsAsDirty(t.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),i._DiffuseTextureEnabled=!0,i._AmbientTextureEnabled=!0,i._OpacityTextureEnabled=!0,i._ReflectionTextureEnabled=!0,i._EmissiveTextureEnabled=!0,i._SpecularTextureEnabled=!0,i._BumpTextureEnabled=!0,i._LightmapTextureEnabled=!0,i._RefractionTextureEnabled=!0,i._ColorGradingTextureEnabled=!0,i._FresnelEnabled=!0,A([t.serializeAsTexture("diffuseTexture")],i.prototype,"_diffuseTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"diffuseTexture",void 0),A([t.serializeAsTexture("ambientTexture")],i.prototype,"_ambientTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),A([t.serializeAsTexture("opacityTexture")],i.prototype,"_opacityTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),A([t.serializeAsTexture("reflectionTexture")],i.prototype,"_reflectionTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),A([t.serializeAsTexture("emissiveTexture")],i.prototype,"_emissiveTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),A([t.serializeAsTexture("specularTexture")],i.prototype,"_specularTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularTexture",void 0),A([t.serializeAsTexture("bumpTexture")],i.prototype,"_bumpTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),A([t.serializeAsTexture("lightmapTexture")],i.prototype,"_lightmapTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"lightmapTexture",void 0),A([t.serializeAsTexture("refractionTexture")],i.prototype,"_refractionTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),A([t.serializeAsColor3("ambient")],i.prototype,"ambientColor",void 0),A([t.serializeAsColor3("diffuse")],i.prototype,"diffuseColor",void 0),A([t.serializeAsColor3("specular")],i.prototype,"specularColor",void 0),A([t.serializeAsColor3("emissive")],i.prototype,"emissiveColor",void 0),A([t.serialize()],i.prototype,"specularPower",void 0),A([t.serialize("useAlphaFromDiffuseTexture")],i.prototype,"_useAlphaFromDiffuseTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFromDiffuseTexture",void 0),A([t.serialize("useEmissiveAsIllumination")],i.prototype,"_useEmissiveAsIllumination",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useEmissiveAsIllumination",void 0),A([t.serialize("linkEmissiveWithDiffuse")],i.prototype,"_linkEmissiveWithDiffuse",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkEmissiveWithDiffuse",void 0),A([t.serialize("useSpecularOverAlpha")],i.prototype,"_useSpecularOverAlpha",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),A([t.serialize("useReflectionOverAlpha")],i.prototype,"_useReflectionOverAlpha",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useReflectionOverAlpha",void 0),A([t.serialize("disableLighting")],i.prototype,"_disableLighting",void 0),A([t.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),A([t.serialize("useObjectSpaceNormalMap")],i.prototype,"_useObjectSpaceNormalMap",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),A([t.serialize("useParallax")],i.prototype,"_useParallax",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),A([t.serialize("useParallaxOcclusion")],i.prototype,"_useParallaxOcclusion",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),A([t.serialize()],i.prototype,"parallaxScaleBias",void 0),A([t.serialize("roughness")],i.prototype,"_roughness",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),A([t.serialize()],i.prototype,"indexOfRefraction",void 0),A([t.serialize()],i.prototype,"invertRefractionY",void 0),A([t.serialize()],i.prototype,"alphaCutOff",void 0),A([t.serialize("useLightmapAsShadowmap")],i.prototype,"_useLightmapAsShadowmap",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),A([t.serializeAsFresnelParameters("diffuseFresnelParameters")],i.prototype,"_diffuseFresnelParameters",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"diffuseFresnelParameters",void 0),A([t.serializeAsFresnelParameters("opacityFresnelParameters")],i.prototype,"_opacityFresnelParameters",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")],i.prototype,"opacityFresnelParameters",void 0),A([t.serializeAsFresnelParameters("reflectionFresnelParameters")],i.prototype,"_reflectionFresnelParameters",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"reflectionFresnelParameters",void 0),A([t.serializeAsFresnelParameters("refractionFresnelParameters")],i.prototype,"_refractionFresnelParameters",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"refractionFresnelParameters",void 0),A([t.serializeAsFresnelParameters("emissiveFresnelParameters")],i.prototype,"_emissiveFresnelParameters",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"emissiveFresnelParameters",void 0),A([t.serialize("useReflectionFresnelFromSpecular")],i.prototype,"_useReflectionFresnelFromSpecular",void 0),A([t.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"useReflectionFresnelFromSpecular",void 0),A([t.serialize("useGlossinessFromSpecularMapAlpha")],i.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useGlossinessFromSpecularMapAlpha",void 0),A([t.serialize("maxSimultaneousLights")],i.prototype,"_maxSimultaneousLights",void 0),A([t.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),A([t.serialize("invertNormalMapX")],i.prototype,"_invertNormalMapX",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),A([t.serialize("invertNormalMapY")],i.prototype,"_invertNormalMapY",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),A([t.serialize("twoSidedLighting")],i.prototype,"_twoSidedLighting",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),A([t.serialize()],i.prototype,"useLogarithmicDepth",null),i}(t.PushMaterial);t.StandardMaterial=c})(T||(T={}));var T;(function(t){var f=function(){function r(){this.x=t.Vector3.Zero(),this.y=t.Vector3.Zero(),this.z=t.Vector3.Zero(),this.xx=t.Vector3.Zero(),this.yy=t.Vector3.Zero(),this.zz=t.Vector3.Zero(),this.xy=t.Vector3.Zero(),this.yz=t.Vector3.Zero(),this.zx=t.Vector3.Zero()}return r.prototype.addAmbient=function(i){var a=new t.Vector3(i.r,i.g,i.b);this.xx=this.xx.add(a),this.yy=this.yy.add(a),this.zz=this.zz.add(a)},r.prototype.scale=function(i){this.x=this.x.scale(i),this.y=this.y.scale(i),this.z=this.z.scale(i),this.xx=this.xx.scale(i),this.yy=this.yy.scale(i),this.zz=this.zz.scale(i),this.yz=this.yz.scale(i),this.zx=this.zx.scale(i),this.xy=this.xy.scale(i)},r.FromHarmonics=function(i){var a=new r;return a.x=i.l11.scale(1.02333),a.y=i.l1_1.scale(1.02333),a.z=i.l10.scale(1.02333),a.xx=i.l00.scale(.886277).subtract(i.l20.scale(.247708)).add(i.lL22.scale(.429043)),a.yy=i.l00.scale(.886277).subtract(i.l20.scale(.247708)).subtract(i.lL22.scale(.429043)),a.zz=i.l00.scale(.886277).add(i.l20.scale(.495417)),a.yz=i.l2_1.scale(.858086),a.zx=i.l21.scale(.858086),a.xy=i.l2_2.scale(.858086),a.scale(1/Math.PI),a},r.FromArray=function(i){var a=new r;return t.Vector3.FromArrayToRef(i[0],0,a.x),t.Vector3.FromArrayToRef(i[1],0,a.y),t.Vector3.FromArrayToRef(i[2],0,a.z),t.Vector3.FromArrayToRef(i[3],0,a.xx),t.Vector3.FromArrayToRef(i[4],0,a.yy),t.Vector3.FromArrayToRef(i[5],0,a.zz),t.Vector3.FromArrayToRef(i[6],0,a.yz),t.Vector3.FromArrayToRef(i[7],0,a.zx),t.Vector3.FromArrayToRef(i[8],0,a.xy),a},r}();t.SphericalPolynomial=f;var c=function(){function r(){this.l00=t.Vector3.Zero(),this.l1_1=t.Vector3.Zero(),this.l10=t.Vector3.Zero(),this.l11=t.Vector3.Zero(),this.l2_2=t.Vector3.Zero(),this.l2_1=t.Vector3.Zero(),this.l20=t.Vector3.Zero(),this.l21=t.Vector3.Zero(),this.lL22=t.Vector3.Zero()}return r.prototype.addLight=function(i,a,n){var s=new t.Vector3(a.r,a.g,a.b),o=s.scale(n);this.l00=this.l00.add(o.scale(.282095)),this.l1_1=this.l1_1.add(o.scale(.488603*i.y)),this.l10=this.l10.add(o.scale(.488603*i.z)),this.l11=this.l11.add(o.scale(.488603*i.x)),this.l2_2=this.l2_2.add(o.scale(1.092548*i.x*i.y)),this.l2_1=this.l2_1.add(o.scale(1.092548*i.y*i.z)),this.l21=this.l21.add(o.scale(1.092548*i.x*i.z)),this.l20=this.l20.add(o.scale(.315392*(3*i.z*i.z-1))),this.lL22=this.lL22.add(o.scale(.546274*(i.x*i.x-i.y*i.y)))},r.prototype.scale=function(i){this.l00=this.l00.scale(i),this.l1_1=this.l1_1.scale(i),this.l10=this.l10.scale(i),this.l11=this.l11.scale(i),this.l2_2=this.l2_2.scale(i),this.l2_1=this.l2_1.scale(i),this.l20=this.l20.scale(i),this.l21=this.l21.scale(i),this.lL22=this.lL22.scale(i)},r.prototype.convertIncidentRadianceToIrradiance=function(){this.l00=this.l00.scale(3.141593),this.l1_1=this.l1_1.scale(2.094395),this.l10=this.l10.scale(2.094395),this.l11=this.l11.scale(2.094395),this.l2_2=this.l2_2.scale(.785398),this.l2_1=this.l2_1.scale(.785398),this.l20=this.l20.scale(.785398),this.l21=this.l21.scale(.785398),this.lL22=this.lL22.scale(.785398)},r.prototype.convertIrradianceToLambertianRadiance=function(){this.scale(1/Math.PI)},r.FromPolynomial=function(i){var a=new r;return a.l00=i.xx.scale(.376127).add(i.yy.scale(.376127)).add(i.zz.scale(.376126)),a.l1_1=i.y.scale(.977204),a.l10=i.z.scale(.977204),a.l11=i.x.scale(.977204),a.l2_2=i.xy.scale(1.16538),a.l2_1=i.yz.scale(1.16538),a.l20=i.zz.scale(1.34567).subtract(i.xx.scale(.672834)).subtract(i.yy.scale(.672834)),a.l21=i.zx.scale(1.16538),a.lL22=i.xx.scale(1.16538).subtract(i.yy.scale(1.16538)),a.scale(Math.PI),a},r.FromArray=function(i){var a=new r;return t.Vector3.FromArrayToRef(i[0],0,a.l00),t.Vector3.FromArrayToRef(i[1],0,a.l1_1),t.Vector3.FromArrayToRef(i[2],0,a.l10),t.Vector3.FromArrayToRef(i[3],0,a.l11),t.Vector3.FromArrayToRef(i[4],0,a.l2_2),t.Vector3.FromArrayToRef(i[5],0,a.l2_1),t.Vector3.FromArrayToRef(i[6],0,a.l20),t.Vector3.FromArrayToRef(i[7],0,a.l21),t.Vector3.FromArrayToRef(i[8],0,a.lL22),a},r}();t.SphericalHarmonics=c})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n,s){this.name=i,this.worldAxisForNormal=a,this.worldAxisForFileX=n,this.worldAxisForFileY=s}return r}(),c=function(){function r(){}return r.ConvertCubeMapTextureToSphericalPolynomial=function(i){if(!i.isCube)return null;var a=i.getSize().width,n=i.readPixels(0),s=i.readPixels(1),o,l;i.isRenderTarget?(o=i.readPixels(3),l=i.readPixels(2)):(o=i.readPixels(2),l=i.readPixels(3));var u=i.readPixels(4),h=i.readPixels(5),d=i.gammaSpace,p=t.Engine.TEXTUREFORMAT_RGBA,m=t.Engine.TEXTURETYPE_UNSIGNED_INT;i.textureType&&i.textureType!==t.Engine.TEXTURETYPE_UNSIGNED_INT&&(m=t.Engine.TEXTURETYPE_FLOAT);var _={size:a,right:n,left:s,up:o,down:l,front:u,back:h,format:p,type:m,gammaSpace:d};return this.ConvertCubeMapToSphericalPolynomial(_)},r.ConvertCubeMapToSphericalPolynomial=function(i){for(var a=new t.SphericalHarmonics,n=0,s=2/i.size,o=s,l=s*.5-1,u=0;u<6;u++)for(var h=this.FileFaces[u],d=i[h.name],p=l,m=i.format===t.Engine.TEXTUREFORMAT_RGBA?4:3,_=0;_<i.size;_++){for(var v=l,S=0;S<i.size;S++){var P=h.worldAxisForFileX.scale(v).add(h.worldAxisForFileY.scale(p)).add(h.worldAxisForNormal);P.normalize();var x=Math.pow(1+v*v+p*p,-3/2),R=d[_*i.size*m+S*m+0],w=d[_*i.size*m+S*m+1],I=d[_*i.size*m+S*m+2];i.type===t.Engine.TEXTURETYPE_UNSIGNED_INT&&(R/=255,w/=255,I/=255),i.gammaSpace&&(R=Math.pow(t.Scalar.Clamp(R),t.ToLinearSpace),w=Math.pow(t.Scalar.Clamp(w),t.ToLinearSpace),I=Math.pow(t.Scalar.Clamp(I),t.ToLinearSpace));var F=new t.Color3(R,w,I);a.addLight(P,F,x),n+=x,v+=s}p+=o}var k=4*Math.PI,E=6,g=k*E/6,y=g/n;return a.scale(y),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),t.SphericalPolynomial.FromHarmonics(a)},r.FileFaces=[new f("right",new t.Vector3(1,0,0),new t.Vector3(0,0,-1),new t.Vector3(0,-1,0)),new f("left",new t.Vector3(-1,0,0),new t.Vector3(0,0,1),new t.Vector3(0,-1,0)),new f("up",new t.Vector3(0,1,0),new t.Vector3(1,0,0),new t.Vector3(0,0,1)),new f("down",new t.Vector3(0,-1,0),new t.Vector3(1,0,0),new t.Vector3(0,0,-1)),new f("front",new t.Vector3(0,0,1),new t.Vector3(1,0,0),new t.Vector3(0,-1,0)),new f("back",new t.Vector3(0,0,-1),new t.Vector3(-1,0,0),new t.Vector3(0,-1,0))],r}();t.CubeMapToSphericalPolynomialTools=c})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(){var a=r.call(this)||this;return a.PBR=!0,a.MAINUV1=!1,a.MAINUV2=!1,a.UV1=!1,a.UV2=!1,a.ALBEDO=!1,a.ALBEDODIRECTUV=0,a.VERTEXCOLOR=!1,a.AMBIENT=!1,a.AMBIENTDIRECTUV=0,a.AMBIENTINGRAYSCALE=!1,a.OPACITY=!1,a.VERTEXALPHA=!1,a.OPACITYDIRECTUV=0,a.OPACITYRGB=!1,a.ALPHATEST=!1,a.DEPTHPREPASS=!1,a.ALPHABLEND=!1,a.ALPHAFROMALBEDO=!1,a.ALPHATESTVALUE="0.5",a.SPECULAROVERALPHA=!1,a.RADIANCEOVERALPHA=!1,a.ALPHAFRESNEL=!1,a.LINEARALPHAFRESNEL=!1,a.PREMULTIPLYALPHA=!1,a.EMISSIVE=!1,a.EMISSIVEDIRECTUV=0,a.REFLECTIVITY=!1,a.REFLECTIVITYDIRECTUV=0,a.SPECULARTERM=!1,a.MICROSURFACEFROMREFLECTIVITYMAP=!1,a.MICROSURFACEAUTOMATIC=!1,a.LODBASEDMICROSFURACE=!1,a.MICROSURFACEMAP=!1,a.MICROSURFACEMAPDIRECTUV=0,a.METALLICWORKFLOW=!1,a.ROUGHNESSSTOREINMETALMAPALPHA=!1,a.ROUGHNESSSTOREINMETALMAPGREEN=!1,a.METALLNESSSTOREINMETALMAPBLUE=!1,a.AOSTOREINMETALMAPRED=!1,a.ENVIRONMENTBRDF=!1,a.NORMAL=!1,a.TANGENT=!1,a.BUMP=!1,a.BUMPDIRECTUV=0,a.OBJECTSPACE_NORMALMAP=!1,a.PARALLAX=!1,a.PARALLAXOCCLUSION=!1,a.NORMALXYSCALE=!0,a.LIGHTMAP=!1,a.LIGHTMAPDIRECTUV=0,a.USELIGHTMAPASSHADOWMAP=!1,a.GAMMALIGHTMAP=!1,a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USESPHERICALINVERTEX=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.RADIANCEOCCLUSION=!1,a.HORIZONOCCLUSION=!1,a.REFRACTION=!1,a.REFRACTIONMAP_3D=!1,a.REFRACTIONMAP_OPPOSITEZ=!1,a.LODINREFRACTIONALPHA=!1,a.GAMMAREFRACTION=!1,a.RGBDREFRACTION=!1,a.LINKREFRACTIONTOTRANSPARENCY=!1,a.INSTANCES=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.NONUNIFORMSCALING=!1,a.MORPHTARGETS=!1,a.MORPHTARGETS_NORMAL=!1,a.MORPHTARGETS_TANGENT=!1,a.NUM_MORPH_INFLUENCERS=0,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.EXPOSURE=!1,a.USEPHYSICALLIGHTFALLOFF=!1,a.USEGLTFLIGHTFALLOFF=!1,a.TWOSIDEDLIGHTING=!1,a.SHADOWFLOAT=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.POINTSIZE=!1,a.FOG=!1,a.LOGARITHMICDEPTH=!1,a.FORCENORMALFORWARD=!1,a.SPECULARAA=!1,a.UNLIT=!1,a.rebuild(),a}return i.prototype.reset=function(){r.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},i}(t.MaterialDefines),c=function(r){N(i,r);function i(a,n){var s=r.call(this,a,n)||this;return s._directIntensity=1,s._emissiveIntensity=1,s._environmentIntensity=1,s._specularIntensity=1,s._lightingInfos=new t.Vector4(s._directIntensity,s._emissiveIntensity,s._environmentIntensity,s._specularIntensity),s._disableBumpMap=!1,s._ambientTextureStrength=1,s._ambientTextureImpactOnAnalyticalLights=t.PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,s._ambientColor=new t.Color3(0,0,0),s._albedoColor=new t.Color3(1,1,1),s._reflectivityColor=new t.Color3(1,1,1),s._reflectionColor=new t.Color3(1,1,1),s._emissiveColor=new t.Color3(0,0,0),s._microSurface=.9,s._indexOfRefraction=.66,s._invertRefractionY=!1,s._linkRefractionWithTransparency=!1,s._useLightmapAsShadowmap=!1,s._useHorizonOcclusion=!0,s._useRadianceOcclusion=!0,s._useAlphaFromAlbedoTexture=!1,s._useSpecularOverAlpha=!0,s._useMicroSurfaceFromReflectivityMapAlpha=!1,s._useRoughnessFromMetallicTextureAlpha=!0,s._useRoughnessFromMetallicTextureGreen=!1,s._useMetallnessFromMetallicTextureBlue=!1,s._useAmbientOcclusionFromMetallicTextureRed=!1,s._useAmbientInGrayScale=!1,s._useAutoMicroSurfaceFromReflectivityMap=!1,s._lightFalloff=i.LIGHTFALLOFF_PHYSICAL,s._useRadianceOverAlpha=!0,s._useObjectSpaceNormalMap=!1,s._useParallax=!1,s._useParallaxOcclusion=!1,s._parallaxScaleBias=.05,s._disableLighting=!1,s._maxSimultaneousLights=4,s._invertNormalMapX=!1,s._invertNormalMapY=!1,s._twoSidedLighting=!1,s._alphaCutOff=.4,s._forceAlphaTest=!1,s._useAlphaFresnel=!1,s._useLinearAlphaFresnel=!1,s._transparencyMode=null,s._environmentBRDFTexture=null,s._forceIrradianceInFragment=!1,s._forceNormalForward=!1,s._enableSpecularAntiAliasing=!1,s._renderTargets=new t.SmartArray(16),s._globalAmbientColor=new t.Color3(0,0,0),s._unlit=!1,s._attachImageProcessingConfiguration(null),s.getRenderTargetTextures=function(){return s._renderTargets.reset(),t.StandardMaterial.ReflectionTextureEnabled&&s._reflectionTexture&&s._reflectionTexture.isRenderTarget&&s._renderTargets.push(s._reflectionTexture),t.StandardMaterial.RefractionTextureEnabled&&s._refractionTexture&&s._refractionTexture.isRenderTarget&&s._renderTargets.push(s._refractionTexture),s._renderTargets},s._environmentBRDFTexture=t.TextureTools.GetEnvironmentBRDFTexture(n),s}return i.prototype._attachImageProcessingConfiguration=function(a){var n=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),a?this._imageProcessingConfiguration=a:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(s){n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(t.StandardMaterial.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||t.StandardMaterial.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(i.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(a){this._transparencyMode!==a&&(this._transparencyMode=a,this._forceAlphaTest=a===t.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_disableAlphaBlending",{get:function(){return this._linkRefractionWithTransparency||this._transparencyMode===t.PBRMaterial.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMaterial.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),i.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture()},i.prototype.needAlphaBlendingForMesh=function(a){return this._disableAlphaBlending?!1:r.prototype.needAlphaBlendingForMesh.call(this,a)},i.prototype.needAlphaTesting=function(){return this._forceAlphaTest?!0:this._linkRefractionWithTransparency?!1:this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&(this._transparencyMode==null||this._transparencyMode===t.PBRMaterial.PBRMATERIAL_ALPHATEST)},i.prototype._shouldUseAlphaFromAlbedoTexture=function(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMaterial.PBRMATERIAL_OPAQUE},i.prototype.getAlphaTestTexture=function(){return this._albedoTexture},i.prototype.isReadyForSubMesh=function(a,n,s){if(n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new f);var o=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&o._renderId===this.getScene().getRenderId())return!0;var l=this.getScene(),u=l.getEngine();if(o._areTexturesDirty&&l.texturesEnabled){if(this._albedoTexture&&t.StandardMaterial.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking()||this._ambientTexture&&t.StandardMaterial.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking()||this._opacityTexture&&t.StandardMaterial.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var h=this._getReflectionTexture();if(h&&t.StandardMaterial.ReflectionTextureEnabled&&!h.isReadyOrNotBlocking()||this._lightmapTexture&&t.StandardMaterial.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking()||this._emissiveTexture&&t.StandardMaterial.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(t.StandardMaterial.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(u.getCaps().standardDerivatives&&this._bumpTexture&&t.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;var d=this._getRefractionTexture();if(d&&t.StandardMaterial.RefractionTextureEnabled&&!d.isReadyOrNotBlocking()||this._environmentBRDFTexture&&t.StandardMaterial.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;!u.getCaps().standardDerivatives&&!a.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(a.createNormals(!0),t.Tools.Warn("PBRMaterial: Normals have been created for the mesh: "+a.name));var p=this._prepareEffect(a,o,this.onCompiled,this.onError,s);return p&&(l.resetCachedMaterial(),n.setEffect(p,o),this.buildUniformLayout()),!n.effect||!n.effect.isReady()?!1:(o._renderId=l.getRenderId(),this._wasPreviouslyReady=!0,!0)},i.prototype.isMetallicWorkflow=function(){return!!(this._metallic!=null||this._roughness!=null||this._metallicTexture)},i.prototype._prepareEffect=function(a,n,s,o,l,u){if(s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),this._prepareDefines(a,n,l,u),!n.isDirty)return null;n.markAsProcessed();var h=this.getScene(),d=h.getEngine(),p=new t.EffectFallbacks,m=0;n.USESPHERICALINVERTEX&&p.addFallback(m++,"USESPHERICALINVERTEX"),n.FOG&&p.addFallback(m,"FOG"),n.SPECULARAA&&p.addFallback(m,"SPECULARAA"),n.POINTSIZE&&p.addFallback(m,"POINTSIZE"),n.LOGARITHMICDEPTH&&p.addFallback(m,"LOGARITHMICDEPTH"),n.PARALLAX&&p.addFallback(m,"PARALLAX"),n.PARALLAXOCCLUSION&&p.addFallback(m++,"PARALLAXOCCLUSION"),n.ENVIRONMENTBRDF&&p.addFallback(m++,"ENVIRONMENTBRDF"),n.TANGENT&&p.addFallback(m++,"TANGENT"),n.BUMP&&p.addFallback(m++,"BUMP"),m=t.MaterialHelper.HandleFallbacksForShadows(n,p,this._maxSimultaneousLights,m++),n.SPECULARTERM&&p.addFallback(m++,"SPECULARTERM"),n.USESPHERICALFROMREFLECTIONMAP&&p.addFallback(m++,"USESPHERICALFROMREFLECTIONMAP"),n.LIGHTMAP&&p.addFallback(m++,"LIGHTMAP"),n.NORMAL&&p.addFallback(m++,"NORMAL"),n.AMBIENT&&p.addFallback(m++,"AMBIENT"),n.EMISSIVE&&p.addFallback(m++,"EMISSIVE"),n.VERTEXCOLOR&&p.addFallback(m++,"VERTEXCOLOR"),n.NUM_BONE_INFLUENCERS>0&&p.addCPUSkinningFallback(m++,a),n.MORPHTARGETS&&p.addFallback(m++,"MORPHTARGETS");var _=[t.VertexBuffer.PositionKind];n.NORMAL&&_.push(t.VertexBuffer.NormalKind),n.TANGENT&&_.push(t.VertexBuffer.TangentKind),n.UV1&&_.push(t.VertexBuffer.UVKind),n.UV2&&_.push(t.VertexBuffer.UV2Kind),n.VERTEXCOLOR&&_.push(t.VertexBuffer.ColorKind),t.MaterialHelper.PrepareAttributesForBones(_,a,n,p),t.MaterialHelper.PrepareAttributesForInstances(_,n),t.MaterialHelper.PrepareAttributesForMorphTargets(_,a,n);var v=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vReflectionMicrosurfaceInfos","vRefractionMicrosurfaceInfos","vTangentSpaceParams"],S=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler"],P=["Material","Scene"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareUniforms(v,n),t.ImageProcessingConfiguration.PrepareSamplers(S,n)),t.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:v,uniformBuffersNames:P,samplers:S,defines:n,maxSimultaneousLights:this._maxSimultaneousLights});var x=n.toString();return d.createEffect("pbr",{attributes:_,uniformsNames:v,uniformBuffersNames:P,samplers:S,defines:x,fallbacks:p,onCompiled:s,onError:o,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:n.NUM_MORPH_INFLUENCERS}},d)},i.prototype._prepareDefines=function(a,n,s,o){s===void 0&&(s=null),o===void 0&&(o=null);var l=this.getScene(),u=l.getEngine();if(t.MaterialHelper.PrepareDefinesForLights(l,a,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,l.texturesEnabled){l.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&t.StandardMaterial.DiffuseTextureEnabled?t.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"):n.ALBEDO=!1,this._ambientTexture&&t.StandardMaterial.AmbientTextureEnabled?(t.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&t.StandardMaterial.OpacityTextureEnabled?(t.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var h=this._getReflectionTexture();if(h&&t.StandardMaterial.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=h.gammaSpace,n.RGBDREFLECTION=h.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!h.invertZ:h.invertZ,n.LODINREFLECTIONALPHA=h.lodLevelInAlpha,h.coordinatesMode===t.Texture.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=h.isCube,h.coordinatesMode){case t.Texture.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case t.Texture.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case t.Texture.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case t.Texture.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case t.Texture.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case t.Texture.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case t.Texture.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case t.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case t.Texture.CUBIC_MODE:case t.Texture.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!h.boundingBoxSize;break}h.coordinatesMode!==t.Texture.SKYBOX_MODE?h.sphericalPolynomial&&(n.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||l.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0):n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!h.getReflectionTextureMatrix().isIdentity()}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1;this._lightmapTexture&&t.StandardMaterial.LightmapTextureEnabled?(t.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):n.LIGHTMAP=!1,this._emissiveTexture&&t.StandardMaterial.EmissiveTextureEnabled?t.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,t.StandardMaterial.SpecularTextureEnabled?(this._metallicTexture?(t.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(t.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._microSurfaceTexture?t.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),l.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&t.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap?(t.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&t.StandardMaterial.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1;var d=this._getRefractionTexture();d&&t.StandardMaterial.RefractionTextureEnabled?(n.REFRACTION=!0,n.REFRACTIONMAP_3D=d.isCube,n.GAMMAREFRACTION=d.gammaSpace,n.RGBDREFRACTION=d.isRGBD,n.REFRACTIONMAP_OPPOSITEZ=d.invertZ,n.LODINREFRACTIONALPHA=d.lodLevelInAlpha,this._linkRefractionWithTransparency&&(n.LINKREFRACTIONTOTRANSPARENCY=!0)):n.REFRACTION=!1,this._environmentBRDFTexture&&t.StandardMaterial.ReflectionTextureEnabled?n.ENVIRONMENTBRDF=!0:n.ENVIRONMENTBRDF=!1,this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===i.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===i.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.ALPHATESTVALUE=""+this._alphaCutOff+(this._alphaCutOff%1===0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(a),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,n.SPECULARAA=l.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(t.MaterialHelper.PrepareDefinesForMisc(a,l,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!a.isVerticesDataPresent(t.VertexBuffer.NormalKind)),t.MaterialHelper.PrepareDefinesForFrameBoundValues(l,u,n,!!s,o),t.MaterialHelper.PrepareDefinesForAttributes(a,n,!0,!0,!0,this._transparencyMode!==t.PBRMaterial.PBRMATERIAL_OPAQUE)},i.prototype.forceCompilation=function(a,n,s){var o=this,l=Ve({clipPlane:!1},s),u=new f,h=this._prepareEffect(a,u,void 0,void 0,void 0,l.clipPlane);h.isReady()?n&&n(this):h.onCompileObservable.add(function(){n&&n(o)})},i.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vAlbedoInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",4),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vReflectivityInfos",3),this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos",2),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vReflectionPosition",3),this._uniformBuffer.addUniform("vReflectionSize",3),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("albedoMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("reflectivityMatrix",16),this._uniformBuffer.addUniform("microSurfaceSamplerMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionColor",3),this._uniformBuffer.addUniform("vAlbedoColor",4),this._uniformBuffer.addUniform("vLightingIntensity",4),this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectivityColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},i.prototype.unbind=function(){this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._uniformBuffer.setTexture("refractionSampler",null),r.prototype.unbind.call(this)},i.prototype.bindForSubMesh=function(a,n,s){var o=this.getScene(),l=s._materialDefines;if(l){var u=s.effect;if(u){this._activeEffect=u,this.bindOnlyWorldMatrix(a),l.OBJECTSPACE_NORMALMAP&&(a.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var h=this._mustRebind(o,u,n.visibility);t.MaterialHelper.BindBonesParameters(n,this._activeEffect);var d=null;if(h){this._uniformBuffer.bindToEffect(u,"Material"),this.bindViewProjection(u),d=this._getReflectionTexture();var p=this._getRefractionTexture();if(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(o.texturesEnabled){if(this._albedoTexture&&t.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),t.MaterialHelper.BindTextureMatrix(this._albedoTexture,this._uniformBuffer,"albedo")),this._ambientTexture&&t.StandardMaterial.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),t.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&t.StandardMaterial.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),t.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),d&&t.StandardMaterial.ReflectionTextureEnabled){if(this._uniformBuffer.updateMatrix("reflectionMatrix",d.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",d.level,0),d.boundingBoxSize){var m=d;this._uniformBuffer.updateVector3("vReflectionPosition",m.boundingBoxPosition),this._uniformBuffer.updateVector3("vReflectionSize",m.boundingBoxSize)}var _=d.sphericalPolynomial;l.USESPHERICALFROMREFLECTIONMAP&&_&&(this._activeEffect.setFloat3("vSphericalX",_.x.x,_.x.y,_.x.z),this._activeEffect.setFloat3("vSphericalY",_.y.x,_.y.y,_.y.z),this._activeEffect.setFloat3("vSphericalZ",_.z.x,_.z.y,_.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",_.xx.x-_.zz.x,_.xx.y-_.zz.y,_.xx.z-_.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",_.yy.x-_.zz.x,_.yy.y-_.zz.y,_.yy.z-_.zz.z),this._activeEffect.setFloat3("vSphericalZZ",_.zz.x,_.zz.y,_.zz.z),this._activeEffect.setFloat3("vSphericalXY",_.xy.x,_.xy.y,_.xy.z),this._activeEffect.setFloat3("vSphericalYZ",_.yz.x,_.yz.y,_.yz.z),this._activeEffect.setFloat3("vSphericalZX",_.zx.x,_.zx.y,_.zx.z)),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",d.getSize().width,d.lodGenerationScale,d.lodGenerationOffset)}if(this._emissiveTexture&&t.StandardMaterial.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),t.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&t.StandardMaterial.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),t.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),t.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),t.MaterialHelper.BindTextureMatrix(this._metallicTexture,this._uniformBuffer,"reflectivity")):this._reflectivityTexture&&(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),t.MaterialHelper.BindTextureMatrix(this._reflectivityTexture,this._uniformBuffer,"reflectivity")),this._microSurfaceTexture&&(this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),t.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,this._uniformBuffer,"microSurfaceSampler"))),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&t.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),t.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),o._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),p&&t.StandardMaterial.RefractionTextureEnabled){this._uniformBuffer.updateMatrix("refractionMatrix",p.getReflectionTextureMatrix());var v=1;p.isCube||p.depth&&(v=p.depth),this._uniformBuffer.updateFloat4("vRefractionInfos",p.level,this._indexOfRefraction,v,this._invertRefractionY?-1:1),this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos",p.getSize().width,p.lodGenerationScale,p.lodGenerationOffset)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),l.METALLICWORKFLOW?(t.PBRMaterial._scaledReflectivity.r=this._metallic===void 0||this._metallic===null?1:this._metallic,t.PBRMaterial._scaledReflectivity.g=this._roughness===void 0||this._roughness===null?1:this._roughness,this._uniformBuffer.updateColor4("vReflectivityColor",t.PBRMaterial._scaledReflectivity,0)):this._uniformBuffer.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),this._uniformBuffer.updateColor3("vEmissiveColor",this._emissiveColor),this._uniformBuffer.updateColor3("vReflectionColor",this._reflectionColor),this._uniformBuffer.updateColor4("vAlbedoColor",this._albedoColor,this.alpha*n.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,this._uniformBuffer.updateVector4("vLightingIntensity",this._lightingInfos)}o.texturesEnabled&&(this._albedoTexture&&t.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&t.StandardMaterial.AmbientTextureEnabled&&this._uniformBuffer.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.StandardMaterial.OpacityTextureEnabled&&this._uniformBuffer.setTexture("opacitySampler",this._opacityTexture),d&&t.StandardMaterial.ReflectionTextureEnabled&&(l.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("reflectionSampler",d):(this._uniformBuffer.setTexture("reflectionSampler",d._lodTextureMid||d),this._uniformBuffer.setTexture("reflectionSamplerLow",d._lodTextureLow||d),this._uniformBuffer.setTexture("reflectionSamplerHigh",d._lodTextureHigh||d))),l.ENVIRONMENTBRDF&&this._uniformBuffer.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),p&&t.StandardMaterial.RefractionTextureEnabled&&(l.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("refractionSampler",p):(this._uniformBuffer.setTexture("refractionSampler",p._lodTextureMid||p),this._uniformBuffer.setTexture("refractionSamplerLow",p._lodTextureLow||p),this._uniformBuffer.setTexture("refractionSamplerHigh",p._lodTextureHigh||p))),this._emissiveTexture&&t.StandardMaterial.EmissiveTextureEnabled&&this._uniformBuffer.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.StandardMaterial.LightmapTextureEnabled&&this._uniformBuffer.setTexture("lightmapSampler",this._lightmapTexture),t.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?this._uniformBuffer.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&this._uniformBuffer.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&this._uniformBuffer.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&t.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&this._uniformBuffer.setTexture("bumpSampler",this._bumpTexture)),t.MaterialHelper.BindClipPlane(this._activeEffect,o),o.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var S=o._forcedViewPosition?o._forcedViewPosition:o._mirroredCameraPosition?o._mirroredCameraPosition:o.activeCamera.globalPosition,P=o.useRightHandedSystem===(o._mirroredCameraPosition!=null);u.setFloat4("vEyePosition",S.x,S.y,S.z,P?-1:1),u.setColor3("vAmbientColor",this._globalAmbientColor)}(h||!this.isFrozen)&&(o.lightsEnabled&&!this._disableLighting&&t.MaterialHelper.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,this._lightFalloff!==i.LIGHTFALLOFF_STANDARD),(o.fogEnabled&&n.applyFog&&o.fogMode!==t.Scene.FOGMODE_NONE||d)&&this.bindView(u),t.MaterialHelper.BindFogParameters(o,n,this._activeEffect,!0),l.NUM_MORPH_INFLUENCERS&&t.MaterialHelper.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),t.MaterialHelper.BindLogDepth(l,this._activeEffect,o)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},i.prototype.getAnimatables=function(){var a=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&a.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&a.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&a.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&a.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&a.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?a.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&a.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&a.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&a.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&a.push(this._refractionTexture),a},i.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},i.prototype._getRefractionTexture=function(){return this._refractionTexture?this._refractionTexture:this._linkRefractionWithTransparency?this.getScene().environmentTexture:null},i.prototype.dispose=function(a,n){n&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene()._environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),r.prototype.dispose.call(this,a,n)},i.LIGHTFALLOFF_PHYSICAL=0,i.LIGHTFALLOFF_GLTF=1,i.LIGHTFALLOFF_STANDARD=2,i._scaledReflectivity=new t.Color3,A([t.serializeAsImageProcessingConfiguration()],i.prototype,"_imageProcessingConfiguration",void 0),A([t.serialize()],i.prototype,"useLogarithmicDepth",null),A([t.serialize()],i.prototype,"transparencyMode",null),i}(t.PushMaterial);t.PBRBaseMaterial=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n.maxSimultaneousLights=4,n.disableLighting=!1,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.emissiveColor=new t.Color3(0,0,0),n.occlusionStrength=1,n.useLightmapAsShadowmap=!1,n._useAlphaFromAlbedoTexture=!0,n._useAmbientInGrayScale=!0,n}return Object.defineProperty(r.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(i){this._twoSidedLighting!==i&&(this._twoSidedLighting=i,this.backFaceCulling=!i,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),r.prototype.getActiveTextures=function(){var i=c.prototype.getActiveTextures.call(this);return this.environmentTexture&&i.push(this.environmentTexture),this.normalTexture&&i.push(this.normalTexture),this.emissiveTexture&&i.push(this.emissiveTexture),this.occlusionTexture&&i.push(this.occlusionTexture),this.lightmapTexture&&i.push(this.lightmapTexture),i},r.prototype.hasTexture=function(i){return!!(c.prototype.hasTexture.call(this,i)||this.lightmapTexture===i)},r.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],r.prototype,"environmentTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],r.prototype,"normalTexture",void 0),A([t.serializeAsColor3("emissive"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveColor",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],r.prototype,"occlusionStrength",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],r.prototype,"occlusionTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],r.prototype,"alphaCutOff",void 0),A([t.serialize()],r.prototype,"doubleSided",null),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],r.prototype,"lightmapTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),r}(t.PBRBaseMaterial);t.PBRBaseSimpleMaterial=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n.directIntensity=1,n.emissiveIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.disableBumpMap=!1,n.ambientTextureStrength=1,n.ambientTextureImpactOnAnalyticalLights=r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,n.ambientColor=new t.Color3(0,0,0),n.albedoColor=new t.Color3(1,1,1),n.reflectivityColor=new t.Color3(1,1,1),n.reflectionColor=new t.Color3(1,1,1),n.emissiveColor=new t.Color3(0,0,0),n.microSurface=1,n.indexOfRefraction=.66,n.invertRefractionY=!1,n.linkRefractionWithTransparency=!1,n.useLightmapAsShadowmap=!1,n.useAlphaFromAlbedoTexture=!1,n.forceAlphaTest=!1,n.alphaCutOff=.4,n.useSpecularOverAlpha=!0,n.useMicroSurfaceFromReflectivityMapAlpha=!1,n.useRoughnessFromMetallicTextureAlpha=!0,n.useRoughnessFromMetallicTextureGreen=!1,n.useMetallnessFromMetallicTextureBlue=!1,n.useAmbientOcclusionFromMetallicTextureRed=!1,n.useAmbientInGrayScale=!1,n.useAutoMicroSurfaceFromReflectivityMap=!1,n.useRadianceOverAlpha=!0,n.useObjectSpaceNormalMap=!1,n.useParallax=!1,n.useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n.disableLighting=!1,n.forceIrradianceInFragment=!1,n.maxSimultaneousLights=4,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.twoSidedLighting=!1,n.useAlphaFresnel=!1,n.useLinearAlphaFresnel=!1,n.environmentBRDFTexture=null,n.forceNormalForward=!1,n.enableSpecularAntiAliasing=!1,n.useHorizonOcclusion=!0,n.useRadianceOcclusion=!0,n.unlit=!1,n._environmentBRDFTexture=t.TextureTools.GetEnvironmentBRDFTexture(a),n}return Object.defineProperty(r.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===t.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL},set:function(i){i!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),i?this._lightFalloff=t.PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL:this._lightFalloff=t.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===t.PBRBaseMaterial.LIGHTFALLOFF_GLTF},set:function(i){i!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),i?this._lightFalloff=t.PBRBaseMaterial.LIGHTFALLOFF_GLTF:this._lightFalloff=t.PBRBaseMaterial.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(i){this._attachImageProcessingConfiguration(i),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(i){this.imageProcessingConfiguration.colorCurvesEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(i){this.imageProcessingConfiguration.colorGradingEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(i){this._imageProcessingConfiguration.toneMappingEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(i){this._imageProcessingConfiguration.exposure=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(i){this._imageProcessingConfiguration.contrast=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(i){this._imageProcessingConfiguration.colorGradingTexture=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(i){this._imageProcessingConfiguration.colorCurves=i},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"PBRMaterial"},r.prototype.getActiveTextures=function(){var i=c.prototype.getActiveTextures.call(this);return this._albedoTexture&&i.push(this._albedoTexture),this._ambientTexture&&i.push(this._ambientTexture),this._opacityTexture&&i.push(this._opacityTexture),this._reflectionTexture&&i.push(this._reflectionTexture),this._emissiveTexture&&i.push(this._emissiveTexture),this._reflectivityTexture&&i.push(this._reflectivityTexture),this._metallicTexture&&i.push(this._metallicTexture),this._microSurfaceTexture&&i.push(this._microSurfaceTexture),this._bumpTexture&&i.push(this._bumpTexture),this._lightmapTexture&&i.push(this._lightmapTexture),this._refractionTexture&&i.push(this._refractionTexture),i},r.prototype.hasTexture=function(i){return!!(c.prototype.hasTexture.call(this,i)||this._albedoTexture===i||this._ambientTexture===i||this._opacityTexture===i||this._reflectionTexture===i||this._reflectivityTexture===i||this._metallicTexture===i||this._microSurfaceTexture===i||this._bumpTexture===i||this._lightmapTexture===i||this._refractionTexture===i)},r.prototype.clone=function(i){var a=this,n=t.SerializationHelper.Clone(function(){return new r(i,a.getScene())},this);return n.id=i,n.name=i,n},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.customType="BABYLON.PBRMaterial",i},r.Parse=function(i,a,n){return t.SerializationHelper.Parse(function(){return new r(i.name,a)},i,a,n)},r.PBRMATERIAL_OPAQUE=0,r.PBRMATERIAL_ALPHATEST=1,r.PBRMATERIAL_ALPHABLEND=2,r.PBRMATERIAL_ALPHATESTANDBLEND=3,r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=1,A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"directIntensity",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveIntensity",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentIntensity",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"specularIntensity",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"disableBumpMap",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureStrength",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"opacityTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallic",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurfaceTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],r.prototype,"lightmapTexture",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"refractionTexture",void 0),A([t.serializeAsColor3("ambient"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientColor",void 0),A([t.serializeAsColor3("albedo"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoColor",void 0),A([t.serializeAsColor3("reflectivity"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityColor",void 0),A([t.serializeAsColor3("reflection"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionColor",void 0),A([t.serializeAsColor3("emissive"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveColor",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurface",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"indexOfRefraction",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertRefractionY",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"linkRefractionWithTransparency",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"useAlphaFromAlbedoTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"forceAlphaTest",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"alphaCutOff",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useSpecularOverAlpha",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureGreen",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMetallnessFromMetallicTextureBlue",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientInGrayScale",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),A([t.serialize()],r.prototype,"usePhysicalLightFalloff",null),A([t.serialize()],r.prototype,"useGLTFLightFalloff",null),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOverAlpha",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useObjectSpaceNormalMap",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallax",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallaxOcclusion",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"parallaxScaleBias",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceIrradianceInFragment",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"twoSidedLighting",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAlphaFresnel",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLinearAlphaFresnel",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentBRDFTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceNormalForward",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"enableSpecularAntiAliasing",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useHorizonOcclusion",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOcclusion",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsMiscDirty")],r.prototype,"unlit",void 0),r}(t.PBRBaseMaterial);t.PBRMaterial=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n._useRoughnessFromMetallicTextureAlpha=!1,n._useRoughnessFromMetallicTextureGreen=!0,n._useMetallnessFromMetallicTextureBlue=!0,n.metallic=1,n.roughness=1,n}return r.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},r.prototype.getActiveTextures=function(){var i=c.prototype.getActiveTextures.call(this);return this.baseTexture&&i.push(this.baseTexture),this.metallicRoughnessTexture&&i.push(this.metallicRoughnessTexture),i},r.prototype.hasTexture=function(i){return!!(c.prototype.hasTexture.call(this,i)||this.baseTexture===i||this.metallicRoughnessTexture===i)},r.prototype.clone=function(i){var a=this,n=t.SerializationHelper.Clone(function(){return new r(i,a.getScene())},this);return n.id=i,n.name=i,n},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.customType="BABYLON.PBRMetallicRoughnessMaterial",i},r.Parse=function(i,a,n){return t.SerializationHelper.Parse(function(){return new r(i.name,a)},i,a,n)},A([t.serializeAsColor3(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],r.prototype,"baseColor",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],r.prototype,"baseTexture",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallic",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],r.prototype,"metallicRoughnessTexture",void 0),r}(t.PBRBaseSimpleMaterial);t.PBRMetallicRoughnessMaterial=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n._useMicroSurfaceFromReflectivityMapAlpha=!0,n}return r.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},r.prototype.getActiveTextures=function(){var i=c.prototype.getActiveTextures.call(this);return this.diffuseTexture&&i.push(this.diffuseTexture),this.specularGlossinessTexture&&i.push(this.specularGlossinessTexture),i},r.prototype.hasTexture=function(i){return!!(c.prototype.hasTexture.call(this,i)||this.diffuseTexture===i||this.specularGlossinessTexture===i)},r.prototype.clone=function(i){var a=this,n=t.SerializationHelper.Clone(function(){return new r(i,a.getScene())},this);return n.id=i,n.name=i,n},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.customType="BABYLON.PBRSpecularGlossinessMaterial",i},r.Parse=function(i,a,n){return t.SerializationHelper.Parse(function(){return new r(i.name,a)},i,a,n)},A([t.serializeAsColor3("diffuse"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],r.prototype,"diffuseColor",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],r.prototype,"diffuseTexture",void 0),A([t.serializeAsColor3("specular"),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],r.prototype,"specularColor",void 0),A([t.serialize(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_microSurface")],r.prototype,"glossiness",void 0),A([t.serializeAsTexture(),t.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],r.prototype,"specularGlossinessTexture",void 0),r}(t.PBRBaseSimpleMaterial);t.PBRSpecularGlossinessMaterial=f})(T||(T={}));var T;(function(t){t.CameraInputTypes={};var f=function(){function c(r){this.attached={},this.camera=r,this.checkInputs=function(){}}return c.prototype.add=function(r){var i=r.getSimpleName();if(this.attached[i]){t.Tools.Warn("camera input of type "+i+" already exists on camera");return}this.attached[i]=r,r.camera=this.camera,r.checkInputs&&(this.checkInputs=this._addCheckInputs(r.checkInputs.bind(r))),this.attachedElement&&r.attachControl(this.attachedElement)},c.prototype.remove=function(r){for(var i in this.attached){var a=this.attached[i];a===r&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[i],this.rebuildInputCheck())}},c.prototype.removeByType=function(r){for(var i in this.attached){var a=this.attached[i];a.getClassName()===r&&(a.detachControl(this.attachedElement),a.camera=null,delete this.attached[i],this.rebuildInputCheck())}},c.prototype._addCheckInputs=function(r){var i=this.checkInputs;return function(){i(),r()}},c.prototype.attachInput=function(r){this.attachedElement&&r.attachControl(this.attachedElement,this.noPreventDefault)},c.prototype.attachElement=function(r,i){if(i===void 0&&(i=!1),!this.attachedElement){i=t.Camera.ForceAttachControlToAlwaysPreventDefault?!1:i,this.attachedElement=r,this.noPreventDefault=i;for(var a in this.attached)this.attached[a].attachControl(r,i)}},c.prototype.detachElement=function(r,i){if(i===void 0&&(i=!1),this.attachedElement===r){for(var a in this.attached)this.attached[a].detachControl(r),i&&(this.attached[a].camera=null);this.attachedElement=null}},c.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var r in this.attached){var i=this.attached[r];i.checkInputs&&(this.checkInputs=this._addCheckInputs(i.checkInputs.bind(i)))}},c.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},c.prototype.serialize=function(r){var i={};for(var a in this.attached){var n=this.attached[a],s=t.SerializationHelper.Serialize(n);i[n.getClassName()]=s}r.inputsmgr=i},c.prototype.parse=function(r){var i=r.inputsmgr;if(i){this.clear();for(var a in i){var n=t.CameraInputTypes[a];if(n){var s=i[a],o=t.SerializationHelper.Parse(function(){return new n},s,null);this.add(o)}}}else for(var a in this.attached){var n=t.CameraInputTypes[this.attached[a].getClassName()];if(n){var o=t.SerializationHelper.Parse(function(){return new n},r,null);this.remove(this.attached[a]),this.add(o)}}},c}();t.CameraInputsManager=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s=!0);var o=c.call(this,i,a,n,s)||this;return o.cameraDirection=new t.Vector3(0,0,0),o.cameraRotation=new t.Vector2(0,0),o.rotation=new t.Vector3(0,0,0),o.speed=2,o.noRotationConstraint=!1,o.lockedTarget=null,o._currentTarget=t.Vector3.Zero(),o._viewMatrix=t.Matrix.Zero(),o._camMatrix=t.Matrix.Zero(),o._cameraTransformMatrix=t.Matrix.Zero(),o._cameraRotationMatrix=t.Matrix.Zero(),o._referencePoint=new t.Vector3(0,0,1),o._transformedReferencePoint=t.Vector3.Zero(),o._globalCurrentTarget=t.Vector3.Zero(),o._globalCurrentUpVector=t.Vector3.Zero(),o._defaultUp=t.Vector3.Up(),o._cachedRotationZ=0,o._cachedQuaternionRotationZ=0,o}return r.prototype.getFrontPosition=function(i){this.getWorldMatrix();var a=this.getTarget().subtract(this.position);return a.normalize(),a.scaleInPlace(i),this.globalPosition.add(a)},r.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},r.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),c.prototype.storeState.call(this)},r.prototype._restoreStateValues=function(){return c.prototype._restoreStateValues.call(this)?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1},r.prototype._initCache=function(){c.prototype._initCache.call(this),this._cache.lockedTarget=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new t.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},r.prototype._updateCache=function(i){i||c.prototype._updateCache.call(this);var a=this._getLockedTargetPosition();a?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(a):this._cache.lockedTarget=a.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},r.prototype._isSynchronizedViewMatrix=function(){if(!c.prototype._isSynchronizedViewMatrix.call(this))return!1;var i=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(i):!i)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},r.prototype._computeLocalCameraSpeed=function(){var i=this.getEngine();return this.speed*Math.sqrt(i.getDeltaTime()/(i.getFps()*100))},r.prototype.setTarget=function(i){this.upVector.normalize(),this.position.z===i.z&&(this.position.z+=t.Epsilon),t.Matrix.LookAtLHToRef(this.position,i,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var a=i.subtract(this.position);a.x>=0?this.rotation.y=-Math.atan(a.z/a.x)+Math.PI/2:this.rotation.y=-Math.atan(a.z/a.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&t.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},r.prototype.getTarget=function(){return this._currentTarget},r.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},r.prototype._updatePosition=function(){if(this.parent){this.parent.getWorldMatrix().invertToRef(t.Tmp.Matrix[0]),t.Vector3.TransformNormalToRef(this.cameraDirection,t.Tmp.Matrix[0],t.Tmp.Vector3[0]),this.position.addInPlace(t.Tmp.Vector3[0]);return}this.position.addInPlace(this.cameraDirection)},r.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),a=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),a){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion){var n=this.rotation.lengthSquared();n&&t.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}if(!this.noRotationConstraint){var s=Math.PI/2*.95;this.rotation.x>s&&(this.rotation.x=s),this.rotation.x<-s&&(this.rotation.x=-s)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*t.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*t.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*t.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),a&&(Math.abs(this.cameraRotation.x)<this.speed*t.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*t.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),c.prototype._checkInputs.call(this)},r.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):t.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},r.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return t.Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},r.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),t.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},r.prototype._computeViewMatrix=function(i,a,n){if(this.parent){var s=this.parent.getWorldMatrix();t.Vector3.TransformCoordinatesToRef(i,s,this._globalPosition),t.Vector3.TransformCoordinatesToRef(a,s,this._globalCurrentTarget),t.Vector3.TransformNormalToRef(n,s,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(i),this._globalCurrentTarget.copyFrom(a),this._globalCurrentUpVector.copyFrom(n);this.getScene().useRightHandedSystem?t.Matrix.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):t.Matrix.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},r.prototype.createRigCamera=function(i,a){if(this.cameraRigMode!==t.Camera.RIG_MODE_NONE){var n=new r(i,this.position.clone(),this.getScene());return(this.cameraRigMode===t.Camera.RIG_MODE_VR||this.cameraRigMode===t.Camera.RIG_MODE_WEBVR)&&(this.rotationQuaternion||(this.rotationQuaternion=new t.Quaternion),n._cameraRigParams={},n.rotationQuaternion=new t.Quaternion),n}return null},r.prototype._updateRigCameras=function(){var i=this._rigCameras[0],a=this._rigCameras[1];switch(this.cameraRigMode){case t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var n=this.cameraRigMode===t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*n,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*s,a.position),i.setTarget(this.getTarget()),a.setTarget(this.getTarget());break;case t.Camera.RIG_MODE_VR:i.rotationQuaternion?(i.rotationQuaternion.copyFrom(this.rotationQuaternion),a.rotationQuaternion.copyFrom(this.rotationQuaternion)):(i.rotation.copyFrom(this.rotation),a.rotation.copyFrom(this.rotation)),i.position.copyFrom(this.position),a.position.copyFrom(this.position);break}c.prototype._updateRigCameras.call(this)},r.prototype._getRigCamPosition=function(i,a){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new t.Matrix);var n=this.getTarget();t.Matrix.Translation(-n.x,-n.y,-n.z).multiplyToRef(t.Matrix.RotationY(i),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(t.Matrix.Translation(n.x,n.y,n.z)),t.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,a)},r.prototype.getClassName=function(){return"TargetCamera"},A([t.serializeAsVector3()],r.prototype,"rotation",void 0),A([t.serialize()],r.prototype,"speed",void 0),A([t.serializeAsMeshReference("lockedTargetId")],r.prototype,"lockedTarget",void 0),r}(t.Camera);t.TargetCamera=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){r===void 0&&(r=!0),this.touchEnabled=r,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return c.prototype.attachControl=function(r,i){var a=this,n=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(s,o){var l=s.event;if(!n.isInVRExclusivePointerMode&&!(!a.touchEnabled&&l.pointerType==="touch")&&!(s.type!==t.PointerEventTypes.POINTERMOVE&&a.buttons.indexOf(l.button)===-1)){var u=l.srcElement||l.target;if(s.type===t.PointerEventTypes.POINTERDOWN&&u){try{u.setPointerCapture(l.pointerId)}catch{}a.previousPosition={x:l.clientX,y:l.clientY},i||(l.preventDefault(),r.focus())}else if(s.type===t.PointerEventTypes.POINTERUP&&u){try{u.releasePointerCapture(l.pointerId)}catch{}a.previousPosition=null,i||l.preventDefault()}else if(s.type===t.PointerEventTypes.POINTERMOVE){if(!a.previousPosition||n.isPointerLock)return;var h=l.clientX-a.previousPosition.x;a.camera.getScene().useRightHandedSystem&&(h*=-1),a.camera.parent&&a.camera.parent._getWorldMatrixDeterminant()<0&&(h*=-1),a.camera.cameraRotation.y+=h/a.angularSensibility;var d=l.clientY-a.previousPosition.y;a.camera.cameraRotation.x+=d/a.angularSensibility,a.previousPosition={x:l.clientX,y:l.clientY},i||l.preventDefault()}}}),this._onMouseMove=function(s){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var o=s.movementX||s.mozMovementX||s.webkitMovementX||s.msMovementX||0;a.camera.getScene().useRightHandedSystem&&(o*=-1),a.camera.parent&&a.camera.parent._getWorldMatrixDeterminant()<0&&(o*=-1),a.camera.cameraRotation.y+=o/a.angularSensibility;var l=s.movementY||s.mozMovementY||s.webkitMovementY||s.msMovementY||0;a.camera.cameraRotation.x+=l/a.angularSensibility,a.previousPosition=null,i||s.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,t.PointerEventTypes.POINTERDOWN|t.PointerEventTypes.POINTERUP|t.PointerEventTypes.POINTERMOVE),r.addEventListener("mousemove",this._onMouseMove,!1)},c.prototype.detachControl=function(r){this._observer&&r&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&r.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},c.prototype.getClassName=function(){return"FreeCameraMouseInput"},c.prototype.getSimpleName=function(){return"mouse"},A([t.serialize()],c.prototype,"buttons",void 0),A([t.serialize()],c.prototype,"angularSensibility",void 0),c}();t.FreeCameraMouseInput=f,t.CameraInputTypes.FreeCameraMouseInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return c.prototype.attachControl=function(r,i){var a=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){a._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var s=n.event;if(n.type===t.KeyboardEventTypes.KEYDOWN){if(a.keysUp.indexOf(s.keyCode)!==-1||a.keysDown.indexOf(s.keyCode)!==-1||a.keysLeft.indexOf(s.keyCode)!==-1||a.keysRight.indexOf(s.keyCode)!==-1){var o=a._keys.indexOf(s.keyCode);o===-1&&a._keys.push(s.keyCode),i||s.preventDefault()}}else if(a.keysUp.indexOf(s.keyCode)!==-1||a.keysDown.indexOf(s.keyCode)!==-1||a.keysLeft.indexOf(s.keyCode)!==-1||a.keysRight.indexOf(s.keyCode)!==-1){var o=a._keys.indexOf(s.keyCode);o>=0&&a._keys.splice(o,1),i||s.preventDefault()}}))},c.prototype.detachControl=function(r){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},c.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var r=this.camera,i=0;i<this._keys.length;i++){var a=this._keys[i],n=r._computeLocalCameraSpeed();this.keysLeft.indexOf(a)!==-1?r._localDirection.copyFromFloats(-n,0,0):this.keysUp.indexOf(a)!==-1?r._localDirection.copyFromFloats(0,0,n):this.keysRight.indexOf(a)!==-1?r._localDirection.copyFromFloats(n,0,0):this.keysDown.indexOf(a)!==-1&&r._localDirection.copyFromFloats(0,0,-n),r.getScene().useRightHandedSystem&&(r._localDirection.z*=-1),r.getViewMatrix().invertToRef(r._cameraTransformMatrix),t.Vector3.TransformNormalToRef(r._localDirection,r._cameraTransformMatrix,r._transformedDirection),r.cameraDirection.addInPlace(r._transformedDirection)}},c.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},c.prototype._onLostFocus=function(r){this._keys=[]},c.prototype.getSimpleName=function(){return"keyboard"},A([t.serialize()],c.prototype,"keysUp",void 0),A([t.serialize()],c.prototype,"keysDown",void 0),A([t.serialize()],c.prototype,"keysLeft",void 0),A([t.serialize()],c.prototype,"keysRight",void 0),c}();t.FreeCameraKeyboardMoveInput=f,t.CameraInputTypes.FreeCameraKeyboardMoveInput=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){return c.call(this,i)||this}return r.prototype.addKeyboard=function(){return this.add(new t.FreeCameraKeyboardMoveInput),this},r.prototype.addMouse=function(i){return i===void 0&&(i=!0),this.add(new t.FreeCameraMouseInput(i)),this},r.prototype.addDeviceOrientation=function(){return this.add(new t.FreeCameraDeviceOrientationInput),this},r.prototype.addTouch=function(){return this.add(new t.FreeCameraTouchInput),this},r.prototype.addVirtualJoystick=function(){return this.add(new t.FreeCameraVirtualJoystickInput),this},r}(t.CameraInputsManager);t.FreeCameraInputsManager=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("FreeCamera",function(c,r){return function(){return new t.UniversalCamera(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s=!0);var o=c.call(this,i,a,n,s)||this;return o.ellipsoid=new t.Vector3(.5,1,.5),o.ellipsoidOffset=new t.Vector3(0,0,0),o.checkCollisions=!1,o.applyGravity=!1,o._needMoveForGravity=!1,o._oldPosition=t.Vector3.Zero(),o._diffPosition=t.Vector3.Zero(),o._newPosition=t.Vector3.Zero(),o._collisionMask=-1,o._onCollisionPositionChange=function(l,u,h){h===void 0&&(h=null),o.getScene().workerCollisions&&u.multiplyInPlace(o._collider._radius);var d=function(p){o._newPosition.copyFrom(p),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>t.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&h&&o.onCollide(h))};d(u)},o.inputs=new t.FreeCameraInputsManager(o),o.inputs.addKeyboard().addMouse(),o}return Object.defineProperty(r.prototype,"angularSensibility",{get:function(){var i=this.inputs.attached.mouse;return i?i.angularSensibility:0},set:function(i){var a=this.inputs.attached.mouse;a&&(a.angularSensibility=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysUp",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysUp:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysUp=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysDown",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysDown:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysDown=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysLeft",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysLeft:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysLeft=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysRight",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysRight:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysRight=i)},enumerable:!0,configurable:!0}),r.prototype.attachControl=function(i,a){this.inputs.attachElement(i,a)},r.prototype.detachControl=function(i){this.inputs.detachElement(i),this.cameraDirection=new t.Vector3(0,0,0),this.cameraRotation=new t.Vector2(0,0)},Object.defineProperty(r.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(i){this._collisionMask=isNaN(i)?-1:i},enumerable:!0,configurable:!0}),r.prototype._collideWithWorld=function(i){var a;this.parent?a=t.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):a=this.position,a.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new t.Collider),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var n=i;this.applyGravity&&(n=i.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},r.prototype._checkInputs=function(){this._localDirection||(this._localDirection=t.Vector3.Zero(),this._transformedDirection=t.Vector3.Zero()),this.inputs.checkInputs(),c.prototype._checkInputs.call(this)},r.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},r.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):c.prototype._updatePosition.call(this)},r.prototype.dispose=function(){this.inputs.clear(),c.prototype.dispose.call(this)},r.prototype.getClassName=function(){return"FreeCamera"},A([t.serializeAsVector3()],r.prototype,"ellipsoid",void 0),A([t.serializeAsVector3()],r.prototype,"ellipsoidOffset",void 0),A([t.serialize()],r.prototype,"checkCollisions",void 0),A([t.serialize()],r.prototype,"applyGravity",void 0),r}(t.TargetCamera);t.FreeCamera=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return c.prototype.attachControl=function(r,i){var a=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){a._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(n){var s=n.event;if(n.type===t.KeyboardEventTypes.KEYDOWN){if(a._ctrlPressed=s.ctrlKey,a._altPressed=s.altKey,a.keysUp.indexOf(s.keyCode)!==-1||a.keysDown.indexOf(s.keyCode)!==-1||a.keysLeft.indexOf(s.keyCode)!==-1||a.keysRight.indexOf(s.keyCode)!==-1||a.keysReset.indexOf(s.keyCode)!==-1){var o=a._keys.indexOf(s.keyCode);o===-1&&a._keys.push(s.keyCode),s.preventDefault&&(i||s.preventDefault())}}else if(a.keysUp.indexOf(s.keyCode)!==-1||a.keysDown.indexOf(s.keyCode)!==-1||a.keysLeft.indexOf(s.keyCode)!==-1||a.keysRight.indexOf(s.keyCode)!==-1||a.keysReset.indexOf(s.keyCode)!==-1){var o=a._keys.indexOf(s.keyCode);o>=0&&a._keys.splice(o,1),s.preventDefault&&(i||s.preventDefault())}}))},c.prototype.detachControl=function(r){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},c.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var r=this.camera,i=0;i<this._keys.length;i++){var a=this._keys[i];this.keysLeft.indexOf(a)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningX-=1/this.panningSensibility:r.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(a)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?r.inertialRadiusOffset+=1/this.zoomingSensibility:r.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(a)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningX+=1/this.panningSensibility:r.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(a)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?r.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?r.inertialRadiusOffset-=1/this.zoomingSensibility:r.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(a)!==-1&&r.useInputToRestoreState&&r.restoreState()}},c.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},c.prototype.getSimpleName=function(){return"keyboard"},A([t.serialize()],c.prototype,"keysUp",void 0),A([t.serialize()],c.prototype,"keysDown",void 0),A([t.serialize()],c.prototype,"keysLeft",void 0),A([t.serialize()],c.prototype,"keysRight",void 0),A([t.serialize()],c.prototype,"keysReset",void 0),A([t.serialize()],c.prototype,"panningSensibility",void 0),A([t.serialize()],c.prototype,"zoomingSensibility",void 0),A([t.serialize()],c.prototype,"useAltToZoom",void 0),A([t.serialize()],c.prototype,"angularSpeed",void 0),c}();t.ArcRotateCameraKeyboardMoveInput=f,t.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return c.prototype.attachControl=function(r,i){var a=this;this._wheel=function(n,s){if(n.type===t.PointerEventTypes.POINTERWHEEL){var o=n.event,l=0;if(o.wheelDelta)if(a.wheelDeltaPercentage){var u=o.wheelDelta*.01*a.wheelDeltaPercentage*a.camera.radius;o.wheelDelta>0?l=u/(1+a.wheelDeltaPercentage):l=u*(1+a.wheelDeltaPercentage)}else l=o.wheelDelta/(a.wheelPrecision*40);else o.detail&&(l=-o.detail/a.wheelPrecision);l&&(a.camera.inertialRadiusOffset+=l),o.preventDefault&&(i||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,t.PointerEventTypes.POINTERWHEEL)},c.prototype.detachControl=function(r){this._observer&&r&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},c.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},c.prototype.getSimpleName=function(){return"mousewheel"},A([t.serialize()],c.prototype,"wheelPrecision",void 0),A([t.serialize()],c.prototype,"wheelDeltaPercentage",void 0),c}();t.ArcRotateCameraMouseWheelInput=f,t.CameraInputTypes.ArcRotateCameraMouseWheelInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1}return c.prototype.attachControl=function(r,i){var a=this,n=this.camera.getEngine(),s,o=null,l=null,u=0,h=0,d=0,p={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(m,_){var v=m.event,S=m.event.pointerType==="touch";if(!n.isInVRExclusivePointerMode&&!(m.type!==t.PointerEventTypes.POINTERMOVE&&a.buttons.indexOf(v.button)===-1)){var P=v.srcElement||v.target;if(m.type===t.PointerEventTypes.POINTERDOWN&&P){try{P.setPointerCapture(v.pointerId)}catch{}a._isPanClick=v.button===a.camera._panningMouseButton,s={x:v.clientX,y:v.clientY,pointerId:v.pointerId,type:v.pointerType},o===null?o=s:l===null&&(l=s),i||(v.preventDefault(),r.focus())}else if(m.type===t.PointerEventTypes.POINTERDOUBLETAP)a.camera.useInputToRestoreState&&a.camera.restoreState();else if(m.type===t.PointerEventTypes.POINTERUP&&P){try{P.releasePointerCapture(v.pointerId)}catch{}s=null,u=0,p.isPaning=!1,p.isPinching=!1,d=0,h=0,S||(l=null),n._badOS?o=l=null:l&&o&&o.pointerId==v.pointerId?(o=l,l=null,s={x:o.x,y:o.y,pointerId:o.pointerId,type:v.pointerType}):o&&l&&l.pointerId==v.pointerId?(l=null,s={x:o.x,y:o.y,pointerId:o.pointerId,type:v.pointerType}):o=l=null,i||v.preventDefault()}else if(m.type===t.PointerEventTypes.POINTERMOVE){if(i||v.preventDefault(),o&&l===null&&s){if(a.panningSensibility!==0&&(v.ctrlKey&&a.camera._useCtrlForPanning||a._isPanClick))a.camera.inertialPanningX+=-(v.clientX-s.x)/a.panningSensibility,a.camera.inertialPanningY+=(v.clientY-s.y)/a.panningSensibility;else{var x=v.clientX-s.x,R=v.clientY-s.y;a.camera.inertialAlphaOffset-=x/a.angularSensibilityX,a.camera.inertialBetaOffset-=R/a.angularSensibilityY}s.x=v.clientX,s.y=v.clientY}else if(o&&l){var w=o.pointerId===v.pointerId?o:l;w.x=v.clientX,w.y=v.clientY;var I=a.pinchInwards?1:-1,F=o.x-l.x,k=o.y-l.y,E=F*F+k*k,g=Math.sqrt(E);if(u===0){h=g,u=E,p.x=(o.x+l.x)/2,p.y=(o.y+l.y)/2;return}if(a.multiTouchPanAndZoom){if(a.pinchDeltaPercentage?a.camera.inertialRadiusOffset+=(E-u)*.001*a.camera.radius*a.pinchDeltaPercentage:a.camera.inertialRadiusOffset+=(E-u)/(a.pinchPrecision*((a.angularSensibilityX+a.angularSensibilityY)/2)*I),a.panningSensibility!==0){var y=(o.x+l.x)/2,M=(o.y+l.y)/2,C=y-p.x,D=M-p.y;p.x=y,p.y=M,a.camera.inertialPanningX+=-C/a.panningSensibility,a.camera.inertialPanningY+=D/a.panningSensibility}}else{if(d++,p.isPinching||d<20&&Math.abs(g-h)>a.camera.pinchToPanMaxDistance)a.pinchDeltaPercentage?a.camera.inertialRadiusOffset+=(E-u)*.001*a.camera.radius*a.pinchDeltaPercentage:a.camera.inertialRadiusOffset+=(E-u)/(a.pinchPrecision*((a.angularSensibilityX+a.angularSensibilityY)/2)*I),p.isPaning=!1,p.isPinching=!0;else if(s&&s.pointerId===w.pointerId&&a.panningSensibility!==0&&a.multiTouchPanning){if(!p.isPaning){p.isPaning=!0,p.isPinching=!1,p.x=w.x,p.y=w.y;return}a.camera.inertialPanningX+=-(w.x-p.x)/a.panningSensibility,a.camera.inertialPanningY+=(w.y-p.y)/a.panningSensibility}s&&s.pointerId===v.pointerId&&(p.x=w.x,p.y=w.y)}u=E}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,t.PointerEventTypes.POINTERDOWN|t.PointerEventTypes.POINTERUP|t.PointerEventTypes.POINTERMOVE|t.PointerEventTypes.POINTERDOUBLETAP),this._onContextMenu=function(m){m.preventDefault()},this.camera._useCtrlForPanning||r.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){o=l=null,u=0,p.isPaning=!1,p.isPinching=!1,d=0,s=null,h=0},this._onMouseMove=function(m){if(n.isPointerLock){var _=m.movementX||m.mozMovementX||m.webkitMovementX||m.msMovementX||0,v=m.movementY||m.mozMovementY||m.webkitMovementY||m.msMovementY||0;a.camera.inertialAlphaOffset-=_/a.angularSensibilityX,a.camera.inertialBetaOffset-=v/a.angularSensibilityY,i||m.preventDefault()}},this._onGestureStart=function(m){window.MSGesture!==void 0&&(a._MSGestureHandler||(a._MSGestureHandler=new MSGesture,a._MSGestureHandler.target=r),a._MSGestureHandler.addPointer(m.pointerId))},this._onGesture=function(m){a.camera.radius*=m.scale,m.preventDefault&&(i||(m.stopPropagation(),m.preventDefault()))},r.addEventListener("mousemove",this._onMouseMove,!1),r.addEventListener("MSPointerDown",this._onGestureStart,!1),r.addEventListener("MSGestureChange",this._onGesture,!1),t.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},c.prototype.detachControl=function(r){this._onLostFocus&&t.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),r&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&r.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&r.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&r.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&r.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},c.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},c.prototype.getSimpleName=function(){return"pointers"},A([t.serialize()],c.prototype,"buttons",void 0),A([t.serialize()],c.prototype,"angularSensibilityX",void 0),A([t.serialize()],c.prototype,"angularSensibilityY",void 0),A([t.serialize()],c.prototype,"pinchPrecision",void 0),A([t.serialize()],c.prototype,"pinchDeltaPercentage",void 0),A([t.serialize()],c.prototype,"panningSensibility",void 0),A([t.serialize()],c.prototype,"multiTouchPanning",void 0),A([t.serialize()],c.prototype,"multiTouchPanAndZoom",void 0),c}();t.ArcRotateCameraPointersInput=f,t.CameraInputTypes.ArcRotateCameraPointersInput=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){return c.call(this,i)||this}return r.prototype.addMouseWheel=function(){return this.add(new t.ArcRotateCameraMouseWheelInput),this},r.prototype.addPointers=function(){return this.add(new t.ArcRotateCameraPointersInput),this},r.prototype.addKeyboard=function(){return this.add(new t.ArcRotateCameraKeyboardMoveInput),this},r.prototype.addVRDeviceOrientation=function(){return this.add(new t.ArcRotateCameraVRDeviceOrientationInput),this},r}(t.CameraInputsManager);t.ArcRotateCameraInputsManager=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("ArcRotateCamera",function(c,r){return function(){return new f(c,0,0,1,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){u===void 0&&(u=!0);var h=c.call(this,i,t.Vector3.Zero(),l,u)||this;return h.inertialAlphaOffset=0,h.inertialBetaOffset=0,h.inertialRadiusOffset=0,h.lowerAlphaLimit=null,h.upperAlphaLimit=null,h.lowerBetaLimit=.01,h.upperBetaLimit=Math.PI,h.lowerRadiusLimit=null,h.upperRadiusLimit=null,h.inertialPanningX=0,h.inertialPanningY=0,h.pinchToPanMaxDistance=20,h.panningDistanceLimit=null,h.panningOriginTarget=t.Vector3.Zero(),h.panningInertia=.9,h.zoomOnFactor=1,h.targetScreenOffset=t.Vector2.Zero(),h.allowUpsideDown=!0,h.useInputToRestoreState=!0,h._viewMatrix=new t.Matrix,h.panningAxis=new t.Vector3(1,1,0),h.onMeshTargetChangedObservable=new t.Observable,h.checkCollisions=!1,h.collisionRadius=new t.Vector3(.5,.5,.5),h._previousPosition=t.Vector3.Zero(),h._collisionVelocity=t.Vector3.Zero(),h._newPosition=t.Vector3.Zero(),h._computationVector=t.Vector3.Zero(),h._onCollisionPositionChange=function(d,p,m){m===void 0&&(m=null),h.getScene().workerCollisions&&h.checkCollisions&&p.multiplyInPlace(h._collider._radius),m?(h.setPosition(p),h.onCollide&&h.onCollide(m)):h._previousPosition.copyFrom(h.position);var _=Math.cos(h.alpha),v=Math.sin(h.alpha),S=Math.cos(h.beta),P=Math.sin(h.beta);P===0&&(P=1e-4);var x=h._getTargetPosition();h._computationVector.copyFromFloats(h.radius*_*P,h.radius*S,h.radius*v*P),x.addToRef(h._computationVector,h._newPosition),h.position.copyFrom(h._newPosition);var R=h.upVector;h.allowUpsideDown&&h.beta<0&&(R=R.clone(),R=R.negate()),h._computeViewMatrix(h.position,x,R),h._viewMatrix.m[12]+=h.targetScreenOffset.x,h._viewMatrix.m[13]+=h.targetScreenOffset.y,h._collisionTriggered=!1},h._target=t.Vector3.Zero(),o&&h.setTarget(o),h.alpha=a,h.beta=n,h.radius=s,h.getViewMatrix(),h.inputs=new t.ArcRotateCameraInputsManager(h),h.inputs.addKeyboard().addMouseWheel().addPointers(),h}return Object.defineProperty(r.prototype,"target",{get:function(){return this._target},set:function(i){this.setTarget(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularSensibilityX",{get:function(){var i=this.inputs.attached.pointers;return i?i.angularSensibilityX:0},set:function(i){var a=this.inputs.attached.pointers;a&&(a.angularSensibilityX=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularSensibilityY",{get:function(){var i=this.inputs.attached.pointers;return i?i.angularSensibilityY:0},set:function(i){var a=this.inputs.attached.pointers;a&&(a.angularSensibilityY=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pinchPrecision",{get:function(){var i=this.inputs.attached.pointers;return i?i.pinchPrecision:0},set:function(i){var a=this.inputs.attached.pointers;a&&(a.pinchPrecision=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pinchDeltaPercentage",{get:function(){var i=this.inputs.attached.pointers;return i?i.pinchDeltaPercentage:0},set:function(i){var a=this.inputs.attached.pointers;a&&(a.pinchDeltaPercentage=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"panningSensibility",{get:function(){var i=this.inputs.attached.pointers;return i?i.panningSensibility:0},set:function(i){var a=this.inputs.attached.pointers;a&&(a.panningSensibility=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysUp",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysUp:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysUp=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysDown",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysDown:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysDown=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysLeft",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysLeft:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysLeft=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"keysRight",{get:function(){var i=this.inputs.attached.keyboard;return i?i.keysRight:[]},set:function(i){var a=this.inputs.attached.keyboard;a&&(a.keysRight=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wheelPrecision",{get:function(){var i=this.inputs.attached.mousewheel;return i?i.wheelPrecision:0},set:function(i){var a=this.inputs.attached.mousewheel;a&&(a.wheelPrecision=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wheelDeltaPercentage",{get:function(){var i=this.inputs.attached.mousewheel;return i?i.wheelDeltaPercentage:0},set:function(i){var a=this.inputs.attached.mousewheel;a&&(a.wheelDeltaPercentage=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(i){i!==this.useBouncingBehavior&&(i?(this._bouncingBehavior=new t.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(i){i!==this.useFramingBehavior&&(i?(this._framingBehavior=new t.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(i){i!==this.useAutoRotationBehavior&&(i?(this._autoRotationBehavior=new t.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),r.prototype._initCache=function(){c.prototype._initCache.call(this),this._cache._target=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=t.Vector2.Zero()},r.prototype._updateCache=function(i){i||c.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},r.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var i=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?i.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(i)}var a=this._getLockedTargetPosition();return a||this._target},r.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),c.prototype.storeState.call(this)},r.prototype._restoreStateValues=function(){return c.prototype._restoreStateValues.call(this)?(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1},r.prototype._isSynchronizedViewMatrix=function(){return c.prototype._isSynchronizedViewMatrix.call(this)?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},r.prototype.attachControl=function(i,a,n,s){var o=this;n===void 0&&(n=!0),s===void 0&&(s=2),this._useCtrlForPanning=n,this._panningMouseButton=s,this.inputs.attachElement(i,a),this._reset=function(){o.inertialAlphaOffset=0,o.inertialBetaOffset=0,o.inertialRadiusOffset=0,o.inertialPanningX=0,o.inertialPanningY=0}},r.prototype.detachControl=function(i){this.inputs.detachElement(i),this._reset&&this._reset()},r.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var i=this.inertialAlphaOffset;this.beta<=0&&(i*=-1),this.getScene().useRightHandedSystem&&(i*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(i*=-1),this.alpha+=i,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<t.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<t.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*t.Epsilon&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){if(this._localDirection||(this._localDirection=t.Vector3.Zero(),this._transformedDirection=t.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var a=t.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget);a<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*t.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*t.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),c.prototype._checkInputs.call(this)}},r.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},r.prototype.rebuildAnglesAndRadius=function(){this.position.subtractToRef(this._getTargetPosition(),this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4),this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},r.prototype.setPosition=function(i){this.position.equals(i)||(this.position.copyFrom(i),this.rebuildAnglesAndRadius())},r.prototype.setTarget=function(i,a,n){if(a===void 0&&(a=!1),n===void 0&&(n=!1),i.getBoundingInfo)a?this._targetBoundingCenter=i.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,this._targetHost=i,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var s=i,o=this._getTargetPosition();if(o&&!n&&o.equals(s))return;this._targetHost=null,this._target=s,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},r.prototype._getViewMatrix=function(){var i=Math.cos(this.alpha),a=Math.sin(this.alpha),n=Math.cos(this.beta),s=Math.sin(this.beta);s===0&&(s=1e-4);var o=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*i*s,this.radius*n,this.radius*a*s),o.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new t.Collider),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var l=this.upVector;this.allowUpsideDown&&s<0&&(l=l.clone(),l=l.negate()),this._computeViewMatrix(this.position,o,l),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._currentTarget=o,this._viewMatrix},r.prototype.zoomOn=function(i,a){a===void 0&&(a=!1),i=i||this.getScene().meshes;var n=t.Mesh.MinMax(i),s=t.Vector3.Distance(n.min,n.max);this.radius=s*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:s},a)},r.prototype.focusOn=function(i,a){a===void 0&&(a=!1);var n,s;if(i.min===void 0){var o=i||this.getScene().meshes;n=t.Mesh.MinMax(o),s=t.Vector3.Distance(n.min,n.max)}else{var l=i;n=l,s=l.distance}this._target=t.Mesh.Center(n),a||(this.maxZ=s*2)},r.prototype.createRigCamera=function(i,a){var n=0;switch(this.cameraRigMode){case t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.Camera.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(a===0?1:-1);break;case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(a===0?-1:1);break}var s=new r(i,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s},r.prototype._updateRigCameras=function(){var i=this._rigCameras[0],a=this._rigCameras[1];switch(i.beta=a.beta=this.beta,i.radius=a.radius=this.radius,this.cameraRigMode){case t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.Camera.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,a.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}c.prototype._updateRigCameras.call(this)},r.prototype.dispose=function(){this.inputs.clear(),c.prototype.dispose.call(this)},r.prototype.getClassName=function(){return"ArcRotateCamera"},A([t.serialize()],r.prototype,"alpha",void 0),A([t.serialize()],r.prototype,"beta",void 0),A([t.serialize()],r.prototype,"radius",void 0),A([t.serializeAsVector3("target")],r.prototype,"_target",void 0),A([t.serialize()],r.prototype,"inertialAlphaOffset",void 0),A([t.serialize()],r.prototype,"inertialBetaOffset",void 0),A([t.serialize()],r.prototype,"inertialRadiusOffset",void 0),A([t.serialize()],r.prototype,"lowerAlphaLimit",void 0),A([t.serialize()],r.prototype,"upperAlphaLimit",void 0),A([t.serialize()],r.prototype,"lowerBetaLimit",void 0),A([t.serialize()],r.prototype,"upperBetaLimit",void 0),A([t.serialize()],r.prototype,"lowerRadiusLimit",void 0),A([t.serialize()],r.prototype,"upperRadiusLimit",void 0),A([t.serialize()],r.prototype,"inertialPanningX",void 0),A([t.serialize()],r.prototype,"inertialPanningY",void 0),A([t.serialize()],r.prototype,"pinchToPanMaxDistance",void 0),A([t.serialize()],r.prototype,"panningDistanceLimit",void 0),A([t.serializeAsVector3()],r.prototype,"panningOriginTarget",void 0),A([t.serialize()],r.prototype,"panningInertia",void 0),A([t.serialize()],r.prototype,"zoomOnFactor",void 0),A([t.serialize()],r.prototype,"targetScreenOffset",void 0),A([t.serialize()],r.prototype,"allowUpsideDown",void 0),A([t.serialize()],r.prototype,"useInputToRestoreState",void 0),r}(t.TargetCamera);t.ArcRotateCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("Light_Type_3",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,n)||this;return s.groundColor=new t.Color3(0,0,0),s.direction=a||t.Vector3.Up(),s}return r.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},r.prototype.getClassName=function(){return"HemisphericLight"},r.prototype.setDirectionToTarget=function(i){return this.direction=t.Vector3.Normalize(i.subtract(t.Vector3.Zero())),this.direction},r.prototype.getShadowGenerator=function(){return null},r.prototype.transferToEffect=function(i,a){var n=t.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,a),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),a),this},r.prototype.computeWorldMatrix=function(i,a){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix},r.prototype.getTypeID=function(){return t.Light.LIGHTTYPEID_HEMISPHERICLIGHT},r.prototype.prepareLightSpecificDefines=function(i,a){i["HEMILIGHT"+a]=!0},A([t.serializeAsColor3()],r.prototype,"groundColor",void 0),A([t.serializeAsVector3()],r.prototype,"direction",void 0),r}(t.Light);t.HemisphericLight=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(){var i=c!==null&&c.apply(this,arguments)||this;return i._needProjectionMatrixCompute=!0,i}return r.prototype._setPosition=function(i){this._position=i},Object.defineProperty(r.prototype,"position",{get:function(){return this._position},set:function(i){this._setPosition(i)},enumerable:!0,configurable:!0}),r.prototype._setDirection=function(i){this._direction=i},Object.defineProperty(r.prototype,"direction",{get:function(){return this._direction},set:function(i){this._setDirection(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(i){this._shadowMinZ=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(i){this._shadowMaxZ=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),r.prototype.computeTransformedInformation=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=t.Vector3.Zero()),t.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=t.Vector3.Zero()),t.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0):!1},r.prototype.getDepthScale=function(){return 50},r.prototype.getShadowDirection=function(i){return this.transformedDirection?this.transformedDirection:this.direction},r.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},r.prototype.setDirectionToTarget=function(i){return this.direction=t.Vector3.Normalize(i.subtract(this.position)),this.direction},r.prototype.getRotation=function(){this.direction.normalize();var i=t.Vector3.Cross(this.direction,t.Axis.Y),a=t.Vector3.Cross(i,this.direction);return t.Vector3.RotationFromAxis(i,a,this.direction)},r.prototype.needCube=function(){return!1},r.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},r.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},r.prototype._initCache=function(){c.prototype._initCache.call(this),this._cache.position=t.Vector3.Zero()},r.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},r.prototype.computeWorldMatrix=function(i){return!i&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),t.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix)},r.prototype.getDepthMinZ=function(i){return this.shadowMinZ!==void 0?this.shadowMinZ:i.minZ},r.prototype.getDepthMaxZ=function(i){return this.shadowMaxZ!==void 0?this.shadowMaxZ:i.maxZ},r.prototype.setShadowProjectionMatrix=function(i,a,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(a,n,i):this._setDefaultShadowProjectionMatrix(i,a,n),this},A([t.serializeAsVector3()],r.prototype,"position",null),A([t.serializeAsVector3()],r.prototype,"direction",null),A([t.serialize()],r.prototype,"shadowMinZ",null),A([t.serialize()],r.prototype,"shadowMaxZ",null),r}(t.Light);t.ShadowLight=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("Light_Type_0",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,n)||this;return s._shadowAngle=Math.PI/2,s.position=a,s}return Object.defineProperty(r.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(i){this._shadowAngle=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"direction",{get:function(){return this._direction},set:function(i){var a=this.needCube();this._direction=i,this.needCube()!==a&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"PointLight"},r.prototype.getTypeID=function(){return t.Light.LIGHTTYPEID_POINTLIGHT},r.prototype.needCube=function(){return!this.direction},r.prototype.getShadowDirection=function(i){if(this.direction)return c.prototype.getShadowDirection.call(this,i);switch(i){case 0:return new t.Vector3(1,0,0);case 1:return new t.Vector3(-1,0,0);case 2:return new t.Vector3(0,-1,0);case 3:return new t.Vector3(0,1,0);case 4:return new t.Vector3(0,0,1);case 5:return new t.Vector3(0,0,-1)}return t.Vector3.Zero()},r.prototype._setDefaultShadowProjectionMatrix=function(i,a,n){var s=this.getScene().activeCamera;s&&t.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(s),this.getDepthMaxZ(s),i)},r.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},r.prototype.transferToEffect=function(i,a){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,a):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,a),this},r.prototype.prepareLightSpecificDefines=function(i,a){i["POINTLIGHT"+a]=!0},A([t.serialize()],r.prototype,"shadowAngle",null),r}(t.ShadowLight);t.PointLight=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("Light_Type_1",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,n)||this;return s._shadowFrustumSize=0,s._shadowOrthoScale=.1,s.autoUpdateExtends=!0,s._orthoLeft=Number.MAX_VALUE,s._orthoRight=Number.MIN_VALUE,s._orthoTop=Number.MIN_VALUE,s._orthoBottom=Number.MAX_VALUE,s.position=a.scale(-1),s.direction=a,s}return Object.defineProperty(r.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(i){this._shadowFrustumSize=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(i){this._shadowOrthoScale=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"DirectionalLight"},r.prototype.getTypeID=function(){return t.Light.LIGHTTYPEID_DIRECTIONALLIGHT},r.prototype._setDefaultShadowProjectionMatrix=function(i,a,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(i,a):this._setDefaultAutoExtendShadowProjectionMatrix(i,a,n)},r.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(i,a){var n=this.getScene().activeCamera;n&&t.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,this.shadowMinZ!==void 0?this.shadowMinZ:n.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:n.maxZ,i)},r.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(i,a,n){var s=this.getScene().activeCamera;if(s){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var o=t.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var l=0;l<n.length;l++){var u=n[l];if(u)for(var h=u.getBoundingInfo(),d=h.boundingBox,p=0;p<d.vectorsWorld.length;p++)t.Vector3.TransformCoordinatesToRef(d.vectorsWorld[p],a,o),o.x<this._orthoLeft&&(this._orthoLeft=o.x),o.y<this._orthoBottom&&(this._orthoBottom=o.y),o.x>this._orthoRight&&(this._orthoRight=o.x),o.y>this._orthoTop&&(this._orthoTop=o.y)}}var m=this._orthoRight-this._orthoLeft,_=this._orthoTop-this._orthoBottom;t.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-m*this.shadowOrthoScale,this._orthoRight+m*this.shadowOrthoScale,this._orthoBottom-_*this.shadowOrthoScale,this._orthoTop+_*this.shadowOrthoScale,this.shadowMinZ!==void 0?this.shadowMinZ:s.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:s.maxZ,i)}},r.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},r.prototype.transferToEffect=function(i,a){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,a),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,a),this)},r.prototype.getDepthMinZ=function(i){return 1},r.prototype.getDepthMaxZ=function(i){return 1},r.prototype.prepareLightSpecificDefines=function(i,a){i["DIRLIGHT"+a]=!0},A([t.serialize()],r.prototype,"shadowFrustumSize",null),A([t.serialize()],r.prototype,"shadowOrthoScale",null),A([t.serialize()],r.prototype,"autoUpdateExtends",void 0),r}(t.ShadowLight);t.DirectionalLight=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("Light_Type_2",function(c,r){return function(){return new f(c,t.Vector3.Zero(),t.Vector3.Zero(),0,0,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o,l){var u=c.call(this,i,l)||this;return u._innerAngle=0,u._projectionTextureMatrix=t.Matrix.Zero(),u._projectionTextureLightNear=1e-6,u._projectionTextureLightFar=1e3,u._projectionTextureUpDirection=t.Vector3.Up(),u._projectionTextureViewLightDirty=!0,u._projectionTextureProjectionLightDirty=!0,u._projectionTextureDirty=!0,u._projectionTextureViewTargetVector=t.Vector3.Zero(),u._projectionTextureViewLightMatrix=t.Matrix.Zero(),u._projectionTextureProjectionLightMatrix=t.Matrix.Zero(),u._projectionTextureScalingMatrix=t.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),u.position=a,u.direction=n,u.angle=s,u.exponent=o,u}return Object.defineProperty(r.prototype,"angle",{get:function(){return this._angle},set:function(i){this._angle=i,this._cosHalfAngle=Math.cos(i*.5),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(i){this._innerAngle=i,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(i){this._shadowAngleScale=i,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(i){this._projectionTextureLightNear=i,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(i){this._projectionTextureLightFar=i,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(i){this._projectionTextureUpDirection=i,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(i){this._projectionTexture=i,this._projectionTextureDirty=!0},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"SpotLight"},r.prototype.getTypeID=function(){return t.Light.LIGHTTYPEID_SPOTLIGHT},r.prototype._setDirection=function(i){c.prototype._setDirection.call(this,i),this._projectionTextureViewLightDirty=!0},r.prototype._setPosition=function(i){c.prototype._setPosition.call(this,i),this._projectionTextureViewLightDirty=!0},r.prototype._setDefaultShadowProjectionMatrix=function(i,a,n){var s=this.getScene().activeCamera;if(s){this._shadowAngleScale=this._shadowAngleScale||1;var o=this._shadowAngleScale*this._angle;t.Matrix.PerspectiveFovLHToRef(o,1,this.getDepthMinZ(s),this.getDepthMaxZ(s),i)}},r.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),t.Matrix.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},r.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var i=this.projectionTextureLightFar,a=this.projectionTextureLightNear,n=i/(i-a),s=-n*a,o=1/Math.tan(this._angle/2),l=1;t.Matrix.FromValuesToRef(o/l,0,0,0,0,o,0,0,0,0,n,1,0,0,s,0,this._projectionTextureProjectionLightMatrix)},r.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},r.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},r.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(this._innerAngle*.5)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},r.prototype.transferToEffect=function(i,a){var n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,a),n=t.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,a),n=t.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,a),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,a),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),i.setMatrix("textureProjectionMatrix"+a,this._projectionTextureMatrix),i.setTexture("projectionLightSampler"+a,this.projectionTexture)),this},r.prototype.dispose=function(){c.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},r.prototype.prepareLightSpecificDefines=function(i,a){i["SPOTLIGHT"+a]=!0,i["PROJECTEDLIGHTTEXTURE"+a]=!!this.projectionTexture},A([t.serialize()],r.prototype,"angle",null),A([t.serialize()],r.prototype,"innerAngle",null),A([t.serialize()],r.prototype,"shadowAngleScale",null),A([t.serialize()],r.prototype,"exponent",void 0),A([t.serialize()],r.prototype,"projectionTextureLightNear",null),A([t.serialize()],r.prototype,"projectionTextureLightFar",null),A([t.serialize()],r.prototype,"projectionTextureUpDirection",null),A([t.serializeAsTexture("projectedLightTexture")],r.prototype,"_projectionTexture",void 0),r}(t.ShadowLight);t.SpotLight=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=t.Animation.ANIMATIONLOOPMODE_CYCLE}return c}();t.AnimationPropertiesOverride=f})(T||(T={}));var T;(function(t){var f=function(){function n(s,o,l){this.name=s,this.from=o,this.to=l}return n.prototype.clone=function(){return new n(this.name,this.from,this.to)},n}();t.AnimationRange=f;var c=function(){function n(s,o,l){this.frame=s,this.action=o,this.onlyOnce=l,this.isDone=!1}return n.prototype._clone=function(){return new n(this.frame,this.action,this.onlyOnce)},n}();t.AnimationEvent=c;var r=function(){function n(s){this.path=s,this._onchange=new Array,this.value=0,this.animations=new Array}return n.prototype.getPoint=function(){var s=this.path.getPointAtLengthPosition(this.value);return new t.Vector3(s.x,0,s.y)},n.prototype.moveAhead=function(s){return s===void 0&&(s=.002),this.move(s),this},n.prototype.moveBack=function(s){return s===void 0&&(s=.002),this.move(-s),this},n.prototype.move=function(s){if(Math.abs(s)>1)throw"step size should be less than 1.";return this.value+=s,this.ensureLimits(),this.raiseOnChange(),this},n.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},n.prototype.raiseOnChange=function(){var s=this;return this._onchange.forEach(function(o){return o(s)}),this},n.prototype.onchange=function(s){return this._onchange.push(s),this},n}();t.PathCursor=r;var i;(function(n){n[n.STEP=1]="STEP"})(i=t.AnimationKeyInterpolation||(t.AnimationKeyInterpolation={}));var a=function(){function n(s,o,l,u,h,d){this.name=s,this.targetProperty=o,this.framePerSecond=l,this.dataType=u,this.loopMode=h,this.enableBlending=d,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=o.split("."),this.dataType=u,this.loopMode=h===void 0?n.ANIMATIONLOOPMODE_CYCLE:h}return n._PrepareAnimation=function(s,o,l,u,h,d,p,m){var _=void 0;if(!isNaN(parseFloat(h))&&isFinite(h)?_=n.ANIMATIONTYPE_FLOAT:h instanceof t.Quaternion?_=n.ANIMATIONTYPE_QUATERNION:h instanceof t.Vector3?_=n.ANIMATIONTYPE_VECTOR3:h instanceof t.Vector2?_=n.ANIMATIONTYPE_VECTOR2:h instanceof t.Color3?_=n.ANIMATIONTYPE_COLOR3:h instanceof t.Size&&(_=n.ANIMATIONTYPE_SIZE),_==null)return null;var v=new n(s,o,l,_,p),S=[{frame:0,value:h},{frame:u,value:d}];return v.setKeys(S),m!==void 0&&v.setEasingFunction(m),v},n.CreateAnimation=function(s,o,l,u){var h=new n(s+"Animation",s,l,o,n.ANIMATIONLOOPMODE_CONSTANT);return h.setEasingFunction(u),h},n.CreateAndStartAnimation=function(s,o,l,u,h,d,p,m,_,v){var S=n._PrepareAnimation(s,l,u,h,d,p,m,_);return S?o.getScene().beginDirectAnimation(o,[S],0,h,S.loopMode===1,1,v):null},n.CreateAndStartHierarchyAnimation=function(s,o,l,u,h,d,p,m,_,v,S){var P=n._PrepareAnimation(s,u,h,d,p,m,_,v);if(!P)return null;var x=o.getScene();return x.beginDirectHierarchyAnimation(o,l,[P],0,d,P.loopMode===1,1,S)},n.CreateMergeAndStartAnimation=function(s,o,l,u,h,d,p,m,_,v){var S=n._PrepareAnimation(s,l,u,h,d,p,m,_);return S?(o.animations.push(S),o.getScene().beginAnimation(o,0,h,S.loopMode===1,1,v)):null},n.TransitionTo=function(s,o,l,u,h,d,p,m){if(m===void 0&&(m=null),p<=0)return l[s]=o,m&&m(),null;var _=h*(p/1e3);d.setKeys([{frame:0,value:l[s].clone?l[s].clone():l[s]},{frame:_,value:o}]),l.animations||(l.animations=[]),l.animations.push(d);var v=u.beginAnimation(l,0,_,!1);return v.onAnimationEnd=m,v},Object.defineProperty(n.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var s=0,o=this._runtimeAnimations;s<o.length;s++){var l=o[s];if(!l.isStopped)return!0}return!1},enumerable:!0,configurable:!0}),n.prototype.toString=function(s){var o="Name: "+this.name+", property: "+this.targetProperty;if(o+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],o+=", nKeys: "+(this._keys?this._keys.length:"none"),o+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),s){o+=", Ranges: {";var l=!0;for(var u in this._ranges)l&&(o+=", ",l=!1),o+=u;o+="}"}return o},n.prototype.addEvent=function(s){this._events.push(s)},n.prototype.removeEvents=function(s){for(var o=0;o<this._events.length;o++)this._events[o].frame===s&&(this._events.splice(o,1),o--)},n.prototype.getEvents=function(){return this._events},n.prototype.createRange=function(s,o,l){this._ranges[s]||(this._ranges[s]=new f(s,o,l))},n.prototype.deleteRange=function(s,o){o===void 0&&(o=!0);var l=this._ranges[s];if(l){if(o)for(var u=l.from,h=l.to,d=this._keys.length-1;d>=0;d--)this._keys[d].frame>=u&&this._keys[d].frame<=h&&this._keys.splice(d,1);this._ranges[s]=null}},n.prototype.getRange=function(s){return this._ranges[s]},n.prototype.getKeys=function(){return this._keys},n.prototype.getHighestFrame=function(){for(var s=0,o=0,l=this._keys.length;o<l;o++)s<this._keys[o].frame&&(s=this._keys[o].frame);return s},n.prototype.getEasingFunction=function(){return this._easingFunction},n.prototype.setEasingFunction=function(s){this._easingFunction=s},n.prototype.floatInterpolateFunction=function(s,o,l){return t.Scalar.Lerp(s,o,l)},n.prototype.floatInterpolateFunctionWithTangents=function(s,o,l,u,h){return t.Scalar.Hermite(s,o,l,u,h)},n.prototype.quaternionInterpolateFunction=function(s,o,l){return t.Quaternion.Slerp(s,o,l)},n.prototype.quaternionInterpolateFunctionWithTangents=function(s,o,l,u,h){return t.Quaternion.Hermite(s,o,l,u,h).normalize()},n.prototype.vector3InterpolateFunction=function(s,o,l){return t.Vector3.Lerp(s,o,l)},n.prototype.vector3InterpolateFunctionWithTangents=function(s,o,l,u,h){return t.Vector3.Hermite(s,o,l,u,h)},n.prototype.vector2InterpolateFunction=function(s,o,l){return t.Vector2.Lerp(s,o,l)},n.prototype.vector2InterpolateFunctionWithTangents=function(s,o,l,u,h){return t.Vector2.Hermite(s,o,l,u,h)},n.prototype.sizeInterpolateFunction=function(s,o,l){return t.Size.Lerp(s,o,l)},n.prototype.color3InterpolateFunction=function(s,o,l){return t.Color3.Lerp(s,o,l)},n.prototype._getKeyValue=function(s){return typeof s=="function"?s():s},n.prototype._interpolate=function(s,o,l,u,h,d){if(u===n.ANIMATIONLOOPMODE_CONSTANT&&o>0)return d.clone?d.clone():d;var p=this.getKeys(),m=Math.max(0,Math.min(p.length-1,Math.floor(p.length*(s-p[0].frame)/(p[p.length-1].frame-p[0].frame))-1));if(p[m].frame>=s)for(;m-1>=0&&p[m].frame>=s;)m--;for(var _=m;_<p.length;_++){var v=p[_+1];if(v.frame>=s){var S=p[_],P=this._getKeyValue(S.value);if(S.interpolation===i.STEP)return P;var x=this._getKeyValue(v.value),R=S.outTangent!==void 0&&v.inTangent!==void 0,w=v.frame-S.frame,I=(s-S.frame)/w,F=this.getEasingFunction();switch(F!=null&&(I=F.ease(I)),this.dataType){case n.ANIMATIONTYPE_FLOAT:var k=R?this.floatInterpolateFunctionWithTangents(P,S.outTangent*w,x,v.inTangent*w,I):this.floatInterpolateFunction(P,x,I);switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return k;case n.ANIMATIONLOOPMODE_RELATIVE:return h*o+k}break;case n.ANIMATIONTYPE_QUATERNION:var E=R?this.quaternionInterpolateFunctionWithTangents(P,S.outTangent.scale(w),x,v.inTangent.scale(w),I):this.quaternionInterpolateFunction(P,x,I);switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return E;case n.ANIMATIONLOOPMODE_RELATIVE:return E.addInPlace(h.scale(o))}return E;case n.ANIMATIONTYPE_VECTOR3:var g=R?this.vector3InterpolateFunctionWithTangents(P,S.outTangent.scale(w),x,v.inTangent.scale(w),I):this.vector3InterpolateFunction(P,x,I);switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return g;case n.ANIMATIONLOOPMODE_RELATIVE:return g.add(h.scale(o))}case n.ANIMATIONTYPE_VECTOR2:var y=R?this.vector2InterpolateFunctionWithTangents(P,S.outTangent.scale(w),x,v.inTangent.scale(w),I):this.vector2InterpolateFunction(P,x,I);switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return y;case n.ANIMATIONLOOPMODE_RELATIVE:return y.add(h.scale(o))}case n.ANIMATIONTYPE_SIZE:switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(P,x,I);case n.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(P,x,I).add(h.scale(o))}case n.ANIMATIONTYPE_COLOR3:switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(P,x,I);case n.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(P,x,I).add(h.scale(o))}case n.ANIMATIONTYPE_MATRIX:switch(u){case n.ANIMATIONLOOPMODE_CYCLE:case n.ANIMATIONLOOPMODE_CONSTANT:if(n.AllowMatricesInterpolation)return this.matrixInterpolateFunction(P,x,I,l);case n.ANIMATIONLOOPMODE_RELATIVE:return P}default:break}break}}return this._getKeyValue(p[p.length-1].value)},n.prototype.matrixInterpolateFunction=function(s,o,l,u){return n.AllowMatrixDecomposeForInterpolation?u?(t.Matrix.DecomposeLerpToRef(s,o,l,u),u):t.Matrix.DecomposeLerp(s,o,l):u?(t.Matrix.LerpToRef(s,o,l,u),u):t.Matrix.Lerp(s,o,l)},n.prototype.clone=function(){var s=new n(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(s.enableBlending=this.enableBlending,s.blendingSpeed=this.blendingSpeed,this._keys&&s.setKeys(this._keys),this._ranges){s._ranges={};for(var o in this._ranges){var l=this._ranges[o];l&&(s._ranges[o]=l.clone())}}return s},n.prototype.setKeys=function(s){this._keys=s.slice(0)},n.prototype.serialize=function(){var s={};s.name=this.name,s.property=this.targetProperty,s.framePerSecond=this.framePerSecond,s.dataType=this.dataType,s.loopBehavior=this.loopMode,s.enableBlending=this.enableBlending,s.blendingSpeed=this.blendingSpeed;var o=this.dataType;s.keys=[];for(var l=this.getKeys(),u=0;u<l.length;u++){var h=l[u],d={};switch(d.frame=h.frame,o){case n.ANIMATIONTYPE_FLOAT:d.values=[h.value];break;case n.ANIMATIONTYPE_QUATERNION:case n.ANIMATIONTYPE_MATRIX:case n.ANIMATIONTYPE_VECTOR3:case n.ANIMATIONTYPE_COLOR3:d.values=h.value.asArray();break}s.keys.push(d)}s.ranges=[];for(var p in this._ranges){var m=this._ranges[p];if(m){var _={};_.name=p,_.from=m.from,_.to=m.to,s.ranges.push(_)}}return s},Object.defineProperty(n,"ANIMATIONTYPE_FLOAT",{get:function(){return n._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_VECTOR3",{get:function(){return n._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_VECTOR2",{get:function(){return n._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_SIZE",{get:function(){return n._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_QUATERNION",{get:function(){return n._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_MATRIX",{get:function(){return n._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONTYPE_COLOR3",{get:function(){return n._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return n._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return n._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return n._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),n._UniversalLerp=function(s,o,l){var u=s.constructor;return u.Lerp?u.Lerp(s,o,l):u.Slerp?u.Slerp(s,o,l):s.toFixed?s*(1-l)+l*o:o},n.Parse=function(s){var o=new n(s.name,s.property,s.framePerSecond,s.dataType,s.loopBehavior),l=s.dataType,u=[],h,d;for(s.enableBlending&&(o.enableBlending=s.enableBlending),s.blendingSpeed&&(o.blendingSpeed=s.blendingSpeed),d=0;d<s.keys.length;d++){var p=s.keys[d],m,_;switch(l){case n.ANIMATIONTYPE_FLOAT:h=p.values[0],p.values.length>=1&&(m=p.values[1]),p.values.length>=2&&(_=p.values[2]);break;case n.ANIMATIONTYPE_QUATERNION:if(h=t.Quaternion.FromArray(p.values),p.values.length>=8){var v=t.Quaternion.FromArray(p.values.slice(4,8));v.equals(t.Quaternion.Zero())||(m=v)}if(p.values.length>=12){var S=t.Quaternion.FromArray(p.values.slice(8,12));S.equals(t.Quaternion.Zero())||(_=S)}break;case n.ANIMATIONTYPE_MATRIX:h=t.Matrix.FromArray(p.values);break;case n.ANIMATIONTYPE_COLOR3:h=t.Color3.FromArray(p.values);break;case n.ANIMATIONTYPE_VECTOR3:default:h=t.Vector3.FromArray(p.values);break}var P={};P.frame=p.frame,P.value=h,m!=null&&(P.inTangent=m),_!=null&&(P.outTangent=_),u.push(P)}if(o.setKeys(u),s.ranges)for(d=0;d<s.ranges.length;d++)h=s.ranges[d],o.createRange(h.name,h.from,h.to);return o},n.AppendSerializedAnimations=function(s,o){if(s.animations){o.animations=[];for(var l=0;l<s.animations.length;l++){var u=s.animations[l];o.animations.push(u.serialize())}}},n.AllowMatricesInterpolation=!1,n.AllowMatrixDecomposeForInterpolation=!0,n._ANIMATIONTYPE_FLOAT=0,n._ANIMATIONTYPE_VECTOR3=1,n._ANIMATIONTYPE_QUATERNION=2,n._ANIMATIONTYPE_MATRIX=3,n._ANIMATIONTYPE_COLOR3=4,n._ANIMATIONTYPE_VECTOR2=5,n._ANIMATIONTYPE_SIZE=6,n._ANIMATIONLOOPMODE_RELATIVE=0,n._ANIMATIONLOOPMODE_CYCLE=1,n._ANIMATIONLOOPMODE_CONSTANT=2,n}();t.Animation=a})(T||(T={}));var T;(function(t){var f=function(){function r(){}return r}();t.TargetedAnimation=f;var c=function(){function r(i,a){a===void 0&&(a=null),this.name=i,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this.onAnimationEndObservable=new t.Observable,this.onAnimationGroupEndObservable=new t.Observable,this.onAnimationGroupPauseObservable=new t.Observable,this._scene=a||t.Engine.LastCreatedScene,this._scene.animationGroups.push(this)}return Object.defineProperty(r.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(i){if(this._speedRatio!==i){this._speedRatio=i;for(var a=0;a<this._animatables.length;a++){var n=this._animatables[a];n.speedRatio=this._speedRatio}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),r.prototype.addTargetedAnimation=function(i,a){var n={animation:i,target:a},s=i.getKeys();return this._from>s[0].frame&&(this._from=s[0].frame),this._to<s[s.length-1].frame&&(this._to=s[s.length-1].frame),this._targetedAnimations.push(n),n},r.prototype.normalize=function(i,a){i===void 0&&(i=null),a===void 0&&(a=null),i==null&&(i=this._from),a==null&&(a=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var s=this._targetedAnimations[n],o=s.animation.getKeys(),l=o[0],u=o[o.length-1];if(l.frame>i){var h={frame:i,value:l.value,inTangent:l.inTangent,outTangent:l.outTangent,interpolation:l.interpolation};o.splice(0,0,h)}if(u.frame<a){var h={frame:a,value:u.value,inTangent:u.outTangent,outTangent:u.outTangent,interpolation:u.interpolation};o.push(h)}}return this._from=i,this._to=a,this},r.prototype.start=function(i,a,n,s){var o=this;if(i===void 0&&(i=!1),a===void 0&&(a=1),this._isStarted||this._targetedAnimations.length===0)return this;for(var l=function(m){var _=u._scene.beginDirectAnimation(m.target,[m.animation],n!==void 0?n:u._from,s!==void 0?s:u._to,i,a);_.onAnimationEnd=function(){o.onAnimationEndObservable.notifyObservers(m),o._checkAnimationGroupEnded(_)},u._animatables.push(_)},u=this,h=0,d=this._targetedAnimations;h<d.length;h++){var p=d[h];l(p)}return this._speedRatio=a,this._isStarted=!0,this},r.prototype.pause=function(){if(!this._isStarted)return this;for(var i=0;i<this._animatables.length;i++){var a=this._animatables[i];a.pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},r.prototype.play=function(i){if(this.isStarted&&this._animatables.length===this._targetedAnimations.length){if(i!==void 0)for(var a=0;a<this._animatables.length;a++){var n=this._animatables[a];n.loopAnimation=i}this.restart()}else this.stop(),this.start(i,this._speedRatio);return this},r.prototype.reset=function(){if(!this._isStarted)return this;for(var i=0;i<this._animatables.length;i++){var a=this._animatables[i];a.reset()}return this},r.prototype.restart=function(){if(!this._isStarted)return this;for(var i=0;i<this._animatables.length;i++){var a=this._animatables[i];a.restart()}return this},r.prototype.stop=function(){if(!this._isStarted)return this;for(var i=this._animatables.slice(),a=0;a<i.length;a++)i[a].stop();return this._isStarted=!1,this},r.prototype.setWeightForAllAnimatables=function(i){for(var a=0;a<this._animatables.length;a++){var n=this._animatables[a];n.weight=i}return this},r.prototype.syncAllAnimationsWith=function(i){for(var a=0;a<this._animatables.length;a++){var n=this._animatables[a];n.syncWith(i)}return this},r.prototype.goToFrame=function(i){if(!this._isStarted)return this;for(var a=0;a<this._animatables.length;a++){var n=this._animatables[a];n.goToFrame(i)}return this},r.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var i=this._scene.animationGroups.indexOf(this);i>-1&&this._scene.animationGroups.splice(i,1)},r.prototype._checkAnimationGroupEnded=function(i){var a=this._animatables.indexOf(i);a>-1&&this._animatables.splice(a,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},r.Parse=function(i,a){for(var n=new t.AnimationGroup(i.name,a),s=0;s<i.targetedAnimations.length;s++){var o=i.targetedAnimations[s],l=t.Animation.Parse(o.animation),u=o.targetId,h=a.getNodeByID(u);h!=null&&n.addTargetedAnimation(l,h)}return i.from!==null&&i.from!==null&&n.normalize(i.from,i.to),n},r.prototype.getClassName=function(){return"AnimationGroup"},r.prototype.toString=function(i){var a="Name: "+this.name;return a+=", type: "+this.getClassName(),i&&(a+=", from: "+this._from,a+=", to: "+this._to,a+=", isStarted: "+this._isStarted,a+=", speedRatio: "+this._speedRatio,a+=", targetedAnimations length: "+this._targetedAnimations.length,a+=", animatables length: "+this._animatables),a},r}();t.AnimationGroup=c})(T||(T={}));var T;(function(t){var f=Object.freeze(new t.Quaternion(0,0,0,0)),c=Object.freeze(t.Vector3.Zero()),r=Object.freeze(t.Vector2.Zero()),i=Object.freeze(t.Size.Zero()),a=Object.freeze(t.Color3.Black()),n=function(){function s(o,l,u,h){var d=this;this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._animation=l,this._target=o,this._scene=u,this._host=h,l._runtimeAnimations.push(this);var p=l.getEvents();p&&p.length>0&&p.forEach(function(m){d._events.push(m._clone())})}return Object.defineProperty(s.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"target",{get:function(){return this._activeTarget},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),s.prototype.reset=function(o){if(o===void 0&&(o=!1),o)if(this._target instanceof Array)for(var l=0,u=0,h=this._target;u<h.length;u++){var d=h[u];this._originalValue[l]!==void 0&&this._setValue(d,this._originalValue[l],-1),l++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._originalValue[0],-1);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,this._originalValue=new Array;for(var l=0;l<this._events.length;l++)this._events[l].isDone=!1},s.prototype.isStopped=function(){return this._stopped},s.prototype.dispose=function(){var o=this._animation.runtimeAnimations.indexOf(this);o>-1&&this._animation.runtimeAnimations.splice(o,1)},s.prototype._interpolate=function(o,l,u,h,d){return this._currentFrame=o,this._animation.dataType===t.Animation.ANIMATIONTYPE_MATRIX&&!this._workValue&&(this._workValue=t.Matrix.Zero()),this._animation._interpolate(o,l,this._workValue,u,h,d)},s.prototype.setValue=function(o,l){if(l===void 0&&(l=1),this._target instanceof Array)for(var u=0,h=0,d=this._target;h<d.length;h++){var p=d[h];this._setValue(p,o,l,u),u++}else this._setValue(this._target,o,l)},s.prototype._setValue=function(o,l,u,h){h===void 0&&(h=0);var d,p,m=this._animation.targetPropertyPath;if(m.length>1){for(var _=o[m[0]],v=1;v<m.length-1;v++)_=_[m[v]];d=m[m.length-1],p=_}else d=m[0],p=o;if(this._targetPath=d,this._activeTarget=p,this._weight=u,this._originalValue[h]===void 0){var S=void 0;p.getRestPose&&d==="_matrix"?S=p.getRestPose():S=p[d],S&&S.clone?this._originalValue[h]=S.clone():this._originalValue[h]=S}var P=o&&o.animationPropertiesOverride?o.animationPropertiesOverride.enableBlending:this._animation.enableBlending;if(P&&this._blendingFactor<=1){if(!this._originalBlendValue){var S=p[d];S.clone?this._originalBlendValue=S.clone():this._originalBlendValue=S}this._originalBlendValue.m?t.Animation.AllowMatrixDecomposeForInterpolation?this._currentValue?t.Matrix.DecomposeLerpToRef(this._originalBlendValue,l,this._blendingFactor,this._currentValue):this._currentValue=t.Matrix.DecomposeLerp(this._originalBlendValue,l,this._blendingFactor):this._currentValue?t.Matrix.LerpToRef(this._originalBlendValue,l,this._blendingFactor,this._currentValue):this._currentValue=t.Matrix.Lerp(this._originalBlendValue,l,this._blendingFactor):this._currentValue=t.Animation._UniversalLerp(this._originalBlendValue,l,this._blendingFactor);var x=o&&o.animationPropertiesOverride?o.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=x}else this._currentValue=l;u!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[h]):p[d]=this._currentValue,o.markAsDirty&&o.markAsDirty(this._animation.targetProperty)},s.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},s.prototype.goToFrame=function(o){var l=this._animation.getKeys();o<l[0].frame?o=l[0].frame:o>l[l.length-1].frame&&(o=l[l.length-1].frame);var u=this._interpolate(o,0,this._getCorrectLoopMode());this.setValue(u,-1)},s.prototype._prepareForSpeedRatioChange=function(o){var l=this._previousDelay*(this._animation.framePerSecond*o)/1e3;this._ratioOffset=this._previousRatio-l},s.prototype.animate=function(o,l,u,h,d,p){p===void 0&&(p=-1);var m=this._animation.targetPropertyPath;if(!m||m.length<1)return this._stopped=!0,!1;var _=!0,v=this._animation.getKeys();if(v[0].frame!==0){var S={frame:0,value:v[0].value};v.splice(0,0,S)}else if(v.length===1){var S={frame:.001,value:v[0].value};v.push(S)}(l<v[0].frame||l>v[v.length-1].frame)&&(l=v[0].frame),(u<v[0].frame||u>v[v.length-1].frame)&&(u=v[v.length-1].frame),l===u&&(l>v[0].frame?l--:u<v[v.length-1].frame&&u++);var P=u-l,x,R=o*(this._animation.framePerSecond*d)/1e3+this._ratioOffset,w=0;if(this._previousDelay=o,this._previousRatio=R,(u>l&&R>=P||l>u&&R<=P)&&!h)_=!1,w=this._animation._getKeyValue(v[v.length-1].value);else if(this._getCorrectLoopMode()!==t.Animation.ANIMATIONLOOPMODE_CYCLE){var I=u.toString()+l.toString();if(!this._offsetsCache[I]){var F=this._interpolate(l,0,t.Animation.ANIMATIONLOOPMODE_CYCLE),k=this._interpolate(u,0,t.Animation.ANIMATIONLOOPMODE_CYCLE);switch(this._animation.dataType){case t.Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[I]=k-F;break;case t.Animation.ANIMATIONTYPE_QUATERNION:this._offsetsCache[I]=k.subtract(F);break;case t.Animation.ANIMATIONTYPE_VECTOR3:this._offsetsCache[I]=k.subtract(F);case t.Animation.ANIMATIONTYPE_VECTOR2:this._offsetsCache[I]=k.subtract(F);case t.Animation.ANIMATIONTYPE_SIZE:this._offsetsCache[I]=k.subtract(F);case t.Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[I]=k.subtract(F);default:break}this._highLimitsCache[I]=k}w=this._highLimitsCache[I],x=this._offsetsCache[I]}if(x===void 0)switch(this._animation.dataType){case t.Animation.ANIMATIONTYPE_FLOAT:x=0;break;case t.Animation.ANIMATIONTYPE_QUATERNION:x=f;break;case t.Animation.ANIMATIONTYPE_VECTOR3:x=c;break;case t.Animation.ANIMATIONTYPE_VECTOR2:x=r;break;case t.Animation.ANIMATIONTYPE_SIZE:x=i;break;case t.Animation.ANIMATIONTYPE_COLOR3:x=a}var E=R/P>>0,g=_?l+R%P:u;if(this._host&&this._host.syncRoot){var y=this._host.syncRoot,M=(y.masterFrame-y.fromFrame)/(y.toFrame-y.fromFrame);g=l+(u-l)*M}var C=this._events;if(P>0&&this.currentFrame>g||P<0&&this.currentFrame<g)for(var D=0;D<C.length;D++)C[D].onlyOnce||(C[D].isDone=!1);var V=this._interpolate(g,E,this._getCorrectLoopMode(),x,w);this.setValue(V,p);for(var D=0;D<C.length;D++)if(P>0&&g>=C[D].frame&&C[D].frame>=l||P<0&&g<=C[D].frame&&C[D].frame<=l){var G=C[D];G.isDone||(G.onlyOnce&&(C.splice(D,1),D--),G.isDone=!0,G.action(g))}return _||(this._stopped=!0),_},s}();t.RuntimeAnimation=n})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l,u){a===void 0&&(a=0),n===void 0&&(n=100),s===void 0&&(s=!1),o===void 0&&(o=1),this.target=i,this.fromFrame=a,this.toFrame=n,this.loopAnimation=s,this.onAnimationEnd=l,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new t.Observable,this._scene=r,u&&this.appendAnimations(i,u),this._speedRatio=o,r._activeAnimatables.push(this)}return Object.defineProperty(c.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"weight",{get:function(){return this._weight},set:function(r){if(r===-1){this._weight=-1;return}this._weight=Math.min(Math.max(r,0),1)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(r){for(var i=0;i<this._runtimeAnimations.length;i++){var a=this._runtimeAnimations[i];a._prepareForSpeedRatioChange(r)}this._speedRatio=r},enumerable:!0,configurable:!0}),c.prototype.syncWith=function(r){if(this._syncRoot=r,r){var i=this._scene._activeAnimatables.indexOf(this);i>-1&&(this._scene._activeAnimatables.splice(i,1),this._scene._activeAnimatables.push(this))}return this},c.prototype.getAnimations=function(){return this._runtimeAnimations},c.prototype.appendAnimations=function(r,i){for(var a=0;a<i.length;a++){var n=i[a];this._runtimeAnimations.push(new t.RuntimeAnimation(r,n,this._scene,this))}},c.prototype.getAnimationByTargetProperty=function(r){for(var i=this._runtimeAnimations,a=0;a<i.length;a++)if(i[a].animation.targetProperty===r)return i[a].animation;return null},c.prototype.getRuntimeAnimationByTargetProperty=function(r){for(var i=this._runtimeAnimations,a=0;a<i.length;a++)if(i[a].animation.targetProperty===r)return i[a];return null},c.prototype.reset=function(){for(var r=this._runtimeAnimations,i=0;i<r.length;i++)r[i].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},c.prototype.enableBlending=function(r){for(var i=this._runtimeAnimations,a=0;a<i.length;a++)i[a].animation.enableBlending=!0,i[a].animation.blendingSpeed=r},c.prototype.disableBlending=function(){for(var r=this._runtimeAnimations,i=0;i<r.length;i++)r[i].animation.enableBlending=!1},c.prototype.goToFrame=function(r){var i=this._runtimeAnimations;if(i[0]){var a=i[0].animation.framePerSecond,n=i[0].currentFrame,s=r-n,o=s*1e3/(a*this.speedRatio);this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=o}for(var l=0;l<i.length;l++)i[l].goToFrame(r)},c.prototype.pause=function(){this._paused||(this._paused=!0)},c.prototype.restart=function(){this._paused=!1},c.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},c.prototype.stop=function(r,i){if(r||i){var a=this._scene._activeAnimatables.indexOf(this);if(a>-1){for(var n=this._runtimeAnimations,s=n.length-1;s>=0;s--){var o=n[s];r&&o.animation.name!=r||i&&!i(o.target)||(o.dispose(),n.splice(s,1))}n.length==0&&(this._scene._activeAnimatables.splice(a,1),this._raiseOnAnimationEnd())}}else{var s=this._scene._activeAnimatables.indexOf(this);if(s>-1){this._scene._activeAnimatables.splice(s,1);for(var n=this._runtimeAnimations,s=0;s<n.length;s++)n[s].dispose();this._raiseOnAnimationEnd()}}},c.prototype.waitAsync=function(){var r=this;return new Promise(function(i,a){r.onAnimationEndObservable.add(function(){i(r)},void 0,void 0,r,!0)})},c.prototype._animate=function(r){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=r),!0;if(this._localDelayOffset===null?(this._localDelayOffset=r,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=r-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var i=!1,a=this._runtimeAnimations,n;for(n=0;n<a.length;n++){var s=a[n],o=s.animate(r-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);i=i||o}if(this.animationStarted=i,!i){if(this.disposeOnEnd)for(n=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(n,1),n=0;n<a.length;n++)a[n].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationEndObservable.clear())}return i},c}();t.Animatable=f})(T||(T={}));var T;(function(t){var f=function(){function m(){this._easingMode=m.EASINGMODE_EASEIN}return m.prototype.setEasingMode=function(_){var v=Math.min(Math.max(_,0),2);this._easingMode=v},m.prototype.getEasingMode=function(){return this._easingMode},m.prototype.easeInCore=function(_){throw new Error("You must implement this method")},m.prototype.ease=function(_){switch(this._easingMode){case m.EASINGMODE_EASEIN:return this.easeInCore(_);case m.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-_)}return _>=.5?(1-this.easeInCore((1-_)*2))*.5+.5:this.easeInCore(_*2)*.5},m.EASINGMODE_EASEIN=0,m.EASINGMODE_EASEOUT=1,m.EASINGMODE_EASEINOUT=2,m}();t.EasingFunction=f;var c=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return v=Math.max(0,Math.min(1,v)),1-Math.sqrt(1-v*v)},_}(f);t.CircleEase=c;var r=function(m){N(_,m);function _(v){v===void 0&&(v=1);var S=m.call(this)||this;return S.amplitude=v,S}return _.prototype.easeInCore=function(v){var S=Math.max(0,this.amplitude);return Math.pow(v,3)-v*S*Math.sin(3.141592653589793*v)},_}(f);t.BackEase=r;var i=function(m){N(_,m);function _(v,S){v===void 0&&(v=3),S===void 0&&(S=2);var P=m.call(this)||this;return P.bounces=v,P.bounciness=S,P}return _.prototype.easeInCore=function(v){var S=Math.max(0,this.bounces),P=this.bounciness;P<=1&&(P=1.001);var x=Math.pow(P,S),R=1-P,w=(1-x)/R+x*.5,I=v*w,F=Math.log(-I*(1-P)+1)/Math.log(P),k=Math.floor(F),E=k+1,g=(1-Math.pow(P,k))/(R*w),y=(1-Math.pow(P,E))/(R*w),M=(g+y)*.5,C=v-M,D=M-g;return-Math.pow(1/P,S-k)/(D*D)*(C-D)*(C+D)},_}(f);t.BounceEase=i;var a=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return v*v*v},_}(f);t.CubicEase=a;var n=function(m){N(_,m);function _(v,S){v===void 0&&(v=3),S===void 0&&(S=3);var P=m.call(this)||this;return P.oscillations=v,P.springiness=S,P}return _.prototype.easeInCore=function(v){var S,P=Math.max(0,this.oscillations),x=Math.max(0,this.springiness);return x==0?S=v:S=(Math.exp(x*v)-1)/(Math.exp(x)-1),S*Math.sin((6.283185307179586*P+1.5707963267948966)*v)},_}(f);t.ElasticEase=n;var s=function(m){N(_,m);function _(v){v===void 0&&(v=2);var S=m.call(this)||this;return S.exponent=v,S}return _.prototype.easeInCore=function(v){return this.exponent<=0?v:(Math.exp(this.exponent*v)-1)/(Math.exp(this.exponent)-1)},_}(f);t.ExponentialEase=s;var o=function(m){N(_,m);function _(v){v===void 0&&(v=2);var S=m.call(this)||this;return S.power=v,S}return _.prototype.easeInCore=function(v){var S=Math.max(0,this.power);return Math.pow(v,S)},_}(f);t.PowerEase=o;var l=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return v*v},_}(f);t.QuadraticEase=l;var u=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return v*v*v*v},_}(f);t.QuarticEase=u;var h=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return v*v*v*v*v},_}(f);t.QuinticEase=h;var d=function(m){N(_,m);function _(){return m!==null&&m.apply(this,arguments)||this}return _.prototype.easeInCore=function(v){return 1-Math.sin(1.5707963267948966*(1-v))},_}(f);t.SineEase=d;var p=function(m){N(_,m);function _(v,S,P,x){v===void 0&&(v=0),S===void 0&&(S=0),P===void 0&&(P=1),x===void 0&&(x=1);var R=m.call(this)||this;return R.x1=v,R.y1=S,R.x2=P,R.y2=x,R}return _.prototype.easeInCore=function(v){return t.BezierCurve.Interpolate(v,this.x1,this.y1,this.x2,this.y2)},_}(f);t.BezierCurveEase=p})(T||(T={}));var T;(function(t){var f=function(){function a(n){this._actionManager=n}return a.prototype.isValid=function(){return!0},a.prototype._getProperty=function(n){return this._actionManager._getProperty(n)},a.prototype._getEffectiveTarget=function(n,s){return this._actionManager._getEffectiveTarget(n,s)},a.prototype.serialize=function(){},a.prototype._serialize=function(n){return{type:2,children:[],name:n.name,properties:n.properties}},a}();t.Condition=f;var c=function(a){N(n,a);function n(s,o,l,u,h){h===void 0&&(h=n.IsEqual);var d=a.call(this,s)||this;return d.propertyPath=l,d.value=u,d.operator=h,d._target=o,d._effectiveTarget=d._getEffectiveTarget(o,d.propertyPath),d._property=d._getProperty(d.propertyPath),d}return Object.defineProperty(n,"IsEqual",{get:function(){return n._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(n,"IsDifferent",{get:function(){return n._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(n,"IsGreater",{get:function(){return n._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(n,"IsLesser",{get:function(){return n._IsLesser},enumerable:!0,configurable:!0}),n.prototype.isValid=function(){switch(this.operator){case n.IsGreater:return this._effectiveTarget[this._property]>this.value;case n.IsLesser:return this._effectiveTarget[this._property]<this.value;case n.IsEqual:case n.IsDifferent:var s;return this.value.equals?s=this.value.equals(this._effectiveTarget[this._property]):s=this.value===this._effectiveTarget[this._property],this.operator===n.IsEqual?s:!s}return!1},n.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:t.Action._SerializeValueAsString(this.value)},{name:"operator",value:n.GetOperatorName(this.operator)}]})},n.GetOperatorName=function(s){switch(s){case n._IsEqual:return"IsEqual";case n._IsDifferent:return"IsDifferent";case n._IsGreater:return"IsGreater";case n._IsLesser:return"IsLesser";default:return""}},n._IsEqual=0,n._IsDifferent=1,n._IsGreater=2,n._IsLesser=3,n}(f);t.ValueCondition=c;var r=function(a){N(n,a);function n(s,o){var l=a.call(this,s)||this;return l.predicate=o,l}return n.prototype.isValid=function(){return this.predicate()},n}(f);t.PredicateCondition=r;var i=function(a){N(n,a);function n(s,o,l){var u=a.call(this,s)||this;return u.value=l,u._target=o,u}return n.prototype.isValid=function(){return this._target.state===this.value},n.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[t.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},n}(f);t.StateCondition=i})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.triggerOptions=r,this.onBeforeExecuteObservable=new t.Observable,r.parameter?(this.trigger=r.trigger,this._triggerParameter=r.parameter):r.trigger?this.trigger=r.trigger:this.trigger=r,this._nextActiveAction=this,this._condition=i}return c.prototype._prepare=function(){},c.prototype.getTriggerParameter=function(){return this._triggerParameter},c.prototype._executeCurrent=function(r){if(this._nextActiveAction._condition){var i=this._nextActiveAction._condition,a=this._actionManager.getScene().getRenderId();if(i._evaluationId===a){if(!i._currentResult)return}else{if(i._evaluationId=a,!i.isValid()){i._currentResult=!1;return}i._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(r),this.skipToNextActiveAction()},c.prototype.execute=function(r){},c.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},c.prototype.then=function(r){return this._child=r,r._actionManager=this._actionManager,r._prepare(),r},c.prototype._getProperty=function(r){return this._actionManager._getProperty(r)},c.prototype._getEffectiveTarget=function(r,i){return this._actionManager._getEffectiveTarget(r,i)},c.prototype.serialize=function(r){},c.prototype._serialize=function(r,i){var a={type:1,children:[],name:r.name,properties:r.properties||[]};if(this._child&&this._child.serialize(a),this._condition){var n=this._condition.serialize();return n.children.push(a),i&&i.children.push(n),n}return i&&i.children.push(a),a},c._SerializeValueAsString=function(r){return typeof r=="number"?r.toString():typeof r=="boolean"?r?"true":"false":r instanceof t.Vector2?r.x+", "+r.y:r instanceof t.Vector3?r.x+", "+r.y+", "+r.z:r instanceof t.Color3?r.r+", "+r.g+", "+r.b:r instanceof t.Color4?r.r+", "+r.g+", "+r.b+", "+r.a:r},c._GetTargetProperty=function(r){return{name:"target",targetType:r instanceof t.Mesh?"MeshProperties":r instanceof t.Light?"LightProperties":r instanceof t.Camera?"CameraProperties":"SceneProperties",value:r instanceof t.Scene?"Scene":r.name}},c}();t.Action=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n,s,o,l){this.source=i,this.pointerX=a,this.pointerY=n,this.meshUnderPointer=s,this.sourceEvent=o,this.additionalData=l}return r.CreateNew=function(i,a,n){var s=i.getScene();return new r(i,s.pointerX,s.pointerY,s.meshUnderPointer,a,n)},r.CreateNewFromSprite=function(i,a,n,s){return new r(i,a.pointerX,a.pointerY,a.meshUnderPointer,n,s)},r.CreateNewFromScene=function(i,a){return new r(null,i.pointerX,i.pointerY,i.meshUnderPointer,a)},r.CreateNewFromPrimitive=function(i,a,n,s){return new r(i,a.x,a.y,null,n,s)},r}();t.ActionEvent=f;var c=function(){function r(i){this.actions=new Array,this.hoverCursor="",this._scene=i||t.Engine.LastCreatedScene,i.actionManagers.push(this)}return r.prototype.dispose=function(){for(var i=this._scene.actionManagers.indexOf(this),a=0;a<this.actions.length;a++){var n=this.actions[a];r.Triggers[n.trigger]--,r.Triggers[n.trigger]===0&&delete r.Triggers[n.trigger]}i>-1&&this._scene.actionManagers.splice(i,1)},r.prototype.getScene=function(){return this._scene},r.prototype.hasSpecificTriggers=function(i){for(var a=0;a<this.actions.length;a++){var n=this.actions[a];if(i.indexOf(n.trigger)>-1)return!0}return!1},r.prototype.hasSpecificTriggers2=function(i,a){for(var n=0;n<this.actions.length;n++){var s=this.actions[n];if(i==s.trigger||a==s.trigger)return!0}return!1},r.prototype.hasSpecificTrigger=function(i,a){for(var n=0;n<this.actions.length;n++){var s=this.actions[n];if(s.trigger===i)if(a){if(a(s.getTriggerParameter()))return!0}else return!0}return!1},Object.defineProperty(r.prototype,"hasPointerTriggers",{get:function(){for(var i=0;i<this.actions.length;i++){var a=this.actions[i];if(a.trigger>=r.OnPickTrigger&&a.trigger<=r.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasPickTriggers",{get:function(){for(var i=0;i<this.actions.length;i++){var a=this.actions[i];if(a.trigger>=r.OnPickTrigger&&a.trigger<=r.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r,"HasTriggers",{get:function(){for(var i in r.Triggers)if(r.Triggers.hasOwnProperty(i))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r,"HasPickTriggers",{get:function(){for(var i in r.Triggers)if(r.Triggers.hasOwnProperty(i)){var a=parseInt(i);if(a>=r.OnPickTrigger&&a<=r.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),r.HasSpecificTrigger=function(i){for(var a in r.Triggers)if(r.Triggers.hasOwnProperty(a)){var n=parseInt(a);if(n===i)return!0}return!1},r.prototype.registerAction=function(i){return i.trigger===r.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(t.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),r.Triggers[i.trigger]?r.Triggers[i.trigger]++:r.Triggers[i.trigger]=1,i._actionManager=this,i._prepare(),i)},r.prototype.unregisterAction=function(i){var a=this.actions.indexOf(i);return a!==-1?(this.actions.splice(a,1),r.Triggers[i.trigger]-=1,r.Triggers[i.trigger]===0&&delete r.Triggers[i.trigger],delete i._actionManager,!0):!1},r.prototype.processTrigger=function(i,a){for(var n=0;n<this.actions.length;n++){var s=this.actions[n];if(s.trigger===i){if(a&&(i===r.OnKeyUpTrigger||i===r.OnKeyDownTrigger)){var o=s.getTriggerParameter();if(o&&o!==a.sourceEvent.keyCode){if(!o.toLowerCase)continue;var l=o.toLowerCase();if(l!==a.sourceEvent.key){var u=a.sourceEvent.charCode?a.sourceEvent.charCode:a.sourceEvent.keyCode,h=String.fromCharCode(u).toLowerCase();if(h!==l)continue}}}s._executeCurrent(a)}}},r.prototype._getEffectiveTarget=function(i,a){for(var n=a.split("."),s=0;s<n.length-1;s++)i=i[n[s]];return i},r.prototype._getProperty=function(i){var a=i.split(".");return a[a.length-1]},r.prototype.serialize=function(i){for(var a={children:new Array,name:i,type:3,properties:new Array},n=0;n<this.actions.length;n++){var s={type:0,children:new Array,name:r.GetTriggerName(this.actions[n].trigger),properties:new Array},o=this.actions[n].triggerOptions;if(o&&typeof o!="number")if(o.parameter instanceof t.Node)s.properties.push(t.Action._GetTargetProperty(o.parameter));else{var l={};t.Tools.DeepCopy(o.parameter,l,["mesh"]),o.parameter&&o.parameter.mesh&&(l._meshId=o.parameter.mesh.id),s.properties.push({name:"parameter",targetType:null,value:l})}this.actions[n].serialize(s),a.children.push(s)}return a},r.Parse=function(i,a,n){var s=new r(n);a===null?n.actionManager=s:a.actionManager=s;for(var o=function(S,P){var x=Object.create(t.Tools.Instantiate("BABYLON."+S).prototype);return x.constructor.apply(x,P),x},l=function(S,P,x,R){if(R===null){var w=parseFloat(P);return P==="true"||P==="false"?P==="true":isNaN(w)?P:w}for(var I=R.split("."),F=P.split(","),k=0;k<I.length;k++)x=x[I[k]];if(typeof x=="boolean")return F[0]==="true";if(typeof x=="string")return F[0];for(var E=new Array,k=0;k<F.length;k++)E.push(parseFloat(F[k]));return x instanceof t.Vector3?t.Vector3.FromArray(E):x instanceof t.Vector4?t.Vector4.FromArray(E):x instanceof t.Color3?t.Color3.FromArray(E):x instanceof t.Color4?t.Color4.FromArray(E):parseFloat(F[0])},u=function(S,P,x,R,w){if(w===void 0&&(w=null),!S.detached){var I=new Array,F=null,k=null,E=S.combine&&S.combine.length>0;if(S.type===2?I.push(s):I.push(P),E){for(var g=new Array,y=0;y<S.combine.length;y++)u(S.combine[y],r.NothingTrigger,x,R,g);I.push(g)}else for(var M=0;M<S.properties.length;M++){var C=S.properties[M].value,D=S.properties[M].name,V=S.properties[M].targetType;D==="target"?V!==null&&V==="SceneProperties"?C=F=n:C=F=n.getNodeByName(C):D==="parent"?C=n.getNodeByName(C):D==="sound"?n.getSoundByName&&(C=n.getSoundByName(C)):D!=="propertyPath"?S.type===2&&D==="operator"?C=t.ValueCondition[C]:C=l(D,C,F,D==="value"?k:null):k=C,I.push(C)}if(w===null?I.push(x):I.push(null),S.name==="InterpolateValueAction"){var G=I[I.length-2];I[I.length-1]=G,I[I.length-2]=x}var U=o(S.name,I);if(U instanceof t.Condition&&x!==null){var z=new t.DoNothingAction(P,x);R?R.then(z):s.registerAction(z),R=z}w===null?U instanceof t.Condition?(x=U,U=R):(x=null,R?R.then(U):s.registerAction(U)):w.push(U);for(var M=0;M<S.children.length;M++)u(S.children[M],P,x,U,null)}},h=0;h<i.children.length;h++){var d,p=i.children[h];if(p.properties.length>0){var m=p.properties[0].value,_=p.properties[0].targetType===null?m:n.getMeshByName(m);_._meshId&&(_.mesh=n.getMeshByID(_._meshId)),d={trigger:r[p.name],parameter:_}}else d=r[p.name];for(var v=0;v<p.children.length;v++)p.detached||u(p.children[v],d,null,null)}},r.GetTriggerName=function(i){switch(i){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},r.NothingTrigger=0,r.OnPickTrigger=1,r.OnLeftPickTrigger=2,r.OnRightPickTrigger=3,r.OnCenterPickTrigger=4,r.OnPickDownTrigger=5,r.OnDoublePickTrigger=6,r.OnPickUpTrigger=7,r.OnPickOutTrigger=16,r.OnLongPressTrigger=8,r.OnPointerOverTrigger=9,r.OnPointerOutTrigger=10,r.OnEveryFrameTrigger=11,r.OnIntersectionEnterTrigger=12,r.OnIntersectionExitTrigger=13,r.OnKeyDownTrigger=14,r.OnKeyUpTrigger=15,r.Triggers={},r}();t.ActionManager=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){o===void 0&&(o=1e3);var d=c.call(this,i,l)||this;return d.duration=1e3,d.onInterpolationDoneObservable=new t.Observable,d.propertyPath=n,d.value=s,d.duration=o,d.stopOtherAnimations=u,d.onInterpolationDone=h,d._target=d._effectiveTarget=a,d}return r.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},r.prototype.execute=function(){var i=this,a=this._actionManager.getScene(),n=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}],s;if(typeof this.value=="number")s=t.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof t.Color3)s=t.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof t.Vector3)s=t.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof t.Matrix)s=t.Animation.ANIMATIONTYPE_MATRIX;else if(this.value instanceof t.Quaternion)s=t.Animation.ANIMATIONTYPE_QUATERNION;else{t.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");return}var o=new t.Animation("InterpolateValueAction",this._property,100*(1e3/this.duration),s,t.Animation.ANIMATIONLOOPMODE_CONSTANT);o.setKeys(n),this.stopOtherAnimations&&a.stopAnimation(this._effectiveTarget);var l=function(){i.onInterpolationDoneObservable.notifyObservers(i),i.onInterpolationDone&&i.onInterpolationDone()};a.beginDirectAnimation(this._effectiveTarget,[o],0,100,!1,1,l)},r.prototype.serialize=function(i){return c.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:t.Action._SerializeValueAsString(this.value)},{name:"duration",value:t.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:t.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},i)},r}(t.Action);t.InterpolateValueAction=f})(T||(T={}));var T;(function(t){var f=function(h){N(d,h);function d(p,m,_,v){var S=h.call(this,p,v)||this;return S.propertyPath=_,S._target=S._effectiveTarget=m,S}return d.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},d.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},p)},d}(t.Action);t.SwitchBooleanAction=f;var c=function(h){N(d,h);function d(p,m,_,v){var S=h.call(this,p,v)||this;return S.value=_,S._target=m,S}return d.prototype.execute=function(){this._target.state=this.value},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"SetStateAction",properties:[t.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},p)},d}(t.Action);t.SetStateAction=c;var r=function(h){N(d,h);function d(p,m,_,v,S){var P=h.call(this,p,S)||this;return P.propertyPath=_,P.value=v,P._target=P._effectiveTarget=m,P}return d.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},d.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"SetValueAction",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:t.Action._SerializeValueAsString(this.value)}]},p)},d}(t.Action);t.SetValueAction=r;var i=function(h){N(d,h);function d(p,m,_,v,S){var P=h.call(this,p,S)||this;return P.propertyPath=_,P.value=v,P._target=P._effectiveTarget=m,P}return d.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&t.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},d.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[t.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:t.Action._SerializeValueAsString(this.value)}]},p)},d}(t.Action);t.IncrementValueAction=i;var a=function(h){N(d,h);function d(p,m,_,v,S,P){var x=h.call(this,p,P)||this;return x.from=_,x.to=v,x.loop=S,x._target=m,x}return d.prototype._prepare=function(){},d.prototype.execute=function(){var p=this._actionManager.getScene();p.beginAnimation(this._target,this.from,this.to,this.loop)},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[t.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:t.Action._SerializeValueAsString(this.loop)||!1}]},p)},d}(t.Action);t.PlayAnimationAction=a;var n=function(h){N(d,h);function d(p,m,_){var v=h.call(this,p,_)||this;return v._target=m,v}return d.prototype._prepare=function(){},d.prototype.execute=function(){var p=this._actionManager.getScene();p.stopAnimation(this._target)},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[t.Action._GetTargetProperty(this._target)]},p)},d}(t.Action);t.StopAnimationAction=n;var s=function(h){N(d,h);function d(p,m){return p===void 0&&(p=t.ActionManager.NothingTrigger),h.call(this,p,m)||this}return d.prototype.execute=function(){},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},p)},d}(t.Action);t.DoNothingAction=s;var o=function(h){N(d,h);function d(p,m,_){var v=h.call(this,p,_)||this;return v.children=m,v}return d.prototype._prepare=function(){for(var p=0;p<this.children.length;p++)this.children[p]._actionManager=this._actionManager,this.children[p]._prepare()},d.prototype.execute=function(p){for(var m=0;m<this.children.length;m++)this.children[m].execute(p)},d.prototype.serialize=function(p){for(var m=h.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},p),_=0;_<this.children.length;_++)m.combine.push(this.children[_].serialize(null));return m},d}(t.Action);t.CombineAction=o;var l=function(h){N(d,h);function d(p,m,_){var v=h.call(this,p,_)||this;return v.func=m,v}return d.prototype.execute=function(p){this.func(p)},d}(t.Action);t.ExecuteCodeAction=l;var u=function(h){N(d,h);function d(p,m,_,v){var S=h.call(this,p,v)||this;return S._target=m,S._parent=_,S}return d.prototype._prepare=function(){},d.prototype.execute=function(){if(this._target.parent!==this._parent){var p=this._parent.getWorldMatrix().clone();p.invert(),this._target.position=t.Vector3.TransformCoordinates(this._target.position,p),this._target.parent=this._parent}},d.prototype.serialize=function(p){return h.prototype._serialize.call(this,{name:"SetParentAction",properties:[t.Action._GetTargetProperty(this._target),t.Action._GetTargetProperty(this._parent)]},p)},d}(t.Action);t.SetParentAction=u})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l){if(o===void 0&&(o=.01),l===void 0&&(l=t.Texture.TRILINEAR_SAMPLINGMODE),this.name=r,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new t.Observable,this._vertexBuffers={},s._getComponent(t.SceneComponentConstants.NAME_SPRITE)||s._addComponent(new t.SpriteSceneComponent(s)),this._capacity=a,this._spriteTexture=new t.Texture(i,s,!0,!1,l),this._spriteTexture.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,n.width&&n.height)this.cellWidth=n.width,this.cellHeight=n.height;else if(n!==void 0)this.cellWidth=n,this.cellHeight=n;else return;this._epsilon=o,this._scene=s,this._scene.spriteManagers.push(this);for(var u=[],h=0,d=0;d<a;d++)u.push(h),u.push(h+1),u.push(h+2),u.push(h),u.push(h+2),u.push(h+3),h+=4;this._indexBuffer=s.getEngine().createIndexBuffer(u),this._vertexData=new Float32Array(a*16*4),this._buffer=new t.Buffer(s.getEngine(),this._vertexData,!0,16);var p=this._buffer.createVertexBuffer(t.VertexBuffer.PositionKind,0,4),m=this._buffer.createVertexBuffer("options",4,4),_=this._buffer.createVertexBuffer("cellInfo",8,4),v=this._buffer.createVertexBuffer(t.VertexBuffer.ColorKind,12,4);this._vertexBuffers[t.VertexBuffer.PositionKind]=p,this._vertexBuffers.options=m,this._vertexBuffers.cellInfo=_,this._vertexBuffers[t.VertexBuffer.ColorKind]=v,this._effectBase=this._scene.getEngine().createEffect("sprites",[t.VertexBuffer.PositionKind,"options","cellInfo",t.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[t.VertexBuffer.PositionKind,"options","cellInfo",t.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(c.prototype,"onDispose",{set:function(r){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"texture",{get:function(){return this._spriteTexture},set:function(r){this._spriteTexture=r},enumerable:!0,configurable:!0}),c.prototype._appendSpriteVertex=function(r,i,a,n,s){var o=r*16;a===0?a=this._epsilon:a===1&&(a=1-this._epsilon),n===0?n=this._epsilon:n===1&&(n=1-this._epsilon),this._vertexData[o]=i.position.x,this._vertexData[o+1]=i.position.y,this._vertexData[o+2]=i.position.z,this._vertexData[o+3]=i.angle,this._vertexData[o+4]=i.width,this._vertexData[o+5]=i.height,this._vertexData[o+6]=a,this._vertexData[o+7]=n,this._vertexData[o+8]=i.invertU?1:0,this._vertexData[o+9]=i.invertV?1:0;var l=i.cellIndex/s>>0;this._vertexData[o+10]=i.cellIndex-l*s,this._vertexData[o+11]=l,this._vertexData[o+12]=i.color.r,this._vertexData[o+13]=i.color.g,this._vertexData[o+14]=i.color.b,this._vertexData[o+15]=i.color.a},c.prototype.intersects=function(r,i,a,n){for(var s=Math.min(this._capacity,this.sprites.length),o=t.Vector3.Zero(),l=t.Vector3.Zero(),u=Number.MAX_VALUE,h=null,d=t.Vector3.Zero(),p=i.getViewMatrix(),m=0;m<s;m++){var _=this.sprites[m];if(_){if(a){if(!a(_))continue}else if(!_.isPickable)continue;if(t.Vector3.TransformCoordinatesToRef(_.position,p,d),o.copyFromFloats(d.x-_.width/2,d.y-_.height/2,d.z),l.copyFromFloats(d.x+_.width/2,d.y+_.height/2,d.z),r.intersectsBoxMinMax(o,l)){var v=t.Vector3.Distance(d,r.origin);if(u>v&&(u=v,h=_,n))break}}}if(h){var S=new t.PickingInfo;return S.hit=!0,S.pickedSprite=h,S.distance=u,S}return null},c.prototype.render=function(){if(!(!this._effectBase.isReady()||!this._effectFog.isReady()||!this._spriteTexture||!this._spriteTexture.isReady())){for(var r=this._scene.getEngine(),i=this._spriteTexture.getBaseSize(),a=r.getDeltaTime(),n=Math.min(this._capacity,this.sprites.length),s=i.width/this.cellWidth,o=0,l=0;l<n;l++){var u=this.sprites[l];!u||!u.isVisible||(u._animate(a),this._appendSpriteVertex(o++,u,0,0,s),this._appendSpriteVertex(o++,u,1,0,s),this._appendSpriteVertex(o++,u,1,1,s),this._appendSpriteVertex(o++,u,0,1,s))}this._buffer.update(this._vertexData);var h=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==t.Scene.FOGMODE_NONE&&this.fogEnabled&&(h=this._effectFog),r.enableEffect(h);var d=this._scene.getViewMatrix();h.setTexture("diffuseSampler",this._spriteTexture),h.setMatrix("view",d),h.setMatrix("projection",this._scene.getProjectionMatrix()),h.setFloat2("textureInfos",this.cellWidth/i.width,this.cellHeight/i.height),this._scene.fogEnabled&&this._scene.fogMode!==t.Scene.FOGMODE_NONE&&this.fogEnabled&&(h.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),h.setColor3("vFogColor",this._scene.fogColor)),r.bindBuffers(this._vertexBuffers,this._indexBuffer,h),this.blendMode==t.Engine.ALPHA_ADD?(r.setAlphaMode(t.Engine.ALPHA_ADD),r.drawElementsType(t.Material.TriangleFillMode,0,o/4*6),r.setAlphaMode(t.Engine.ALPHA_DISABLE)):(this.noAlphaTest||(r.setDepthFunctionToLessOrEqual(),h.setBool("alphaTest",!0),r.setColorWrite(!1),r.drawElementsType(t.Material.TriangleFillMode,0,o/4*6),r.setColorWrite(!0),h.setBool("alphaTest",!1)),r.setAlphaMode(t.Engine.ALPHA_COMBINE),r.drawElementsType(t.Material.TriangleFillMode,0,o/4*6),r.setAlphaMode(t.Engine.ALPHA_DISABLE))}},c.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var r=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(r,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},c}();t.SpriteManager=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.name=r,this.color=new t.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=i,this._manager.sprites.push(this),this.position=t.Vector3.Zero()}return Object.defineProperty(c.prototype,"size",{get:function(){return this.width},set:function(r){this.width=r,this.height=r},enumerable:!0,configurable:!0}),c.prototype.playAnimation=function(r,i,a,n,s){this._fromIndex=r,this._toIndex=i,this._loopAnimation=a,this._delay=n,this._animationStarted=!0,this._direction=r<i?1:-1,this.cellIndex=r,this._time=0,this._onAnimationEnd=s},c.prototype.stopAnimation=function(){this._animationStarted=!1},c.prototype._animate=function(r){this._animationStarted&&(this._time+=r,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex>this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},c.prototype.dispose=function(){for(var r=0;r<this._manager.sprites.length;r++)this._manager.sprites[r]==this&&this._manager.sprites.splice(r,1)},c}();t.Sprite=f})(T||(T={}));var T;(function(t){t.Scene.prototype._internalPickSprites=function(c,r,i,a){if(!t.PickingInfo)return null;var n=null;if(!a){if(!this.activeCamera)return null;a=this.activeCamera}if(this.spriteManagers.length>0)for(var s=0;s<this.spriteManagers.length;s++){var o=this.spriteManagers[s];if(o.isPickable){var l=o.intersects(c,a,r,i);if(!(!l||!l.hit)&&!(!i&&n!=null&&l.distance>=n.distance)&&(n=l,i))break}}return n||new t.PickingInfo},t.Scene.prototype.pickSprite=function(c,r,i,a,n){return this.createPickingRayInCameraSpaceToRef(c,r,this._tempSpritePickingRay,n),this._internalPickSprites(this._tempSpritePickingRay,i,a,n)},t.Scene.prototype.pickSpriteWithRay=function(c,r,i,a){if(!this._tempSpritePickingRay)return null;if(!a){if(!this.activeCamera)return null;a=this.activeCamera}return t.Ray.TransformToRef(c,a.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,r,i,a)},t.Scene.prototype.setPointerOverSprite=function(c){this._pointerOverSprite!==c&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(t.ActionManager.OnPointerOutTrigger,t.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=c,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(t.ActionManager.OnPointerOverTrigger,t.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},t.Scene.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_SPRITE,this.scene=r,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=t.Ray?t.Ray.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new t.Observable,this.scene.onAfterSpritesRenderingObservable=new t.Observable,this._spritePredicate=function(i){return i.actionManager?i.isPickable&&i.actionManager.hasPointerTriggers:!1}}return c.prototype.register=function(){this.scene._pointerMoveStage.registerStep(t.SceneComponentConstants.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(t.SceneComponentConstants.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(t.SceneComponentConstants.STEP_POINTERUP_SPRITE,this,this._pointerUp)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var r=this.scene.spriteManagers;r.length;)r[0].dispose()},c.prototype._pickSpriteButKeepRay=function(r,i,a,n,s){var o=this.scene.pickSprite(i,a,this._spritePredicate,n,s);return o&&(o.ray=r?r.ray:null),o},c.prototype._pointerMove=function(r,i,a,n,s){var o=this.scene;return n?o.setPointerOverSprite(null):(a=this._pickSpriteButKeepRay(a,r,i,!1,o.cameraToUseForPointers||void 0),a&&a.hit&&a.pickedSprite?(o.setPointerOverSprite(a.pickedSprite),o._pointerOverSprite&&o._pointerOverSprite.actionManager&&o._pointerOverSprite.actionManager.hoverCursor?s.style.cursor=o._pointerOverSprite.actionManager.hoverCursor:s.style.cursor=o.hoverCursor):o.setPointerOverSprite(null)),a},c.prototype._pointerDown=function(r,i,a,n){var s=this.scene;if(s._pickedDownSprite=null,s.spriteManagers.length>0&&(a=s.pickSprite(r,i,this._spritePredicate,!1,s.cameraToUseForPointers||void 0),a&&a.hit&&a.pickedSprite&&a.pickedSprite.actionManager)){switch(s._pickedDownSprite=a.pickedSprite,n.button){case 0:a.pickedSprite.actionManager.processTrigger(t.ActionManager.OnLeftPickTrigger,t.ActionEvent.CreateNewFromSprite(a.pickedSprite,s,n));break;case 1:a.pickedSprite.actionManager.processTrigger(t.ActionManager.OnCenterPickTrigger,t.ActionEvent.CreateNewFromSprite(a.pickedSprite,s,n));break;case 2:a.pickedSprite.actionManager.processTrigger(t.ActionManager.OnRightPickTrigger,t.ActionEvent.CreateNewFromSprite(a.pickedSprite,s,n));break}a.pickedSprite.actionManager&&a.pickedSprite.actionManager.processTrigger(t.ActionManager.OnPickDownTrigger,t.ActionEvent.CreateNewFromSprite(a.pickedSprite,s,n))}return a},c.prototype._pointerUp=function(r,i,a,n){var s=this.scene;if(s.spriteManagers.length>0){var o=s.pickSprite(r,i,this._spritePredicate,!1,s.cameraToUseForPointers||void 0);o&&(o.hit&&o.pickedSprite&&o.pickedSprite.actionManager&&(o.pickedSprite.actionManager.processTrigger(t.ActionManager.OnPickUpTrigger,t.ActionEvent.CreateNewFromSprite(o.pickedSprite,s,n)),o.pickedSprite.actionManager&&(this.scene._isPointerSwiping()||o.pickedSprite.actionManager.processTrigger(t.ActionManager.OnPickTrigger,t.ActionEvent.CreateNewFromSprite(o.pickedSprite,s,n)))),s._pickedDownSprite&&s._pickedDownSprite.actionManager&&s._pickedDownSprite!==o.pickedSprite&&s._pickedDownSprite.actionManager.processTrigger(t.ActionManager.OnPickOutTrigger,t.ActionEvent.CreateNewFromSprite(s._pickedDownSprite,s,n)))}return a},c}();t.SpriteSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n){this.bu=i,this.bv=a,this.distance=n,this.faceId=0,this.subMeshId=0}return r}();t.IntersectionInfo=f;var c=function(){function r(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return r.prototype.getNormal=function(i,a){if(i===void 0&&(i=!1),a===void 0&&(a=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.NormalKind))return null;var n=this.pickedMesh.getIndices();if(!n)return null;var s;if(a){var o=this.pickedMesh.getVerticesData(t.VertexBuffer.NormalKind),l=t.Vector3.FromArray(o,n[this.faceId*3]*3),u=t.Vector3.FromArray(o,n[this.faceId*3+1]*3),h=t.Vector3.FromArray(o,n[this.faceId*3+2]*3);l=l.scale(this.bu),u=u.scale(this.bv),h=h.scale(1-this.bu-this.bv),s=new t.Vector3(l.x+u.x+h.x,l.y+u.y+h.y,l.z+u.z+h.z)}else{var d=this.pickedMesh.getVerticesData(t.VertexBuffer.PositionKind),p=t.Vector3.FromArray(d,n[this.faceId*3]*3),m=t.Vector3.FromArray(d,n[this.faceId*3+1]*3),_=t.Vector3.FromArray(d,n[this.faceId*3+2]*3),v=p.subtract(m),S=_.subtract(m);s=t.Vector3.Cross(v,S)}if(i){var P=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(t.Tmp.Matrix[0].copyFrom(P),P=t.Tmp.Matrix[0],P.setTranslationFromFloats(0,0,0),P.invert(),P.transposeToRef(t.Tmp.Matrix[1]),P=t.Tmp.Matrix[1]),s=t.Vector3.TransformNormal(s,P)}return s.normalize(),s},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(t.VertexBuffer.UVKind))return null;var i=this.pickedMesh.getIndices();if(!i)return null;var a=this.pickedMesh.getVerticesData(t.VertexBuffer.UVKind);if(!a)return null;var n=t.Vector2.FromArray(a,i[this.faceId*3]*2),s=t.Vector2.FromArray(a,i[this.faceId*3+1]*2),o=t.Vector2.FromArray(a,i[this.faceId*3+2]*2);return n=n.scale(1-this.bu-this.bv),s=s.scale(this.bu),o=o.scale(this.bv),new t.Vector2(n.x+s.x+o.x,n.y+s.y+o.y)},r}();t.PickingInfo=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){a===void 0&&(a=Number.MAX_VALUE),this.origin=r,this.direction=i,this.length=a}return c.prototype.intersectsBoxMinMax=function(r,i){var a=0,n=Number.MAX_VALUE,s,o,l,u;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<r.x||this.origin.x>i.x)return!1}else if(s=1/this.direction.x,o=(r.x-this.origin.x)*s,l=(i.x-this.origin.x)*s,l===-1/0&&(l=1/0),o>l&&(u=o,o=l,l=u),a=Math.max(o,a),n=Math.min(l,n),a>n)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<r.y||this.origin.y>i.y)return!1}else if(s=1/this.direction.y,o=(r.y-this.origin.y)*s,l=(i.y-this.origin.y)*s,l===-1/0&&(l=1/0),o>l&&(u=o,o=l,l=u),a=Math.max(o,a),n=Math.min(l,n),a>n)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<r.z||this.origin.z>i.z)return!1}else if(s=1/this.direction.z,o=(r.z-this.origin.z)*s,l=(i.z-this.origin.z)*s,l===-1/0&&(l=1/0),o>l&&(u=o,o=l,l=u),a=Math.max(o,a),n=Math.min(l,n),a>n)return!1;return!0},c.prototype.intersectsBox=function(r){return this.intersectsBoxMinMax(r.minimum,r.maximum)},c.prototype.intersectsSphere=function(r){var i=r.center.x-this.origin.x,a=r.center.y-this.origin.y,n=r.center.z-this.origin.z,s=i*i+a*a+n*n,o=r.radius*r.radius;if(s<=o)return!0;var l=i*this.direction.x+a*this.direction.y+n*this.direction.z;if(l<0)return!1;var u=s-l*l;return u<=o},c.prototype.intersectsTriangle=function(r,i,a){this._edge1||(this._edge1=t.Vector3.Zero(),this._edge2=t.Vector3.Zero(),this._pvec=t.Vector3.Zero(),this._tvec=t.Vector3.Zero(),this._qvec=t.Vector3.Zero()),i.subtractToRef(r,this._edge1),a.subtractToRef(r,this._edge2),t.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var n=t.Vector3.Dot(this._edge1,this._pvec);if(n===0)return null;var s=1/n;this.origin.subtractToRef(r,this._tvec);var o=t.Vector3.Dot(this._tvec,this._pvec)*s;if(o<0||o>1)return null;t.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var l=t.Vector3.Dot(this.direction,this._qvec)*s;if(l<0||o+l>1)return null;var u=t.Vector3.Dot(this._edge2,this._qvec)*s;return u>this.length?null:new t.IntersectionInfo(o,l,u)},c.prototype.intersectsPlane=function(r){var i,a=t.Vector3.Dot(r.normal,this.direction);if(Math.abs(a)<999999997475243e-21)return null;var n=t.Vector3.Dot(r.normal,this.origin);return i=(-r.d-n)/a,i<0?i<-999999997475243e-21?null:0:i},c.prototype.intersectsMesh=function(r,i){var a=t.Tmp.Matrix[0];return r.getWorldMatrix().invertToRef(a),this._tmpRay?c.TransformToRef(this,a,this._tmpRay):this._tmpRay=c.Transform(this,a),r.intersects(this._tmpRay,i)},c.prototype.intersectsMeshes=function(r,i,a){a?a.length=0:a=[];for(var n=0;n<r.length;n++){var s=this.intersectsMesh(r[n],i);s.hit&&a.push(s)}return a.sort(this._comparePickingInfo),a},c.prototype._comparePickingInfo=function(r,i){return r.distance<i.distance?-1:r.distance>i.distance?1:0},c.prototype.intersectionSegment=function(r,i,a){var n=this.origin.add(this.direction.multiplyByFloats(c.rayl,c.rayl,c.rayl)),s=i.subtract(r),o=n.subtract(this.origin),l=r.subtract(this.origin),u=t.Vector3.Dot(s,s),h=t.Vector3.Dot(s,o),d=t.Vector3.Dot(o,o),p=t.Vector3.Dot(s,l),m=t.Vector3.Dot(o,l),_=u*d-h*h,v,S,P=_,x,R,w=_;_<c.smallnum?(S=0,P=1,R=m,w=d):(S=h*m-d*p,R=u*m-h*p,S<0?(S=0,R=m,w=d):S>P&&(S=P,R=m+h,w=d)),R<0?(R=0,-p<0?S=0:-p>u?S=P:(S=-p,P=u)):R>w&&(R=w,-p+h<0?S=0:-p+h>u?S=P:(S=-p+h,P=u)),v=Math.abs(S)<c.smallnum?0:S/P,x=Math.abs(R)<c.smallnum?0:R/w;var I=o.multiplyByFloats(x,x,x),F=l.add(s.multiplyByFloats(v,v,v)).subtract(I),k=x>0&&x<=this.length&&F.lengthSquared()<a*a;return k?I.length():-1},c.prototype.update=function(r,i,a,n,s,o,l){return t.Vector3.UnprojectFloatsToRef(r,i,0,a,n,s,o,l,this.origin),t.Vector3.UnprojectFloatsToRef(r,i,1,a,n,s,o,l,t.Tmp.Vector3[0]),t.Tmp.Vector3[0].subtractToRef(this.origin,this.direction),this.direction.normalize(),this},c.Zero=function(){return new c(t.Vector3.Zero(),t.Vector3.Zero())},c.CreateNew=function(r,i,a,n,s,o,l){var u=c.Zero();return u.update(r,i,a,n,s,o,l)},c.CreateNewFromTo=function(r,i,a){a===void 0&&(a=t.Matrix.Identity());var n=i.subtract(r),s=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return n.normalize(),c.Transform(new c(r,n,s),a)},c.Transform=function(r,i){var a=new c(new t.Vector3(0,0,0),new t.Vector3(0,0,0));return c.TransformToRef(r,i,a),a},c.TransformToRef=function(r,i,a){t.Vector3.TransformCoordinatesToRef(r.origin,i,a.origin),t.Vector3.TransformNormalToRef(r.direction,i,a.direction),a.length=r.length;var n=a.direction,s=n.length();if(!(s===0||s===1)){var o=1/s;n.x*=o,n.y*=o,n.z*=o,a.length*=s}},c.smallnum=1e-8,c.rayl=1e9,c}();t.Ray=f})(T||(T={}));var T;(function(t){var f=function(i,a,n,s){return!(i.x>n.x+s||n.x-s>a.x||i.y>n.y+s||n.y-s>a.y||i.z>n.z+s||n.z-s>a.z)},c=function(){var i={root:0,found:!1};return function(a,n,s,o){i.root=0,i.found=!1;var l=n*n-4*a*s;if(l<0)return i;var u=Math.sqrt(l),h=(-n-u)/(2*a),d=(-n+u)/(2*a);if(h>d){var p=d;d=h,h=p}return h>0&&h<o?(i.root=h,i.found=!0,i):(d>0&&d<o&&(i.root=d,i.found=!0),i)}}(),r=function(){function i(){this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero(),this._radius=t.Vector3.One(),this._retry=0,this._basePointWorld=t.Vector3.Zero(),this._velocityWorld=t.Vector3.Zero(),this._normalizedVelocity=t.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(a){this._collisionMask=isNaN(a)?-1:a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),i.prototype._initialize=function(a,n,s){this._velocity=n,t.Vector3.NormalizeToRef(n,this._normalizedVelocity),this._basePoint=a,a.multiplyToRef(this._radius,this._basePointWorld),n.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=s,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(a,n,s,o,l){n.subtractToRef(a,this._tempVector),s.subtractToRef(a,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var u=t.Vector3.Dot(this._tempVector4,l);return u<0||(o.subtractToRef(a,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),u=t.Vector3.Dot(this._tempVector4,l),u<0)?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),u=t.Vector3.Dot(this._tempVector4,l),u>=0)},i.prototype._canDoCollision=function(a,n,s,o){var l=t.Vector3.Distance(this._basePointWorld,a),u=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(l>this._velocityWorldLength+u+n||!f(s,o,this._basePointWorld,this._velocityWorldLength+u))},i.prototype._testTriangle=function(a,n,s,o,l,u){var h,d=!1;n||(n=[]),n[a]||(n[a]=new t.Plane(0,0,0,0),n[a].copyFromPoints(s,o,l));var p=n[a];if(!(!u&&!p.isFrontFacingTo(this._normalizedVelocity,0))){var m=p.signedDistanceTo(this._basePoint),_=t.Vector3.Dot(p.normal,this._velocity);if(_==0){if(Math.abs(m)>=1)return;d=!0,h=0}else{h=(-1-m)/_;var v=(1-m)/_;if(h>v){var S=v;v=h,h=S}if(h>1||v<0)return;h<0&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,x=1;if(d||(this._basePoint.subtractToRef(p.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,o,l,p.normal)&&(P=!0,x=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var R=this._velocity.lengthSquared(),w=R;this._basePoint.subtractToRef(s,this._tempVector);var I=2*t.Vector3.Dot(this._velocity,this._tempVector),F=this._tempVector.lengthSquared()-1,k=c(w,I,F,x);k.found&&(x=k.root,P=!0,this._collisionPoint.copyFrom(s)),this._basePoint.subtractToRef(o,this._tempVector),I=2*t.Vector3.Dot(this._velocity,this._tempVector),F=this._tempVector.lengthSquared()-1,k=c(w,I,F,x),k.found&&(x=k.root,P=!0,this._collisionPoint.copyFrom(o)),this._basePoint.subtractToRef(l,this._tempVector),I=2*t.Vector3.Dot(this._velocity,this._tempVector),F=this._tempVector.lengthSquared()-1,k=c(w,I,F,x),k.found&&(x=k.root,P=!0,this._collisionPoint.copyFrom(l)),o.subtractToRef(s,this._edge),s.subtractToRef(this._basePoint,this._baseToVertex);var E=this._edge.lengthSquared(),g=t.Vector3.Dot(this._edge,this._velocity),y=t.Vector3.Dot(this._edge,this._baseToVertex);if(w=E*-R+g*g,I=E*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*g*y,F=E*(1-this._baseToVertex.lengthSquared())+y*y,k=c(w,I,F,x),k.found){var M=(g*k.root-y)/E;M>=0&&M<=1&&(x=k.root,P=!0,this._edge.scaleInPlace(M),s.addToRef(this._edge,this._collisionPoint))}l.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),E=this._edge.lengthSquared(),g=t.Vector3.Dot(this._edge,this._velocity),y=t.Vector3.Dot(this._edge,this._baseToVertex),w=E*-R+g*g,I=E*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*g*y,F=E*(1-this._baseToVertex.lengthSquared())+y*y,k=c(w,I,F,x),k.found&&(M=(g*k.root-y)/E,M>=0&&M<=1&&(x=k.root,P=!0,this._edge.scaleInPlace(M),o.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(l,this._edge),l.subtractToRef(this._basePoint,this._baseToVertex),E=this._edge.lengthSquared(),g=t.Vector3.Dot(this._edge,this._velocity),y=t.Vector3.Dot(this._edge,this._baseToVertex),w=E*-R+g*g,I=E*(2*t.Vector3.Dot(this._velocity,this._baseToVertex))-2*g*y,F=E*(1-this._baseToVertex.lengthSquared())+y*y,k=c(w,I,F,x),k.found&&(M=(g*k.root-y)/E,M>=0&&M<=1&&(x=k.root,P=!0,this._edge.scaleInPlace(M),l.addToRef(this._edge,this._collisionPoint)))}if(P){var C=x*this._velocity.length();(!this.collisionFound||C<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=C,this.collisionFound=!0)}}},i.prototype._collide=function(a,n,s,o,l,u,h){for(var d=o;d<l;d+=3){var p=n[s[d]-u],m=n[s[d+1]-u],_=n[s[d+2]-u];this._testTriangle(d,a,_,m,p,h)}},i.prototype._getResponse=function(a,n){a.addToRef(n,this._destinationPoint),n.scaleInPlace(this._nearestDistance/n.length()),this._basePoint.addToRef(n,a),a.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),a.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,n)},i}();t.Collider=r})(T||(T={}));var T;(function(t){t.CollisionWorker="";var f;(function(a){a[a.INIT=0]="INIT",a[a.UPDATE=1]="UPDATE",a[a.COLLIDE=2]="COLLIDE"})(f=t.WorkerTaskType||(t.WorkerTaskType={}));var c;(function(a){a[a.SUCCESS=0]="SUCCESS",a[a.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"})(c=t.WorkerReplyType||(t.WorkerReplyType={}));var r=function(){function a(){var n=this;this._scaledPosition=t.Vector3.Zero(),this._scaledVelocity=t.Vector3.Zero(),this.onMeshUpdated=function(s){n._addUpdateMeshesList[s.uniqueId]=a.SerializeMesh(s)},this.onGeometryUpdated=function(s){n._addUpdateGeometriesList[s.id]=a.SerializeGeometry(s)},this._afterRender=function(){if(n._init&&!(n._toRemoveGeometryArray.length==0&&n._toRemoveMeshesArray.length==0&&Object.keys(n._addUpdateGeometriesList).length==0&&Object.keys(n._addUpdateMeshesList).length==0)&&!(n._runningUpdated>4)){++n._runningUpdated;var s={updatedMeshes:n._addUpdateMeshesList,updatedGeometries:n._addUpdateGeometriesList,removedGeometries:n._toRemoveGeometryArray,removedMeshes:n._toRemoveMeshesArray},o={payload:s,taskType:f.UPDATE},l=[];for(var u in s.updatedGeometries)s.updatedGeometries.hasOwnProperty(u)&&(l.push(o.payload.updatedGeometries[u].indices.buffer),l.push(o.payload.updatedGeometries[u].normals.buffer),l.push(o.payload.updatedGeometries[u].positions.buffer));n._worker.postMessage(o,l),n._addUpdateMeshesList={},n._addUpdateGeometriesList={},n._toRemoveGeometryArray=[],n._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(s){var o=s.data;if(o.error!=c.SUCCESS){t.Tools.Warn("error returned from worker!");return}switch(o.taskType){case f.INIT:n._init=!0,n._scene.meshes.forEach(function(d){n.onMeshAdded(d)}),n._scene.getGeometries().forEach(function(d){n.onGeometryAdded(d)});break;case f.UPDATE:n._runningUpdated--;break;case f.COLLIDE:var l=o.payload;if(!n._collisionsCallbackArray[l.collisionId])return;var u=n._collisionsCallbackArray[l.collisionId];if(u){var h=n._scene.getMeshByUniqueID(l.collidedMeshUniqueId);h&&u(l.collisionId,t.Vector3.FromArray(l.newPosition),h)}n._collisionsCallbackArray[l.collisionId]=null;break}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return a.prototype.getNewPosition=function(n,s,o,l,u,h,d){if(this._init&&!(this._collisionsCallbackArray[d]||this._collisionsCallbackArray[d+1e5])){n.divideToRef(o._radius,this._scaledPosition),s.divideToRef(o._radius,this._scaledVelocity),this._collisionsCallbackArray[d]=h;var p={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:o._radius.asArray()},collisionId:d,excludedMeshUniqueId:u?u.uniqueId:null,maximumRetry:l},m={payload:p,taskType:f.COLLIDE};this._worker.postMessage(m)}},a.prototype.init=function(n){this._scene=n,this._scene.registerAfterRender(this._afterRender);var s=t.WorkerIncluded?t.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([t.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(s),this._worker.onmessage=this._onMessageFromWorker;var o={payload:{},taskType:f.INIT};this._worker.postMessage(o)},a.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},a.prototype.onMeshAdded=function(n){n.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(n)},a.prototype.onMeshRemoved=function(n){this._toRemoveMeshesArray.push(n.uniqueId)},a.prototype.onGeometryAdded=function(n){n.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(n)},a.prototype.onGeometryDeleted=function(n){this._toRemoveGeometryArray.push(n.id)},a.SerializeMesh=function(n){var s=[];n.subMeshes&&(s=n.subMeshes.map(function(h,d){var p=h.getBoundingInfo();return{position:d,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount,hasMaterial:!!h.getMaterial(),sphereCenter:p.boundingSphere.centerWorld.asArray(),sphereRadius:p.boundingSphere.radiusWorld,boxMinimum:p.boundingBox.minimumWorld.asArray(),boxMaximum:p.boundingBox.maximumWorld.asArray()}}));var o=null;if(n instanceof t.Mesh){var l=n.geometry;o=l?l.id:null}else if(n instanceof t.InstancedMesh){var l=n.sourceMesh&&n.sourceMesh.geometry;o=l?l.id:null}var u=n.getBoundingInfo();return{uniqueId:n.uniqueId,id:n.id,name:n.name,geometryId:o,sphereCenter:u.boundingSphere.centerWorld.asArray(),sphereRadius:u.boundingSphere.radiusWorld,boxMinimum:u.boundingBox.minimumWorld.asArray(),boxMaximum:u.boundingBox.maximumWorld.asArray(),worldMatrixFromCache:n.worldMatrixFromCache.asArray(),subMeshes:s,checkCollisions:n.checkCollisions}},a.SerializeGeometry=function(n){return{id:n.id,positions:new Float32Array(n.getVerticesData(t.VertexBuffer.PositionKind)||[]),normals:new Float32Array(n.getVerticesData(t.VertexBuffer.NormalKind)||[]),indices:new Uint32Array(n.getIndices()||[])}},a}();t.CollisionCoordinatorWorker=r;var i=function(){function a(){this._scaledPosition=t.Vector3.Zero(),this._scaledVelocity=t.Vector3.Zero(),this._finalPosition=t.Vector3.Zero()}return a.prototype.getNewPosition=function(n,s,o,l,u,h,d){n.divideToRef(o._radius,this._scaledPosition),s.divideToRef(o._radius,this._scaledVelocity),o.collidedMesh=null,o._retry=0,o._initialVelocity=this._scaledVelocity,o._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,o,l,this._finalPosition,u),this._finalPosition.multiplyInPlace(o._radius),h(d,this._finalPosition,o.collidedMesh)},a.prototype.init=function(n){this._scene=n},a.prototype.destroy=function(){},a.prototype.onMeshAdded=function(n){},a.prototype.onMeshUpdated=function(n){},a.prototype.onMeshRemoved=function(n){},a.prototype.onGeometryAdded=function(n){},a.prototype.onGeometryUpdated=function(n){},a.prototype.onGeometryDeleted=function(n){},a.prototype._collideWithWorld=function(n,s,o,l,u,h){h===void 0&&(h=null);var d=t.Engine.CollisionsEpsilon*10;if(o._retry>=l){u.copyFrom(n);return}var p=h?h.collisionMask:o.collisionMask;o._initialize(n,s,d);for(var m=0;m<this._scene.meshes.length;m++){var _=this._scene.meshes[m];_.isEnabled()&&_.checkCollisions&&_.subMeshes&&_!==h&&p&_.collisionGroup&&_._checkCollision(o)}if(!o.collisionFound){n.addToRef(s,u);return}if((s.x!==0||s.y!==0||s.z!==0)&&o._getResponse(n,s),s.length()<=d){u.copyFrom(n);return}o._retry++,this._collideWithWorld(n,s,o,l,u,h)},a}();t.CollisionCoordinatorLegacy=i})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.particleSystem=r,this.position=t.Vector3.Zero(),this.direction=t.Vector3.Zero(),this.color=new t.Color4(0,0,0,0),this.colorStep=new t.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new t.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new t.Color4(0,0,0,0),this._currentColor2=new t.Color4(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=c._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return c.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},c.prototype.updateCellIndex=function(){var r=this.age,i=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(this._randomCellOffset===void 0&&(this._randomCellOffset=Math.random()*this.lifeTime),i===0?(i=1,r=this._randomCellOffset):r+=this._randomCellOffset);var a=this._initialEndSpriteCellID-this._initialStartSpriteCellID,n=t.Scalar.Clamp(r*i%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+n*a|0},c.prototype._inheritParticleInfoToSubEmitter=function(r){if(r.particleSystem.emitter.position){var i=r.particleSystem.emitter;i.position.copyFrom(this.position),r.inheritDirection&&(i.position.subtractToRef(this.direction,t.Tmp.Vector3[0]),i.lookAt(t.Tmp.Vector3[0],0,Math.PI/2))}else{var a=r.particleSystem.emitter;a.copyFrom(this.position)}this.direction.scaleToRef(r.inheritedVelocityAmount/2,t.Tmp.Vector3[0]),r.particleSystem._inheritedVelocityOffset.copyFrom(t.Tmp.Vector3[0])},c.prototype._inheritParticleInfoToSubEmitters=function(){var r=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(i){r._inheritParticleInfoToSubEmitter(i)})},c.prototype._reset=function(){this.age=0,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},c.prototype.copyTo=function(r){r.position.copyFrom(this.position),this._initialDirection?r._initialDirection?r._initialDirection.copyFrom(this._initialDirection):r._initialDirection=this._initialDirection.clone():r._initialDirection=null,r.direction.copyFrom(this.direction),r.color.copyFrom(this.color),r.colorStep.copyFrom(this.colorStep),r.lifeTime=this.lifeTime,r.age=this.age,r._randomCellOffset=this._randomCellOffset,r.size=this.size,r.scale.copyFrom(this.scale),r.angle=this.angle,r.angularSpeed=this.angularSpeed,r.particleSystem=this.particleSystem,r.cellIndex=this.cellIndex,r.id=this.id,r._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(r._currentColorGradient=this._currentColorGradient,r._currentColor1.copyFrom(this._currentColor1),r._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(r._currentSizeGradient=this._currentSizeGradient,r._currentSize1=this._currentSize1,r._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(r._currentAngularSpeedGradient=this._currentAngularSpeedGradient,r._currentAngularSpeed1=this._currentAngularSpeed1,r._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(r._currentVelocityGradient=this._currentVelocityGradient,r._currentVelocity1=this._currentVelocity1,r._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(r._currentLimitVelocityGradient=this._currentLimitVelocityGradient,r._currentLimitVelocity1=this._currentLimitVelocity1,r._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(r._currentDragGradient=this._currentDragGradient,r._currentDrag1=this._currentDrag1,r._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(r._initialStartSpriteCellID=this._initialStartSpriteCellID,r._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&r.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(r._randomNoiseCoordinates1?(r._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),r._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(r._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),r._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},c._Count=0,c}();t.Particle=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new t.Vector3(10,10,10),this.onAnimationEnd=null,this.blendMode=t.ParticleSystem.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new t.Vector2(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gravity=t.Vector3.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new t.Color4(1,1,1,1),this.color2=new t.Color4(1,1,1,1),this.colorDead=new t.Color4(0,0,0,1),this.textureMask=new t.Color4(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=t.ParticleSystem.BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new t.ImageProcessingConfigurationDefines,this.id=r,this.name=r}return Object.defineProperty(c.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(r){this._isAnimationSheetEnabled!=r&&(this._isAnimationSheetEnabled=r,this._reset())},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},c.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},c.prototype.getDragGradients=function(){return this._dragGradients},c.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},c.prototype.getColorGradients=function(){return this._colorGradients},c.prototype.getSizeGradients=function(){return this._sizeGradients},c.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},c.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},c.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},c.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},c.prototype.getVelocityGradients=function(){return this._velocityGradients},c.prototype.getStartSizeGradients=function(){return this._startSizeGradients},c.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(c.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:t.Vector3.Zero()},set:function(r){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:t.Vector3.Zero()},set:function(r){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:t.Vector3.Zero()},set:function(r){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:t.Vector3.Zero()},set:function(r){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(r){this._isBillboardBased!==r&&(this._isBillboardBased=r,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(r){this._attachImageProcessingConfiguration(r)},enumerable:!0,configurable:!0}),c.prototype._attachImageProcessingConfiguration=function(r){r!==this._imageProcessingConfiguration&&(r?this._imageProcessingConfiguration=r:this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration)},c.prototype._reset=function(){},c.prototype._removeGradientAndTexture=function(r,i,a){if(!i)return this;for(var n=0,s=0,o=i;s<o.length;s++){var l=o[s];if(l.gradient===r){i.splice(n,1);break}n++}return a&&a.dispose(),this},c.prototype.createPointEmitter=function(r,i){var a=new t.PointParticleEmitter;return a.direction1=r,a.direction2=i,this.particleEmitterType=a,a},c.prototype.createHemisphericEmitter=function(r,i){r===void 0&&(r=1),i===void 0&&(i=1);var a=new t.HemisphericParticleEmitter(r,i);return this.particleEmitterType=a,a},c.prototype.createSphereEmitter=function(r,i){r===void 0&&(r=1),i===void 0&&(i=1);var a=new t.SphereParticleEmitter(r,i);return this.particleEmitterType=a,a},c.prototype.createDirectedSphereEmitter=function(r,i,a){r===void 0&&(r=1),i===void 0&&(i=new t.Vector3(0,1,0)),a===void 0&&(a=new t.Vector3(0,1,0));var n=new t.SphereDirectedParticleEmitter(r,i,a);return this.particleEmitterType=n,n},c.prototype.createCylinderEmitter=function(r,i,a,n){r===void 0&&(r=1),i===void 0&&(i=1),a===void 0&&(a=1),n===void 0&&(n=0);var s=new t.CylinderParticleEmitter(r,i,a,n);return this.particleEmitterType=s,s},c.prototype.createDirectedCylinderEmitter=function(r,i,a,n,s){r===void 0&&(r=1),i===void 0&&(i=1),a===void 0&&(a=1),n===void 0&&(n=new t.Vector3(0,1,0)),s===void 0&&(s=new t.Vector3(0,1,0));var o=new t.CylinderDirectedParticleEmitter(r,i,a,n,s);return this.particleEmitterType=o,o},c.prototype.createConeEmitter=function(r,i){r===void 0&&(r=1),i===void 0&&(i=Math.PI/4);var a=new t.ConeParticleEmitter(r,i);return this.particleEmitterType=a,a},c.prototype.createBoxEmitter=function(r,i,a,n){var s=new t.BoxParticleEmitter;return this.particleEmitterType=s,this.direction1=r,this.direction2=i,this.minEmitBox=a,this.maxEmitBox=n,s},c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c.BLENDMODE_ADD=2,c.BLENDMODE_MULTIPLY=3,c.BLENDMODE_MULTIPLYADD=4,c}();t.BaseParticleSystem=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){s===void 0&&(s=null),o===void 0&&(o=!1),l===void 0&&(l=.01);var u=c.call(this,i)||this;return u._inheritedVelocityOffset=new t.Vector3,u.onDisposeObservable=new t.Observable,u._particles=new Array,u._stockParticles=new Array,u._newPartsExcess=0,u._vertexBuffers={},u._scaledColorStep=new t.Color4(0,0,0,0),u._colorDiff=new t.Color4(0,0,0,0),u._scaledDirection=t.Vector3.Zero(),u._scaledGravity=t.Vector3.Zero(),u._currentRenderId=-1,u._useInstancing=!1,u._started=!1,u._stopped=!1,u._actualFrame=0,u._currentEmitRate1=0,u._currentEmitRate2=0,u._currentStartSize1=0,u._currentStartSize2=0,u._rawTextureWidth=256,u._useRampGradients=!1,u._disposeEmitterOnDispose=!1,u.recycleParticle=function(h){var d=u._particles.pop();d!==h&&d.copyTo(h),u._stockParticles.push(d)},u._createParticle=function(){var h;if(u._stockParticles.length!==0?(h=u._stockParticles.pop(),h._reset()):h=new t.Particle(u),u._subEmitters&&u._subEmitters.length>0){var d=u._subEmitters[Math.floor(Math.random()*u._subEmitters.length)];h._attachedSubEmitters=[],d.forEach(function(p){if(p.type===t.SubEmitterType.ATTACHED){var m=p.clone();h._attachedSubEmitters.push(m),m.particleSystem.start()}})}return h},u._emitFromParticle=function(h){if(!(!u._subEmitters||u._subEmitters.length===0)){var d=Math.floor(Math.random()*u._subEmitters.length);u._subEmitters[d].forEach(function(p){if(p.type===t.SubEmitterType.END){var m=p.clone();h._inheritParticleInfoToSubEmitter(m),m.particleSystem._rootParticleSystem=u,u.activeSubSystems.push(m.particleSystem),m.particleSystem.start()}})}},u._capacity=a,u._epsilon=l,u._isAnimationSheetEnabled=o,u._scene=n||t.Engine.LastCreatedScene,u._attachImageProcessingConfiguration(null),u._customEffect=s,u._scene.particleSystems.push(u),u._useInstancing=u._scene.getEngine().getCaps().instancedArrays,u._createIndexBuffer(),u._createVertexBuffers(),u.particleEmitterType=new t.BoxParticleEmitter,u.updateFunction=function(h){var d=null,p=null;u.noiseTexture&&(d=u.noiseTexture.getSize(),p=u.noiseTexture.getContent());for(var m=function(){_=h[v];var S=u._scaledUpdateSpeed,P=_.age;if(_.age+=S,_.age>_.lifeTime){var x=_.age-P,R=_.lifeTime-P;S=R*S/x,_.age=_.lifeTime}var w=_.age/_.lifeTime;u._colorGradients&&u._colorGradients.length>0?t.Tools.GetCurrentGradient(w,u._colorGradients,function(M,C,D){M!==_._currentColorGradient&&(_._currentColor1.copyFrom(_._currentColor2),C.getColorToRef(_._currentColor2),_._currentColorGradient=M),t.Color4.LerpToRef(_._currentColor1,_._currentColor2,D,_.color)}):(_.colorStep.scaleToRef(S,u._scaledColorStep),_.color.addInPlace(u._scaledColorStep),_.color.a<0&&(_.color.a=0)),u._angularSpeedGradients&&u._angularSpeedGradients.length>0&&t.Tools.GetCurrentGradient(w,u._angularSpeedGradients,function(M,C,D){M!==_._currentAngularSpeedGradient&&(_._currentAngularSpeed1=_._currentAngularSpeed2,_._currentAngularSpeed2=C.getFactor(),_._currentAngularSpeedGradient=M),_.angularSpeed=t.Scalar.Lerp(_._currentAngularSpeed1,_._currentAngularSpeed2,D)}),_.angle+=_.angularSpeed*S;var I=S;if(u._velocityGradients&&u._velocityGradients.length>0&&t.Tools.GetCurrentGradient(w,u._velocityGradients,function(M,C,D){M!==_._currentVelocityGradient&&(_._currentVelocity1=_._currentVelocity2,_._currentVelocity2=C.getFactor(),_._currentVelocityGradient=M),I*=t.Scalar.Lerp(_._currentVelocity1,_._currentVelocity2,D)}),_.direction.scaleToRef(I,u._scaledDirection),u._limitVelocityGradients&&u._limitVelocityGradients.length>0&&t.Tools.GetCurrentGradient(w,u._limitVelocityGradients,function(M,C,D){M!==_._currentLimitVelocityGradient&&(_._currentLimitVelocity1=_._currentLimitVelocity2,_._currentLimitVelocity2=C.getFactor(),_._currentLimitVelocityGradient=M);var V=t.Scalar.Lerp(_._currentLimitVelocity1,_._currentLimitVelocity2,D),G=_.direction.length();G>V&&_.direction.scaleInPlace(u.limitVelocityDamping)}),u._dragGradients&&u._dragGradients.length>0&&t.Tools.GetCurrentGradient(w,u._dragGradients,function(M,C,D){M!==_._currentDragGradient&&(_._currentDrag1=_._currentDrag2,_._currentDrag2=C.getFactor(),_._currentDragGradient=M);var V=t.Scalar.Lerp(_._currentDrag1,_._currentDrag2,D);u._scaledDirection.scaleInPlace(1-V)}),_.position.addInPlace(u._scaledDirection),p&&d){var F=u._fetchR(_._randomNoiseCoordinates1.x,_._randomNoiseCoordinates1.y,d.width,d.height,p),k=u._fetchR(_._randomNoiseCoordinates1.z,_._randomNoiseCoordinates2.x,d.width,d.height,p),E=u._fetchR(_._randomNoiseCoordinates2.y,_._randomNoiseCoordinates2.z,d.width,d.height,p),g=t.Tmp.Vector3[0],y=t.Tmp.Vector3[1];g.copyFromFloats((2*F-1)*u.noiseStrength.x,(2*k-1)*u.noiseStrength.y,(2*E-1)*u.noiseStrength.z),g.scaleToRef(S,y),_.direction.addInPlace(y)}if(u.gravity.scaleToRef(S,u._scaledGravity),_.direction.addInPlace(u._scaledGravity),u._sizeGradients&&u._sizeGradients.length>0&&t.Tools.GetCurrentGradient(w,u._sizeGradients,function(M,C,D){M!==_._currentSizeGradient&&(_._currentSize1=_._currentSize2,_._currentSize2=C.getFactor(),_._currentSizeGradient=M),_.size=t.Scalar.Lerp(_._currentSize1,_._currentSize2,D)}),u._useRampGradients&&(u._colorRemapGradients&&u._colorRemapGradients.length>0&&t.Tools.GetCurrentGradient(w,u._colorRemapGradients,function(M,C,D){var V=t.Scalar.Lerp(M.factor1,C.factor1,D),G=t.Scalar.Lerp(M.factor2,C.factor2,D);_.remapData.x=V,_.remapData.y=G-V}),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&t.Tools.GetCurrentGradient(w,u._alphaRemapGradients,function(M,C,D){var V=t.Scalar.Lerp(M.factor1,C.factor1,D),G=t.Scalar.Lerp(M.factor2,C.factor2,D);_.remapData.z=V,_.remapData.w=G-V})),u._isAnimationSheetEnabled&&_.updateCellIndex(),_._inheritParticleInfoToSubEmitters(),_.age>=_.lifeTime)return u._emitFromParticle(_),_._attachedSubEmitters&&(_._attachedSubEmitters.forEach(function(M){M.particleSystem.disposeOnStop=!0,M.particleSystem.stop()}),_._attachedSubEmitters=null),u.recycleParticle(_),v--,"continue"},_,v=0;v<h.length;v++)m()},u}return Object.defineProperty(r.prototype,"onDispose",{set:function(i){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(i){this._useRampGradients!==i&&(this._useRampGradients=i,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"ParticleSystem"},r.prototype._addFactorGradient=function(i,a,n,s){var o=new t.FactorGradient;o.gradient=a,o.factor1=n,o.factor2=s,i.push(o),i.sort(function(l,u){return l.gradient<u.gradient?-1:l.gradient>u.gradient?1:0})},r.prototype._removeFactorGradient=function(i,a){if(i)for(var n=0,s=0,o=i;s<o.length;s++){var l=o[s];if(l.gradient===a){i.splice(n,1);break}n++}},r.prototype.addLifeTimeGradient=function(i,a,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,i,a,n),this},r.prototype.removeLifeTimeGradient=function(i){return this._removeFactorGradient(this._lifeTimeGradients,i),this},r.prototype.addSizeGradient=function(i,a,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,i,a,n),this},r.prototype.removeSizeGradient=function(i){return this._removeFactorGradient(this._sizeGradients,i),this},r.prototype.addColorRemapGradient=function(i,a,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,i,a,n),this},r.prototype.removeColorRemapGradient=function(i){return this._removeFactorGradient(this._colorRemapGradients,i),this},r.prototype.addAlphaRemapGradient=function(i,a,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,i,a,n),this},r.prototype.removeAlphaRemapGradient=function(i){return this._removeFactorGradient(this._alphaRemapGradients,i),this},r.prototype.addAngularSpeedGradient=function(i,a,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,i,a,n),this},r.prototype.removeAngularSpeedGradient=function(i){return this._removeFactorGradient(this._angularSpeedGradients,i),this},r.prototype.addVelocityGradient=function(i,a,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,i,a,n),this},r.prototype.removeVelocityGradient=function(i){return this._removeFactorGradient(this._velocityGradients,i),this},r.prototype.addLimitVelocityGradient=function(i,a,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,i,a,n),this},r.prototype.removeLimitVelocityGradient=function(i){return this._removeFactorGradient(this._limitVelocityGradients,i),this},r.prototype.addDragGradient=function(i,a,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,i,a,n),this},r.prototype.removeDragGradient=function(i){return this._removeFactorGradient(this._dragGradients,i),this},r.prototype.addEmitRateGradient=function(i,a,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,i,a,n),this},r.prototype.removeEmitRateGradient=function(i){return this._removeFactorGradient(this._emitRateGradients,i),this},r.prototype.addStartSizeGradient=function(i,a,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,i,a,n),this},r.prototype.removeStartSizeGradient=function(i){return this._removeFactorGradient(this._emitRateGradients,i),this},r.prototype._createRampGradientTexture=function(){if(!(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture)){for(var i=new Uint8Array(this._rawTextureWidth*4),a=t.Tmp.Color3[0],n=0;n<this._rawTextureWidth;n++){var s=n/this._rawTextureWidth;t.Tools.GetCurrentGradient(s,this._rampGradients,function(o,l,u){t.Color3.LerpToRef(o.color,l.color,u,a),i[n*4]=a.r*255,i[n*4+1]=a.g*255,i[n*4+2]=a.b*255,i[n*4+3]=255})}this._rampGradientsTexture=t.RawTexture.CreateRGBATexture(i,this._rawTextureWidth,1,this._scene,!1,!1,t.Texture.NEAREST_SAMPLINGMODE)}},r.prototype.getRampGradients=function(){return this._rampGradients},r.prototype.addRampGradient=function(i,a){this._rampGradients||(this._rampGradients=[]);var n=new t.Color3Gradient;return n.gradient=i,n.color=a,this._rampGradients.push(n),this._rampGradients.sort(function(s,o){return s.gradient<o.gradient?-1:s.gradient>o.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},r.prototype.removeRampGradient=function(i){return this._removeGradientAndTexture(i,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},r.prototype.addColorGradient=function(i,a,n){this._colorGradients||(this._colorGradients=[]);var s=new t.ColorGradient;return s.gradient=i,s.color1=a,s.color2=n,this._colorGradients.push(s),this._colorGradients.sort(function(o,l){return o.gradient<l.gradient?-1:o.gradient>l.gradient?1:0}),this},r.prototype.removeColorGradient=function(i){if(!this._colorGradients)return this;for(var a=0,n=0,s=this._colorGradients;n<s.length;n++){var o=s[n];if(o.gradient===i){this._colorGradients.splice(a,1);break}a++}return this},r.prototype._fetchR=function(i,a,n,s,o){i=Math.abs(i)*.5+.5,a=Math.abs(a)*.5+.5;var l=i*n%n|0,u=a*s%s|0,h=(l+u*n)*4;return o[h]/255},r.prototype._reset=function(){this._resetEffect()},r.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},r.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),(!this._isBillboardBased||this.billboardMode===r.BILLBOARDMODE_STRETCHED)&&(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var i=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new t.Buffer(i,this._vertexData,!0,this._vertexBufferSize);var a=0,n=this._vertexBuffer.createVertexBuffer(t.VertexBuffer.PositionKind,a,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.VertexBuffer.PositionKind]=n,a+=3;var s=this._vertexBuffer.createVertexBuffer(t.VertexBuffer.ColorKind,a,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[t.VertexBuffer.ColorKind]=s,a+=4;var o=this._vertexBuffer.createVertexBuffer("angle",a,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o,a+=1;var l=this._vertexBuffer.createVertexBuffer("size",a,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=l,a+=2,this._isAnimationSheetEnabled){var u=this._vertexBuffer.createVertexBuffer("cellIndex",a,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=u,a+=1}if(!this._isBillboardBased||this.billboardMode===r.BILLBOARDMODE_STRETCHED){var h=this._vertexBuffer.createVertexBuffer("direction",a,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=h,a+=3}if(this._useRampGradients){var d=this._vertexBuffer.createVertexBuffer("remapData",a,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=d,a+=4}var p;if(this._useInstancing){var m=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new t.Buffer(i,m,!1,2),p=this._spriteBuffer.createVertexBuffer("offset",0,2)}else p=this._vertexBuffer.createVertexBuffer("offset",a,2,this._vertexBufferSize,this._useInstancing),a+=2;this._vertexBuffers.offset=p},r.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var i=[],a=0,n=0;n<this._capacity;n++)i.push(a),i.push(a+1),i.push(a+2),i.push(a),i.push(a+2),i.push(a+3),a+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(i)}},r.prototype.getCapacity=function(){return this._capacity},r.prototype.isAlive=function(){return this._alive},r.prototype.isStarted=function(){return this._started},r.prototype._prepareSubEmitterInternalArray=function(){var i=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(a){a instanceof r?i._subEmitters.push([new t.SubEmitter(a)]):a instanceof t.SubEmitter?i._subEmitters.push([a]):a instanceof Array&&i._subEmitters.push(a)})},r.prototype.start=function(i){var a=this;if(i===void 0&&(i=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(i){setTimeout(function(){a.start(0)},i);return}if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&this._subEmitters.length!=0&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof t.AbstractMesh&&this.emitter.computeWorldMatrix(!0);var n=this.noiseTexture;if(n&&n.onGeneratedObservable)n.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var o=0;o<a.preWarmCycles;o++)a.animate(!0),n.render()})});else for(var s=0;s<this.preWarmCycles;s++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)},r.prototype.stop=function(i){i===void 0&&(i=!0),this._stopped=!0,i&&this._stopSubEmitters()},r.prototype.reset=function(){this._stockParticles=[],this._particles=[]},r.prototype._appendParticleVertex=function(i,a,n,s){var o=i*this._vertexBufferSize;this._vertexData[o++]=a.position.x,this._vertexData[o++]=a.position.y,this._vertexData[o++]=a.position.z,this._vertexData[o++]=a.color.r,this._vertexData[o++]=a.color.g,this._vertexData[o++]=a.color.b,this._vertexData[o++]=a.color.a,this._vertexData[o++]=a.angle,this._vertexData[o++]=a.scale.x*a.size,this._vertexData[o++]=a.scale.y*a.size,this._isAnimationSheetEnabled&&(this._vertexData[o++]=a.cellIndex),this._isBillboardBased?this.billboardMode===r.BILLBOARDMODE_STRETCHED&&(this._vertexData[o++]=a.direction.x,this._vertexData[o++]=a.direction.y,this._vertexData[o++]=a.direction.z):a._initialDirection?(this._vertexData[o++]=a._initialDirection.x,this._vertexData[o++]=a._initialDirection.y,this._vertexData[o++]=a._initialDirection.z):(this._vertexData[o++]=a.direction.x,this._vertexData[o++]=a.direction.y,this._vertexData[o++]=a.direction.z),this._useRampGradients&&(this._vertexData[o++]=a.remapData.x,this._vertexData[o++]=a.remapData.y,this._vertexData[o++]=a.remapData.z,this._vertexData[o++]=a.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(n===0?n=this._epsilon:n===1&&(n=1-this._epsilon),s===0?s=this._epsilon:s===1&&(s=1-this._epsilon)),this._vertexData[o++]=n,this._vertexData[o++]=s)},r.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(i){i.stop(!0)}),this.activeSubSystems=new Array)},r.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var i=this._rootParticleSystem.activeSubSystems.indexOf(this);i!==-1&&this._rootParticleSystem.activeSubSystems.splice(i,1),this._rootParticleSystem=null}},r.prototype._update=function(i){var a=this;if(this._alive=this._particles.length>0,this.emitter.position){var n=this.emitter;this._emitterWorldMatrix=n.getWorldMatrix()}else{var s=this.emitter;this._emitterWorldMatrix=t.Matrix.Translation(s.x,s.y,s.z)}this.updateFunction(this._particles);for(var o,l=function(){if(u._particles.length===u._capacity)return"break";o=u._createParticle(),u._particles.push(o);var m=t.Scalar.RandomRange(u.minEmitPower,u.maxEmitPower);if(u.startPositionFunction?u.startPositionFunction(u._emitterWorldMatrix,o.position,o):u.particleEmitterType.startPositionFunction(u._emitterWorldMatrix,o.position,o),u.startDirectionFunction?u.startDirectionFunction(u._emitterWorldMatrix,o.direction,o):u.particleEmitterType.startDirectionFunction(u._emitterWorldMatrix,o.direction,o),m===0?o._initialDirection?o._initialDirection.copyFrom(o.direction):o._initialDirection=o.direction.clone():o._initialDirection=null,o.direction.scaleInPlace(m),u.targetStopDuration&&u._lifeTimeGradients&&u._lifeTimeGradients.length>0){var _=t.Scalar.Clamp(u._actualFrame/u.targetStopDuration);t.Tools.GetCurrentGradient(_,u._lifeTimeGradients,function(S,P,x){var R=S,w=P,I=R.getFactor(),F=w.getFactor(),k=(_-R.gradient)/(w.gradient-R.gradient);o.lifeTime=t.Scalar.Lerp(I,F,k)})}else o.lifeTime=t.Scalar.RandomRange(u.minLifeTime,u.maxLifeTime);if(!u._sizeGradients||u._sizeGradients.length===0?o.size=t.Scalar.RandomRange(u.minSize,u.maxSize):(o._currentSizeGradient=u._sizeGradients[0],o._currentSize1=o._currentSizeGradient.getFactor(),o.size=o._currentSize1,u._sizeGradients.length>1?o._currentSize2=u._sizeGradients[1].getFactor():o._currentSize2=o._currentSize1),o.scale.copyFromFloats(t.Scalar.RandomRange(u.minScaleX,u.maxScaleX),t.Scalar.RandomRange(u.minScaleY,u.maxScaleY)),u._startSizeGradients&&u._startSizeGradients[0]&&u.targetStopDuration){var v=u._actualFrame/u.targetStopDuration;t.Tools.GetCurrentGradient(v,u._startSizeGradients,function(S,P,x){S!==a._currentStartSizeGradient&&(a._currentStartSize1=a._currentStartSize2,a._currentStartSize2=P.getFactor(),a._currentStartSizeGradient=S);var R=t.Scalar.Lerp(a._currentStartSize1,a._currentStartSize2,x);o.scale.scaleInPlace(R)})}!u._angularSpeedGradients||u._angularSpeedGradients.length===0?o.angularSpeed=t.Scalar.RandomRange(u.minAngularSpeed,u.maxAngularSpeed):(o._currentAngularSpeedGradient=u._angularSpeedGradients[0],o.angularSpeed=o._currentAngularSpeedGradient.getFactor(),o._currentAngularSpeed1=o.angularSpeed,u._angularSpeedGradients.length>1?o._currentAngularSpeed2=u._angularSpeedGradients[1].getFactor():o._currentAngularSpeed2=o._currentAngularSpeed1),o.angle=t.Scalar.RandomRange(u.minInitialRotation,u.maxInitialRotation),u._velocityGradients&&u._velocityGradients.length>0&&(o._currentVelocityGradient=u._velocityGradients[0],o._currentVelocity1=o._currentVelocityGradient.getFactor(),u._velocityGradients.length>1?o._currentVelocity2=u._velocityGradients[1].getFactor():o._currentVelocity2=o._currentVelocity1),u._limitVelocityGradients&&u._limitVelocityGradients.length>0&&(o._currentLimitVelocityGradient=u._limitVelocityGradients[0],o._currentLimitVelocity1=o._currentLimitVelocityGradient.getFactor(),u._limitVelocityGradients.length>1?o._currentLimitVelocity2=u._limitVelocityGradients[1].getFactor():o._currentLimitVelocity2=o._currentLimitVelocity1),u._dragGradients&&u._dragGradients.length>0&&(o._currentDragGradient=u._dragGradients[0],o._currentDrag1=o._currentDragGradient.getFactor(),u._dragGradients.length>1?o._currentDrag2=u._dragGradients[1].getFactor():o._currentDrag2=o._currentDrag1),!u._colorGradients||u._colorGradients.length===0?(h=t.Scalar.RandomRange(0,1),t.Color4.LerpToRef(u.color1,u.color2,h,o.color),u.colorDead.subtractToRef(o.color,u._colorDiff),u._colorDiff.scaleToRef(1/o.lifeTime,o.colorStep)):(o._currentColorGradient=u._colorGradients[0],o._currentColorGradient.getColorToRef(o.color),o._currentColor1.copyFrom(o.color),u._colorGradients.length>1?u._colorGradients[1].getColorToRef(o._currentColor2):o._currentColor2.copyFrom(o.color)),u._isAnimationSheetEnabled&&(o._initialStartSpriteCellID=u.startSpriteCellID,o._initialEndSpriteCellID=u.endSpriteCellID),o.direction.addInPlace(u._inheritedVelocityOffset),u._useRampGradients&&(o.remapData=new t.Vector4(0,1,0,1)),u.noiseTexture&&(o._randomNoiseCoordinates1?(o._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(o._randomNoiseCoordinates1=new t.Vector3(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2=new t.Vector3(Math.random(),Math.random(),Math.random()))),o._inheritParticleInfoToSubEmitters()},u=this,h,d=0;d<i;d++){var p=l();if(p==="break")break}},r._GetAttributeNamesOrOptions=function(i,a,n){i===void 0&&(i=!1),a===void 0&&(a=!1),n===void 0&&(n=!1);var s=[t.VertexBuffer.PositionKind,t.VertexBuffer.ColorKind,"angle","offset","size"];return i&&s.push("cellIndex"),a||s.push("direction"),n&&s.push("remapData"),s},r._GetEffectCreationOptions=function(i){i===void 0&&(i=!1);var a=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMask","translationPivot","eyePosition"];return i&&a.push("particlesInfos"),a},r.prototype._getEffect=function(i){if(this._customEffect)return this._customEffect;var a=[];if(this._scene.clipPlane&&a.push("#define CLIPPLANE"),this._scene.clipPlane2&&a.push("#define CLIPPLANE2"),this._scene.clipPlane3&&a.push("#define CLIPPLANE3"),this._scene.clipPlane4&&a.push("#define CLIPPLANE4"),this._isAnimationSheetEnabled&&a.push("#define ANIMATESHEET"),i===r.BLENDMODE_MULTIPLY&&a.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&a.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(a.push("#define BILLBOARD"),this.billboardMode){case r.BILLBOARDMODE_Y:a.push("#define BILLBOARDY");break;case r.BILLBOARDMODE_STRETCHED:a.push("#define BILLBOARDSTRETCHED");break;case r.BILLBOARDMODE_ALL:default:break}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),a.push(this._imageProcessingConfigurationDefines.toString()));var n=a.join(`
`);if(this._cachedDefines!==n){this._cachedDefines=n;var s=r._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==r.BILLBOARDMODE_STRETCHED,this._useRampGradients),o=r._GetEffectCreationOptions(this._isAnimationSheetEnabled),l=["diffuseSampler","rampSampler"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareUniforms(o,this._imageProcessingConfigurationDefines),t.ImageProcessingConfiguration.PrepareSamplers(l,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",s,o,l,n)}return this._effect},r.prototype.animate=function(i){var a=this;if(i===void 0&&(i=!1),!!this._started){if(!i){if(!this.isReady()||this._currentRenderId===this._scene.getRenderId())return;this._currentRenderId=this._scene.getRenderId()}this._scaledUpdateSpeed=this.updateSpeed*(i?this.preWarmStepOffset:this._scene.getAnimationRatio());var n;if(this.manualEmitCount>-1)n=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var s=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var o=this._actualFrame/this.targetStopDuration;t.Tools.GetCurrentGradient(o,this._emitRateGradients,function(d,p,m){d!==a._currentEmitRateGradient&&(a._currentEmitRate1=a._currentEmitRate2,a._currentEmitRate2=p.getFactor(),a._currentEmitRateGradient=d),s=t.Scalar.Lerp(a._currentEmitRate1,a._currentEmitRate2,m)})}n=s*this._scaledUpdateSpeed>>0,this._newPartsExcess+=s*this._scaledUpdateSpeed-n}if(this._newPartsExcess>1&&(n+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?n=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(n),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!i){for(var l=0,u=0;u<this._particles.length;u++){var h=this._particles[u];this._appendParticleVertices(l,h),l+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}this.manualEmitCount===0&&this.disposeOnStop&&this.stop()}},r.prototype._appendParticleVertices=function(i,a){this._appendParticleVertex(i++,a,0,0),this._useInstancing||(this._appendParticleVertex(i++,a,1,0),this._appendParticleVertex(i++,a,1,1),this._appendParticleVertex(i++,a,0,1))},r.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},r.prototype.isReady=function(){if(!this.emitter||!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==r.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else if(!this._getEffect(r.BLENDMODE_MULTIPLY).isReady()||!this._getEffect(r.BLENDMODE_ADD).isReady())return!1;return!0},r.prototype._render=function(i){var a=this._getEffect(i),n=this._scene.getEngine();n.enableEffect(a);var s=this._scene.getViewMatrix();if(a.setTexture("diffuseSampler",this.particleTexture),a.setMatrix("view",s),a.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var o=this.particleTexture.getBaseSize();a.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(a.setVector2("translationPivot",this.translationPivot),a.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var l=this._scene.activeCamera;a.setVector3("eyePosition",l.globalPosition)}if(this._rampGradientsTexture&&a.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var u=s.clone();u.invert(),a.setMatrix("invView",u),t.MaterialHelper.BindClipPlane(a,this._scene)}switch(n.bindBuffers(this._vertexBuffers,this._indexBuffer,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(a),i){case r.BLENDMODE_ADD:n.setAlphaMode(t.Engine.ALPHA_ADD);break;case r.BLENDMODE_ONEONE:n.setAlphaMode(t.Engine.ALPHA_ONEONE);break;case r.BLENDMODE_STANDARD:n.setAlphaMode(t.Engine.ALPHA_COMBINE);break;case r.BLENDMODE_MULTIPLY:n.setAlphaMode(t.Engine.ALPHA_MULTIPLY);break}return this._useInstancing?n.drawArraysType(t.Material.TriangleFanDrawMode,0,4,this._particles.length):n.drawElementsType(t.Material.TriangleFillMode,0,this._particles.length*6),this._particles.length},r.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var i=this._scene.getEngine();i.setState(!1),this.forceDepthWrite&&i.setDepthWrite(!0);var a=0;return this.blendMode===r.BLENDMODE_MULTIPLYADD&&(a=this._render(r.BLENDMODE_MULTIPLY)+this._render(r.BLENDMODE_ADD)),a=this._render(this.blendMode),i.unbindInstanceAttributes(),i.setAlphaMode(t.Engine.ALPHA_DISABLE),a},r.prototype.dispose=function(i){if(i===void 0&&(i=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),i&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),i&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var o=0;o<this._subEmitters.length;o++)for(var a=0,n=this._subEmitters[o];a<n.length;a++){var s=n[a];s.dispose()}this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0);var o=this._scene.particleSystems.indexOf(this);o>-1&&this._scene.particleSystems.splice(o,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},r.prototype.clone=function(i,a){var n=null,s=null;if(this.customShader!=null){s=this.customShader;var o=s.shaderOptions.defines.length>0?s.shaderOptions.defines.join(`
`):"";n=this._scene.getEngine().createEffectForParticles(s.shaderPath.fragmentElement,s.shaderOptions.uniforms,s.shaderOptions.samplers,o)}else this._customEffect&&(n=this._customEffect);var l=new r(i,this._capacity,this._scene,n);return l.customShader=s,t.Tools.DeepCopy(this,l,["particles","customShader","noiseTexture"]),a===void 0&&(a=this.emitter),l.noiseTexture=this.noiseTexture,l.emitter=a,this.particleTexture&&(l.particleTexture=new t.Texture(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach(function(u){l.addColorGradient(u.gradient,u.color1,u.color2)}),this._dragGradients&&this._dragGradients.forEach(function(u){l.addDragGradient(u.gradient,u.factor1,u.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(u){l.addAngularSpeedGradient(u.gradient,u.factor1,u.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(u){l.addEmitRateGradient(u.gradient,u.factor1,u.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(u){l.addLifeTimeGradient(u.gradient,u.factor1,u.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(u){l.addLimitVelocityGradient(u.gradient,u.factor1,u.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(u){l.addSizeGradient(u.gradient,u.factor1,u.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(u){l.addStartSizeGradient(u.gradient,u.factor1,u.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(u){l.addVelocityGradient(u.gradient,u.factor1,u.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(u){l.addRampGradient(u.gradient,u.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(u){l.addColorRemapGradient(u.gradient,u.factor1,u.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(u){l.addAlphaRemapGradient(u.gradient,u.factor1,u.factor2)}),this.preventAutoStart||l.start(),l},r.prototype.serialize=function(){var i={};if(r._Serialize(i,this),i.textureMask=this.textureMask.asArray(),i.customShader=this.customShader,i.preventAutoStart=this.preventAutoStart,this.subEmitters){i.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var a=0,n=this._subEmitters;a<n.length;a++){for(var s=n[a],o=[],l=0,u=s;l<u.length;l++){var h=u[l];o.push(h.serialize())}i.subEmitters.push(o)}}return i},r._Serialize=function(i,a){if(i.name=a.name,i.id=a.id,i.capacity=a.getCapacity(),a.emitter.position){var n=a.emitter;i.emitterId=n.id}else{var s=a.emitter;i.emitter=s.asArray()}a.particleEmitterType&&(i.particleEmitterType=a.particleEmitterType.serialize()),a.particleTexture&&(i.textureName=a.particleTexture.name,i.invertY=a.particleTexture._invertY),t.Animation.AppendSerializedAnimations(a,i),i.beginAnimationOnStart=a.beginAnimationOnStart,i.beginAnimationFrom=a.beginAnimationFrom,i.beginAnimationTo=a.beginAnimationTo,i.beginAnimationLoop=a.beginAnimationLoop,i.startDelay=a.startDelay,i.renderingGroupId=a.renderingGroupId,i.isBillboardBased=a.isBillboardBased,i.billboardMode=a.billboardMode,i.minAngularSpeed=a.minAngularSpeed,i.maxAngularSpeed=a.maxAngularSpeed,i.minSize=a.minSize,i.maxSize=a.maxSize,i.minScaleX=a.minScaleX,i.maxScaleX=a.maxScaleX,i.minScaleY=a.minScaleY,i.maxScaleY=a.maxScaleY,i.minEmitPower=a.minEmitPower,i.maxEmitPower=a.maxEmitPower,i.minLifeTime=a.minLifeTime,i.maxLifeTime=a.maxLifeTime,i.emitRate=a.emitRate,i.gravity=a.gravity.asArray(),i.noiseStrength=a.noiseStrength.asArray(),i.color1=a.color1.asArray(),i.color2=a.color2.asArray(),i.colorDead=a.colorDead.asArray(),i.updateSpeed=a.updateSpeed,i.targetStopDuration=a.targetStopDuration,i.blendMode=a.blendMode,i.preWarmCycles=a.preWarmCycles,i.preWarmStepOffset=a.preWarmStepOffset,i.minInitialRotation=a.minInitialRotation,i.maxInitialRotation=a.maxInitialRotation,i.startSpriteCellID=a.startSpriteCellID,i.endSpriteCellID=a.endSpriteCellID,i.spriteCellChangeSpeed=a.spriteCellChangeSpeed,i.spriteCellWidth=a.spriteCellWidth,i.spriteCellHeight=a.spriteCellHeight,i.spriteRandomStartCell=a.spriteRandomStartCell,i.isAnimationSheetEnabled=a.isAnimationSheetEnabled;var o=a.getColorGradients();if(o){i.colorGradients=[];for(var l=0,u=o;l<u.length;l++){var h=u[l],d={gradient:h.gradient,color1:h.color1.asArray()};h.color2&&(d.color2=h.color2.asArray()),i.colorGradients.push(d)}}var p=a.getRampGradients();if(p){i.rampGradients=[];for(var m=0,_=p;m<_.length;m++){var v=_[m],d={gradient:v.gradient,color:v.color.asArray()};i.rampGradients.push(d)}i.useRampGradients=a.useRampGradients}var S=a.getColorRemapGradients();if(S){i.colorRemapGradients=[];for(var P=0,x=S;P<x.length;P++){var R=x[P],d={gradient:R.gradient,factor1:R.factor1};R.factor2!==void 0&&(d.factor2=R.factor2),i.colorRemapGradients.push(d)}}var w=a.getAlphaRemapGradients();if(w){i.alphaRemapGradients=[];for(var I=0,F=w;I<F.length;I++){var k=F[I],d={gradient:k.gradient,factor1:k.factor1};k.factor2!==void 0&&(d.factor2=k.factor2),i.alphaRemapGradients.push(d)}}var E=a.getSizeGradients();if(E){i.sizeGradients=[];for(var g=0,y=E;g<y.length;g++){var M=y[g],d={gradient:M.gradient,factor1:M.factor1};M.factor2!==void 0&&(d.factor2=M.factor2),i.sizeGradients.push(d)}}var C=a.getAngularSpeedGradients();if(C){i.angularSpeedGradients=[];for(var D=0,V=C;D<V.length;D++){var G=V[D],d={gradient:G.gradient,factor1:G.factor1};G.factor2!==void 0&&(d.factor2=G.factor2),i.angularSpeedGradients.push(d)}}var U=a.getVelocityGradients();if(U){i.velocityGradients=[];for(var z=0,H=U;z<H.length;z++){var W=H[z],d={gradient:W.gradient,factor1:W.factor1};W.factor2!==void 0&&(d.factor2=W.factor2),i.velocityGradients.push(d)}}var X=a.getDragGradients();if(X){i.dragyGradients=[];for(var K=0,j=X;K<j.length;K++){var ee=j[K],d={gradient:ee.gradient,factor1:ee.factor1};ee.factor2!==void 0&&(d.factor2=ee.factor2),i.dragGradients.push(d)}}var $=a.getEmitRateGradients();if($){i.emitRateGradients=[];for(var L=0,Q=$;L<Q.length;L++){var J=Q[L],d={gradient:J.gradient,factor1:J.factor1};J.factor2!==void 0&&(d.factor2=J.factor2),i.emitRateGradients.push(d)}}var te=a.getStartSizeGradients();if(te){i.startSizeGradients=[];for(var re=0,le=te;re<le.length;re++){var ie=le[re],d={gradient:ie.gradient,factor1:ie.factor1};ie.factor2!==void 0&&(d.factor2=ie.factor2),i.startSizeGradients.push(d)}}var ce=a.getLifeTimeGradients();if(ce){i.lifeTimeGradients=[];for(var de=0,_e=ce;de<_e.length;de++){var ge=_e[de],d={gradient:ge.gradient,factor1:ge.factor1};ge.factor2!==void 0&&(d.factor2=ge.factor2),i.lifeTimeGradients.push(d)}}var me=a.getLimitVelocityGradients();if(me){i.limitVelocityGradients=[];for(var ve=0,be=me;ve<be.length;ve++){var Te=be[ve],d={gradient:Te.gradient,factor1:Te.factor1};Te.factor2!==void 0&&(d.factor2=Te.factor2),i.limitVelocityGradients.push(d)}i.limitVelocityDamping=a.limitVelocityDamping}a.noiseTexture&&(i.noiseTexture=a.noiseTexture.serialize())},r._Parse=function(i,a,n,s){if(i.textureName&&(a.particleTexture=new t.Texture(s+i.textureName,n,!1,i.invertY!==void 0?i.invertY:!0),a.particleTexture.name=i.textureName),!i.emitterId&&i.emitterId!==0&&i.emitter===void 0?a.emitter=t.Vector3.Zero():i.emitterId?a.emitter=n.getLastMeshByID(i.emitterId):a.emitter=t.Vector3.FromArray(i.emitter),i.renderingGroupId!==void 0&&(a.renderingGroupId=i.renderingGroupId),i.isBillboardBased!==void 0&&(a.isBillboardBased=i.isBillboardBased),i.billboardMode!==void 0&&(a.billboardMode=i.billboardMode),i.animations){for(var o=0;o<i.animations.length;o++){var l=i.animations[o];a.animations.push(t.Animation.Parse(l))}a.beginAnimationOnStart=i.beginAnimationOnStart,a.beginAnimationFrom=i.beginAnimationFrom,a.beginAnimationTo=i.beginAnimationTo,a.beginAnimationLoop=i.beginAnimationLoop}if(i.autoAnimate&&n.beginAnimation(a,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1),a.startDelay=i.startDelay|0,a.minAngularSpeed=i.minAngularSpeed,a.maxAngularSpeed=i.maxAngularSpeed,a.minSize=i.minSize,a.maxSize=i.maxSize,i.minScaleX&&(a.minScaleX=i.minScaleX,a.maxScaleX=i.maxScaleX,a.minScaleY=i.minScaleY,a.maxScaleY=i.maxScaleY),i.preWarmCycles!==void 0&&(a.preWarmCycles=i.preWarmCycles,a.preWarmStepOffset=i.preWarmStepOffset),i.minInitialRotation!==void 0&&(a.minInitialRotation=i.minInitialRotation,a.maxInitialRotation=i.maxInitialRotation),a.minLifeTime=i.minLifeTime,a.maxLifeTime=i.maxLifeTime,a.minEmitPower=i.minEmitPower,a.maxEmitPower=i.maxEmitPower,a.emitRate=i.emitRate,a.gravity=t.Vector3.FromArray(i.gravity),i.noiseStrength&&(a.noiseStrength=t.Vector3.FromArray(i.noiseStrength)),a.color1=t.Color4.FromArray(i.color1),a.color2=t.Color4.FromArray(i.color2),a.colorDead=t.Color4.FromArray(i.colorDead),a.updateSpeed=i.updateSpeed,a.targetStopDuration=i.targetStopDuration,a.blendMode=i.blendMode,i.colorGradients)for(var u=0,h=i.colorGradients;u<h.length;u++){var d=h[u];a.addColorGradient(d.gradient,t.Color4.FromArray(d.color1),d.color2?t.Color4.FromArray(d.color2):void 0)}if(i.rampGradients){for(var p=0,m=i.rampGradients;p<m.length;p++){var _=m[p];a.addRampGradient(_.gradient,t.Color3.FromArray(_.color))}a.useRampGradients=i.useRampGradients}if(i.colorRemapGradients)for(var v=0,S=i.colorRemapGradients;v<S.length;v++){var P=S[v];a.addColorRemapGradient(P.gradient,P.factor1!==void 0?P.factor1:P.factor,P.factor2)}if(i.alphaRemapGradients)for(var x=0,R=i.alphaRemapGradients;x<R.length;x++){var w=R[x];a.addAlphaRemapGradient(w.gradient,w.factor1!==void 0?w.factor1:w.factor,w.factor2)}if(i.sizeGradients)for(var I=0,F=i.sizeGradients;I<F.length;I++){var k=F[I];a.addSizeGradient(k.gradient,k.factor1!==void 0?k.factor1:k.factor,k.factor2)}if(i.sizeGradients)for(var E=0,g=i.sizeGradients;E<g.length;E++){var k=g[E];a.addSizeGradient(k.gradient,k.factor1!==void 0?k.factor1:k.factor,k.factor2)}if(i.angularSpeedGradients)for(var y=0,M=i.angularSpeedGradients;y<M.length;y++){var C=M[y];a.addAngularSpeedGradient(C.gradient,C.factor1!==void 0?C.factor1:C.factor,C.factor2)}if(i.velocityGradients)for(var D=0,V=i.velocityGradients;D<V.length;D++){var G=V[D];a.addVelocityGradient(G.gradient,G.factor1!==void 0?G.factor1:G.factor,G.factor2)}if(i.dragGradients)for(var U=0,z=i.dragGradients;U<z.length;U++){var H=z[U];a.addDragGradient(H.gradient,H.factor1!==void 0?H.factor1:H.factor,H.factor2)}if(i.emitRateGradients)for(var W=0,X=i.emitRateGradients;W<X.length;W++){var K=X[W];a.addEmitRateGradient(K.gradient,K.factor1!==void 0?K.factor1:K.factor,K.factor2)}if(i.startSizeGradients)for(var j=0,ee=i.startSizeGradients;j<ee.length;j++){var $=ee[j];a.addStartSizeGradient($.gradient,$.factor1!==void 0?$.factor1:$.factor,$.factor2)}if(i.lifeTimeGradients)for(var L=0,Q=i.lifeTimeGradients;L<Q.length;L++){var J=Q[L];a.addLifeTimeGradient(J.gradient,J.factor1!==void 0?J.factor1:J.factor,J.factor2)}if(i.limitVelocityGradients){for(var te=0,re=i.limitVelocityGradients;te<re.length;te++){var le=re[te];a.addLimitVelocityGradient(le.gradient,le.factor1!==void 0?le.factor1:le.factor,le.factor2)}a.limitVelocityDamping=i.limitVelocityDamping}i.noiseTexture&&(a.noiseTexture=t.ProceduralTexture.Parse(i.noiseTexture,n,s));var ie;if(i.particleEmitterType){switch(i.particleEmitterType.type){case"SphereParticleEmitter":ie=new t.SphereParticleEmitter;break;case"SphereDirectedParticleEmitter":ie=new t.SphereDirectedParticleEmitter;break;case"ConeEmitter":case"ConeParticleEmitter":ie=new t.ConeParticleEmitter;break;case"CylinderParticleEmitter":ie=new t.CylinderParticleEmitter;break;case"HemisphericParticleEmitter":ie=new t.HemisphericParticleEmitter;break;case"BoxEmitter":case"BoxParticleEmitter":default:ie=new t.BoxParticleEmitter;break}ie.parse(i.particleEmitterType)}else ie=new t.BoxParticleEmitter,ie.parse(i);a.particleEmitterType=ie,a.startSpriteCellID=i.startSpriteCellID,a.endSpriteCellID=i.endSpriteCellID,a.spriteCellWidth=i.spriteCellWidth,a.spriteCellHeight=i.spriteCellHeight,a.spriteCellChangeSpeed=i.spriteCellChangeSpeed,a.spriteRandomStartCell=i.spriteRandomStartCell},r.Parse=function(i,a,n,s){s===void 0&&(s=!1);var o=i.name,l=null,u=null;if(i.customShader){u=i.customShader;var h=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join(`
`):"";l=a.getEngine().createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,h)}var d=new r(o,i.capacity,a,l,i.isAnimationSheetEnabled);if(d.customShader=u,i.id&&(d.id=i.id),i.subEmitters){d.subEmitters=[];for(var p=0,m=i.subEmitters;p<m.length;p++){for(var _=m[p],v=[],S=0,P=_;S<P.length;S++){var x=P[S];v.push(t.SubEmitter.Parse(x,a,n))}d.subEmitters.push(v)}}return r._Parse(i,d,a,n),d.textureMask=t.Color4.FromArray(i.textureMask),i.preventAutoStart&&(d.preventAutoStart=i.preventAutoStart),!s&&!d.preventAutoStart&&d.start(),d},r.BILLBOARDMODE_Y=2,r.BILLBOARDMODE_ALL=7,r.BILLBOARDMODE_STRETCHED=8,r}(t.BaseParticleSystem);t.ParticleSystem=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.direction1=new t.Vector3(0,1,0),this.direction2=new t.Vector3(0,1,0),this.minEmitBox=new t.Vector3(-.5,-.5,-.5),this.maxEmitBox=new t.Vector3(.5,.5,.5)}return c.prototype.startDirectionFunction=function(r,i,a){var n=t.Scalar.RandomRange(this.direction1.x,this.direction2.x),s=t.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=t.Scalar.RandomRange(this.direction1.z,this.direction2.z);t.Vector3.TransformNormalFromFloatsToRef(n,s,o,r,i)},c.prototype.startPositionFunction=function(r,i,a){var n=t.Scalar.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),s=t.Scalar.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),o=t.Scalar.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);t.Vector3.TransformCoordinatesFromFloatsToRef(n,s,o,r,i)},c.prototype.clone=function(){var r=new c;return t.Tools.DeepCopy(this,r),r},c.prototype.applyToShader=function(r){r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2),r.setVector3("minEmitBox",this.minEmitBox),r.setVector3("maxEmitBox",this.maxEmitBox)},c.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},c.prototype.getClassName=function(){return"BoxParticleEmitter"},c.prototype.serialize=function(){var r={};return r.type=this.getClassName(),r.direction1=this.direction1.asArray(),r.direction2=this.direction2.asArray(),r.minEmitBox=this.minEmitBox.asArray(),r.maxEmitBox=this.maxEmitBox.asArray(),r},c.prototype.parse=function(r){t.Vector3.FromArrayToRef(r.direction1,0,this.direction1),t.Vector3.FromArrayToRef(r.direction2,0,this.direction2),t.Vector3.FromArrayToRef(r.minEmitBox,0,this.minEmitBox),t.Vector3.FromArrayToRef(r.maxEmitBox,0,this.maxEmitBox)},c}();t.BoxParticleEmitter=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n,s){i===void 0&&(i=1),a===void 0&&(a=1),n===void 0&&(n=1),s===void 0&&(s=0),this.radius=i,this.height=a,this.radiusRange=n,this.directionRandomizer=s}return r.prototype.startDirectionFunction=function(i,a,n){var s=n.position.subtract(i.getTranslation()).normalize(),o=t.Scalar.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),l=Math.atan2(s.x,s.z);l+=t.Scalar.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,s.y=o,s.x=Math.sin(l),s.z=Math.cos(l),s.normalize(),t.Vector3.TransformNormalFromFloatsToRef(s.x,s.y,s.z,i,a)},r.prototype.startPositionFunction=function(i,a,n){var s=t.Scalar.RandomRange(-this.height/2,this.height/2),o=t.Scalar.RandomRange(0,2*Math.PI),l=t.Scalar.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),u=Math.sqrt(l)*this.radius,h=u*Math.cos(o),d=u*Math.sin(o);t.Vector3.TransformCoordinatesFromFloatsToRef(h,s,d,i,a)},r.prototype.clone=function(){var i=new r(this.radius,this.directionRandomizer);return t.Tools.DeepCopy(this,i),i},r.prototype.applyToShader=function(i){i.setFloat("radius",this.radius),i.setFloat("height",this.height),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)},r.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},r.prototype.getClassName=function(){return"CylinderParticleEmitter"},r.prototype.serialize=function(){var i={};return i.type=this.getClassName(),i.radius=this.radius,i.height=this.height,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i},r.prototype.parse=function(i){this.radius=i.radius,this.height=i.height,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer},r}();t.CylinderParticleEmitter=f;var c=function(r){N(i,r);function i(a,n,s,o,l){a===void 0&&(a=1),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=new t.Vector3(0,1,0)),l===void 0&&(l=new t.Vector3(0,1,0));var u=r.call(this,a,n,s)||this;return u.direction1=o,u.direction2=l,u}return i.prototype.startDirectionFunction=function(a,n,s){var o=t.Scalar.RandomRange(this.direction1.x,this.direction2.x),l=t.Scalar.RandomRange(this.direction1.y,this.direction2.y),u=t.Scalar.RandomRange(this.direction1.z,this.direction2.z);t.Vector3.TransformNormalFromFloatsToRef(o,l,u,a,n)},i.prototype.clone=function(){var a=new i(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return t.Tools.DeepCopy(this,a),a},i.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("height",this.height),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return`#define CYLINDEREMITTER
#define DIRECTEDCYLINDEREMITTER`},i.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},i.prototype.serialize=function(){var a=r.prototype.serialize.call(this);return a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a},i.prototype.parse=function(a){r.prototype.parse.call(this,a),this.direction1.copyFrom(a.direction1),this.direction2.copyFrom(a.direction2)},i}(f);t.CylinderDirectedParticleEmitter=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){r===void 0&&(r=1),i===void 0&&(i=Math.PI),a===void 0&&(a=0),this.directionRandomizer=a,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=i,this.radius=r}return Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(r){this._radius=r,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"angle",{get:function(){return this._angle},set:function(r){this._angle=r,this._buildHeight()},enumerable:!0,configurable:!0}),c.prototype._buildHeight=function(){this._angle!==0?this._height=this._radius/Math.tan(this._angle/2):this._height=1},c.prototype.startDirectionFunction=function(r,i,a){if(Math.abs(Math.cos(this._angle))===1)t.Vector3.TransformNormalFromFloatsToRef(0,1,0,r,i);else{var n=a.position.subtract(r.getTranslation()).normalize(),s=t.Scalar.RandomRange(0,this.directionRandomizer),o=t.Scalar.RandomRange(0,this.directionRandomizer),l=t.Scalar.RandomRange(0,this.directionRandomizer);n.x+=s,n.y+=o,n.z+=l,n.normalize(),t.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,r,i)}},c.prototype.startPositionFunction=function(r,i,a){var n=t.Scalar.RandomRange(0,Math.PI*2),s;this.emitFromSpawnPointOnly?s=1e-4:(s=t.Scalar.RandomRange(0,this.heightRange),s=1-s*s);var o=this._radius-t.Scalar.RandomRange(0,this._radius*this.radiusRange);o=o*s;var l=o*Math.sin(n),u=o*Math.cos(n),h=s*this._height;t.Vector3.TransformCoordinatesFromFloatsToRef(l,h,u,r,i)},c.prototype.clone=function(){var r=new c(this._radius,this._angle,this.directionRandomizer);return t.Tools.DeepCopy(this,r),r},c.prototype.applyToShader=function(r){r.setFloat2("radius",this._radius,this.radiusRange),r.setFloat("coneAngle",this._angle),r.setFloat2("height",this._height,this.heightRange),r.setFloat("directionRandomizer",this.directionRandomizer)},c.prototype.getEffectDefines=function(){var r="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(r+=`
#define CONEEMITTERSPAWNPOINT`),r},c.prototype.getClassName=function(){return"ConeParticleEmitter"},c.prototype.serialize=function(){var r={};return r.type=this.getClassName(),r.radius=this._radius,r.angle=this._angle,r.directionRandomizer=this.directionRandomizer,r},c.prototype.parse=function(r){this.radius=r.radius,this.angle=r.angle,this.directionRandomizer=r.directionRandomizer},c}();t.ConeParticleEmitter=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n){i===void 0&&(i=1),a===void 0&&(a=1),n===void 0&&(n=0),this.radius=i,this.radiusRange=a,this.directionRandomizer=n}return r.prototype.startDirectionFunction=function(i,a,n){var s=n.position.subtract(i.getTranslation()).normalize(),o=t.Scalar.RandomRange(0,this.directionRandomizer),l=t.Scalar.RandomRange(0,this.directionRandomizer),u=t.Scalar.RandomRange(0,this.directionRandomizer);s.x+=o,s.y+=l,s.z+=u,s.normalize(),t.Vector3.TransformNormalFromFloatsToRef(s.x,s.y,s.z,i,a)},r.prototype.startPositionFunction=function(i,a,n){var s=this.radius-t.Scalar.RandomRange(0,this.radius*this.radiusRange),o=t.Scalar.RandomRange(0,1),l=t.Scalar.RandomRange(0,2*Math.PI),u=Math.acos(2*o-1),h=s*Math.cos(l)*Math.sin(u),d=s*Math.cos(u),p=s*Math.sin(l)*Math.sin(u);t.Vector3.TransformCoordinatesFromFloatsToRef(h,d,p,i,a)},r.prototype.clone=function(){var i=new r(this.radius,this.directionRandomizer);return t.Tools.DeepCopy(this,i),i},r.prototype.applyToShader=function(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)},r.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},r.prototype.getClassName=function(){return"SphereParticleEmitter"},r.prototype.serialize=function(){var i={};return i.type=this.getClassName(),i.radius=this.radius,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i},r.prototype.parse=function(i){this.radius=i.radius,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer},r}();t.SphereParticleEmitter=f;var c=function(r){N(i,r);function i(a,n,s){a===void 0&&(a=1),n===void 0&&(n=new t.Vector3(0,1,0)),s===void 0&&(s=new t.Vector3(0,1,0));var o=r.call(this,a)||this;return o.direction1=n,o.direction2=s,o}return i.prototype.startDirectionFunction=function(a,n,s){var o=t.Scalar.RandomRange(this.direction1.x,this.direction2.x),l=t.Scalar.RandomRange(this.direction1.y,this.direction2.y),u=t.Scalar.RandomRange(this.direction1.z,this.direction2.z);t.Vector3.TransformNormalFromFloatsToRef(o,l,u,a,n)},i.prototype.clone=function(){var a=new i(this.radius,this.direction1,this.direction2);return t.Tools.DeepCopy(this,a),a},i.prototype.applyToShader=function(a){a.setFloat("radius",this.radius),a.setFloat("radiusRange",this.radiusRange),a.setVector3("direction1",this.direction1),a.setVector3("direction2",this.direction2)},i.prototype.getEffectDefines=function(){return`#define SPHEREEMITTER
#define DIRECTEDSPHEREEMITTER`},i.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},i.prototype.serialize=function(){var a=r.prototype.serialize.call(this);return a.direction1=this.direction1.asArray(),a.direction2=this.direction2.asArray(),a},i.prototype.parse=function(a){r.prototype.parse.call(this,a),this.direction1.copyFrom(a.direction1),this.direction2.copyFrom(a.direction2)},i}(f);t.SphereDirectedParticleEmitter=c})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){r===void 0&&(r=1),i===void 0&&(i=1),a===void 0&&(a=0),this.radius=r,this.radiusRange=i,this.directionRandomizer=a}return c.prototype.startDirectionFunction=function(r,i,a){var n=a.position.subtract(r.getTranslation()).normalize(),s=t.Scalar.RandomRange(0,this.directionRandomizer),o=t.Scalar.RandomRange(0,this.directionRandomizer),l=t.Scalar.RandomRange(0,this.directionRandomizer);n.x+=s,n.y+=o,n.z+=l,n.normalize(),t.Vector3.TransformNormalFromFloatsToRef(n.x,n.y,n.z,r,i)},c.prototype.startPositionFunction=function(r,i,a){var n=this.radius-t.Scalar.RandomRange(0,this.radius*this.radiusRange),s=t.Scalar.RandomRange(0,1),o=t.Scalar.RandomRange(0,2*Math.PI),l=Math.acos(2*s-1),u=n*Math.cos(o)*Math.sin(l),h=n*Math.cos(l),d=n*Math.sin(o)*Math.sin(l);t.Vector3.TransformCoordinatesFromFloatsToRef(u,Math.abs(h),d,r,i)},c.prototype.clone=function(){var r=new c(this.radius,this.directionRandomizer);return t.Tools.DeepCopy(this,r),r},c.prototype.applyToShader=function(r){r.setFloat("radius",this.radius),r.setFloat("radiusRange",this.radiusRange),r.setFloat("directionRandomizer",this.directionRandomizer)},c.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},c.prototype.getClassName=function(){return"HemisphericParticleEmitter"},c.prototype.serialize=function(){var r={};return r.type=this.getClassName(),r.radius=this.radius,r.radiusRange=this.radiusRange,r.directionRandomizer=this.directionRandomizer,r},c.prototype.parse=function(r){this.radius=r.radius,this.radiusRange=r.radiusRange,this.directionRandomizer=r.directionRandomizer},c}();t.HemisphericParticleEmitter=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.direction1=new t.Vector3(0,1,0),this.direction2=new t.Vector3(0,1,0)}return c.prototype.startDirectionFunction=function(r,i,a){var n=t.Scalar.RandomRange(this.direction1.x,this.direction2.x),s=t.Scalar.RandomRange(this.direction1.y,this.direction2.y),o=t.Scalar.RandomRange(this.direction1.z,this.direction2.z);t.Vector3.TransformNormalFromFloatsToRef(n,s,o,r,i)},c.prototype.startPositionFunction=function(r,i,a){t.Vector3.TransformCoordinatesFromFloatsToRef(0,0,0,r,i)},c.prototype.clone=function(){var r=new c;return t.Tools.DeepCopy(this,r),r},c.prototype.applyToShader=function(r){r.setVector3("direction1",this.direction1),r.setVector3("direction2",this.direction2)},c.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},c.prototype.getClassName=function(){return"PointParticleEmitter"},c.prototype.serialize=function(){var r={};return r.type=this.getClassName(),r.direction1=this.direction1.asArray(),r.direction2=this.direction2.asArray(),r},c.prototype.parse=function(r){t.Vector3.FromArrayToRef(r.direction1,0,this.direction1),t.Vector3.FromArrayToRef(r.direction2,0,this.direction2)},c}();t.PointParticleEmitter=f})(T||(T={}));var T;(function(t){t.AbstractScene.AddParser(t.SceneComponentConstants.NAME_PARTICLESYSTEM,function(f,c,r,i){var a=t.AbstractScene.GetIndividualParser(t.SceneComponentConstants.NAME_PARTICLESYSTEM);if(a&&f.particleSystems!==void 0&&f.particleSystems!==null)for(var n=0,s=f.particleSystems.length;n<s;n++){var o=f.particleSystems[n];r.particleSystems.push(a(o,c,i))}}),t.AbstractScene.AddIndividualParser(t.SceneComponentConstants.NAME_PARTICLESYSTEM,function(f,c,r){if(f.activeParticleCount){var i=t.GPUParticleSystem.Parse(f,c,r);return i}else{var i=t.ParticleSystem.Parse(f,c,r);return i}}),t.Engine.prototype.createEffectForParticles=function(f,c,r,i,a,n,s){c===void 0&&(c=[]),r===void 0&&(r=[]),i===void 0&&(i="");var o=t.ParticleSystem._GetAttributeNamesOrOptions(),l=t.ParticleSystem._GetEffectCreationOptions();return i.indexOf(" BILLBOARD")===-1&&(i+=`
#define BILLBOARD
`),r.indexOf("diffuseSampler")===-1&&r.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:f},o,l.concat(c),r,i,a,n,s)},t.Mesh.prototype.getEmittedParticleSystems=function(){for(var f=new Array,c=0;c<this.getScene().particleSystems.length;c++){var r=this.getScene().particleSystems[c];r.emitter===this&&f.push(r)}return f},t.Mesh.prototype.getHierarchyEmittedParticleSystems=function(){var f=new Array,c=this.getDescendants();c.push(this);for(var r=0;r<this.getScene().particleSystems.length;r++){var i=this.getScene().particleSystems[r],a=i.emitter;a.position&&c.indexOf(a)!==-1&&f.push(i)}return f}})(T||(T={}));var T;(function(t){var f;(function(r){r[r.ATTACHED=0]="ATTACHED",r[r.END=1]="END"})(f=t.SubEmitterType||(t.SubEmitterType={}));var c=function(){function r(i){this.particleSystem=i,this.type=f.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,(!i.emitter||!i.emitter.dispose)&&(i.emitter=new t.AbstractMesh("SubemitterSystemEmitter",i.getScene())),i.onDisposeObservable.add(function(){i.emitter&&i.emitter.dispose&&i.emitter.dispose()})}return r.prototype.clone=function(){var i=this.particleSystem.emitter;i?i instanceof t.Vector3?i=i.clone():i instanceof t.AbstractMesh&&(i=new t.Mesh("",i.getScene()),i.isVisible=!1):i=new t.Vector3;var a=new r(this.particleSystem.clone("",i));return a.type=this.type,a.inheritDirection=this.inheritDirection,a.inheritedVelocityAmount=this.inheritedVelocityAmount,a.particleSystem._disposeEmitterOnDispose=!0,a.particleSystem.disposeOnStop=!0,a},r.prototype.serialize=function(){var i={};return i.type=this.type,i.inheritDirection=this.inheritDirection,i.inheritedVelocityAmount=this.inheritedVelocityAmount,i.particleSystem=this.particleSystem.serialize(),i},r.Parse=function(i,a,n){var s=i.particleSystem,o=new r(t.ParticleSystem.Parse(s,a,n));return o.type=i.type,o.inheritDirection=i.inheritDirection,o.inheritedVelocityAmount=i.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},r.prototype.dispose=function(){this.particleSystem.dispose()},r}();t.SubEmitter=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s={});var o=c.call(this,i,a)||this;return o._textures={},o._textureArrays={},o._floats={},o._ints={},o._floatsArrays={},o._colors3={},o._colors3Arrays={},o._colors4={},o._vectors2={},o._vectors3={},o._vectors4={},o._matrices={},o._matrices3x3={},o._matrices2x2={},o._vectors2Arrays={},o._vectors3Arrays={},o._cachedWorldViewMatrix=new t.Matrix,o._shaderPath=n,o._options=Ve({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},s),o}return r.prototype.getClassName=function(){return"ShaderMaterial"},r.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},r.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},r.prototype._checkUniform=function(i){this._options.uniforms.indexOf(i)===-1&&this._options.uniforms.push(i)},r.prototype.setTexture=function(i,a){return this._options.samplers.indexOf(i)===-1&&this._options.samplers.push(i),this._textures[i]=a,this},r.prototype.setTextureArray=function(i,a){return this._options.samplers.indexOf(i)===-1&&this._options.samplers.push(i),this._checkUniform(i),this._textureArrays[i]=a,this},r.prototype.setFloat=function(i,a){return this._checkUniform(i),this._floats[i]=a,this},r.prototype.setInt=function(i,a){return this._checkUniform(i),this._ints[i]=a,this},r.prototype.setFloats=function(i,a){return this._checkUniform(i),this._floatsArrays[i]=a,this},r.prototype.setColor3=function(i,a){return this._checkUniform(i),this._colors3[i]=a,this},r.prototype.setColor3Array=function(i,a){return this._checkUniform(i),this._colors3Arrays[i]=a.reduce(function(n,s){return s.toArray(n,n.length),n},[]),this},r.prototype.setColor4=function(i,a){return this._checkUniform(i),this._colors4[i]=a,this},r.prototype.setVector2=function(i,a){return this._checkUniform(i),this._vectors2[i]=a,this},r.prototype.setVector3=function(i,a){return this._checkUniform(i),this._vectors3[i]=a,this},r.prototype.setVector4=function(i,a){return this._checkUniform(i),this._vectors4[i]=a,this},r.prototype.setMatrix=function(i,a){return this._checkUniform(i),this._matrices[i]=a,this},r.prototype.setMatrix3x3=function(i,a){return this._checkUniform(i),this._matrices3x3[i]=a,this},r.prototype.setMatrix2x2=function(i,a){return this._checkUniform(i),this._matrices2x2[i]=a,this},r.prototype.setArray2=function(i,a){return this._checkUniform(i),this._vectors2Arrays[i]=a,this},r.prototype.setArray3=function(i,a){return this._checkUniform(i),this._vectors3Arrays[i]=a,this},r.prototype._checkCache=function(i,a,n){return a?(this._effect&&this._effect.defines.indexOf("#define INSTANCES")!==-1!==n,!1):!0},r.prototype.isReady=function(i,a){var n=this.getScene(),s=n.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===n.getRenderId()&&this._checkCache(n,i,a))return!0;for(var o=[],l=[],u=new t.EffectFallbacks,h=0;h<this._options.defines.length;h++)o.push(this._options.defines[h]);for(var h=0;h<this._options.attributes.length;h++)l.push(this._options.attributes[h]);i&&i.isVerticesDataPresent(t.VertexBuffer.ColorKind)&&(l.push(t.VertexBuffer.ColorKind),o.push("#define VERTEXCOLOR")),a&&(o.push("#define INSTANCES"),t.MaterialHelper.PrepareAttributesForInstances(l,o)),i&&i.useBones&&i.computeBonesUsingShaders&&i.skeleton?(l.push(t.VertexBuffer.MatricesIndicesKind),l.push(t.VertexBuffer.MatricesWeightsKind),i.numBoneInfluencers>4&&(l.push(t.VertexBuffer.MatricesIndicesExtraKind),l.push(t.VertexBuffer.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+i.numBoneInfluencers),o.push("#define BonesPerMesh "+(i.skeleton.bones.length+1)),u.addCPUSkinningFallback(0,i),this._options.uniforms.indexOf("mBones")===-1&&this._options.uniforms.push("mBones")):o.push("#define NUM_BONE_INFLUENCERS 0");for(var d in this._textures)if(!this._textures[d].isReady())return!1;i&&this._shouldTurnAlphaTestOn(i)&&o.push("#define ALPHATEST");var p=this._effect,m=o.join(`
`);return this._effect=s.createEffect(this._shaderPath,{attributes:l,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:m,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError},s),this._effect.isReady()?(p!==this._effect&&n.resetCachedMaterial(),this._renderId=n.getRenderId(),!0):!1},r.prototype.bindOnlyWorldMatrix=function(i){var a=this.getScene();this._effect&&(this._options.uniforms.indexOf("world")!==-1&&this._effect.setMatrix("world",i),this._options.uniforms.indexOf("worldView")!==-1&&(i.multiplyToRef(a.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),this._options.uniforms.indexOf("worldViewProjection")!==-1&&this._effect.setMatrix("worldViewProjection",i.multiply(a.getTransformMatrix())))},r.prototype.bind=function(i,a){if(this.bindOnlyWorldMatrix(i),this._effect&&this.getScene().getCachedMaterial()!==this){this._options.uniforms.indexOf("view")!==-1&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),this._options.uniforms.indexOf("projection")!==-1&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),this._options.uniforms.indexOf("viewProjection")!==-1&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),t.MaterialHelper.BindBonesParameters(a,this._effect);var n;for(n in this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._textureArrays)this._effect.setTextureArray(n,this._textureArrays[n]);for(n in this._ints)this._effect.setInt(n,this._ints[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors3Arrays)this._effect.setArray3(n,this._colors3Arrays[n]);for(n in this._colors4){var s=this._colors4[n];this._effect.setFloat4(n,s.r,s.g,s.b,s.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._vectors4)this._effect.setVector4(n,this._vectors4[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)this._effect.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)this._effect.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors2Arrays)this._effect.setArray2(n,this._vectors2Arrays[n]);for(n in this._vectors3Arrays)this._effect.setArray3(n,this._vectors3Arrays[n])}this._afterBind(a)},r.prototype.getActiveTextures=function(){var i=c.prototype.getActiveTextures.call(this);for(var a in this._textures)i.push(this._textures[a]);for(var a in this._textureArrays)for(var n=this._textureArrays[a],s=0;s<n.length;s++)i.push(n[s]);return i},r.prototype.hasTexture=function(i){if(c.prototype.hasTexture.call(this,i))return!0;for(var a in this._textures)if(this._textures[a]===i)return!0;for(var a in this._textureArrays)for(var n=this._textureArrays[a],s=0;s<n.length;s++)if(n[s]===i)return!0;return!1},r.prototype.clone=function(i,a){var n=new r(i,a||this.getScene(),this._shaderPath,this._options);return n},r.prototype.dispose=function(i,a){if(a){var n;for(n in this._textures)this._textures[n].dispose();for(n in this._textureArrays)for(var s=this._textureArrays[n],o=0;o<s.length;o++)s[o].dispose()}this._textures={},c.prototype.dispose.call(this,i,a)},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);i.customType="BABYLON.ShaderMaterial",i.options=this._options,i.shaderPath=this._shaderPath;var a;i.textures={};for(a in this._textures)i.textures[a]=this._textures[a].serialize();i.textureArrays={};for(a in this._textureArrays){i.textureArrays[a]=[];for(var n=this._textureArrays[a],s=0;s<n.length;s++)i.textureArrays[a].push(n[s].serialize())}i.floats={};for(a in this._floats)i.floats[a]=this._floats[a];i.FloatArrays={};for(a in this._floatsArrays)i.FloatArrays[a]=this._floatsArrays[a];i.colors3={};for(a in this._colors3)i.colors3[a]=this._colors3[a].asArray();i.colors3Arrays={};for(a in this._colors3Arrays)i.colors3Arrays[a]=this._colors3Arrays[a];i.colors4={};for(a in this._colors4)i.colors4[a]=this._colors4[a].asArray();i.vectors2={};for(a in this._vectors2)i.vectors2[a]=this._vectors2[a].asArray();i.vectors3={};for(a in this._vectors3)i.vectors3[a]=this._vectors3[a].asArray();i.vectors4={};for(a in this._vectors4)i.vectors4[a]=this._vectors4[a].asArray();i.matrices={};for(a in this._matrices)i.matrices[a]=this._matrices[a].asArray();i.matrices3x3={};for(a in this._matrices3x3)i.matrices3x3[a]=this._matrices3x3[a];i.matrices2x2={};for(a in this._matrices2x2)i.matrices2x2[a]=this._matrices2x2[a];i.vectors2Arrays={};for(a in this._vectors2Arrays)i.vectors2Arrays[a]=this._vectors2Arrays[a];i.vectors3Arrays={};for(a in this._vectors3Arrays)i.vectors3Arrays[a]=this._vectors3Arrays[a];return i},r.Parse=function(i,a,n){var s=t.SerializationHelper.Parse(function(){return new r(i.name,a,i.shaderPath,i.options)},i,a,n),o;for(o in i.textures)s.setTexture(o,t.Texture.Parse(i.textures[o],a,n));for(o in i.textureArrays){for(var l=i.textureArrays[o],u=new Array,h=0;h<l.length;h++)u.push(t.Texture.Parse(l[h],a,n));s.setTextureArray(o,u)}for(o in i.floats)s.setFloat(o,i.floats[o]);for(o in i.floatsArrays)s.setFloats(o,i.floatsArrays[o]);for(o in i.colors3)s.setColor3(o,t.Color3.FromArray(i.colors3[o]));for(o in i.colors3Arrays){var d=i.colors3Arrays[o].reduce(function(p,m,_){return _%3===0?p.push([m]):p[p.length-1].push(m),p},[]).map(function(p){return t.Color3.FromArray(p)});s.setColor3Array(o,d)}for(o in i.colors4)s.setColor4(o,t.Color4.FromArray(i.colors4[o]));for(o in i.vectors2)s.setVector2(o,t.Vector2.FromArray(i.vectors2[o]));for(o in i.vectors3)s.setVector3(o,t.Vector3.FromArray(i.vectors3[o]));for(o in i.vectors4)s.setVector4(o,t.Vector4.FromArray(i.vectors4[o]));for(o in i.matrices)s.setMatrix(o,t.Matrix.FromArray(i.matrices[o]));for(o in i.matrices3x3)s.setMatrix3x3(o,i.matrices3x3[o]);for(o in i.matrices2x2)s.setMatrix2x2(o,i.matrices2x2[o]);for(o in i.vectors2Arrays)s.setArray2(o,i.vectors2Arrays[o]);for(o in i.vectors3Arrays)s.setArray3(o,i.vectors3Arrays[o]);return s},r}(t.Material);t.ShaderMaterial=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a)||this;return n.generateOctree=!1,n}return r.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(r.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),r.prototype.optimize=function(i,a){a===void 0&&(a=32),this._subdivisionsX=i,this._subdivisionsY=i,this.subdivide(i);var n=this;n.createOrUpdateSubmeshesOctree&&n.createOrUpdateSubmeshesOctree(a)},r.prototype.getHeightAtCoordinates=function(i,a){var n=this.getWorldMatrix(),s=t.Tmp.Matrix[5];n.invertToRef(s);var o=t.Tmp.Vector3[8];if(t.Vector3.TransformCoordinatesFromFloatsToRef(i,0,a,s,o),i=o.x,a=o.z,i<this._minX||i>this._maxX||a<this._minZ||a>this._maxZ)return this.position.y;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());var l=this._getFacetAt(i,a),u=-(l.x*i+l.z*a+l.w)/l.y;return t.Vector3.TransformCoordinatesFromFloatsToRef(0,u,0,n,o),o.y},r.prototype.getNormalAtCoordinates=function(i,a){var n=new t.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(i,a,n),n},r.prototype.getNormalAtCoordinatesToRef=function(i,a,n){var s=this.getWorldMatrix(),o=t.Tmp.Matrix[5];s.invertToRef(o);var l=t.Tmp.Vector3[8];if(t.Vector3.TransformCoordinatesFromFloatsToRef(i,0,a,o,l),i=l.x,a=l.z,i<this._minX||i>this._maxX||a<this._minZ||a>this._maxZ)return this;(!this._heightQuads||this._heightQuads.length==0)&&(this._initHeightQuads(),this._computeHeightQuads());var u=this._getFacetAt(i,a);return t.Vector3.TransformNormalFromFloatsToRef(u.x,u.y,u.z,s,n),this},r.prototype.updateCoordinateHeights=function(){return(!this._heightQuads||this._heightQuads.length==0)&&this._initHeightQuads(),this._computeHeightQuads(),this},r.prototype._getFacetAt=function(i,a){var n=Math.floor((i+this._maxX)*this._subdivisionsX/this._width),s=Math.floor(-(a+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[s*this._subdivisionsX+n],l;return a<o.slope.x*i+o.slope.y?l=o.facet1:l=o.facet2,l},r.prototype._initHeightQuads=function(){var i=this._subdivisionsX,a=this._subdivisionsY;this._heightQuads=new Array;for(var n=0;n<a;n++)for(var s=0;s<i;s++){var o={slope:t.Vector2.Zero(),facet1:new t.Vector4(0,0,0,0),facet2:new t.Vector4(0,0,0,0)};this._heightQuads[n*i+s]=o}return this},r.prototype._computeHeightQuads=function(){var i=this.getVerticesData(t.VertexBuffer.PositionKind);if(!i)return this;for(var a=t.Tmp.Vector3[3],n=t.Tmp.Vector3[2],s=t.Tmp.Vector3[1],o=t.Tmp.Vector3[0],l=t.Tmp.Vector3[4],u=t.Tmp.Vector3[5],h=t.Tmp.Vector3[6],d=t.Tmp.Vector3[7],p=t.Tmp.Vector3[8],m=0,_=0,v=0,S=0,P=0,x=0,R=0,w=this._subdivisionsX,I=this._subdivisionsY,F=0;F<I;F++)for(var k=0;k<w;k++){m=k*3,_=F*(w+1)*3,v=(F+1)*(w+1)*3,a.x=i[_+m],a.y=i[_+m+1],a.z=i[_+m+2],n.x=i[_+m+3],n.y=i[_+m+4],n.z=i[_+m+5],s.x=i[v+m],s.y=i[v+m+1],s.z=i[v+m+2],o.x=i[v+m+3],o.y=i[v+m+4],o.z=i[v+m+5],S=(o.z-a.z)/(o.x-a.x),P=a.z-S*a.x,n.subtractToRef(a,l),s.subtractToRef(a,u),o.subtractToRef(a,h),t.Vector3.CrossToRef(h,u,d),t.Vector3.CrossToRef(l,h,p),d.normalize(),p.normalize(),x=-(d.x*a.x+d.y*a.y+d.z*a.z),R=-(p.x*n.x+p.y*n.y+p.z*n.z);var E=this._heightQuads[F*w+k];E.slope.copyFromFloats(S,P),E.facet1.copyFromFloats(d.x,d.y,d.z,x),E.facet2.copyFromFloats(p.x,p.y,p.z,R)}return this},r.prototype.serialize=function(i){c.prototype.serialize.call(this,i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.minZ=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height},r.Parse=function(i,a){var n=new r(i.name,a);return n._subdivisionsX=i.subdivisionsX||1,n._subdivisionsY=i.subdivisionsY||1,n._minX=i.minX,n._maxX=i.maxX,n._minZ=i.minZ,n._maxZ=i.maxZ,n._width=i.width,n._height=i.height,n},r}(t.Mesh);t.GroundMesh=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a.getScene())||this;return a.instances.push(n),n._sourceMesh=a,n.position.copyFrom(a.position),n.rotation.copyFrom(a.rotation),n.scaling.copyFrom(a.scaling),a.rotationQuaternion&&(n.rotationQuaternion=a.rotationQuaternion.clone()),n.infiniteDistance=a.infiniteDistance,n.setPivotMatrix(a.getPivotMatrix()),n.refreshBoundingInfo(),n._syncSubMeshes(),n}return r.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(r.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(i){!this._sourceMesh||i===this._sourceMesh.renderingGroupId||t.Tools.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(r.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),r.prototype.isReady=function(i){return i===void 0&&(i=!1),this._sourceMesh.isReady(i,!0)},r.prototype.getVerticesData=function(i,a){return this._sourceMesh.getVerticesData(i,a)},r.prototype.setVerticesData=function(i,a,n,s){return this.sourceMesh&&this.sourceMesh.setVerticesData(i,a,n,s),this.sourceMesh},r.prototype.updateVerticesData=function(i,a,n,s){return this.sourceMesh&&this.sourceMesh.updateVerticesData(i,a,n,s),this.sourceMesh},r.prototype.setIndices=function(i,a){return a===void 0&&(a=null),this.sourceMesh&&this.sourceMesh.setIndices(i,a),this.sourceMesh},r.prototype.isVerticesDataPresent=function(i){return this._sourceMesh.isVerticesDataPresent(i)},r.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(r.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),r.prototype.refreshBoundingInfo=function(){var i=this._sourceMesh.getBoundingInfo();return this._boundingInfo=new t.BoundingInfo(i.minimum.clone(),i.maximum.clone()),this._updateBoundingInfo(),this},r.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},r.prototype._activate=function(i){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,i),this},r.prototype.getLOD=function(i){if(!i)return this;var a=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(i,a.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},r.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var i=0;i<this._sourceMesh.subMeshes.length;i++)this._sourceMesh.subMeshes[i].clone(this,this._sourceMesh);return this},r.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},r.prototype.clone=function(i,a,n){var s=this._sourceMesh.createInstance(i);if(t.Tools.DeepCopy(this,s,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),a&&(s.parent=a),!n)for(var o=0;o<this.getScene().meshes.length;o++){var l=this.getScene().meshes[o];l.parent===this&&l.clone(l.name,s)}return s.computeWorldMatrix(!0),s},r.prototype.dispose=function(i,a){a===void 0&&(a=!1);var n=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(n,1),c.prototype.dispose.call(this,i,a)},r}(t.AbstractMesh);t.InstancedMesh=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){a===void 0&&(a=null),n===void 0&&(n=null);var h=c.call(this,i,a,n,s,o)||this;h.useVertexColor=l,h.useVertexAlpha=u,h.color=new t.Color3(1,1,1),h.alpha=1,s&&(h.color=s.color.clone(),h.alpha=s.alpha,h.useVertexColor=s.useVertexColor,h.useVertexAlpha=s.useVertexAlpha),h._intersectionThreshold=.1;var d=[],p={attributes:[t.VertexBuffer.PositionKind,"world0","world1","world2","world3"],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:d};return u===!1&&(p.needAlphaBlending=!1),l?(p.defines.push("#define VERTEXCOLOR"),p.attributes.push(t.VertexBuffer.ColorKind)):p.uniforms.push("color"),h._colorShader=new t.ShaderMaterial("colorShader",h.getScene(),"color",p),h}return Object.defineProperty(r.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(i){this._intersectionThreshold!==i&&(this._intersectionThreshold=i,this.geometry&&(this.geometry.boundingBias=new t.Vector2(0,i)))},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(r.prototype,"material",{get:function(){return this._colorShader},set:function(i){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),r.prototype._bind=function(i,a,n){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},r.prototype._draw=function(i,a,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var s=this.getScene().getEngine();return s.drawElementsType(t.Material.LineListDrawMode,i.indexStart,i.indexCount,n),this},r.prototype.dispose=function(i){this._colorShader.dispose(),c.prototype.dispose.call(this,i)},r.prototype.clone=function(i,a,n){return new r(i,this.getScene(),a,this,n)},r}(t.Mesh);t.LinesMesh=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._count=0,this._data={}}return c.prototype.copyFrom=function(r){var i=this;this.clear(),r.forEach(function(a,n){return i.add(a,n)})},c.prototype.get=function(r){var i=this._data[r];if(i!==void 0)return i},c.prototype.getOrAddWithFactory=function(r,i){var a=this.get(r);return a!==void 0||(a=i(r),a&&this.add(r,a)),a},c.prototype.getOrAdd=function(r,i){var a=this.get(r);return a!==void 0?a:(this.add(r,i),i)},c.prototype.contains=function(r){return this._data[r]!==void 0},c.prototype.add=function(r,i){return this._data[r]!==void 0?!1:(this._data[r]=i,++this._count,!0)},c.prototype.set=function(r,i){return this._data[r]===void 0?!1:(this._data[r]=i,!0)},c.prototype.getAndRemove=function(r){var i=this.get(r);return i!==void 0?(delete this._data[r],--this._count,i):null},c.prototype.remove=function(r){return this.contains(r)?(delete this._data[r],--this._count,!0):!1},c.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(c.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),c.prototype.forEach=function(r){for(var i in this._data){var a=this._data[i];r(i,a)}},c.prototype.first=function(r){for(var i in this._data){var a=this._data[i],n=r(i,a);if(n)return n}return null},c}();t.StringDictionary=f})(T||(T={}));var T;(function(t){var f;(function(c){var r=function(){function i(a,n,s,o,l){o===void 0&&(o=!0),l===void 0&&(l=1),this.skeleton=a,this.mesh=n,this.autoUpdateBonesMatrices=o,this.renderingGroupId=l,this.color=t.Color3.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=s,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled!==a&&(this._isEnabled=a,a?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),i.prototype._getBonePosition=function(a,n,s,o,l,u){o===void 0&&(o=0),l===void 0&&(l=0),u===void 0&&(u=0);var h=t.Tmp.Matrix[0],d=n.getParent();if(h.copyFrom(n.getLocalMatrix()),o!==0||l!==0||u!==0){var p=t.Tmp.Matrix[1];t.Matrix.IdentityToRef(p),p.m[12]=o,p.m[13]=l,p.m[14]=u,p.multiplyToRef(h,h)}d&&h.multiplyToRef(d.getAbsoluteTransform(),h),h.multiplyToRef(s,h),a.x=h.m[12],a.y=h.m[13],a.z=h.m[14]},i.prototype._getLinesForBonesWithLength=function(a,n){for(var s=a.length,o=this.mesh.position,l=0;l<s;l++){var u=a[l],h=this._debugLines[l];h||(h=[t.Vector3.Zero(),t.Vector3.Zero()],this._debugLines[l]=h),this._getBonePosition(h[0],u,n),this._getBonePosition(h[1],u,n,0,u.length,0),h[0].subtractInPlace(o),h[1].subtractInPlace(o)}},i.prototype._getLinesForBonesNoLength=function(a,n){for(var s=a.length,o=0,l=this.mesh.position,u=s-1;u>=0;u--){var h=a[u],d=h.getParent();if(d){var p=this._debugLines[o];p||(p=[t.Vector3.Zero(),t.Vector3.Zero()],this._debugLines[o]=p),h.getAbsolutePositionToRef(this.mesh,p[0]),d.getAbsolutePositionToRef(this.mesh,p[1]),p[0].subtractInPlace(l),p[1].subtractInPlace(l),o++}}},i.prototype.update=function(){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),this.skeleton.bones[0].length===void 0?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?t.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=t.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color},i.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},i}();c.SkeletonViewer=r})(f=t.Debug||(t.Debug={}))})(T||(T={}));var T;(function(t){var f;(function(c){var r=function(){function i(a,n){n===void 0&&(n=1),this._xline=[t.Vector3.Zero(),t.Vector3.Zero()],this._yline=[t.Vector3.Zero(),t.Vector3.Zero()],this._zline=[t.Vector3.Zero(),t.Vector3.Zero()],this.scaleLines=1,this.scaleLines=n,this._xmesh=t.Mesh.CreateLines("xline",this._xline,a,!0),this._ymesh=t.Mesh.CreateLines("yline",this._yline,a,!0),this._zmesh=t.Mesh.CreateLines("zline",this._zline,a,!0),this._xmesh.renderingGroupId=2,this._ymesh.renderingGroupId=2,this._zmesh.renderingGroupId=2,this._xmesh.material.checkReadyOnlyOnce=!0,this._xmesh.color=new t.Color3(1,0,0),this._ymesh.material.checkReadyOnlyOnce=!0,this._ymesh.color=new t.Color3(0,1,0),this._zmesh.material.checkReadyOnlyOnce=!0,this._zmesh.color=new t.Color3(0,0,1),this.scene=a}return i.prototype.update=function(a,n,s,o){var l=this.scaleLines;this._xmesh&&this._xmesh.position.copyFrom(a),this._ymesh&&this._ymesh.position.copyFrom(a),this._zmesh&&this._zmesh.position.copyFrom(a);var u=this._xline[1];u.x=n.x*l,u.y=n.y*l,u.z=n.z*l,t.Mesh.CreateLines("",this._xline,null,!1,this._xmesh),u=this._yline[1],u.x=s.x*l,u.y=s.y*l,u.z=s.z*l,t.Mesh.CreateLines("",this._yline,null,!1,this._ymesh),u=this._zline[1],u.x=o.x*l,u.y=o.y*l,u.z=o.z*l,t.Mesh.CreateLines("",this._zline,null,!1,this._zmesh)},i.prototype.dispose=function(){this._xmesh&&this._xmesh.dispose(),this._ymesh&&this._ymesh.dispose(),this._zmesh&&this._zmesh.dispose(),this._xmesh=null,this._ymesh=null,this._zmesh=null,this.scene=null},i}();c.AxesViewer=r})(f=t.Debug||(t.Debug={}))})(T||(T={}));var T;(function(t){var f;(function(c){var r=function(i){N(a,i);function a(n,s,o,l){l===void 0&&(l=1);var u=i.call(this,n,l)||this;return u.pos=t.Vector3.Zero(),u.xaxis=t.Vector3.Zero(),u.yaxis=t.Vector3.Zero(),u.zaxis=t.Vector3.Zero(),u.mesh=o,u.bone=s,u}return a.prototype.update=function(){if(!(!this.mesh||!this.bone)){var n=this.bone;n.getAbsolutePositionToRef(this.mesh,this.pos),n.getDirectionToRef(t.Axis.X,this.mesh,this.xaxis),n.getDirectionToRef(t.Axis.Y,this.mesh,this.yaxis),n.getDirectionToRef(t.Axis.Z,this.mesh,this.zaxis),i.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},a.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,i.prototype.dispose.call(this))},a}(c.AxesViewer);c.BoneAxesViewer=r})(f=t.Debug||(t.Debug={}))})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.ray=r}return c.CreateAndShow=function(r,i,a){var n=new c(r);return n.show(i,a),n},c.prototype.show=function(r,i){if(!this._renderFunction&&this.ray){var a=this.ray;this._renderFunction=this._render.bind(this),this._scene=r,this._renderPoints=[a.origin,a.origin.add(a.direction.scale(a.length))],this._renderLine=t.Mesh.CreateLines("ray",this._renderPoints,r,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}i&&this._renderLine&&this._renderLine.color.copyFrom(i)},c.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},c.prototype._render=function(){var r=this.ray;if(r){var i=this._renderPoints[1],a=Math.min(r.length,1e6);i.copyFrom(r.direction),i.scaleInPlace(a),i.addInPlace(r.origin),t.Mesh.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},c.prototype.attachToMesh=function(r,i,a,n){this._attachedToMesh=r;var s=this.ray;s&&(s.direction||(s.direction=t.Vector3.Zero()),s.origin||(s.origin=t.Vector3.Zero()),n&&(s.length=n),a||(a=t.Vector3.Zero()),i||(i=new t.Vector3(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(i),this._meshSpaceOrigin.copyFrom(a)):(this._meshSpaceDirection=i.clone(),this._meshSpaceOrigin=a.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},c.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},c.prototype._updateToMesh=function(){var r=this.ray;if(!(!this._attachedToMesh||!r)){if(this._attachedToMesh._isDisposed){this.detachFromMesh();return}this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,r.direction),t.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),r.origin)}},c.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},c}();t.RayHelper=f})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new f(this)),this._debugLayer},enumerable:!0,configurable:!0});var f=function(){function c(r){var i=this;this.BJSINSPECTOR=typeof INSPECTOR<"u"?INSPECTOR:void 0,this.onPropertyChangedObservable=new t.Observable,this._scene=r,this._scene.onDisposeObservable.add(function(){i._scene._debugLayer&&i._scene._debugLayer.hide()})}return c.prototype._createInspector=function(r){r===void 0&&(r={});var i=r.popup||!1,a=r.initialTab||0,n=r.parentElement||null;this._inspector||(this.BJSINSPECTOR=this.BJSINSPECTOR||typeof INSPECTOR<"u"?INSPECTOR:void 0,this._inspector=new this.BJSINSPECTOR.Inspector(this._scene,i,a,n,r.newColors))},c.prototype.isVisible=function(){return!!this._inspector},c.prototype.hide=function(){if(this._inspector){try{this._inspector.dispose()}catch{}this.onPropertyChangedObservable.clear(),this._inspector=null}},c.prototype.show=function(r){r===void 0&&(r={}),typeof this.BJSINSPECTOR>"u"?t.Tools.LoadScript(c.InspectorURL,this._createInspector.bind(this,r)):this._createInspector(r)},c.prototype.getActiveTab=function(){return this._inspector?this._inspector.getActiveTabIndex():-1},c.InspectorURL="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",c}();t.DebugLayer=f})(T||(T={}));var T;(function(t){var f;(function(c){var r=function(){function i(a){this._impostors=[],this._meshes=[],this._numMeshes=0,this._scene=a||t.Engine.LastCreatedScene;var n=this._scene.getPhysicsEngine();n&&(this._physicsEnginePlugin=n.getPhysicsPlugin())}return i.prototype._updateDebugMeshes=function(){for(var a=this._physicsEnginePlugin,n=0;n<this._numMeshes;n++){var s=this._impostors[n];if(s)if(s.isDisposed)this.hideImpostor(this._impostors[n--]);else{var o=this._meshes[n];o&&a&&a.syncMeshWithImpostor(o,s)}}},i.prototype.showImpostor=function(a){if(this._scene){for(var n=0;n<this._numMeshes;n++)if(this._impostors[n]==a)return;var s=this._getDebugMesh(a,this._scene);s&&(this._impostors[this._numMeshes]=a,this._meshes[this._numMeshes]=s,this._numMeshes===0&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++)}},i.prototype.hideImpostor=function(a){if(!(!a||!this._scene)){for(var n=!1,s=0;s<this._numMeshes;s++)if(this._impostors[s]==a){var o=this._meshes[s];if(!o)continue;this._scene.removeMesh(o),o.dispose(),this._numMeshes--,this._numMeshes>0?(this._meshes[s]=this._meshes[this._numMeshes],this._impostors[s]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),n=!0;break}n&&this._numMeshes===0&&this._scene.unregisterBeforeRender(this._renderFunction)}},i.prototype._getDebugMaterial=function(a){return this._debugMaterial||(this._debugMaterial=new t.StandardMaterial("",a),this._debugMaterial.wireframe=!0),this._debugMaterial},i.prototype._getDebugBoxMesh=function(a){return this._debugBoxMesh||(this._debugBoxMesh=t.MeshBuilder.CreateBox("physicsBodyBoxViewMesh",{size:1},a),this._debugBoxMesh.renderingGroupId=1,this._debugBoxMesh.rotationQuaternion=t.Quaternion.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(a),a.removeMesh(this._debugBoxMesh)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},i.prototype._getDebugSphereMesh=function(a){return this._debugSphereMesh||(this._debugSphereMesh=t.MeshBuilder.CreateSphere("physicsBodySphereViewMesh",{diameter:1},a),this._debugSphereMesh.renderingGroupId=1,this._debugSphereMesh.rotationQuaternion=t.Quaternion.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(a),a.removeMesh(this._debugSphereMesh)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},i.prototype._getDebugMesh=function(a,n){var s=null;if(a.type==t.PhysicsImpostor.BoxImpostor)s=this._getDebugBoxMesh(n),a.getBoxSizeToRef(s.scaling);else if(a.type==t.PhysicsImpostor.SphereImpostor){s=this._getDebugSphereMesh(n);var o=a.getRadius();s.scaling.x=o*2,s.scaling.y=o*2,s.scaling.z=o*2}return s},i.prototype.dispose=function(){for(var a=0;a<this._numMeshes;a++)this.hideImpostor(this._impostors[a]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null},i}();c.PhysicsViewer=r})(f=t.Debug||(t.Debug={}))})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(c){this._forceShowBoundingBoxes=c,c&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),t.Scene.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new f(this)),this._boundingBoxRenderer},Object.defineProperty(t.AbstractMesh.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(c){this._showBoundingBox=c,c&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_BOUNDINGBOXRENDERER,this.frontColor=new t.Color3(1,1,1),this.backColor=new t.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new t.SmartArray(32),this._vertexBuffers={},this.scene=r,r._addComponent(this)}return c.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(t.SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(t.SceneComponentConstants.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(t.SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},c.prototype._evaluateSubMesh=function(r,i){if(r.showSubMeshesBoundingBox){var a=i.getBoundingInfo();a!=null&&(a.boundingBox._tag=r.renderingGroupId,this.renderList.push(a.boundingBox))}},c.prototype._activeMesh=function(r,i){if(r.showBoundingBox||this.scene.forceShowBoundingBoxes){var a=r.getBoundingInfo();a.boundingBox._tag=i.renderingGroupId,this.renderList.push(a.boundingBox)}},c.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new t.ShaderMaterial("colorShader",this.scene,"color",{attributes:[t.VertexBuffer.PositionKind],uniforms:["world","viewProjection","color"]});var r=this.scene.getEngine(),i=t.VertexData.CreateBox({size:1});this._vertexBuffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(r,i.positions,t.VertexBuffer.PositionKind,!1),this._createIndexBuffer()}},c.prototype._createIndexBuffer=function(){var r=this.scene.getEngine();this._indexBuffer=r.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},c.prototype.rebuild=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&r._rebuild(),this._createIndexBuffer()},c.prototype.reset=function(){this.renderList.reset()},c.prototype.render=function(r){if(this.renderList.length!==0&&(this._prepareRessources(),!!this._colorShader.isReady())){var i=this.scene.getEngine();i.setDepthWrite(!1),this._colorShader._preBind();for(var a=0;a<this.renderList.length;a++){var n=this.renderList.data[a];if(n._tag===r){var s=n.minimum,o=n.maximum,l=o.subtract(s),u=s.add(l.scale(.5)),h=t.Matrix.Scaling(l.x,l.y,l.z).multiply(t.Matrix.Translation(u.x,u.y,u.z)).multiply(n.getWorldMatrix());i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(i.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(h),i.drawElementsType(t.Material.LineListDrawMode,0,24)),i.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(h),i.drawElementsType(t.Material.LineListDrawMode,0,24)}}this._colorShader.unbind(),i.setDepthFunctionToLessOrEqual(),i.setDepthWrite(!0)}},c.prototype.renderOcclusionBoundingBox=function(r){if(this._prepareRessources(),!(!this._colorShader.isReady()||!r._boundingInfo)){var i=this.scene.getEngine();i.setDepthWrite(!1),i.setColorWrite(!1),this._colorShader._preBind();var a=r._boundingInfo.boundingBox,n=a.minimum,s=a.maximum,o=s.subtract(n),l=n.add(o.scale(.5)),u=t.Matrix.Scaling(o.x,o.y,o.z).multiply(t.Matrix.Translation(l.x,l.y,l.z)).multiply(a.getWorldMatrix());i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),i.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(u),i.drawElementsType(t.Material.LineListDrawMode,0,24),this._colorShader.unbind(),i.setDepthFunctionToLessOrEqual(),i.setDepthWrite(!0),i.setColorWrite(!0)}},c.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&(r.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer)}},c}();t.BoundingBoxRenderer=f})(T||(T={}));var T;(function(t){t.Engine.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},t.Engine.prototype.deleteTransformFeedback=function(f){this._gl.deleteTransformFeedback(f)},t.Engine.prototype.bindTransformFeedback=function(f){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,f)},t.Engine.prototype.beginTransformFeedback=function(f){f===void 0&&(f=!0),this._gl.beginTransformFeedback(f?this._gl.POINTS:this._gl.TRIANGLES)},t.Engine.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},t.Engine.prototype.setTranformFeedbackVaryings=function(f,c){this._gl.transformFeedbackVaryings(f,c,this._gl.INTERLEAVED_ATTRIBS)},t.Engine.prototype.bindTransformFeedbackBuffer=function(f){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f)}})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s=!1);var o=c.call(this,i)||this;o.layerMask=268435455,o._accumulatedCount=0,o._targetIndex=0,o._currentRenderId=-1,o._started=!1,o._stopped=!1,o._timeDelta=0,o._attributesStrideSize=21,o._actualFrame=0,o._rawTextureWidth=256,o.onDisposeObservable=new t.Observable,o.forceDepthWrite=!1,o._preWarmDone=!1,o._scene=n||t.Engine.LastCreatedScene,o._attachImageProcessingConfiguration(null),o._engine=o._scene.getEngine(),a.randomTextureSize||delete a.randomTextureSize;var l=Ve({capacity:5e4,randomTextureSize:o._engine.getCaps().maxTextureSize},a),u=a;isFinite(u)&&(l.capacity=u),o._capacity=l.capacity,o._activeCount=l.capacity,o._currentActiveCount=0,o._isAnimationSheetEnabled=s,o._scene.particleSystems.push(o),o._updateEffectOptions={attributes:["position","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},o.particleEmitterType=new t.BoxParticleEmitter;for(var h=Math.min(o._engine.getCaps().maxTextureSize,l.randomTextureSize),d=[],p=0;p<h;++p)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());o._randomTexture=new t.RawTexture(new Float32Array(d),h,1,t.Engine.TEXTUREFORMAT_RGBA,o._scene,!1,!1,t.Texture.NEAREST_SAMPLINGMODE,t.Engine.TEXTURETYPE_FLOAT),o._randomTexture.wrapU=t.Texture.WRAP_ADDRESSMODE,o._randomTexture.wrapV=t.Texture.WRAP_ADDRESSMODE,d=[];for(var p=0;p<h;++p)d.push(Math.random()),d.push(Math.random()),d.push(Math.random()),d.push(Math.random());return o._randomTexture2=new t.RawTexture(new Float32Array(d),h,1,t.Engine.TEXTUREFORMAT_RGBA,o._scene,!1,!1,t.Texture.NEAREST_SAMPLINGMODE,t.Engine.TEXTURETYPE_FLOAT),o._randomTexture2.wrapU=t.Texture.WRAP_ADDRESSMODE,o._randomTexture2.wrapV=t.Texture.WRAP_ADDRESSMODE,o._randomTextureSize=h,o}return Object.defineProperty(r,"IsSupported",{get:function(){return t.Engine.LastCreatedEngine?t.Engine.LastCreatedEngine.webGLVersion>1:!1},enumerable:!0,configurable:!0}),r.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(r.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(i){this._activeCount=Math.min(i,this._capacity)},enumerable:!0,configurable:!0}),r.prototype.isReady=function(){return this._updateEffect?!(!this.emitter||!this._updateEffect.isReady()||!this._imageProcessingConfiguration.isReady()||!this._renderEffect.isReady()||!this.particleTexture||!this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},r.prototype.isStarted=function(){return this._started},r.prototype.start=function(i){var a=this;if(i===void 0&&(i=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(i){setTimeout(function(){a.start(0)},i);return}this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)},r.prototype.stop=function(){this._stopped=!0},r.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},r.prototype.getClassName=function(){return"GPUParticleSystem"},r.prototype._removeGradientAndTexture=function(i,a,n){return c.prototype._removeGradientAndTexture.call(this,i,a,n),this._releaseBuffers(),this},r.prototype.addColorGradient=function(i,a,n){this._colorGradients||(this._colorGradients=[]);var s=new t.ColorGradient;return s.gradient=i,s.color1=a,this._colorGradients.push(s),this._colorGradients.sort(function(o,l){return o.gradient<l.gradient?-1:o.gradient>l.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeColorGradient=function(i){return this._removeGradientAndTexture(i,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},r.prototype._addFactorGradient=function(i,a,n){var s=new t.FactorGradient;s.gradient=a,s.factor1=n,i.push(s),i.sort(function(o,l){return o.gradient<l.gradient?-1:o.gradient>l.gradient?1:0}),this._releaseBuffers()},r.prototype.addSizeGradient=function(i,a){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,i,a),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeSizeGradient=function(i){return this._removeGradientAndTexture(i,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},r.prototype.addAngularSpeedGradient=function(i,a){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,i,a),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeAngularSpeedGradient=function(i){return this._removeGradientAndTexture(i,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},r.prototype.addVelocityGradient=function(i,a){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,i,a),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeVelocityGradient=function(i){return this._removeGradientAndTexture(i,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},r.prototype.addLimitVelocityGradient=function(i,a){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,i,a),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeLimitVelocityGradient=function(i){return this._removeGradientAndTexture(i,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},r.prototype.addDragGradient=function(i,a){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,i,a),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},r.prototype.removeDragGradient=function(i){return this._removeGradientAndTexture(i,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},r.prototype.addEmitRateGradient=function(i,a,n){return this},r.prototype.removeEmitRateGradient=function(i){return this},r.prototype.addStartSizeGradient=function(i,a,n){return this},r.prototype.removeStartSizeGradient=function(i){return this},r.prototype.addColorRemapGradient=function(i,a,n){return this},r.prototype.removeColorRemapGradient=function(i){return this},r.prototype.addAlphaRemapGradient=function(i,a,n){return this},r.prototype.removeAlphaRemapGradient=function(i){return this},r.prototype.addRampGradient=function(i,a){return this},r.prototype.removeRampGradient=function(i){return this},r.prototype.getRampGradients=function(){return null},Object.defineProperty(r.prototype,"useRampGradients",{get:function(){return!1},set:function(i){},enumerable:!0,configurable:!0}),r.prototype.addLifeTimeGradient=function(i,a,n){return this},r.prototype.removeLifeTimeGradient=function(i){return this},r.prototype._reset=function(){this._releaseBuffers()},r.prototype._createUpdateVAO=function(i){var a={};a.position=i.createVertexBuffer("position",0,3),a.age=i.createVertexBuffer("age",3,1),a.life=i.createVertexBuffer("life",4,1),a.seed=i.createVertexBuffer("seed",5,4),a.size=i.createVertexBuffer("size",9,3);var n=12;this._colorGradientsTexture||(a.color=i.createVertexBuffer("color",n,4),n+=4),a.direction=i.createVertexBuffer("direction",n,3),n+=3,this._isBillboardBased||(a.initialDirection=i.createVertexBuffer("initialDirection",n,3),n+=3),this._angularSpeedGradientsTexture?(a.angle=i.createVertexBuffer("angle",n,1),n+=1):(a.angle=i.createVertexBuffer("angle",n,2),n+=2),this._isAnimationSheetEnabled&&(a.cellIndex=i.createVertexBuffer("cellIndex",n,1),n+=1,this.spriteRandomStartCell&&(a.cellStartOffset=i.createVertexBuffer("cellStartOffset",n,1),n+=1)),this.noiseTexture&&(a.noiseCoordinates1=i.createVertexBuffer("noiseCoordinates1",n,3),n+=3,a.noiseCoordinates2=i.createVertexBuffer("noiseCoordinates2",n,3),n+=3);var s=this._engine.recordVertexArrayObject(a,null,this._updateEffect);return this._engine.bindArrayBuffer(null),s},r.prototype._createRenderVAO=function(i,a){var n={};n.position=i.createVertexBuffer("position",0,3,this._attributesStrideSize,!0),n.age=i.createVertexBuffer("age",3,1,this._attributesStrideSize,!0),n.life=i.createVertexBuffer("life",4,1,this._attributesStrideSize,!0),n.size=i.createVertexBuffer("size",9,3,this._attributesStrideSize,!0);var s=12;this._colorGradientsTexture||(n.color=i.createVertexBuffer("color",s,4,this._attributesStrideSize,!0),s+=4),this.billboardMode===t.ParticleSystem.BILLBOARDMODE_STRETCHED&&(n.direction=i.createVertexBuffer("direction",s,3,this._attributesStrideSize,!0)),s+=3,this._isBillboardBased||(n.initialDirection=i.createVertexBuffer("initialDirection",s,3,this._attributesStrideSize,!0),s+=3),n.angle=i.createVertexBuffer("angle",s,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?s++:s+=2,this._isAnimationSheetEnabled&&(n.cellIndex=i.createVertexBuffer("cellIndex",s,1,this._attributesStrideSize,!0),s+=1,this.spriteRandomStartCell&&(n.cellStartOffset=i.createVertexBuffer("cellStartOffset",s,1,this._attributesStrideSize,!0),s+=1)),this.noiseTexture&&(n.noiseCoordinates1=i.createVertexBuffer("noiseCoordinates1",s,3,this._attributesStrideSize,!0),s+=3,n.noiseCoordinates2=i.createVertexBuffer("noiseCoordinates2",s,3,this._attributesStrideSize,!0),s+=3),n.offset=a.createVertexBuffer("offset",0,2),n.uv=a.createVertexBuffer("uv",2,2);var o=this._engine.recordVertexArrayObject(n,null,this._renderEffect);return this._engine.bindArrayBuffer(null),o},r.prototype._initialize=function(i){if(i===void 0&&(i=!1),!(this._buffer0&&!i)){var a=this._scene.getEngine(),n=new Array;this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var s=0;s<this._capacity;s++)n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(0),n.push(0),n.push(0),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0)),n.push(0),n.push(0),n.push(0),this.isBillboardBased||(n.push(0),n.push(0),n.push(0)),n.push(0),this._angularSpeedGradientsTexture||n.push(0),this._isAnimationSheetEnabled&&(n.push(0),this.spriteRandomStartCell&&n.push(0)),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()));var o=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new t.Buffer(a,n,!1,this._attributesStrideSize),this._buffer1=new t.Buffer(a,n,!1,this._attributesStrideSize),this._spriteBuffer=new t.Buffer(a,o,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},r.prototype._recreateUpdateEffect=function(){var i=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(i+=`
#define BILLBOARD`),this._colorGradientsTexture&&(i+=`
#define COLORGRADIENTS`),this._sizeGradientsTexture&&(i+=`
#define SIZEGRADIENTS`),this._angularSpeedGradientsTexture&&(i+=`
#define ANGULARSPEEDGRADIENTS`),this._velocityGradientsTexture&&(i+=`
#define VELOCITYGRADIENTS`),this._limitVelocityGradientsTexture&&(i+=`
#define LIMITVELOCITYGRADIENTS`),this._dragGradientsTexture&&(i+=`
#define DRAGGRADIENTS`),this.isAnimationSheetEnabled&&(i+=`
#define ANIMATESHEET`,this.spriteRandomStartCell&&(i+=`
#define ANIMATESHEETRANDOMSTART`)),this.noiseTexture&&(i+=`
#define NOISE`),!(this._updateEffect&&this._updateEffectOptions.defines===i)&&(this._updateEffectOptions.transformFeedbackVaryings=["outPosition","outAge","outLife","outSeed","outSize"],this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=i,this._updateEffect=new t.Effect("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},r.prototype._recreateRenderEffect=function(){var i="";if(this._scene.clipPlane&&(i=`
#define CLIPPLANE`),this._scene.clipPlane2&&(i=`
#define CLIPPLANE2`),this._scene.clipPlane3&&(i=`
#define CLIPPLANE3`),this._scene.clipPlane4&&(i=`
#define CLIPPLANE4`),this.blendMode===t.ParticleSystem.BLENDMODE_MULTIPLY&&(i=`
#define BLENDMULTIPLYMODE`),this._isBillboardBased)switch(i+=`
#define BILLBOARD`,this.billboardMode){case t.ParticleSystem.BILLBOARDMODE_Y:i+=`
#define BILLBOARDY`;break;case t.ParticleSystem.BILLBOARDMODE_STRETCHED:i+=`
#define BILLBOARDSTRETCHED`;break;case t.ParticleSystem.BILLBOARDMODE_ALL:default:break}if(this._colorGradientsTexture&&(i+=`
#define COLORGRADIENTS`),this.isAnimationSheetEnabled&&(i+=`
#define ANIMATESHEET`),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),i+=`
`+this._imageProcessingConfigurationDefines.toString()),!(this._renderEffect&&this._renderEffect.defines===i)){var a=["view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","sheetInfos","translationPivot","eyePosition"],n=["textureSampler","colorGradientSampler"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareUniforms(a,this._imageProcessingConfigurationDefines),t.ImageProcessingConfiguration.PrepareSamplers(n,this._imageProcessingConfigurationDefines)),this._renderEffect=new t.Effect("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],a,n,this._scene.getEngine(),i)}},r.prototype.animate=function(i){i===void 0&&(i=!1),this._timeDelta=this.updateSpeed*(i?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},r.prototype._createFactorGradientTexture=function(i,a){var n=this[a];if(!(!i||!i.length||n)){for(var s=new Float32Array(this._rawTextureWidth),o=0;o<this._rawTextureWidth;o++){var l=o/this._rawTextureWidth;t.Tools.GetCurrentGradient(l,i,function(u,h,d){s[o]=t.Scalar.Lerp(u.factor1,h.factor1,d)})}this[a]=t.RawTexture.CreateRTexture(s,this._rawTextureWidth,1,this._scene,!1,!1,t.Texture.NEAREST_SAMPLINGMODE)}},r.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},r.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},r.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},r.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},r.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},r.prototype._createColorGradientTexture=function(){if(!(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)){for(var i=new Uint8Array(this._rawTextureWidth*4),a=t.Tmp.Color4[0],n=0;n<this._rawTextureWidth;n++){var s=n/this._rawTextureWidth;t.Tools.GetCurrentGradient(s,this._colorGradients,function(o,l,u){t.Color4.LerpToRef(o.color1,l.color1,u,a),i[n*4]=a.r*255,i[n*4+1]=a.g*255,i[n*4+2]=a.b*255,i[n*4+3]=a.a*255})}this._colorGradientsTexture=t.RawTexture.CreateRGBATexture(i,this._rawTextureWidth,1,this._scene,!1,!1,t.Texture.NEAREST_SAMPLINGMODE)}},r.prototype.render=function(i){if(i===void 0&&(i=!1),!this._started||(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady()))return 0;if(!i){if(!this._preWarmDone&&this.preWarmCycles){for(var a=0;a<this.preWarmCycles;a++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId())return 0;this._currentRenderId=this._scene.getRenderId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var n=this._accumulatedCount|0;this._accumulatedCount-=n,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+n)}if(!this._currentActiveCount)return 0;this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength));var s;if(this.emitter.position){var o=this.emitter;s=o.getWorldMatrix()}else{var l=this.emitter;s=t.Matrix.Translation(l.x,l.y,l.z)}if(this._updateEffect.setMatrix("emitterWM",s),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(t.Material.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!i){this._engine.enableEffect(this._renderEffect);var u=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",u),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var h=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/h.width,this.spriteCellHeight/h.height,h.width/this.spriteCellWidth)}if(this._isBillboardBased){var d=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",d.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var p=u.clone();p.invert(),this._renderEffect.setMatrix("invView",p),t.MaterialHelper.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case t.ParticleSystem.BLENDMODE_ADD:this._engine.setAlphaMode(t.Engine.ALPHA_ADD);break;case t.ParticleSystem.BLENDMODE_ONEONE:this._engine.setAlphaMode(t.Engine.ALPHA_ONEONE);break;case t.ParticleSystem.BLENDMODE_STANDARD:this._engine.setAlphaMode(t.Engine.ALPHA_COMBINE);break;case t.ParticleSystem.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(t.Engine.ALPHA_MULTIPLY);break}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(t.Material.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(t.Engine.ALPHA_DISABLE)}this._targetIndex++,this._targetIndex===2&&(this._targetIndex=0);var m=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=m,this._currentActiveCount},r.prototype.rebuild=function(){this._initialize(!0)},r.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},r.prototype._releaseVAOs=function(){if(this._updateVAO){for(var i=0;i<this._updateVAO.length;i++)this._engine.releaseVertexArrayObject(this._updateVAO[i]);this._updateVAO=[];for(var i=0;i<this._renderVAO.length;i++)this._engine.releaseVertexArrayObject(this._renderVAO[i]);this._renderVAO=[]}},r.prototype.dispose=function(i){i===void 0&&(i=!0);var a=this._scene.particleSystems.indexOf(this);a>-1&&this._scene.particleSystems.splice(a,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),i&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),i&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},r.prototype.clone=function(i,a){var n=new r(i,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return t.Tools.DeepCopy(this,n),a===void 0&&(a=this.emitter),n.emitter=a,this.particleTexture&&(n.particleTexture=new t.Texture(this.particleTexture.url,this._scene)),n},r.prototype.serialize=function(){var i={};return t.ParticleSystem._Serialize(i,this),i.activeParticleCount=this.activeParticleCount,i},r.Parse=function(i,a,n,s){s===void 0&&(s=!1);var o=i.name,l=new r(o,{capacity:i.capacity,randomTextureSize:i.randomTextureSize},a);return i.activeParticleCount&&(l.activeParticleCount=i.activeParticleCount),t.ParticleSystem._Parse(i,l,a,n),i.preventAutoStart&&(l.preventAutoStart=i.preventAutoStart),!s&&!l.preventAutoStart&&l.start(),l},r}(t.BaseParticleSystem);t.GPUParticleSystem=f})(T||(T={}));var T;(function(t){var f=function(){function i(a,n,s,o,l,u,h,d){d===void 0&&(d=null),this.idx=0,this.color=new t.Color4(1,1,1,1),this.position=t.Vector3.Zero(),this.rotation=t.Vector3.Zero(),this.scaling=t.Vector3.One(),this.uvs=new t.Vector4(0,0,1,1),this.velocity=t.Vector3.Zero(),this.pivot=t.Vector3.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=t.Vector3.Zero(),this.idx=a,this._pos=n,this._ind=s,this._model=o,this.shapeId=l,this.idxInShape=u,this._sps=h,d&&(this._modelBoundingInfo=d,this._boundingInfo=new t.BoundingInfo(d.minimum,d.maximum))}return Object.defineProperty(i.prototype,"scale",{get:function(){return this.scaling},set:function(a){this.scaling=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(a){this.rotationQuaternion=a},enumerable:!0,configurable:!0}),i.prototype.intersectsMesh=function(a){return!this._boundingInfo||!a._boundingInfo?!1:this._sps._bSphereOnly?t.BoundingSphere.Intersects(this._boundingInfo.boundingSphere,a._boundingInfo.boundingSphere):this._boundingInfo.intersects(a._boundingInfo,!1)},i}();t.SolidParticle=f;var c=function(){function i(a,n,s,o,l,u){this._indicesLength=0,this.shapeID=a,this._shape=n,this._indicesLength=s,this._shapeUV=o,this._positionFunction=l,this._vertexFunction=u}return i}();t.ModelShape=c;var r=function(){function i(){this.ind=0,this.indicesLength=0,this.sqDistance=0}return i}();t.DepthSortedParticle=r})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new t.SolidParticle(0,0,0,null,0,0,this),this._color=new t.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._cam_axisZ=t.Vector3.Zero(),this._cam_axisY=t.Vector3.Zero(),this._cam_axisX=t.Vector3.Zero(),this._axisZ=t.Axis.Z,this._camDir=t.Vector3.Zero(),this._camInvertedPosition=t.Vector3.Zero(),this._rotMatrix=new t.Matrix,this._invertMatrix=new t.Matrix,this._rotated=t.Vector3.Zero(),this._quaternion=new t.Quaternion,this._vertex=t.Vector3.Zero(),this._normal=t.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._mustUnrotateFixedNormals=!1,this._minimum=t.Vector3.Zero(),this._maximum=t.Vector3.Zero(),this._minBbox=t.Vector3.Zero(),this._maxBbox=t.Vector3.Zero(),this._particlesIntersect=!1,this._depthSortFunction=function(n,s){return s.sqDistance-n.sqDistance},this._needs32Bits=!1,this._pivotBackTranslation=t.Vector3.Zero(),this._scaledPivot=t.Vector3.Zero(),this._particleHasParent=!1,this.name=r,this._scene=i||t.Engine.LastCreatedScene,this._camera=i.activeCamera,this._pickable=a?a.isPickable:!1,this._depthSort=a?a.enableDepthSort:!1,this._particlesIntersect=a?a.particleIntersection:!1,this._bSphereOnly=a?a.boundingSphereOnly:!1,this._bSphereRadiusFactor=a&&a.bSphereRadiusFactor?a.bSphereRadiusFactor:1,a&&a.updatable!==void 0?this._updatable=a.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return c.prototype.buildMesh=function(){if(this.nbParticles===0){var r=t.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(r,1),r.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&t.VertexData.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var i=new t.VertexData;i.indices=this._depthSort?this._indices:this._indices32,i.set(this._positions32,t.VertexBuffer.PositionKind),i.set(this._normals32,t.VertexBuffer.NormalKind),this._uvs32.length>0&&i.set(this._uvs32,t.VertexBuffer.UVKind),this._colors32.length>0&&i.set(this._colors32,t.VertexBuffer.ColorKind);var a=new t.Mesh(this.name,this._scene);return i.applyToMesh(a,this._updatable),this.mesh=a,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),a},c.prototype.digest=function(r,i){var a=i&&i.facetNb||1,n=i&&i.number||0,s=i&&i.delta||0,o=r.getVerticesData(t.VertexBuffer.PositionKind),l=r.getIndices(),u=r.getVerticesData(t.VertexBuffer.UVKind),h=r.getVerticesData(t.VertexBuffer.ColorKind),d=r.getVerticesData(t.VertexBuffer.NormalKind),p=0,m=l.length/3;n?(n=n>m?m:n,a=Math.round(m/n),s=0):a=a>m?m:a;for(var _=[],v=[],S=[],P=[],x=t.Vector3.Zero(),R=a;p<m;){a=R+Math.floor((1+s)*Math.random()),p>m-a&&(a=m-p),_.length=0,v.length=0,S.length=0,P.length=0;for(var w=0,I=p*3;I<(p+a)*3;I++){v.push(w);var F=l[I];_.push(o[F*3],o[F*3+1],o[F*3+2]),u&&S.push(u[F*2],u[F*2+1]),h&&P.push(h[F*4],h[F*4+1],h[F*4+2],h[F*4+3]),w++}var k=this.nbParticles,E=this._posToShape(_),g=this._uvsToShapeUV(S),y;for(y=0;y<E.length;y++)x.addInPlace(E[y]);for(x.scaleInPlace(1/E.length),y=0;y<E.length;y++)E[y].subtractInPlace(x);var M;this._particlesIntersect&&(M=new t.BoundingInfo(x,x));var C=new t.ModelShape(this._shapeCounter,E,a*3,g,null,null),D=this._positions.length,V=this._indices.length;this._meshBuilder(this._index,E,this._positions,v,this._indices,S,this._uvs,P,this._colors,d,this._normals,k,0,null),this._addParticle(k,D,V,C,this._shapeCounter,0,M),this.particles[this.nbParticles].position.addInPlace(x),this._index+=E.length,k++,this.nbParticles++,this._shapeCounter++,p+=a}return this},c.prototype._unrotateFixedNormals=function(){for(var r=0,i=0,a=0;a<this.particles.length;a++){this._particle=this.particles[a],this._shape=this._particle._model._shape,this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix);for(var n=0;n<this._shape.length;n++)i=r+n*3,t.Vector3.TransformNormalFromFloatsToRef(this._normals32[i],this._normals32[i+1],this._normals32[i+2],this._invertMatrix,this._normal),this._fixedNormal32[i]=this._normal.x,this._fixedNormal32[i+1]=this._normal.y,this._fixedNormal32[i+2]=this._normal.z;r=i+3}},c.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null,this._copy.translateFromPivot=!1},c.prototype._meshBuilder=function(r,i,a,n,s,o,l,u,h,d,p,m,_,v){var S,P=0,x=0,R=0;for(this._resetCopy(),v&&v.positionFunction&&(v.positionFunction(this._copy,m,_),this._mustUnrotateFixedNormals=!0),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._scaledPivot.x=this._copy.pivot.x*this._copy.scaling.x,this._scaledPivot.y=this._copy.pivot.y*this._copy.scaling.y,this._scaledPivot.z=this._copy.pivot.z*this._copy.scaling.z,this._copy.translateFromPivot?this._pivotBackTranslation.copyFromFloats(0,0,0):this._pivotBackTranslation.copyFrom(this._scaledPivot),S=0;S<i.length;S++)this._vertex.x=i[S].x,this._vertex.y=i[S].y,this._vertex.z=i[S].z,v&&v.vertexFunction&&v.vertexFunction(this._copy,this._vertex,S),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,t.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._rotated.addInPlace(this._pivotBackTranslation),a.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),o&&(l.push((this._copy.uvs.z-this._copy.uvs.x)*o[P]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*o[P+1]+this._copy.uvs.y),P+=2),this._copy.color?this._color=this._copy.color:u&&u[x]!==void 0?(this._color.r=u[x],this._color.g=u[x+1],this._color.b=u[x+2],this._color.a=u[x+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),h.push(this._color.r,this._color.g,this._color.b,this._color.a),x+=4,!this.recomputeNormals&&d&&(this._normal.x=d[R],this._normal.y=d[R+1],this._normal.z=d[R+2],t.Vector3.TransformNormalToRef(this._normal,this._rotMatrix,this._normal),p.push(this._normal.x,this._normal.y,this._normal.z),R+=3);for(S=0;S<n.length;S++){var w=r+n[S];s.push(w),w>65535&&(this._needs32Bits=!0)}if(this._pickable){var I=n.length/3;for(S=0;S<I;S++)this.pickedParticles.push({idx:m,faceId:S})}return this._depthSort&&this.depthSortedParticles.push(new t.DepthSortedParticle),this._copy},c.prototype._posToShape=function(r){for(var i=[],a=0;a<r.length;a+=3)i.push(new t.Vector3(r[a],r[a+1],r[a+2]));return i},c.prototype._uvsToShapeUV=function(r){var i=[];if(r)for(var a=0;a<r.length;a++)i.push(r[a]);return i},c.prototype._addParticle=function(r,i,a,n,s,o,l){l===void 0&&(l=null);var u=new t.SolidParticle(r,i,a,n,s,o,this,l);return this.particles.push(u),u},c.prototype.addShape=function(r,i,a){var n=r.getVerticesData(t.VertexBuffer.PositionKind),s=r.getIndices(),o=r.getVerticesData(t.VertexBuffer.UVKind),l=r.getVerticesData(t.VertexBuffer.ColorKind),u=r.getVerticesData(t.VertexBuffer.NormalKind),h;this._particlesIntersect&&(h=r.getBoundingInfo());for(var d=this._posToShape(n),p=this._uvsToShapeUV(o),m=a?a.positionFunction:null,_=a?a.vertexFunction:null,v=new t.ModelShape(this._shapeCounter,d,s.length,p,m,_),S,P,x=this.nbParticles,R=0;R<i;R++){var w=this._positions.length,I=this._indices.length;P=this._meshBuilder(this._index,d,this._positions,s,this._indices,o,this._uvs,l,this._colors,u,this._normals,x,R,a),this._updatable&&(S=this._addParticle(x,w,I,v,this._shapeCounter,R,h),S.position.copyFrom(P.position),S.rotation.copyFrom(P.rotation),P.rotationQuaternion&&S.rotationQuaternion&&S.rotationQuaternion.copyFrom(P.rotationQuaternion),P.color&&S.color&&S.color.copyFrom(P.color),S.scaling.copyFrom(P.scaling),S.uvs.copyFrom(P.uvs)),this._index+=d.length,x++}return this.nbParticles+=i,this._shapeCounter++,this._shapeCounter-1},c.prototype._rebuildParticle=function(r){this._resetCopy(),r._model._positionFunction&&r._model._positionFunction(this._copy,r.idx,r.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._scaledPivot.x=this._particle.pivot.x*this._particle.scaling.x,this._scaledPivot.y=this._particle.pivot.y*this._particle.scaling.y,this._scaledPivot.z=this._particle.pivot.z*this._particle.scaling.z,this._copy.translateFromPivot?this._pivotBackTranslation.copyFromFloats(0,0,0):this._pivotBackTranslation.copyFrom(this._scaledPivot),this._shape=r._model._shape;for(var i=0;i<this._shape.length;i++)this._vertex.x=this._shape[i].x,this._vertex.y=this._shape[i].y,this._vertex.z=this._shape[i].z,r._model._vertexFunction&&r._model._vertexFunction(this._copy,this._vertex,i),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,t.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._rotated.addInPlace(this._pivotBackTranslation),this._positions32[r._pos+i*3]=this._copy.position.x+this._rotated.x,this._positions32[r._pos+i*3+1]=this._copy.position.y+this._rotated.y,this._positions32[r._pos+i*3+2]=this._copy.position.z+this._rotated.z;r.position.x=0,r.position.y=0,r.position.z=0,r.rotation.x=0,r.rotation.y=0,r.rotation.z=0,r.rotationQuaternion=null,r.scaling.x=1,r.scaling.y=1,r.scaling.z=1,r.uvs.x=0,r.uvs.y=0,r.uvs.z=1,r.uvs.w=1,r.pivot.x=0,r.pivot.y=0,r.pivot.z=0,r.translateFromPivot=!1,r.parentId=null},c.prototype.rebuildMesh=function(){for(var r=0;r<this.particles.length;r++)this._rebuildParticle(this.particles[r]);return this.mesh.updateVerticesData(t.VertexBuffer.PositionKind,this._positions32,!1,!1),this},c.prototype.setParticles=function(r,i,a){if(r===void 0&&(r=0),i===void 0&&(i=this.nbParticles-1),a===void 0&&(a=!0),!this._updatable)return this;if(this.beforeUpdateParticles(r,i,a),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,(this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(this._invertMatrix)),this.billboard){this._camera.getDirectionToRef(this._axisZ,this._camDir),t.Vector3.TransformNormalToRef(this._camDir,this._invertMatrix,this._cam_axisZ),this._cam_axisZ.normalize();var n=this._camera.getViewMatrix(!0);t.Vector3.TransformNormalFromFloatsToRef(n.m[1],n.m[5],n.m[9],this._invertMatrix,this._cam_axisY),t.Vector3.CrossToRef(this._cam_axisY,this._cam_axisZ,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize()}this._depthSort&&t.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._camInvertedPosition),t.Matrix.IdentityToRef(this._rotMatrix);var s=0,o=0,l=0,u=0,h=0,d=0,p=0;this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),i=i>=this.nbParticles?this.nbParticles-1:i,this._computeBoundingBox&&(r==0&&i==this.nbParticles-1?(t.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),t.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)):this.mesh._boundingInfo&&(this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum),this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum))),o=this.particles[r]._pos;var m=o/3|0;u=m*4,d=m*2;for(var _=r;_<=i;_++){if(this._particle=this.particles[_],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._depthSort&&this._depthSortParticles){var v=this.depthSortedParticles[_];v.ind=this._particle._ind,v.indicesLength=this._particle._model._indicesLength,v.sqDistance=t.Vector3.DistanceSquared(this._particle.position,this._camInvertedPosition)}if(!this._particle.alive||this._particle._stillInvisible&&!this._particle.isVisible){p=this._shape.length,o+=p*3,u+=p*4,d+=p*2;continue}if(this._particle.isVisible)for(this._particle._stillInvisible=!1,this._particleHasParent=this._particle.parentId!==null,this._scaledPivot.x=this._particle.pivot.x*this._particle.scaling.x,this._scaledPivot.y=this._particle.pivot.y*this._particle.scaling.y,this._scaledPivot.z=this._particle.pivot.z*this._particle.scaling.z,this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),(this._computeParticleRotation||this.billboard)&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),this._particleHasParent?(this._parent=this.particles[this._particle.parentId],this._rotated.x=this._particle.position.x*this._parent._rotationMatrix[0]+this._particle.position.y*this._parent._rotationMatrix[3]+this._particle.position.z*this._parent._rotationMatrix[6],this._rotated.y=this._particle.position.x*this._parent._rotationMatrix[1]+this._particle.position.y*this._parent._rotationMatrix[4]+this._particle.position.z*this._parent._rotationMatrix[7],this._rotated.z=this._particle.position.x*this._parent._rotationMatrix[2]+this._particle.position.y*this._parent._rotationMatrix[5]+this._particle.position.z*this._parent._rotationMatrix[8],this._particle._globalPosition.x=this._parent._globalPosition.x+this._rotated.x,this._particle._globalPosition.y=this._parent._globalPosition.y+this._rotated.y,this._particle._globalPosition.z=this._parent._globalPosition.z+this._rotated.z,(this._computeParticleRotation||this.billboard)&&(this._particle._rotationMatrix[0]=this._rotMatrix.m[0]*this._parent._rotationMatrix[0]+this._rotMatrix.m[1]*this._parent._rotationMatrix[3]+this._rotMatrix.m[2]*this._parent._rotationMatrix[6],this._particle._rotationMatrix[1]=this._rotMatrix.m[0]*this._parent._rotationMatrix[1]+this._rotMatrix.m[1]*this._parent._rotationMatrix[4]+this._rotMatrix.m[2]*this._parent._rotationMatrix[7],this._particle._rotationMatrix[2]=this._rotMatrix.m[0]*this._parent._rotationMatrix[2]+this._rotMatrix.m[1]*this._parent._rotationMatrix[5]+this._rotMatrix.m[2]*this._parent._rotationMatrix[8],this._particle._rotationMatrix[3]=this._rotMatrix.m[4]*this._parent._rotationMatrix[0]+this._rotMatrix.m[5]*this._parent._rotationMatrix[3]+this._rotMatrix.m[6]*this._parent._rotationMatrix[6],this._particle._rotationMatrix[4]=this._rotMatrix.m[4]*this._parent._rotationMatrix[1]+this._rotMatrix.m[5]*this._parent._rotationMatrix[4]+this._rotMatrix.m[6]*this._parent._rotationMatrix[7],this._particle._rotationMatrix[5]=this._rotMatrix.m[4]*this._parent._rotationMatrix[2]+this._rotMatrix.m[5]*this._parent._rotationMatrix[5]+this._rotMatrix.m[6]*this._parent._rotationMatrix[8],this._particle._rotationMatrix[6]=this._rotMatrix.m[8]*this._parent._rotationMatrix[0]+this._rotMatrix.m[9]*this._parent._rotationMatrix[3]+this._rotMatrix.m[10]*this._parent._rotationMatrix[6],this._particle._rotationMatrix[7]=this._rotMatrix.m[8]*this._parent._rotationMatrix[1]+this._rotMatrix.m[9]*this._parent._rotationMatrix[4]+this._rotMatrix.m[10]*this._parent._rotationMatrix[7],this._particle._rotationMatrix[8]=this._rotMatrix.m[8]*this._parent._rotationMatrix[2]+this._rotMatrix.m[9]*this._parent._rotationMatrix[5]+this._rotMatrix.m[10]*this._parent._rotationMatrix[8])):(this._particle._globalPosition.x=this._particle.position.x,this._particle._globalPosition.y=this._particle.position.y,this._particle._globalPosition.z=this._particle.position.z,(this._computeParticleRotation||this.billboard)&&(this._particle._rotationMatrix[0]=this._rotMatrix.m[0],this._particle._rotationMatrix[1]=this._rotMatrix.m[1],this._particle._rotationMatrix[2]=this._rotMatrix.m[2],this._particle._rotationMatrix[3]=this._rotMatrix.m[4],this._particle._rotationMatrix[4]=this._rotMatrix.m[5],this._particle._rotationMatrix[5]=this._rotMatrix.m[6],this._particle._rotationMatrix[6]=this._rotMatrix.m[8],this._particle._rotationMatrix[7]=this._rotMatrix.m[9],this._particle._rotationMatrix[8]=this._rotMatrix.m[10])),this._particle.translateFromPivot?(this._pivotBackTranslation.x=0,this._pivotBackTranslation.y=0,this._pivotBackTranslation.z=0):(this._pivotBackTranslation.x=this._scaledPivot.x,this._pivotBackTranslation.y=this._scaledPivot.y,this._pivotBackTranslation.z=this._scaledPivot.z),p=0;p<this._shape.length;p++)s=o+p*3,l=u+p*4,h=d+p*2,this._vertex.x=this._shape[p].x,this._vertex.y=this._shape[p].y,this._vertex.z=this._shape[p].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,p),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._vertex.x-=this._scaledPivot.x,this._vertex.y-=this._scaledPivot.y,this._vertex.z-=this._scaledPivot.z,this._rotated.x=this._vertex.x*this._particle._rotationMatrix[0]+this._vertex.y*this._particle._rotationMatrix[3]+this._vertex.z*this._particle._rotationMatrix[6],this._rotated.y=this._vertex.x*this._particle._rotationMatrix[1]+this._vertex.y*this._particle._rotationMatrix[4]+this._vertex.z*this._particle._rotationMatrix[7],this._rotated.z=this._vertex.x*this._particle._rotationMatrix[2]+this._vertex.y*this._particle._rotationMatrix[5]+this._vertex.z*this._particle._rotationMatrix[8],this._rotated.x+=this._pivotBackTranslation.x,this._rotated.y+=this._pivotBackTranslation.y,this._rotated.z+=this._pivotBackTranslation.z,this._positions32[s]=this._particle._globalPosition.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[s+1]=this._particle._globalPosition.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[s+2]=this._particle._globalPosition.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[s]<this._minimum.x&&(this._minimum.x=this._positions32[s]),this._positions32[s]>this._maximum.x&&(this._maximum.x=this._positions32[s]),this._positions32[s+1]<this._minimum.y&&(this._minimum.y=this._positions32[s+1]),this._positions32[s+1]>this._maximum.y&&(this._maximum.y=this._positions32[s+1]),this._positions32[s+2]<this._minimum.z&&(this._minimum.z=this._positions32[s+2]),this._positions32[s+2]>this._maximum.z&&(this._maximum.z=this._positions32[s+2])),this._computeParticleVertex||(this._normal.x=this._fixedNormal32[s],this._normal.y=this._fixedNormal32[s+1],this._normal.z=this._fixedNormal32[s+2],this._rotated.x=this._normal.x*this._particle._rotationMatrix[0]+this._normal.y*this._particle._rotationMatrix[3]+this._normal.z*this._particle._rotationMatrix[6],this._rotated.y=this._normal.x*this._particle._rotationMatrix[1]+this._normal.y*this._particle._rotationMatrix[4]+this._normal.z*this._particle._rotationMatrix[7],this._rotated.z=this._normal.x*this._particle._rotationMatrix[2]+this._normal.y*this._particle._rotationMatrix[5]+this._normal.z*this._particle._rotationMatrix[8],this._normals32[s]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[s+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[s+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&this._particle.color&&(this._colors32[l]=this._particle.color.r,this._colors32[l+1]=this._particle.color.g,this._colors32[l+2]=this._particle.color.b,this._colors32[l+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[p*2]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[p*2+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(this._particle._stillInvisible=!0,p=0;p<this._shape.length;p++)s=o+p*3,l=u+p*4,h=d+p*2,this._positions32[s]=0,this._positions32[s+1]=0,this._positions32[s+2]=0,this._normals32[s]=0,this._normals32[s+1]=0,this._normals32[s+2]=0,this._computeParticleColor&&this._particle.color&&(this._colors32[l]=this._particle.color.r,this._colors32[l+1]=this._particle.color.g,this._colors32[l+2]=this._particle.color.b,this._colors32[l+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[p*2]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[p*2+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);if(this._particlesIntersect){var S=this._particle._boundingInfo,P=S.boundingBox,x=S.boundingSphere;if(!this._bSphereOnly){for(var R=0;R<P.vectors.length;R++)this._vertex.x=this._particle._modelBoundingInfo.boundingBox.vectors[R].x*this._particle.scaling.x,this._vertex.y=this._particle._modelBoundingInfo.boundingBox.vectors[R].y*this._particle.scaling.y,this._vertex.z=this._particle._modelBoundingInfo.boundingBox.vectors[R].z*this._particle.scaling.z,this._rotated.x=this._vertex.x*this._particle._rotationMatrix[0]+this._vertex.y*this._particle._rotationMatrix[3]+this._vertex.z*this._particle._rotationMatrix[6],this._rotated.y=this._vertex.x*this._particle._rotationMatrix[1]+this._vertex.y*this._particle._rotationMatrix[4]+this._vertex.z*this._particle._rotationMatrix[7],this._rotated.z=this._vertex.x*this._particle._rotationMatrix[2]+this._vertex.y*this._particle._rotationMatrix[5]+this._vertex.z*this._particle._rotationMatrix[8],P.vectors[R].x=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,P.vectors[R].y=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,P.vectors[R].z=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z;P._update(this.mesh._worldMatrix)}this._minBbox.x=this._particle._modelBoundingInfo.minimum.x*this._particle.scaling.x,this._minBbox.y=this._particle._modelBoundingInfo.minimum.y*this._particle.scaling.y,this._minBbox.z=this._particle._modelBoundingInfo.minimum.z*this._particle.scaling.z,this._maxBbox.x=this._particle._modelBoundingInfo.maximum.x*this._particle.scaling.x,this._maxBbox.y=this._particle._modelBoundingInfo.maximum.y*this._particle.scaling.y,this._maxBbox.z=this._particle._modelBoundingInfo.maximum.z*this._particle.scaling.z,x.center.x=this._particle._globalPosition.x+(this._minBbox.x+this._maxBbox.x)*.5,x.center.y=this._particle._globalPosition.y+(this._minBbox.y+this._maxBbox.y)*.5,x.center.z=this._particle._globalPosition.z+(this._minBbox.z+this._maxBbox.z)*.5,x.radius=this._bSphereRadiusFactor*.5*Math.sqrt((this._maxBbox.x-this._minBbox.x)*(this._maxBbox.x-this._minBbox.x)+(this._maxBbox.y-this._minBbox.y)*(this._maxBbox.y-this._minBbox.y)+(this._maxBbox.z-this._minBbox.z)*(this._maxBbox.z-this._minBbox.z)),x._update(this.mesh._worldMatrix)}o=s+3,u=l+4,d=h+2}if(a){if(this._computeParticleColor&&this.mesh.updateVerticesData(t.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(t.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(t.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen||this.mesh.isFacetDataEnabled){if(this._computeParticleVertex||this.mesh.isFacetDataEnabled){var w=this.mesh.isFacetDataEnabled?this.mesh.getFacetDataParameters():null;t.VertexData.ComputeNormals(this._positions32,this._indices32,this._normals32,w);for(var I=0;I<this._normals32.length;I++)this._fixedNormal32[I]=this._normals32[I]}this.mesh.areNormalsFrozen||this.mesh.updateVerticesData(t.VertexBuffer.NormalKind,this._normals32,!1,!1)}if(this._depthSort&&this._depthSortParticles){this.depthSortedParticles.sort(this._depthSortFunction);var F=this.depthSortedParticles.length,k=0,E=0,g=0,y=0;for(k=0;k<F;k++){E=this.depthSortedParticles[k].indicesLength,g=this.depthSortedParticles[k].ind;for(var I=0;I<E;I++)this._indices32[y]=this._indices[g+I],y++}this.mesh.updateIndices(this._indices32)}}return this._computeBoundingBox&&(this.mesh._boundingInfo=new t.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(r,i,a),this},c.prototype._quaternionRotationYPR=function(){this._halfroll=this._roll*.5,this._halfpitch=this._pitch*.5,this._halfyaw=this._yaw*.5,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},c.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[3]=0,this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[7]=0,this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[11]=0,this._rotMatrix.m[12]=0,this._rotMatrix.m[13]=0,this._rotMatrix.m[14]=0,this._rotMatrix.m[15]=1},c.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},c.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},c.prototype.setVisibilityBox=function(r){var i=r/2;this.mesh._boundingInfo=new t.BoundingInfo(new t.Vector3(-i,-i,-i),new t.Vector3(i,i,i))},Object.defineProperty(c.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(r){this._alwaysVisible=r,this.mesh.alwaysSelectAsActiveMesh=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(r){this._isVisibilityBoxLocked=r;var i=this.mesh.getBoundingInfo();i.isLocked=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(r){this._computeParticleRotation=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(r){this._computeParticleColor=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(r){this._computeParticleTexture=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(r){this._computeParticleVertex=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(r){this._computeBoundingBox=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(r){this._depthSortParticles=r},enumerable:!0,configurable:!0}),c.prototype.initParticles=function(){},c.prototype.recycleParticle=function(r){return r},c.prototype.updateParticle=function(r){return r},c.prototype.updateParticleVertex=function(r,i,a){return i},c.prototype.beforeUpdateParticles=function(r,i,a){},c.prototype.afterUpdateParticles=function(r,i,a){},c}();t.SolidParticleSystem=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.updateSideOrientation=function(r){return r==t.Mesh.DOUBLESIDE?t.Mesh.DOUBLESIDE:r??t.Mesh.FRONTSIDE},c.CreateBox=function(r,i,a){a===void 0&&(a=null);var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateBox(i);return s.applyToMesh(n,i.updatable),n},c.CreateSphere=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateSphere(i);return s.applyToMesh(n,i.updatable),n},c.CreateDisc=function(r,i,a){a===void 0&&(a=null);var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateDisc(i);return s.applyToMesh(n,i.updatable),n},c.CreateIcoSphere=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateIcoSphere(i);return s.applyToMesh(n,i.updatable),n},c.CreateRibbon=function(r,i,a){a===void 0&&(a=null);var n=i.pathArray,s=i.closeArray,o=i.closePath,l=c.updateSideOrientation(i.sideOrientation),u=i.instance,h=i.updatable;if(u){t.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,t.Tmp.Vector3[0]),t.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,t.Tmp.Vector3[1]);var d=function(g){for(var y=n[0].length,M=u,C=0,D=M._originalBuilderSideOrientation===t.Mesh.DOUBLESIDE?2:1,V=1;V<=D;V++)for(var G=0;G<n.length;G++){var U=n[G],z=U.length;y=y<z?y:z;for(var H=0;H<y;)g[C]=U[H].x,g[C+1]=U[H].y,g[C+2]=U[H].z,U[H].x<t.Tmp.Vector3[0].x&&(t.Tmp.Vector3[0].x=U[H].x),U[H].x>t.Tmp.Vector3[1].x&&(t.Tmp.Vector3[1].x=U[H].x),U[H].y<t.Tmp.Vector3[0].y&&(t.Tmp.Vector3[0].y=U[H].y),U[H].y>t.Tmp.Vector3[1].y&&(t.Tmp.Vector3[1].y=U[H].y),U[H].z<t.Tmp.Vector3[0].z&&(t.Tmp.Vector3[0].z=U[H].z),U[H].z>t.Tmp.Vector3[1].z&&(t.Tmp.Vector3[1].z=U[H].z),H++,C+=3;M._creationDataStorage&&M._creationDataStorage.closePath&&(g[C]=U[0].x,g[C+1]=U[0].y,g[C+2]=U[0].z,C+=3)}},p=u.getVerticesData(t.VertexBuffer.PositionKind);if(d(p),u._boundingInfo=new t.BoundingInfo(t.Tmp.Vector3[2],t.Tmp.Vector3[3]),u._boundingInfo.update(u._worldMatrix),u.updateVerticesData(t.VertexBuffer.PositionKind,p,!1,!1),i.colors){for(var m=u.getVerticesData(t.VertexBuffer.ColorKind),_=0;_<i.colors.length;_++)m[_*4]=i.colors[_].r,m[_*4+1]=i.colors[_].g,m[_*4+2]=i.colors[_].b,m[_*4+3]=i.colors[_].a;u.updateVerticesData(t.VertexBuffer.ColorKind,m,!1,!1)}if(i.uvs){for(var v=u.getVerticesData(t.VertexBuffer.UVKind),S=0;S<i.uvs.length;S++)v[S*2]=i.uvs[S].x,v[S*2+1]=i.uvs[S].y;u.updateVerticesData(t.VertexBuffer.UVKind,v,!1,!1)}if(!u.areNormalsFrozen||u.isFacetDataEnabled){var P=u.getIndices(),x=u.getVerticesData(t.VertexBuffer.NormalKind),R=u.isFacetDataEnabled?u.getFacetDataParameters():null;if(t.VertexData.ComputeNormals(p,P,x,R),u._creationDataStorage&&u._creationDataStorage.closePath)for(var w=0,I=0,F=0;F<n.length;F++)w=u._creationDataStorage.idx[F]*3,F+1<n.length?I=(u._creationDataStorage.idx[F+1]-1)*3:I=x.length-3,x[w]=(x[w]+x[I])*.5,x[w+1]=(x[w+1]+x[I+1])*.5,x[w+2]=(x[w+2]+x[I+2])*.5,x[I]=x[w],x[I+1]=x[w+1],x[I+2]=x[w+2];u.areNormalsFrozen||u.updateVerticesData(t.VertexBuffer.NormalKind,x,!1,!1)}return u}else{var k=new t.Mesh(r,a);k._originalBuilderSideOrientation=l,k._creationDataStorage=new t._CreationDataStorage;var E=t.VertexData.CreateRibbon(i);return o&&(k._creationDataStorage.idx=E._idx),k._creationDataStorage.closePath=o,k._creationDataStorage.closeArray=s,E.applyToMesh(k,h),k}},c.CreateCylinder=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateCylinder(i);return s.applyToMesh(n,i.updatable),n},c.CreateTorus=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateTorus(i);return s.applyToMesh(n,i.updatable),n},c.CreateTorusKnot=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreateTorusKnot(i);return s.applyToMesh(n,i.updatable),n},c.CreateLineSystem=function(r,i,a){var n=i.instance,s=i.lines,o=i.colors;if(n){var l=n.getVerticesData(t.VertexBuffer.PositionKind),u,h;o&&(u=n.getVerticesData(t.VertexBuffer.ColorKind));for(var d=0,p=0,m=0;m<s.length;m++)for(var _=s[m],v=0;v<_.length;v++)l[d]=_[v].x,l[d+1]=_[v].y,l[d+2]=_[v].z,o&&u&&(h=o[m],u[p]=h[v].r,u[p+1]=h[v].g,u[p+2]=h[v].b,u[p+3]=h[v].a,p+=4),d+=3;return n.updateVerticesData(t.VertexBuffer.PositionKind,l,!1,!1),o&&u&&n.updateVerticesData(t.VertexBuffer.ColorKind,u,!1,!1),n}var S=!!o,P=new t.LinesMesh(r,a,null,void 0,void 0,S,i.useVertexAlpha),x=t.VertexData.CreateLineSystem(i);return x.applyToMesh(P,i.updatable),P},c.CreateLines=function(r,i,a){a===void 0&&(a=null);var n=i.colors?[i.colors]:null,s=c.CreateLineSystem(r,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:n,useVertexAlpha:i.useVertexAlpha},a);return s},c.CreateDashedLines=function(r,i,a){a===void 0&&(a=null);var n=i.points,s=i.instance,o=i.gapSize||1,l=i.dashSize||3;if(s){var u=function(p){var m=t.Vector3.Zero(),_=p.length/6,v=0,S=0,P=0,x=0,R=0,w=0,I=0,F=0;for(I=0;I<n.length-1;I++)n[I+1].subtractToRef(n[I],m),v+=m.length();P=v/_;var k=s._creationDataStorage.dashSize,E=s._creationDataStorage.gapSize;for(x=k*P/(k+E),I=0;I<n.length-1;I++)for(n[I+1].subtractToRef(n[I],m),S=Math.floor(m.length()/P),m.normalize(),F=0;F<S&&w<p.length;)R=P*F,p[w]=n[I].x+R*m.x,p[w+1]=n[I].y+R*m.y,p[w+2]=n[I].z+R*m.z,p[w+3]=n[I].x+(R+x)*m.x,p[w+4]=n[I].y+(R+x)*m.y,p[w+5]=n[I].z+(R+x)*m.z,w+=6,F++;for(;w<p.length;)p[w]=n[I].x,p[w+1]=n[I].y,p[w+2]=n[I].z,w+=3};return s.updateMeshPositions(u,!1),s}var h=new t.LinesMesh(r,a),d=t.VertexData.CreateDashedLines(i);return d.applyToMesh(h,i.updatable),h._creationDataStorage=new t._CreationDataStorage,h._creationDataStorage.dashSize=l,h._creationDataStorage.gapSize=o,h},c.ExtrudeShape=function(r,i,a){a===void 0&&(a=null);var n=i.path,s=i.shape,o=i.scale||1,l=i.rotation||0,u=i.cap===0?0:i.cap||t.Mesh.NO_CAP,h=i.updatable,d=c.updateSideOrientation(i.sideOrientation),p=i.instance||null,m=i.invertUV||!1;return c._ExtrudeShapeGeneric(r,s,n,o,l,null,null,!1,!1,u,!1,a,!!h,d,p,m,i.frontUVs||null,i.backUVs||null)},c.ExtrudeShapeCustom=function(r,i,a){var n=i.path,s=i.shape,o=i.scaleFunction||function(){return 1},l=i.rotationFunction||function(){return 0},u=i.ribbonCloseArray||!1,h=i.ribbonClosePath||!1,d=i.cap===0?0:i.cap||t.Mesh.NO_CAP,p=i.updatable,m=c.updateSideOrientation(i.sideOrientation),_=i.instance,v=i.invertUV||!1;return c._ExtrudeShapeGeneric(r,s,n,null,null,o,l,u,h,d,!0,a,!!p,m,_||null,v,i.frontUVs||null,i.backUVs||null)},c.CreateLathe=function(r,i,a){var n=i.arc?i.arc<=0||i.arc>1?1:i.arc:1,s=i.closed===void 0?!0:i.closed,o=i.shape,l=i.radius||1,u=i.tessellation||64,h=i.clip||0,d=i.updatable,p=c.updateSideOrientation(i.sideOrientation),m=i.cap||t.Mesh.NO_CAP,_=Math.PI*2,v=new Array,S=i.invertUV||!1,P=0,x=0,R=_/u*n,w,I=new Array;for(P=0;P<=u-h;P++){var I=[];for((m==t.Mesh.CAP_START||m==t.Mesh.CAP_ALL)&&(I.push(new t.Vector3(0,o[0].y,0)),I.push(new t.Vector3(Math.cos(P*R)*o[0].x*l,o[0].y,Math.sin(P*R)*o[0].x*l))),x=0;x<o.length;x++)w=new t.Vector3(Math.cos(P*R)*o[x].x*l,o[x].y,Math.sin(P*R)*o[x].x*l),I.push(w);(m==t.Mesh.CAP_END||m==t.Mesh.CAP_ALL)&&(I.push(new t.Vector3(Math.cos(P*R)*o[o.length-1].x*l,o[o.length-1].y,Math.sin(P*R)*o[o.length-1].x*l)),I.push(new t.Vector3(0,o[o.length-1].y,0))),v.push(I)}var F=c.CreateRibbon(r,{pathArray:v,closeArray:s,sideOrientation:p,updatable:d,invertUV:S,frontUVs:i.frontUVs,backUVs:i.backUVs},a);return F},c.CreatePlane=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreatePlane(i);if(s.applyToMesh(n,i.updatable),i.sourcePlane){n.translate(i.sourcePlane.normal,i.sourcePlane.d);var o=Math.acos(t.Vector3.Dot(i.sourcePlane.normal,t.Axis.Z)),l=t.Vector3.Cross(t.Axis.Z,i.sourcePlane.normal);l.lengthSquared()>t.Epsilon&&n.rotate(l,o)}return n},c.CreateGround=function(r,i,a){var n=new t.GroundMesh(r,a);n._setReady(!1),n._subdivisionsX=i.subdivisionsX||i.subdivisions||1,n._subdivisionsY=i.subdivisionsY||i.subdivisions||1,n._width=i.width||1,n._height=i.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ;var s=t.VertexData.CreateGround(i);return s.applyToMesh(n,i.updatable),n._setReady(!0),n},c.CreateTiledGround=function(r,i,a){var n=new t.Mesh(r,a),s=t.VertexData.CreateTiledGround(i);return s.applyToMesh(n,i.updatable),n},c.CreateGroundFromHeightMap=function(r,i,a,n){var s=a.width||10,o=a.height||10,l=a.subdivisions||1,u=a.minHeight||0,h=a.maxHeight||1,d=a.colorFilter||new t.Color3(.3,.59,.11),p=a.alphaFilter||0,m=a.updatable,_=a.onReady,v=new t.GroundMesh(r,n);v._subdivisionsX=l,v._subdivisionsY=l,v._width=s,v._height=o,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ,v._setReady(!1);var S=function(P){var x=document.createElement("canvas"),R=x.getContext("2d");if(!R)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!n.isDisposed){var w=P.width,I=P.height;x.width=w,x.height=I,R.drawImage(P,0,0);var F=R.getImageData(0,0,w,I).data,k=t.VertexData.CreateGroundFromHeightMap({width:s,height:o,subdivisions:l,minHeight:u,maxHeight:h,colorFilter:d,buffer:F,bufferWidth:w,bufferHeight:I,alphaFilter:p});k.applyToMesh(v,m),_&&_(v),v._setReady(!0)}};return t.Tools.LoadImage(i,S,function(){},n.database),v},c.CreatePolygon=function(r,i,a){i.sideOrientation=c.updateSideOrientation(i.sideOrientation);for(var n=i.shape,s=i.holes||[],o=i.depth||0,l=[],u=[],h=0;h<n.length;h++)l[h]=new t.Vector2(n[h].x,n[h].z);var d=1e-8;l[0].equalsWithEpsilon(l[l.length-1],d)&&l.pop();for(var p=new t.PolygonMeshBuilder(r,l,a),m=0;m<s.length;m++){u=[];for(var _=0;_<s[m].length;_++)u.push(new t.Vector2(s[m][_].x,s[m][_].z));p.addHole(u)}var v=p.build(i.updatable,o);v._originalBuilderSideOrientation=i.sideOrientation;var S=t.VertexData.CreatePolygon(v,i.sideOrientation,i.faceUV,i.faceColors,i.frontUVs,i.backUVs);return S.applyToMesh(v,i.updatable),v},c.ExtrudePolygon=function(r,i,a){return c.CreatePolygon(r,i,a)},c.CreateTube=function(r,i,a){var n=i.path,s=i.instance,o=1;i.radius!==void 0?o=i.radius:s&&(o=s._creationDataStorage.radius);var l=i.tessellation||64,u=i.radiusFunction||null,h=i.cap||t.Mesh.NO_CAP,d=i.invertUV||!1,p=i.updatable,m=c.updateSideOrientation(i.sideOrientation);i.arc=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1;var _=function(I,F,k,E,g,y,M,C){for(var D=F.getTangents(),V=F.getNormals(),G=F.getDistances(),U=Math.PI*2,z=U/g*C,H=function(){return E},W=y||H,X,K,j,ee,$=t.Tmp.Matrix[0],L=M===t.Mesh.NO_CAP||M===t.Mesh.CAP_END?0:2,Q=0;Q<I.length;Q++){K=W(Q,G[Q]),X=Array(),j=V[Q];for(var J=0;J<g;J++)t.Matrix.RotationAxisToRef(D[Q],z*J,$),ee=X[J]?X[J]:t.Vector3.Zero(),t.Vector3.TransformCoordinatesToRef(j,$,ee),ee.scaleInPlace(K).addInPlace(I[Q]),X[J]=ee;k[L]=X,L++}var te=function(re,le){for(var ie=Array(),ce=0;ce<re;ce++)ie.push(I[le]);return ie};switch(M){case t.Mesh.NO_CAP:break;case t.Mesh.CAP_START:k[0]=te(g,0),k[1]=k[2].slice(0);break;case t.Mesh.CAP_END:k[L]=k[L-1].slice(0),k[L+1]=te(g,I.length-1);break;case t.Mesh.CAP_ALL:k[0]=te(g,0),k[1]=k[2].slice(0),k[L]=k[L-1].slice(0),k[L+1]=te(g,I.length-1);break;default:break}return k},v,S;if(s){var P=s._creationDataStorage,x=i.arc||P.arc;return v=P.path3D.update(n),S=_(n,v,P.pathArray,o,P.tessellation,u,P.cap,x),s=c.CreateRibbon("",{pathArray:S,instance:s}),P.path3D=v,P.pathArray=S,P.arc=x,P.radius=o,s}v=new t.Path3D(n);var R=new Array;h=h<0||h>3?0:h,S=_(n,v,R,o,l,u,h,i.arc);var w=c.CreateRibbon(r,{pathArray:S,closePath:!0,closeArray:!1,updatable:p,sideOrientation:m,invertUV:d,frontUVs:i.frontUVs,backUVs:i.backUVs},a);return w._creationDataStorage.pathArray=S,w._creationDataStorage.path3D=v,w._creationDataStorage.tessellation=l,w._creationDataStorage.cap=h,w._creationDataStorage.arc=i.arc,w._creationDataStorage.radius=o,w},c.CreatePolyhedron=function(r,i,a){var n=new t.Mesh(r,a);i.sideOrientation=c.updateSideOrientation(i.sideOrientation),n._originalBuilderSideOrientation=i.sideOrientation;var s=t.VertexData.CreatePolyhedron(i);return s.applyToMesh(n,i.updatable),n},c.CreateDecal=function(r,i,a){var n=i.getIndices(),s=i.getVerticesData(t.VertexBuffer.PositionKind),o=i.getVerticesData(t.VertexBuffer.NormalKind),l=a.position||t.Vector3.Zero(),u=a.normal||t.Vector3.Up(),h=a.size||t.Vector3.One(),d=a.angle||0;if(!u){var p=new t.Vector3(0,0,1),m=i.getScene().activeCamera,_=t.Vector3.TransformCoordinates(p,m.getWorldMatrix());u=m.globalPosition.subtract(_)}var v=-Math.atan2(u.z,u.x)-Math.PI/2,S=Math.sqrt(u.x*u.x+u.z*u.z),P=Math.atan2(u.y,S),x=t.Matrix.RotationYawPitchRoll(v,P,d).multiply(t.Matrix.Translation(l.x,l.y,l.z)),R=t.Matrix.Invert(x),w=i.getWorldMatrix(),I=w.multiply(R),F=new t.VertexData;F.indices=[],F.positions=[],F.normals=[],F.uvs=[];for(var k=0,E=function(G){var U=new t.PositionNormalVertex;if(!n||!s||!o)return U;var z=n[G];return U.position=new t.Vector3(s[z*3],s[z*3+1],s[z*3+2]),U.position=t.Vector3.TransformCoordinates(U.position,I),U.normal=new t.Vector3(o[z*3],o[z*3+1],o[z*3+2]),U.normal=t.Vector3.TransformNormal(U.normal,I),U},g=function(G,U){if(G.length===0)return G;for(var z=.5*Math.abs(t.Vector3.Dot(h,U)),H=function(ce,de){var _e=t.Vector3.GetClipFactor(ce.position,de.position,U,z);return new t.PositionNormalVertex(t.Vector3.Lerp(ce.position,de.position,_e),t.Vector3.Lerp(ce.normal,de.normal,_e))},W=new Array,X=0;X<G.length;X+=3){var K,j,ee,$=0,L=null,Q=null,J=null,te=null,re=t.Vector3.Dot(G[X].position,U)-z,le=t.Vector3.Dot(G[X+1].position,U)-z,ie=t.Vector3.Dot(G[X+2].position,U)-z;switch(K=re>0,j=le>0,ee=ie>0,$=(K?1:0)+(j?1:0)+(ee?1:0),$){case 0:W.push(G[X]),W.push(G[X+1]),W.push(G[X+2]);break;case 1:if(K&&(L=G[X+1],Q=G[X+2],J=H(G[X],L),te=H(G[X],Q)),j){L=G[X],Q=G[X+2],J=H(G[X+1],L),te=H(G[X+1],Q),W.push(J),W.push(Q.clone()),W.push(L.clone()),W.push(Q.clone()),W.push(J.clone()),W.push(te);break}ee&&(L=G[X],Q=G[X+1],J=H(G[X+2],L),te=H(G[X+2],Q)),L&&Q&&J&&te&&(W.push(L.clone()),W.push(Q.clone()),W.push(J),W.push(te),W.push(J.clone()),W.push(Q.clone()));break;case 2:K||(L=G[X].clone(),Q=H(L,G[X+1]),J=H(L,G[X+2]),W.push(L),W.push(Q),W.push(J)),j||(L=G[X+1].clone(),Q=H(L,G[X+2]),J=H(L,G[X]),W.push(L),W.push(Q),W.push(J)),ee||(L=G[X+2].clone(),Q=H(L,G[X]),J=H(L,G[X+1]),W.push(L),W.push(Q),W.push(J));break;case 3:break}}return W},y=0;y<n.length;y+=3){var M=new Array;if(M.push(E(y)),M.push(E(y+1)),M.push(E(y+2)),M=g(M,new t.Vector3(1,0,0)),M=g(M,new t.Vector3(-1,0,0)),M=g(M,new t.Vector3(0,1,0)),M=g(M,new t.Vector3(0,-1,0)),M=g(M,new t.Vector3(0,0,1)),M=g(M,new t.Vector3(0,0,-1)),M.length!==0)for(var C=0;C<M.length;C++){var D=M[C];F.indices.push(k),D.position.toArray(F.positions,k*3),D.normal.toArray(F.normals,k*3),F.uvs.push(.5+D.position.x/h.x),F.uvs.push(.5+D.position.y/h.y),k++}}var V=new t.Mesh(r,i.getScene());return F.applyToMesh(V),V.position=l.clone(),V.rotation=new t.Vector3(P,v,d),V},c._ExtrudeShapeGeneric=function(r,i,a,n,s,o,l,u,h,d,p,m,_,v,S,P,x,R){var w=function(y,M,C,D,V,G,U,z,H,W){for(var X=C.getTangents(),K=C.getNormals(),j=C.getBinormals(),ee=C.getDistances(),$=0,L=function(){return V!==null?V:1},Q=function(){return G!==null?G:0},J=W&&z?z:Q,te=W&&U?U:L,re=H===t.Mesh.NO_CAP||H===t.Mesh.CAP_END?0:2,le=t.Tmp.Matrix[0],ie=0;ie<M.length;ie++){for(var ce=new Array,de=J(ie,ee[ie]),_e=te(ie,ee[ie]),ge=0;ge<y.length;ge++){t.Matrix.RotationAxisToRef(X[ie],$,le);var me=X[ie].scale(y[ge].z).add(K[ie].scale(y[ge].x)).add(j[ie].scale(y[ge].y)),ve=ce[ge]?ce[ge]:t.Vector3.Zero();t.Vector3.TransformCoordinatesToRef(me,le,ve),ve.scaleInPlace(_e).addInPlace(M[ie]),ce[ge]=ve}D[re]=ce,$+=de,re++}var be=function(Te){var He=Array(),De=t.Vector3.Zero(),Fe;for(Fe=0;Fe<Te.length;Fe++)De.addInPlace(Te[Fe]);for(De.scaleInPlace(1/Te.length),Fe=0;Fe<Te.length;Fe++)He.push(De);return He};switch(H){case t.Mesh.NO_CAP:break;case t.Mesh.CAP_START:D[0]=be(D[2]),D[1]=D[2];break;case t.Mesh.CAP_END:D[re]=D[re-1],D[re+1]=be(D[re-1]);break;case t.Mesh.CAP_ALL:D[0]=be(D[2]),D[1]=D[2],D[re]=D[re-1],D[re+1]=be(D[re-1]);break;default:break}return D},I,F;if(S){var k=S._creationDataStorage;return I=k.path3D.update(a),F=w(i,a,k.path3D,k.pathArray,n,s,o,l,k.cap,p),S=t.Mesh.CreateRibbon("",F,!1,!1,0,m||void 0,!1,0,S),S}I=new t.Path3D(a);var E=new Array;d=d<0||d>3?0:d,F=w(i,a,I,E,n,s,o,l,d,p);var g=c.CreateRibbon(r,{pathArray:F,closeArray:u,closePath:h,updatable:_,sideOrientation:v,invertUV:P,frontUVs:x||void 0,backUVs:R||void 0},m);return g._creationDataStorage.pathArray=F,g._creationDataStorage.path3D=I,g._creationDataStorage.cap=d,g},c}();t.MeshBuilder=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return Object.defineProperty(c,"DecoderAvailable",{get:function(){if(typeof DracoDecoderModule<"u")return!0;var r=c.Configuration.decoder;return!!(r&&(r.wasmUrl&&r.wasmBinaryUrl&&typeof WebAssembly=="object"||r.fallbackUrl))},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){},c.prototype.decodeMeshAsync=function(r,i){var a=r instanceof ArrayBuffer?new Uint8Array(r):r;return c._GetDecoderModule().then(function(n){var s=n.module,o=new t.VertexData,l=new s.DecoderBuffer;l.Init(a,a.byteLength);var u=new s.Decoder,h,d;try{var p=u.GetEncodedGeometryType(l);switch(p){case s.TRIANGULAR_MESH:h=new s.Mesh,d=u.DecodeBufferToMesh(l,h);break;case s.POINT_CLOUD:h=new s.PointCloud,d=u.DecodeBufferToPointCloud(l,h);break;default:throw new Error("Invalid geometry type "+p)}if(!d.ok()||!h.ptr)throw new Error(d.error_msg());var m=h.num_points();if(p===s.TRIANGULAR_MESH){var _=h.num_faces(),v=new s.DracoInt32Array;try{for(var S=new Uint32Array(_*3),P=0;P<_;P++){u.GetFaceFromMesh(h,P,v);var x=P*3;S[x+0]=v.GetValue(0),S[x+1]=v.GetValue(1),S[x+2]=v.GetValue(2)}o.indices=S}finally{s.destroy(v)}}for(var R in i){var w=i[R],I=u.GetAttributeByUniqueId(h,w),F=new s.DracoFloat32Array;try{u.GetAttributeFloatForAllPoints(h,I,F);for(var k=new Float32Array(m*I.num_components()),P=0;P<k.length;P++)k[P]=F.GetValue(P);o.set(k,R)}finally{s.destroy(F)}}}finally{h&&s.destroy(h),s.destroy(u),s.destroy(l)}return o})},c._GetDecoderModule=function(){if(!c._DecoderModulePromise){var r=null,i={};if(typeof DracoDecoderModule<"u")r=Promise.resolve();else{var a=c.Configuration.decoder;a&&(a.wasmUrl&&a.wasmBinaryUrl&&typeof WebAssembly=="object"?r=Promise.all([c._LoadScriptAsync(a.wasmUrl),c._LoadFileAsync(a.wasmBinaryUrl).then(function(n){i.wasmBinary=n})]):a.fallbackUrl&&(r=c._LoadScriptAsync(a.fallbackUrl)))}if(!r)throw new Error("Draco decoder module is not available");c._DecoderModulePromise=r.then(function(){return new Promise(function(n){i.onModuleLoaded=function(s){n({module:s})},DracoDecoderModule(i)})})}return c._DecoderModulePromise},c._LoadScriptAsync=function(r){return new Promise(function(i,a){t.Tools.LoadScript(r,function(){i()},function(n){a(new Error(n))})})},c._LoadFileAsync=function(r){return new Promise(function(i,a){t.Tools.LoadFile(r,function(n){i(n)},void 0,void 0,!0,function(n,s){a(s)})})},c.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},c}();t.DracoCompression=f})(T||(T={}));var T;(function(t){t.Engine.AudioEngineFactory=function(c){return new f(c)};var f=function(){function c(r){r===void 0&&(r=null);var i=this;this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new t.Observable,this.onAudioLockedObservable=new t.Observable,this._tryToRun=!1,this._onResize=function(){i._moveButtonToTopLeft()},(typeof window.AudioContext<"u"||typeof window.webkitAudioContext<"u")&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var a=document.createElement("audio");this._hostElement=r;try{a&&a.canPlayType&&a.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch{}try{a&&a.canPlayType&&a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch{}}return Object.defineProperty(c.prototype,"audioContext",{get:function(){return this._audioContextInitialized?!this.unlocked&&!this._muteButton&&this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),c.prototype.lock=function(){this._triggerSuspendedState()},c.prototype.unlock=function(){this._triggerRunningState()},c.prototype._resumeAudioContext=function(){var r;return this._audioContext.resume&&(r=this._audioContext.resume()),r||Promise.resolve()},c.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,this._audioContext.state==="running"&&this._triggerRunningState())}catch(r){this.canUseWebAudio=!1,t.Tools.Error("Web Audio: "+r.message)}},c.prototype._triggerRunningState=function(){var r=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){r._tryToRun=!1,r._muteButton&&r._hideMuteButton()}).catch(function(){r._tryToRun=!1,r.unlocked=!1}),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},c.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},c.prototype._displayMuteButton=function(){var r=this;if(!this.useCustomUnlockedButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var i=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",a=document.createElement("style");a.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(a),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){r._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){r._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},c.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},c.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},c.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},c.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},c.prototype.setGlobalVolume=function(r){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=r)},c.prototype.connectToAnalyser=function(r){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=r,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},c}();t.AudioEngine=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s){n===void 0&&(n=null);var o=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new t.Observable,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=t.Vector3.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new t.Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=r,this._scene=a;var l=a._getComponent(t.SceneComponentConstants.NAME_AUDIO);if(l||(l=new t.AudioSceneComponent(a),a._addComponent(l)),this._readyToPlayCallback=n,this._customAttenuationFunction=function(_,v,S,P,x){return v<S?_*(1-v/S):0},s&&(this.autoplay=s.autoplay||!1,this.loop=s.loop||!1,s.volume!==void 0&&(this._volume=s.volume),this.spatialSound=s.spatialSound||!1,this.maxDistance=s.maxDistance||100,this.useCustomAttenuation=s.useCustomAttenuation||!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming||!1),t.Engine.audioEngine.canUseWebAudio&&t.Engine.audioEngine.audioContext){this._soundGain=t.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var u=!0;if(i)try{typeof i=="string"?this._urlType="String":i instanceof ArrayBuffer?this._urlType="ArrayBuffer":i instanceof MediaStream?this._urlType="MediaStream":Array.isArray(i)&&(this._urlType="Array");var h=[],d=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=t.Engine.audioEngine.audioContext.createMediaElementSource(i),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":i.byteLength>0&&(d=!0,this._soundLoaded(i));break;case"String":h.push(i);case"Array":h.length===0&&(h=i);for(var p=0;p<h.length;p++){var m=h[p];if(m.indexOf(".mp3",m.length-4)!==-1&&t.Engine.audioEngine.isMP3supported&&(d=!0),m.indexOf(".ogg",m.length-4)!==-1&&t.Engine.audioEngine.isOGGsupported&&(d=!0),m.indexOf(".wav",m.length-4)!==-1&&(d=!0),m.indexOf("blob:")!==-1&&(d=!0),d){this._streaming?(this._htmlAudioElement=new Audio(m),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,t.Tools.SetCorsBehavior(m,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){o._isReadyToPlay=!0,o.autoplay&&o.play(),o._readyToPlayCallback&&o._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(m,function(_){o._soundLoaded(_)},void 0,!0,!0,function(_){_&&t.Tools.Error("XHR "+_.status+" error on: "+m+"."),t.Tools.Error("Sound creation aborted."),o._scene.mainSoundTrack.RemoveSound(o)});break}}break;default:u=!1;break}u?d||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){o._readyToPlayCallback&&o._readyToPlayCallback()},1e3)):t.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch{t.Tools.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),t.Engine.audioEngine.WarnedWebAudioUnsupported||(t.Tools.Error("Web Audio is not supported by your browser."),t.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){o._readyToPlayCallback&&o._readyToPlayCallback()},1e3)}return c.prototype.dispose=function(){t.Engine.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,this.soundTrackId===-1?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},c.prototype.isReady=function(){return this._isReadyToPlay},c.prototype._soundLoaded=function(r){var i=this;t.Engine.audioEngine.audioContext&&t.Engine.audioEngine.audioContext.decodeAudioData(r,function(a){i._audioBuffer=a,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(a){t.Tools.Error("Error while decoding audio data for: "+i.name+" / Error: "+a)})},c.prototype.setAudioBuffer=function(r){t.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=r,this._isReadyToPlay=!0)},c.prototype.updateOptions=function(r){r&&(this.loop=r.loop||this.loop,this.maxDistance=r.maxDistance||this.maxDistance,this.useCustomAttenuation=r.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=r.rolloffFactor||this.rolloffFactor,this.refDistance=r.refDistance||this.refDistance,this.distanceModel=r.distanceModel||this.distanceModel,this._playbackRate=r.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},c.prototype._createSpatialParameters=function(){t.Engine.audioEngine.canUseWebAudio&&t.Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=t.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},c.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},c.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},c.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},c.prototype._switchPanningModel=function(){t.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},c.prototype.connectToSoundTrackAudioNode=function(r){t.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(r),this._isOutputConnected=!0)},c.prototype.setDirectionalCone=function(r,i,a){if(i<r){t.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=r,this._coneOuterAngle=i,this._coneOuterGain=a,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play())},Object.defineProperty(c.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(r){if(r!=this._coneInnerAngle){if(this._coneOuterAngle<r){t.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=r,t.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(r){if(r!=this._coneOuterAngle){if(r<this._coneInnerAngle){t.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneOuterAngle=r,t.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),c.prototype.setPosition=function(r){this._position=r,t.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},c.prototype.setLocalDirectionToMesh=function(r){this._localDirection=r,t.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},c.prototype._updateDirection=function(){if(!(!this._connectedMesh||!this._soundPanner)){var r=this._connectedMesh.getWorldMatrix(),i=t.Vector3.TransformNormal(this._localDirection,r);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)}},c.prototype.updateDistanceFromListener=function(){if(t.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var r=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,r,this.maxDistance,this.refDistance,this.rolloffFactor)}},c.prototype.setAttenuationFunction=function(r){this._customAttenuationFunction=r},c.prototype.play=function(r,i){var a=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&t.Engine.audioEngine.audioContext)try{this._startOffset<0&&(r=-this._startOffset,this._startOffset=0);var n=r?t.Engine.audioEngine.audioContext.currentTime+r:t.Engine.audioEngine.audioContext.currentTime;if((!this._soundSource||!this._streamingSource)&&this.spatialSound&&this._soundPanner&&(!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(this._streamingSource||(this._streamingSource=t.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){a._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement){var s=function(){if(t.Engine.audioEngine.unlocked){var o=a._htmlAudioElement.play();o!==void 0&&o.catch(function(l){t.Engine.audioEngine.lock(),t.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){s()})})}else t.Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){s()})};s()}}else this._soundSource=t.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){a._onended()},this._soundSource.buffer&&this._soundSource.start(n,this.isPaused?this._startOffset%this._soundSource.buffer.duration:i||0);this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(o){t.Tools.Error("Error while trying to play audio: "+this.name+", "+o.message)}},c.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},c.prototype.stop=function(r){if(this.isPlaying){if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect();else if(t.Engine.audioEngine.audioContext&&this._soundSource){var i=r?t.Engine.audioEngine.audioContext.currentTime+r:t.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this._soundSource.onended=function(){},this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},c.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():t.Engine.audioEngine.audioContext&&(this.stop(0),this._startOffset+=t.Engine.audioEngine.audioContext.currentTime-this._startTime))},c.prototype.setVolume=function(r,i){t.Engine.audioEngine.canUseWebAudio&&this._soundGain&&(i&&t.Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(t.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,t.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(r,t.Engine.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=r),this._volume=r},c.prototype.setPlaybackRate=function(r){this._playbackRate=r,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},c.prototype.getVolume=function(){return this._volume},c.prototype.attachToMesh=function(r){var i=this;this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=r,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(a){return i._onRegisterAfterWorldMatrixUpdate(a)},r.registerAfterWorldMatrixUpdate(this._registerFunc)},c.prototype.detachFromMesh=function(){this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},c.prototype._onRegisterAfterWorldMatrixUpdate=function(r){if(r.getBoundingInfo){var i=r;if(this._positionInEmitterSpace)i.worldMatrixFromCache.invertToRef(t.Tmp.Matrix[0]),this.setPosition(t.Tmp.Matrix[0].getTranslation());else{var a=i.getBoundingInfo();this.setPosition(a.boundingSphere.centerWorld)}t.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},c.prototype.clone=function(){var r=this;if(this._streaming)return null;var i=function(){r._isReadyToPlay?(n._audioBuffer=r.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play()):window.setTimeout(i,300)},a={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new c(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,a);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),i(),n},c.prototype.getAudioBuffer=function(){return this._audioBuffer},c.prototype.serialize=function(){var r={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedMesh&&(r.connectedMeshId=this._connectedMesh.id),r.position=this._position.asArray(),r.refDistance=this.refDistance,r.distanceModel=this.distanceModel,r.isDirectional=this._isDirectional,r.localDirectionToMesh=this._localDirection.asArray(),r.coneInnerAngle=this._coneInnerAngle,r.coneOuterAngle=this._coneOuterAngle,r.coneOuterGain=this._coneOuterGain),r},c.Parse=function(r,i,a,n){var s=r.name,o;r.url?o=a+r.url:o=a+s;var l={autoplay:r.autoplay,loop:r.loop,volume:r.volume,spatialSound:r.spatialSound,maxDistance:r.maxDistance,rolloffFactor:r.rolloffFactor,refDistance:r.refDistance,distanceModel:r.distanceModel,playbackRate:r.playbackRate},u;if(!n)u=new c(s,o,i,function(){i._removePendingData(u)},l),i._addPendingData(u);else{var h=function(){n._isReadyToPlay?(u._audioBuffer=n.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play()):window.setTimeout(h,300)};u=new c(s,new ArrayBuffer(0),i,null,l),h()}if(r.position){var d=t.Vector3.FromArray(r.position);u.setPosition(d)}if(r.isDirectional&&(u.setDirectionalCone(r.coneInnerAngle||360,r.coneOuterAngle||360,r.coneOuterGain||0),r.localDirectionToMesh)){var p=t.Vector3.FromArray(r.localDirectionToMesh);u.setLocalDirectionToMesh(p)}if(r.connectedMeshId){var m=i.getMeshByID(r.connectedMeshId);m&&u.attachToMesh(m)}return u},c}();t.Sound=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){i===void 0&&(i={}),this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=r,this.soundCollection=new Array,this._options=i,!this._isMainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return c.prototype._initializeSoundTrackAudioGraph=function(){t.Engine.audioEngine.canUseWebAudio&&t.Engine.audioEngine.audioContext&&(this._outputAudioNode=t.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(t.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},c.prototype.dispose=function(){if(t.Engine.audioEngine&&t.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},c.prototype.AddSound=function(r){this._isInitialized||this._initializeSoundTrackAudioGraph(),t.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&r.connectToSoundTrackAudioNode(this._outputAudioNode),r.soundTrackId&&(r.soundTrackId===-1?this._scene.mainSoundTrack.RemoveSound(r):this._scene.soundTracks&&this._scene.soundTracks[r.soundTrackId].RemoveSound(r)),this.soundCollection.push(r),r.soundTrackId=this.id},c.prototype.RemoveSound=function(r){var i=this.soundCollection.indexOf(r);i!==-1&&this.soundCollection.splice(i,1)},c.prototype.setVolume=function(r){t.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=r)},c.prototype.switchPanningModelToHRTF=function(){if(t.Engine.audioEngine.canUseWebAudio)for(var r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToHRTF()},c.prototype.switchPanningModelToEqualPower=function(){if(t.Engine.audioEngine.canUseWebAudio)for(var r=0;r<this.soundCollection.length;r++)this.soundCollection[r].switchPanningModelToEqualPower()},c.prototype.connectToAnalyser=function(r){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=r,t.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,t.Engine.audioEngine.masterGain))},c}();t.SoundTrack=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=r,this._audioEngine=t.Engine.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return c.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},c.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},c.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},c.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},c.prototype.drawDebugCanvas=function(){var r=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){r.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var i=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var a=0;a<this.getFrequencyBinCount();a++){var n=i[a],s=n/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*s,l=this.DEBUGCANVASSIZE.height-o-1,u=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=a/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+h+", 100%, 50%)",this._debugCanvasContext.fillRect(a*u,l,u,o)}}},c.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},c.prototype.connectAudioNodes=function(r,i){this._audioEngine.canUseWebAudio&&(r.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(i))},c.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},c}();t.Analyser=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){var n=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],i.length!==a.length)throw new Error("Sounds length does not equal weights length");this.loop=r,this._weights=a;for(var s=0,o=0,l=a;o<l.length;o++){var u=l[o];s+=u}for(var h=s>0?1/s:0,d=0;d<this._weights.length;d++)this._weights[d]*=h;this._sounds=i;for(var p=0,m=this._sounds;p<m.length;p++){var _=m[p];_.onEndedObservable.add(function(){n._onended()})}}return Object.defineProperty(c.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(r){if(r!==this._coneInnerAngle){if(this._coneOuterAngle<r){t.Tools.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneInnerAngle=r;for(var i=0,a=this._sounds;i<a.length;i++){var n=a[i];n.directionalConeInnerAngle=r}}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(r){if(r!==this._coneOuterAngle){if(r<this._coneInnerAngle){t.Tools.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return}this._coneOuterAngle=r;for(var i=0,a=this._sounds;i<a.length;i++){var n=a[i];n.directionalConeOuterAngle=r}}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"volume",{get:function(){return this._volume},set:function(r){if(r!==this._volume)for(var i=0,a=this._sounds;i<a.length;i++){var n=a[i];n.setVolume(r)}},enumerable:!0,configurable:!0}),c.prototype._onended=function(){this._currentIndex!==void 0&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},c.prototype.pause=function(){this.isPaused=!0,this._currentIndex!==void 0&&this._sounds[this._currentIndex].pause()},c.prototype.stop=function(){this.isPlaying=!1,this._currentIndex!==void 0&&this._sounds[this._currentIndex].stop()},c.prototype.play=function(r){if(!this.isPaused){this.stop();for(var i=Math.random(),a=0,n=0;n<this._weights.length;n++)if(a+=this._weights[n],i<=a){this._currentIndex=n;break}}var s=this._sounds[this._currentIndex];s.isReady()?s.play(0,this.isPaused?void 0:r):s.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},c}();t.WeightedSound=f})(T||(T={}));var T;(function(t){t.AbstractScene.AddParser(t.SceneComponentConstants.NAME_AUDIO,function(c,r,i,a){var n=[],s;if(i.sounds=i.sounds||[],c.sounds!==void 0&&c.sounds!==null)for(var o=0,l=c.sounds.length;o<l;o++){var u=c.sounds[o];t.Engine.audioEngine.canUseWebAudio?(u.url||(u.url=u.name),n[u.url]?i.sounds.push(t.Sound.Parse(u,r,a,n[u.url])):(s=t.Sound.Parse(u,r,a),n[u.url]=s,i.sounds.push(s))):i.sounds.push(new t.Sound(u.name,null,r))}n=[]}),Object.defineProperty(t.Scene.prototype,"mainSoundTrack",{get:function(){var c=this._getComponent(t.SceneComponentConstants.NAME_AUDIO);return c||(c=new f(this),this._addComponent(c)),this._mainSoundTrack||(this._mainSoundTrack=new t.SoundTrack(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),t.Scene.prototype.getSoundByName=function(c){var r;for(r=0;r<this.mainSoundTrack.soundCollection.length;r++)if(this.mainSoundTrack.soundCollection[r].name===c)return this.mainSoundTrack.soundCollection[r];if(this.soundTracks){for(var i=0;i<this.soundTracks.length;i++)for(r=0;r<this.soundTracks[i].soundCollection.length;r++)if(this.soundTracks[i].soundCollection[r].name===c)return this.soundTracks[i].soundCollection[r]}return null},Object.defineProperty(t.Scene.prototype,"audioEnabled",{get:function(){var c=this._getComponent(t.SceneComponentConstants.NAME_AUDIO);return c||(c=new f(this),this._addComponent(c)),c.audioEnabled},set:function(c){var r=this._getComponent(t.SceneComponentConstants.NAME_AUDIO);r||(r=new f(this),this._addComponent(r)),c?r.enableAudio():r.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(t.Scene.prototype,"headphone",{get:function(){var c=this._getComponent(t.SceneComponentConstants.NAME_AUDIO);return c||(c=new f(this),this._addComponent(c)),c.headphone},set:function(c){var r=this._getComponent(t.SceneComponentConstants.NAME_AUDIO);r||(r=new f(this),this._addComponent(r)),c?r.switchAudioModeForHeadphones():r.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.scene=r,r.soundTracks=new Array,r.sounds=new Array}return Object.defineProperty(c.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),c.prototype.register=function(){this.scene._afterRenderStage.registerStep(t.SceneComponentConstants.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},c.prototype.rebuild=function(){},c.prototype.serialize=function(r){if(r.sounds=[],this.scene.soundTracks)for(var i=0;i<this.scene.soundTracks.length;i++)for(var a=this.scene.soundTracks[i],n=0;n<a.soundCollection.length;n++)r.sounds.push(a.soundCollection[n].serialize())},c.prototype.addFromContainer=function(r){var i=this;r.sounds&&r.sounds.forEach(function(a){a.play(),a.autoplay=!0,i.scene.mainSoundTrack.AddSound(a)})},c.prototype.removeFromContainer=function(r){var i=this;r.sounds&&r.sounds.forEach(function(a){a.stop(),a.autoplay=!1,i.scene.mainSoundTrack.RemoveSound(a)})},c.prototype.dispose=function(){var r=this.scene;if(r._mainSoundTrack&&r.mainSoundTrack.dispose(),r.soundTracks)for(var i=0;i<r.soundTracks.length;i++)r.soundTracks[i].dispose()},c.prototype.disableAudio=function(){var r=this.scene;this._audioEnabled=!1;var i;for(i=0;i<r.mainSoundTrack.soundCollection.length;i++)r.mainSoundTrack.soundCollection[i].pause();if(r.soundTracks)for(i=0;i<r.soundTracks.length;i++)for(var a=0;a<r.soundTracks[i].soundCollection.length;a++)r.soundTracks[i].soundCollection[a].pause()},c.prototype.enableAudio=function(){var r=this.scene;this._audioEnabled=!0;var i;for(i=0;i<r.mainSoundTrack.soundCollection.length;i++)r.mainSoundTrack.soundCollection[i].isPaused&&r.mainSoundTrack.soundCollection[i].play();if(r.soundTracks)for(i=0;i<r.soundTracks.length;i++)for(var a=0;a<r.soundTracks[i].soundCollection.length;a++)r.soundTracks[i].soundCollection[a].isPaused&&r.soundTracks[i].soundCollection[a].play()},c.prototype.switchAudioModeForHeadphones=function(){var r=this.scene;if(this._headphone=!0,r.mainSoundTrack.switchPanningModelToHRTF(),r.soundTracks)for(var i=0;i<r.soundTracks.length;i++)r.soundTracks[i].switchPanningModelToHRTF()},c.prototype.switchAudioModeForNormalSpeakers=function(){var r=this.scene;if(this._headphone=!1,r.mainSoundTrack.switchPanningModelToEqualPower(),r.soundTracks)for(var i=0;i<r.soundTracks.length;i++)r.soundTracks[i].switchPanningModelToEqualPower()},c.prototype._afterRender=function(){var r=this.scene;if(!(!this._audioEnabled||!r._mainSoundTrack||!r.soundTracks||r._mainSoundTrack.soundCollection.length===0&&r.soundTracks.length===1)){var i,a=t.Engine.audioEngine;if(r.activeCameras.length>0?i=r.activeCameras[0]:i=r.activeCamera,i&&a.audioContext){var n=a.audioContext.listener.positionX!=null;n?(a.audioContext.listener.positionX.value=i.globalPosition.x,a.audioContext.listener.positionY.value=i.globalPosition.y,a.audioContext.listener.positionZ.value=i.globalPosition.z):a.audioContext.listener.setPosition(i.globalPosition.x,i.globalPosition.y,i.globalPosition.z),i.rigCameras&&i.rigCameras.length>0&&(i=i.rigCameras[0]);var s=t.Matrix.Invert(i.getViewMatrix()),o=t.Vector3.TransformNormal(new t.Vector3(0,0,-1),s);o.normalize(),!isNaN(o.x)&&!isNaN(o.y)&&!isNaN(o.z)&&(n?(a.audioContext.listener.forwardX.value=o.x,a.audioContext.listener.forwardY.value=o.y,a.audioContext.listener.forwardZ.value=o.z):a.audioContext.listener.setOrientation(o.x,o.y,o.z,0,1,0));var l;for(l=0;l<r.mainSoundTrack.soundCollection.length;l++){var u=r.mainSoundTrack.soundCollection[l];u.useCustomAttenuation&&u.updateDistanceFromListener()}if(r.soundTracks)for(l=0;l<r.soundTracks.length;l++)for(var h=0;h<r.soundTracks[l].soundCollection.length;h++)u=r.soundTracks[l].soundCollection[h],u.useCustomAttenuation&&u.updateDistanceFromListener()}}},c}();t.AudioSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(a,n,s){var o=r.call(this,a,s)||this;return o._sound=n,o}return i.prototype._prepare=function(){},i.prototype.execute=function(){this._sound!==void 0&&this._sound.play()},i.prototype.serialize=function(a){return r.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},i}(t.Action);t.PlaySoundAction=f;var c=function(r){N(i,r);function i(a,n,s){var o=r.call(this,a,s)||this;return o._sound=n,o}return i.prototype._prepare=function(){},i.prototype.execute=function(){this._sound!==void 0&&this._sound.stop()},i.prototype.serialize=function(a){return r.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},a)},i}(t.Action);t.StopSoundAction=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p,m,_,v){n===void 0&&(n=null),s===void 0&&(s=!1),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),h===void 0&&(h=t.Engine.TEXTUREFORMAT_RGBA),d===void 0&&(d=!1),p===void 0&&(p=null),m===void 0&&(m=!1),_===void 0&&(_=.8),v===void 0&&(v=0);var S=c.call(this,a)||this;if(S.boundingBoxPosition=t.Vector3.Zero(),S._rotationY=0,S._prefiltered=!1,S.name=i,S.url=i,S._noMipmap=s,S.hasAlpha=!1,S._format=h,S.isCube=!0,S._textureMatrix=t.Matrix.Identity(),S._createPolynomials=m,S.coordinatesMode=t.Texture.CUBIC_MODE,!i&&!o)return S;var P=i.lastIndexOf("."),x=p||(P>-1?i.substring(P).toLowerCase():""),R=x===".dds",w=x===".env";if(w?(S.gammaSpace=!1,S._prefiltered=!1):(S._prefiltered=d,d&&(S.gammaSpace=!1)),S._texture=S._getFromCache(i,s),!o&&(!w&&!R&&!n&&(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),o=[],n))for(var I=0;I<n.length;I++)o.push(i+n[I]);return S._files=o,S._texture?l&&(S._texture.isReady?t.Tools.SetImmediate(function(){return l()}):S._texture.onLoadedObservable.add(l)):a.useDelayedTextureLoading?S.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED:d?S._texture=a.getEngine().createPrefilteredCubeTexture(i,a,_,v,l,u,h,p,S._createPolynomials):S._texture=a.getEngine().createCubeTexture(i,a,o,s,l,u,S._format,p,!1,_,v),S}return Object.defineProperty(r.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(i){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(i))){this._boundingBoxSize=i;var a=this.getScene();a&&a.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationY",{get:function(){return this._rotationY},set:function(i){this._rotationY=i,this.setReflectionTextureMatrix(t.Matrix.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),r.CreateFromImages=function(i,a,n){var s="";return i.forEach(function(o){return s+=o}),new r(s,a,null,n,i)},r.CreateFromPrefilteredData=function(i,a,n,s){return n===void 0&&(n=null),s===void 0&&(s=!0),new r(i,a,null,!1,null,null,null,void 0,!0,n,s)},r.prototype.delayLoad=function(){if(this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED){var i=this.getScene();i&&(this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=i.getEngine().createPrefilteredCubeTexture(this.url,i,this.lodGenerationScale,this.lodGenerationOffset,void 0,void 0,this._format,void 0,this._createPolynomials):this._texture=i.getEngine().createCubeTexture(this.url,i,this._files,this._noMipmap,void 0,void 0,this._format)))}},r.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},r.prototype.setReflectionTextureMatrix=function(i){this._textureMatrix=i},r.Parse=function(i,a,n){var s=t.SerializationHelper.Parse(function(){var u=!1;return i.prefiltered&&(u=i.prefiltered),new r(n+i.name,a,i.extensions,!1,null,null,null,void 0,u)},i,a);if(i.boundingBoxPosition&&(s.boundingBoxPosition=t.Vector3.FromArray(i.boundingBoxPosition)),i.boundingBoxSize&&(s.boundingBoxSize=t.Vector3.FromArray(i.boundingBoxSize)),i.animations)for(var o=0;o<i.animations.length;o++){var l=i.animations[o];s.animations.push(t.Animation.Parse(l))}return s},r.prototype.clone=function(){var i=this;return t.SerializationHelper.Clone(function(){var a=i.getScene();return a?new r(i.url,a,i._extensions,i._noMipmap,i._files):i},this)},A([t.serialize("rotationY")],r.prototype,"rotationY",null),r}(t.BaseTexture);t.CubeTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d){s===void 0&&(s=t.Engine.TEXTUREFORMAT_RGBA),o===void 0&&(o=t.Engine.TEXTURETYPE_UNSIGNED_INT),l===void 0&&(l=!1),u===void 0&&(u=!1),h===void 0&&(h=t.Texture.TRILINEAR_SAMPLINGMODE),d===void 0&&(d=null);var p=c.call(this,"",i)||this;return p._texture=i.getEngine().createRawCubeTexture(a,n,s,o,l,u,h,d),p}return r.prototype.update=function(i,a,n,s,o,l){o===void 0&&(o=null),l===void 0&&(l=0),this._texture.getEngine().updateRawCubeTexture(this._texture,i,a,n,s,o)},r.prototype.updateRGBDAsync=function(i,a,n,s){return a===void 0&&(a=null),n===void 0&&(n=.8),s===void 0&&(s=0),r._UpdateRGBDAsync(this._texture,i,a,n,s)},r.prototype.clone=function(){var i=this;return t.SerializationHelper.Clone(function(){var a=i.getScene(),n=i._texture,s=new r(a,n._bufferViewArray,n.width,n.format,n.type,n.generateMipMaps,n.invertY,n.samplingMode,n._compression);return n.dataSource===t.InternalTexture.DATASOURCE_CUBERAW_RGBD&&s.updateRGBDAsync(n._bufferViewArrayArray,n._sphericalPolynomial,n._lodGenerationScale,n._lodGenerationOffset),s},this)},r._UpdateRGBDAsync=function(i,a,n,s,o){return i._dataSource=t.InternalTexture.DATASOURCE_CUBERAW_RGBD,i._bufferViewArrayArray=a,i._lodGenerationScale=s,i._lodGenerationOffset=o,i._sphericalPolynomial=n,t.EnvironmentTextureTools.UploadLevelsAsync(i,a).then(function(){i.isReady=!0})},r}(t.CubeTexture);t.RawCubeTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p,m,_){o===void 0&&(o=!0),l===void 0&&(l=t.Engine.TEXTURETYPE_UNSIGNED_INT),u===void 0&&(u=!1),h===void 0&&(h=t.Texture.TRILINEAR_SAMPLINGMODE),d===void 0&&(d=!0),p===void 0&&(p=!1),m===void 0&&(m=!1),_===void 0&&(_=t.Engine.TEXTUREFORMAT_RGBA);var v=c.call(this,null,n,!s)||this;return v.isCube=u,v.renderParticles=!0,v.renderSprites=!1,v.coordinatesMode=t.Texture.PROJECTION_MODE,v.ignoreCameraViewport=!1,v.onBeforeBindObservable=new t.Observable,v.onAfterUnbindObservable=new t.Observable,v.onBeforeRenderObservable=new t.Observable,v.onAfterRenderObservable=new t.Observable,v.onClearObservable=new t.Observable,v._currentRefreshId=-1,v._refreshRate=1,v._samples=1,v.boundingBoxPosition=t.Vector3.Zero(),n=v.getScene(),!n||(v.renderList=new Array,v._engine=n.getEngine(),v.name=i,v.isRenderTarget=!0,v._initialSizeParameter=a,v._processSizeParameter(a),v._resizeObserver=v.getScene().getEngine().onResizeObservable.add(function(){}),v._generateMipMaps=!!s,v._doNotChangeAspectRatio=o,v._renderingManager=new t.RenderingManager(n),v._renderingManager._useSceneAutoClearSetup=!0,m)||(v._renderTargetOptions={generateMipMaps:s,type:l,format:_,samplingMode:h,generateDepthBuffer:d,generateStencilBuffer:p},h===t.Texture.NEAREST_SAMPLINGMODE&&(v.wrapU=t.Texture.CLAMP_ADDRESSMODE,v.wrapV=t.Texture.CLAMP_ADDRESSMODE),u?(v._texture=n.getEngine().createRenderTargetCubeTexture(v.getRenderSize(),v._renderTargetOptions),v.coordinatesMode=t.Texture.INVCUBIC_MODE,v._textureMatrix=t.Matrix.Identity()):v._texture=n.getEngine().createRenderTargetTexture(v._size,v._renderTargetOptions)),v}return Object.defineProperty(r.prototype,"renderList",{get:function(){return this._renderList},set:function(i){this._renderList=i,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),r.prototype._hookArray=function(i){var a=this,n=i.push;i.push=function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];var u=i.length===0,h=n.apply(i,o);return u&&a.getScene().meshes.forEach(function(d){d._markSubMeshesAsLightDirty()}),h};var s=i.splice;i.splice=function(o,l){var u=s.apply(i,[o,l]);return i.length===0&&a.getScene().meshes.forEach(function(h){h._markSubMeshesAsLightDirty()}),u}},Object.defineProperty(r.prototype,"onAfterUnbind",{set:function(i){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBeforeRender",{set:function(i){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onAfterRender",{set:function(i){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onClear",{set:function(i){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),r.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(r.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(i){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(i))){this._boundingBoxSize=i;var a=this.getScene();a&&a.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),r.prototype.createDepthStencilTexture=function(i,a,n){if(i===void 0&&(i=0),a===void 0&&(a=!0),n===void 0&&(n=!1),!!this.getScene()){var s=this.getScene().getEngine();this.depthStencilTexture=s.createDepthStencilTexture(this._size,{bilinearFiltering:a,comparisonFunction:i,generateStencil:n,isCube:this.isCube}),s.setFrameBufferDepthStencilTexture(this)}},r.prototype._processSizeParameter=function(i){i.ratio?(this._sizeRatio=i.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=i},Object.defineProperty(r.prototype,"samples",{get:function(){return this._samples},set:function(i){if(this._samples!==i){var a=this.getScene();a&&(this._samples=a.getEngine().updateRenderTargetTextureSampleCount(this._texture,i))}},enumerable:!0,configurable:!0}),r.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(r.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(i){this._refreshRate=i,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),r.prototype.addPostProcess=function(i){if(!this._postProcessManager){var a=this.getScene();if(!a)return;this._postProcessManager=new t.PostProcessManager(a),this._postProcesses=new Array}this._postProcesses.push(i),this._postProcesses[0].autoClear=!1},r.prototype.clearPostProcesses=function(i){if(i===void 0&&(i=!1),!!this._postProcesses){if(i)for(var a=0,n=this._postProcesses;a<n.length;a++){var s=n[a];s.dispose()}this._postProcesses=[]}},r.prototype.removePostProcess=function(i){if(this._postProcesses){var a=this._postProcesses.indexOf(i);a!==-1&&(this._postProcesses.splice(a,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},r.prototype._shouldRender=function(){return this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},r.prototype.getRenderSize=function(){return this.getRenderWidth()},r.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},r.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(r.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype.scale=function(i){var a=this.getRenderSize()*i;this.resize(a)},r.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:c.prototype.getReflectionTextureMatrix.call(this)},r.prototype.resize=function(i){this.releaseInternalTexture();var a=this.getScene();a&&(this._processSizeParameter(i),this.isCube?this._texture=a.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=a.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},r.prototype.render=function(i,a){i===void 0&&(i=!1),a===void 0&&(a=!1);var n=this.getScene();if(n){var s=n.getEngine();if(this.useCameraPostProcesses!==void 0&&(i=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var o=0;o<this._waitingRenderList.length;o++){var l=this._waitingRenderList[o],u=n.getMeshByID(l);u&&this.renderList.push(u)}delete this._waitingRenderList}if(this.renderListPredicate){this.renderList?this.renderList.splice(0):this.renderList=[];var n=this.getScene();if(!n)return;for(var h=n.meshes,o=0;o<h.length;o++){var d=h[o];this.renderListPredicate(d)&&this.renderList.push(d)}}this.onBeforeBindObservable.notifyObservers(this);var p;this.activeCamera?(p=this.activeCamera,s.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==n.activeCamera&&n.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(p=n.activeCamera,p&&s.setViewport(p.viewport,this.getRenderWidth(),this.getRenderHeight())),this._renderingManager.reset();for(var m=this.renderList?this.renderList:n.getActiveMeshes().data,_=this.renderList?this.renderList.length:n.getActiveMeshes().length,v=n.getRenderId(),S=0;S<_;S++){var d=m[S];if(d){if(!d.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}d._preActivateForIntermediateRendering(v);var P=void 0;if(!this.renderList&&p?P=(d.layerMask&p.layerMask)===0:P=!1,d.isEnabled()&&d.isVisible&&d.subMeshes&&!P){d._activate(v);for(var x=0;x<d.subMeshes.length;x++){var R=d.subMeshes[x];n._activeIndices.addCount(R.indexCount,!1),this._renderingManager.dispatch(R,d)}}}}for(var w=0;w<n.particleSystems.length;w++){var I=n.particleSystems[w],F=I.emitter;!I.isStarted()||!F||!F.position||!F.isEnabled()||m.indexOf(F)>=0&&this._renderingManager.dispatchParticles(I)}if(this.isCube)for(var k=0;k<6;k++)this.renderToTarget(k,m,_,i,a),n.incrementRenderId(),n.resetCachedMaterial();else this.renderToTarget(0,m,_,i,a);this.onAfterUnbindObservable.notifyObservers(this),n.activeCamera&&(this.activeCamera&&this.activeCamera!==n.activeCamera&&n.setTransformMatrix(n.activeCamera.getViewMatrix(),n.activeCamera.getProjectionMatrix(!0)),s.setViewport(n.activeCamera.viewport)),n.resetCachedMaterial()}},r.prototype._bestReflectionRenderTargetDimension=function(i,a){var n=128,s=i*a,o=t.Tools.NearestPOT(s+n*n/(n+s));return Math.min(t.Tools.FloorPOT(i),o)},r.prototype.unbindFrameBuffer=function(i,a){var n=this;this._texture&&i.unBindFramebuffer(this._texture,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(a)})},r.prototype.renderToTarget=function(i,a,n,s,o){var l=this.getScene();if(l){var u=l.getEngine();this._texture&&(this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):(!s||!l.postProcessManager._prepareFrame(this._texture))&&this._texture&&u.bindFramebuffer(this._texture,this.isCube?i:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0),this.onBeforeRenderObservable.notifyObservers(i),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(u):u.clear(this.clearColor||l.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||l.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,a,this.renderParticles,this.renderSprites),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,i,this._postProcesses,this.ignoreCameraViewport):s&&l.postProcessManager._finalizeFrame(!1,this._texture,i),this._doNotChangeAspectRatio||l.updateTransformMatrix(!0),o&&t.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),u),!this.isCube||i===5?(this.isCube&&i===5&&u.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(u,i)):this.onAfterRenderObservable.notifyObservers(i))}},r.prototype.setRenderingOrder=function(i,a,n,s){a===void 0&&(a=null),n===void 0&&(n=null),s===void 0&&(s=null),this._renderingManager.setRenderingOrder(i,a,n,s)},r.prototype.setRenderingAutoClearDepthStencil=function(i,a){this._renderingManager.setRenderingAutoClearDepthStencil(i,a),this._renderingManager._useSceneAutoClearSetup=!1},r.prototype.clone=function(){var i=this.getSize(),a=new r(this.name,i,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return a.hasAlpha=this.hasAlpha,a.level=this.level,a.coordinatesMode=this.coordinatesMode,this.renderList&&(a.renderList=this.renderList.slice(0)),a},r.prototype.serialize=function(){if(!this.name)return null;var i=c.prototype.serialize.call(this);if(i.renderTargetSize=this.getRenderSize(),i.renderList=[],this.renderList)for(var a=0;a<this.renderList.length;a++)i.renderList.push(this.renderList[a].id);return i},r.prototype.disposeFramebufferObjects=function(){var i=this.getInternalTexture(),a=this.getScene();i&&a&&a.getEngine()._releaseFramebufferObjects(i)},r.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var i=this.getScene();if(i){var a=i.customRenderTargets.indexOf(this);a>=0&&i.customRenderTargets.splice(a,1);for(var n=0,s=i.cameras;n<s.length;n++){var o=s[n];a=o.customRenderTargets.indexOf(this),a>=0&&o.customRenderTargets.splice(a,1)}c.prototype.dispose.call(this)}},r.prototype._rebuild=function(){this.refreshRate===r.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=r.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},r.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},r.REFRESHRATE_RENDER_ONCE=0,r.REFRESHRATE_RENDER_ONEVERYFRAME=1,r.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,r}(t.Texture);t.RenderTargetTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){var l=this,u=o&&o.generateMipMaps?o.generateMipMaps:!1,h=o&&o.generateDepthTexture?o.generateDepthTexture:!1,d=!o||o.doNotChangeAspectRatio===void 0?!0:o.doNotChangeAspectRatio;if(l=c.call(this,i,a,s,u,d)||this,l._engine=s.getEngine(),!l.isSupported){l.dispose();return}for(var p=[],m=[],_=0;_<n;_++)o&&o.types&&o.types[_]!==void 0?p.push(o.types[_]):p.push(o&&o.defaultType?o.defaultType:t.Engine.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&o.samplingModes[_]!==void 0?m.push(o.samplingModes[_]):m.push(t.Texture.BILINEAR_SAMPLINGMODE);var v=!o||o.generateDepthBuffer===void 0?!0:o.generateDepthBuffer,S=!o||o.generateStencilBuffer===void 0?!1:o.generateStencilBuffer;return l._size=a,l._multiRenderTargetOptions={samplingModes:m,generateMipMaps:u,generateDepthBuffer:v,generateStencilBuffer:S,generateDepthTexture:h,types:p,textureCount:n},l._createInternalTextures(),l._createTextures(),l}return Object.defineProperty(r.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wrapU",{set:function(i){if(this._textures)for(var a=0;a<this._textures.length;a++)this._textures[a].wrapU=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wrapV",{set:function(i){if(this._textures)for(var a=0;a<this._textures.length;a++)this._textures[a].wrapV=i},enumerable:!0,configurable:!0}),r.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var i=0;i<this._internalTextures.length;i++){var a=this._textures[i];a._texture=this._internalTextures[i]}this._texture=this._internalTextures[0]},r.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},r.prototype._createTextures=function(){this._textures=[];for(var i=0;i<this._internalTextures.length;i++){var a=new t.Texture(null,this.getScene());a._texture=this._internalTextures[i],this._textures.push(a)}this._texture=this._internalTextures[0]},Object.defineProperty(r.prototype,"samples",{get:function(){return this._samples},set:function(i){this._samples!==i&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,i))},enumerable:!0,configurable:!0}),r.prototype.resize=function(i){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(i,this._multiRenderTargetOptions),this._createInternalTextures()},r.prototype.unbindFrameBuffer=function(i,a){var n=this;i.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(a)})},r.prototype.dispose=function(){this.releaseInternalTextures(),c.prototype.dispose.call(this)},r.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var i=this._internalTextures.length-1;i>=0;i--)this._internalTextures[i]!==void 0&&(this._internalTextures[i].dispose(),this._internalTextures.splice(i,1))},r}(t.RenderTargetTexture);t.MultiRenderTarget=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){o===void 0&&(o=t.Engine.TEXTURETYPE_UNSIGNED_INT),l===void 0&&(l=t.Texture.BILINEAR_SAMPLINGMODE),u===void 0&&(u=!0);var h=c.call(this,i,a,n,s,!0,o,!1,l,u)||this;return h.scene=n,h.mirrorPlane=new t.Plane(0,1,0,1),h._transformMatrix=t.Matrix.Zero(),h._mirrorMatrix=t.Matrix.Zero(),h._adaptiveBlurKernel=0,h._blurKernelX=0,h._blurKernelY=0,h._blurRatio=1,h.ignoreCameraViewport=!0,h._updateGammaSpace(),h._imageProcessingConfigChangeObserver=n.imageProcessingConfiguration.onUpdateParameters.add(function(){h._updateGammaSpace}),h.onBeforeRenderObservable.add(function(){t.Matrix.ReflectionToRef(h.mirrorPlane,h._mirrorMatrix),h._savedViewMatrix=n.getViewMatrix(),h._mirrorMatrix.multiplyToRef(h._savedViewMatrix,h._transformMatrix),n.setTransformMatrix(h._transformMatrix,n.getProjectionMatrix()),n.clipPlane=h.mirrorPlane,n.getEngine().cullBackFaces=!1,n._mirroredCameraPosition=t.Vector3.TransformCoordinates(n.activeCamera.globalPosition,h._mirrorMatrix)}),h.onAfterRenderObservable.add(function(){n.setTransformMatrix(h._savedViewMatrix,n.getProjectionMatrix()),n.getEngine().cullBackFaces=!0,n._mirroredCameraPosition=null,delete n.clipPlane}),h}return Object.defineProperty(r.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(i){this._blurRatio!==i&&(this._blurRatio=i,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"adaptiveBlurKernel",{set:function(i){this._adaptiveBlurKernel=i,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"blurKernel",{set:function(i){this.blurKernelX=i,this.blurKernelY=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(i){this._blurKernelX!==i&&(this._blurKernelX=i,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(i){this._blurKernelY!==i&&(this._blurKernelY=i,this._preparePostProcesses())},enumerable:!0,configurable:!0}),r.prototype._autoComputeBlurKernel=function(){var i=this.getScene().getEngine(),a=this.getRenderWidth()/i.getRenderWidth(),n=this.getRenderHeight()/i.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*a,this.blurKernelY=this._adaptiveBlurKernel*n},r.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},r.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},r.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var i=this.getScene().getEngine(),a=i.getCaps().textureFloatRender?t.Engine.TEXTURETYPE_FLOAT:t.Engine.TEXTURETYPE_HALF_FLOAT;this._blurX=new t.BlurPostProcess("horizontal blur",new t.Vector2(1,0),this._blurKernelX,this._blurRatio,null,t.Texture.BILINEAR_SAMPLINGMODE,i,!1,a),this._blurX.autoClear=!1,this._blurRatio===1&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new t.BlurPostProcess("vertical blur",new t.Vector2(0,1),this._blurKernelY,this._blurRatio,null,t.Texture.BILINEAR_SAMPLINGMODE,i,!1,a),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=this._blurRatio!==1,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},r.prototype.clone=function(){var i=this.getScene();if(!i)return this;var a=this.getSize(),n=new r(this.name,a.width,i,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(n.renderList=this.renderList.slice(0)),n},r.prototype.serialize=function(){if(!this.name)return null;var i=c.prototype.serialize.call(this);return i.mirrorPlane=this.mirrorPlane.asArray(),i},r.prototype.dispose=function(){c.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},r}(t.RenderTargetTexture);t.MirrorTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,a,n,s,!0)||this;return o.refractionPlane=new t.Plane(0,1,0,1),o.depth=2,o.onBeforeRenderObservable.add(function(){n.clipPlane=o.refractionPlane}),o.onAfterRenderObservable.add(function(){delete n.clipPlane}),o}return r.prototype.clone=function(){var i=this.getScene();if(!i)return this;var a=this.getSize(),n=new r(this.name,a.width,i,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.refractionPlane=this.refractionPlane.clone(),this.renderList&&(n.renderList=this.renderList.slice(0)),n.depth=this.depth,n},r.prototype.serialize=function(){if(!this.name)return null;var i=c.prototype.serialize.call(this);return i.mirrorPlane=this.refractionPlane.asArray(),i.depth=this.depth,i},r}(t.RenderTargetTexture);t.RefractionTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){n===void 0&&(n=null),o===void 0&&(o=t.Texture.TRILINEAR_SAMPLINGMODE),l===void 0&&(l=t.Engine.TEXTUREFORMAT_RGBA);var u=c.call(this,null,n,!s,void 0,o,void 0,void 0,void 0,void 0,l)||this;u.name=i,u._engine=u.getScene().getEngine(),u.wrapU=t.Texture.CLAMP_ADDRESSMODE,u.wrapV=t.Texture.CLAMP_ADDRESSMODE,u._generateMipMaps=s,a.getContext?(u._canvas=a,u._texture=u._engine.createDynamicTexture(a.width,a.height,s,o)):(u._canvas=document.createElement("canvas"),a.width||a.width===0?u._texture=u._engine.createDynamicTexture(a.width,a.height,s,o):u._texture=u._engine.createDynamicTexture(a,a,s,o));var h=u.getSize();return u._canvas.width=h.width,u._canvas.height=h.height,u._context=u._canvas.getContext("2d"),u}return Object.defineProperty(r.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),r.prototype._recreate=function(i){this._canvas.width=i.width,this._canvas.height=i.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(i.width,i.height,this._generateMipMaps,this._samplingMode)},r.prototype.scale=function(i){var a=this.getSize();a.width*=i,a.height*=i,this._recreate(a)},r.prototype.scaleTo=function(i,a){var n=this.getSize();n.width=i,n.height=a,this._recreate(n)},r.prototype.getContext=function(){return this._context},r.prototype.clear=function(){var i=this.getSize();this._context.fillRect(0,0,i.width,i.height)},r.prototype.update=function(i,a){a===void 0&&(a=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,i===void 0?!0:i,a,this._format||void 0)},r.prototype.drawText=function(i,a,n,s,o,l,u,h){h===void 0&&(h=!0);var d=this.getSize();if(l&&(this._context.fillStyle=l,this._context.fillRect(0,0,d.width,d.height)),this._context.font=s,a==null){var p=this._context.measureText(i);a=(d.width-p.width)/2}if(n==null){var m=parseInt(s.replace(/\D/g,""));n=d.height/2+m/3.65}this._context.fillStyle=o,this._context.fillText(i,a,n),h&&this.update(u)},r.prototype.clone=function(){var i=this.getScene();if(!i)return this;var a=this.getSize(),n=new r(this.name,a,i,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n},r.prototype.serialize=function(){var i=this.getScene();i&&!i.isReady()&&t.Tools.Warn("The scene must be ready before serializing the dynamic texture");var a=c.prototype.serialize.call(this);return a.base64String=this._canvas.toDataURL(),a.invertY=this._invertY,a.samplingMode=this.samplingMode,a},r.prototype._rebuild=function(){this.update()},r}(t.Texture);t.DynamicTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){s===void 0&&(s=!1),o===void 0&&(o=!1),l===void 0&&(l=t.Texture.TRILINEAR_SAMPLINGMODE),u===void 0&&(u={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var h=c.call(this,null,n,!s,o)||this;return h._onUserActionRequestedObservable=null,h._stillImageCaptured=!1,h._poster=!1,h._createInternalTexture=function(){if(h._texture!=null)if(h._poster)h._texture.dispose(),h._poster=!1;else return;if(!h._engine.needPOTTextures||t.Tools.IsExponentOfTwo(h.video.videoWidth)&&t.Tools.IsExponentOfTwo(h.video.videoHeight)?(h.wrapU=t.Texture.WRAP_ADDRESSMODE,h.wrapV=t.Texture.WRAP_ADDRESSMODE):(h.wrapU=t.Texture.CLAMP_ADDRESSMODE,h.wrapV=t.Texture.CLAMP_ADDRESSMODE,h._generateMipMaps=!1),h._texture=h._engine.createDynamicTexture(h.video.videoWidth,h.video.videoHeight,h._generateMipMaps,h._samplingMode),h.video.autoplay)h._texture.isReady=!0,h._updateInternalTexture(),h.onLoadObservable.hasObservers()&&h.onLoadObservable.notifyObservers(h);else{var d=h.video.onplaying,p=!1;h.video.onplaying=function(){h.video.onplaying=d,h._texture.isReady=!0,h._updateInternalTexture(),p||h.video.pause(),h.onLoadObservable.hasObservers()&&h.onLoadObservable.notifyObservers(h)};var m=h.video.play();m?m.then(function(){}).catch(function(){p=!0,h._onUserActionRequestedObservable&&h._onUserActionRequestedObservable.hasObservers()&&h._onUserActionRequestedObservable.notifyObservers(h)}):(h.video.onplaying=d,h._texture.isReady=!0,h._updateInternalTexture(),h.onLoadObservable.hasObservers()&&h.onLoadObservable.notifyObservers(h))}},h.reset=function(){h._texture!=null&&(h._poster||(h._texture.dispose(),h._texture=null))},h._updateInternalTexture=function(d){h._texture==null||!h._texture.isReady||h.video.readyState<h.video.HAVE_CURRENT_DATA||h._engine.updateVideoTexture(h._texture,h.video,h._invertY)},h._engine=h.getScene().getEngine(),h._generateMipMaps=s,h._samplingMode=l,h.autoUpdateTexture=u.autoUpdateTexture,h.name=i||h._getName(a),h.video=h._getVideo(a),u.poster&&(h.video.poster=u.poster),u.autoPlay!==void 0&&(h.video.autoplay=u.autoPlay),u.loop!==void 0&&(h.video.loop=u.loop),h.video.setAttribute("playsinline",""),h.video.addEventListener("canplay",h._createInternalTexture),h.video.addEventListener("paused",h._updateInternalTexture),h.video.addEventListener("seeked",h._updateInternalTexture),h.video.addEventListener("emptied",h.reset),h.video.readyState>=h.video.HAVE_CURRENT_DATA&&h._createInternalTexture(),u.poster&&(h._texture=h._engine.createTexture(u.poster,!1,!0,n),h._poster=!0),h}return Object.defineProperty(r.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new t.Observable),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),r.prototype._getName=function(i){return i instanceof HTMLVideoElement?i.currentSrc:typeof i=="object"?i.toString():i},r.prototype._getVideo=function(i){if(i instanceof HTMLVideoElement)return t.Tools.SetCorsBehavior(i.currentSrc,i),i;var a=document.createElement("video");return typeof i=="string"?(t.Tools.SetCorsBehavior(i,a),a.src=i):(t.Tools.SetCorsBehavior(i[0],a),i.forEach(function(n){var s=document.createElement("source");s.src=n,a.appendChild(s)})),a},r.prototype._rebuild=function(){this.update()},r.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},r.prototype.updateTexture=function(i){i&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},r.prototype.updateURL=function(i){this.video.src=i},r.prototype.dispose=function(){c.prototype.dispose.call(this),this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener("canplay",this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},r.CreateFromWebCam=function(i,a,n){var s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.setAttribute("playsinline","");var o;n&&n.deviceId&&(o={exact:n.deviceId}),window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:n}).then(function(l){s.mozSrcObject!==void 0?s.mozSrcObject=l:s.srcObject=l;var u=function(){a&&a(new r("video",s,i,!0,!0)),s.removeEventListener("playing",u)};s.addEventListener("playing",u),s.play()}).catch(function(l){t.Tools.Error(l.name)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:o,width:{min:n&&n.minWidth||256,max:n&&n.maxWidth||640},height:{min:n&&n.minHeight||256,max:n&&n.maxHeight||480}}},function(l){s.mozSrcObject!==void 0?s.mozSrcObject=l:s.src=window.URL&&window.URL.createObjectURL(l)||l,s.play(),a&&a(new r("video",s,i,!0,!0))},function(l){t.Tools.Error(l.name)}))},r}(t.Texture);t.VideoTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d){l===void 0&&(l=!0),u===void 0&&(u=!1),h===void 0&&(h=t.Texture.TRILINEAR_SAMPLINGMODE),d===void 0&&(d=t.Engine.TEXTURETYPE_UNSIGNED_INT);var p=c.call(this,null,o,!l,u)||this;return p.format=s,p._engine=o.getEngine(),p._texture=o.getEngine().createRawTexture(i,a,n,s,l,u,h,null,d),p.wrapU=t.Texture.CLAMP_ADDRESSMODE,p.wrapV=t.Texture.CLAMP_ADDRESSMODE,p}return r.prototype.update=function(i){this._engine.updateRawTexture(this._texture,i,this._texture.format,this._texture.invertY,void 0,this._texture.type)},r.CreateLuminanceTexture=function(i,a,n,s,o,l,u){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),new r(i,a,n,t.Engine.TEXTUREFORMAT_LUMINANCE,s,o,l,u)},r.CreateLuminanceAlphaTexture=function(i,a,n,s,o,l,u){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),new r(i,a,n,t.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,s,o,l,u)},r.CreateAlphaTexture=function(i,a,n,s,o,l,u){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),new r(i,a,n,t.Engine.TEXTUREFORMAT_ALPHA,s,o,l,u)},r.CreateRGBTexture=function(i,a,n,s,o,l,u,h){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),h===void 0&&(h=t.Engine.TEXTURETYPE_UNSIGNED_INT),new r(i,a,n,t.Engine.TEXTUREFORMAT_RGB,s,o,l,u,h)},r.CreateRGBATexture=function(i,a,n,s,o,l,u,h){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),h===void 0&&(h=t.Engine.TEXTURETYPE_UNSIGNED_INT),new r(i,a,n,t.Engine.TEXTUREFORMAT_RGBA,s,o,l,u,h)},r.CreateRTexture=function(i,a,n,s,o,l,u,h){return o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=t.Texture.TRILINEAR_SAMPLINGMODE),h===void 0&&(h=t.Engine.TEXTURETYPE_FLOAT),new r(i,a,n,t.Engine.TEXTUREFORMAT_R,s,o,l,u,h)},r}(t.Texture);t.RawTexture=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p){u===void 0&&(u=!0),h===void 0&&(h=!1),d===void 0&&(d=t.Texture.TRILINEAR_SAMPLINGMODE),p===void 0&&(p=t.Engine.TEXTURETYPE_UNSIGNED_INT);var m=c.call(this,null,l,!u,h)||this;return m.format=o,m._engine=l.getEngine(),m._texture=l.getEngine().createRawTexture3D(i,a,n,s,o,u,h,d,void 0,p),m.is3D=!0,m}return r.prototype.update=function(i){this._texture&&this._engine.updateRawTexture3D(this._texture,i,this._texture.format,this._texture.invertY,void 0,this._texture.type)},r}(t.Texture);t.RawTexture3D=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this._vertexBuffers={},this._scene=r}return c.prototype._prepareBuffers=function(){if(!this._vertexBuffers[t.VertexBuffer.PositionKind]){var r=[];r.push(1,1),r.push(-1,1),r.push(-1,-1),r.push(1,-1),this._vertexBuffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(this._scene.getEngine(),r,t.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},c.prototype._buildIndexBuffer=function(){var r=[];r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(r)},c.prototype._rebuild=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&(r._rebuild(),this._buildIndexBuffer())},c.prototype._prepareFrame=function(r,n){r===void 0&&(r=null),n===void 0&&(n=null);var a=this._scene.activeCamera;if(!a)return!1;var n=n||a._postProcesses.filter(function(s){return s!=null});return!n||n.length===0||!this._scene.postProcessesEnabled?!1:(n[0].activate(a,r,n!=null),!0)},c.prototype.directRender=function(r,i,a,n,s){i===void 0&&(i=null),a===void 0&&(a=!1),n===void 0&&(n=0),s===void 0&&(s=0);for(var o=this._scene.getEngine(),l=0;l<r.length;l++){l<r.length-1?r[l+1].activate(this._scene.activeCamera,i):i?o.bindFramebuffer(i,n,void 0,void 0,a,void 0,s):o.restoreDefaultFramebuffer();var u=r[l],h=u.apply();h&&(u.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(t.Material.TriangleFillMode,0,6),u.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},c.prototype._finalizeFrame=function(r,i,a,n,s){s===void 0&&(s=!1);var o=this._scene.activeCamera;if(o&&(n=n||o._postProcesses.filter(function(m){return m!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var l=this._scene.getEngine(),u=0,h=n.length;u<h;u++){var d=n[u];if(u<h-1?d._outputTexture=n[u+1].activate(o,i):i?(l.bindFramebuffer(i,a,void 0,void 0,s),d._outputTexture=i):(l.restoreDefaultFramebuffer(),d._outputTexture=null),r)break;var p=d.apply();p&&(d.onBeforeRenderObservable.notifyObservers(p),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,p),l.drawElementsType(t.Material.TriangleFillMode,0,6),d.onAfterRenderObservable.notifyObservers(p))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(t.Engine.ALPHA_DISABLE)}},c.prototype.dispose=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&(r.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},c}();t.PostProcessManager=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l,u,h,d,p,m,_,v){l===void 0&&(l=t.Texture.NEAREST_SAMPLINGMODE),d===void 0&&(d=null),p===void 0&&(p=t.Engine.TEXTURETYPE_UNSIGNED_INT),m===void 0&&(m="postprocess"),v===void 0&&(v=!1),this.name=r,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=t.Engine.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=t.Engine.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new t.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new t.Vector2(1,1),this._texelSize=t.Vector2.Zero(),this.onActivateObservable=new t.Observable,this.onSizeChangedObservable=new t.Observable,this.onApplyObservable=new t.Observable,this.onBeforeRenderObservable=new t.Observable,this.onAfterRenderObservable=new t.Observable,o!=null?(this._camera=o,this._scene=o.getScene(),o.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this)):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=s,this.renderTargetSamplingMode=l||t.Texture.NEAREST_SAMPLINGMODE,this._reusable=h||!1,this._textureType=p,this._samplers=n||[],this._samplers.push("textureSampler"),this._fragmentUrl=i,this._vertexUrl=m,this._parameters=a||[],this._parameters.push("scale"),this._indexParameters=_,v||this.updateEffect(d)}return Object.defineProperty(c.prototype,"samples",{get:function(){return this._samples},set:function(r){var i=this;this._samples=r,this._textures.forEach(function(a){a.samples!==i._samples&&i._engine.updateRenderTargetTextureSampleCount(a,i._samples)})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onActivate",{set:function(r){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),r&&(this._onActivateObserver=this.onActivateObservable.add(r))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onSizeChanged",{set:function(r){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onApply",{set:function(r){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBeforeRender",{set:function(r){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterRender",{set:function(r){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(r){this._forcedOutputTexture=r},enumerable:!0,configurable:!0}),c.prototype.getCamera=function(){return this._camera},Object.defineProperty(c.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),c.prototype.getEngine=function(){return this._engine},c.prototype.getEffect=function(){return this._effect},c.prototype.shareOutputWith=function(r){return this._disposeTextures(),this._shareOutputWithPostProcess=r,this},c.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new t.SmartArray(2)),this._shareOutputWithPostProcess=null},c.prototype.updateEffect=function(r,i,a,n,s,o){r===void 0&&(r=null),i===void 0&&(i=null),a===void 0&&(a=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],i||this._parameters,a||this._samplers,r!==null?r:"",void 0,s,o,n||this._indexParameters)},c.prototype.isReusable=function(){return this._reusable},c.prototype.markTextureDirty=function(){this.width=-1},c.prototype.activate=function(r,i,a){var n=this;i===void 0&&(i=null),r=r||this._camera;var s=r.getScene(),o=s.getEngine(),l=o.getCaps().maxTextureSize,u=(i?i.width:this._engine.getRenderWidth(!0))*this._options|0,h=(i?i.height:this._engine.getRenderHeight(!0))*this._options|0,d=r.parent;d&&(d.leftCamera==r||d.rightCamera==r)&&(u/=2);var p=this._options.width||u,m=this._options.height||h;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var _=o.currentViewport;_&&(p*=_.width,m*=_.height)}if((this.renderTargetSamplingMode===t.Texture.TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(p=o.needPOTTextures?t.Tools.GetExponentOfTwo(p,l,this.scaleMode):p),this._options.height||(m=o.needPOTTextures?t.Tools.GetExponentOfTwo(m,l,this.scaleMode):m)),this.width!==p||this.height!==m){if(this._textures.length>0){for(var v=0;v<this._textures.length;v++)this._engine._releaseTexture(this._textures.data[v]);this._textures.reset()}this.width=p,this.height=m;var S={width:this.width,height:this.height},P={generateMipMaps:!1,generateDepthBuffer:a||r._postProcesses.indexOf(this)===0,generateStencilBuffer:(a||r._postProcesses.indexOf(this)===0)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(S,P)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(S,P)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(R){R.samples!==n.samples&&n._engine.updateRenderTargetTextureSampleCount(R,n.samples)})}var x;return this._shareOutputWithPostProcess?x=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(x=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):x=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(u/p,h/m),this._engine.bindFramebuffer(x,0,u,h,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(x,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(r),this.autoClear&&this.alphaMode===t.Engine.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:s.clearColor,s._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),x},Object.defineProperty(c.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),c.prototype.isReady=function(){return this._effect&&this._effect.isReady()},c.prototype.apply=function(){if(!this._effect||!this._effect.isReady())return null;this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);var r;return this._shareOutputWithPostProcess?r=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?r=this._forcedOutputTexture:r=this.inputTexture,this._effect._bindTexture("textureSampler",r),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect},c.prototype._disposeTextures=function(){if(!(this._shareOutputWithPostProcess||this._forcedOutputTexture)){if(this._textures.length>0)for(var r=0;r<this._textures.length;r++)this._engine._releaseTexture(this._textures.data[r]);this._textures.dispose()}},c.prototype.dispose=function(r){if(r=r||this._camera,this._disposeTextures(),this._scene){var i=this._scene.postProcesses.indexOf(this);i!==-1&&this._scene.postProcesses.splice(i,1)}else{var a=this._engine.postProcesses.indexOf(this);a!==-1&&this._engine.postProcesses.splice(a,1)}if(r){r.detachPostProcess(this);var n=r._postProcesses.indexOf(this);if(n===0&&r._postProcesses.length>0){var s=this._camera._getFirstPostProcess();s&&s.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},c}();t.PostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){return n===void 0&&(n=null),u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=!1),c.call(this,i,"pass",null,null,a,n,s,o,l,void 0,u,void 0,null,h)||this}return r}(t.PostProcess);t.PassPostProcess=f})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function c(r,i,a){this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=c.FILTER_NONE,this._filteringQuality=c.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=t.Vector3.Zero(),this._viewMatrix=t.Matrix.Zero(),this._projectionMatrix=t.Matrix.Zero(),this._transformMatrix=t.Matrix.Zero(),this._cachedPosition=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=t.Matrix.Identity(),this._mapSize=r,this._light=i,this._scene=i.getScene(),i._shadowGenerator=this;var n=this._scene._getComponent(t.SceneComponentConstants.NAME_SHADOWGENERATOR);n||(n=new t.ShadowGeneratorSceneComponent(this._scene),this._scene._addComponent(n));var s=this._scene.getEngine().getCaps();a?s.textureFloatRender&&s.textureFloatLinearFiltering?this._textureType=t.Engine.TEXTURETYPE_FLOAT:s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?this._textureType=t.Engine.TEXTURETYPE_HALF_FLOAT:this._textureType=t.Engine.TEXTURETYPE_UNSIGNED_INT:s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?this._textureType=t.Engine.TEXTURETYPE_HALF_FLOAT:s.textureFloatRender&&s.textureFloatLinearFiltering?this._textureType=t.Engine.TEXTURETYPE_FLOAT:this._textureType=t.Engine.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(c.prototype,"bias",{get:function(){return this._bias},set:function(r){this._bias=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"normalBias",{get:function(){return this._normalBias},set:function(r){this._normalBias=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(r){this._blurBoxOffset!==r&&(this._blurBoxOffset=r,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"blurScale",{get:function(){return this._blurScale},set:function(r){this._blurScale!==r&&(this._blurScale=r,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(r){this._blurKernel!==r&&(this._blurKernel=r,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(r){this._useKernelBlur!==r&&(this._useKernelBlur=r,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"depthScale",{get:function(){return this._depthScale!==void 0?this._depthScale:this._light.getDepthScale()},set:function(r){this._depthScale=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"filter",{get:function(){return this._filter},set:function(r){if(this._light.needCube()){if(r===c.FILTER_BLUREXPONENTIALSHADOWMAP){this.useExponentialShadowMap=!0;return}else if(r===c.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP){this.useCloseExponentialShadowMap=!0;return}else if(r===c.FILTER_PCF||r===c.FILTER_PCSS){this.usePoissonSampling=!0;return}}if((r===c.FILTER_PCF||r===c.FILTER_PCSS)&&this._scene.getEngine().webGLVersion===1){this.usePoissonSampling=!0;return}this._filter!==r&&(this._filter=r,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"usePoissonSampling",{get:function(){return this.filter===c.FILTER_POISSONSAMPLING},set:function(r){!r&&this.filter!==c.FILTER_POISSONSAMPLING||(this.filter=r?c.FILTER_POISSONSAMPLING:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useVarianceShadowMap",{get:function(){return t.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap},set:function(r){t.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useBlurVarianceShadowMap",{get:function(){return t.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap},set:function(r){t.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useExponentialShadowMap",{get:function(){return this.filter===c.FILTER_EXPONENTIALSHADOWMAP},set:function(r){!r&&this.filter!==c.FILTER_EXPONENTIALSHADOWMAP||(this.filter=r?c.FILTER_EXPONENTIALSHADOWMAP:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===c.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(r){!r&&this.filter!==c.FILTER_BLUREXPONENTIALSHADOWMAP||(this.filter=r?c.FILTER_BLUREXPONENTIALSHADOWMAP:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===c.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(r){!r&&this.filter!==c.FILTER_CLOSEEXPONENTIALSHADOWMAP||(this.filter=r?c.FILTER_CLOSEEXPONENTIALSHADOWMAP:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===c.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(r){!r&&this.filter!==c.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP||(this.filter=r?c.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===c.FILTER_PCF},set:function(r){!r&&this.filter!==c.FILTER_PCF||(this.filter=r?c.FILTER_PCF:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(r){this._filteringQuality=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"useContactHardeningShadow",{get:function(){return this.filter===c.FILTER_PCSS},set:function(r){!r&&this.filter!==c.FILTER_PCSS||(this.filter=r?c.FILTER_PCSS:c.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(r){this._contactHardeningLightSizeUVRatio=r},enumerable:!0,configurable:!0}),c.prototype.getDarkness=function(){return this._darkness},c.prototype.setDarkness=function(r){return r>=1?this._darkness=1:r<=0?this._darkness=0:this._darkness=r,this},c.prototype.setTransparencyShadow=function(r){return this._transparencyShadow=r,this},c.prototype.getShadowMap=function(){return this._shadowMap},c.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},c.prototype.addShadowCaster=function(r,i){i===void 0&&(i=!0);var a;return this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(r),i&&(a=this._shadowMap.renderList).push.apply(a,r.getChildMeshes()),this):this},c.prototype.removeShadowCaster=function(r,i){if(i===void 0&&(i=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var a=this._shadowMap.renderList.indexOf(r);if(a!==-1&&this._shadowMap.renderList.splice(a,1),i)for(var n=0,s=r.getChildren();n<s.length;n++){var o=s[n];this.removeShadowCaster(o)}return this},c.prototype.getLight=function(){return this._light},c.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},c.prototype._initializeShadowMap=function(){var r=this,i=this._scene.getEngine();i.webGLVersion>1?(this._shadowMap=new t.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(t.Engine.LESS,!0)):this._shadowMap=new t.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(s){r._currentFaceIndex=s,r._filter===c.FILTER_PCF&&i.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(r._filter===c.FILTER_PCF&&i.setColorWrite(!0),!(!r.useBlurExponentialShadowMap&&!r.useBlurCloseExponentialShadowMap)){var s=r.getShadowMapForRendering();s&&r._scene.postProcessManager.directRender(r._blurPostProcesses,s.getInternalTexture(),!0)}});var a=new t.Color4(0,0,0,0),n=new t.Color4(1,1,1,1);this._shadowMap.onClearObservable.add(function(s){r._filter===c.FILTER_PCF?s.clear(n,!1,!0,!1):r.useExponentialShadowMap||r.useBlurExponentialShadowMap?s.clear(a,!0,!0,!1):s.clear(n,!0,!0,!1)})},c.prototype._initializeBlurRTTAndPostProcesses=function(){var r=this,i=this._scene.getEngine(),a=this._mapSize/this.blurScale;(!this.useKernelBlur||this.blurScale!==1)&&(this._shadowMap2=new t.RenderTargetTexture(this._light.name+"_shadowMap2",a,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new t.BlurPostProcess(this._light.name+"KernelBlurX",new t.Vector2(1,0),this.blurKernel,1,null,t.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.width=a,this._kernelBlurXPostprocess.height=a,this._kernelBlurXPostprocess.onApplyObservable.add(function(n){n.setTexture("textureSampler",r._shadowMap)}),this._kernelBlurYPostprocess=new t.BlurPostProcess(this._light.name+"KernelBlurY",new t.Vector2(0,1),this.blurKernel,1,null,t.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===t.Engine.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new t.PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,t.Texture.BILINEAR_SAMPLINGMODE,i,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(n){n.setFloat2("screenSize",a,a),n.setTexture("textureSampler",r._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},c.prototype._renderForShadowMap=function(r,i,a,n){var s,o=this._scene.getEngine();if(n.length){for(o.setColorWrite(!1),s=0;s<n.length;s++)this._renderSubMeshForShadowMap(n.data[s]);o.setColorWrite(!0)}for(s=0;s<r.length;s++)this._renderSubMeshForShadowMap(r.data[s]);for(s=0;s<i.length;s++)this._renderSubMeshForShadowMap(i.data[s]);if(this._transparencyShadow)for(s=0;s<a.length;s++)this._renderSubMeshForShadowMap(a.data[s])},c.prototype._renderSubMeshForShadowMap=function(r){var i=this,a=r.getRenderingMesh(),n=this._scene,s=n.getEngine(),o=r.getMaterial();if(o){s.setState(o.backFaceCulling);var l=a._getInstancesRenderList(r._id);if(!l.mustReturn){var u=s.getCaps().instancedArrays&&l.visibleInstances[r._id]!==null&&l.visibleInstances[r._id]!==void 0;if(this.isReady(r,u)){if(s.enableEffect(this._effect),a._bind(r,this._effect,t.Material.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===t.Light.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),n.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(n.activeCamera),this.getLight().getDepthMinZ(n.activeCamera)+this.getLight().getDepthMaxZ(n.activeCamera)),o&&o.needAlphaTesting()){var h=o.getAlphaTestTexture();h&&(this._effect.setTexture("diffuseSampler",h),this._effect.setMatrix("diffuseMatrix",h.getTextureMatrix()||this._defaultTextureMatrix))}a.useBones&&a.computeBonesUsingShaders&&this._effect.setMatrices("mBones",a.skeleton.getTransformMatrices(a)),t.MaterialHelper.BindMorphTargetParameters(a,this._effect),this.forceBackFacesOnly&&s.setState(!0,0,!1,!0),a._processRendering(r,this._effect,t.Material.TriangleFillMode,l,u,function(d,p){return i._effect.setMatrix("world",p)}),this.forceBackFacesOnly&&s.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},c.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===c.FILTER_NONE||this.filter===c.FILTER_PCSS?this._shadowMap.updateSamplingMode(t.Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE))},c.prototype.forceCompilation=function(r,i){var a=this,n=Ve({useInstances:!1},i),s=this.getShadowMap();if(!s){r&&r(this);return}var o=s.renderList;if(!o){r&&r(this);return}for(var l=new Array,u=0,h=o;u<h.length;u++){var d=h[u];l.push.apply(l,d.subMeshes)}if(l.length===0){r&&r(this);return}var p=0,m=function(){if(!(!a._scene||!a._scene.getEngine())){for(;a.isReady(l[p],n.useInstances);)if(p++,p>=l.length){r&&r(a);return}setTimeout(m,16)}};m()},c.prototype.forceCompilationAsync=function(r){var i=this;return new Promise(function(a){i.forceCompilation(function(){a()},r)})},c.prototype.isReady=function(r,i){var a=[];this._textureType!==t.Engine.TEXTURETYPE_UNSIGNED_INT&&a.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?a.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&a.push("#define DEPTHTEXTURE");var n=[t.VertexBuffer.PositionKind],s=r.getMesh(),o=r.getMaterial();if(this.normalBias&&s.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(n.push(t.VertexBuffer.NormalKind),a.push("#define NORMAL"),s.nonUniformScaling&&a.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===t.Light.LIGHTTYPEID_DIRECTIONALLIGHT&&a.push("#define DIRECTIONINLIGHTDATA")),o&&o.needAlphaTesting()){var l=o.getAlphaTestTexture();l&&(a.push("#define ALPHATEST"),s.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(n.push(t.VertexBuffer.UVKind),a.push("#define UV1")),s.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&l.coordinatesIndex===1&&(n.push(t.VertexBuffer.UV2Kind),a.push("#define UV2")))}s.useBones&&s.computeBonesUsingShaders?(n.push(t.VertexBuffer.MatricesIndicesKind),n.push(t.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(n.push(t.VertexBuffer.MatricesIndicesExtraKind),n.push(t.VertexBuffer.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),a.push("#define BonesPerMesh "+(s.skeleton.bones.length+1))):a.push("#define NUM_BONE_INFLUENCERS 0");var u=s.morphTargetManager,h=0;u&&u.numInfluencers>0&&(a.push("#define MORPHTARGETS"),h=u.numInfluencers,a.push("#define NUM_MORPH_INFLUENCERS "+h),t.MaterialHelper.PrepareAttributesForMorphTargets(n,s,{NUM_MORPH_INFLUENCERS:h})),i&&(a.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var d=a.join(`
`);return this._cachedDefines!==d&&(this._cachedDefines=d,this._effect=this._scene.getEngine().createEffect("shadowMap",n,["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences"],["diffuseSampler"],d,void 0,void 0,void 0,{maxSimultaneousMorphTargets:h})),!(!this._effect.isReady()||((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(!this._blurPostProcesses||!this._blurPostProcesses.length)&&this._initializeBlurRTTAndPostProcesses(),this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())||this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()||this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())},c.prototype.prepareDefines=function(r,i){var a=this._scene,n=this._light;!a.shadowsEnabled||!n.shadowEnabled||(r["SHADOW"+i]=!0,this.useContactHardeningShadow&&(r["SHADOWPCSS"+i]=!0,this._filteringQuality===c.QUALITY_LOW?r["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===c.QUALITY_MEDIUM&&(r["SHADOWMEDIUMQUALITY"+i]=!0)),this.usePercentageCloserFiltering?(r["SHADOWPCF"+i]=!0,this._filteringQuality===c.QUALITY_LOW?r["SHADOWLOWQUALITY"+i]=!0:this._filteringQuality===c.QUALITY_MEDIUM&&(r["SHADOWMEDIUMQUALITY"+i]=!0)):this.usePoissonSampling?r["SHADOWPOISSON"+i]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?r["SHADOWESM"+i]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(r["SHADOWCLOSEESM"+i]=!0),n.needCube()&&(r["SHADOWCUBE"+i]=!0))},c.prototype.bindShadowLight=function(r,i){var a=this._light,n=this._scene;if(!(!n.shadowsEnabled||!a.shadowEnabled)){var s=n.activeCamera;if(s){var o=this.getShadowMap();o&&(a.needCube()||i.setMatrix("lightMatrix"+r,this.getTransformMatrix()),this._filter===c.FILTER_PCF?(i.setDepthStencilTexture("shadowSampler"+r,this.getShadowMapForRendering()),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),o.getSize().width,1/o.getSize().width,this.frustumEdgeFalloff,r)):this._filter===c.FILTER_PCSS?(i.setDepthStencilTexture("shadowSampler"+r,this.getShadowMapForRendering()),i.setTexture("depthSampler"+r,this.getShadowMapForRendering()),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/o.getSize().width,this._contactHardeningLightSizeUVRatio*o.getSize().width,this.frustumEdgeFalloff,r)):(i.setTexture("shadowSampler"+r,this.getShadowMapForRendering()),a._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/o.getSize().width,this.depthScale,this.frustumEdgeFalloff,r)),a._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(s),this.getLight().getDepthMinZ(s)+this.getLight().getDepthMaxZ(s),r))}}},c.prototype.getTransformMatrix=function(){var r=this._scene;if(this._currentRenderID===r.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=r.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var i=this._light.position;if(this._light.computeTransformedInformation()&&(i=this._light.transformedPosition),t.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),Math.abs(t.Vector3.Dot(this._lightDirection,t.Vector3.Up()))===1&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!i.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(i),this._cachedDirection.copyFrom(this._lightDirection),t.Matrix.LookAtLHToRef(i,i.add(this._lightDirection),t.Vector3.Up(),this._viewMatrix);var a=this.getShadowMap();if(a){var n=a.renderList;n&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,n)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},c.prototype.recreateShadowMap=function(){var r=this._shadowMap;if(r){var i=r.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=i}},c.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},c.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},c.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},c.prototype.serialize=function(){var r={},i=this.getShadowMap();if(!i)return r;if(r.lightId=this._light.id,r.mapSize=i.getRenderSize(),r.useExponentialShadowMap=this.useExponentialShadowMap,r.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,r.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,r.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,r.usePoissonSampling=this.usePoissonSampling,r.forceBackFacesOnly=this.forceBackFacesOnly,r.depthScale=this.depthScale,r.darkness=this.getDarkness(),r.blurBoxOffset=this.blurBoxOffset,r.blurKernel=this.blurKernel,r.blurScale=this.blurScale,r.useKernelBlur=this.useKernelBlur,r.transparencyShadow=this._transparencyShadow,r.frustumEdgeFalloff=this.frustumEdgeFalloff,r.bias=this.bias,r.normalBias=this.normalBias,r.usePercentageCloserFiltering=this.usePercentageCloserFiltering,r.useContactHardeningShadow=this.useContactHardeningShadow,r.filteringQuality=this.filteringQuality,r.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,r.renderList=[],i.renderList)for(var a=0;a<i.renderList.length;a++){var n=i.renderList[a];r.renderList.push(n.id)}return r},c.Parse=function(r,i){for(var a=i.getLightByID(r.lightId),n=new c(r.mapSize,a),s=n.getShadowMap(),o=0;o<r.renderList.length;o++){var l=i.getMeshesByID(r.renderList[o]);l.forEach(function(u){s&&(s.renderList||(s.renderList=[]),s.renderList.push(u))})}return r.usePoissonSampling?n.usePoissonSampling=!0:r.useExponentialShadowMap?n.useExponentialShadowMap=!0:r.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:r.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:r.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:r.usePercentageCloserFiltering?n.usePercentageCloserFiltering=!0:r.useContactHardeningShadow&&(n.useContactHardeningShadow=!0),r.filteringQuality&&(n.filteringQuality=r.filteringQuality),r.contactHardeningLightSizeUVRatio?n.contactHardeningLightSizeUVRatio=r.contactHardeningLightSizeUVRatio:r.useVarianceShadowMap?n.useExponentialShadowMap=!0:r.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),r.depthScale&&(n.depthScale=r.depthScale),r.blurScale&&(n.blurScale=r.blurScale),r.blurBoxOffset&&(n.blurBoxOffset=r.blurBoxOffset),r.useKernelBlur&&(n.useKernelBlur=r.useKernelBlur),r.blurKernel&&(n.blurKernel=r.blurKernel),r.bias!==void 0&&(n.bias=r.bias),r.normalBias!==void 0&&(n.normalBias=r.normalBias),r.frustumEdgeFalloff!==void 0&&(n.frustumEdgeFalloff=r.frustumEdgeFalloff),r.darkness&&n.setDarkness(r.darkness),r.transparencyShadow&&n.setTransparencyShadow(!0),n.forceBackFacesOnly=r.forceBackFacesOnly,n},c.FILTER_NONE=0,c.FILTER_EXPONENTIALSHADOWMAP=1,c.FILTER_POISSONSAMPLING=2,c.FILTER_BLUREXPONENTIALSHADOWMAP=3,c.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,c.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,c.FILTER_PCF=6,c.FILTER_PCSS=7,c.QUALITY_HIGH=0,c.QUALITY_MEDIUM=1,c.QUALITY_LOW=2,c}();t.ShadowGenerator=f})(T||(T={}));var T;(function(t){t.AbstractScene.AddParser(t.SceneComponentConstants.NAME_SHADOWGENERATOR,function(c,r,i,a){if(c.shadowGenerators!==void 0&&c.shadowGenerators!==null)for(var n=0,s=c.shadowGenerators.length;n<s;n++){var o=c.shadowGenerators[n];t.ShadowGenerator.Parse(o,r)}});var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_SHADOWGENERATOR,this.scene=r}return c.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},c.prototype.rebuild=function(){},c.prototype.serialize=function(r){r.shadowGenerators=[];for(var i=this.scene.lights,a=0,n=i;a<n.length;a++){var s=n[a],o=s.getShadowGenerator();o&&r.shadowGenerators.push(o.serialize())}},c.prototype.addFromContainer=function(r){},c.prototype.removeFromContainer=function(r){},c.prototype.dispose=function(){},c.prototype._gatherRenderTargets=function(r){var i=this.scene;if(this.scene.shadowsEnabled)for(var a=0;a<i.lights.length;a++){var n=i.lights[a],s=n.getShadowGenerator();if(n.isEnabled()&&n.shadowEnabled&&s){var o=s.getShadowMap();i.textures.indexOf(o)!==-1&&r.push(o)}}},c}();t.ShadowGeneratorSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){i===void 0&&(i=""),a===void 0&&(a="black");var n=this;this._renderingCanvas=r,this._loadingText=i,this._loadingDivBackgroundColor=a,this._resizeLoadingUI=function(){var s=n._renderingCanvas.getBoundingClientRect(),o=window.getComputedStyle(n._renderingCanvas).position;n._loadingDiv&&(n._loadingDiv.style.position=o==="fixed"?"fixed":"absolute",n._loadingDiv.style.left=s.left+"px",n._loadingDiv.style.top=s.top+"px",n._loadingDiv.style.width=s.width+"px",n._loadingDiv.style.height=s.height+"px")}}return c.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var r=document.createElement("style");r.type="text/css";var i=`@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}
                    100% { -webkit-transform: rotate(360deg);}
                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}
                    100% { transform: rotate(360deg);}
                }`;r.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(r);var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC",a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.marginLeft="-60px",a.style.marginTop="-60px",a.style.animation="spin1 2s infinite ease-in-out",a.style.webkitAnimation="spin1 2s infinite ease-in-out",a.style.transformOrigin="50% 50%",a.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(a),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},c.prototype.hideLoadingUI=function(){var r=this;if(this._loadingDiv){var i=function(){r._loadingDiv&&(document.body.removeChild(r._loadingDiv),window.removeEventListener("resize",r._resizeLoadingUI),r._loadingDiv=null)};this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",i)}},Object.defineProperty(c.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(r){this._loadingText=r,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(r){this._loadingDivBackgroundColor=r,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),c}();t.DefaultLoadingScreen=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n){this.lengthComputable=i,this.loaded=a,this.total=n}return r.FromProgressEvent=function(i){return new r(i.lengthComputable,i.loaded,i.total)},r}();t.SceneLoaderProgressEvent=f;var c=function(){function r(){}return Object.defineProperty(r,"ForceFullSceneLoadingForIncremental",{get:function(){return r._ForceFullSceneLoadingForIncremental},set:function(i){r._ForceFullSceneLoadingForIncremental=i},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ShowLoadingScreen",{get:function(){return r._ShowLoadingScreen},set:function(i){r._ShowLoadingScreen=i},enumerable:!0,configurable:!0}),Object.defineProperty(r,"loggingLevel",{get:function(){return r._loggingLevel},set:function(i){r._loggingLevel=i},enumerable:!0,configurable:!0}),Object.defineProperty(r,"CleanBoneMatrixWeights",{get:function(){return r._CleanBoneMatrixWeights},set:function(i){r._CleanBoneMatrixWeights=i},enumerable:!0,configurable:!0}),r._getDefaultPlugin=function(){return r._registeredPlugins[".babylon"]},r._getPluginForExtension=function(i){var a=r._registeredPlugins[i];return a||(t.Tools.Warn("Unable to find a plugin to load "+i+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),r._getDefaultPlugin())},r._getPluginForDirectLoad=function(i){for(var a in r._registeredPlugins){var n=r._registeredPlugins[a].plugin;if(n.canDirectLoad&&n.canDirectLoad(i))return r._registeredPlugins[a]}return r._getDefaultPlugin()},r._getPluginForFilename=function(i){var a=i.indexOf("?");a!==-1&&(i=i.substring(0,a));var n=i.lastIndexOf("."),s=i.substring(n,i.length).toLowerCase();return r._getPluginForExtension(s)},r._getDirectLoad=function(i){return i.substr(0,5)==="data:"?i.substr(5):null},r._loadData=function(i,a,n,s,o,l,u){var h=r._getDirectLoad(i.name),d=u?r._getPluginForExtension(u):h?r._getPluginForDirectLoad(i.name):r._getPluginForFilename(i.name),p;d.plugin.createPlugin?p=d.plugin.createPlugin():p=d.plugin;var m=d.isBinary,_;r.OnPluginActivatedObservable.notifyObservers(p);var v=function(M,C){if(a.isDisposed){o("Scene has been disposed");return}a.database=_,n(p,M,C)},S=null,P=!1,x=p.onDisposeObservable;x&&x.add(function(){P=!0,S&&(S.abort(),S=null),l()});var R=function(){P||(S=t.Tools.LoadFile(i.url,v,s?function(M){s(f.FromProgressEvent(M))}:void 0,_,m,function(M,C){o("Failed to load scene."+(C?" "+C.message:""),C)}))};if(h)return v(h),p;if(i.rootUrl.indexOf("file:")===-1){var w=a.getEngine(),I=w.enableOfflineSupport;if(I){for(var F=!1,k=0,E=a.disableOfflineSupportExceptionRules;k<E.length;k++){var g=E[k];if(g.test(i.url)){F=!0;break}}I=!F}I?_=new t.Database(i.url,R,w.disableManifestCheck):R()}else{var y=t.FilesInput.FilesToLoad[i.name.toLowerCase()];y?S=t.Tools.ReadFile(y,v,s,m):o("Unable to find file named "+i.name)}return p},r._getFileInfo=function(i,a){var n,s;if(!a)n=i,s=t.Tools.GetFilename(i),i=t.Tools.GetFolderPath(i);else{if(a.substr(0,1)==="/")return t.Tools.Error("Wrong sceneFilename parameter"),null;n=i+a,s=a}return{url:n,rootUrl:i,name:s}},r.GetPluginForExtension=function(i){return r._getPluginForExtension(i).plugin},r.IsPluginForExtensionAvailable=function(i){return!!r._registeredPlugins[i]},r.RegisterPlugin=function(i){if(typeof i.extensions=="string"){var a=i.extensions;r._registeredPlugins[a.toLowerCase()]={plugin:i,isBinary:!1}}else{var n=i.extensions;Object.keys(n).forEach(function(s){r._registeredPlugins[s.toLowerCase()]={plugin:i,isBinary:n[s].isBinary}})}},r.ImportMesh=function(i,a,n,s,o,l,u,h){if(n===void 0&&(n=""),s===void 0&&(s=t.Engine.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),h===void 0&&(h=null),!s)return t.Tools.Error("No scene available to import mesh to"),null;var d=r._getFileInfo(a,n);if(!d)return null;var p={};s._addPendingData(p);var m=function(){s._removePendingData(p)},_=function(P,x){var R="Unable to import meshes from "+d.url+": "+P;u?u(s,R,x):t.Tools.Error(R),m()},v=l?function(P){try{l(P)}catch(x){_("Error in onProgress callback",x)}}:void 0,S=function(P,x,R,w){if(s.importedMeshesFiles.push(d.url),o)try{o(P,x,R,w)}catch(I){_("Error in onSuccess callback",I)}s._removePendingData(p)};return r._loadData(d,s,function(P,x,R){if(P.rewriteRootURL&&(d.rootUrl=P.rewriteRootURL(d.rootUrl,R)),P.importMesh){var w=P,I=new Array,F=new Array,k=new Array;if(!w.importMesh(i,s,x,d.rootUrl,I,F,k,_))return;s.loadingPluginName=P.name,S(I,F,k,[])}else{var E=P;E.importMeshAsync(i,s,x,d.rootUrl,v,d.name).then(function(g){s.loadingPluginName=P.name,S(g.meshes,g.particleSystems,g.skeletons,g.animationGroups)}).catch(function(g){_(g.message,g)})}},v,_,m,h)},r.ImportMeshAsync=function(i,a,n,s,o,l){return n===void 0&&(n=""),s===void 0&&(s=t.Engine.LastCreatedScene),o===void 0&&(o=null),l===void 0&&(l=null),new Promise(function(u,h){r.ImportMesh(i,a,n,s,function(d,p,m,_){u({meshes:d,particleSystems:p,skeletons:m,animationGroups:_})},o,function(d,p,m){h(m||new Error(p))},l)})},r.Load=function(i,a,n,s,o,l,u){return s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),r.Append(i,a,new t.Scene(n),s,o,l,u)},r.LoadAsync=function(i,a,n,s,o){return s===void 0&&(s=null),o===void 0&&(o=null),new Promise(function(l,u){r.Load(i,a,n,function(h){l(h)},s,function(h,d,p){u(p||new Error(d))},o)})},r.Append=function(i,a,n,s,o,l,u){if(a===void 0&&(a=""),n===void 0&&(n=t.Engine.LastCreatedScene),s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),!n)return t.Tools.Error("No scene available to append to"),null;var h=r._getFileInfo(i,a);if(!h)return null;r.ShowLoadingScreen&&n.getEngine().displayLoadingUI();var d={};n._addPendingData(d);var p=function(){n._removePendingData(d),n.getEngine().hideLoadingUI()},m=function(S,P){var x="Unable to load from "+h.url+(S?": "+S:"");l?l(n,x,P):t.Tools.Error(x),p()},_=o?function(S){try{o(S)}catch(P){m("Error in onProgress callback",P)}}:void 0,v=function(){if(s)try{s(n)}catch(S){m("Error in onSuccess callback",S)}n._removePendingData(d)};return r._loadData(h,n,function(S,P,x){if(S.load){var R=S;if(!R.load(n,P,h.rootUrl,m))return;n.loadingPluginName=S.name,v()}else{var w=S;w.loadAsync(n,P,h.rootUrl,_,h.name).then(function(){n.loadingPluginName=S.name,v()}).catch(function(I){m(I.message,I)})}r.ShowLoadingScreen&&n.executeWhenReady(function(){n.getEngine().hideLoadingUI()})},_,m,p,u)},r.AppendAsync=function(i,a,n,s,o){return a===void 0&&(a=""),n===void 0&&(n=t.Engine.LastCreatedScene),s===void 0&&(s=null),o===void 0&&(o=null),new Promise(function(l,u){r.Append(i,a,n,function(h){l(h)},s,function(h,d,p){u(p||new Error(d))},o)})},r.LoadAssetContainer=function(i,a,n,s,o,l,u){if(a===void 0&&(a=""),n===void 0&&(n=t.Engine.LastCreatedScene),s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null),!n)return t.Tools.Error("No scene available to load asset container to"),null;var h=r._getFileInfo(i,a);if(!h)return null;var d={};n._addPendingData(d);var p=function(){n._removePendingData(d)},m=function(S,P){var x="Unable to load assets from "+h.url+(S?": "+S:"");l?l(n,x,P):t.Tools.Error(x),p()},_=o?function(S){try{o(S)}catch(P){m("Error in onProgress callback",P)}}:void 0,v=function(S){if(s)try{s(S)}catch(P){m("Error in onSuccess callback",P)}n._removePendingData(d)};return r._loadData(h,n,function(S,P,x){if(S.loadAssetContainer){var R=S,w=R.loadAssetContainer(n,P,h.rootUrl,m);if(!w)return;n.loadingPluginName=S.name,v(w)}else if(S.loadAssetContainerAsync){var I=S;I.loadAssetContainerAsync(n,P,h.rootUrl,_,h.name).then(function(F){n.loadingPluginName=S.name,v(F)}).catch(function(F){m(F.message,F)})}else m("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");r.ShowLoadingScreen&&n.executeWhenReady(function(){n.getEngine().hideLoadingUI()})},_,m,p,u)},r.LoadAssetContainerAsync=function(i,a,n,s,o){return a===void 0&&(a=""),n===void 0&&(n=t.Engine.LastCreatedScene),s===void 0&&(s=null),o===void 0&&(o=null),new Promise(function(l,u){r.LoadAssetContainer(i,a,n,function(h){l(h)},s,function(h,d,p){u(p||new Error(d))},o)})},r._ForceFullSceneLoadingForIncremental=!1,r._ShowLoadingScreen=!0,r._CleanBoneMatrixWeights=!1,r.NO_LOGGING=0,r.MINIMAL_LOGGING=1,r.SUMMARY_LOGGING=2,r.DETAILED_LOGGING=3,r._loggingLevel=r.NO_LOGGING,r.OnPluginActivatedObservable=new t.Observable,r._registeredPlugins={},r}();t.SceneLoader=c})(T||(T={}));var T;(function(t){var f=function(a,n,s,o){for(var l=0,u=n.materials.length;l<u;l++){var h=n.materials[l];if(h.id===a)return t.Material.Parse(h,s,o)}return null},c=function(a,n,s){for(var o in n)if(a.name===n[o])return s.push(a.id),!0;return a.parentId&&s.indexOf(a.parentId)!==-1?(s.push(a.id),!0):!1},r=function(a,n){return a+" of "+(n?n.file+" from "+n.name+" version: "+n.version+", exporter version: "+n.exporter_version:"unknown")},i=function(a,n,s,o,l){l===void 0&&(l=!1);var u=new t.AssetContainer(a),h="importScene has failed JSON parse";try{var d=JSON.parse(n);h="";var p=t.SceneLoader.loggingLevel===t.SceneLoader.DETAILED_LOGGING,m,_;if(d.lights!==void 0&&d.lights!==null)for(m=0,_=d.lights.length;m<_;m++){var v=d.lights[m],S=t.Light.Parse(v,a);S&&(u.lights.push(S),h+=m===0?`
	Lights:`:"",h+=`
		`+S.toString(p))}if(d.animations!==void 0&&d.animations!==null)for(m=0,_=d.animations.length;m<_;m++){var P=d.animations[m],x=t.Animation.Parse(P);a.animations.push(x),u.animations.push(x),h+=m===0?`
	Animations:`:"",h+=`
		`+x.toString(p)}if(d.materials!==void 0&&d.materials!==null)for(m=0,_=d.materials.length;m<_;m++){var R=d.materials[m],w=t.Material.Parse(R,a,s);u.materials.push(w),h+=m===0?`
	Materials:`:"",h+=`
		`+w.toString(p)}if(d.multiMaterials!==void 0&&d.multiMaterials!==null)for(m=0,_=d.multiMaterials.length;m<_;m++){var I=d.multiMaterials[m],F=t.Material.ParseMultiMaterial(I,a);u.multiMaterials.push(F),h+=m===0?`
	MultiMaterials:`:"",h+=`
		`+F.toString(p)}if(d.morphTargetManagers!==void 0&&d.morphTargetManagers!==null)for(var k=0,E=d.morphTargetManagers;k<E.length;k++){var g=E[k];u.morphTargetManagers.push(t.MorphTargetManager.Parse(g,a))}if(d.skeletons!==void 0&&d.skeletons!==null)for(m=0,_=d.skeletons.length;m<_;m++){var y=d.skeletons[m],M=t.Skeleton.Parse(y,a);u.skeletons.push(M),h+=m===0?`
	Skeletons:`:"",h+=`
		`+M.toString(p)}var C=d.geometries;if(C!=null){var D=new Array,V=C.boxes;if(V!=null)for(m=0,_=V.length;m<_;m++){var G=V[m];D.push(t.BoxGeometry.Parse(G,a))}var U=C.spheres;if(U!=null)for(m=0,_=U.length;m<_;m++){var z=U[m];D.push(t.SphereGeometry.Parse(z,a))}var H=C.cylinders;if(H!=null)for(m=0,_=H.length;m<_;m++){var W=H[m];D.push(t.CylinderGeometry.Parse(W,a))}var X=C.toruses;if(X!=null)for(m=0,_=X.length;m<_;m++){var K=X[m];D.push(t.TorusGeometry.Parse(K,a))}var j=C.grounds;if(j!=null)for(m=0,_=j.length;m<_;m++){var ee=j[m];D.push(t.GroundGeometry.Parse(ee,a))}var $=C.planes;if($!=null)for(m=0,_=$.length;m<_;m++){var L=$[m];D.push(t.PlaneGeometry.Parse(L,a))}var Q=C.torusKnots;if(Q!=null)for(m=0,_=Q.length;m<_;m++){var J=Q[m];D.push(t.TorusKnotGeometry.Parse(J,a))}var te=C.vertexData;if(te!=null)for(m=0,_=te.length;m<_;m++){var re=te[m];D.push(t.Geometry.Parse(re,a,s))}D.forEach(function(Se){Se&&u.geometries.push(Se)})}if(d.transformNodes!==void 0&&d.transformNodes!==null)for(m=0,_=d.transformNodes.length;m<_;m++){var le=d.transformNodes[m],ie=t.TransformNode.Parse(le,a,s);u.transformNodes.push(ie)}if(d.meshes!==void 0&&d.meshes!==null)for(m=0,_=d.meshes.length;m<_;m++){var ce=d.meshes[m],de=t.Mesh.Parse(ce,a,s);u.meshes.push(de),h+=m===0?`
	Meshes:`:"",h+=`
		`+de.toString(p)}if(d.cameras!==void 0&&d.cameras!==null)for(m=0,_=d.cameras.length;m<_;m++){var _e=d.cameras[m],ge=t.Camera.Parse(_e,a);u.cameras.push(ge),h+=m===0?`
	Cameras:`:"",h+=`
		`+ge.toString(p)}if(d.animationGroups!==void 0&&d.animationGroups!==null)for(m=0,_=d.animationGroups.length;m<_;m++){var me=d.animationGroups[m],ve=t.AnimationGroup.Parse(me,a);u.animationGroups.push(ve),h+=m===0?`
	AnimationGroups:`:"",h+=`
		`+ve.toString(p)}for(m=0,_=a.cameras.length;m<_;m++){var ge=a.cameras[m];ge._waitingParentId&&(ge.parent=a.getLastEntryByID(ge._waitingParentId),ge._waitingParentId=null)}for(m=0,_=a.lights.length;m<_;m++){var be=a.lights[m];be&&be._waitingParentId&&(be.parent=a.getLastEntryByID(be._waitingParentId),be._waitingParentId=null)}for(m=0,_=a.transformNodes.length;m<_;m++){var Te=a.transformNodes[m];Te._waitingParentId&&(Te.parent=a.getLastEntryByID(Te._waitingParentId),Te._waitingParentId=null)}for(m=0,_=a.meshes.length;m<_;m++){var de=a.meshes[m];de._waitingParentId&&(de.parent=a.getLastEntryByID(de._waitingParentId),de._waitingParentId=null)}for(m=0,_=a.meshes.length;m<_;m++){var He=a.meshes[m];He._waitingFreezeWorldMatrix?(He.freezeWorldMatrix(),He._waitingFreezeWorldMatrix=null):He.computeWorldMatrix(!0)}for(m=0,_=a.lights.length;m<_;m++){var De=a.lights[m];if(De._excludedMeshesIds.length>0){for(var Fe=0;Fe<De._excludedMeshesIds.length;Fe++){var Qe=a.getMeshByID(De._excludedMeshesIds[Fe]);Qe&&De.excludedMeshes.push(Qe)}De._excludedMeshesIds=[]}if(De._includedOnlyMeshesIds.length>0){for(var at=0;at<De._includedOnlyMeshesIds.length;at++){var Rt=a.getMeshByID(De._includedOnlyMeshesIds[at]);Rt&&De.includedOnlyMeshes.push(Rt)}De._includedOnlyMeshesIds=[]}}for(t.AbstractScene.Parse(d,a,u,s),m=0,_=a.meshes.length;m<_;m++){var de=a.meshes[m];de._waitingActions&&(t.ActionManager.Parse(de._waitingActions,de,a),de._waitingActions=null)}d.actions!==void 0&&d.actions!==null&&t.ActionManager.Parse(d.actions,null,a),l||u.removeAllFromScene()}catch(Se){var Ge=r("loadAssets",d?d.producer:"Unknown")+h;if(o)o(Ge,Se);else throw t.Tools.Log(Ge),Se}finally{h!==null&&t.SceneLoader.loggingLevel!==t.SceneLoader.NO_LOGGING&&t.Tools.Log(r("loadAssets",d?d.producer:"Unknown")+(t.SceneLoader.loggingLevel!==t.SceneLoader.MINIMAL_LOGGING?h:""))}return u};t.SceneLoader.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(a){return a.indexOf("babylon")!==-1},importMesh:function(a,n,s,o,l,u,h,d){var p="importMesh has failed JSON parse";try{var m=JSON.parse(s);p="";var _=t.SceneLoader.loggingLevel===t.SceneLoader.DETAILED_LOGGING;a?Array.isArray(a)||(a=[a]):a=null;var v=new Array;if(m.meshes!==void 0&&m.meshes!==null){var S=[],P=[],x,R;for(x=0,R=m.meshes.length;x<R;x++){var w=m.meshes[x];if(a===null||c(w,a,v)){if(a!==null&&delete a[a.indexOf(w.name)],w.geometryId!==void 0&&w.geometryId!==null&&m.geometries!==void 0&&m.geometries!==null){var I=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(te){I===!0||!m.geometries[te]||!Array.isArray(m.geometries[te])||m.geometries[te].forEach(function(re){if(re.id===w.geometryId){switch(te){case"boxes":t.BoxGeometry.Parse(re,n);break;case"spheres":t.SphereGeometry.Parse(re,n);break;case"cylinders":t.CylinderGeometry.Parse(re,n);break;case"toruses":t.TorusGeometry.Parse(re,n);break;case"grounds":t.GroundGeometry.Parse(re,n);break;case"planes":t.PlaneGeometry.Parse(re,n);break;case"torusKnots":t.TorusKnotGeometry.Parse(re,n);break;case"vertexData":t.Geometry.Parse(re,n,o);break}I=!0}})}),I===!1&&t.Tools.Warn("Geometry not found for mesh "+w.id)}if(w.materialId){var F=P.indexOf(w.materialId)!==-1;if(F===!1&&m.multiMaterials!==void 0&&m.multiMaterials!==null)for(var k=0,E=m.multiMaterials.length;k<E;k++){var g=m.multiMaterials[k];if(g.id===w.materialId){for(var y=0,M=g.materials.length;y<M;y++){var C=g.materials[y];P.push(C);var D=f(C,m,n,o);D&&(p+=`
	Material `+D.toString(_))}P.push(g.id);var V=t.Material.ParseMultiMaterial(g,n);V&&(F=!0,p+=`
	Multi-Material `+V.toString(_));break}}if(F===!1){P.push(w.materialId);var D=f(w.materialId,m,n,o);D?p+=`
	Material `+D.toString(_):t.Tools.Warn("Material not found for mesh "+w.id)}}if(w.skeletonId>-1&&m.skeletons!==void 0&&m.skeletons!==null){var G=S.indexOf(w.skeletonId)>-1;if(G===!1)for(var U=0,z=m.skeletons.length;U<z;U++){var H=m.skeletons[U];if(H.id===w.skeletonId){var W=t.Skeleton.Parse(H,n);h.push(W),S.push(H.id),p+=`
	Skeleton `+W.toString(_)}}}if(m.morphTargetManagers!==void 0&&m.morphTargetManagers!==null)for(var X=0,K=m.morphTargetManagers;X<K.length;X++){var j=K[X];t.MorphTargetManager.Parse(j,n)}var ee=t.Mesh.Parse(w,n,o);l.push(ee),p+=`
	Mesh `+ee.toString(_)}}var $;for(x=0,R=n.meshes.length;x<R;x++)$=n.meshes[x],$._waitingParentId&&($.parent=n.getLastEntryByID($._waitingParentId),$._waitingParentId=null);for(x=0,R=n.meshes.length;x<R;x++)$=n.meshes[x],$._waitingFreezeWorldMatrix?($.freezeWorldMatrix(),$._waitingFreezeWorldMatrix=null):$.computeWorldMatrix(!0)}if(m.particleSystems!==void 0&&m.particleSystems!==null){var L=t.AbstractScene.GetIndividualParser(t.SceneComponentConstants.NAME_PARTICLESYSTEM);if(L)for(x=0,R=m.particleSystems.length;x<R;x++){var Q=m.particleSystems[x];v.indexOf(Q.emitterId)!==-1&&u.push(L(Q,n,o))}}return!0}catch(te){var J=r("importMesh",m?m.producer:"Unknown")+p;if(d)d(J,te);else throw t.Tools.Log(J),te}finally{p!==null&&t.SceneLoader.loggingLevel!==t.SceneLoader.NO_LOGGING&&t.Tools.Log(r("importMesh",m?m.producer:"Unknown")+(t.SceneLoader.loggingLevel!==t.SceneLoader.MINIMAL_LOGGING?p:""))}return!1},load:function(a,n,s,o){var l="importScene has failed JSON parse";try{var u=JSON.parse(n);if(l="",u.useDelayedTextureLoading!==void 0&&u.useDelayedTextureLoading!==null&&(a.useDelayedTextureLoading=u.useDelayedTextureLoading&&!t.SceneLoader.ForceFullSceneLoadingForIncremental),u.autoClear!==void 0&&u.autoClear!==null&&(a.autoClear=u.autoClear),u.clearColor!==void 0&&u.clearColor!==null&&(a.clearColor=t.Color4.FromArray(u.clearColor)),u.ambientColor!==void 0&&u.ambientColor!==null&&(a.ambientColor=t.Color3.FromArray(u.ambientColor)),u.gravity!==void 0&&u.gravity!==null&&(a.gravity=t.Vector3.FromArray(u.gravity)),u.fogMode&&u.fogMode!==0)switch(a.fogMode=u.fogMode,a.fogColor=t.Color3.FromArray(u.fogColor),a.fogStart=u.fogStart,a.fogEnd=u.fogEnd,a.fogDensity=u.fogDensity,l+="	Fog mode for scene:  ",a.fogMode){case 1:l+=`exp
`;break;case 2:l+=`exp2
`;break;case 3:l+=`linear
`;break}if(u.physicsEnabled){var h;u.physicsEngine==="cannon"?h=new t.CannonJSPlugin:u.physicsEngine==="oimo"&&(h=new t.OimoJSPlugin),l="	Physics engine "+(u.physicsEngine?u.physicsEngine:"oimo")+` enabled
`;var d=u.physicsGravity?t.Vector3.FromArray(u.physicsGravity):null;a.enablePhysics(d,h)}u.metadata!==void 0&&u.metadata!==null&&(a.metadata=u.metadata),u.collisionsEnabled!==void 0&&u.collisionsEnabled!==null&&(a.collisionsEnabled=u.collisionsEnabled),a.workerCollisions=!!u.workerCollisions;var p=i(a,n,s,o,!0);if(!p)return!1;if(u.autoAnimate&&a.beginAnimation(a,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),u.activeCameraID!==void 0&&u.activeCameraID!==null&&a.setActiveCameraByID(u.activeCameraID),u.environmentTexture!==void 0&&u.environmentTexture!==null){if(u.environmentTextureType&&u.environmentTextureType==="BABYLON.HDRCubeTexture"){var m=u.environmentTextureSize?u.environmentTextureSize:128,_=new t.HDRCubeTexture(s+u.environmentTexture,a,m);u.environmentTextureRotationY&&(_.rotationY=u.environmentTextureRotationY),a.environmentTexture=_}else{var v=t.CubeTexture.CreateFromPrefilteredData(s+u.environmentTexture,a);u.environmentTextureRotationY&&(v.rotationY=u.environmentTextureRotationY),a.environmentTexture=v}if(u.createDefaultSkybox===!0){var S=a.activeCamera!==void 0&&a.activeCamera!==null?(a.activeCamera.maxZ-a.activeCamera.minZ)/2:1e3,P=u.skyboxBlurLevel||0;a.createDefaultSkybox(void 0,!0,S,P)}}return!0}catch(R){var x=r("importScene",u?u.producer:"Unknown")+l;if(o)o(x,R);else throw t.Tools.Log(x),R}finally{l!==null&&t.SceneLoader.loggingLevel!==t.SceneLoader.NO_LOGGING&&t.Tools.Log(r("importScene",u?u.producer:"Unknown")+(t.SceneLoader.loggingLevel!==t.SceneLoader.MINIMAL_LOGGING?l:""))}return!1},loadAssetContainer:function(a,n,s,o){var l=i(a,n,s,o);return l}})})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o,l,u,h){this.onProcessFileCallback=function(){return!0},this._engine=r,this._currentScene=i,this._sceneLoadedCallback=a,this._progressCallback=n,this._additionalRenderLoopLogicCallback=s,this._textureLoadingCallback=o,this._startingProcessingFilesCallback=l,this._onReloadCallback=u,this._errorCallback=h}return c.prototype.monitorElementForDragNDrop=function(r){var i=this;r&&(this._elementToMonitor=r,this._dragEnterHandler=function(a){i.drag(a)},this._dragOverHandler=function(a){i.drag(a)},this._dropHandler=function(a){i.drop(a)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},c.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},c.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var r=this._currentScene.getWaitingItemsCount();r>0&&this._textureLoadingCallback(r)}this._currentScene.render()}},c.prototype.drag=function(r){r.stopPropagation(),r.preventDefault()},c.prototype.drop=function(r){r.stopPropagation(),r.preventDefault(),this.loadFiles(r)},c.prototype._traverseFolder=function(r,i,a,n){var s=this,o=r.createReader(),l=r.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");o.readEntries(function(u){a.count+=u.length;for(var h=0,d=u;h<d.length;h++){var p=d[h];p.isFile?p.file(function(m){m.correctName=l+m.name,i.push(m),--a.count===0&&n()}):p.isDirectory&&s._traverseFolder(p,i,a,n)}--a.count&&n()})},c.prototype._processFiles=function(r){for(var i=0;i<r.length;i++){var a=r[i].correctName.toLowerCase(),n=a.split(".").pop();this.onProcessFileCallback(r[i],a,n)&&((n==="babylon"||n==="stl"||n==="obj"||n==="gltf"||n==="glb")&&a.indexOf(".binary.babylon")===-1&&a.indexOf(".incremental.babylon")===-1&&(this._sceneFileToLoad=r[i]),c.FilesToLoad[a]=r[i])}},c.prototype.loadFiles=function(r){var i=this;if(r&&r.dataTransfer&&r.dataTransfer.files&&(this._filesToLoad=r.dataTransfer.files),r&&r.target&&r.target.files&&(this._filesToLoad=r.target.files),!(!this._filesToLoad||this._filesToLoad.length===0)&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var a=new Array,n=[],s=r.dataTransfer?r.dataTransfer.items:null,o=0;o<this._filesToLoad.length;o++){var l=this._filesToLoad[o],u=l.name.toLowerCase(),h=void 0;if(l.correctName=u,s){var d=s[o];d.getAsEntry?h=d.getAsEntry():d.webkitGetAsEntry&&(h=d.webkitGetAsEntry())}h&&h.isDirectory?n.push(h):a.push(l)}if(n.length===0)this._processFiles(a),this._processReload();else for(var p={count:n.length},m=0,_=n;m<_.length;m++){var v=_[m];this._traverseFolder(v,a,p,function(){i._processFiles(a),p.count===0&&i._processReload()})}}},c.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},c.prototype.reload=function(){var r=this;this._sceneFileToLoad?(this._currentScene&&(t.Tools.errorsCount>0&&t.Tools.ClearLogCache(),this._engine.stopRenderLoop()),t.SceneLoader.LoadAsync("file:",this._sceneFileToLoad.name,this._engine,function(i){r._progressCallback&&r._progressCallback(i)}).then(function(i){r._currentScene&&r._currentScene.dispose(),r._currentScene=i,r._sceneLoadedCallback&&r._sceneLoadedCallback(r._sceneFileToLoad,r._currentScene),r._currentScene.executeWhenReady(function(){r._engine.runRenderLoop(function(){r.renderFunction()})})}).catch(function(i){r._errorCallback&&r._errorCallback(r._sceneFileToLoad,r._currentScene,i.message)})):t.Tools.Error("Please provide a valid .babylon file.")},c.FilesToLoad={},c}();t.FilesInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.EnableFor=function(r){r._tags=r._tags||{},r.hasTags=function(){return c.HasTags(r)},r.addTags=function(i){return c.AddTagsTo(r,i)},r.removeTags=function(i){return c.RemoveTagsFrom(r,i)},r.matchesTagsQuery=function(i){return c.MatchesQuery(r,i)}},c.DisableFor=function(r){delete r._tags,delete r.hasTags,delete r.addTags,delete r.removeTags,delete r.matchesTagsQuery},c.HasTags=function(r){return r._tags?!t.Tools.IsEmpty(r._tags):!1},c.GetTags=function(r,i){if(i===void 0&&(i=!0),!r._tags)return null;if(i){var a=[];for(var n in r._tags)r._tags.hasOwnProperty(n)&&r._tags[n]===!0&&a.push(n);return a.join(" ")}else return r._tags},c.AddTagsTo=function(r,i){if(i&&typeof i=="string"){var a=i.split(" ");a.forEach(function(n,s,o){c._AddTagTo(r,n)})}},c._AddTagTo=function(r,i){i=i.trim(),!(i===""||i==="true"||i==="false")&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(c.EnableFor(r),r._tags[i]=!0))},c.RemoveTagsFrom=function(r,i){if(c.HasTags(r)){var a=i.split(" ");for(var n in a)c._RemoveTagFrom(r,a[n])}},c._RemoveTagFrom=function(r,i){delete r._tags[i]},c.MatchesQuery=function(r,i){return i===void 0?!0:i===""?c.HasTags(r):t.AndOrNotEvaluator.Eval(i,function(a){return c.HasTags(r)&&r._tags[a]})},c}();t.Tags=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.Eval=function(r,i){return r.match(/\([^\(\)]*\)/g)?r=r.replace(/\([^\(\)]*\)/g,function(a){return a=a.slice(1,a.length-1),c._HandleParenthesisContent(a,i)}):r=c._HandleParenthesisContent(r,i),r==="true"?!0:r==="false"?!1:c.Eval(r,i)},c._HandleParenthesisContent=function(r,i){i=i||function(d){return d==="true"};var a,n=r.split("||");for(var s in n)if(n.hasOwnProperty(s)){var o=c._SimplifyNegation(n[s].trim()),l=o.split("&&");if(l.length>1)for(var u=0;u<l.length;++u){var h=c._SimplifyNegation(l[u].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?a=!i(h.substring(1)):a=i(h):a=h==="true",!a){o="false";break}}if(a||o==="true"){a=!0;break}o!=="true"&&o!=="false"?o[0]==="!"?a=!i(o.substring(1)):a=i(o):a=o==="true"}return a?"true":"false"},c._SimplifyNegation=function(r){return r=r.replace(/^[\s!]+/,function(i){return i=i.replace(/[\s]/g,function(){return""}),i.length%2?"!":""}),r=r.trim(),r==="!true"?r="false":r==="!false"&&(r="true"),r},c}();t.AndOrNotEvaluator=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){a===void 0&&(a=!1);var n=this;this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=c._ReturnFullUrlLocation(r),this.db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,c.IDBStorageEnabled?a?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this.manifestVersionFound=1,t.Tools.SetImmediate(function(){n.callbackManifestChecked(!0)})):this._checkManifestFile():this.callbackManifestChecked(!0)}return Object.defineProperty(c.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),c.prototype._checkManifestFile=function(){var r=this,i=function(){r._enableSceneOffline=!1,r._enableTexturesOffline=!1,r.callbackManifestChecked(!1)},a=!1,n=this.currentSceneUrl+".manifest",s=new XMLHttpRequest;navigator.onLine&&(a=!0,n=n+(n.match(/\?/)==null?"?":"&")+Date.now()),s.open("GET",n,!0),s.addEventListener("load",function(){if(s.status===200||t.Tools.ValidateXHRData(s,1))try{var o=JSON.parse(s.response);r._enableSceneOffline=o.enableSceneOffline,r._enableTexturesOffline=o.enableTexturesOffline,o.version&&!isNaN(parseInt(o.version))&&(r.manifestVersionFound=o.version),r.callbackManifestChecked&&r.callbackManifestChecked(!0)}catch{i()}else i()},!1),s.addEventListener("error",function(o){if(a){a=!1;var l=r.currentSceneUrl+".manifest";s.open("GET",l,!0),s.send()}else i()},!1);try{s.send()}catch{t.Tools.Error("Error on XHR send request."),this.callbackManifestChecked(!1)}},c.prototype.openAsync=function(r,i){var a=this,n=function(){a.isSupported=!1,i&&i()};if(!this.idbFactory||!(this._enableSceneOffline||this._enableTexturesOffline))this.isSupported=!1,i&&i();else if(this.db)r&&r();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open("babylonjs",1);s.onerror=function(o){n()},s.onblocked=function(o){t.Tools.Error("IDB request blocked. Please reload the page."),n()},s.onsuccess=function(o){a.db=s.result,r()},s.onupgradeneeded=function(o){if(a.db=o.target.result,a.db)try{a.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),a.db.createObjectStore("versions",{keyPath:"sceneUrl"}),a.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(l){t.Tools.Error("Error while creating object stores. Exception: "+l.message),n()}}}},c.prototype.loadImageFromDB=function(r,i){var a=this,n=c._ReturnFullUrlLocation(r),s=function(){!a.hasReachedQuota&&a.db!==null?a._saveImageIntoDBAsync(n,i):i.src=r};this.mustUpdateRessources?s():this._loadImageFromDBAsync(n,i,s)},c.prototype._loadImageFromDBAsync=function(r,i,a){if(this.isSupported&&this.db!==null){var n,s=this.db.transaction(["textures"]);s.onabort=function(l){i.src=r},s.oncomplete=function(l){var u;if(n){var h=window.URL||window.webkitURL;u=h.createObjectURL(n.data),i.onerror=function(){t.Tools.Error("Error loading image from blob URL: "+u+" switching back to web url: "+r),i.src=r},i.src=u}else a()};var o=s.objectStore("textures").get(r);o.onsuccess=function(l){n=l.target.result},o.onerror=function(l){t.Tools.Error("Error loading texture "+r+" from DB."),i.src=r}}else t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=r},c.prototype._saveImageIntoDBAsync=function(r,i){var a=this;if(this.isSupported){var n=function(){var l;if(o){var u=window.URL||window.webkitURL;try{l=u.createObjectURL(o)}catch{l=u.createObjectURL(o)}}l&&(i.src=l)};if(c.IsUASupportingBlobStorage){var s=new XMLHttpRequest,o;s.open("GET",r,!0),s.responseType="blob",s.addEventListener("load",function(){if(s.status===200&&a.db){o=s.response;var l=a.db.transaction(["textures"],"readwrite");l.onabort=function(d){try{var p=d.srcElement||d.target,m=p.error;m&&m.name==="QuotaExceededError"&&(a.hasReachedQuota=!0)}catch{}n()},l.oncomplete=function(d){n()};var u={textureUrl:r,data:o};try{var h=l.objectStore("textures").put(u);h.onsuccess=function(d){},h.onerror=function(d){n()}}catch(d){d.code===25&&(c.IsUASupportingBlobStorage=!1),i.src=r}}else i.src=r},!1),s.addEventListener("error",function(l){t.Tools.Error("Error in XHR request in BABYLON.Database."),i.src=r},!1),s.send()}else i.src=r}else t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=r},c.prototype._checkVersionFromDB=function(r,i){var a=this,n=function(){a._saveVersionIntoDBAsync(r,i)};this._loadVersionFromDBAsync(r,i,n)},c.prototype._loadVersionFromDBAsync=function(r,i,a){var n=this;if(this.isSupported&&this.db){var s;try{var o=this.db.transaction(["versions"]);o.oncomplete=function(u){s?n.manifestVersionFound!==s.data?(n.mustUpdateRessources=!0,a()):i(s.data):(n.mustUpdateRessources=!0,a())},o.onabort=function(u){i(-1)};var l=o.objectStore("versions").get(r);l.onsuccess=function(u){s=u.target.result},l.onerror=function(u){t.Tools.Error("Error loading version for scene "+r+" from DB."),i(-1)}}catch(u){t.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+u.message),i(-1)}}else t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},c.prototype._saveVersionIntoDBAsync=function(r,i){var a=this;if(this.isSupported&&!this.hasReachedQuota&&this.db)try{var n=this.db.transaction(["versions"],"readwrite");n.onabort=function(l){try{var u=l.srcElement.error;u&&u.name==="QuotaExceededError"&&(a.hasReachedQuota=!0)}catch{}i(-1)},n.oncomplete=function(l){i(a.manifestVersionFound)};var s={sceneUrl:r,data:this.manifestVersionFound},o=n.objectStore("versions").put(s);o.onsuccess=function(l){},o.onerror=function(l){t.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(l){t.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+l.message),i(-1)}else i(-1)},c.prototype.loadFileFromDB=function(r,i,a,n,s){var o=this,l=c._ReturnFullUrlLocation(r),u=function(){o._saveFileIntoDBAsync(l,i,a,s,n)};this._checkVersionFromDB(l,function(h){h!==-1?o.mustUpdateRessources?o._saveFileIntoDBAsync(l,i,a,s,n):o._loadFileFromDBAsync(l,i,u,s):n&&n()})},c.prototype._loadFileFromDBAsync=function(r,i,a,n){if(this.isSupported&&this.db){var s;r.indexOf(".babylon")!==-1?s="scenes":s="textures";var o,l=this.db.transaction([s]);l.oncomplete=function(h){o?i(o.data):a()},l.onabort=function(h){a()};var u=l.objectStore(s).get(r);u.onsuccess=function(h){o=h.target.result},u.onerror=function(h){t.Tools.Error("Error loading file "+r+" from DB."),a()}}else t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},c.prototype._saveFileIntoDBAsync=function(r,i,a,n,s){var o=this;if(this.isSupported){var l;r.indexOf(".babylon")!==-1?l="scenes":l="textures";var u=new XMLHttpRequest,h;u.open("GET",r+"?"+Date.now(),!0),n&&(u.responseType="arraybuffer"),a&&(u.onprogress=a),u.addEventListener("load",function(){if(u.status===200||u.status<400&&t.Tools.ValidateXHRData(u,n?6:1))if(h=n?u.response:u.responseText,!o.hasReachedQuota&&o.db){var d=o.db.transaction([l],"readwrite");d.onabort=function(_){try{var v=_.srcElement.error;v&&v.name==="QuotaExceededError"&&(o.hasReachedQuota=!0)}catch{}i(h)},d.oncomplete=function(_){i(h)};var p;l==="scenes"?p={sceneUrl:r,data:h,version:o.manifestVersionFound}:p={textureUrl:r,data:h};try{var m=d.objectStore(l).put(p);m.onsuccess=function(_){},m.onerror=function(_){t.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch{i(h)}}else i(h);else u.status>=400&&s?s(u):i()},!1),u.addEventListener("error",function(d){t.Tools.Error("error on XHR request."),i()},!1),u.send()}else t.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},c.IsUASupportingBlobStorage=!0,c.IDBStorageEnabled=!0,c._ParseURL=function(r){var i=document.createElement("a");i.href=r;var a=r.substring(0,r.lastIndexOf("#")),n=r.substring(a.lastIndexOf("/")+1,r.length),s=r.substring(0,r.indexOf(n,0));return s},c._ReturnFullUrlLocation=function(r){return r.indexOf("http:/")===-1&&r.indexOf("https:/")===-1?c._ParseURL(window.location.href)+r:r},c}();t.Database=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._isEnabled=!0,this.leftColor=t.Color3.White(),this.rightColor=t.Color3.Black(),this.bias=0,this.power=1}return Object.defineProperty(c.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(r){this._isEnabled!==r&&(this._isEnabled=r,t.Engine.MarkAllMaterialsAsDirty(t.Material.FresnelDirtyFlag|t.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),c.prototype.clone=function(){var r=new c;return t.Tools.DeepCopy(this,r),r},c.prototype.serialize=function(){var r={};return r.isEnabled=this.isEnabled,r.leftColor=this.leftColor.asArray(),r.rightColor=this.rightColor.asArray(),r.bias=this.bias,r.power=this.power,r},c.Parse=function(r){var i=new c;return i.isEnabled=r.isEnabled,i.leftColor=t.Color3.FromArray(r.leftColor),i.rightColor=t.Color3.FromArray(r.rightColor),i.bias=r.bias,i.power=r.power||1,i},c}();t.FresnelParameters=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,i,a,!0)||this;return a.multiMaterials.push(n),n.subMaterials=new Array,n.storeEffectOnSubMeshes=!0,n}return Object.defineProperty(r.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(i){this._subMaterials=i,this._hookArray(i)},enumerable:!0,configurable:!0}),r.prototype._hookArray=function(i){var a=this,n=i.push;i.push=function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];var u=n.apply(i,o);return a._markAllSubMeshesAsTexturesDirty(),u};var s=i.splice;i.splice=function(o,l){var u=s.apply(i,[o,l]);return a._markAllSubMeshesAsTexturesDirty(),u}},r.prototype.getSubMaterial=function(i){return i<0||i>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[i]},r.prototype.getActiveTextures=function(){var i;return(i=c.prototype.getActiveTextures.call(this)).concat.apply(i,this.subMaterials.map(function(a){return a?a.getActiveTextures():[]}))},r.prototype.getClassName=function(){return"MultiMaterial"},r.prototype.isReadyForSubMesh=function(i,a,n){for(var s=0;s<this.subMaterials.length;s++){var o=this.subMaterials[s];if(o){if(o.storeEffectOnSubMeshes){if(!o.isReadyForSubMesh(i,a,n))return!1;continue}if(!o.isReady(i))return!1}}return!0},r.prototype.clone=function(i,a){for(var n=new r(i,this.getScene()),s=0;s<this.subMaterials.length;s++){var o=null,l=this.subMaterials[s];a&&l?o=l.clone(i+"-"+l.name):o=this.subMaterials[s],n.subMaterials.push(o)}return n},r.prototype.serialize=function(){var i={};i.name=this.name,i.id=this.id,t.Tags&&(i.tags=t.Tags.GetTags(this)),i.materials=[];for(var a=0;a<this.subMaterials.length;a++){var n=this.subMaterials[a];n?i.materials.push(n.id):i.materials.push(null)}return i},r.prototype.dispose=function(i,a){var n=this.getScene();if(n){var s=n.multiMaterials.indexOf(this);s>=0&&n.multiMaterials.splice(s,1),c.prototype.dispose.call(this,i,a)}},r}(t.Material);t.MultiMaterial=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return c.prototype.attachControl=function(r,i){var a=this,n=null;this._pointerInput===void 0&&(this._onLostFocus=function(s){a._offsetX=null,a._offsetY=null},this._pointerInput=function(s,o){var l=s.event;if(l.pointerType!=="mouse"){if(s.type===t.PointerEventTypes.POINTERDOWN){if(i||l.preventDefault(),a._pointerPressed.push(l.pointerId),a._pointerPressed.length!==1)return;n={x:l.clientX,y:l.clientY}}else if(s.type===t.PointerEventTypes.POINTERUP){i||l.preventDefault();var u=a._pointerPressed.indexOf(l.pointerId);if(u===-1||(a._pointerPressed.splice(u,1),u!=0))return;n=null,a._offsetX=null,a._offsetY=null}else if(s.type===t.PointerEventTypes.POINTERMOVE){if(i||l.preventDefault(),!n)return;var u=a._pointerPressed.indexOf(l.pointerId);if(u!=0)return;a._offsetX=l.clientX-n.x,a._offsetY=-(l.clientY-n.y)}}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,t.PointerEventTypes.POINTERDOWN|t.PointerEventTypes.POINTERUP|t.PointerEventTypes.POINTERMOVE),this._onLostFocus&&r.addEventListener("blur",this._onLostFocus)},c.prototype.detachControl=function(r){this._pointerInput&&r&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(r.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},c.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var r=this.camera;if(r.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)r.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var i=r._computeLocalCameraSpeed(),a=new t.Vector3(0,0,i*this._offsetY/this.touchMoveSensibility);t.Matrix.RotationYawPitchRollToRef(r.rotation.y,r.rotation.x,0,r._cameraRotationMatrix),r.cameraDirection.addInPlace(t.Vector3.TransformCoordinates(a,r._cameraRotationMatrix))}}},c.prototype.getClassName=function(){return"FreeCameraTouchInput"},c.prototype.getSimpleName=function(){return"touch"},A([t.serialize()],c.prototype,"touchAngularSensibility",void 0),A([t.serialize()],c.prototype,"touchMoveSensibility",void 0),c}();t.FreeCameraTouchInput=f,t.CameraInputTypes.FreeCameraTouchInput=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("TouchCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,a,n)||this;return s.inputs.addTouch(),s._setupInputs(),s}return Object.defineProperty(r.prototype,"touchAngularSensibility",{get:function(){var i=this.inputs.attached.touch;return i?i.touchAngularSensibility:0},set:function(i){var a=this.inputs.attached.touch;a&&(a.touchAngularSensibility=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"touchMoveSensibility",{get:function(){var i=this.inputs.attached.touch;return i?i.touchMoveSensibility:0},set:function(i){var a=this.inputs.attached.touch;a&&(a.touchMoveSensibility=i)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"TouchCamera"},r.prototype._setupInputs=function(){var i=this.inputs.attached.mouse;i&&(i.touchEnabled=!1)},r}(t.FreeCamera);t.TouchCamera=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){o===void 0&&(o=null),l===void 0&&(l=!0),u===void 0&&(u=!1);var h=c.call(this,null,s,!l)||this;h.isCube=u,h.isEnabled=!0,h.autoClear=!0,h.onGeneratedObservable=new t.Observable,h._textures={},h._currentRefreshId=-1,h._refreshRate=1,h._vertexBuffers={},h._uniforms=new Array,h._samplers=new Array,h._floats={},h._ints={},h._floatsArrays={},h._colors3={},h._colors4={},h._vectors2={},h._vectors3={},h._matrices={},h._fallbackTextureUsed=!1,h._cachedDefines="",h._contentUpdateId=-1,s=h.getScene();var d=s._getComponent(t.SceneComponentConstants.NAME_PROCEDURALTEXTURE);d||(d=new t.ProceduralTextureSceneComponent(s),s._addComponent(d)),s.proceduralTextures.push(h),h._engine=s.getEngine(),h.name=i,h.isRenderTarget=!0,h._size=a,h._generateMipMaps=l,h.setFragment(n),h._fallbackTexture=o,u?(h._texture=h._engine.createRenderTargetCubeTexture(a,{generateMipMaps:l,generateDepthBuffer:!1,generateStencilBuffer:!1}),h.setFloat("face",0)):h._texture=h._engine.createRenderTargetTexture(a,{generateMipMaps:l,generateDepthBuffer:!1,generateStencilBuffer:!1});var p=[];return p.push(1,1),p.push(-1,1),p.push(-1,-1),p.push(1,-1),h._vertexBuffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(h._engine,p,t.VertexBuffer.PositionKind,!1,!1,2),h._createIndexBuffer(),h}return r.prototype.getContent=function(){return this._contentData&&this._currentRefreshId==this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._currentRefreshId,this._contentData)},r.prototype._createIndexBuffer=function(){var i=this._engine,a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=i.createIndexBuffer(a)},r.prototype._rebuild=function(){var i=this._vertexBuffers[t.VertexBuffer.PositionKind];i&&i._rebuild(),this._createIndexBuffer(),this.refreshRate===t.RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)},r.prototype.reset=function(){if(this._effect!==void 0){var i=this._engine;i._releaseEffect(this._effect)}},r.prototype._getDefines=function(){return""},r.prototype.isReady=function(){var i=this,a=this._engine,n;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var s=this._getDefines();return this._effect&&s===this._cachedDefines&&this._effect.isReady()?!0:(this._fragment.fragmentElement!==void 0?n={vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:n={vertex:"procedural",fragment:this._fragment},this._cachedDefines=s,this._effect=a.createEffect(n,[t.VertexBuffer.PositionKind],this._uniforms,this._samplers,s,void 0,void 0,function(){i.releaseInternalTexture(),i._fallbackTexture&&(i._texture=i._fallbackTexture._texture,i._texture&&i._texture.incrementReferences()),i._fallbackTextureUsed=!0}),this._effect.isReady())},r.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},r.prototype.setFragment=function(i){this._fragment=i},Object.defineProperty(r.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(i){this._refreshRate=i,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),r.prototype._shouldRender=function(){return!this.isEnabled||!this.isReady()||!this._texture?(this._texture&&(this._texture.isReady=!1),!1):this._fallbackTextureUsed?!1:this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},r.prototype.getRenderSize=function(){return this._size},r.prototype.resize=function(i,a){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(i,a),this._size=i,this._generateMipMaps=a)},r.prototype._checkUniform=function(i){this._uniforms.indexOf(i)===-1&&this._uniforms.push(i)},r.prototype.setTexture=function(i,a){return this._samplers.indexOf(i)===-1&&this._samplers.push(i),this._textures[i]=a,this},r.prototype.setFloat=function(i,a){return this._checkUniform(i),this._floats[i]=a,this},r.prototype.setInt=function(i,a){return this._checkUniform(i),this._ints[i]=a,this},r.prototype.setFloats=function(i,a){return this._checkUniform(i),this._floatsArrays[i]=a,this},r.prototype.setColor3=function(i,a){return this._checkUniform(i),this._colors3[i]=a,this},r.prototype.setColor4=function(i,a){return this._checkUniform(i),this._colors4[i]=a,this},r.prototype.setVector2=function(i,a){return this._checkUniform(i),this._vectors2[i]=a,this},r.prototype.setVector3=function(i,a){return this._checkUniform(i),this._vectors3[i]=a,this},r.prototype.setMatrix=function(i,a){return this._checkUniform(i),this._matrices[i]=a,this},r.prototype.render=function(i){var a=this.getScene();if(a){var n=this._engine;n.enableEffect(this._effect),n.setState(!1);for(var s in this._textures)this._effect.setTexture(s,this._textures[s]);for(s in this._ints)this._effect.setInt(s,this._ints[s]);for(s in this._floats)this._effect.setFloat(s,this._floats[s]);for(s in this._floatsArrays)this._effect.setArray(s,this._floatsArrays[s]);for(s in this._colors3)this._effect.setColor3(s,this._colors3[s]);for(s in this._colors4){var o=this._colors4[s];this._effect.setFloat4(s,o.r,o.g,o.b,o.a)}for(s in this._vectors2)this._effect.setVector2(s,this._vectors2[s]);for(s in this._vectors3)this._effect.setVector3(s,this._vectors3[s]);for(s in this._matrices)this._effect.setMatrix(s,this._matrices[s]);if(this._texture){if(this.isCube)for(var l=0;l<6;l++)n.bindFramebuffer(this._texture,l,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",l),this.autoClear&&n.clear(a.clearColor,!0,!1,!1),n.drawElementsType(t.Material.TriangleFillMode,0,6),l===5&&n.generateMipMapsForCubemap(this._texture);else n.bindFramebuffer(this._texture,0,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&n.clear(a.clearColor,!0,!1,!1),n.drawElementsType(t.Material.TriangleFillMode,0,6);n.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},r.prototype.clone=function(){var i=this.getSize(),a=new r(this.name,i.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return a.hasAlpha=this.hasAlpha,a.level=this.level,a.coordinatesMode=this.coordinatesMode,a},r.prototype.dispose=function(){var i=this.getScene();if(i){var a=i.proceduralTextures.indexOf(this);a>=0&&i.proceduralTextures.splice(a,1);var n=this._vertexBuffers[t.VertexBuffer.PositionKind];n&&(n.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),c.prototype.dispose.call(this)}},A([t.serialize()],r.prototype,"isEnabled",void 0),A([t.serialize()],r.prototype,"autoClear",void 0),A([t.serialize()],r.prototype,"_generateMipMaps",void 0),A([t.serialize()],r.prototype,"_size",void 0),A([t.serialize()],r.prototype,"refreshRate",null),r}(t.Texture);t.ProceduralTexture=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_PROCEDURALTEXTURE,this.scene=r,this.scene.proceduralTextures=new Array,r.layers=new Array}return c.prototype.register=function(){this.scene._beforeClearStage.registerStep(t.SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){},c.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){t.Tools.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var r=0;r<this.scene.proceduralTextures.length;r++){var i=this.scene.proceduralTextures[r];i._shouldRender()&&i.render()}t.Tools.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},c}();t.ProceduralTextureSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){var u=c.call(this,i,n,null,s,o,l)||this;return u._animate=!0,u._time=0,u._texturePath=a,u._loadJson(a),u.refreshRate=1,u}return r.prototype._loadJson=function(i){var a=this,n=function(){t.Tools.Log("No config file found in "+i+" trying to use ShadersStore or DOM element");try{a.setFragment(a._texturePath)}catch{t.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},s=i+"/config.json",o=new XMLHttpRequest;o.open("GET",s,!0),o.addEventListener("load",function(){if(o.status===200||t.Tools.ValidateXHRData(o,1))try{a._config=JSON.parse(o.response),a.updateShaderUniforms(),a.updateTextures(),a.setFragment(a._texturePath+"/custom"),a._animate=a._config.animate,a.refreshRate=a._config.refreshrate}catch{n()}else n()},!1),o.addEventListener("error",function(){n()},!1);try{o.send()}catch{t.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},r.prototype.isReady=function(){if(!c.prototype.isReady.call(this))return!1;for(var i in this._textures){var a=this._textures[i];if(!a.isReady())return!1}return!0},r.prototype.render=function(i){var a=this.getScene();this._animate&&a&&(this._time+=a.getAnimationRatio()*.03,this.updateShaderUniforms()),c.prototype.render.call(this,i)},r.prototype.updateTextures=function(){for(var i=0;i<this._config.sampler2Ds.length;i++)this.setTexture(this._config.sampler2Ds[i].sample2Dname,new t.Texture(this._texturePath+"/"+this._config.sampler2Ds[i].textureRelativeUrl,this.getScene()))},r.prototype.updateShaderUniforms=function(){if(this._config)for(var i=0;i<this._config.uniforms.length;i++){var a=this._config.uniforms[i];switch(a.type){case"float":this.setFloat(a.name,a.value);break;case"color3":this.setColor3(a.name,new t.Color3(a.r,a.g,a.b));break;case"color4":this.setColor4(a.name,new t.Color4(a.r,a.g,a.b,a.a));break;case"vector2":this.setVector2(a.name,new t.Vector2(a.x,a.y));break;case"vector3":this.setVector3(a.name,new t.Vector3(a.x,a.y,a.z));break}}this.setFloat("time",this._time)},Object.defineProperty(r.prototype,"animate",{get:function(){return this._animate},set:function(i){this._animate=i},enumerable:!0,configurable:!0}),r}(t.ProceduralTexture);t.CustomProceduralTexture=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=t.Matrix.Identity(),this._deltaTransform=t.Vector3.Zero(),this._vector3=t.Vector3.Zero(),this._vector2=t.Vector2.Zero()}return c.prototype.attachControl=function(r,i){var a=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(s){s.type!==t.Gamepad.POSE_ENABLED&&(!a.gamepad||s.type===t.Gamepad.XBOX)&&(a.gamepad=s)}),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(s){a.gamepad===s&&(a.gamepad=null)}),this.gamepad=n.getGamepadByType(t.Gamepad.XBOX)},c.prototype.detachControl=function(r){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},c.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var r=this.camera,i=this.gamepad.leftStick,a=i.x/this.gamepadMoveSensibility,n=i.y/this.gamepadMoveSensibility;i.x=Math.abs(a)>.005?0+a:0,i.y=Math.abs(n)>.005?0+n:0;var s=this.gamepad.rightStick;if(s){var o=s.x/this.gamepadAngularSensibility,l=s.y/this.gamepadAngularSensibility;s.x=Math.abs(o)>.001?0+o:0,s.y=Math.abs(l)>.001?0+l:0}else s={x:0,y:0};r.rotationQuaternion?r.rotationQuaternion.toRotationMatrix(this._cameraTransform):t.Matrix.RotationYawPitchRollToRef(r.rotation.y,r.rotation.x,0,this._cameraTransform);var u=r._computeLocalCameraSpeed()*50;this._vector3.copyFromFloats(i.x*u,0,-i.y*u),t.Vector3.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),r.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(s.y,s.x),r.cameraRotation.addInPlace(this._vector2)}},c.prototype.getClassName=function(){return"FreeCameraGamepadInput"},c.prototype.getSimpleName=function(){return"gamepad"},A([t.serialize()],c.prototype,"gamepadAngularSensibility",void 0),A([t.serialize()],c.prototype,"gamepadMoveSensibility",void 0),c}();t.FreeCameraGamepadInput=f,t.CameraInputTypes.FreeCameraGamepadInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return c.prototype.attachControl=function(r,i){var a=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(s){s.type!==t.Gamepad.POSE_ENABLED&&(!a.gamepad||s.type===t.Gamepad.XBOX)&&(a.gamepad=s)}),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(s){a.gamepad===s&&(a.gamepad=null)}),this.gamepad=n.getGamepadByType(t.Gamepad.XBOX)},c.prototype.detachControl=function(r){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},c.prototype.checkInputs=function(){if(this.gamepad){var r=this.camera,i=this.gamepad.rightStick;if(i){if(i.x!=0){var a=i.x/this.gamepadRotationSensibility;a!=0&&Math.abs(a)>.005&&(r.inertialAlphaOffset+=a)}if(i.y!=0){var n=i.y/this.gamepadRotationSensibility;n!=0&&Math.abs(n)>.005&&(r.inertialBetaOffset+=n)}}var s=this.gamepad.leftStick;if(s&&s.y!=0){var o=s.y/this.gamepadMoveSensibility;o!=0&&Math.abs(o)>.005&&(this.camera.inertialRadiusOffset-=o)}}},c.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},c.prototype.getSimpleName=function(){return"gamepad"},A([t.serialize()],c.prototype,"gamepadRotationSensibility",void 0),A([t.serialize()],c.prototype,"gamepadMoveSensibility",void 0),c}();t.ArcRotateCameraGamepadInput=f,t.CameraInputTypes.ArcRotateCameraGamepadInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){var i=this;this._scene=r,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new t.Observable,t.Tools.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new t.Observable(function(a){for(var n in i._babylonGamepads){var s=i._babylonGamepads[n];s&&s._isConnected&&i.onGamepadConnectedObservable.notifyObserver(a,s)}}),this._onGamepadConnectedEvent=function(a){var n=a.gamepad;if(!(n.index in i._babylonGamepads&&i._babylonGamepads[n.index].isConnected)){var s;i._babylonGamepads[n.index]?(s=i._babylonGamepads[n.index],s.browserGamepad=n,s._isConnected=!0):s=i._addNewGamepad(n),i.onGamepadConnectedObservable.notifyObservers(s),i._startMonitoringGamepads()}},this._onGamepadDisconnectedEvent=function(a){var n=a.gamepad;for(var s in i._babylonGamepads)if(i._babylonGamepads[s].index===n.index){var o=i._babylonGamepads[s];o._isConnected=!1,i.onGamepadDisconnectedObservable.notifyObservers(o);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(c.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),c.prototype.getGamepadByType=function(r){r===void 0&&(r=t.Gamepad.XBOX);for(var i=0,a=this._babylonGamepads;i<a.length;i++){var n=a[i];if(n&&n.type===r)return n}return null},c.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(r){r.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},c.prototype._addNewGamepad=function(r){this._oneGamepadConnected||(this._oneGamepadConnected=!0);var i,a=r.id.search("Xbox One")!==-1;return a||r.id.search("Xbox 360")!==-1||r.id.search("xinput")!==-1?i=new t.Xbox360Pad(r.id,r.index,r,a):r.pose?i=t.PoseEnabledControllerHelper.InitiateController(r):i=new t.GenericPad(r.id,r.index,r),this._babylonGamepads[i.index]=i,i},c.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},c.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},c.prototype._checkGamepadsStatus=function(){var r=this;this._updateGamepadObjects();for(var i in this._babylonGamepads){var a=this._babylonGamepads[i];!a||!a.isConnected||a.update()}this._isMonitoring&&!this._scene&&t.Tools.QueueNewFrame(function(){r._checkGamepadsStatus()})},c.prototype._updateGamepadObjects=function(){for(var r=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],i=0;i<r.length;i++){var a=r[i];if(a)if(this._babylonGamepads[a.index])this._babylonGamepads[i].browserGamepad=a,this._babylonGamepads[i].isConnected||(this._babylonGamepads[i]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[i]));else{var n=this._addNewGamepad(a);this.onGamepadConnectedObservable.notifyObservers(n)}}},c}();t.GamepadManager=f})(T||(T={}));var T;(function(t){var f=function(){function i(a,n){this.x=a,this.y=n}return i}();t.StickValues=f;var c=function(){function i(a,n,s,o,l,u,h){o===void 0&&(o=0),l===void 0&&(l=1),u===void 0&&(u=2),h===void 0&&(h=3),this.id=a,this.index=n,this.browserGamepad=s,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=i.GAMEPAD,this._leftStickAxisX=o,this._leftStickAxisY=l,this._rightStickAxisX=u,this._rightStickAxisY=h,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(i.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),i.prototype.onleftstickchanged=function(a){this._onleftstickchanged=a},i.prototype.onrightstickchanged=function(a){this._onrightstickchanged=a},Object.defineProperty(i.prototype,"leftStick",{get:function(){return this._leftStick},set:function(a){this._onleftstickchanged&&(this._leftStick.x!==a.x||this._leftStick.y!==a.y)&&this._onleftstickchanged(a),this._leftStick=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightStick",{get:function(){return this._rightStick},set:function(a){this._onrightstickchanged&&(this._rightStick.x!==a.x||this._rightStick.y!==a.y)&&this._onrightstickchanged(a),this._rightStick=a},enumerable:!0,configurable:!0}),i.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},i.prototype.dispose=function(){},i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,i}();t.Gamepad=c;var r=function(i){N(a,i);function a(n,s,o){var l=i.call(this,n,s,o)||this;return l.onButtonDownObservable=new t.Observable,l.onButtonUpObservable=new t.Observable,l.type=c.GENERIC,l._buttons=new Array(o.buttons.length),l}return a.prototype.onbuttondown=function(n){this._onbuttondown=n},a.prototype.onbuttonup=function(n){this._onbuttonup=n},a.prototype._setButtonValue=function(n,s,o){return n!==s&&(n===1&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),n===0&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),n},a.prototype.update=function(){i.prototype.update.call(this);for(var n=0;n<this._buttons.length;n++)this._buttons[n]=this._setButtonValue(this.browserGamepad.buttons[n].value,this._buttons[n],n)},a.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},a}(c);t.GenericPad=r})(T||(T={}));var T;(function(t){var f;(function(i){i[i.A=0]="A",i[i.B=1]="B",i[i.X=2]="X",i[i.Y=3]="Y",i[i.Start=4]="Start",i[i.Back=5]="Back",i[i.LB=6]="LB",i[i.RB=7]="RB",i[i.LeftStick=8]="LeftStick",i[i.RightStick=9]="RightStick"})(f=t.Xbox360Button||(t.Xbox360Button={}));var c;(function(i){i[i.Up=0]="Up",i[i.Down=1]="Down",i[i.Left=2]="Left",i[i.Right=3]="Right"})(c=t.Xbox360Dpad||(t.Xbox360Dpad={}));var r=function(i){N(a,i);function a(n,s,o,l){l===void 0&&(l=!1);var u=i.call(this,n,s,o,0,1,2,3)||this;return u._leftTrigger=0,u._rightTrigger=0,u.onButtonDownObservable=new t.Observable,u.onButtonUpObservable=new t.Observable,u.onPadDownObservable=new t.Observable,u.onPadUpObservable=new t.Observable,u._buttonA=0,u._buttonB=0,u._buttonX=0,u._buttonY=0,u._buttonBack=0,u._buttonStart=0,u._buttonLB=0,u._buttonRB=0,u._buttonLeftStick=0,u._buttonRightStick=0,u._dPadUp=0,u._dPadDown=0,u._dPadLeft=0,u._dPadRight=0,u._isXboxOnePad=!1,u.type=t.Gamepad.XBOX,u._isXboxOnePad=l,u}return a.prototype.onlefttriggerchanged=function(n){this._onlefttriggerchanged=n},a.prototype.onrighttriggerchanged=function(n){this._onrighttriggerchanged=n},Object.defineProperty(a.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(n){this._onlefttriggerchanged&&this._leftTrigger!==n&&this._onlefttriggerchanged(n),this._leftTrigger=n},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(n){this._onrighttriggerchanged&&this._rightTrigger!==n&&this._onrighttriggerchanged(n),this._rightTrigger=n},enumerable:!0,configurable:!0}),a.prototype.onbuttondown=function(n){this._onbuttondown=n},a.prototype.onbuttonup=function(n){this._onbuttonup=n},a.prototype.ondpaddown=function(n){this._ondpaddown=n},a.prototype.ondpadup=function(n){this._ondpadup=n},a.prototype._setButtonValue=function(n,s,o){return n!==s&&(n===1&&(this._onbuttondown&&this._onbuttondown(o),this.onButtonDownObservable.notifyObservers(o)),n===0&&(this._onbuttonup&&this._onbuttonup(o),this.onButtonUpObservable.notifyObservers(o))),n},a.prototype._setDPadValue=function(n,s,o){return n!==s&&(n===1&&(this._ondpaddown&&this._ondpaddown(o),this.onPadDownObservable.notifyObservers(o)),n===0&&(this._ondpadup&&this._ondpadup(o),this.onPadUpObservable.notifyObservers(o))),n},Object.defineProperty(a.prototype,"buttonA",{get:function(){return this._buttonA},set:function(n){this._buttonA=this._setButtonValue(n,this._buttonA,f.A)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonB",{get:function(){return this._buttonB},set:function(n){this._buttonB=this._setButtonValue(n,this._buttonB,f.B)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonX",{get:function(){return this._buttonX},set:function(n){this._buttonX=this._setButtonValue(n,this._buttonX,f.X)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonY",{get:function(){return this._buttonY},set:function(n){this._buttonY=this._setButtonValue(n,this._buttonY,f.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(n){this._buttonStart=this._setButtonValue(n,this._buttonStart,f.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(n){this._buttonBack=this._setButtonValue(n,this._buttonBack,f.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(n){this._buttonLB=this._setButtonValue(n,this._buttonLB,f.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(n){this._buttonRB=this._setButtonValue(n,this._buttonRB,f.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(n){this._buttonLeftStick=this._setButtonValue(n,this._buttonLeftStick,f.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(n){this._buttonRightStick=this._setButtonValue(n,this._buttonRightStick,f.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(n){this._dPadUp=this._setDPadValue(n,this._dPadUp,c.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(n){this._dPadDown=this._setDPadValue(n,this._dPadDown,c.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(n){this._dPadLeft=this._setDPadValue(n,this._dPadLeft,c.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(n){this._dPadRight=this._setDPadValue(n,this._dPadRight,c.Right)},enumerable:!0,configurable:!0}),a.prototype.update=function(){i.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},a.prototype.dispose=function(){i.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},a}(t.Gamepad);t.Xbox360Pad=r})(T||(T={}));var T;(function(t){var f;(function(i){i[i.VIVE=0]="VIVE",i[i.OCULUS=1]="OCULUS",i[i.WINDOWS=2]="WINDOWS",i[i.GEAR_VR=3]="GEAR_VR",i[i.DAYDREAM=4]="DAYDREAM",i[i.GENERIC=5]="GENERIC"})(f=t.PoseEnabledControllerType||(t.PoseEnabledControllerType={}));var c=function(){function i(){}return i.InitiateController=function(a){return a.id.indexOf("Oculus Touch")!==-1?new t.OculusTouchController(a):a.id.indexOf(t.WindowsMotionController.GAMEPAD_ID_PREFIX)===0?new t.WindowsMotionController(a):a.id.toLowerCase().indexOf("openvr")!==-1?new t.ViveController(a):a.id.indexOf(t.GearVRController.GAMEPAD_ID_PREFIX)===0||a.id.indexOf("Oculus Go")!==-1?new t.GearVRController(a):a.id.indexOf(t.DaydreamController.GAMEPAD_ID_PREFIX)===0?new t.DaydreamController(a):new t.GenericController(a)},i}();t.PoseEnabledControllerHelper=c;var r=function(i){N(a,i);function a(n){var s=i.call(this,n.id,n.index,n)||this;return s._deviceRoomPosition=t.Vector3.Zero(),s._deviceRoomRotationQuaternion=new t.Quaternion,s.devicePosition=t.Vector3.Zero(),s.deviceRotationQuaternion=new t.Quaternion,s.deviceScaleFactor=1,s._trackPosition=!0,s._maxRotationDistFromHeadset=Math.PI/5,s._draggedRoomRotation=0,s._leftHandSystemQuaternion=new t.Quaternion,s._deviceToWorld=t.Matrix.Identity(),s._pointingPoseNode=null,s._workingMatrix=t.Matrix.Identity(),s._meshAttachedObservable=new t.Observable,s.type=t.Gamepad.POSE_ENABLED,s.controllerType=f.GENERIC,s.position=t.Vector3.Zero(),s.rotationQuaternion=new t.Quaternion,s._calculatedPosition=t.Vector3.Zero(),s._calculatedRotation=new t.Quaternion,t.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,s._leftHandSystemQuaternion),s}return a.prototype._disableTrackPosition=function(n){this._trackPosition&&(this._calculatedPosition.copyFrom(n),this._trackPosition=!1)},a.prototype.update=function(){i.prototype.update.call(this),this._updatePoseAndMesh()},a.prototype._updatePoseAndMesh=function(){var n=this.browserGamepad.pose;if(this.updateFromDevice(n),!this._trackPosition&&t.Engine.LastCreatedScene&&t.Engine.LastCreatedScene.activeCamera&&t.Engine.LastCreatedScene.activeCamera.devicePosition){var s=t.Engine.LastCreatedScene.activeCamera;if(s._computeDevicePosition(),this._deviceToWorld.setTranslation(s.devicePosition),s.deviceRotationQuaternion){var s=s;s._deviceRoomRotationQuaternion.toEulerAnglesToRef(t.Tmp.Vector3[0]);var o=Math.atan2(Math.sin(t.Tmp.Vector3[0].y-this._draggedRoomRotation),Math.cos(t.Tmp.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(o)>this._maxRotationDistFromHeadset){var l=o-(o<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=l;var u=Math.sin(-l),h=Math.cos(-l);this._calculatedPosition.x=this._calculatedPosition.x*h-this._calculatedPosition.z*u,this._calculatedPosition.z=this._calculatedPosition.x*u+this._calculatedPosition.z*h}}}t.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),t.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},a.prototype.updateFromDevice=function(n){if(n){this.rawPose=n,n.position&&(this._deviceRoomPosition.copyFromFloats(n.position[0],n.position[1],-n.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var s=this.rawPose;n.orientation&&s.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(s.orientation[0],s.orientation[1],-s.orientation[2],-s.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},a.prototype.attachToMesh=function(n){if(this._mesh&&(this._mesh.parent=null),this._mesh=n,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new t.Quaternion),this._updatePoseAndMesh(),this._pointingPoseNode){for(var s=[],o=this._pointingPoseNode;o.parent;)s.push(o.parent),o=o.parent;s.reverse().forEach(function(l){l.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(n)},a.prototype.attachToPoseControlledCamera=function(n){this._poseControlledCamera=n,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},a.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(a.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),a.prototype.getForwardRay=function(n){if(n===void 0&&(n=100),!this.mesh)return new t.Ray(t.Vector3.Zero(),new t.Vector3(0,0,1),n);var s=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),o=s.getTranslation(),l=new t.Vector3(0,0,-1),u=t.Vector3.TransformNormal(l,s),h=t.Vector3.Normalize(u);return new t.Ray(o,h,n)},a.POINTING_POSE="POINTING_POSE",a}(t.Gamepad);t.PoseEnabledController=r})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){var a=c.call(this,i)||this;return a.onTriggerStateChangedObservable=new t.Observable,a.onMainButtonStateChangedObservable=new t.Observable,a.onSecondaryButtonStateChangedObservable=new t.Observable,a.onPadStateChangedObservable=new t.Observable,a.onPadValuesChangedObservable=new t.Observable,a.pad={x:0,y:0},a._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},a._buttons=new Array(i.buttons.length),a.hand=i.hand,a}return r.prototype.onButtonStateChange=function(i){this._onButtonStateChange=i},Object.defineProperty(r.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),r.prototype.update=function(){c.prototype.update.call(this);for(var i=0;i<this._buttons.length;i++)this._setButtonValue(this.browserGamepad.buttons[i],this._buttons[i],i);(this.leftStick.x!==this.pad.x||this.leftStick.y!==this.pad.y)&&(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},r.prototype._setButtonValue=function(i,a,n){if(i||(i={pressed:!1,touched:!1,value:0}),!a){this._buttons[n]={pressed:i.pressed,touched:i.touched,value:i.value};return}this._checkChanges(i,a),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,n,i),this._handleButtonChange(n,i,this._changes)),this._buttons[n].pressed=i.pressed,this._buttons[n].touched=i.touched,this._buttons[n].value=i.value<1e-8?0:i.value},r.prototype._checkChanges=function(i,a){return this._changes.pressChanged=i.pressed!==a.pressed,this._changes.touchChanged=i.touched!==a.touched,this._changes.valueChanged=i.value!==a.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},r.prototype.dispose=function(){c.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},r}(t.PoseEnabledController);t.WebVRController=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){var a=c.call(this,i)||this;return a.onSecondaryTriggerStateChangedObservable=new t.Observable,a.onThumbRestChangedObservable=new t.Observable,a.controllerType=t.PoseEnabledControllerType.OCULUS,a}return r.prototype.initControllerMesh=function(i,a){var n=this,s;this.hand==="left"?s=r.MODEL_LEFT_FILENAME:s=r.MODEL_RIGHT_FILENAME,t.SceneLoader.ImportMesh("",r.MODEL_BASE_URL,s,i,function(o){n._defaultModel=o[1],n.attachToMesh(n._defaultModel),a&&a(n._defaultModel)})},Object.defineProperty(r.prototype,"onAButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBButtonStateChangedObservable",{get:function(){if(this.hand==="right")return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onXButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onYButtonStateChangedObservable",{get:function(){if(this.hand==="left")return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),r.prototype._handleButtonChange=function(i,a,n){var s=a,o=this.hand==="right"?-1:1;switch(i){case 0:this.onPadStateChangedObservable.notifyObservers(s);return;case 1:this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=-s.value*.2,this._defaultModel.getChildren()[3].position.y=-s.value*.005,this._defaultModel.getChildren()[3].position.z=-s.value*.005),this.onTriggerStateChangedObservable.notifyObservers(s);return;case 2:this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=o*s.value*.0035),this.onSecondaryTriggerStateChangedObservable.notifyObservers(s);return;case 3:this._defaultModel&&(s.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),this.onMainButtonStateChangedObservable.notifyObservers(s);return;case 4:this._defaultModel&&(s.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),this.onSecondaryButtonStateChangedObservable.notifyObservers(s);return;case 5:this.onThumbRestChangedObservable.notifyObservers(s);return}},r.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",r.MODEL_LEFT_FILENAME="left.babylon",r.MODEL_RIGHT_FILENAME="right.babylon",r}(t.WebVRController);t.OculusTouchController=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){var a=c.call(this,i)||this;return a.controllerType=t.PoseEnabledControllerType.VIVE,a._invertLeftStickY=!0,a}return r.prototype.initControllerMesh=function(i,a){var n=this;t.SceneLoader.ImportMesh("",r.MODEL_BASE_URL,r.MODEL_FILENAME,i,function(s){n._defaultModel=s[1],n.attachToMesh(n._defaultModel),a&&a(n._defaultModel)})},Object.defineProperty(r.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),r.prototype._handleButtonChange=function(i,a,n){var s=a;switch(i){case 0:this.onPadStateChangedObservable.notifyObservers(s);return;case 1:this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=-s.value*.15),this.onTriggerStateChangedObservable.notifyObservers(s);return;case 2:this.onMainButtonStateChangedObservable.notifyObservers(s);return;case 3:this._defaultModel&&(s.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),this.onSecondaryButtonStateChangedObservable.notifyObservers(s);return}},r.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",r.MODEL_FILENAME="wand.babylon",r}(t.WebVRController);t.ViveController=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){return c.call(this,i)||this}return r.prototype.initControllerMesh=function(i,a){var n=this;t.SceneLoader.ImportMesh("",r.MODEL_BASE_URL,r.MODEL_FILENAME,i,function(s){n._defaultModel=s[1],n.attachToMesh(n._defaultModel),a&&a(n._defaultModel)})},r.prototype._handleButtonChange=function(i,a,n){console.log("Button id: "+i+"state: "),console.dir(a)},r.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",r.MODEL_FILENAME="generic.babylon",r}(t.WebVRController);t.GenericController=f})(T||(T={}));var T;(function(t){var f=function(){function r(){this.buttonMeshes={},this.axisMeshes={}}return r}(),c=function(r){N(i,r);function i(a){var n=r.call(this,a)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:t.PoseEnabledController.POINTING_POSE},n.onTrackpadChangedObservable=new t.Observable,n.onTrackpadValuesChangedObservable=new t.Observable,n.trackpad={x:0,y:0},n.controllerType=t.PoseEnabledControllerType.WINDOWS,n._loadedMeshInfo=null,n}return Object.defineProperty(i.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),i.prototype._updateTrackpad=function(){this.browserGamepad.axes&&(this.browserGamepad.axes[2]!=this.trackpad.x||this.browserGamepad.axes[3]!=this.trackpad.y)&&(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},i.prototype.update=function(){if(r.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var a=0;a<this._mapping.axisMeshNames.length;a++)this._lerpAxisTransform(a,this.browserGamepad.axes[a])},i.prototype._handleButtonChange=function(a,n,s){var o=this._mapping.buttons[a];if(o){this._updateTrackpad();var l=this[this._mapping.buttonObservableNames[o]];l&&l.notifyObservers(n),this._lerpButtonTransform(o,n.value)}},i.prototype._lerpButtonTransform=function(a,n){if(this._loadedMeshInfo){var s=this._loadedMeshInfo.buttonMeshes[a];!s.unpressed.rotationQuaternion||!s.pressed.rotationQuaternion||!s.value.rotationQuaternion||(t.Quaternion.SlerpToRef(s.unpressed.rotationQuaternion,s.pressed.rotationQuaternion,n,s.value.rotationQuaternion),t.Vector3.LerpToRef(s.unpressed.position,s.pressed.position,n,s.value.position))}},i.prototype._lerpAxisTransform=function(a,n){if(this._loadedMeshInfo){var s=this._loadedMeshInfo.axisMeshes[a];if(s&&!(!s.min.rotationQuaternion||!s.max.rotationQuaternion||!s.value.rotationQuaternion)){var o=n*.5+.5;t.Quaternion.SlerpToRef(s.min.rotationQuaternion,s.max.rotationQuaternion,o,s.value.rotationQuaternion),t.Vector3.LerpToRef(s.min.position,s.max.position,o,s.value.position)}}},i.prototype.initControllerMesh=function(a,n,s){var o=this;s===void 0&&(s=!1);var l,u;if(t.SceneLoader.IsPluginForExtensionAvailable(".glb")){var h="default";if(this.id&&!s){var d=this.id.match(i.GAMEPAD_ID_PATTERN);h=d&&d[0]||h}this.hand==="left"?u=i.MODEL_LEFT_FILENAME:u=i.MODEL_RIGHT_FILENAME,l=i.MODEL_BASE_URL+h+"/"}else t.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),l=t.GenericController.MODEL_BASE_URL,u=t.GenericController.MODEL_FILENAME;t.SceneLoader.ImportMesh("",l,u,a,function(p){o._loadedMeshInfo=o.processModel(a,p),o._loadedMeshInfo&&(o._defaultModel=o._loadedMeshInfo.rootNode,o.attachToMesh(o._defaultModel),n&&n(o._defaultModel))},null,function(p,m){t.Tools.Log(m),t.Tools.Warn("Failed to retrieve controller model from the remote server: "+l+u),s||o.initControllerMesh(p,n,!0)})},i.prototype.processModel=function(a,n){for(var s=null,o=new t.Mesh(this.id+" "+this.hand,a),l=null,u=0;u<n.length;u++){var h=n[u];if(!h.parent){h.isPickable=!1,l=h;break}}return l?(l.setParent(o),s=this.createMeshInfo(o)):t.Tools.Warn("Could not find root node in model file."),s},i.prototype.createMeshInfo=function(a){var n=new f,s;for(n.rootNode=a,n.buttonMeshes={},n.axisMeshes={},s=0;s<this._mapping.buttons.length;s++){var o=this._mapping.buttonMeshNames[this._mapping.buttons[s]];if(!o){t.Tools.Log("Skipping unknown button at index: "+s+" with mapped name: "+this._mapping.buttons[s]);continue}var l=m(a,o);if(!l){t.Tools.Warn("Missing button mesh with name: "+o);continue}var u={index:s,value:_(l,"VALUE"),pressed:_(l,"PRESSED"),unpressed:_(l,"UNPRESSED")};u.value&&u.pressed&&u.unpressed?n.buttonMeshes[this._mapping.buttons[s]]=u:t.Tools.Warn("Missing button submesh under mesh with name: "+o+"(VALUE: "+!!u.value+", PRESSED: "+!!u.pressed+", UNPRESSED:"+!!u.unpressed+")")}for(s=0;s<this._mapping.axisMeshNames.length;s++){var h=this._mapping.axisMeshNames[s];if(!h){t.Tools.Log("Skipping unknown axis at index: "+s);continue}var d=m(a,h);if(!d){t.Tools.Warn("Missing axis mesh with name: "+h);continue}var p={index:s,value:_(d,"VALUE"),min:_(d,"MIN"),max:_(d,"MAX")};p.value&&p.min&&p.max?n.axisMeshes[s]=p:t.Tools.Warn("Missing axis submesh under mesh with name: "+h+"(VALUE: "+!!p.value+", MIN: "+!!p.min+", MAX:"+!!p.max+")")}return n.pointingPoseNode=m(a,this._mapping.pointingPoseMeshName),n.pointingPoseNode?this._pointingPoseNode=n.pointingPoseNode:t.Tools.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),n;function m(v,S){return v.getChildMeshes(!1,function(P){return P.name===S})[0]}function _(v,S){return v.getChildMeshes(!0,function(P){return P.name==S})[0]}},i.prototype.getForwardRay=function(a){if(a===void 0&&(a=100),!(this._loadedMeshInfo&&this._loadedMeshInfo.pointingPoseNode))return r.prototype.getForwardRay.call(this,a);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),s=n.getTranslation(),o=new t.Vector3(0,0,-1),l=t.Vector3.TransformNormal(o,n),u=t.Vector3.Normalize(l);return new t.Ray(s,u,a)},i.prototype.dispose=function(){r.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},i.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",i.MODEL_LEFT_FILENAME="left.glb",i.MODEL_RIGHT_FILENAME="right.glb",i.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",i.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,i}(t.WebVRController);t.WindowsMotionController=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){var a=c.call(this,i)||this;return a._buttonIndexToObservableNameMap=["onTrackpadChangedObservable","onTriggerStateChangedObservable"],a.controllerType=t.PoseEnabledControllerType.GEAR_VR,a._calculatedPosition=new t.Vector3(a.hand=="left"?-.15:.15,-.5,.25),a._disableTrackPosition(a._calculatedPosition),a}return r.prototype.initControllerMesh=function(i,a){var n=this;t.SceneLoader.ImportMesh("",r.MODEL_BASE_URL,r.MODEL_FILENAME,i,function(s){var o=new t.Mesh("",i);s[1].parent=o,s[1].position.z=-.15,n._defaultModel=o,n.attachToMesh(n._defaultModel),a&&a(n._defaultModel)})},r.prototype._handleButtonChange=function(i,a,n){if(i<this._buttonIndexToObservableNameMap.length){var s=this._buttonIndexToObservableNameMap[i],o=this[s];o&&o.notifyObservers(a)}},r.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",r.MODEL_FILENAME="generic.babylon",r.GAMEPAD_ID_PREFIX="Gear VR",r}(t.WebVRController);t.GearVRController=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){var a=c.call(this,i)||this;return a.controllerType=t.PoseEnabledControllerType.DAYDREAM,a}return r.prototype.initControllerMesh=function(i,a){var n=this;t.SceneLoader.ImportMesh("",r.MODEL_BASE_URL,r.MODEL_FILENAME,i,function(s){n._defaultModel=s[1],n.attachToMesh(n._defaultModel),a&&a(n._defaultModel)})},r.prototype._handleButtonChange=function(i,a,n){if(i===0){var s=this.onTriggerStateChangedObservable;s&&s.notifyObservers(a)}else t.Tools.Warn("Unrecognized Daydream button index: "+i)},r.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",r.MODEL_FILENAME="generic.babylon",r.GAMEPAD_ID_PREFIX="Daydream",r}(t.WebVRController);t.DaydreamController=f})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new t.GamepadManager(this);var c=this._getComponent(t.SceneComponentConstants.NAME_GAMEPAD);c||(c=new f(this),this._addComponent(c))}return this._gamepadManager},enumerable:!0,configurable:!0}),t.FreeCameraInputsManager.prototype.addGamepad=function(){return this.add(new t.FreeCameraGamepadInput),this},t.ArcRotateCameraInputsManager.prototype.addGamepad=function(){return this.add(new t.ArcRotateCameraGamepadInput),this};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_GAMEPAD,this.scene=r}return c.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(t.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){var r=this.scene._gamepadManager;r&&(r.dispose(),this.scene._gamepadManager=null)},c.prototype._beforeCameraUpdate=function(){var r=this.scene._gamepadManager;r&&r._isMonitoring&&r._checkGamepadsStatus()},c}();t.GamepadSystemSceneComponent=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("FollowCamera",function(r,i){return function(){return new f(r,t.Vector3.Zero(),i)}}),t.Node.AddNodeConstructor("ArcFollowCamera",function(r,i){return function(){return new c(r,0,0,1,null,i)}});var f=function(r){N(i,r);function i(a,n,s,o){o===void 0&&(o=null);var l=r.call(this,a,n,s)||this;return l.radius=12,l.rotationOffset=0,l.heightOffset=4,l.cameraAcceleration=.05,l.maxCameraSpeed=20,l.lockedTarget=o,l}return i.prototype._follow=function(a){if(a){var n;if(a.rotationQuaternion){var s=new t.Matrix;a.rotationQuaternion.toRotationMatrix(s),n=Math.atan2(s.m[8],s.m[10])}else n=a.rotation.y;var o=t.Tools.ToRadians(this.rotationOffset)+n,l=a.getAbsolutePosition(),u=l.x+Math.sin(o)*this.radius,h=l.z+Math.cos(o)*this.radius,d=u-this.position.x,p=l.y+this.heightOffset-this.position.y,m=h-this.position.z,_=d*this.cameraAcceleration*2,v=p*this.cameraAcceleration,S=m*this.cameraAcceleration*2;(_>this.maxCameraSpeed||_<-this.maxCameraSpeed)&&(_=_<1?-this.maxCameraSpeed:this.maxCameraSpeed),(v>this.maxCameraSpeed||v<-this.maxCameraSpeed)&&(v=v<1?-this.maxCameraSpeed:this.maxCameraSpeed),(S>this.maxCameraSpeed||S<-this.maxCameraSpeed)&&(S=S<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new t.Vector3(this.position.x+_,this.position.y+v,this.position.z+S),this.setTarget(l)}},i.prototype._checkInputs=function(){r.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},i.prototype.getClassName=function(){return"FollowCamera"},A([t.serialize()],i.prototype,"radius",void 0),A([t.serialize()],i.prototype,"rotationOffset",void 0),A([t.serialize()],i.prototype,"heightOffset",void 0),A([t.serialize()],i.prototype,"cameraAcceleration",void 0),A([t.serialize()],i.prototype,"maxCameraSpeed",void 0),A([t.serializeAsMeshReference("lockedTargetId")],i.prototype,"lockedTarget",void 0),i}(t.TargetCamera);t.FollowCamera=f;var c=function(r){N(i,r);function i(a,n,s,o,l,u){var h=r.call(this,a,t.Vector3.Zero(),u)||this;return h.alpha=n,h.beta=s,h.radius=o,h.target=l,h._cartesianCoordinates=t.Vector3.Zero(),h._follow(),h}return i.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var a=this.target.getAbsolutePosition();this.position=a.add(this._cartesianCoordinates),this.setTarget(a)}},i.prototype._checkInputs=function(){r.prototype._checkInputs.call(this),this._follow()},i.prototype.getClassName=function(){return"ArcFollowCamera"},i}(t.TargetCamera);t.ArcFollowCamera=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,a,n)||this;return s.inputs.addGamepad(),s}return Object.defineProperty(r.prototype,"gamepadAngularSensibility",{get:function(){var i=this.inputs.attached.gamepad;return i?i.gamepadAngularSensibility:0},set:function(i){var a=this.inputs.attached.gamepad;a&&(a.gamepadAngularSensibility=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gamepadMoveSensibility",{get:function(){var i=this.inputs.attached.gamepad;return i?i.gamepadMoveSensibility:0},set:function(i){var a=this.inputs.attached.gamepad;a&&(a.gamepadMoveSensibility=i)},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"UniversalCamera"},r}(t.TouchCamera);t.UniversalCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("GamepadCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){return c.call(this,i,a,n)||this}return r.prototype.getClassName=function(){return"GamepadCamera"},r}(t.UniversalCamera);t.GamepadCamera=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._renderPipelines={}}return c.prototype.addPipeline=function(r){this._renderPipelines[r._name]=r},c.prototype.attachCamerasToRenderPipeline=function(r,i,a){a===void 0&&(a=!1);var n=this._renderPipelines[r];n&&n._attachCameras(i,a)},c.prototype.detachCamerasFromRenderPipeline=function(r,i){var a=this._renderPipelines[r];a&&a._detachCameras(i)},c.prototype.enableEffectInPipeline=function(r,i,a){var n=this._renderPipelines[r];n&&n._enableEffect(i,a)},c.prototype.disableEffectInPipeline=function(r,i,a){var n=this._renderPipelines[r];n&&n._disableEffect(i,a)},c.prototype.update=function(){for(var r in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(r)){var i=this._renderPipelines[r];i.isSupported?i._update():(i.dispose(),delete this._renderPipelines[r])}},c.prototype._rebuild=function(){for(var r in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(r)){var i=this._renderPipelines[r];i._rebuild()}},c.prototype.dispose=function(){for(var r in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(r)){var i=this._renderPipelines[r];i.dispose()}},c}();t.PostProcessRenderPipelineManager=f})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var c=this._getComponent(t.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER);c||(c=new f(this),this._addComponent(c)),this._postProcessRenderPipelineManager=new t.PostProcessRenderPipelineManager}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=r}return c.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},c.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},c.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},c.prototype._gatherRenderTargets=function(r){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},c}();t.PostProcessRenderPipelineManagerSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n){this._name=i,this._singleInstance=n||!0,this._getPostProcesses=a,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(c.prototype,"isSupported",{get:function(){for(var r in this._postProcesses)if(this._postProcesses.hasOwnProperty(r)){for(var i=this._postProcesses[r],a=0;a<i.length;a++)if(!i[a].isSupported)return!1}return!0},enumerable:!0,configurable:!0}),c.prototype._update=function(){},c.prototype._attachCameras=function(r){var i=this,a,n=t.Tools.MakeArray(r||this._cameras);if(n)for(var s=0;s<n.length;s++){var o=n[s],l=o.name;if(this._singleInstance?a=0:a=l,!this._postProcesses[a]){var u=this._getPostProcesses();u&&(this._postProcesses[a]=Array.isArray(u)?u:[u])}this._indicesForCamera[l]||(this._indicesForCamera[l]=[]),this._postProcesses[a].forEach(function(h){var d=o.attachPostProcess(h);i._indicesForCamera[l].push(d)}),this._cameras[l]||(this._cameras[l]=o)}},c.prototype._detachCameras=function(r){var i=t.Tools.MakeArray(r||this._cameras);if(i)for(var a=0;a<i.length;a++){var n=i[a],s=n.name;this._postProcesses[this._singleInstance?0:s].forEach(function(o){n.detachPostProcess(o)}),this._cameras[s]&&(this._cameras[s]=null)}},c.prototype._enable=function(r){var i=this,a=t.Tools.MakeArray(r||this._cameras);if(a)for(var n=0;n<a.length;n++)for(var s=a[n],o=s.name,l=0;l<this._indicesForCamera[o].length;l++)(s._postProcesses[this._indicesForCamera[o][l]]===void 0||s._postProcesses[this._indicesForCamera[o][l]]===null)&&this._postProcesses[this._singleInstance?0:o].forEach(function(u){a[n].attachPostProcess(u,i._indicesForCamera[o][l])})},c.prototype._disable=function(r){var i=t.Tools.MakeArray(r||this._cameras);if(i)for(var a=0;a<i.length;a++){var n=i[a],s=n.name;this._postProcesses[this._singleInstance?0:s].forEach(function(o){n.detachPostProcess(o)})}},c.prototype.getPostProcesses=function(r){return this._singleInstance?this._postProcesses[0]:r?this._postProcesses[r.name]:null},c}();t.PostProcessRenderEffect=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.engine=r,this._name=i,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return c.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(c.prototype,"isSupported",{get:function(){for(var r in this._renderEffects)if(this._renderEffects.hasOwnProperty(r)&&!this._renderEffects[r].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),c.prototype.addEffect=function(r){this._renderEffects[r._name]=r},c.prototype._rebuild=function(){},c.prototype._enableEffect=function(r,i){var a=this._renderEffects[r];a&&a._enable(t.Tools.MakeArray(i||this._cameras))},c.prototype._disableEffect=function(r,i){var a=this._renderEffects[r];a&&a._disable(t.Tools.MakeArray(i||this._cameras))},c.prototype._attachCameras=function(r,i){var a=t.Tools.MakeArray(r||this._cameras);if(a){var n=[],s;for(s=0;s<a.length;s++){var o=a[s],l=o.name;this._cameras.indexOf(o)===-1?this._cameras[l]=o:i&&n.push(s)}for(s=0;s<n.length;s++)r.splice(n[s],1);for(var u in this._renderEffects)this._renderEffects.hasOwnProperty(u)&&this._renderEffects[u]._attachCameras(a)}},c.prototype._detachCameras=function(r){var i=t.Tools.MakeArray(r||this._cameras);if(i){for(var a in this._renderEffects)this._renderEffects.hasOwnProperty(a)&&this._renderEffects[a]._detachCameras(i);for(var n=0;n<i.length;n++)this._cameras.splice(this._cameras.indexOf(i[n]),1)}},c.prototype._update=function(){for(var r in this._renderEffects)this._renderEffects.hasOwnProperty(r)&&this._renderEffects[r]._update();for(var i=0;i<this._cameras.length;i++){var a=this._cameras[i].name;this._renderEffectsForIsolatedPass[a]&&this._renderEffectsForIsolatedPass[a]._update()}},c.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},c.prototype._enableMSAAOnFirstPostProcess=function(r){var i=Object.keys(this._renderEffects);if(this.engine.webGLVersion>=2&&i.length>0){var a=this._renderEffects[i[0]].getPostProcesses();if(a)return a[0].samples=r,!0}return!1},c.prototype.dispose=function(){},A([t.serialize()],c.prototype,"_name",void 0),c}();t.PostProcessRenderPipeline=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){i===void 0&&(i=t.Engine.TEXTURETYPE_FLOAT),a===void 0&&(a=null);var n=this;this.useOnlyInActiveCamera=!1,this._scene=r;var s=r._getComponent(t.SceneComponentConstants.NAME_DEPTHRENDERER);s||(s=new t.DepthRendererSceneComponent(r),r._addComponent(s)),this._camera=a;var o=r.getEngine();this._depthMap=new t.RenderTargetTexture("depthMap",{width:o.getRenderWidth(),height:o.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(u){u.clear(new t.Color4(1,1,1,1),!0,!0,!0)});var l=function(u){var h=u.getRenderingMesh(),d=n._scene,p=d.getEngine(),m=u.getMaterial();if(m){p.setState(m.backFaceCulling,0,!1,d.useRightHandedSystem);var _=h._getInstancesRenderList(u._id);if(!_.mustReturn){var v=p.getCaps().instancedArrays&&_.visibleInstances[u._id]!==null,S=n._camera||d.activeCamera;if(n.isReady(u,v)&&S){if(p.enableEffect(n._effect),h._bind(u,n._effect,t.Material.TriangleFillMode),n._effect.setMatrix("viewProjection",d.getTransformMatrix()),n._effect.setFloat2("depthValues",S.minZ,S.minZ+S.maxZ),m&&m.needAlphaTesting()){var P=m.getAlphaTestTexture();P&&(n._effect.setTexture("diffuseSampler",P),n._effect.setMatrix("diffuseMatrix",P.getTextureMatrix()))}h.useBones&&h.computeBonesUsingShaders&&h.skeleton&&n._effect.setMatrices("mBones",h.skeleton.getTransformMatrices(h)),h._processRendering(u,n._effect,t.Material.TriangleFillMode,_,v,function(x,R){return n._effect.setMatrix("world",R)})}}}};this._depthMap.customRenderFunction=function(u,h,d,p){var m;if(p.length){for(o.setColorWrite(!1),m=0;m<p.length;m++)l(p.data[m]);o.setColorWrite(!0)}for(m=0;m<u.length;m++)l(u.data[m]);for(m=0;m<h.length;m++)l(h.data[m])}}return c.prototype.isReady=function(r,i){var a=r.getMaterial();if(a.disableDepthWrite)return!1;var n=[],s=[t.VertexBuffer.PositionKind],o=r.getMesh();a&&a.needAlphaTesting()&&a.getAlphaTestTexture()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(s.push(t.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(s.push(t.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(s.push(t.VertexBuffer.MatricesIndicesKind),s.push(t.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(s.push(t.VertexBuffer.MatricesIndicesExtraKind),s.push(t.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),s.push("world0"),s.push("world1"),s.push("world2"),s.push("world3"));var l=n.join(`
`);return this._cachedDefines!==l&&(this._cachedDefines=l,this._effect=this._scene.getEngine().createEffect("depth",s,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],l)),this._effect.isReady()},c.prototype.getDepthMap=function(){return this._depthMap},c.prototype.dispose=function(){this._depthMap.dispose()},c}();t.DepthRenderer=f})(T||(T={}));var T;(function(t){t.Scene.prototype.enableDepthRenderer=function(c){if(c=c||this.activeCamera,!c)throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[c.id]){var r=0;if(this.getEngine().getCaps().textureHalfFloatRender)r=t.Engine.TEXTURETYPE_HALF_FLOAT;else if(this.getEngine().getCaps().textureFloatRender)r=t.Engine.TEXTURETYPE_FLOAT;else throw"Depth renderer does not support int texture type";this._depthRenderer[c.id]=new t.DepthRenderer(this,r,c)}return this._depthRenderer[c.id]},t.Scene.prototype.disableDepthRenderer=function(c){c=c||this.activeCamera,!(!c||!this._depthRenderer||!this._depthRenderer[c.id])&&(this._depthRenderer[c.id].dispose(),delete this._depthRenderer[c.id])};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_DEPTHRENDERER,this.scene=r}return c.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){for(var r in this.scene._depthRenderer)this.scene._depthRenderer[r].dispose()},c.prototype._gatherRenderTargets=function(r){if(this.scene._depthRenderer)for(var i in this.scene._depthRenderer){var a=this.scene._depthRenderer[i];a.useOnlyInActiveCamera||r.push(a.getDepthMap())}},c.prototype._gatherActiveCameraRenderTargets=function(r){if(this.scene._depthRenderer)for(var i in this.scene._depthRenderer){var a=this.scene._depthRenderer[i];a.useOnlyInActiveCamera&&this.scene.activeCamera.id===i&&r.push(a.getDepthMap())}},c}();t.DepthRendererSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){i===void 0&&(i=1),this._enablePosition=!1,this._scene=r,this._ratio=i;var a=r._getComponent(t.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER);a||(a=new t.GeometryBufferRendererSceneComponent(r),r._addComponent(a)),this._createRenderTargets()}return Object.defineProperty(c.prototype,"renderList",{set:function(r){this._multiRenderTarget.renderList=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(r){this._enablePosition=r,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),c.prototype.isReady=function(r,i){var a=r.getMaterial();if(a&&a.disableDepthWrite)return!1;var n=[],s=[t.VertexBuffer.PositionKind,t.VertexBuffer.NormalKind],o=r.getMesh();a&&a.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(s.push(t.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(s.push(t.VertexBuffer.UV2Kind),n.push("#define UV2"))),this._enablePosition&&n.push("#define POSITION"),o.useBones&&o.computeBonesUsingShaders?(s.push(t.VertexBuffer.MatricesIndicesKind),s.push(t.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(s.push(t.VertexBuffer.MatricesIndicesExtraKind),s.push(t.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),s.push("world0"),s.push("world1"),s.push("world2"),s.push("world3"));var l=n.join(`
`);return this._cachedDefines!==l&&(this._cachedDefines=l,this._effect=this._scene.getEngine().createEffect("geometry",s,["world","mBones","viewProjection","diffuseMatrix","view"],["diffuseSampler"],l,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},c.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(c.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(r){this._multiRenderTarget.samples=r},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){this.getGBuffer().dispose()},c.prototype._createRenderTargets=function(){var r=this,i=this._scene.getEngine(),a=this._enablePosition?3:2;if(this._multiRenderTarget=new t.MultiRenderTarget("gBuffer",{width:i.getRenderWidth()*this._ratio,height:i.getRenderHeight()*this._ratio},a,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:t.Engine.TEXTURETYPE_FLOAT}),!!this.isSupported){this._multiRenderTarget.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(s){s.clear(new t.Color4(0,0,0,1),!0,!0,!0)});var n=function(s){var o=s.getRenderingMesh(),l=r._scene,u=l.getEngine(),h=s.getMaterial();if(h){u.setState(h.backFaceCulling,0,!1,l.useRightHandedSystem);var d=o._getInstancesRenderList(s._id);if(!d.mustReturn){var p=u.getCaps().instancedArrays&&d.visibleInstances[s._id]!==null;if(r.isReady(s,p)){if(u.enableEffect(r._effect),o._bind(s,r._effect,t.Material.TriangleFillMode),r._effect.setMatrix("viewProjection",l.getTransformMatrix()),r._effect.setMatrix("view",l.getViewMatrix()),h&&h.needAlphaTesting()){var m=h.getAlphaTestTexture();m&&(r._effect.setTexture("diffuseSampler",m),r._effect.setMatrix("diffuseMatrix",m.getTextureMatrix()))}o.useBones&&o.computeBonesUsingShaders&&o.skeleton&&r._effect.setMatrices("mBones",o.skeleton.getTransformMatrices(o)),o._processRendering(s,r._effect,t.Material.TriangleFillMode,d,p,function(_,v){return r._effect.setMatrix("world",v)})}}}};this._multiRenderTarget.customRenderFunction=function(s,o,l,u){var h;if(u.length){for(i.setColorWrite(!1),h=0;h<u.length;h++)n(u.data[h]);i.setColorWrite(!0)}for(h=0;h<s.length;h++)n(s.data[h]);for(h=0;h<o.length;h++)n(o.data[h])}}},c}();t.GeometryBufferRenderer=f})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(c){c&&c.isSupported&&(this._geometryBufferRenderer=c)},enumerable:!0,configurable:!0}),t.Scene.prototype.enableGeometryBufferRenderer=function(c){return c===void 0&&(c=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new t.GeometryBufferRenderer(this,c),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},t.Scene.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER,this.scene=r}return c.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(t.SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){},c.prototype._gatherRenderTargets=function(r){this.scene._geometryBufferRenderer&&r.push(this.scene._geometryBufferRenderer.getGBuffer())},c}();t.GeometryBufferRendererSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,a.getEngine(),i)||this;o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.radius=1e-4,o.area=.0075,o.fallOff=1e-6,o.base=.5,o._firstUpdate=!0,o._scene=a,o._createRandomTexture(),o._depthTexture=a.enableDepthRenderer().getDepthMap();var l=n.ssaoRatio||n,u=n.combineRatio||n;return o._originalColorPostProcess=new t.PassPostProcess("SSAOOriginalSceneColor",u,null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1),o._createSSAOPostProcess(l),o._createBlurPostProcess(l),o._createSSAOCombinePostProcess(u),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),a.postProcessRenderPipelineManager.addPipeline(o),s&&a.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s),o}return r.prototype.dispose=function(i){i===void 0&&(i=!1);for(var a=0;a<this._scene.cameras.length;a++){var n=this._scene.cameras[a];this._originalColorPostProcess.dispose(n),this._ssaoPostProcess.dispose(n),this._blurHPostProcess.dispose(n),this._blurVPostProcess.dispose(n),this._ssaoCombinePostProcess.dispose(n)}this._randomTexture.dispose(),i&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),c.prototype.dispose.call(this)},r.prototype._createBlurPostProcess=function(i){var a=this,n=16;this._blurHPostProcess=new t.BlurPostProcess("BlurH",new t.Vector2(1,0),n,i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,t.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new t.BlurPostProcess("BlurV",new t.Vector2(0,1),n,i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,t.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var s=a._blurHPostProcess.width/a._scene.getEngine().getRenderWidth();a._blurHPostProcess.kernel=n*s}),this._blurVPostProcess.onActivateObservable.add(function(){var s=a._blurVPostProcess.height/a._scene.getEngine().getRenderHeight();a._blurVPostProcess.kernel=n*s})},r.prototype._rebuild=function(){this._firstUpdate=!0,c.prototype._rebuild.call(this)},r.prototype._createSSAOPostProcess=function(i){var a=this,n=16,s=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],o=1/n;this._ssaoPostProcess=new t.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+n+`
#define SSAO`),this._ssaoPostProcess.onApply=function(l){a._firstUpdate&&(l.setArray3("sampleSphere",s),l.setFloat("samplesFactor",o),l.setFloat("randTextureTiles",4)),l.setFloat("totalStrength",a.totalStrength),l.setFloat("radius",a.radius),l.setFloat("area",a.area),l.setFloat("fallOff",a.fallOff),l.setFloat("base",a.base),l.setTexture("textureSampler",a._depthTexture),l.setTexture("randomSampler",a._randomTexture)}},r.prototype._createSSAOCombinePostProcess=function(i){var a=this;this._ssaoCombinePostProcess=new t.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(n){n.setVector4("viewport",t.Tmp.Vector4[0].copyFromFloats(0,0,1,1)),n.setTextureFromPostProcess("originalColor",a._originalColorPostProcess)}},r.prototype._createRandomTexture=function(){var i=512;this._randomTexture=new t.DynamicTexture("SSAORandomTexture",i,this._scene,!1,t.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=t.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=t.Texture.WRAP_ADDRESSMODE;for(var a=this._randomTexture.getContext(),n=function(u,h){return Math.random()*(h-u)+u},s=t.Vector3.Zero(),o=0;o<i;o++)for(var l=0;l<i;l++)s.x=Math.floor(n(-1,1)*255),s.y=Math.floor(n(-1,1)*255),s.z=Math.floor(n(-1,1)*255),a.fillStyle="rgb("+s.x+", "+s.y+", "+s.z+")",a.fillRect(o,l,1,1);this._randomTexture.update(!1)},A([t.serialize()],r.prototype,"totalStrength",void 0),A([t.serialize()],r.prototype,"radius",void 0),A([t.serialize()],r.prototype,"area",void 0),A([t.serialize()],r.prototype,"fallOff",void 0),A([t.serialize()],r.prototype,"base",void 0),r}(t.PostProcessRenderPipeline);t.SSAORenderingPipeline=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,a.getEngine(),i)||this;if(o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.maxZ=100,o.minZAspect=.2,o._samples=8,o._textureSamples=1,o._expensiveBlur=!0,o.radius=2,o.base=0,o._firstUpdate=!0,o._bits=new Uint32Array(1),o._scene=a,o._ratio=n,!o.isSupported)return t.Tools.Error("SSAO 2 needs WebGL 2 support."),o;var l=o._ratio.ssaoRatio||n,u=o._ratio.blurRatio||n,h=a.enableGeometryBufferRenderer();return o._createRandomTexture(),o._depthTexture=h.getGBuffer().textures[0],o._normalTexture=h.getGBuffer().textures[1],o._originalColorPostProcess=new t.PassPostProcess("SSAOOriginalSceneColor",1,null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1),o._originalColorPostProcess.samples=o.textureSamples,o._createSSAOPostProcess(1),o._createBlurPostProcess(l,u),o._createSSAOCombinePostProcess(u),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new t.PostProcessRenderEffect(a.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),a.postProcessRenderPipelineManager.addPipeline(o),s&&a.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s),o}return Object.defineProperty(r.prototype,"samples",{get:function(){return this._samples},set:function(i){this._ssaoPostProcess.updateEffect("#define SAMPLES "+i+`
#define SSAO`),this._samples=i,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(i){this._textureSamples=i,this._originalColorPostProcess.samples=i,this._blurHPostProcess.samples=i,this._blurVPostProcess.samples=i,this._ssaoPostProcess.samples=i,this._ssaoCombinePostProcess.samples=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(i){this._blurHPostProcess.updateEffect(`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(i?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect(`#define BILATERAL_BLUR
#define SAMPLES 16
#define EXPENSIVE `+(i?"1":"0")+`
`,null,["textureSampler","depthSampler"]),this._expensiveBlur=i,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r,"IsSupported",{get:function(){var i=t.Engine.LastCreatedEngine;return i?i.getCaps().drawBuffersExtension:!1},enumerable:!0,configurable:!0}),r.prototype.dispose=function(i){i===void 0&&(i=!1);for(var a=0;a<this._scene.cameras.length;a++){var n=this._scene.cameras[a];this._originalColorPostProcess.dispose(n),this._ssaoPostProcess.dispose(n),this._blurHPostProcess.dispose(n),this._blurVPostProcess.dispose(n),this._ssaoCombinePostProcess.dispose(n)}this._randomTexture.dispose(),i&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),c.prototype.dispose.call(this)},r.prototype._createBlurPostProcess=function(i,a){var n=this;this._samplerOffsets=[];for(var s=this.expensiveBlur,o=-8;o<8;o++)this._samplerOffsets.push(o*2+.5);this._blurHPostProcess=new t.PostProcess("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],i,null,t.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_H
#define SAMPLES 16
#define EXPENSIVE `+(s?"1":"0")+`
`),this._blurHPostProcess.onApply=function(l){n._scene.activeCamera&&(l.setFloat("outSize",n._ssaoCombinePostProcess.width>0?n._ssaoCombinePostProcess.width:n._originalColorPostProcess.width),l.setFloat("near",n._scene.activeCamera.minZ),l.setFloat("far",n._scene.activeCamera.maxZ),l.setFloat("radius",n.radius),l.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&l.setArray("samplerOffsets",n._samplerOffsets))},this._blurVPostProcess=new t.PostProcess("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],a,null,t.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,`#define BILATERAL_BLUR
#define BILATERAL_BLUR_V
#define SAMPLES 16
#define EXPENSIVE `+(s?"1":"0")+`
`),this._blurVPostProcess.onApply=function(l){n._scene.activeCamera&&(l.setFloat("outSize",n._ssaoCombinePostProcess.height>0?n._ssaoCombinePostProcess.height:n._originalColorPostProcess.height),l.setFloat("near",n._scene.activeCamera.minZ),l.setFloat("far",n._scene.activeCamera.maxZ),l.setFloat("radius",n.radius),l.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&(l.setArray("samplerOffsets",n._samplerOffsets),n._firstUpdate=!1))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},r.prototype._rebuild=function(){this._firstUpdate=!0,c.prototype._rebuild.call(this)},r.prototype._radicalInverse_VdC=function(i){return this._bits[0]=i,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(this._bits[0]&1431655765)<<1|(this._bits[0]&2863311530)>>>1>>>0,this._bits[0]=(this._bits[0]&858993459)<<2|(this._bits[0]&3435973836)>>>2>>>0,this._bits[0]=(this._bits[0]&252645135)<<4|(this._bits[0]&4042322160)>>>4>>>0,this._bits[0]=(this._bits[0]&16711935)<<8|(this._bits[0]&4278255360)>>>8>>>0,this._bits[0]*23283064365386963e-26},r.prototype._hammersley=function(i,a){return[i/a,this._radicalInverse_VdC(i)]},r.prototype._hemisphereSample_uniform=function(i,a){var n=a*2*Math.PI,s=1-(i*.85+.15),o=Math.sqrt(1-s*s);return new t.Vector3(Math.cos(n)*o,Math.sin(n)*o,s)},r.prototype._generateHemisphere=function(){for(var i=this.samples,a=[],n,s=0;s<i;){if(i<16)n=this._hemisphereSample_uniform(Math.random(),Math.random());else{var o=this._hammersley(s,i);n=this._hemisphereSample_uniform(o[0],o[1])}a.push(n.x,n.y,n.z),s++}return a},r.prototype._createSSAOPostProcess=function(i){var a=this,n=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new t.PostProcess("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+n+`
#define SSAO`),this._ssaoPostProcess.onApply=function(s){a._firstUpdate&&(s.setArray3("sampleSphere",a._sampleSphere),s.setFloat("randTextureTiles",32)),a._scene.activeCamera&&(s.setFloat("samplesFactor",1/a.samples),s.setFloat("totalStrength",a.totalStrength),s.setFloat2("texelSize",1/a._ssaoPostProcess.width,1/a._ssaoPostProcess.height),s.setFloat("radius",a.radius),s.setFloat("maxZ",a.maxZ),s.setFloat("minZAspect",a.minZAspect),s.setFloat("base",a.base),s.setFloat("near",a._scene.activeCamera.minZ),s.setFloat("far",a._scene.activeCamera.maxZ),s.setFloat("xViewport",Math.tan(a._scene.activeCamera.fov/2)*a._scene.getEngine().getAspectRatio(a._scene.activeCamera,!0)),s.setFloat("yViewport",Math.tan(a._scene.activeCamera.fov/2)),s.setMatrix("projection",a._scene.getProjectionMatrix()),s.setTexture("textureSampler",a._depthTexture),s.setTexture("normalSampler",a._normalTexture),s.setTexture("randomSampler",a._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},r.prototype._createSSAOCombinePostProcess=function(i){var a=this;this._ssaoCombinePostProcess=new t.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],i,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(n){var s=a._scene.activeCamera.viewport;n.setVector4("viewport",t.Tmp.Vector4[0].copyFromFloats(s.x,s.y,s.width,s.height)),n.setTextureFromPostProcess("originalColor",a._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},r.prototype._createRandomTexture=function(){var i=128;this._randomTexture=new t.DynamicTexture("SSAORandomTexture",i,this._scene,!1,t.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=t.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=t.Texture.WRAP_ADDRESSMODE;for(var a=this._randomTexture.getContext(),n=function(u,h){return Math.random()*(h-u)+u},s=t.Vector3.Zero(),o=0;o<i;o++)for(var l=0;l<i;l++)s.x=n(0,1),s.y=n(0,1),s.z=0,s.normalize(),s.scaleInPlace(255),s.x=Math.floor(s.x),s.y=Math.floor(s.y),a.fillStyle="rgb("+s.x+", "+s.y+", "+s.z+")",a.fillRect(o,l,1,1);this._randomTexture.update(!1)},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.customType="SSAO2RenderingPipeline",i},r.Parse=function(i,a,n){return t.SerializationHelper.Parse(function(){return new r(i._name,a,i._ratio)},i,a,n)},A([t.serialize()],r.prototype,"totalStrength",void 0),A([t.serialize()],r.prototype,"maxZ",void 0),A([t.serialize()],r.prototype,"minZAspect",void 0),A([t.serialize("samples")],r.prototype,"_samples",void 0),A([t.serialize("textureSamples")],r.prototype,"_textureSamples",void 0),A([t.serialize()],r.prototype,"_ratio",void 0),A([t.serialize("expensiveBlur")],r.prototype,"_expensiveBlur",void 0),A([t.serialize()],r.prototype,"radius",void 0),A([t.serialize()],r.prototype,"base",void 0),r}(t.PostProcessRenderPipeline);t.SSAO2RenderingPipeline=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){s===void 0&&(s=1);var l=c.call(this,n.getEngine(),i)||this;return l.LensChromaticAberrationEffect="LensChromaticAberrationEffect",l.HighlightsEnhancingEffect="HighlightsEnhancingEffect",l.LensDepthOfFieldEffect="LensDepthOfFieldEffect",l._scene=n,l._depthTexture=n.enableDepthRenderer().getDepthMap(),a.grain_texture?l._grainTexture=a.grain_texture:l._createGrainTexture(),l._edgeBlur=a.edge_blur?a.edge_blur:0,l._grainAmount=a.grain_amount?a.grain_amount:0,l._chromaticAberration=a.chromatic_aberration?a.chromatic_aberration:0,l._distortion=a.distortion?a.distortion:0,l._highlightsGain=a.dof_gain!==void 0?a.dof_gain:-1,l._highlightsThreshold=a.dof_threshold?a.dof_threshold:1,l._dofDistance=a.dof_focus_distance!==void 0?a.dof_focus_distance:-1,l._dofAperture=a.dof_aperture?a.dof_aperture:1,l._dofDarken=a.dof_darken?a.dof_darken:0,l._dofPentagon=a.dof_pentagon!==void 0?a.dof_pentagon:!0,l._blurNoise=a.blur_noise!==void 0?a.blur_noise:!0,l._createChromaticAberrationPostProcess(s),l._createHighlightsPostProcess(s),l._createDepthOfFieldPostProcess(s/4),l.addEffect(new t.PostProcessRenderEffect(n.getEngine(),l.LensChromaticAberrationEffect,function(){return l._chromaticAberrationPostProcess},!0)),l.addEffect(new t.PostProcessRenderEffect(n.getEngine(),l.HighlightsEnhancingEffect,function(){return l._highlightsPostProcess},!0)),l.addEffect(new t.PostProcessRenderEffect(n.getEngine(),l.LensDepthOfFieldEffect,function(){return l._depthOfFieldPostProcess},!0)),l._highlightsGain===-1&&l._disableEffect(l.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(l),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o),l}return r.prototype.setEdgeBlur=function(i){this._edgeBlur=i},r.prototype.disableEdgeBlur=function(){this._edgeBlur=0},r.prototype.setGrainAmount=function(i){this._grainAmount=i},r.prototype.disableGrain=function(){this._grainAmount=0},r.prototype.setChromaticAberration=function(i){this._chromaticAberration=i},r.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},r.prototype.setEdgeDistortion=function(i){this._distortion=i},r.prototype.disableEdgeDistortion=function(){this._distortion=0},r.prototype.setFocusDistance=function(i){this._dofDistance=i},r.prototype.disableDepthOfField=function(){this._dofDistance=-1},r.prototype.setAperture=function(i){this._dofAperture=i},r.prototype.setDarkenOutOfFocus=function(i){this._dofDarken=i},r.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect(`#define PENTAGON
`)},r.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},r.prototype.enableNoiseBlur=function(){this._blurNoise=!0},r.prototype.disableNoiseBlur=function(){this._blurNoise=!1},r.prototype.setHighlightsGain=function(i){this._highlightsGain=i},r.prototype.setHighlightsThreshold=function(i){this._highlightsGain===-1&&(this._highlightsGain=1),this._highlightsThreshold=i},r.prototype.disableHighlights=function(){this._highlightsGain=-1},r.prototype.dispose=function(i){i===void 0&&(i=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),i&&this._scene.disableDepthRenderer()},r.prototype._createChromaticAberrationPostProcess=function(i){var a=this;this._chromaticAberrationPostProcess=new t.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],i,null,t.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(n){n.setFloat("chromatic_aberration",a._chromaticAberration),n.setFloat("screen_width",a._scene.getEngine().getRenderWidth()),n.setFloat("screen_height",a._scene.getEngine().getRenderHeight()),n.setFloat("radialIntensity",1),n.setFloat2("direction",17,17),n.setFloat2("centerPosition",.5,.5)}},r.prototype._createHighlightsPostProcess=function(i){var a=this;this._highlightsPostProcess=new t.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],i,null,t.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?`#define PENTAGON
`:""),this._highlightsPostProcess.onApply=function(n){n.setFloat("gain",a._highlightsGain),n.setFloat("threshold",a._highlightsThreshold),n.setTextureFromPostProcess("textureSampler",a._chromaticAberrationPostProcess),n.setFloat("screen_width",a._scene.getEngine().getRenderWidth()),n.setFloat("screen_height",a._scene.getEngine().getRenderHeight())}},r.prototype._createDepthOfFieldPostProcess=function(i){var a=this;this._depthOfFieldPostProcess=new t.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],i,null,t.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(n){n.setTexture("depthSampler",a._depthTexture),n.setTexture("grainSampler",a._grainTexture),n.setTextureFromPostProcess("textureSampler",a._highlightsPostProcess),n.setTextureFromPostProcess("highlightsSampler",a._depthOfFieldPostProcess),n.setFloat("grain_amount",a._grainAmount),n.setBool("blur_noise",a._blurNoise),n.setFloat("screen_width",a._scene.getEngine().getRenderWidth()),n.setFloat("screen_height",a._scene.getEngine().getRenderHeight()),n.setFloat("distortion",a._distortion),n.setBool("dof_enabled",a._dofDistance!==-1),n.setFloat("screen_distance",1/(.1-1/a._dofDistance)),n.setFloat("aperture",a._dofAperture),n.setFloat("darken",a._dofDarken),n.setFloat("edge_blur",a._edgeBlur),n.setBool("highlights",a._highlightsGain!==-1),a._scene.activeCamera&&(n.setFloat("near",a._scene.activeCamera.minZ),n.setFloat("far",a._scene.activeCamera.maxZ))}},r.prototype._createGrainTexture=function(){var i=512;this._grainTexture=new t.DynamicTexture("LensNoiseTexture",i,this._scene,!1,t.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=t.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=t.Texture.WRAP_ADDRESSMODE;for(var a=this._grainTexture.getContext(),n=function(u,h){return Math.random()*(h-u)+u},s,o=0;o<i;o++)for(var l=0;l<i;l++)s=Math.floor(n(.42,.58)*255),a.fillStyle="rgb("+s+", "+s+", "+s+")",a.fillRect(o,l,1,1);this._grainTexture.update(!1)},r}(t.PostProcessRenderPipeline);t.LensRenderingPipeline=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){s===void 0&&(s=null);var l=c.call(this,a.getEngine(),i)||this;return l.downSampleX4PostProcess=null,l.brightPassPostProcess=null,l.blurHPostProcesses=[],l.blurVPostProcesses=[],l.textureAdderPostProcess=null,l.volumetricLightPostProcess=null,l.volumetricLightSmoothXPostProcess=null,l.volumetricLightSmoothYPostProcess=null,l.volumetricLightMergePostProces=null,l.volumetricLightFinalPostProcess=null,l.luminancePostProcess=null,l.luminanceDownSamplePostProcesses=[],l.hdrPostProcess=null,l.textureAdderFinalPostProcess=null,l.lensFlareFinalPostProcess=null,l.hdrFinalPostProcess=null,l.lensFlarePostProcess=null,l.lensFlareComposePostProcess=null,l.motionBlurPostProcess=null,l.depthOfFieldPostProcess=null,l.fxaaPostProcess=null,l.brightThreshold=1,l.blurWidth=512,l.horizontalBlur=!1,l.exposure=1,l.lensTexture=null,l.volumetricLightCoefficient=.2,l.volumetricLightPower=4,l.volumetricLightBlurScale=64,l.sourceLight=null,l.hdrMinimumLuminance=1,l.hdrDecreaseRate=.5,l.hdrIncreaseRate=.5,l.lensColorTexture=null,l.lensFlareStrength=20,l.lensFlareGhostDispersal=1.4,l.lensFlareHaloWidth=.7,l.lensFlareDistortionStrength=16,l.lensStarTexture=null,l.lensFlareDirtTexture=null,l.depthOfFieldDistance=10,l.depthOfFieldBlurWidth=64,l.motionStrength=1,l.animations=[],l._currentDepthOfFieldSource=null,l._hdrCurrentLuminance=1,l._bloomEnabled=!1,l._depthOfFieldEnabled=!1,l._vlsEnabled=!1,l._lensFlareEnabled=!1,l._hdrEnabled=!1,l._motionBlurEnabled=!1,l._fxaaEnabled=!1,l._motionBlurSamples=64,l._volumetricLightStepsCount=50,l._samples=1,l._cameras=o||[],l._scene=a,l._basePostProcess=s,l._ratio=n,l._floatTextureType=a.getEngine().getCaps().textureFloatRender?t.Engine.TEXTURETYPE_FLOAT:t.Engine.TEXTURETYPE_HALF_FLOAT,a.postProcessRenderPipelineManager.addPipeline(l),l._buildPipeline(),l}return Object.defineProperty(r.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(i){this._bloomEnabled!==i&&(this._bloomEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(i){this._depthOfFieldEnabled!==i&&(this._depthOfFieldEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(i){this._lensFlareEnabled!==i&&(this._lensFlareEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(i){this._hdrEnabled!==i&&(this._hdrEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(i){if(this._vlsEnabled!==i){if(i){var a=this._scene.enableGeometryBufferRenderer();if(!a){t.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");return}}this._vlsEnabled=i,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(i){this._motionBlurEnabled!==i&&(this._motionBlurEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(i){this._fxaaEnabled!==i&&(this._fxaaEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(i){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect(`#define VLS
#define NB_STEPS `+i.toFixed(1)),this._volumetricLightStepsCount=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(i){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect(`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+i.toFixed(1)),this._motionBlurSamples=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"samples",{get:function(){return this._samples},set:function(i){this._samples!==i&&(this._samples=i,this._buildPipeline())},enumerable:!0,configurable:!0}),r.prototype._buildPipeline=function(){var i=this,a=this._ratio,n=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new t.PostProcess("HDRPass","standard",[],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(s){i._currentDepthOfFieldSource=i.originalPostProcess}),(this._bloomEnabled||this._vlsEnabled||this._lensFlareEnabled||this._depthOfFieldEnabled||this._motionBlurEnabled)&&this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRPassPostProcess",function(){return i.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._bloomEnabled&&(this._createDownSampleX4PostProcess(n,a/2),this._createBrightPassPostProcess(n,a/2),this._createBlurPostProcesses(n,a/4,1),this._createTextureAdderPostProcess(n,a),this.textureAdderFinalPostProcess=new t.PostProcess("HDRDepthOfFieldSource","standard",[],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRBaseDepthOfFieldSource",function(){return i.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(n,a),this.volumetricLightFinalPostProcess=new t.PostProcess("HDRVLSFinal","standard",[],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRVLSFinal",function(){return i.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(n,a),this.lensFlareFinalPostProcess=new t.PostProcess("HDRPostLensFlareDepthOfFieldSource","standard",[],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return i.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(n,this._floatTextureType),this._createHdrPostProcess(n,a),this.hdrFinalPostProcess=new t.PostProcess("HDRPostHDReDepthOfFieldSource","standard",[],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return i.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(n,a/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(n,a)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(n,a),this._fxaaEnabled&&(this.fxaaPostProcess=new t.FxaaPostProcess("fxaa",1,null,t.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(n.getEngine(),"HDRFxaa",function(){return i.fxaaPostProcess},!0))),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&t.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},r.prototype._createDownSampleX4PostProcess=function(i,a){var n=this,s=new Array(32);this.downSampleX4PostProcess=new t.PostProcess("HDRDownSampleX4","standard",["dsOffsets"],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define DOWN_SAMPLE_X4",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(o){for(var l=0,u=n.downSampleX4PostProcess.width,h=n.downSampleX4PostProcess.height,d=-2;d<2;d++)for(var p=-2;p<2;p++)s[l]=(d+.5)*(1/u),s[l+1]=(p+.5)*(1/h),l+=2;o.setArray2("dsOffsets",s)},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRDownSampleX4",function(){return n.downSampleX4PostProcess},!0))},r.prototype._createBrightPassPostProcess=function(i,a){var n=this,s=new Array(8);this.brightPassPostProcess=new t.PostProcess("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define BRIGHT_PASS",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(o){var l=1/n.brightPassPostProcess.width,u=1/n.brightPassPostProcess.height;s[0]=-.5*l,s[1]=.5*u,s[2]=.5*l,s[3]=.5*u,s[4]=-.5*l,s[5]=-.5*u,s[6]=.5*l,s[7]=-.5*u,o.setArray2("dsOffsets",s),o.setFloat("brightThreshold",n.brightThreshold)},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRBrightPass",function(){return n.brightPassPostProcess},!0))},r.prototype._createBlurPostProcesses=function(i,a,n,s){var o=this;s===void 0&&(s="blurWidth");var l=i.getEngine(),u=new t.BlurPostProcess("HDRBlurH_"+n,new t.Vector2(1,0),this[s],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,t.Engine.TEXTURETYPE_UNSIGNED_INT),h=new t.BlurPostProcess("HDRBlurV_"+n,new t.Vector2(0,1),this[s],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,t.Engine.TEXTURETYPE_UNSIGNED_INT);u.onActivateObservable.add(function(){var d=u.width/l.getRenderWidth();u.kernel=o[s]*d}),h.onActivateObservable.add(function(){var d=h.height/l.getRenderHeight();h.kernel=o.horizontalBlur?64*d:o[s]*d}),this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRBlurH"+n,function(){return u},!0)),this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRBlurV"+n,function(){return h},!0)),this.blurHPostProcesses.push(u),this.blurVPostProcesses.push(h)},r.prototype._createTextureAdderPostProcess=function(i,a){var n=this;this.textureAdderPostProcess=new t.PostProcess("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define TEXTURE_ADDER",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(s){s.setTextureFromPostProcess("otherSampler",n._vlsEnabled?n._currentDepthOfFieldSource:n.originalPostProcess),s.setTexture("lensSampler",n.lensTexture),s.setFloat("exposure",n.exposure),n._currentDepthOfFieldSource=n.textureAdderFinalPostProcess},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRTextureAdder",function(){return n.textureAdderPostProcess},!0))},r.prototype._createVolumetricLightPostProcess=function(i,a){var n=this,s=i.enableGeometryBufferRenderer();s.enablePosition=!0;var o=s.getGBuffer();this.volumetricLightPostProcess=new t.PostProcess("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],a/8,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,`#define VLS
#define NB_STEPS `+this._volumetricLightStepsCount.toFixed(1));var l=t.Vector2.Zero();this.volumetricLightPostProcess.onApply=function(u){if(n.sourceLight&&n.sourceLight.getShadowGenerator()&&n._scene.activeCamera){var h=n.sourceLight.getShadowGenerator();u.setTexture("shadowMapSampler",h.getShadowMap()),u.setTexture("positionSampler",o.textures[2]),u.setColor3("sunColor",n.sourceLight.diffuse),u.setVector3("sunDirection",n.sourceLight.getShadowDirection()),u.setVector3("cameraPosition",n._scene.activeCamera.globalPosition),u.setMatrix("shadowViewProjection",h.getTransformMatrix()),u.setFloat("scatteringCoefficient",n.volumetricLightCoefficient),u.setFloat("scatteringPower",n.volumetricLightPower),l.x=n.sourceLight.getDepthMinZ(n._scene.activeCamera),l.y=n.sourceLight.getDepthMaxZ(n._scene.activeCamera),u.setVector2("depthValues",l)}},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRVLS",function(){return n.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(i,a/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new t.PostProcess("HDRVLSMerge","standard",[],["originalSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(u){u.setTextureFromPostProcess("originalSampler",n._bloomEnabled?n.textureAdderFinalPostProcess:n.originalPostProcess),n._currentDepthOfFieldSource=n.volumetricLightFinalPostProcess},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRVLSMerge",function(){return n.volumetricLightMergePostProces},!0))},r.prototype._createLuminancePostProcesses=function(i,a){var n=this,s=Math.pow(3,r.LuminanceSteps);this.luminancePostProcess=new t.PostProcess("HDRLuminance","standard",["lumOffsets"],[],{width:s,height:s},null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define LUMINANCE",a);var o=[];this.luminancePostProcess.onApply=function(p){var m=1/n.luminancePostProcess.width,_=1/n.luminancePostProcess.height;o[0]=-.5*m,o[1]=.5*_,o[2]=.5*m,o[3]=.5*_,o[4]=-.5*m,o[5]=-.5*_,o[6]=.5*m,o[7]=-.5*_,p.setArray2("lumOffsets",o)},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRLuminance",function(){return n.luminancePostProcess},!0));for(var l=r.LuminanceSteps-1;l>=0;l--){var s=Math.pow(3,l),u=`#define LUMINANCE_DOWN_SAMPLE
`;l===0&&(u+="#define FINAL_DOWN_SAMPLER");var h=new t.PostProcess("HDRLuminanceDownSample"+l,"standard",["dsOffsets","halfDestPixelSize"],[],{width:s,height:s},null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,u,a);this.luminanceDownSamplePostProcesses.push(h)}var d=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(p,m){var _=new Array(18);p.onApply=function(v){if(d){for(var S=0,P=-1;P<2;P++)for(var x=-1;x<2;x++)_[S]=P/d.width,_[S+1]=x/d.height,S+=2;v.setArray2("dsOffsets",_),v.setFloat("halfDestPixelSize",.5/d.width),m===n.luminanceDownSamplePostProcesses.length-1?d=n.luminancePostProcess:d=p}},m===n.luminanceDownSamplePostProcesses.length-1&&(p.onAfterRender=function(v){var S=i.getEngine().readPixels(0,0,1,1),P=new t.Vector4(1/(255*255*255),1/(255*255),1/255,1);n._hdrCurrentLuminance=(S[0]*P.x+S[1]*P.y+S[2]*P.z+S[3]*P.w)/100}),n.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRLuminanceDownSample"+m,function(){return p},!0))})},r.prototype._createHdrPostProcess=function(i,a){var n=this;this.hdrPostProcess=new t.PostProcess("HDR","standard",["averageLuminance"],["textureAdderSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define HDR",t.Engine.TEXTURETYPE_UNSIGNED_INT);var s=1,o=0,l=0;this.hdrPostProcess.onApply=function(u){if(u.setTextureFromPostProcess("textureAdderSampler",n._currentDepthOfFieldSource),o+=i.getEngine().getDeltaTime(),s<0)s=n._hdrCurrentLuminance;else{var h=(l-o)/1e3;n._hdrCurrentLuminance<s+n.hdrDecreaseRate*h?s+=n.hdrDecreaseRate*h:n._hdrCurrentLuminance>s-n.hdrIncreaseRate*h?s-=n.hdrIncreaseRate*h:s=n._hdrCurrentLuminance}s=t.Scalar.Clamp(s,n.hdrMinimumLuminance,1e20),u.setFloat("averageLuminance",s),l=o,n._currentDepthOfFieldSource=n.hdrFinalPostProcess},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDR",function(){return n.hdrPostProcess},!0))},r.prototype._createLensFlarePostProcess=function(i,a){var n=this;this.lensFlarePostProcess=new t.PostProcess("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],a/2,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define LENS_FLARE",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRLensFlare",function(){return n.lensFlarePostProcess},!0)),this._createBlurPostProcesses(i,a/4,2),this.lensFlareComposePostProcess=new t.PostProcess("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define LENS_FLARE_COMPOSE",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRLensFlareCompose",function(){return n.lensFlareComposePostProcess},!0));var s=new t.Vector2(0,0);this.lensFlarePostProcess.onApply=function(u){u.setTextureFromPostProcess("textureSampler",n._bloomEnabled?n.blurHPostProcesses[0]:n.originalPostProcess),u.setTexture("lensColorSampler",n.lensColorTexture),u.setFloat("strength",n.lensFlareStrength),u.setFloat("ghostDispersal",n.lensFlareGhostDispersal),u.setFloat("haloWidth",n.lensFlareHaloWidth),s.x=n.lensFlarePostProcess.width,s.y=n.lensFlarePostProcess.height,u.setVector2("resolution",s),u.setFloat("distortionStrength",n.lensFlareDistortionStrength)};var o=t.Matrix.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),l=t.Matrix.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(u){if(n._scene.activeCamera){u.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),u.setTexture("lensDirtSampler",n.lensFlareDirtTexture),u.setTexture("lensStarSampler",n.lensStarTexture);var h=n._scene.activeCamera.getViewMatrix().getRow(0),d=n._scene.activeCamera.getViewMatrix().getRow(2),p=t.Vector3.Dot(h.toVector3(),new t.Vector3(1,0,0))+t.Vector3.Dot(d.toVector3(),new t.Vector3(0,0,1));p*=4;var m=t.Matrix.FromValues(Math.cos(p)*.5,-Math.sin(p),0,0,Math.sin(p),Math.cos(p)*.5,0,0,0,0,1,0,0,0,0,1),_=l.multiply(m).multiply(o);u.setMatrix("lensStarMatrix",_),n._currentDepthOfFieldSource=n.lensFlareFinalPostProcess}}},r.prototype._createDepthOfFieldPostProcess=function(i,a){var n=this;this.depthOfFieldPostProcess=new t.PostProcess("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,"#define DEPTH_OF_FIELD",t.Engine.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(s){s.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),s.setTexture("depthSampler",n._getDepthTexture()),s.setFloat("distance",n.depthOfFieldDistance)},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRDepthOfField",function(){return n.depthOfFieldPostProcess},!0))},r.prototype._createMotionBlurPostProcess=function(i,a){var n=this;this.motionBlurPostProcess=new t.PostProcess("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,`#define MOTION_BLUR
#define MAX_MOTION_SAMPLES `+this.motionBlurSamples.toFixed(1),t.Engine.TEXTURETYPE_UNSIGNED_INT);var s=0,o=t.Matrix.Identity(),l=t.Matrix.Identity(),u=t.Matrix.Identity(),h=t.Vector2.Zero();this.motionBlurPostProcess.onApply=function(d){u=i.getProjectionMatrix().multiply(i.getViewMatrix()),u.invertToRef(l),d.setMatrix("inverseViewProjection",l),d.setMatrix("prevViewProjection",o),o=u,h.x=n.motionBlurPostProcess.width,h.y=n.motionBlurPostProcess.height,d.setVector2("screenSize",h),s=i.getEngine().getFps()/60,d.setFloat("motionScale",s),d.setFloat("motionStrength",n.motionStrength),d.setTexture("depthSampler",n._getDepthTexture())},this.addEffect(new t.PostProcessRenderEffect(i.getEngine(),"HDRMotionBlur",function(){return n.motionBlurPostProcess},!0))},r.prototype._getDepthTexture=function(){if(this._scene.getEngine().getCaps().drawBuffersExtension){var i=this._scene.enableGeometryBufferRenderer();return i.getGBuffer().textures[0]}return this._scene.enableDepthRenderer().getDepthMap()},r.prototype._disposePostProcesses=function(){for(var i=0;i<this._cameras.length;i++){var a=this._cameras[i];this.originalPostProcess&&this.originalPostProcess.dispose(a),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(a),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(a),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(a),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(a),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(a),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(a),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(a),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(a),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(a),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(a),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(a);for(var n=0;n<this.luminanceDownSamplePostProcesses.length;n++)this.luminanceDownSamplePostProcesses[n].dispose(a);this.luminancePostProcess&&this.luminancePostProcess.dispose(a),this.hdrPostProcess&&this.hdrPostProcess.dispose(a),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(a),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(a),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(a),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(a);for(var n=0;n<this.blurHPostProcesses.length;n++)this.blurHPostProcesses[n].dispose(a);for(var n=0;n<this.blurVPostProcesses.length;n++)this.blurVPostProcesses[n].dispose(a)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},r.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),c.prototype.dispose.call(this)},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return this.sourceLight&&(i.sourceLightId=this.sourceLight.id),i.customType="StandardRenderingPipeline",i},r.Parse=function(i,a,n){var s=t.SerializationHelper.Parse(function(){return new r(i._name,a,i._ratio)},i,a,n);return i.sourceLightId&&(s.sourceLight=a.getLightByID(i.sourceLightId)),s},r.LuminanceSteps=6,A([t.serialize()],r.prototype,"brightThreshold",void 0),A([t.serialize()],r.prototype,"blurWidth",void 0),A([t.serialize()],r.prototype,"horizontalBlur",void 0),A([t.serialize()],r.prototype,"exposure",void 0),A([t.serializeAsTexture("lensTexture")],r.prototype,"lensTexture",void 0),A([t.serialize()],r.prototype,"volumetricLightCoefficient",void 0),A([t.serialize()],r.prototype,"volumetricLightPower",void 0),A([t.serialize()],r.prototype,"volumetricLightBlurScale",void 0),A([t.serialize()],r.prototype,"hdrMinimumLuminance",void 0),A([t.serialize()],r.prototype,"hdrDecreaseRate",void 0),A([t.serialize()],r.prototype,"hdrIncreaseRate",void 0),A([t.serializeAsTexture("lensColorTexture")],r.prototype,"lensColorTexture",void 0),A([t.serialize()],r.prototype,"lensFlareStrength",void 0),A([t.serialize()],r.prototype,"lensFlareGhostDispersal",void 0),A([t.serialize()],r.prototype,"lensFlareHaloWidth",void 0),A([t.serialize()],r.prototype,"lensFlareDistortionStrength",void 0),A([t.serializeAsTexture("lensStarTexture")],r.prototype,"lensStarTexture",void 0),A([t.serializeAsTexture("lensFlareDirtTexture")],r.prototype,"lensFlareDirtTexture",void 0),A([t.serialize()],r.prototype,"depthOfFieldDistance",void 0),A([t.serialize()],r.prototype,"depthOfFieldBlurWidth",void 0),A([t.serialize()],r.prototype,"motionStrength",void 0),A([t.serialize()],r.prototype,"_ratio",void 0),A([t.serialize()],r.prototype,"BloomEnabled",null),A([t.serialize()],r.prototype,"DepthOfFieldEnabled",null),A([t.serialize()],r.prototype,"LensFlareEnabled",null),A([t.serialize()],r.prototype,"HDREnabled",null),A([t.serialize()],r.prototype,"VLSEnabled",null),A([t.serialize()],r.prototype,"MotionBlurEnabled",null),A([t.serialize()],r.prototype,"fxaaEnabled",null),A([t.serialize()],r.prototype,"volumetricLightStepsCount",null),A([t.serialize()],r.prototype,"motionBlurSamples",null),A([t.serialize()],r.prototype,"samples",null),r}(t.PostProcessRenderPipeline);t.StandardRenderingPipeline=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){n===void 0&&(n=null),u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT);var h=c.call(this,i,"fxaa",["texelSize"],null,a,n,s||t.Texture.BILINEAR_SAMPLINGMODE,o,l,null,u,"fxaa",void 0,!0)||this,d=h._getDefines();return h.updateEffect(d),h.onApplyObservable.add(function(p){var m=h.texelSize;p.setFloat2("texelSize",m.x,m.y)}),h}return r.prototype._getDefines=function(){var i=this.getEngine();if(!i)return null;var a=i.getGlInfo();return a&&a.renderer&&a.renderer.toLowerCase().indexOf("mali")>-1?`#define MALI 1
`:null},r}(t.PostProcess);t.FxaaPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p){d===void 0&&(d=t.Engine.TEXTURETYPE_UNSIGNED_INT),p===void 0&&(p=!1);var m=c.call(this,i,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],s,o,l,u,h,null,d,void 0,null,p)||this;return m.aberrationAmount=30,m.radialIntensity=0,m.direction=new t.Vector2(.707,.707),m.centerPosition=new t.Vector2(.5,.5),m.onApplyObservable.add(function(_){_.setFloat("chromatic_aberration",m.aberrationAmount),_.setFloat("screen_width",a),_.setFloat("screen_height",n),_.setFloat("radialIntensity",m.radialIntensity),_.setFloat2("direction",m.direction.x,m.direction.y),_.setFloat2("centerPosition",m.centerPosition.x,m.centerPosition.y)}),m}return r}(t.PostProcess);t.ChromaticAberrationPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=!1);var d=c.call(this,i,"grain",["intensity","animatedSeed"],[],a,n,s,o,l,null,u,void 0,null,h)||this;return d.intensity=30,d.animated=!1,d.onApplyObservable.add(function(p){p.setFloat("intensity",d.intensity),p.setFloat("animatedSeed",d.animated?Math.random()+1:1)}),d}return r}(t.PostProcess);t.GrainPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=!1);var d=c.call(this,i,"sharpen",["sharpnessAmounts","screenSize"],null,a,n,s,o,l,null,u,void 0,null,h)||this;return d.colorAmount=1,d.edgeAmount=.3,d.onApply=function(p){p.setFloat2("screenSize",d.width,d.height),p.setFloat2("sharpnessAmounts",d.edgeAmount,d.colorAmount)},d}return r}(t.PostProcess);t.SharpenPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p,m){l===void 0&&(l=t.Texture.BILINEAR_SAMPLINGMODE),d===void 0&&(d=t.Engine.TEXTURETYPE_UNSIGNED_INT),p===void 0&&(p=""),m===void 0&&(m=!1);var _=c.call(this,i,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],s,o,l,u,h,null,d,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return _.direction=a,_.blockCompilation=m,_._packedFloat=!1,_._staticDefines="",_._staticDefines=p,_.onApplyObservable.add(function(v){_._outputTexture?v.setFloat2("delta",1/_._outputTexture.width*_.direction.x,1/_._outputTexture.height*_.direction.y):v.setFloat2("delta",1/_.width*_.direction.x,1/_.height*_.direction.y)}),_.kernel=n,_}return Object.defineProperty(r.prototype,"kernel",{get:function(){return this._idealKernel},set:function(i){this._idealKernel!==i&&(i=Math.max(i,1),this._idealKernel=i,this._kernel=this._nearestBestKernel(i),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(i){this._packedFloat!==i&&(this._packedFloat=i,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),r.prototype.updateEffect=function(i,a,n,s,o,l){i===void 0&&(i=null),a===void 0&&(a=null),n===void 0&&(n=null),this._updateParameters(o,l)},r.prototype._updateParameters=function(i,a){for(var n=this._kernel,s=(n-1)/2,o=[],l=[],u=0,h=0;h<n;h++){var d=h/(n-1),p=this._gaussianWeight(d*2-1);o[h]=h-s,l[h]=p,u+=p}for(var h=0;h<l.length;h++)l[h]/=u;for(var m=[],_=[],v=[],h=0;h<=s;h+=2){var S=Math.min(h+1,Math.floor(s)),P=h===S;if(P)v.push({o:o[h],w:l[h]});else{var x=S===s,R=l[h]+l[S]*(x?.5:1),w=o[h]+1/(1+l[h]/l[S]);w===0?(v.push({o:o[h],w:l[h]}),v.push({o:o[h+1],w:l[h+1]})):(v.push({o:w,w:R}),v.push({o:-w,w:R}))}}for(var h=0;h<v.length;h++)_[h]=v[h].o,m[h]=v[h].w;o=_,l=m;var I=this.getEngine().getCaps().maxVaryingVectors,F=Math.max(I,0)-1,k=Math.min(o.length,F),E="";E+=this._staticDefines,this._staticDefines.indexOf("DOF")!=-1&&(E+="#define CENTER_WEIGHT "+this._glslFloat(l[k-1])+`\r
`,k--);for(var h=0;h<k;h++)E+="#define KERNEL_OFFSET"+h+" "+this._glslFloat(o[h])+`\r
`,E+="#define KERNEL_WEIGHT"+h+" "+this._glslFloat(l[h])+`\r
`;for(var g=0,h=F;h<o.length;h++)E+="#define KERNEL_DEP_OFFSET"+g+" "+this._glslFloat(o[h])+`\r
`,E+="#define KERNEL_DEP_WEIGHT"+g+" "+this._glslFloat(l[h])+`\r
`,g++;this.packedFloat&&(E+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,c.prototype.updateEffect.call(this,E,null,null,{varyingCount:k,depCount:g},i,a)},r.prototype._nearestBestKernel=function(i){for(var a=Math.round(i),n=0,s=[a,a-1,a+1,a-2,a+2];n<s.length;n++){var o=s[n];if(o%2!==0&&Math.floor(o/2)%2===0&&o>0)return Math.max(o,3)}return Math.max(a,3)},r.prototype._gaussianWeight=function(i){var a=.3333333333333333,n=Math.sqrt(2*Math.PI)*a,s=-(i*i/(2*a*a)),o=1/n*Math.exp(s);return o},r.prototype._glslFloat=function(i,a){return a===void 0&&(a=8),i.toFixed(a).replace(/0+$/,"")},r}(t.PostProcess);t.BlurPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p,m,_,v){h===void 0&&(h=null),d===void 0&&(d=t.Texture.BILINEAR_SAMPLINGMODE),_===void 0&&(_=t.Engine.TEXTURETYPE_UNSIGNED_INT),v===void 0&&(v=!1);var S=c.call(this,i,n,s,o,l,d=t.Texture.BILINEAR_SAMPLINGMODE,p,m,_=t.Engine.TEXTURETYPE_UNSIGNED_INT,`#define DOF 1\r
`,v)||this;return S.direction=n,S.onApplyObservable.add(function(P){h!=null&&P.setTextureFromPostProcess("textureSampler",h),P.setTextureFromPostProcessOutput("circleOfConfusionSampler",u),a.activeCamera&&P.setFloat2("cameraMinMaxZ",a.activeCamera.minZ,a.activeCamera.maxZ)}),S}return r}(t.BlurPostProcess);t.DepthOfFieldBlurPostProcess=f})(T||(T={}));var T;(function(t){var f=function(){function r(){}return r}();t.DepthOfFieldMergePostProcessOptions=f;var c=function(r){N(i,r);function i(a,n,s,o,l,u,h,d,p,m,_){m===void 0&&(m=t.Engine.TEXTURETYPE_UNSIGNED_INT),_===void 0&&(_=!1);var v=r.call(this,a,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],l,u,h,d,p,null,m,void 0,null,!0)||this;return v.blurSteps=o,v.onApplyObservable.add(function(S){S.setTextureFromPostProcess("textureSampler",n),S.setTextureFromPostProcessOutput("circleOfConfusionSampler",s),o.forEach(function(P,x){S.setTextureFromPostProcessOutput("blurStep"+(o.length-x-1),P)})}),_||v.updateEffect(),v}return i.prototype.updateEffect=function(a,n,s,o,l,u){a===void 0&&(a=null),n===void 0&&(n=null),s===void 0&&(s=null),a||(a="",a+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+`
`),r.prototype.updateEffect.call(this,a,n,s,o,l,u)},i}(t.PostProcess);t.DepthOfFieldMergePostProcess=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d){h===void 0&&(h=t.Engine.TEXTURETYPE_UNSIGNED_INT),d===void 0&&(d=!1);var p=c.call(this,i,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],n,s,o,l,u,null,h,void 0,null,d)||this;return p.lensSize=50,p.fStop=1.4,p.focusDistance=2e3,p.focalLength=50,p._depthTexture=null,p._depthTexture=a,p.onApplyObservable.add(function(m){if(!p._depthTexture){t.Tools.Warn("No depth texture set on CircleOfConfusionPostProcess");return}m.setTexture("depthSampler",p._depthTexture);var _=p.lensSize/p.fStop,v=_*p.focalLength/(p.focusDistance-p.focalLength);m.setFloat("focusDistance",p.focusDistance),m.setFloat("cocPrecalculation",v),m.setFloat2("cameraMinMaxZ",p._depthTexture.activeCamera.minZ,p._depthTexture.activeCamera.maxZ)}),p}return Object.defineProperty(r.prototype,"depthTexture",{set:function(i){this._depthTexture=i},enumerable:!0,configurable:!0}),r}(t.PostProcess);t.CircleOfConfusionPostProcess=f})(T||(T={}));var T;(function(t){var f;(function(r){r[r.Low=0]="Low",r[r.Medium=1]="Medium",r[r.High=2]="High"})(f=t.DepthOfFieldEffectBlurLevel||(t.DepthOfFieldEffectBlurLevel={}));var c=function(r){N(i,r);function i(a,n,s,o,l){s===void 0&&(s=f.Low),o===void 0&&(o=0),l===void 0&&(l=!1);var u=r.call(this,a.getEngine(),"depth of field",function(){return u._effects},!0)||this;u._effects=[],u._circleOfConfusion=new t.CircleOfConfusionPostProcess("circleOfConfusion",n,1,null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,o,l),u._depthOfFieldBlurY=[],u._depthOfFieldBlurX=[];var h=1,d=15;switch(s){case f.High:{h=3,d=51;break}case f.Medium:{h=2,d=31;break}default:{d=15,h=1;break}}for(var p=d/Math.pow(2,h-1),m=1,_=0;_<h;_++){var v=new t.DepthOfFieldBlurPostProcess("verticle blur",a,new t.Vector2(0,1),p,m,null,u._circleOfConfusion,_==0?u._circleOfConfusion:null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,o,l);v.autoClear=!1,m=.75/Math.pow(2,_);var S=new t.DepthOfFieldBlurPostProcess("horizontal blur",a,new t.Vector2(1,0),p,m,null,u._circleOfConfusion,null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,o,l);S.autoClear=!1,u._depthOfFieldBlurY.push(v),u._depthOfFieldBlurX.push(S)}u._effects=[u._circleOfConfusion];for(var _=0;_<u._depthOfFieldBlurX.length;_++)u._effects.push(u._depthOfFieldBlurY[_]),u._effects.push(u._depthOfFieldBlurX[_]);return u._dofMerge=new t.DepthOfFieldMergePostProcess("dofMerge",u._circleOfConfusion,u._circleOfConfusion,u._depthOfFieldBlurX,m,null,t.Texture.BILINEAR_SAMPLINGMODE,a.getEngine(),!1,o,l),u._dofMerge.autoClear=!1,u._effects.push(u._dofMerge),u}return Object.defineProperty(i.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(a){this._circleOfConfusion.focalLength=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(a){this._circleOfConfusion.fStop=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(a){this._circleOfConfusion.focusDistance=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(a){this._circleOfConfusion.lensSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depthTexture",{set:function(a){this._circleOfConfusion.depthTexture=a},enumerable:!0,configurable:!0}),i.prototype.disposeEffects=function(a){for(var n=0;n<this._effects.length;n++)this._effects[n].dispose(a)},i.prototype._updateEffects=function(){for(var a=0;a<this._effects.length;a++)this._effects[a].updateEffect()},i.prototype._isReady=function(){for(var a=0;a<this._effects.length;a++)if(!this._effects[a].isReady())return!1;return!0},i}(t.PostProcessRenderEffect);t.DepthOfFieldEffect=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p,m){p===void 0&&(p=t.Engine.TEXTURETYPE_UNSIGNED_INT),m===void 0&&(m=!1);var _=c.call(this,i,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],o,l,u,h,d,null,p,void 0,null,!0)||this;return _.weight=s,_.onApplyObservable.add(function(v){v.setTextureFromPostProcess("textureSampler",a),v.setTextureFromPostProcessOutput("bloomBlur",n),v.setFloat("bloomWeight",_.weight)}),m||_.updateEffect(),_}return r}(t.PostProcess);t.BloomMergePostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT),h===void 0&&(h=!1);var d=c.call(this,i,"extractHighlights",["threshold","exposure"],null,a,n,s,o,l,null,u,void 0,null,h)||this;return d.threshold=.9,d._exposure=1,d._inputPostProcess=null,d.onApplyObservable.add(function(p){d._inputPostProcess&&p.setTextureFromPostProcess("textureSampler",d._inputPostProcess),p.setFloat("threshold",Math.pow(d.threshold,t.ToGammaSpace)),p.setFloat("exposure",d._exposure)}),d}return r}(t.PostProcess);t.ExtractHighlightsPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){o===void 0&&(o=0),l===void 0&&(l=!1);var u=c.call(this,i.getEngine(),"bloom",function(){return u._effects},!0)||this;return u.bloomScale=a,u._effects=[],u._downscale=new t.ExtractHighlightsPostProcess("highlights",1,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,l),u._blurX=new t.BlurPostProcess("horizontal blur",new t.Vector2(1,0),10,a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,void 0,l),u._blurX.alwaysForcePOT=!0,u._blurX.autoClear=!1,u._blurY=new t.BlurPostProcess("vertical blur",new t.Vector2(0,1),10,a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,void 0,l),u._blurY.alwaysForcePOT=!0,u._blurY.autoClear=!1,u.kernel=s,u._effects=[u._downscale,u._blurX,u._blurY],u._merge=new t.BloomMergePostProcess("bloomMerge",u._downscale,u._blurY,n,a,null,t.Texture.BILINEAR_SAMPLINGMODE,i.getEngine(),!1,o,l),u._merge.autoClear=!1,u._effects.push(u._merge),u}return Object.defineProperty(r.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(i){this._downscale.threshold=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weight",{get:function(){return this._merge.weight},set:function(i){this._merge.weight=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(i){this._blurX.kernel=i*this.bloomScale,this._blurY.kernel=i*this.bloomScale},enumerable:!0,configurable:!0}),r.prototype.disposeEffects=function(i){for(var a=0;a<this._effects.length;a++)this._effects[a].dispose(i)},r.prototype._updateEffects=function(){for(var i=0;i<this._effects.length;i++)this._effects[i].updateEffect()},r.prototype._isReady=function(){for(var i=0;i<this._effects.length;i++)if(!this._effects[i].isReady())return!1;return!0},r}(t.PostProcessRenderEffect);t.BloomEffect=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){i===void 0&&(i=""),a===void 0&&(a=!0),n===void 0&&(n=t.Engine.LastCreatedScene),o===void 0&&(o=!0);var l=c.call(this,n.getEngine(),i)||this;l._camerasToBeAttached=[],l.SharpenPostProcessId="SharpenPostProcessEffect",l.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",l.FxaaPostProcessId="FxaaPostProcessEffect",l.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",l.GrainPostProcessId="GrainPostProcessEffect",l._glowLayer=null,l.animations=[],l._imageProcessingConfigurationObserver=null,l._sharpenEnabled=!1,l._bloomEnabled=!1,l._depthOfFieldEnabled=!1,l._depthOfFieldBlurLevel=t.DepthOfFieldEffectBlurLevel.Low,l._fxaaEnabled=!1,l._imageProcessingEnabled=!0,l._bloomScale=.5,l._chromaticAberrationEnabled=!1,l._grainEnabled=!1,l._buildAllowed=!0,l._resizeObserver=null,l._hardwareScaleLevel=1,l._bloomKernel=64,l._bloomWeight=.15,l._bloomThreshold=.9,l._samples=1,l._hasCleared=!1,l._prevPostProcess=null,l._prevPrevPostProcess=null,l._depthOfFieldSceneObserver=null,l._cameras=s||n.cameras,l._cameras=l._cameras.slice(),l._camerasToBeAttached=l._cameras.slice(),l._buildAllowed=o,l._scene=n;var u=l._scene.getEngine().getCaps();l._hdr=a&&(u.textureHalfFloatRender||u.textureFloatRender),l._hdr?u.textureHalfFloatRender?l._defaultPipelineTextureType=t.Engine.TEXTURETYPE_HALF_FLOAT:u.textureFloatRender&&(l._defaultPipelineTextureType=t.Engine.TEXTURETYPE_FLOAT):l._defaultPipelineTextureType=t.Engine.TEXTURETYPE_UNSIGNED_INT,n.postProcessRenderPipelineManager.addPipeline(l);var h=l._scene.getEngine();return l.sharpen=new t.SharpenPostProcess("sharpen",1,null,t.Texture.BILINEAR_SAMPLINGMODE,h,!1,l._defaultPipelineTextureType,!0),l._sharpenEffect=new t.PostProcessRenderEffect(h,l.SharpenPostProcessId,function(){return l.sharpen},!0),l.depthOfField=new t.DepthOfFieldEffect(l._scene,null,l._depthOfFieldBlurLevel,l._defaultPipelineTextureType,!0),l.bloom=new t.BloomEffect(l._scene,l._bloomScale,l._bloomWeight,l.bloomKernel,l._defaultPipelineTextureType,!0),l.chromaticAberration=new t.ChromaticAberrationPostProcess("ChromaticAberration",h.getRenderWidth(),h.getRenderHeight(),1,null,t.Texture.BILINEAR_SAMPLINGMODE,h,!1,l._defaultPipelineTextureType,!0),l._chromaticAberrationEffect=new t.PostProcessRenderEffect(h,l.ChromaticAberrationPostProcessId,function(){return l.chromaticAberration},!0),l.grain=new t.GrainPostProcess("Grain",1,null,t.Texture.BILINEAR_SAMPLINGMODE,h,!1,l._defaultPipelineTextureType,!0),l._grainEffect=new t.PostProcessRenderEffect(h,l.GrainPostProcessId,function(){return l.grain},!0),l._resizeObserver=h.onResizeObservable.add(function(){l._hardwareScaleLevel=h.getHardwareScalingLevel(),l.bloomKernel=l.bloomKernel}),l._imageProcessingConfigurationObserver=l._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){l.bloom._downscale._exposure=l._scene.imageProcessingConfiguration.exposure}),l._buildPipeline(),l}return Object.defineProperty(r.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(i){this._sharpenEnabled!==i&&(this._sharpenEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(i){this._bloomKernel=i,this.bloom.kernel=i/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(i){this._bloomWeight!==i&&(this.bloom.weight=i,this._bloomWeight=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(i){this._bloomThreshold!==i&&(this.bloom.threshold=i,this._bloomThreshold=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(i){this._bloomScale!==i&&(this._bloomScale=i,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(i){this._bloomEnabled!==i&&(this._bloomEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),r.prototype._rebuildBloom=function(){var i=this.bloom;this.bloom=new t.BloomEffect(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=i.threshold;for(var a=0;a<this._cameras.length;a++)i.disposeEffects(this._cameras[a])},Object.defineProperty(r.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(i){this._depthOfFieldEnabled!==i&&(this._depthOfFieldEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(i){if(this._depthOfFieldBlurLevel!==i){this._depthOfFieldBlurLevel=i;var a=this.depthOfField;this.depthOfField=new t.DepthOfFieldEffect(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=a.focalLength,this.depthOfField.focusDistance=a.focusDistance,this.depthOfField.fStop=a.fStop,this.depthOfField.lensSize=a.lensSize;for(var n=0;n<this._cameras.length;n++)a.disposeEffects(this._cameras[n]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(i){this._fxaaEnabled!==i&&(this._fxaaEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"samples",{get:function(){return this._samples},set:function(i){this._samples!==i&&(this._samples=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(i){this._imageProcessingEnabled!==i&&(this._imageProcessingEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"glowLayerEnabled",{get:function(){return this._glowLayer==null},set:function(i){i&&!this._glowLayer?this._glowLayer=new t.GlowLayer("",this._scene):!i&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(i){this._chromaticAberrationEnabled!==i&&(this._chromaticAberrationEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(i){this._grainEnabled!==i&&(this._grainEnabled=i,this._buildPipeline())},enumerable:!0,configurable:!0}),r.prototype.prepare=function(){var i=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=i},r.prototype._setAutoClearAndTextureSharing=function(i,a){a===void 0&&(a=!1),this._hasCleared?i.autoClear=!1:(i.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),a||(this._prevPrevPostProcess?i.shareOutputWith(this._prevPrevPostProcess):i.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=i)},r.prototype._buildPipeline=function(){var i=this;if(this._buildAllowed){this._scene.autoClear=!0;var a=this._scene.getEngine();if(this._disposePostProcesses(),this._cameras!==null&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var n=0,s=this._cameras;n<s.length;n++){var o=s[n],l=this._scene.enableDepthRenderer(o);l.useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(u){i._cameras.indexOf(u.activeCamera)>-1&&(i.depthOfField.depthTexture=u.enableDepthRenderer(u.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var l=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=l.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new t.ImageProcessingPostProcess("imageProcessing",1,null,t.Texture.BILINEAR_SAMPLINGMODE,a,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new t.PostProcessRenderEffect(a,this.ImageProcessingPostProcessId,function(){return i.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new t.FxaaPostProcess("fxaa",1,null,t.Texture.BILINEAR_SAMPLINGMODE,a,!1,this._defaultPipelineTextureType),this.addEffect(new t.PostProcessRenderEffect(a,this.FxaaPostProcessId,function(){return i.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),this._cameras!==null&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&t.Tools.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},r.prototype._disposePostProcesses=function(i){i===void 0&&(i=!1);for(var a=0;a<this._cameras.length;a++){var n=this._cameras[a];this.imageProcessing&&this.imageProcessing.dispose(n),this.fxaa&&this.fxaa.dispose(n),i&&(this.sharpen&&this.sharpen.dispose(n),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(n)),this.bloom&&this.bloom.disposeEffects(n),this.chromaticAberration&&this.chromaticAberration.dispose(n),this.grain&&this.grain.dispose(n),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,i&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},r.prototype.addCamera=function(i){this._camerasToBeAttached.push(i),this._buildPipeline()},r.prototype.removeCamera=function(i){var a=this._camerasToBeAttached.indexOf(i);this._camerasToBeAttached.splice(a,1),this._buildPipeline()},r.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),c.prototype.dispose.call(this)},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);return i.customType="DefaultRenderingPipeline",i},r.Parse=function(i,a,n){return t.SerializationHelper.Parse(function(){return new r(i._name,i._name._hdr,a)},i,a,n)},A([t.serialize()],r.prototype,"sharpenEnabled",null),A([t.serialize()],r.prototype,"bloomKernel",null),A([t.serialize()],r.prototype,"_bloomWeight",void 0),A([t.serialize()],r.prototype,"_bloomThreshold",void 0),A([t.serialize()],r.prototype,"_hdr",void 0),A([t.serialize()],r.prototype,"bloomWeight",null),A([t.serialize()],r.prototype,"bloomThreshold",null),A([t.serialize()],r.prototype,"bloomScale",null),A([t.serialize()],r.prototype,"bloomEnabled",null),A([t.serialize()],r.prototype,"depthOfFieldEnabled",null),A([t.serialize()],r.prototype,"depthOfFieldBlurLevel",null),A([t.serialize()],r.prototype,"fxaaEnabled",null),A([t.serialize()],r.prototype,"samples",null),A([t.serialize()],r.prototype,"imageProcessingEnabled",null),A([t.serialize()],r.prototype,"glowLayerEnabled",null),A([t.serialize()],r.prototype,"chromaticAberrationEnabled",null),A([t.serialize()],r.prototype,"grainEnabled",null),r}(t.PostProcessRenderPipeline);t.DefaultRenderingPipeline=f})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(){var a=r.call(this)||this;return a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.EXPOSURE=!1,a.rebuild(),a}return i}(t.MaterialDefines);t.ImageProcessingConfigurationDefines=f;var c=function(){function r(){this.colorCurves=new t.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=r.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new t.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=r.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new t.Observable}return Object.defineProperty(r.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(i){this._colorCurvesEnabled!==i&&(this._colorCurvesEnabled=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(i){this._colorGradingTexture!==i&&(this._colorGradingTexture=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(i){this._colorGradingEnabled!==i&&(this._colorGradingEnabled=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(i){this._colorGradingWithGreenDepth!==i&&(this._colorGradingWithGreenDepth=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(i){this._colorGradingBGR!==i&&(this._colorGradingBGR=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"exposure",{get:function(){return this._exposure},set:function(i){this._exposure!==i&&(this._exposure=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(i){this._toneMappingEnabled!==i&&(this._toneMappingEnabled=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(i){this._toneMappingType!==i&&(this._toneMappingType=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contrast",{get:function(){return this._contrast},set:function(i){this._contrast!==i&&(this._contrast=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(i){this._vignetteBlendMode!==i&&(this._vignetteBlendMode=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(i){this._vignetteEnabled!==i&&(this._vignetteEnabled=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(i){this._applyByPostProcess!==i&&(this._applyByPostProcess=i,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(i){this._isEnabled!==i&&(this._isEnabled=i,this._updateParameters())},enumerable:!0,configurable:!0}),r.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},r.prototype.getClassName=function(){return"ImageProcessingConfiguration"},r.PrepareUniforms=function(i,a){a.EXPOSURE&&i.push("exposureLinear"),a.CONTRAST&&i.push("contrast"),a.COLORGRADING&&i.push("colorTransformSettings"),a.VIGNETTE&&(i.push("vInverseScreenSize"),i.push("vignetteSettings1"),i.push("vignetteSettings2")),a.COLORCURVES&&t.ColorCurves.PrepareUniforms(i)},r.PrepareSamplers=function(i,a){a.COLORGRADING&&i.push("txColorTransform")},r.prototype.prepareDefines=function(i,a){if(a===void 0&&(a=!1),a!==this.applyByPostProcess||!this._isEnabled){i.VIGNETTE=!1,i.TONEMAPPING=!1,i.TONEMAPPING_ACES=!1,i.CONTRAST=!1,i.EXPOSURE=!1,i.COLORCURVES=!1,i.COLORGRADING=!1,i.COLORGRADING3D=!1,i.IMAGEPROCESSING=!1,i.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(i.VIGNETTE=this.vignetteEnabled,i.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===r._VIGNETTEMODE_MULTIPLY,i.VIGNETTEBLENDMODEOPAQUE=!i.VIGNETTEBLENDMODEMULTIPLY,i.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case r.TONEMAPPING_ACES:i.TONEMAPPING_ACES=!0;break}i.CONTRAST=this.contrast!==1,i.EXPOSURE=this.exposure!==1,i.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,i.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,i.COLORGRADING?i.COLORGRADING3D=this.colorGradingTexture.is3D:i.COLORGRADING3D=!1,i.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,i.SAMPLER3DBGRMAP=this.colorGradingBGR,i.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,i.IMAGEPROCESSING=i.VIGNETTE||i.TONEMAPPING||i.CONTRAST||i.EXPOSURE||i.COLORCURVES||i.COLORGRADING},r.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},r.prototype.bind=function(i,a){if(a===void 0&&(a=1),this._colorCurvesEnabled&&this.colorCurves&&t.ColorCurves.Bind(this.colorCurves,i),this._vignetteEnabled){var n=1/i.getEngine().getRenderWidth(),s=1/i.getEngine().getRenderHeight();i.setFloat2("vInverseScreenSize",n,s);var o=Math.tan(this.vignetteCameraFov*.5),l=o*a,u=Math.sqrt(l*o);l=t.Tools.Mix(l,u,this.vignetteStretch),o=t.Tools.Mix(o,u,this.vignetteStretch),i.setFloat4("vignetteSettings1",l,o,-l*this.vignetteCentreX,-o*this.vignetteCentreY);var h=-2*this.vignetteWeight;i.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(i.setFloat("exposureLinear",this.exposure),i.setFloat("contrast",this.contrast),this.colorGradingTexture){i.setTexture("txColorTransform",this.colorGradingTexture);var d=this.colorGradingTexture.getSize().height;i.setFloat4("colorTransformSettings",(d-1)/d,.5/d,d,this.colorGradingTexture.level)}},r.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new r},this)},r.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},r.Parse=function(i){return t.SerializationHelper.Parse(function(){return new r},i,null,null)},Object.defineProperty(r,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(r,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),r.TONEMAPPING_STANDARD=0,r.TONEMAPPING_ACES=1,r._VIGNETTEMODE_MULTIPLY=0,r._VIGNETTEMODE_OPAQUE=1,A([t.serializeAsColorCurves()],r.prototype,"colorCurves",void 0),A([t.serialize()],r.prototype,"_colorCurvesEnabled",void 0),A([t.serializeAsTexture("colorGradingTexture")],r.prototype,"_colorGradingTexture",void 0),A([t.serialize()],r.prototype,"_colorGradingEnabled",void 0),A([t.serialize()],r.prototype,"_colorGradingWithGreenDepth",void 0),A([t.serialize()],r.prototype,"_colorGradingBGR",void 0),A([t.serialize()],r.prototype,"_exposure",void 0),A([t.serialize()],r.prototype,"_toneMappingEnabled",void 0),A([t.serialize()],r.prototype,"_toneMappingType",void 0),A([t.serialize()],r.prototype,"_contrast",void 0),A([t.serialize()],r.prototype,"vignetteStretch",void 0),A([t.serialize()],r.prototype,"vignetteCentreX",void 0),A([t.serialize()],r.prototype,"vignetteCentreY",void 0),A([t.serialize()],r.prototype,"vignetteWeight",void 0),A([t.serializeAsColor4()],r.prototype,"vignetteColor",void 0),A([t.serialize()],r.prototype,"vignetteCameraFov",void 0),A([t.serialize()],r.prototype,"_vignetteBlendMode",void 0),A([t.serialize()],r.prototype,"_vignetteEnabled",void 0),A([t.serialize()],r.prototype,"_applyByPostProcess",void 0),A([t.serialize()],r.prototype,"_isEnabled",void 0),r}();t.ImageProcessingConfiguration=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){var n=c.call(this,a)||this;return i&&(n._engine=a.getEngine(),n._textureMatrix=t.Matrix.Identity(),n.name=i,n.url=i,n.hasAlpha=!1,n.isCube=!1,n.is3D=n._engine.webGLVersion>1,n.wrapU=t.Texture.CLAMP_ADDRESSMODE,n.wrapV=t.Texture.CLAMP_ADDRESSMODE,n.wrapR=t.Texture.CLAMP_ADDRESSMODE,n.anisotropicFilteringLevel=1,n._texture=n._getFromCache(i,!0),n._texture||(a.useDelayedTextureLoading?n.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED:n.loadTexture())),n}return r.prototype.getTextureMatrix=function(){return this._textureMatrix},r.prototype.load3dlTexture=function(){var i=this._engine,a;i.webGLVersion===1?a=i.createRawTexture(null,1,1,t.Engine.TEXTUREFORMAT_RGBA,!1,!1,t.Texture.BILINEAR_SAMPLINGMODE):a=i.createRawTexture3D(null,1,1,1,t.Engine.TEXTUREFORMAT_RGBA,!1,!1,t.Texture.BILINEAR_SAMPLINGMODE),this._texture=a;var n=function(o){if(typeof o=="string"){for(var l=null,u=null,h,d=o.split(`
`),p=0,m=0,_=0,v=0,S=0,P=0;P<d.length;P++)if(h=d[P],!!r._noneEmptyLineRegex.test(h)&&h.indexOf("#")!==0){var x=h.split(" ");if(p===0){p=x.length,l=new Uint8Array(p*p*p*4),u=new Float32Array(p*p*p*4);continue}if(p!=0){var R=Math.max(parseInt(x[0]),0),w=Math.max(parseInt(x[1]),0),I=Math.max(parseInt(x[2]),0);S=Math.max(R,S),S=Math.max(w,S),S=Math.max(I,S);var F=(m+v*p+_*p*p)*4;u&&(u[F+0]=R,u[F+1]=w,u[F+2]=I),_++,_%p==0&&(v++,_=0,v%p==0&&(m++,v=0))}}if(u&&l)for(var P=0;P<u.length;P++)if(P>0&&(P+1)%4===0)l[P]=255;else{var k=u[P];l[P]=k/S*255}a.is3D?(a.updateSize(p,p,p),i.updateRawTexture3D(a,l,t.Engine.TEXTUREFORMAT_RGBA,!1)):(a.updateSize(p*p,p),i.updateRawTexture(a,l,t.Engine.TEXTUREFORMAT_RGBA,!1))}},s=this.getScene();return s?s._loadFile(this.url,n):this._engine._loadFile(this.url,n),this._texture},r.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},r.prototype.clone=function(){var i=new r(this.url,this.getScene());return i.level=this.level,i},r.prototype.delayLoad=function(){this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},r.Parse=function(i,a,n){var s=null;return i.name&&!i.isRenderTarget&&(s=new r(i.name,a),s.name=i.name,s.level=i.level),s},r.prototype.serialize=function(){if(!this.name)return null;var i={};return i.name=this.name,i.level=this.level,i.customType="BABYLON.ColorGradingTexture",i},r._noneEmptyLineRegex=/\S+/,r}(t.BaseTexture);t.ColorGradingTexture=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._dirty=!0,this._tempColor=new t.Color4(0,0,0,0),this._globalCurve=new t.Color4(0,0,0,0),this._highlightsCurve=new t.Color4(0,0,0,0),this._midtonesCurve=new t.Color4(0,0,0,0),this._shadowsCurve=new t.Color4(0,0,0,0),this._positiveCurve=new t.Color4(0,0,0,0),this._negativeCurve=new t.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(c.prototype,"globalHue",{get:function(){return this._globalHue},set:function(r){this._globalHue=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(r){this._globalDensity=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(r){this._globalSaturation=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(r){this._globalExposure=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(r){this._highlightsHue=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(r){this._highlightsDensity=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(r){this._highlightsSaturation=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(r){this._highlightsExposure=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(r){this._midtonesHue=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(r){this._midtonesDensity=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(r){this._midtonesSaturation=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(r){this._midtonesExposure=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(r){this._shadowsHue=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(r){this._shadowsDensity=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(r){this._shadowsSaturation=r,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(r){this._shadowsExposure=r,this._dirty=!0},enumerable:!0,configurable:!0}),c.prototype.getClassName=function(){return"ColorCurves"},c.Bind=function(r,i,a,n,s){a===void 0&&(a="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),s===void 0&&(s="vCameraColorCurveNegative"),r._dirty&&(r._dirty=!1,r.getColorGradingDataToRef(r._globalHue,r._globalDensity,r._globalSaturation,r._globalExposure,r._globalCurve),r.getColorGradingDataToRef(r._highlightsHue,r._highlightsDensity,r._highlightsSaturation,r._highlightsExposure,r._tempColor),r._tempColor.multiplyToRef(r._globalCurve,r._highlightsCurve),r.getColorGradingDataToRef(r._midtonesHue,r._midtonesDensity,r._midtonesSaturation,r._midtonesExposure,r._tempColor),r._tempColor.multiplyToRef(r._globalCurve,r._midtonesCurve),r.getColorGradingDataToRef(r._shadowsHue,r._shadowsDensity,r._shadowsSaturation,r._shadowsExposure,r._tempColor),r._tempColor.multiplyToRef(r._globalCurve,r._shadowsCurve),r._highlightsCurve.subtractToRef(r._midtonesCurve,r._positiveCurve),r._midtonesCurve.subtractToRef(r._shadowsCurve,r._negativeCurve)),i&&(i.setFloat4(a,r._positiveCurve.r,r._positiveCurve.g,r._positiveCurve.b,r._positiveCurve.a),i.setFloat4(n,r._midtonesCurve.r,r._midtonesCurve.g,r._midtonesCurve.b,r._midtonesCurve.a),i.setFloat4(s,r._negativeCurve.r,r._negativeCurve.g,r._negativeCurve.b,r._negativeCurve.a))},c.PrepareUniforms=function(r){r.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},c.prototype.getColorGradingDataToRef=function(r,i,a,n,s){r!=null&&(r=c.clamp(r,0,360),i=c.clamp(i,-100,100),a=c.clamp(a,-100,100),n=c.clamp(n,-100,100),i=c.applyColorGradingSliderNonlinear(i),i*=.5,n=c.applyColorGradingSliderNonlinear(n),i<0&&(i*=-1,r=(r+180)%360),c.fromHSBToRef(r,i,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*a)},c.applyColorGradingSliderNonlinear=function(r){r/=100;var i=Math.abs(r);return i=Math.pow(i,2),r<0&&(i*=-1),i*=100,i},c.fromHSBToRef=function(r,i,a,n){var s=c.clamp(r,0,360),o=c.clamp(i/100,0,1),l=c.clamp(a/100,0,1);if(o===0)n.r=l,n.g=l,n.b=l;else{s/=60;var u=Math.floor(s),h=s-u,d=l*(1-o),p=l*(1-o*h),m=l*(1-o*(1-h));switch(u){case 0:n.r=l,n.g=m,n.b=d;break;case 1:n.r=p,n.g=l,n.b=d;break;case 2:n.r=d,n.g=l,n.b=m;break;case 3:n.r=d,n.g=p,n.b=l;break;case 4:n.r=m,n.g=d,n.b=l;break;default:n.r=l,n.g=d,n.b=p;break}}n.a=1},c.clamp=function(r,i,a){return Math.min(Math.max(r,i),a)},c.prototype.clone=function(){return t.SerializationHelper.Clone(function(){return new c},this)},c.prototype.serialize=function(){return t.SerializationHelper.Serialize(this)},c.Parse=function(r){return t.SerializationHelper.Parse(function(){return new c},r,null,null)},A([t.serialize()],c.prototype,"_globalHue",void 0),A([t.serialize()],c.prototype,"_globalDensity",void 0),A([t.serialize()],c.prototype,"_globalSaturation",void 0),A([t.serialize()],c.prototype,"_globalExposure",void 0),A([t.serialize()],c.prototype,"_highlightsHue",void 0),A([t.serialize()],c.prototype,"_highlightsDensity",void 0),A([t.serialize()],c.prototype,"_highlightsSaturation",void 0),A([t.serialize()],c.prototype,"_highlightsExposure",void 0),A([t.serialize()],c.prototype,"_midtonesHue",void 0),A([t.serialize()],c.prototype,"_midtonesDensity",void 0),A([t.serialize()],c.prototype,"_midtonesSaturation",void 0),A([t.serialize()],c.prototype,"_midtonesExposure",void 0),c}();t.ColorCurves=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d,p){var m=c.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],l,u,h,d,p)||this;return m.color=n,m.depth=s,m.colorLevel=o,m._ownRefractionTexture=!0,m.onActivateObservable.add(function(_){m._refTexture=m._refTexture||new t.Texture(a,_.getScene())}),m.onApplyObservable.add(function(_){_.setColor3("baseColor",m.color),_.setFloat("depth",m.depth),_.setFloat("colorLevel",m.colorLevel),_.setTexture("refractionSampler",m._refTexture)}),m}return Object.defineProperty(r.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(i){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=i,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),r.prototype.dispose=function(i){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),c.prototype.dispose.call(this,i)},r}(t.PostProcess);t.RefractionPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){var u=c.call(this,i,"blackAndWhite",["degree"],null,a,n,s,o,l)||this;return u.degree=1,u.onApplyObservable.add(function(h){h.setFloat("degree",u.degree)}),u}return r}(t.PostProcess);t.BlackAndWhitePostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){h===void 0&&(h=t.Engine.TEXTURETYPE_UNSIGNED_INT);var d=c.call(this,i,"convolution",["kernel","screenSize"],null,n,s,o,l,u,null,h)||this;return d.kernel=a,d.onApply=function(p){p.setFloat2("screenSize",d.width,d.height),p.setArray("kernel",d.kernel)},d}return r.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],r.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],r.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],r.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],r.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],r.GaussianKernel=[0,1,0,1,1,1,0,1,0],r}(t.PostProcess);t.ConvolutionPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){var h=c.call(this,i,"filter",["kernelMatrix"],null,n,s,o,l,u)||this;return h.kernelMatrix=a,h.onApply=function(d){d.setMatrix("kernelMatrix",h.kernelMatrix)},h}return r}(t.PostProcess);t.FilterPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d){o===void 0&&(o=100),l===void 0&&(l=t.Texture.BILINEAR_SAMPLINGMODE);var p=c.call(this,i,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],a.postProcessRatio||a,n,l,u,h,"#define NUM_SAMPLES "+o)||this;return p._screenCoordinates=t.Vector2.Zero(),p.customMeshPosition=t.Vector3.Zero(),p.useCustomMeshPosition=!1,p.invert=!0,p.excludedMeshes=new Array,p.exposure=.3,p.decay=.96815,p.weight=.58767,p.density=.926,d=n===null?d:n.getScene(),u=d.getEngine(),p._viewPort=new t.Viewport(0,0,1,1).toGlobal(u.getRenderWidth(),u.getRenderHeight()),p.mesh=s!==null?s:r.CreateDefaultMesh("VolumetricLightScatteringMesh",d),p._createPass(d,a.passRatio||a),p.onActivate=function(m){p.isSupported||p.dispose(m),p.onActivate=null},p.onApplyObservable.add(function(m){p._updateMeshScreenCoordinates(d),m.setTexture("lightScatteringSampler",p._volumetricLightScatteringRTT),m.setFloat("exposure",p.exposure),m.setFloat("decay",p.decay),m.setFloat("weight",p.weight),m.setFloat("density",p.density),m.setVector2("meshPositionOnScreen",p._screenCoordinates)}),p}return Object.defineProperty(r.prototype,"useDiffuseColor",{get:function(){return t.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(i){t.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},r.prototype._isReady=function(i,a){var n=i.getMesh();if(n===this.mesh&&n.material)return n.material.isReady(n);var s=[],o=[t.VertexBuffer.PositionKind],l=i.getMaterial();l&&(l.needAlphaTesting()&&s.push("#define ALPHATEST"),n.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(o.push(t.VertexBuffer.UVKind),s.push("#define UV1")),n.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(o.push(t.VertexBuffer.UV2Kind),s.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders?(o.push(t.VertexBuffer.MatricesIndicesKind),o.push(t.VertexBuffer.MatricesWeightsKind),s.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),s.push("#define BonesPerMesh "+(n.skeleton?n.skeleton.bones.length+1:0))):s.push("#define NUM_BONE_INFLUENCERS 0"),a&&(s.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var u=s.join(`
`);return this._cachedDefines!==u&&(this._cachedDefines=u,this._volumetricLightScatteringPass=n.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},o,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],u)),this._volumetricLightScatteringPass.isReady()},r.prototype.setCustomMeshPosition=function(i){this.customMeshPosition=i},r.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},r.prototype.dispose=function(i){var a=i.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);a!==-1&&i.getScene().customRenderTargets.splice(a,1),this._volumetricLightScatteringRTT.dispose(),c.prototype.dispose.call(this,i)},r.prototype.getPass=function(){return this._volumetricLightScatteringRTT},r.prototype._meshExcluded=function(i){return this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(i)!==-1},r.prototype._createPass=function(i,a){var n=this,s=i.getEngine();this._volumetricLightScatteringRTT=new t.RenderTargetTexture("volumetricLightScatteringMap",{width:s.getRenderWidth()*a,height:s.getRenderHeight()*a},i,!1,!0,t.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var o=this.getCamera();o?o.customRenderTargets.push(this._volumetricLightScatteringRTT):i.customRenderTargets.push(this._volumetricLightScatteringRTT);var l=function(d){var p=d.getRenderingMesh();if(!n._meshExcluded(p)){var m=d.getMaterial();if(m){var _=p.getScene(),v=_.getEngine();v.setState(m.backFaceCulling);var S=p._getInstancesRenderList(d._id);if(!S.mustReturn){var P=v.getCaps().instancedArrays&&S.visibleInstances[d._id]!==null;if(n._isReady(d,P)){var x=n._volumetricLightScatteringPass;if(p===n.mesh&&(d.effect?x=d.effect:x=m.getEffect()),v.enableEffect(x),p._bind(d,x,t.Material.TriangleFillMode),p===n.mesh)m.bind(p.getWorldMatrix(),p);else{if(n._volumetricLightScatteringPass.setMatrix("viewProjection",_.getTransformMatrix()),m&&m.needAlphaTesting()){var R=m.getAlphaTestTexture();n._volumetricLightScatteringPass.setTexture("diffuseSampler",R),R&&n._volumetricLightScatteringPass.setMatrix("diffuseMatrix",R.getTextureMatrix())}p.useBones&&p.computeBonesUsingShaders&&p.skeleton&&n._volumetricLightScatteringPass.setMatrices("mBones",p.skeleton.getTransformMatrices(p))}p._processRendering(d,n._volumetricLightScatteringPass,t.Material.TriangleFillMode,S,P,function(w,I){return x.setMatrix("world",I)})}}}}},u,h=new t.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){u=i.clearColor,i.clearColor=h}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){i.clearColor=u}),this._volumetricLightScatteringRTT.customRenderFunction=function(d,p,m,_){var v=i.getEngine(),S;if(_.length){for(v.setColorWrite(!1),S=0;S<_.length;S++)l(_.data[S]);v.setColorWrite(!0)}for(S=0;S<d.length;S++)l(d.data[S]);for(S=0;S<p.length;S++)l(p.data[S]);if(m.length){for(S=0;S<m.length;S++){var P=m.data[S],x=P.getBoundingInfo();x&&i.activeCamera&&(P._alphaIndex=P.getMesh().alphaIndex,P._distanceToCamera=x.boundingSphere.centerWorld.subtract(i.activeCamera.position).length())}var R=m.data.slice(0,m.length);for(R.sort(function(w,I){return w._alphaIndex>I._alphaIndex?1:w._alphaIndex<I._alphaIndex?-1:w._distanceToCamera<I._distanceToCamera?1:w._distanceToCamera>I._distanceToCamera?-1:0}),v.setAlphaMode(t.Engine.ALPHA_COMBINE),S=0;S<R.length;S++)l(R[S]);v.setAlphaMode(t.Engine.ALPHA_DISABLE)}}},r.prototype._updateMeshScreenCoordinates=function(i){var a=i.getTransformMatrix(),n;this.useCustomMeshPosition?n=this.customMeshPosition:this.attachedNode?n=this.attachedNode.position:n=this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var s=t.Vector3.Project(n,t.Matrix.Identity(),a,this._viewPort);this._screenCoordinates.x=s.x/this._viewPort.width,this._screenCoordinates.y=s.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},r.CreateDefaultMesh=function(i,a){var n=t.Mesh.CreatePlane(i,1,a);n.billboardMode=t.AbstractMesh.BILLBOARDMODE_ALL;var s=new t.StandardMaterial(i+"Material",a);return s.emissiveColor=new t.Color3(1,1,1),n.material=s,n},A([t.serializeAsVector3()],r.prototype,"customMeshPosition",void 0),A([t.serialize()],r.prototype,"useCustomMeshPosition",void 0),A([t.serialize()],r.prototype,"invert",void 0),A([t.serializeAsMeshReference()],r.prototype,"mesh",void 0),A([t.serialize()],r.prototype,"excludedMeshes",void 0),A([t.serialize()],r.prototype,"exposure",void 0),A([t.serialize()],r.prototype,"decay",void 0),A([t.serialize()],r.prototype,"weight",void 0),A([t.serialize()],r.prototype,"density",void 0),r}(t.PostProcess);t.VolumetricLightScatteringPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){var h=c.call(this,i,"colorCorrection",null,["colorTable"],n,s,o,l,u)||this;return h._colorTableTexture=new t.Texture(a,s.getScene(),!0,!1,t.Texture.TRILINEAR_SAMPLINGMODE),h._colorTableTexture.anisotropicFilteringLevel=1,h._colorTableTexture.wrapU=t.Texture.CLAMP_ADDRESSMODE,h._colorTableTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,h.onApply=function(d){d.setTexture("colorTable",h._colorTableTexture)},h}return r}(t.PostProcess);t.ColorCorrectionPostProcess=f})(T||(T={}));var T;(function(t){var f;(function(r){r[r.Hable=0]="Hable",r[r.Reinhard=1]="Reinhard",r[r.HejiDawson=2]="HejiDawson",r[r.Photographic=3]="Photographic"})(f=t.TonemappingOperator||(t.TonemappingOperator={}));var c=function(r){N(i,r);function i(a,n,s,o,l,u,h){l===void 0&&(l=t.Texture.BILINEAR_SAMPLINGMODE),h===void 0&&(h=t.Engine.TEXTURETYPE_UNSIGNED_INT);var d=r.call(this,a,"tonemap",["_ExposureAdjustment"],null,1,o,l,u,!0,null,h)||this;d._operator=n,d.exposureAdjustment=s;var p="#define ";return d._operator===f.Hable?p+="HABLE_TONEMAPPING":d._operator===f.Reinhard?p+="REINHARD_TONEMAPPING":d._operator===f.HejiDawson?p+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":d._operator===f.Photographic&&(p+="PHOTOGRAPHIC_TONEMAPPING"),d.updateEffect(p),d.onApply=function(m){m.setFloat("_ExposureAdjustment",d.exposureAdjustment)},d}return i}(t.PostProcess);t.TonemapPostProcess=c})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){return c.call(this,i,"displayPass",["passSampler"],["passSampler"],a,n,s,o,l)||this}return r}(t.PostProcess);t.DisplayPassPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){return u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT),c.call(this,i,"highlights",null,null,a,n,s,o,l,null,u)||this}return r}(t.PostProcess);t.HighlightsPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){n===void 0&&(n=null),u===void 0&&(u=t.Engine.TEXTURETYPE_UNSIGNED_INT);var d=c.call(this,i,"imageProcessing",[],[],a,n,s,o,l,null,u,"postprocess",null,!0)||this;return d._fromLinearSpace=!0,d._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},h?(h.applyByPostProcess=!0,d._attachImageProcessingConfiguration(h,!0),d.fromLinearSpace=!1):(d._attachImageProcessingConfiguration(null,!0),d.imageProcessingConfiguration.applyByPostProcess=!0),d.onApply=function(p){d.imageProcessingConfiguration.bind(p,d.aspectRatio)},d}return Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(i){this._attachImageProcessingConfiguration(i)},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(i,a){var n=this;if(a===void 0&&(a=!1),i!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i)this._imageProcessingConfiguration=i;else{var s=null,o=this.getEngine(),l=this.getCamera();if(l)s=l.getScene();else if(o&&o.scenes){var u=o.scenes;s=u[u.length-1]}else s=t.Engine.LastCreatedScene;this._imageProcessingConfiguration=s.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(h){n._updateParameters()})),a||this._updateParameters()}},Object.defineProperty(r.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(i){this.imageProcessingConfiguration.colorCurves=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(i){this.imageProcessingConfiguration.colorCurvesEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(i){this.imageProcessingConfiguration.colorGradingTexture=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(i){this.imageProcessingConfiguration.colorGradingEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(i){this.imageProcessingConfiguration.exposure=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(i){this._imageProcessingConfiguration.toneMappingEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(i){this.imageProcessingConfiguration.contrast=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(i){this.imageProcessingConfiguration.vignetteStretch=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(i){this.imageProcessingConfiguration.vignetteCentreX=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(i){this.imageProcessingConfiguration.vignetteCentreY=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(i){this.imageProcessingConfiguration.vignetteWeight=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(i){this.imageProcessingConfiguration.vignetteColor=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(i){this.imageProcessingConfiguration.vignetteCameraFov=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(i){this.imageProcessingConfiguration.vignetteBlendMode=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(i){this.imageProcessingConfiguration.vignetteEnabled=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(i){this._fromLinearSpace!==i&&(this._fromLinearSpace=i,this._updateParameters())},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"ImageProcessingPostProcess"},r.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var i="";for(var a in this._defines)this._defines[a]&&(i+="#define "+a+`;\r
`);var n=["textureSampler"],s=["scale"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareSamplers(n,this._defines),t.ImageProcessingConfiguration.PrepareUniforms(s,this._defines)),this.updateEffect(i,s,n)},r.prototype.dispose=function(i){c.prototype.dispose.call(this,i),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},A([t.serialize()],r.prototype,"_fromLinearSpace",void 0),r}(t.PostProcess);t.ImageProcessingPostProcess=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){n===void 0&&(n=null),s===void 0&&(s=null),o===void 0&&(o=null),l===void 0&&(l=null),u===void 0&&(u=null);var h=c.call(this,i,a.getScene())||this;return h.name=i,h.children=new Array,h.animations=new Array,h._index=null,h._absoluteTransform=new t.Matrix,h._invertedAbsoluteTransform=new t.Matrix,h._scalingDeterminant=1,h._worldTransform=new t.Matrix,h._needToDecompose=!0,h._needToCompose=!1,h._skeleton=a,h._localMatrix=s?s.clone():t.Matrix.Identity(),h._restPose=o||h._localMatrix.clone(),h._baseMatrix=l||h._localMatrix.clone(),h._index=u,a.bones.push(h),h.setParent(n,!1),(l||s)&&h._updateDifferenceMatrix(),h}return Object.defineProperty(r.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(i){this._localMatrix.copyFrom(i),this._needToDecompose=!0},enumerable:!0,configurable:!0}),r.prototype.getSkeleton=function(){return this._skeleton},r.prototype.getParent=function(){return this._parent},r.prototype.setParent=function(i,a){if(a===void 0&&(a=!0),this._parent!==i){if(this._parent){var n=this._parent.children.indexOf(this);n!==-1&&this._parent.children.splice(n,1)}this._parent=i,this._parent&&this._parent.children.push(this),a&&this._updateDifferenceMatrix(),this.markAsDirty()}},r.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},r.prototype.getBaseMatrix=function(){return this._baseMatrix},r.prototype.getRestPose=function(){return this._restPose},r.prototype.getWorldMatrix=function(){return this._worldTransform},r.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},r.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},r.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},Object.defineProperty(r.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(i){this._decompose(),this._localPosition.copyFrom(i),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotation",{get:function(){return this.getRotation()},set:function(i){this.setRotation(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(i){this.setRotationQuaternion(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaling",{get:function(){return this.getScale()},set:function(i){this.setScale(i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),r.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=t.Vector3.Zero(),this._localRotation=t.Quaternion.Zero(),this._localPosition=t.Vector3.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},r.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,t.Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},r.prototype.updateMatrix=function(i,a,n){a===void 0&&(a=!0),n===void 0&&(n=!0),this._baseMatrix.copyFrom(i),a&&this._updateDifferenceMatrix(),n?(this._localMatrix.copyFrom(i),this._markAsDirtyAndDecompose()):this.markAsDirty()},r.prototype._updateDifferenceMatrix=function(i,a){if(a===void 0&&(a=!0),i||(i=this._baseMatrix),this._parent?i.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(i),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),a)for(var n=0;n<this.children.length;n++)this.children[n]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},r.prototype.markAsDirty=function(){this._currentRenderId++,this._childRenderId++,this._skeleton._markAsDirty()},r.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},r.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},r.prototype.copyAnimationRange=function(i,a,n,s,o){s===void 0&&(s=!1),o===void 0&&(o=null),this.animations.length===0&&(this.animations.push(new t.Animation(this.name,"_matrix",i.animations[0].framePerSecond,t.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var l=i.animations[0].getRange(a);if(!l)return!1;for(var u=l.from,h=l.to,d=i.animations[0].getKeys(),p=i.length,m=i.getParent(),_=this.getParent(),v=s&&m&&p&&this.length&&p!==this.length,S=v&&_&&m?_.length/m.length:1,P=s&&!_&&o&&(o.x!==1||o.y!==1||o.z!==1),x=this.animations[0].getKeys(),R,w,I,F=0,k=d.length;F<k;F++)R=d[F],R.frame>=u&&R.frame<=h&&(s?(I=R.value.clone(),v?(w=I.getTranslation(),I.setTranslation(w.scaleInPlace(S))):P&&o?(w=I.getTranslation(),I.setTranslation(w.multiplyInPlace(o))):I=R.value):I=R.value,x.push({frame:R.frame+n,value:I}));return this.animations[0].createRange(a,u+n,h+n),!0},r.prototype.translate=function(i,a,n){a===void 0&&(a=t.Space.LOCAL);var s=this.getLocalMatrix();if(a==t.Space.LOCAL)s.m[12]+=i.x,s.m[13]+=i.y,s.m[14]+=i.z;else{var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=r._tmpMats[0],u=r._tmpVecs[0];this._parent&&(n&&o?(l.copyFrom(this._parent.getAbsoluteTransform()),l.multiplyToRef(o,l)):l.copyFrom(this._parent.getAbsoluteTransform())),l.m[12]=0,l.m[13]=0,l.m[14]=0,l.invert(),t.Vector3.TransformCoordinatesToRef(i,l,u),s.m[12]+=u.x,s.m[13]+=u.y,s.m[14]+=u.z}this._markAsDirtyAndDecompose()},r.prototype.setPosition=function(i,a,n){a===void 0&&(a=t.Space.LOCAL);var s=this.getLocalMatrix();if(a==t.Space.LOCAL)s.m[12]=i.x,s.m[13]=i.y,s.m[14]=i.z;else{var o=null;n&&(o=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=r._tmpMats[0],u=r._tmpVecs[0];this._parent&&(n&&o?(l.copyFrom(this._parent.getAbsoluteTransform()),l.multiplyToRef(o,l)):l.copyFrom(this._parent.getAbsoluteTransform())),l.invert(),t.Vector3.TransformCoordinatesToRef(i,l,u),s.m[12]=u.x,s.m[13]=u.y,s.m[14]=u.z}this._markAsDirtyAndDecompose()},r.prototype.setAbsolutePosition=function(i,a){this.setPosition(i,t.Space.WORLD,a)},r.prototype.scale=function(i,a,n,s){s===void 0&&(s=!1);var o=this.getLocalMatrix(),l=r._tmpMats[0];t.Matrix.ScalingToRef(i,a,n,l),l.multiplyToRef(o,o),l.invert();for(var u=0,h=this.children;u<h.length;u++){var d=h[u],p=d.getLocalMatrix();p.multiplyToRef(l,p),p.m[12]*=i,p.m[13]*=a,p.m[14]*=n,d._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),s)for(var m=0,_=this.children;m<_.length;m++){var d=_[m];d.scale(i,a,n,s)}},r.prototype.setScale=function(i){this._decompose(),this._localScaling.copyFrom(i),this._markAsDirtyAndCompose()},r.prototype.getScale=function(){return this._decompose(),this._localScaling},r.prototype.getScaleToRef=function(i){this._decompose(),i.copyFrom(this._localScaling)},r.prototype.setYawPitchRoll=function(i,a,n,s,o){if(s===void 0&&(s=t.Space.LOCAL),s===t.Space.LOCAL){var l=r._tmpQuat;t.Quaternion.RotationYawPitchRollToRef(i,a,n,l),this.setRotationQuaternion(l,s,o);return}var u=r._tmpMats[0];if(this._getNegativeRotationToRef(u,o)){var h=r._tmpMats[1];t.Matrix.RotationYawPitchRollToRef(i,a,n,h),u.multiplyToRef(h,h),this._rotateWithMatrix(h,s,o)}},r.prototype.rotate=function(i,a,n,s){n===void 0&&(n=t.Space.LOCAL);var o=r._tmpMats[0];o.m[12]=0,o.m[13]=0,o.m[14]=0,t.Matrix.RotationAxisToRef(i,a,o),this._rotateWithMatrix(o,n,s)},r.prototype.setAxisAngle=function(i,a,n,s){if(n===void 0&&(n=t.Space.LOCAL),n===t.Space.LOCAL){var o=r._tmpQuat;t.Quaternion.RotationAxisToRef(i,a,o),this.setRotationQuaternion(o,n,s);return}var l=r._tmpMats[0];if(this._getNegativeRotationToRef(l,s)){var u=r._tmpMats[1];t.Matrix.RotationAxisToRef(i,a,u),l.multiplyToRef(u,u),this._rotateWithMatrix(u,n,s)}},r.prototype.setRotation=function(i,a,n){a===void 0&&(a=t.Space.LOCAL),this.setYawPitchRoll(i.y,i.x,i.z,a,n)},r.prototype.setRotationQuaternion=function(i,a,n){if(a===void 0&&(a=t.Space.LOCAL),a===t.Space.LOCAL){this._decompose(),this._localRotation.copyFrom(i),this._markAsDirtyAndCompose();return}var s=r._tmpMats[0];if(this._getNegativeRotationToRef(s,n)){var o=r._tmpMats[1];t.Matrix.FromQuaternionToRef(i,o),s.multiplyToRef(o,o),this._rotateWithMatrix(o,a,n)}},r.prototype.setRotationMatrix=function(i,a,n){if(a===void 0&&(a=t.Space.LOCAL),a===t.Space.LOCAL){var s=r._tmpQuat;t.Quaternion.FromRotationMatrixToRef(i,s),this.setRotationQuaternion(s,a,n);return}var o=r._tmpMats[0];if(this._getNegativeRotationToRef(o,n)){var l=r._tmpMats[1];l.copyFrom(i),o.multiplyToRef(i,l),this._rotateWithMatrix(l,a,n)}},r.prototype._rotateWithMatrix=function(i,a,n){a===void 0&&(a=t.Space.LOCAL);var s=this.getLocalMatrix(),o=s.m[12],l=s.m[13],u=s.m[14],h=this.getParent(),d=r._tmpMats[3],p=r._tmpMats[4];h&&a==t.Space.WORLD?(n?(d.copyFrom(n.getWorldMatrix()),h.getAbsoluteTransform().multiplyToRef(d,d)):d.copyFrom(h.getAbsoluteTransform()),p.copyFrom(d),p.invert(),s.multiplyToRef(d,s),s.multiplyToRef(i,s),s.multiplyToRef(p,s)):a==t.Space.WORLD&&n?(d.copyFrom(n.getWorldMatrix()),p.copyFrom(d),p.invert(),s.multiplyToRef(d,s),s.multiplyToRef(i,s),s.multiplyToRef(p,s)):s.multiplyToRef(i,s),s.m[12]=o,s.m[13]=l,s.m[14]=u,this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},r.prototype._getNegativeRotationToRef=function(i,a){var n=r._tmpMats[2];return i.copyFrom(this.getAbsoluteTransform()),a&&(i.multiplyToRef(a.getWorldMatrix(),i),t.Matrix.ScalingToRef(a.scaling.x,a.scaling.y,a.scaling.z,n)),i.invert(),isNaN(i.m[0])?!1:(n.m[0]*=this._scalingDeterminant,i.multiplyToRef(n,i),!0)},r.prototype.getPosition=function(i,a){i===void 0&&(i=t.Space.LOCAL),a===void 0&&(a=null);var n=t.Vector3.Zero();return this.getPositionToRef(i,a,n),n},r.prototype.getPositionToRef=function(i,a,n){if(i===void 0&&(i=t.Space.LOCAL),i==t.Space.LOCAL){var s=this.getLocalMatrix();n.x=s.m[12],n.y=s.m[13],n.z=s.m[14]}else{var o=null;a&&(o=a.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var l=r._tmpMats[0];a&&o?(l.copyFrom(this.getAbsoluteTransform()),l.multiplyToRef(o,l)):l=this.getAbsoluteTransform(),n.x=l.m[12],n.y=l.m[13],n.z=l.m[14]}},r.prototype.getAbsolutePosition=function(i){i===void 0&&(i=null);var a=t.Vector3.Zero();return this.getPositionToRef(t.Space.WORLD,i,a),a},r.prototype.getAbsolutePositionToRef=function(i,a){this.getPositionToRef(t.Space.WORLD,i,a)},r.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var i=this._skeleton.getPoseMatrix();i&&this._absoluteTransform.multiplyToRef(i,this._absoluteTransform)}for(var a=this.children,n=a.length,s=0;s<n;s++)a[s].computeAbsoluteTransforms()},r.prototype.getDirection=function(i,a){a===void 0&&(a=null);var n=t.Vector3.Zero();return this.getDirectionToRef(i,a,n),n},r.prototype.getDirectionToRef=function(i,a,n){a===void 0&&(a=null);var s=null;a&&(s=a.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=r._tmpMats[0];o.copyFrom(this.getAbsoluteTransform()),a&&s&&o.multiplyToRef(s,o),t.Vector3.TransformNormalToRef(i,o,n),n.normalize()},r.prototype.getRotation=function(i,a){i===void 0&&(i=t.Space.LOCAL),a===void 0&&(a=null);var n=t.Vector3.Zero();return this.getRotationToRef(i,a,n),n},r.prototype.getRotationToRef=function(i,a,n){i===void 0&&(i=t.Space.LOCAL),a===void 0&&(a=null);var s=r._tmpQuat;this.getRotationQuaternionToRef(i,a,s),s.toEulerAnglesToRef(n)},r.prototype.getRotationQuaternion=function(i,a){i===void 0&&(i=t.Space.LOCAL),a===void 0&&(a=null);var n=t.Quaternion.Identity();return this.getRotationQuaternionToRef(i,a,n),n},r.prototype.getRotationQuaternionToRef=function(i,a,n){if(i===void 0&&(i=t.Space.LOCAL),a===void 0&&(a=null),i==t.Space.LOCAL)this._decompose(),n.copyFrom(this._localRotation);else{var s=r._tmpMats[0],o=this.getAbsoluteTransform();a?o.multiplyToRef(a.getWorldMatrix(),s):s.copyFrom(o),s.m[0]*=this._scalingDeterminant,s.m[1]*=this._scalingDeterminant,s.m[2]*=this._scalingDeterminant,s.decompose(void 0,n,void 0)}},r.prototype.getRotationMatrix=function(i,a){i===void 0&&(i=t.Space.LOCAL);var n=t.Matrix.Identity();return this.getRotationMatrixToRef(i,a,n),n},r.prototype.getRotationMatrixToRef=function(i,a,n){if(i===void 0&&(i=t.Space.LOCAL),i==t.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(n);else{var s=r._tmpMats[0],o=this.getAbsoluteTransform();a?o.multiplyToRef(a.getWorldMatrix(),s):s.copyFrom(o),s.m[0]*=this._scalingDeterminant,s.m[1]*=this._scalingDeterminant,s.m[2]*=this._scalingDeterminant,s.getRotationMatrixToRef(n)}},r.prototype.getAbsolutePositionFromLocal=function(i,a){a===void 0&&(a=null);var n=t.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(i,a,n),n},r.prototype.getAbsolutePositionFromLocalToRef=function(i,a,n){a===void 0&&(a=null);var s=null;a&&(s=a.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=r._tmpMats[0];a&&s?(o.copyFrom(this.getAbsoluteTransform()),o.multiplyToRef(s,o)):o=this.getAbsoluteTransform(),t.Vector3.TransformCoordinatesToRef(i,o,n)},r.prototype.getLocalPositionFromAbsolute=function(i,a){a===void 0&&(a=null);var n=t.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(i,a,n),n},r.prototype.getLocalPositionFromAbsoluteToRef=function(i,a,n){a===void 0&&(a=null);var s=null;a&&(s=a.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var o=r._tmpMats[0];o.copyFrom(this.getAbsoluteTransform()),a&&s&&o.multiplyToRef(s,o),o.invert(),t.Vector3.TransformCoordinatesToRef(i,o,n)},r._tmpVecs=[t.Vector3.Zero(),t.Vector3.Zero()],r._tmpQuat=t.Quaternion.Identity(),r._tmpMats=[t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity()],r}(t.Node);t.Bone=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){if(this.targetPosition=t.Vector3.Zero(),this.poleTargetPosition=t.Vector3.Zero(),this.poleTargetLocalOffset=t.Vector3.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=t.Quaternion.Identity(),this._bone1Mat=t.Matrix.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=t.Vector3.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=i,this._bone1=i.getParent(),!!this._bone1){this.mesh=r;var n=i.getPosition();if(i.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,n.x>n.y&&n.x>n.z&&(this._adjustRoll=Math.PI*.5,this._bendAxis.z=1)),this._bone1.length){var s=this._bone1.getScale(),o=this._bone2.getScale();this._bone1Length=this._bone1.length*s.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*o.y*this.mesh.scaling.y}else if(this._bone1.children[0]){r.computeWorldMatrix(!0);var l=this._bone2.children[0].getAbsolutePosition(r),u=this._bone2.getAbsolutePosition(r),h=this._bone1.getAbsolutePosition(r);this._bone1Length=t.Vector3.Distance(l,u),this._bone2Length=t.Vector3.Distance(u,h)}this._bone1.getRotationMatrixToRef(t.Space.WORLD,r,this._bone1Mat),this.maxAngle=Math.PI,a&&(a.targetMesh&&(this.targetMesh=a.targetMesh,this.targetMesh.computeWorldMatrix(!0)),a.poleTargetMesh?(this.poleTargetMesh=a.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):a.poleTargetBone?this.poleTargetBone=a.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),a.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(a.poleTargetLocalOffset),a.poleAngle&&(this.poleAngle=a.poleAngle),a.bendAxis&&this._bendAxis.copyFrom(a.bendAxis),a.maxAngle&&(this.maxAngle=a.maxAngle),a.slerpAmount&&(this.slerpAmount=a.slerpAmount))}}return Object.defineProperty(c.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(r){this._setMaxAngle(r)},enumerable:!0,configurable:!0}),c.prototype._setMaxAngle=function(r){r<0&&(r=0),(r>Math.PI||r==null)&&(r=Math.PI),this._maxAngle=r;var i=this._bone1Length,a=this._bone2Length;this._maxReach=Math.sqrt(i*i+a*a-2*i*a*Math.cos(r))},c.prototype.update=function(){var r=this._bone1;if(r){var i=this.targetPosition,a=this.poleTargetPosition,n=c._tmpMats[0],s=c._tmpMats[1];this.targetMesh&&i.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,a):this.poleTargetMesh&&t.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),a);var o=c._tmpVecs[0],l=c._tmpVecs[1],u=c._tmpVecs[2],h=c._tmpVecs[3],d=c._tmpVecs[4],p=c._tmpQuat;r.getAbsolutePositionToRef(this.mesh,o),a.subtractToRef(o,d),d.x==0&&d.y==0&&d.z==0?d.y=1:d.normalize(),i.subtractToRef(o,h),h.normalize(),t.Vector3.CrossToRef(h,d,l),l.normalize(),t.Vector3.CrossToRef(h,l,u),u.normalize(),t.Matrix.FromXYZAxesToRef(u,h,l,n);var m=this._bone1Length,_=this._bone2Length,v=t.Vector3.Distance(o,i);this._maxReach>0&&(v=Math.min(this._maxReach,v));var S=(_*_+v*v-m*m)/(2*_*v),P=(v*v+m*m-_*_)/(2*v*m);S>1&&(S=1),P>1&&(P=1),S<-1&&(S=-1),P<-1&&(P=-1);var x=Math.acos(S),R=Math.acos(P),w=-x-R;if(this._rightHandedSystem)t.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,s),s.multiplyToRef(n,n),t.Matrix.RotationAxisToRef(this._bendAxis,R,s),s.multiplyToRef(n,n);else{var I=c._tmpVecs[5];I.copyFrom(this._bendAxis),I.x*=-1,t.Matrix.RotationAxisToRef(I,-R,s),s.multiplyToRef(n,n)}this.poleAngle&&(t.Matrix.RotationAxisToRef(h,this.poleAngle,s),n.multiplyToRef(s,n)),this._bone1&&(this.slerpAmount<1?(this._slerping||t.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),t.Quaternion.FromRotationMatrixToRef(n,p),t.Quaternion.SlerpToRef(this._bone1Quat,p,this.slerpAmount,this._bone1Quat),w=this._bone2Ang*(1-this.slerpAmount)+w*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,t.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(n,t.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(n),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,w,t.Space.LOCAL),this._bone2Ang=w}},c._tmpVecs=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],c._tmpQuat=t.Quaternion.Identity(),c._tmpMats=[t.Matrix.Identity(),t.Matrix.Identity()],c}();t.BoneIKController=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n){if(this.upAxis=t.Vector3.Up(),this.upAxisSpace=t.Space.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=t.Quaternion.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=t.Vector3.Forward(),this.mesh=r,this.bone=i,this.target=a,n&&(n.adjustYaw&&(this.adjustYaw=n.adjustYaw),n.adjustPitch&&(this.adjustPitch=n.adjustPitch),n.adjustRoll&&(this.adjustRoll=n.adjustRoll),n.maxYaw!=null?this.maxYaw=n.maxYaw:this.maxYaw=Math.PI,n.minYaw!=null?this.minYaw=n.minYaw:this.minYaw=-Math.PI,n.maxPitch!=null?this.maxPitch=n.maxPitch:this.maxPitch=Math.PI,n.minPitch!=null?this.minPitch=n.minPitch:this.minPitch=-Math.PI,n.slerpAmount!=null&&(this.slerpAmount=n.slerpAmount),n.upAxis!=null&&(this.upAxis=n.upAxis),n.upAxisSpace!=null&&(this.upAxisSpace=n.upAxisSpace),n.yawAxis!=null||n.pitchAxis!=null)){var s=t.Axis.Y,o=t.Axis.X;n.yawAxis!=null&&(s=n.yawAxis.clone(),s.normalize()),n.pitchAxis!=null&&(o=n.pitchAxis.clone(),o.normalize());var l=t.Vector3.Cross(o,s);this._transformYawPitch=t.Matrix.Identity(),t.Matrix.FromXYZAxesToRef(o,s,l,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}!i.getParent()&&this.upAxisSpace==t.Space.BONE&&(this.upAxisSpace=t.Space.LOCAL)}return Object.defineProperty(c.prototype,"minYaw",{get:function(){return this._minYaw},set:function(r){this._minYaw=r,this._minYawSin=Math.sin(r),this._minYawCos=Math.cos(r),this._maxYaw!=null&&(this._midYawConstraint=this._getAngleDiff(this._minYaw,this._maxYaw)*.5+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(r){this._maxYaw=r,this._maxYawSin=Math.sin(r),this._maxYawCos=Math.cos(r),this._minYaw!=null&&(this._midYawConstraint=this._getAngleDiff(this._minYaw,this._maxYaw)*.5+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"minPitch",{get:function(){return this._minPitch},set:function(r){this._minPitch=r,this._minPitchTan=Math.tan(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(r){this._maxPitch=r,this._maxPitchTan=Math.tan(r)},enumerable:!0,configurable:!0}),c.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped){this._firstFrameSkipped=!0;return}var r=this.bone,i=c._tmpVecs[0];r.getAbsolutePositionToRef(this.mesh,i);var a=this.target,n=c._tmpMats[0],s=c._tmpMats[1],o=this.mesh,l=r.getParent(),u=c._tmpVecs[1];u.copyFrom(this.upAxis),this.upAxisSpace==t.Space.BONE&&l?(this._transformYawPitch&&t.Vector3.TransformCoordinatesToRef(u,this._transformYawPitchInv,u),l.getDirectionToRef(u,this.mesh,u)):this.upAxisSpace==t.Space.LOCAL&&(o.getDirectionToRef(u,u),(o.scaling.x!=1||o.scaling.y!=1||o.scaling.z!=1)&&u.normalize());var h=!1,d=!1;if((this._maxYaw!=Math.PI||this._minYaw!=-Math.PI)&&(h=!0),(this._maxPitch!=Math.PI||this._minPitch!=-Math.PI)&&(d=!0),h||d){var p=c._tmpMats[2],m=c._tmpMats[3];if(this.upAxisSpace==t.Space.BONE&&u.y==1&&l)l.getRotationMatrixToRef(t.Space.WORLD,this.mesh,p);else if(this.upAxisSpace==t.Space.LOCAL&&u.y==1&&!l)p.copyFrom(o.getWorldMatrix());else{var v=c._tmpVecs[2];v.copyFrom(this._fowardAxis),this._transformYawPitch&&t.Vector3.TransformCoordinatesToRef(v,this._transformYawPitchInv,v),l?l.getDirectionToRef(v,this.mesh,v):o.getDirectionToRef(v,v);var _=t.Vector3.Cross(u,v);_.normalize();var v=t.Vector3.Cross(_,u);t.Matrix.FromXYZAxesToRef(_,u,v,p)}p.invertToRef(m);var S=null;if(d){var P=c._tmpVecs[3];a.subtractToRef(i,P),t.Vector3.TransformCoordinatesToRef(P,m,P),S=Math.sqrt(P.x*P.x+P.z*P.z);var x=Math.atan2(P.y,S),R=x;x>this._maxPitch?(P.y=this._maxPitchTan*S,R=this._maxPitch):x<this._minPitch&&(P.y=this._minPitchTan*S,R=this._minPitch),x!=R&&(t.Vector3.TransformCoordinatesToRef(P,p,P),P.addInPlace(i),a=P)}if(h){var P=c._tmpVecs[4];a.subtractToRef(i,P),t.Vector3.TransformCoordinatesToRef(P,m,P);var w=Math.atan2(P.x,P.z),I=w;if((w>this._maxYaw||w<this._minYaw)&&(S==null&&(S=Math.sqrt(P.x*P.x+P.z*P.z)),this._yawRange>Math.PI?this._isAngleBetween(w,this._maxYaw,this._midYawConstraint)?(P.z=this._maxYawCos*S,P.x=this._maxYawSin*S,I=this._maxYaw):this._isAngleBetween(w,this._midYawConstraint,this._minYaw)&&(P.z=this._minYawCos*S,P.x=this._minYawSin*S,I=this._minYaw):w>this._maxYaw?(P.z=this._maxYawCos*S,P.x=this._maxYawSin*S,I=this._maxYaw):w<this._minYaw&&(P.z=this._minYawCos*S,P.x=this._minYawSin*S,I=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var F=c._tmpVecs[8];F.copyFrom(t.Axis.Z),this._transformYawPitch&&t.Vector3.TransformCoordinatesToRef(F,this._transformYawPitchInv,F);var k=c._tmpMats[4];this._boneQuat.toRotationMatrix(k),this.mesh.getWorldMatrix().multiplyToRef(k,k),t.Vector3.TransformCoordinatesToRef(F,k,F),t.Vector3.TransformCoordinatesToRef(F,m,F);var E=Math.atan2(F.x,F.z),g=this._getAngleBetween(E,w),y=this._getAngleBetween(E,this._midYawConstraint);if(g>y){S==null&&(S=Math.sqrt(P.x*P.x+P.z*P.z));var M=this._getAngleBetween(E,this._maxYaw),C=this._getAngleBetween(E,this._minYaw);C<M?(I=E+Math.PI*.75,P.z=Math.cos(I)*S,P.x=Math.sin(I)*S):(I=E-Math.PI*.75,P.z=Math.cos(I)*S,P.x=Math.sin(I)*S)}}w!=I&&(t.Vector3.TransformCoordinatesToRef(P,p,P),P.addInPlace(i),a=P)}}var D=c._tmpVecs[5],V=c._tmpVecs[6],G=c._tmpVecs[7],U=c._tmpQuat;a.subtractToRef(i,D),D.normalize(),t.Vector3.CrossToRef(u,D,V),V.normalize(),t.Vector3.CrossToRef(D,V,G),G.normalize(),t.Matrix.FromXYZAxesToRef(V,G,D,n),!(V.x===0&&V.y===0&&V.z===0)&&(G.x===0&&G.y===0&&G.z===0||D.x===0&&D.y===0&&D.z===0||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(t.Matrix.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,s),s.multiplyToRef(n,n)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(t.Space.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(n,n),t.Quaternion.FromRotationMatrixToRef(n,U),t.Quaternion.SlerpToRef(this._boneQuat,U,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,t.Space.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(n,n),this.bone.setRotationMatrix(n,t.Space.WORLD,this.mesh),this._slerping=!1)))},c.prototype._getAngleDiff=function(r,i){var a=i-r;return a%=Math.PI*2,a>Math.PI?a-=Math.PI*2:a<-Math.PI&&(a+=Math.PI*2),a},c.prototype._getAngleBetween=function(r,i){r%=2*Math.PI,r=r<0?r+2*Math.PI:r,i%=2*Math.PI,i=i<0?i+2*Math.PI:i;var a=0;return r<i?a=i-r:a=r-i,a>Math.PI&&(a=Math.PI*2-a),a},c.prototype._isAngleBetween=function(r,i,a){if(r%=2*Math.PI,r=r<0?r+2*Math.PI:r,i%=2*Math.PI,i=i<0?i+2*Math.PI:i,a%=2*Math.PI,a=a<0?a+2*Math.PI:a,i<a){if(r>i&&r<a)return!0}else if(r>a&&r<i)return!0;return!1},c._tmpVecs=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],c._tmpQuat=t.Quaternion.Identity(),c._tmpMats=[t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity(),t.Matrix.Identity()],c}();t.BoneLookController=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){this.name=r,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=t.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this.doNotSerialize=!1,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new t.Observable,this.bones=[],this._scene=a||t.Engine.LastCreatedScene,a.skeletons.push(this),this._isDirty=!0}return Object.defineProperty(c.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(r){this._animationPropertiesOverride=r},enumerable:!0,configurable:!0}),c.prototype.getTransformMatrices=function(r){return this.needInitialSkinMatrix&&r._bonesTransformMatrices?r._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},c.prototype.getScene=function(){return this._scene},c.prototype.toString=function(r){var i="Name: "+this.name+", nBones: "+this.bones.length;if(i+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),r){i+=", Ranges: {";var a=!0;for(var n in this._ranges)a&&(i+=", ",a=!1),i+=n;i+="}"}return i},c.prototype.getBoneIndexByName=function(r){for(var i=0,a=this.bones.length;i<a;i++)if(this.bones[i].name===r)return i;return-1},c.prototype.createAnimationRange=function(r,i,a){if(!this._ranges[r]){this._ranges[r]=new t.AnimationRange(r,i,a);for(var n=0,s=this.bones.length;n<s;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(r,i,a)}},c.prototype.deleteAnimationRange=function(r,i){i===void 0&&(i=!0);for(var a=0,n=this.bones.length;a<n;a++)this.bones[a].animations[0]&&this.bones[a].animations[0].deleteRange(r,i);this._ranges[r]=null},c.prototype.getAnimationRange=function(r){return this._ranges[r]},c.prototype.getAnimationRanges=function(){var r=[],i,a=0;for(i in this._ranges)r[a]=this._ranges[i],a++;return r},c.prototype.copyAnimationRange=function(r,i,a){if(a===void 0&&(a=!1),this._ranges[i]||!r.getAnimationRange(i))return!1;var n=!0,s=this._getHighestAnimationFrame()+1,o={},l=r.bones,u,h;for(h=0,u=l.length;h<u;h++)o[l[h].name]=l[h];this.bones.length!==l.length&&(t.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+l.length),n=!1);var d=a&&this.dimensionsAtRest&&r.dimensionsAtRest?this.dimensionsAtRest.divide(r.dimensionsAtRest):null;for(h=0,u=this.bones.length;h<u;h++){var p=this.bones[h].name,m=o[p];m?n=n&&this.bones[h].copyAnimationRange(m,i,s,a,d):(t.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+p),n=!1)}var _=r.getAnimationRange(i);return _&&(this._ranges[i]=new t.AnimationRange(i,_.from+s,_.to+s)),n},c.prototype.returnToRest=function(){for(var r=0;r<this.bones.length;r++)this.bones[r].returnToRest()},c.prototype._getHighestAnimationFrame=function(){for(var r=0,i=0,a=this.bones.length;i<a;i++)if(this.bones[i].animations[0]){var n=this.bones[i].animations[0].getHighestFrame();r<n&&(r=n)}return r},c.prototype.beginAnimation=function(r,i,a,n){var s=this.getAnimationRange(r);return s?this._scene.beginAnimation(this,s.from,s.to,i,a,n):null},c.prototype._markAsDirty=function(){this._isDirty=!0},c.prototype._registerMeshWithPoseMatrix=function(r){this._meshesWithPoseMatrix.push(r)},c.prototype._unregisterMeshWithPoseMatrix=function(r){var i=this._meshesWithPoseMatrix.indexOf(r);i>-1&&this._meshesWithPoseMatrix.splice(i,1)},c.prototype._computeTransformMatrices=function(r,i){this.onBeforeComputeObservable.notifyObservers(this);for(var a=0;a<this.bones.length;a++){var n=this.bones[a],s=n.getParent();if(s?n.getLocalMatrix().multiplyToRef(s.getWorldMatrix(),n.getWorldMatrix()):i?n.getLocalMatrix().multiplyToRef(i,n.getWorldMatrix()):n.getWorldMatrix().copyFrom(n.getLocalMatrix()),n._index!==-1){var o=n._index===null?a:n._index;n.getInvertedAbsoluteTransform().multiplyToArray(n.getWorldMatrix(),r,o*16)}}this._identity.copyToArray(r,this.bones.length*16)},c.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var i=this._meshesWithPoseMatrix[r],a=i.getPoseMatrix();if((!i._bonesTransformMatrices||i._bonesTransformMatrices.length!==16*(this.bones.length+1))&&(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==i){this._synchronizedWithMesh=i;for(var n=0;n<this.bones.length;n++){var s=this.bones[n];if(!s.getParent()){var o=s.getBaseMatrix();o.multiplyToRef(a,t.Tmp.Matrix[1]),s._updateDifferenceMatrix(t.Tmp.Matrix[1])}}}this._computeTransformMatrices(i._bonesTransformMatrices,a)}else(!this._transformMatrices||this._transformMatrices.length!==16*(this.bones.length+1))&&(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},c.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var r=0;r<this.bones.length;r++)this._animatables.push(this.bones[r])}return this._animatables},c.prototype.clone=function(r,i){var a=new c(r,i||r,this._scene);a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var n=0;n<this.bones.length;n++){var s=this.bones[n],o=null,l=s.getParent();if(l){var u=this.bones.indexOf(l);o=a.bones[u]}var h=new t.Bone(s.name,a,o,s.getBaseMatrix().clone(),s.getRestPose().clone());t.Tools.DeepCopy(s.animations,h.animations)}if(this._ranges){a._ranges={};for(var d in this._ranges){var p=this._ranges[d];p&&(a._ranges[d]=p.clone())}}return this._isDirty=!0,a},c.prototype.enableBlending=function(r){r===void 0&&(r=.01),this.bones.forEach(function(i){i.animations.forEach(function(a){a.enableBlending=!0,a.blendingSpeed=r})})},c.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},c.prototype.serialize=function(){var r={};r.name=this.name,r.id=this.id,this.dimensionsAtRest&&(r.dimensionsAtRest=this.dimensionsAtRest.asArray()),r.bones=[],r.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var i=0;i<this.bones.length;i++){var a=this.bones[i],n=a.getParent(),s={parentBoneIndex:n?this.bones.indexOf(n):-1,name:a.name,matrix:a.getBaseMatrix().toArray(),rest:a.getRestPose().toArray()};r.bones.push(s),a.length&&(s.length=a.length),a.metadata&&(s.metadata=a.metadata),a.animations&&a.animations.length>0&&(s.animation=a.animations[0].serialize()),r.ranges=[];for(var o in this._ranges){var l=this._ranges[o];if(l){var u={};u.name=o,u.from=l.from,u.to=l.to,r.ranges.push(u)}}}return r},c.Parse=function(r,i){var a=new c(r.name,r.id,i);r.dimensionsAtRest&&(a.dimensionsAtRest=t.Vector3.FromArray(r.dimensionsAtRest)),a.needInitialSkinMatrix=r.needInitialSkinMatrix;var n;for(n=0;n<r.bones.length;n++){var s=r.bones[n],o=null;s.parentBoneIndex>-1&&(o=a.bones[s.parentBoneIndex]);var l=s.rest?t.Matrix.FromArray(s.rest):null,u=new t.Bone(s.name,a,o,t.Matrix.FromArray(s.matrix),l);s.id!==void 0&&s.id!==null&&(u.id=s.id),s.length&&(u.length=s.length),s.metadata&&(u.metadata=s.metadata),s.animation&&u.animations.push(t.Animation.Parse(s.animation))}if(r.ranges)for(n=0;n<r.ranges.length;n++){var h=r.ranges[n];a.createAnimationRange(h.name,h.from,h.to)}return a},c.prototype.computeAbsoluteTransforms=function(r){r===void 0&&(r=!1);var i=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=i||r)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=i)},c.prototype.getPoseMatrix=function(){var r=null;return this._meshesWithPoseMatrix.length>0&&(r=this._meshesWithPoseMatrix[0].getPoseMatrix()),r},c.prototype.sortBones=function(){for(var r=new Array,i=new Array(this.bones.length),a=0;a<this.bones.length;a++)this._sortBones(a,r,i);this.bones=r},c.prototype._sortBones=function(r,i,a){if(!a[r]){a[r]=!0;var n=this.bones[r];n._index===void 0&&(n._index=r);var s=n.getParent();s&&this._sortBones(this.bones.indexOf(s),i,a),i.push(n)}},c}();t.Skeleton=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.Ldexp=function(r,i){return i>1023?r*Math.pow(2,1023)*Math.pow(2,i-1023):i<-1074?r*Math.pow(2,-1074)*Math.pow(2,i+1074):r*Math.pow(2,i)},c.Rgbe2float=function(r,i,a,n,s,o){s>0?(s=this.Ldexp(1,s-136),r[o+0]=i*s,r[o+1]=a*s,r[o+2]=n*s):(r[o+0]=0,r[o+1]=0,r[o+2]=0)},c.readStringLine=function(r,i){for(var a="",n="",s=i;s<r.length-i&&(n=String.fromCharCode(r[s]),n!=`
`);s++)a+=n;return a},c.RGBE_ReadHeader=function(r){var i=0,a=0,n=this.readStringLine(r,0);if(n[0]!="#"||n[1]!="?")throw"Bad HDR Format.";var s=!1,o=!1,l=0;do l+=n.length+1,n=this.readStringLine(r,l),n=="FORMAT=32-bit_rle_rgbe"?o=!0:n.length==0&&(s=!0);while(!s);if(!o)throw"HDR Bad header format, unsupported FORMAT";l+=n.length+1,n=this.readStringLine(r,l);var u=/^\-Y (.*) \+X (.*)$/g,h=u.exec(n);if(!h||h.length<3)throw"HDR Bad header format, no size";if(a=parseInt(h[2]),i=parseInt(h[1]),a<8||a>32767)throw"HDR Bad header format, unsupported size";return l+=n.length+1,{height:i,width:a,dataPosition:l}},c.GetCubeMapTextureData=function(r,i){var a=new Uint8Array(r),n=this.RGBE_ReadHeader(a),s=this.RGBE_ReadPixels_RLE(a,n),o=t.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(s,n.width,n.height,i);return o},c.RGBE_ReadPixels=function(r,i){return this.RGBE_ReadPixels_RLE(r,i)},c.RGBE_ReadPixels_RLE=function(r,i){for(var a=i.height,n=i.width,s,o,l,u,h,d=i.dataPosition,p=0,m=0,_=0,v=new ArrayBuffer(n*4),S=new Uint8Array(v),P=new ArrayBuffer(i.width*i.height*4*3),x=new Float32Array(P);a>0;){if(s=r[d++],o=r[d++],l=r[d++],u=r[d++],s!=2||o!=2||l&128)throw"HDR Bad header format, not RLE";if((l<<8|u)!=n)throw"HDR Bad header format, wrong scan line width";for(p=0,_=0;_<4;_++)for(m=(_+1)*n;p<m;)if(s=r[d++],o=r[d++],s>128){if(h=s-128,h==0||h>m-p)throw"HDR Bad Format, bad scanline data (run)";for(;h-- >0;)S[p++]=o}else{if(h=s,h==0||h>m-p)throw"HDR Bad Format, bad scanline data (non-run)";if(S[p++]=o,--h>0)for(var R=0;R<h;R++)S[p++]=r[d++]}for(_=0;_<n;_++)s=S[_],o=S[_+n],l=S[_+2*n],u=S[_+3*n],this.Rgbe2float(x,s,o,l,u,(i.height-a)*n*3+_*3);a--}return x},c}();t.HDRTools=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h,d){s===void 0&&(s=!1),o===void 0&&(o=!0),l===void 0&&(l=!1),u===void 0&&(u=!1),h===void 0&&(h=null),d===void 0&&(d=null);var p=c.call(this,a)||this;return p._generateHarmonics=!0,p._onLoad=null,p._onError=null,p.coordinatesMode=t.Texture.CUBIC_MODE,p._isBlocking=!0,p._rotationY=0,p.boundingBoxPosition=t.Vector3.Zero(),i&&(p.name=i,p.url=i,p.hasAlpha=!1,p.isCube=!0,p._textureMatrix=t.Matrix.Identity(),p._onLoad=h,p._onError=d,p.gammaSpace=l,p._noMipmap=s,p._size=n,p._texture=p._getFromCache(i,p._noMipmap),p._texture||(a.useDelayedTextureLoading?p.delayLoadState=t.Engine.DELAYLOADSTATE_NOTLOADED:p.loadTexture())),p}return Object.defineProperty(r.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(i){this._isBlocking=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rotationY",{get:function(){return this._rotationY},set:function(i){this._rotationY=i,this.setReflectionTextureMatrix(t.Matrix.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(i){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(i))){this._boundingBoxSize=i;var a=this.getScene();a&&a.markAllMaterialsAsDirty(t.Material.TextureDirtyFlag)}},enumerable:!0,configurable:!0}),r.prototype.loadTexture=function(){var i=this,a=function(s){i.lodGenerationOffset=0,i.lodGenerationScale=.8;var o=i.getScene();if(!o)return null;var l=t.HDRTools.GetCubeMapTextureData(s,i._size);if(i._generateHarmonics){var u=t.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(l);i.sphericalPolynomial=u}for(var h=[],d=null,p=0;p<6;p++){if(!o.getEngine().getCaps().textureFloat){var m=new ArrayBuffer(i._size*i._size*3);d=new Uint8Array(m)}var _=l[r._facesMapping[p]];if(i.gammaSpace||d){for(var v=0;v<i._size*i._size;v++)if(i.gammaSpace&&(_[v*3+0]=Math.pow(_[v*3+0],t.ToGammaSpace),_[v*3+1]=Math.pow(_[v*3+1],t.ToGammaSpace),_[v*3+2]=Math.pow(_[v*3+2],t.ToGammaSpace)),d){var S=Math.max(_[v*3+0]*255,0),P=Math.max(_[v*3+1]*255,0),x=Math.max(_[v*3+2]*255,0),R=Math.max(Math.max(S,P),x);if(R>255){var w=255/R;S*=w,P*=w,x*=w}d[v*3+0]=S,d[v*3+1]=P,d[v*3+2]=x}}d?h.push(d):h.push(_)}return h},n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,t.Engine.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?t.Engine.TEXTURETYPE_FLOAT:t.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,a,null,this._onLoad,this._onError))},r.prototype.clone=function(){var i=this.getScene();if(!i)return this;var a=new r(this.url,i,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return a.level=this.level,a.wrapU=this.wrapU,a.wrapV=this.wrapV,a.coordinatesIndex=this.coordinatesIndex,a.coordinatesMode=this.coordinatesMode,a},r.prototype.delayLoad=function(){this.delayLoadState===t.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=t.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},r.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},r.prototype.setReflectionTextureMatrix=function(i){this._textureMatrix=i},r.Parse=function(i,a,n){var s=null;return i.name&&!i.isRenderTarget&&(s=new r(n+i.name,a,i.size,i.noMipmap,i.generateHarmonics,i.useInGammaSpace),s.name=i.name,s.hasAlpha=i.hasAlpha,s.level=i.level,s.coordinatesMode=i.coordinatesMode,s.isBlocking=i.isBlocking),s&&(i.boundingBoxPosition&&(s.boundingBoxPosition=t.Vector3.FromArray(i.boundingBoxPosition)),i.boundingBoxSize&&(s.boundingBoxSize=t.Vector3.FromArray(i.boundingBoxSize)),i.rotationY&&(s.rotationY=i.rotationY)),s},r.prototype.serialize=function(){if(!this.name)return null;var i={};return i.name=this.name,i.hasAlpha=this.hasAlpha,i.isCube=!0,i.level=this.level,i.size=this._size,i.coordinatesMode=this.coordinatesMode,i.useInGammaSpace=this.gammaSpace,i.generateHarmonics=this._generateHarmonics,i.customType="BABYLON.HDRCubeTexture",i.noMipmap=this._noMipmap,i.isBlocking=this._isBlocking,i.rotationY=this._rotationY,i},r._facesMapping=["right","left","up","down","front","back"],r}(t.BaseTexture);t.HDRCubeTexture=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.ConvertPanoramaToCubemap=function(r,i,a,n){if(!r)throw"ConvertPanoramaToCubemap: input cannot be null";if(r.length!=i*a*3)throw"ConvertPanoramaToCubemap: input size is wrong";var s=this.CreateCubemapTexture(n,this.FACE_FRONT,r,i,a),o=this.CreateCubemapTexture(n,this.FACE_BACK,r,i,a),l=this.CreateCubemapTexture(n,this.FACE_LEFT,r,i,a),u=this.CreateCubemapTexture(n,this.FACE_RIGHT,r,i,a),h=this.CreateCubemapTexture(n,this.FACE_UP,r,i,a),d=this.CreateCubemapTexture(n,this.FACE_DOWN,r,i,a);return{front:s,back:o,left:l,right:u,up:h,down:d,size:n,type:t.Engine.TEXTURETYPE_FLOAT,format:t.Engine.TEXTUREFORMAT_RGB,gammaSpace:!1}},c.CreateCubemapTexture=function(r,i,a,n,s){for(var o=new ArrayBuffer(r*r*4*3),l=new Float32Array(o),u=i[1].subtract(i[0]).scale(1/r),h=i[3].subtract(i[2]).scale(1/r),d=1/r,p=0,m=0;m<r;m++){for(var _=i[0],v=i[2],S=0;S<r;S++){var P=v.subtract(_).scale(p).add(_);P.normalize();var x=this.CalcProjectionSpherical(P,a,n,s);l[m*r*3+S*3+0]=x.r,l[m*r*3+S*3+1]=x.g,l[m*r*3+S*3+2]=x.b,_=_.add(u),v=v.add(h)}p+=d}return l},c.CalcProjectionSpherical=function(r,i,a,n){for(var s=Math.atan2(r.z,r.x),o=Math.acos(r.y);s<-Math.PI;)s+=2*Math.PI;for(;s>Math.PI;)s-=2*Math.PI;var l=s/Math.PI,u=o/Math.PI;l=l*.5+.5;var h=Math.round(l*a);h<0?h=0:h>=a&&(h=a-1);var d=Math.round(u*n);d<0?d=0:d>=n&&(d=n-1);var p=n-d-1,m=i[p*a*3+h*3+0],_=i[p*a*3+h*3+1],v=i[p*a*3+h*3+2];return{r:m,g:_,b:v}},c.FACE_FRONT=[new t.Vector3(-1,-1,-1),new t.Vector3(1,-1,-1),new t.Vector3(-1,1,-1),new t.Vector3(1,1,-1)],c.FACE_BACK=[new t.Vector3(1,-1,1),new t.Vector3(-1,-1,1),new t.Vector3(1,1,1),new t.Vector3(-1,1,1)],c.FACE_RIGHT=[new t.Vector3(1,-1,-1),new t.Vector3(1,-1,1),new t.Vector3(1,1,-1),new t.Vector3(1,1,1)],c.FACE_LEFT=[new t.Vector3(-1,-1,1),new t.Vector3(-1,-1,-1),new t.Vector3(-1,1,1),new t.Vector3(-1,1,-1)],c.FACE_DOWN=[new t.Vector3(-1,1,-1),new t.Vector3(1,1,-1),new t.Vector3(-1,1,1),new t.Vector3(1,1,1)],c.FACE_UP=[new t.Vector3(-1,-1,1),new t.Vector3(1,-1,1),new t.Vector3(-1,-1,-1),new t.Vector3(1,-1,-1)],c}();t.PanoramaToCubeMapTools=f})(T||(T={}));var T;(function(t){var f=function(a){N(n,a);function n(s,o){var l=a.call(this,s.x,s.y)||this;return l.index=o,l}return n}(t.Vector2),c=function(){function a(){this.elements=new Array}return a.prototype.add=function(n){var s=this,o=new Array;return n.forEach(function(l){if(o.length===0||!l.equalsWithEpsilon(o[0])){var u=new f(l,s.elements.length);o.push(u),s.elements.push(u)}}),o},a.prototype.computeBounds=function(){var n=new t.Vector2(this.elements[0].x,this.elements[0].y),s=new t.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(o){o.x<n.x?n.x=o.x:o.x>s.x&&(s.x=o.x),o.y<n.y?n.y=o.y:o.y>s.y&&(s.y=o.y)}),{min:n,max:s,width:s.x-n.x,height:s.y-n.y}},a}(),r=function(){function a(){}return a.Rectangle=function(n,s,o,l){return[new t.Vector2(n,s),new t.Vector2(o,s),new t.Vector2(o,l),new t.Vector2(n,l)]},a.Circle=function(n,s,o,l){s===void 0&&(s=0),o===void 0&&(o=0),l===void 0&&(l=32);for(var u=new Array,h=0,d=Math.PI*2/l,p=0;p<l;p++)u.push(new t.Vector2(s+Math.cos(h)*n,o+Math.sin(h)*n)),h-=d;return u},a.Parse=function(n){var s=n.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(u){return!isNaN(u)}),o,l=[];for(o=0;o<(s.length&2147483646);o+=2)l.push(new t.Vector2(s[o],s[o+1]));return l},a.StartingAt=function(n,s){return t.Path2.StartingAt(n,s)},a}();t.Polygon=r;var i=function(){function a(n,s,o){this._points=new c,this._outlinepoints=new c,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this._name=n,this._scene=o;var l;s instanceof t.Path2?l=s.getPoints():l=s,this._addToepoint(l),this._points.add(l),this._outlinepoints.add(l),typeof earcut>"u"&&t.Tools.Warn("Earcut was not found, the polygon will not be built.")}return a.prototype._addToepoint=function(n){for(var s=0,o=n;s<o.length;s++){var l=o[s];this._epoints.push(l.x,l.y)}},a.prototype.addHole=function(n){this._points.add(n);var s=new c;return s.add(n),this._holes.push(s),this._eholes.push(this._epoints.length/2),this._addToepoint(n),this},a.prototype.build=function(n,s){var o=this;n===void 0&&(n=!1),s===void 0&&(s=0);var l=new t.Mesh(this._name,this._scene),u=new Array,h=new Array,d=new Array,p=this._points.computeBounds();this._points.elements.forEach(function(I){u.push(0,1,0),h.push(I.x,0,I.y),d.push((I.x-p.min.x)/p.width,(I.y-p.min.y)/p.height)});for(var m=new Array,_=earcut(this._epoints,this._eholes,2),v=0;v<_.length;v++)m.push(_[v]);if(s>0){var S=h.length/3;this._points.elements.forEach(function(I){u.push(0,-1,0),h.push(I.x,-s,I.y),d.push(1-(I.x-p.min.x)/p.width,1-(I.y-p.min.y)/p.height)});for(var P=m.length,v=0;v<P;v+=3){var x=m[v+0],R=m[v+1],w=m[v+2];m.push(w+S),m.push(R+S),m.push(x+S)}this.addSide(h,u,d,m,p,this._outlinepoints,s,!1),this._holes.forEach(function(I){o.addSide(h,u,d,m,p,I,s,!0)})}return l.setVerticesData(t.VertexBuffer.PositionKind,h,n),l.setVerticesData(t.VertexBuffer.NormalKind,u,n),l.setVerticesData(t.VertexBuffer.UVKind,d,n),l.setIndices(m),l},a.prototype.addSide=function(n,s,o,l,u,h,d,p){for(var m=n.length/3,_=0,v=0;v<h.elements.length;v++){var S=h.elements[v],P;v+1>h.elements.length-1?P=h.elements[0]:P=h.elements[v+1],n.push(S.x,0,S.y),n.push(S.x,-d,S.y),n.push(P.x,0,P.y),n.push(P.x,-d,P.y);var x=new t.Vector3(S.x,0,S.y),R=new t.Vector3(P.x,0,P.y),w=R.subtract(x),I=new t.Vector3(0,1,0),F=t.Vector3.Cross(w,I);F=F.normalize(),o.push(_/u.width,0),o.push(_/u.width,1),_+=w.length(),o.push(_/u.width,0),o.push(_/u.width,1),p?(s.push(F.x,F.y,F.z),s.push(F.x,F.y,F.z),s.push(F.x,F.y,F.z),s.push(F.x,F.y,F.z),l.push(m),l.push(m+2),l.push(m+1),l.push(m+1),l.push(m+2),l.push(m+3)):(s.push(-F.x,-F.y,-F.z),s.push(-F.x,-F.y,-F.z),s.push(-F.x,-F.y,-F.z),s.push(-F.x,-F.y,-F.z),l.push(m),l.push(m+1),l.push(m+2),l.push(m+1),l.push(m+3),l.push(m+2)),m+=4}},a}();t.PolygonMeshBuilder=i})(T||(T={}));var T;(function(t){var f=0,c=function(){function s(o,l,u){this.pos=o,this.normal=l,this.uv=u}return s.prototype.clone=function(){return new s(this.pos.clone(),this.normal.clone(),this.uv.clone())},s.prototype.flip=function(){this.normal=this.normal.scale(-1)},s.prototype.interpolate=function(o,l){return new s(t.Vector3.Lerp(this.pos,o.pos,l),t.Vector3.Lerp(this.normal,o.normal,l),t.Vector2.Lerp(this.uv,o.uv,l))},s}(),r=function(){function s(o,l){this.normal=o,this.w=l}return s.FromPoints=function(o,l,u){var h=u.subtract(o),d=l.subtract(o);if(h.lengthSquared()===0||d.lengthSquared()===0)return null;var p=t.Vector3.Normalize(t.Vector3.Cross(h,d));return new s(p,t.Vector3.Dot(p,o))},s.prototype.clone=function(){return new s(this.normal.clone(),this.w)},s.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},s.prototype.splitPolygon=function(o,l,u,h,d){var p=0,m=1,_=2,v=3,S=0,P=[],x,R;for(x=0;x<o.vertices.length;x++){R=t.Vector3.Dot(this.normal,o.vertices[x].pos)-this.w;var w=R<-s.EPSILON?_:R>s.EPSILON?m:p;S|=w,P.push(w)}switch(S){case p:(t.Vector3.Dot(this.normal,o.plane.normal)>0?l:u).push(o);break;case m:h.push(o);break;case _:d.push(o);break;case v:var I=[],F=[];for(x=0;x<o.vertices.length;x++){var k=(x+1)%o.vertices.length,E=P[x],g=P[k],y=o.vertices[x],M=o.vertices[k];if(E!==_&&I.push(y),E!==m&&F.push(E!==_?y.clone():y),(E|g)===v){R=(this.w-t.Vector3.Dot(this.normal,y.pos))/t.Vector3.Dot(this.normal,M.pos.subtract(y.pos));var C=y.interpolate(M,R);I.push(C),F.push(C.clone())}}var D;I.length>=3&&(D=new i(I,o.shared),D.plane&&h.push(D)),F.length>=3&&(D=new i(F,o.shared),D.plane&&d.push(D));break}},s.EPSILON=1e-5,s}(),i=function(){function s(o,l){this.vertices=o,this.shared=l,this.plane=r.FromPoints(o[0].pos,o[1].pos,o[2].pos)}return s.prototype.clone=function(){var o=this.vertices.map(function(l){return l.clone()});return new s(o,this.shared)},s.prototype.flip=function(){this.vertices.reverse().map(function(o){o.flip()}),this.plane.flip()},s}(),a=function(){function s(o){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,o&&this.build(o)}return s.prototype.clone=function(){var o=new s;return o.plane=this.plane&&this.plane.clone(),o.front=this.front&&this.front.clone(),o.back=this.back&&this.back.clone(),o.polygons=this.polygons.map(function(l){return l.clone()}),o},s.prototype.invert=function(){for(var o=0;o<this.polygons.length;o++)this.polygons[o].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var l=this.front;this.front=this.back,this.back=l},s.prototype.clipPolygons=function(o){if(!this.plane)return o.slice();for(var l=new Array,u=new Array,h=0;h<o.length;h++)this.plane.splitPolygon(o[h],l,u,l,u);return this.front&&(l=this.front.clipPolygons(l)),this.back?u=this.back.clipPolygons(u):u=[],l.concat(u)},s.prototype.clipTo=function(o){this.polygons=o.clipPolygons(this.polygons),this.front&&this.front.clipTo(o),this.back&&this.back.clipTo(o)},s.prototype.allPolygons=function(){var o=this.polygons.slice();return this.front&&(o=o.concat(this.front.allPolygons())),this.back&&(o=o.concat(this.back.allPolygons())),o},s.prototype.build=function(o){if(o.length){this.plane||(this.plane=o[0].plane.clone());for(var l=new Array,u=new Array,h=0;h<o.length;h++)this.plane.splitPolygon(o[h],this.polygons,this.polygons,l,u);l.length&&(this.front||(this.front=new s),this.front.build(l)),u.length&&(this.back||(this.back=new s),this.back.build(u))}},s}(),n=function(){function s(){this.polygons=new Array}return s.FromMesh=function(o){var l,u,h,d,p,m=new Array,_,v,S,P,x=null,R;if(o instanceof t.Mesh)o.computeWorldMatrix(!0),v=o.getWorldMatrix(),S=o.position.clone(),P=o.rotation.clone(),o.rotationQuaternion&&(x=o.rotationQuaternion.clone()),R=o.scaling.clone();else throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";for(var w=o.getIndices(),I=o.getVerticesData(t.VertexBuffer.PositionKind),F=o.getVerticesData(t.VertexBuffer.NormalKind),k=o.getVerticesData(t.VertexBuffer.UVKind),E=o.subMeshes,g=0,y=E.length;g<y;g++)for(var M=E[g].indexStart,C=E[g].indexCount+E[g].indexStart;M<C;M+=3){_=[];for(var D=0;D<3;D++){var V=new t.Vector3(F[w[M+D]*3],F[w[M+D]*3+1],F[w[M+D]*3+2]);h=new t.Vector2(k[w[M+D]*2],k[w[M+D]*2+1]);var G=new t.Vector3(I[w[M+D]*3],I[w[M+D]*3+1],I[w[M+D]*3+2]);d=t.Vector3.TransformCoordinates(G,v),u=t.Vector3.TransformNormal(V,v),l=new c(d,u,h),_.push(l)}p=new i(_,{subMeshId:g,meshId:f,materialIndex:E[g].materialIndex}),p.plane&&m.push(p)}var U=s.FromPolygons(m);return U.matrix=v,U.position=S,U.rotation=P,U.scaling=R,U.rotationQuaternion=x,f++,U},s.FromPolygons=function(o){var l=new s;return l.polygons=o,l},s.prototype.clone=function(){var o=new s;return o.polygons=this.polygons.map(function(l){return l.clone()}),o.copyTransformAttributes(this),o},s.prototype.union=function(o){var l=new a(this.clone().polygons),u=new a(o.clone().polygons);return l.clipTo(u),u.clipTo(l),u.invert(),u.clipTo(l),u.invert(),l.build(u.allPolygons()),s.FromPolygons(l.allPolygons()).copyTransformAttributes(this)},s.prototype.unionInPlace=function(o){var l=new a(this.polygons),u=new a(o.polygons);l.clipTo(u),u.clipTo(l),u.invert(),u.clipTo(l),u.invert(),l.build(u.allPolygons()),this.polygons=l.allPolygons()},s.prototype.subtract=function(o){var l=new a(this.clone().polygons),u=new a(o.clone().polygons);return l.invert(),l.clipTo(u),u.clipTo(l),u.invert(),u.clipTo(l),u.invert(),l.build(u.allPolygons()),l.invert(),s.FromPolygons(l.allPolygons()).copyTransformAttributes(this)},s.prototype.subtractInPlace=function(o){var l=new a(this.polygons),u=new a(o.polygons);l.invert(),l.clipTo(u),u.clipTo(l),u.invert(),u.clipTo(l),u.invert(),l.build(u.allPolygons()),l.invert(),this.polygons=l.allPolygons()},s.prototype.intersect=function(o){var l=new a(this.clone().polygons),u=new a(o.clone().polygons);return l.invert(),u.clipTo(l),u.invert(),l.clipTo(u),u.clipTo(l),l.build(u.allPolygons()),l.invert(),s.FromPolygons(l.allPolygons()).copyTransformAttributes(this)},s.prototype.intersectInPlace=function(o){var l=new a(this.polygons),u=new a(o.polygons);l.invert(),u.clipTo(l),u.invert(),l.clipTo(u),u.clipTo(l),l.build(u.allPolygons()),l.invert(),this.polygons=l.allPolygons()},s.prototype.inverse=function(){var o=this.clone();return o.inverseInPlace(),o},s.prototype.inverseInPlace=function(){this.polygons.map(function(o){o.flip()})},s.prototype.copyTransformAttributes=function(o){return this.matrix=o.matrix,this.position=o.position,this.rotation=o.rotation,this.scaling=o.scaling,this.rotationQuaternion=o.rotationQuaternion,this},s.prototype.buildMeshGeometry=function(o,l,u){var h=this.matrix.clone();h.invert();var d=new t.Mesh(o,l),p=[],m=[],_=[],v=[],S=t.Vector3.Zero(),P=t.Vector3.Zero(),x=t.Vector2.Zero(),R=this.polygons,w=[0,0,0],I,F={},k,E=0,g={},y;u&&R.sort(function(j,ee){return j.shared.meshId===ee.shared.meshId?j.shared.subMeshId-ee.shared.subMeshId:j.shared.meshId-ee.shared.meshId});for(var M=0,C=R.length;M<C;M++){I=R[M],g[I.shared.meshId]||(g[I.shared.meshId]={}),g[I.shared.meshId][I.shared.subMeshId]||(g[I.shared.meshId][I.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:I.shared.materialIndex}),y=g[I.shared.meshId][I.shared.subMeshId];for(var D=2,V=I.vertices.length;D<V;D++){w[0]=0,w[1]=D-1,w[2]=D;for(var G=0;G<3;G++){S.copyFrom(I.vertices[w[G]].pos),P.copyFrom(I.vertices[w[G]].normal),x.copyFrom(I.vertices[w[G]].uv);var U=t.Vector3.TransformCoordinates(S,h),z=t.Vector3.TransformNormal(P,h);k=F[U.x+","+U.y+","+U.z],typeof k<"u"&&_[k*3]===z.x&&_[k*3+1]===z.y&&_[k*3+2]===z.z&&v[k*2]===x.x&&v[k*2+1]===x.y||(p.push(U.x,U.y,U.z),v.push(x.x,x.y),_.push(P.x,P.y,P.z),k=F[U.x+","+U.y+","+U.z]=p.length/3-1),m.push(k),y.indexStart=Math.min(E,y.indexStart),y.indexEnd=Math.max(E,y.indexEnd),E++}}}if(d.setVerticesData(t.VertexBuffer.PositionKind,p),d.setVerticesData(t.VertexBuffer.NormalKind,_),d.setVerticesData(t.VertexBuffer.UVKind,v),d.setIndices(m,null),u){var H=0,W;d.subMeshes=new Array;for(var X in g){W=-1;for(var K in g[X])y=g[X][K],t.SubMesh.CreateFromIndices(y.materialIndex+H,y.indexStart,y.indexEnd-y.indexStart+1,d),W=Math.max(y.materialIndex,W);H+=++W}}return d},s.prototype.toMesh=function(o,l,u,h){var d=this.buildMeshGeometry(o,u,h);return d.material=l,d.position.copyFrom(this.position),d.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(d.rotationQuaternion=this.rotationQuaternion.clone()),d.scaling.copyFrom(this.scaling),d.computeWorldMatrix(!0),d},s}();t.CSG=n})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s){this.size=r,this.position=i,this.alphaMode=t.Engine.ALPHA_ONEONE,this.color=a||new t.Color3(1,1,1),this.texture=n?new t.Texture(n,s.getScene(),!0):null,this._system=s,s.lensFlares.push(this)}return c.AddFlare=function(r,i,a,n,s){return new c(r,i,a,n,s)},c.prototype.dispose=function(){this.texture&&this.texture.dispose();var r=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(r,1)},c}();t.LensFlare=f})(T||(T={}));var T;(function(t){t.AbstractScene.AddParser(t.SceneComponentConstants.NAME_LENSFLARESYSTEM,function(c,r,i,a){if(c.lensFlareSystems!==void 0&&c.lensFlareSystems!==null){i.lensFlareSystems||(i.lensFlareSystems=new Array);for(var n=0,s=c.lensFlareSystems.length;n<s;n++){var o=c.lensFlareSystems[n],l=t.LensFlareSystem.Parse(o,r,a);i.lensFlareSystems.push(l)}}}),t.AbstractScene.prototype.getLensFlareSystemByName=function(c){for(var r=0;r<this.lensFlareSystems.length;r++)if(this.lensFlareSystems[r].name===c)return this.lensFlareSystems[r];return null},t.AbstractScene.prototype.getLensFlareSystemByID=function(c){for(var r=0;r<this.lensFlareSystems.length;r++)if(this.lensFlareSystems[r].id===c)return this.lensFlareSystems[r];return null},t.AbstractScene.prototype.removeLensFlareSystem=function(c){var r=this.lensFlareSystems.indexOf(c);return r!==-1&&this.lensFlareSystems.splice(r,1),r},t.AbstractScene.prototype.addLensFlareSystem=function(c){this.lensFlareSystems.push(c)};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_LENSFLARESYSTEM,this.scene=r,r.lensFlareSystems=new Array}return c.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},c.prototype.rebuild=function(){},c.prototype.addFromContainer=function(r){var i=this;r.lensFlareSystems&&r.lensFlareSystems.forEach(function(a){i.scene.addLensFlareSystem(a)})},c.prototype.removeFromContainer=function(r){var i=this;r.lensFlareSystems&&r.lensFlareSystems.forEach(function(a){i.scene.removeLensFlareSystem(a)})},c.prototype.serialize=function(r){r.lensFlareSystems=[];for(var i=this.scene.lensFlareSystems,a=0,n=i;a<n.length;a++){var s=n[a];r.lensFlareSystems.push(s.serialize())}},c.prototype.dispose=function(){for(var r=this.scene.lensFlareSystems;r.length;)r[0].dispose()},c.prototype._draw=function(r){if(this.scene.lensFlaresEnabled){var i=this.scene.lensFlareSystems;t.Tools.StartPerformanceCounter("Lens flares",i.length>0);for(var a=0,n=i;a<n.length;a++){var s=n[a];r.layerMask&s.layerMask&&s.render()}t.Tools.EndPerformanceCounter("Lens flares",i.length>0)}},c}();t.LensFlareSystemSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){this.name=r,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=a||t.Engine.LastCreatedScene;var n=this._scene._getComponent(t.SceneComponentConstants.NAME_LENSFLARESYSTEM);n||(n=new t.LensFlareSystemSceneComponent(this._scene),a._addComponent(n)),this._emitter=i,this.id=r,a.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(u){return a.activeCamera&&u.material&&u.isVisible&&u.isEnabled()&&u.isBlocker&&(u.layerMask&a.activeCamera.layerMask)!=0};var s=a.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(s,o,t.VertexBuffer.PositionKind,!1,!1,2);var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=s.createIndexBuffer(l),this._effect=s.createEffect("lensFlare",[t.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(c.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(r){this._isEnabled=r},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},c.prototype.getEmitter=function(){return this._emitter},c.prototype.setEmitter=function(r){this._emitter=r},c.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},c.prototype.computeEffectivePosition=function(r){var i=this.getEmitterPosition();return i=t.Vector3.Project(i,t.Matrix.Identity(),this._scene.getTransformMatrix(),r),this._positionX=i.x,this._positionY=i.y,i=t.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(r.x-=this.viewportBorder,r.y-=this.viewportBorder,r.width+=this.viewportBorder*2,r.height+=this.viewportBorder*2,i.x+=this.viewportBorder,i.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),i.z>0?(this._positionX>r.x&&this._positionX<r.x+r.width&&this._positionY>r.y&&this._positionY<r.y+r.height,!0):!1},c.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var r=this.getEmitterPosition(),i=r.subtract(this._scene.activeCamera.globalPosition),a=i.length();i.normalize();var n=new t.Ray(this._scene.activeCamera.globalPosition,i),s=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!s||!s.hit||s.distance>a},c.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var r=this._scene.getEngine(),i=this._scene.activeCamera.viewport,a=i.toGlobal(r.getRenderWidth(!0),r.getRenderHeight(!0));if(!this.computeEffectivePosition(a)||!this._isVisible())return!1;var n,s;this._positionX<this.borderLimit+a.x?n=this.borderLimit+a.x-this._positionX:this._positionX>a.x+a.width-this.borderLimit?n=this._positionX-a.x-a.width+this.borderLimit:n=0,this._positionY<this.borderLimit+a.y?s=this.borderLimit+a.y-this._positionY:this._positionY>a.y+a.height-this.borderLimit?s=this._positionY-a.y-a.height+this.borderLimit:s=0;var o=n>s?n:s;o-=this.viewportBorder,o>this.borderLimit&&(o=this.borderLimit);var l=1-t.Scalar.Clamp(o/this.borderLimit,0,1);if(l<0)return!1;l>1&&(l=1),this.viewportBorder>0&&(a.x+=this.viewportBorder,a.y+=this.viewportBorder,a.width-=this.viewportBorder*2,a.height-=this.viewportBorder*2,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var u=a.x+a.width/2,h=a.y+a.height/2,d=u-this._positionX,p=h-this._positionY;r.enableEffect(this._effect),r.setState(!1),r.setDepthBuffer(!1),r.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var m=0;m<this.lensFlares.length;m++){var _=this.lensFlares[m];r.setAlphaMode(_.alphaMode);var v=u-d*_.position,S=h-p*_.position,P=_.size,x=_.size*r.getAspectRatio(this._scene.activeCamera,!0),R=2*(v/(a.width+a.x*2))-1,w=1-2*(S/(a.height+a.y*2)),I=t.Matrix.FromValues(P/2,0,0,0,0,x/2,0,0,0,0,1,0,R,w,0,1);this._effect.setMatrix("viewportMatrix",I),this._effect.setTexture("textureSampler",_.texture),this._effect.setFloat4("color",_.color.r*l,_.color.g*l,_.color.b*l,1),r.drawElementsType(t.Material.TriangleFillMode,0,6)}return r.setDepthBuffer(!0),r.setAlphaMode(t.Engine.ALPHA_DISABLE),!0},c.prototype.dispose=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];for(r&&(r.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var i=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(i,1)},c.Parse=function(r,i,a){var n=i.getLastEntryByID(r.emitterId),s=r.name||"lensFlareSystem#"+r.emitterId,o=new c(s,n,i);o.id=r.id||s,o.borderLimit=r.borderLimit;for(var l=0;l<r.flares.length;l++){var u=r.flares[l];t.LensFlare.AddFlare(u.size,u.position,t.Color3.FromArray(u.color),u.textureName?a+u.textureName:"",o)}return o},c.prototype.serialize=function(){var r={};r.id=this.id,r.name=this.name,r.emitterId=this.getEmitter().id,r.borderLimit=this.borderLimit,r.flares=[];for(var i=0;i<this.lensFlares.length;i++){var a=this.lensFlares[i];r.flares.push({size:a.size,position:a.position,color:a.color.asArray(),textureName:t.Tools.GetFilename(a.texture?a.texture.name:"")})}return r},c}();t.LensFlareSystem=f})(T||(T={}));var T;(function(t){var f=function(){function n(s,o){this.type=s,this.jointData=o,o.nativeParams=o.nativeParams||{}}return Object.defineProperty(n.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(s){this._physicsJoint,this._physicsJoint=s},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"physicsPlugin",{set:function(s){this._physicsPlugin=s},enumerable:!0,configurable:!0}),n.prototype.executeNativeFunction=function(s){s(this._physicsPlugin.world,this._physicsJoint)},n.DistanceJoint=0,n.HingeJoint=1,n.BallAndSocketJoint=2,n.WheelJoint=3,n.SliderJoint=4,n.PrismaticJoint=5,n.UniversalJoint=6,n.Hinge2Joint=n.WheelJoint,n.PointToPointJoint=8,n.SpringJoint=9,n.LockJoint=10,n}();t.PhysicsJoint=f;var c=function(n){N(s,n);function s(o){return n.call(this,f.DistanceJoint,o)||this}return s.prototype.updateDistance=function(o,l){this._physicsPlugin.updateDistanceJoint(this,o,l)},s}(f);t.DistanceJoint=c;var r=function(n){N(s,n);function s(o,l){return n.call(this,o,l)||this}return s.prototype.setMotor=function(o,l){this._physicsPlugin.setMotor(this,o||0,l)},s.prototype.setLimit=function(o,l){this._physicsPlugin.setLimit(this,o,l)},s}(f);t.MotorEnabledJoint=r;var i=function(n){N(s,n);function s(o){return n.call(this,f.HingeJoint,o)||this}return s.prototype.setMotor=function(o,l){this._physicsPlugin.setMotor(this,o||0,l)},s.prototype.setLimit=function(o,l){this._physicsPlugin.setLimit(this,o,l)},s}(r);t.HingeJoint=i;var a=function(n){N(s,n);function s(o){return n.call(this,f.Hinge2Joint,o)||this}return s.prototype.setMotor=function(o,l,u){u===void 0&&(u=0),this._physicsPlugin.setMotor(this,o||0,l,u)},s.prototype.setLimit=function(o,l,u){u===void 0&&(u=0),this._physicsPlugin.setLimit(this,o,l,u)},s}(r);t.Hinge2Joint=a})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n){a===void 0&&(a={mass:0});var s=this;if(this.object=r,this.type=i,this._options=a,this._scene=n,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=t.Vector3.Zero(),this._isDisposed=!1,this._tmpQuat=new t.Quaternion,this._tmpQuat2=new t.Quaternion,this.beforeStep=function(){s._physicsEngine&&(s.object.translate(s._deltaPosition,-1),s._deltaRotationConjugated&&s.object.rotationQuaternion&&s.object.rotationQuaternion.multiplyToRef(s._deltaRotationConjugated,s.object.rotationQuaternion),s.object.computeWorldMatrix(!1),s.object.parent&&s.object.rotationQuaternion?(s.getParentsRotation(),s._tmpQuat.multiplyToRef(s.object.rotationQuaternion,s._tmpQuat)):s._tmpQuat.copyFrom(s.object.rotationQuaternion||new t.Quaternion),s._options.disableBidirectionalTransformation||s.object.rotationQuaternion&&s._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(s,s.object.getAbsolutePivotPoint(),s._tmpQuat),s._onBeforePhysicsStepCallbacks.forEach(function(o){o(s)}))},this.afterStep=function(){s._physicsEngine&&(s._onAfterPhysicsStepCallbacks.forEach(function(o){o(s)}),s._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(s),s.object.parent&&s.object.rotationQuaternion&&(s.getParentsRotation(),s._tmpQuat.conjugateInPlace(),s._tmpQuat.multiplyToRef(s.object.rotationQuaternion,s.object.rotationQuaternion)),s.object.setAbsolutePosition(s.object.position),s._deltaRotation&&s.object.rotationQuaternion&&s.object.rotationQuaternion.multiplyToRef(s._deltaRotation,s.object.rotationQuaternion),s.object.translate(s._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(o){if(!(!s._onPhysicsCollideCallbacks.length&&!s.onCollideEvent)&&s._physicsEngine){var l=s._physicsEngine.getImpostorWithPhysicsBody(o.body);l&&(s.onCollideEvent&&s.onCollideEvent(s,l),s._onPhysicsCollideCallbacks.filter(function(u){return u.otherImpostors.indexOf(l)!==-1}).forEach(function(u){u.callback(s,l)}))}},!this.object){t.Tools.Error("No object was provided. A physics object is obligatory");return}!this._scene&&r.getScene&&(this._scene=r.getScene()),this._scene&&(this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new t.Quaternion),this._options.mass=a.mass===void 0?0:a.mass,this._options.friction=a.friction===void 0?.2:a.friction,this._options.restitution=a.restitution===void 0?.2:a.restitution,this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&t.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")):t.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))}return Object.defineProperty(c.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(r){this.setMass(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(r){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(r){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,r)},enumerable:!0,configurable:!0}),c.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),!this._isDisposed&&(!this.parent||this._options.ignoreParent)&&this._physicsEngine.addImpostor(this))},c.prototype._getPhysicsParent=function(){if(this.object.parent instanceof t.AbstractMesh){var r=this.object.parent;return r.physicsImpostor}return null},c.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},c.prototype.setScalingUpdated=function(r){this.forceUpdate()},c.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(c.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(r){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=r,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(r){this._parent=r},enumerable:!0,configurable:!0}),c.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},c.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var r=this.object.rotationQuaternion;this.object.rotationQuaternion=c.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var i=this.object.getBoundingInfo(),a=i.boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=r,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),a}else return c.DEFAULT_OBJECT_SIZE},c.prototype.getObjectCenter=function(){if(this.object.getBoundingInfo){var r=this.object.getBoundingInfo();return r.boundingBox.centerWorld}else return this.object.position},c.prototype.getParam=function(r){return this._options[r]},c.prototype.setParam=function(r,i){this._options[r]=i,this._bodyUpdateRequired=!0},c.prototype.setMass=function(r){this.getParam("mass")!==r&&this.setParam("mass",r),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,r)},c.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):t.Vector3.Zero()},c.prototype.setLinearVelocity=function(r){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,r)},c.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):t.Vector3.Zero()},c.prototype.setAngularVelocity=function(r){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,r)},c.prototype.executeNativeFunction=function(r){this._physicsEngine&&r(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},c.prototype.registerBeforePhysicsStep=function(r){this._onBeforePhysicsStepCallbacks.push(r)},c.prototype.unregisterBeforePhysicsStep=function(r){var i=this._onBeforePhysicsStepCallbacks.indexOf(r);i>-1?this._onBeforePhysicsStepCallbacks.splice(i,1):t.Tools.Warn("Function to remove was not found")},c.prototype.registerAfterPhysicsStep=function(r){this._onAfterPhysicsStepCallbacks.push(r)},c.prototype.unregisterAfterPhysicsStep=function(r){var i=this._onAfterPhysicsStepCallbacks.indexOf(r);i>-1?this._onAfterPhysicsStepCallbacks.splice(i,1):t.Tools.Warn("Function to remove was not found")},c.prototype.registerOnPhysicsCollide=function(r,i){var a=r instanceof Array?r:[r];this._onPhysicsCollideCallbacks.push({callback:i,otherImpostors:a})},c.prototype.unregisterOnPhysicsCollide=function(r,i){var a=r instanceof Array?r:[r],n=-1,s=this._onPhysicsCollideCallbacks.some(function(o,l){if(o.callback===i&&o.otherImpostors.length===a.length){var u=o.otherImpostors.every(function(h){return a.indexOf(h)>-1});return u&&(n=l),u}return!1});s?this._onPhysicsCollideCallbacks.splice(n,1):t.Tools.Warn("Function to remove was not found")},c.prototype.getParentsRotation=function(){var r=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);r;)r.rotationQuaternion?this._tmpQuat2.copyFrom(r.rotationQuaternion):t.Quaternion.RotationYawPitchRollToRef(r.rotation.y,r.rotation.x,r.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),r=r.parent;return this._tmpQuat},c.prototype.applyForce=function(r,i){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,r,i),this},c.prototype.applyImpulse=function(r,i){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,r,i),this},c.prototype.createJoint=function(r,i,a){var n=new t.PhysicsJoint(i,a);return this.addJoint(r,n),this},c.prototype.addJoint=function(r,i){return this._joints.push({otherImpostor:r,joint:i}),this._physicsEngine&&this._physicsEngine.addJoint(this,r,i),this},c.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},c.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},c.prototype.clone=function(r){return r?new c(r,this.type,this._options,this._scene):null},c.prototype.dispose=function(){var r=this;this._physicsEngine&&(this._joints.forEach(function(i){r._physicsEngine&&r._physicsEngine.removeJoint(r,i.otherImpostor,i.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},c.prototype.setDeltaPosition=function(r){this._deltaPosition.copyFrom(r)},c.prototype.setDeltaRotation=function(r){this._deltaRotation||(this._deltaRotation=new t.Quaternion),this._deltaRotation.copyFrom(r),this._deltaRotationConjugated=this._deltaRotation.conjugate()},c.prototype.getBoxSizeToRef=function(r){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,r),this},c.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},c.prototype.syncBoneWithImpostor=function(r,i,a,n,s){var o=c._tmpVecs[0],l=this.object;if(l.rotationQuaternion)if(s){var u=c._tmpQuat;l.rotationQuaternion.multiplyToRef(s,u),r.setRotationQuaternion(u,t.Space.WORLD,i)}else r.setRotationQuaternion(l.rotationQuaternion,t.Space.WORLD,i);o.x=0,o.y=0,o.z=0,a&&(o.x=a.x,o.y=a.y,o.z=a.z,r.getDirectionToRef(o,i,o),n==null&&(n=a.length()),o.x*=n,o.y*=n,o.z*=n),r.getParent()?(o.addInPlace(l.getAbsolutePosition()),r.setAbsolutePosition(o,i)):(i.setAbsolutePosition(l.getAbsolutePosition()),i.position.x-=o.x,i.position.y-=o.y,i.position.z-=o.z)},c.prototype.syncImpostorWithBone=function(r,i,a,n,s,o){var l=this.object;if(l.rotationQuaternion)if(s){var u=c._tmpQuat;r.getRotationQuaternionToRef(t.Space.WORLD,i,u),u.multiplyToRef(s,l.rotationQuaternion)}else r.getRotationQuaternionToRef(t.Space.WORLD,i,l.rotationQuaternion);var h=c._tmpVecs[0],d=c._tmpVecs[1];o||(o=c._tmpVecs[2],o.x=0,o.y=1,o.z=0),r.getDirectionToRef(o,i,d),r.getAbsolutePositionToRef(i,h),n==null&&a&&(n=a.length()),n!=null&&(h.x+=d.x*n,h.y+=d.y*n,h.z+=d.z*n),l.setAbsolutePosition(h)},c.DEFAULT_OBJECT_SIZE=new t.Vector3(1,1,1),c.IDENTITY_QUATERNION=t.Quaternion.Identity(),c._tmpVecs=[t.Vector3.Zero(),t.Vector3.Zero(),t.Vector3.Zero()],c._tmpQuat=t.Quaternion.Identity(),c.NoImpostor=0,c.SphereImpostor=1,c.BoxImpostor=2,c.PlaneImpostor=3,c.MeshImpostor=4,c.CylinderImpostor=7,c.ParticleImpostor=8,c.HeightmapImpostor=9,c}();t.PhysicsImpostor=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){if(i===void 0&&(i=new t.CannonJSPlugin),this._physicsPlugin=i,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");r=r||new t.Vector3(0,-9.807,0),this.setGravity(r),this.setTimeStep()}return c.prototype.setGravity=function(r){this.gravity=r,this._physicsPlugin.setGravity(this.gravity)},c.prototype.setTimeStep=function(r){r===void 0&&(r=.016666666666666666),this._physicsPlugin.setTimeStep(r)},c.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},c.prototype.dispose=function(){this._impostors.forEach(function(r){r.dispose()}),this._physicsPlugin.dispose()},c.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},c.prototype.addImpostor=function(r){r.uniqueId=this._impostors.push(r),r.parent||this._physicsPlugin.generatePhysicsBody(r)},c.prototype.removeImpostor=function(r){var i=this._impostors.indexOf(r);if(i>-1){var a=this._impostors.splice(i,1);a.length&&(a[0].physicsBody=null)}},c.prototype.addJoint=function(r,i,a){var n={mainImpostor:r,connectedImpostor:i,joint:a};a.physicsPlugin=this._physicsPlugin,this._joints.push(n),this._physicsPlugin.generateJoint(n)},c.prototype.removeJoint=function(r,i,a){var n=this._joints.filter(function(s){return s.connectedImpostor===i&&s.joint===a&&s.mainImpostor===r});n.length&&this._physicsPlugin.removeJoint(n[0])},c.prototype._step=function(r){var i=this;this._impostors.forEach(function(a){a.isBodyInitRequired()&&i._physicsPlugin.generatePhysicsBody(a)}),r>.1?r=.1:r<=0&&(r=.016666666666666666),this._physicsPlugin.executeStep(r,this._impostors)},c.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},c.prototype.getImpostors=function(){return this._impostors},c.prototype.getImpostorForPhysicsObject=function(r){for(var i=0;i<this._impostors.length;++i)if(this._impostors[i].object===r)return this._impostors[i];return null},c.prototype.getImpostorWithPhysicsBody=function(r){for(var i=0;i<this._impostors.length;++i)if(this._impostors[i].physicsBody===r)return this._impostors[i];return null},c.Epsilon=.001,c}();t.PhysicsEngine=f})(T||(T={}));var T;(function(t){var f=function(){function o(l){this._scene=l,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||t.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return o.prototype.applyRadialExplosionImpulse=function(l,u,h,d){if(d===void 0&&(d=n.Constant),!this._physicsEngine)return t.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var p=this._physicsEngine.getImpostors();if(p.length===0)return null;var m=new c(this._scene);return p.forEach(function(_){var v=m.getImpostorForceAndContactPoint(_,l,u,h,d);v&&_.applyImpulse(v.force,v.contactPoint)}),m.dispose(!1),m},o.prototype.applyRadialExplosionForce=function(l,u,h,d){if(d===void 0&&(d=n.Constant),!this._physicsEngine)return t.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var p=this._physicsEngine.getImpostors();if(p.length===0)return null;var m=new c(this._scene);return p.forEach(function(_){var v=m.getImpostorForceAndContactPoint(_,l,u,h,d);v&&_.applyForce(v.force,v.contactPoint)}),m.dispose(!1),m},o.prototype.gravitationalField=function(l,u,h,d){if(d===void 0&&(d=n.Constant),!this._physicsEngine)return t.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var p=this._physicsEngine.getImpostors();if(p.length===0)return null;var m=new r(this,this._scene,l,u,h,d);return m.dispose(!1),m},o.prototype.updraft=function(l,u,h,d,p){if(p===void 0&&(p=s.Center),!this._physicsEngine)return t.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;var m=new i(this._scene,l,u,h,d,p);return m.dispose(!1),m},o.prototype.vortex=function(l,u,h,d){if(!this._physicsEngine)return t.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(this._physicsEngine.getImpostors().length===0)return null;var p=new a(this._scene,l,u,h,d);return p.dispose(!1),p},o}();t.PhysicsHelper=f;var c=function(){function o(l){this._sphereOptions={segments:32,diameter:1},this._rays=[],this._dataFetched=!1,this._scene=l}return o.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere,rays:this._rays}},o.prototype.getImpostorForceAndContactPoint=function(l,u,h,d,p){if(l.mass===0||!this._intersectsWithSphere(l,u,h)||l.object.getClassName()!=="Mesh"&&l.object.getClassName()!=="InstancedMesh")return null;var m=l.getObjectCenter(),_=m.subtract(u),v=new t.Ray(u,_,h);this._rays.push(v);var S=v.intersectsMesh(l.object),P=S.pickedPoint;if(!P)return null;var x=t.Vector3.Distance(u,P);if(x>h)return null;var R=p===n.Constant?d:d*(1-x/h),w=_.multiplyByFloats(R,R,R);return{force:w,contactPoint:P}},o.prototype.dispose=function(l){var u=this;l===void 0&&(l=!0),l?this._sphere.dispose():setTimeout(function(){u._dataFetched||u._sphere.dispose()},0)},o.prototype._prepareSphere=function(){this._sphere||(this._sphere=t.MeshBuilder.CreateSphere("radialExplosionEventSphere",this._sphereOptions,this._scene),this._sphere.isVisible=!1)},o.prototype._intersectsWithSphere=function(l,u,h){var d=l.object;return this._prepareSphere(),this._sphere.position=u,this._sphere.scaling=new t.Vector3(h*2,h*2,h*2),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(d,!0)},o}();t.PhysicsRadialExplosionEvent=c;var r=function(){function o(l,u,h,d,p,m){m===void 0&&(m=n.Constant),this._dataFetched=!1,this._physicsHelper=l,this._scene=u,this._origin=h,this._radius=d,this._strength=p,this._falloff=m,this._tickCallback=this._tick.bind(this)}return o.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},o.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},o.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},o.prototype.dispose=function(l){var u=this;l===void 0&&(l=!0),l?this._sphere.dispose():setTimeout(function(){u._dataFetched||u._sphere.dispose()},0)},o.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,this._strength*-1,this._falloff);else{var l=this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,this._strength*-1,this._falloff);l&&(this._sphere=l.getData().sphere.clone("radialExplosionEventSphereClone"))}},o}();t.PhysicsGravitationalFieldEvent=r;var i=function(){function o(l,u,h,d,p,m){this._scene=l,this._origin=u,this._radius=h,this._strength=d,this._height=p,this._updraftMode=m,this._originTop=t.Vector3.Zero(),this._originDirection=t.Vector3.Zero(),this._cylinderPosition=t.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._origin.addToRef(new t.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new t.Vector3(0,this._height,0),this._originTop),this._updraftMode===s.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this)}return o.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},o.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},o.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},o.prototype.dispose=function(l){var u=this;l===void 0&&(l=!0),l?this._cylinder.dispose():setTimeout(function(){u._dataFetched||u._cylinder.dispose()},0)},o.prototype.getImpostorForceAndContactPoint=function(l){if(l.mass===0||!this._intersectsWithCylinder(l))return null;var u=l.getObjectCenter();if(this._updraftMode===s.Perpendicular)var h=this._originDirection;else var h=u.subtract(this._originTop);var d=this._strength*-1,p=h.multiplyByFloats(d,d,d);return{force:p,contactPoint:u}},o.prototype._tick=function(){var l=this;this._physicsEngine.getImpostors().forEach(function(u){var h=l.getImpostorForceAndContactPoint(u);h&&u.applyForce(h.force,h.contactPoint)})},o.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=t.MeshBuilder.CreateCylinder("updraftEventCylinder",{height:this._height,diameter:this._radius*2},this._scene),this._cylinder.isVisible=!1)},o.prototype._intersectsWithCylinder=function(l){var u=l.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(u,!0)},o}();t.PhysicsUpdraftEvent=i;var a=function(){function o(l,u,h,d,p){this._scene=l,this._origin=u,this._radius=h,this._strength=d,this._height=p,this._originTop=t.Vector3.Zero(),this._centripetalForceThreshold=.7,this._updraftMultiplier=.02,this._cylinderPosition=t.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._origin.addToRef(new t.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new t.Vector3(0,this._height,0),this._originTop),this._tickCallback=this._tick.bind(this)}return o.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},o.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},o.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},o.prototype.dispose=function(l){var u=this;l===void 0&&(l=!0),l?this._cylinder.dispose():setTimeout(function(){u._dataFetched||u._cylinder.dispose()},0)},o.prototype.getImpostorForceAndContactPoint=function(l){if(l.mass===0||!this._intersectsWithCylinder(l)||l.object.getClassName()!=="Mesh"&&l.object.getClassName()!=="InstancedMesh")return null;var u=l.getObjectCenter(),h=new t.Vector3(this._origin.x,u.y,this._origin.z),d=u.subtract(h),p=new t.Ray(h,d,this._radius),m=p.intersectsMesh(l.object),_=m.pickedPoint;if(!_)return null;var v=m.distance/this._radius,S=t.Vector3.Cross(h,u).normalize(),P=_.normalize();if(v>this._centripetalForceThreshold&&(P=P.negate()),v>this._centripetalForceThreshold)var x=P.x*this._strength/8,R=P.y*this._updraftMultiplier,w=P.z*this._strength/8;else var x=(S.x+P.x)/2,R=this._originTop.y*this._updraftMultiplier,w=(S.z+P.z)/2;var I=new t.Vector3(x,R,w);return I=I.multiplyByFloats(this._strength,this._strength,this._strength),{force:I,contactPoint:u}},o.prototype._tick=function(){var l=this;this._physicsEngine.getImpostors().forEach(function(u){var h=l.getImpostorForceAndContactPoint(u);h&&u.applyForce(h.force,h.contactPoint)})},o.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=t.MeshBuilder.CreateCylinder("vortexEventCylinder",{height:this._height,diameter:this._radius*2},this._scene),this._cylinder.isVisible=!1)},o.prototype._intersectsWithCylinder=function(l){var u=l.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(u,!0)},o}();t.PhysicsVortexEvent=a;var n;(function(o){o[o.Constant=0]="Constant",o[o.Linear=1]="Linear"})(n=t.PhysicsRadialImpulseFalloff||(t.PhysicsRadialImpulseFalloff={}));var s;(function(o){o[o.Center=0]="Center",o[o.Perpendicular=1]="Perpendicular"})(s=t.PhysicsUpdraftMode||(t.PhysicsUpdraftMode={}))})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){if(r===void 0&&(r=!0),i===void 0&&(i=10),this._useDeltaForWorldStep=r,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=.016666666666666666,this.BJSCANNON=CANNON,this._minus90X=new t.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new t.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=t.Vector3.Zero(),this._tmpDeltaPosition=t.Vector3.Zero(),this._tmpUnityRotation=new t.Quaternion,!this.isSupported()){t.Tools.Error("CannonJS is not available. Please make sure you included the js file.");return}this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=i}return c.prototype.setGravity=function(r){this.world.gravity.copy(r)},c.prototype.setTimeStep=function(r){this._fixedTimeStep=r},c.prototype.getTimeStep=function(){return this._fixedTimeStep},c.prototype.executeStep=function(r,i){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?r:0,3)},c.prototype.applyImpulse=function(r,i,a){var n=new this.BJSCANNON.Vec3(a.x,a.y,a.z),s=new this.BJSCANNON.Vec3(i.x,i.y,i.z);r.physicsBody.applyImpulse(s,n)},c.prototype.applyForce=function(r,i,a){var n=new this.BJSCANNON.Vec3(a.x,a.y,a.z),s=new this.BJSCANNON.Vec3(i.x,i.y,i.z);r.physicsBody.applyForce(s,n)},c.prototype.generatePhysicsBody=function(r){if(r.parent){r.physicsBody&&(this.removePhysicsBody(r),r.forceUpdate());return}if(r.isBodyInitRequired()){var i=this._createShape(r),a=r.physicsBody;a&&this.removePhysicsBody(r);var n=this._addMaterial("mat-"+r.uniqueId,r.getParam("friction"),r.getParam("restitution")),s={mass:r.getParam("mass"),material:n},o=r.getParam("nativeOptions");for(var l in o)o.hasOwnProperty(l)&&(s[l]=o[l]);r.physicsBody=new this.BJSCANNON.Body(s),r.physicsBody.addEventListener("collide",r.onCollide),this.world.addEventListener("preStep",r.beforeStep),this.world.addEventListener("postStep",r.afterStep),r.physicsBody.addShape(i),this.world.add(r.physicsBody),a&&["force","torque","velocity","angularVelocity"].forEach(function(u){r.physicsBody[u].copy(a[u])}),this._processChildMeshes(r)}this._updatePhysicsBodyTransformation(r)},c.prototype._processChildMeshes=function(r){var i=this,a=r.object.getChildMeshes?r.object.getChildMeshes(!0):[],n=r.object.rotationQuaternion;if(a.length){var s=function(o,l){if(!(!n||!l.rotationQuaternion)){var u=l.getPhysicsImpostor();if(u){var h=u.parent;if(h!==r){var d=l.getAbsolutePosition().subtract(r.object.getAbsolutePosition()),p=l.rotationQuaternion.multiply(t.Quaternion.Inverse(n));u.physicsBody&&(i.removePhysicsBody(u),u.physicsBody=null),u.parent=r,u.resetUpdateFlags(),r.physicsBody.addShape(i._createShape(u),new i.BJSCANNON.Vec3(d.x,d.y,d.z),new i.BJSCANNON.Quaternion(p.x,p.y,p.z,p.w)),r.physicsBody.mass+=u.getParam("mass")}}n.multiplyInPlace(l.rotationQuaternion),l.getChildMeshes(!0).filter(function(m){return!!m.physicsImpostor}).forEach(s.bind(i,l.getAbsolutePosition()))}};a.filter(function(o){return!!o.physicsImpostor}).forEach(s.bind(this,r.object.getAbsolutePosition()))}},c.prototype.removePhysicsBody=function(r){r.physicsBody.removeEventListener("collide",r.onCollide),this.world.removeEventListener("preStep",r.beforeStep),this.world.removeEventListener("postStep",r.afterStep),this.world.remove(r.physicsBody)},c.prototype.generateJoint=function(r){var i=r.mainImpostor.physicsBody,a=r.connectedImpostor.physicsBody;if(!(!i||!a)){var n,s=r.joint.jointData,o={pivotA:s.mainPivot?new this.BJSCANNON.Vec3().copy(s.mainPivot):null,pivotB:s.connectedPivot?new this.BJSCANNON.Vec3().copy(s.connectedPivot):null,axisA:s.mainAxis?new this.BJSCANNON.Vec3().copy(s.mainAxis):null,axisB:s.connectedAxis?new this.BJSCANNON.Vec3().copy(s.connectedAxis):null,maxForce:s.nativeParams.maxForce,collideConnected:!!s.collision};switch(r.joint.type){case t.PhysicsJoint.HingeJoint:case t.PhysicsJoint.Hinge2Joint:n=new this.BJSCANNON.HingeConstraint(i,a,o);break;case t.PhysicsJoint.DistanceJoint:n=new this.BJSCANNON.DistanceConstraint(i,a,s.maxDistance||2);break;case t.PhysicsJoint.SpringJoint:var l=s;n=new this.BJSCANNON.Spring(i,a,{restLength:l.length,stiffness:l.stiffness,damping:l.damping,localAnchorA:o.pivotA,localAnchorB:o.pivotB});break;case t.PhysicsJoint.LockJoint:n=new this.BJSCANNON.LockConstraint(i,a,o);break;case t.PhysicsJoint.PointToPointJoint:case t.PhysicsJoint.BallAndSocketJoint:default:n=new this.BJSCANNON.PointToPointConstraint(i,o.pivotA,a,o.pivotA,o.maxForce);break}n.collideConnected=!!s.collision,r.joint.physicsJoint=n,r.joint.type!==t.PhysicsJoint.SpringJoint?this.world.addConstraint(n):(r.joint.jointData.forceApplicationCallback=r.joint.jointData.forceApplicationCallback||function(){n.applyForce()},r.mainImpostor.registerAfterPhysicsStep(r.joint.jointData.forceApplicationCallback))}},c.prototype.removeJoint=function(r){r.joint.type!==t.PhysicsJoint.SpringJoint?this.world.removeConstraint(r.joint.physicsJoint):r.mainImpostor.unregisterAfterPhysicsStep(r.joint.jointData.forceApplicationCallback)},c.prototype._addMaterial=function(r,i,a){var n,s;for(n=0;n<this._physicsMaterials.length;n++)if(s=this._physicsMaterials[n],s.friction===i&&s.restitution===a)return s;var o=new this.BJSCANNON.Material(r);return o.friction=i,o.restitution=a,this._physicsMaterials.push(o),o},c.prototype._checkWithEpsilon=function(r){return r<t.PhysicsEngine.Epsilon?t.PhysicsEngine.Epsilon:r},c.prototype._createShape=function(r){var i=r.object,a,n=r.getObjectExtendSize();switch(r.type){case t.PhysicsImpostor.SphereImpostor:var s=n.x,o=n.y,l=n.z;a=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(s),this._checkWithEpsilon(o),this._checkWithEpsilon(l))/2);break;case t.PhysicsImpostor.CylinderImpostor:a=new this.BJSCANNON.Cylinder(this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.y),16);break;case t.PhysicsImpostor.BoxImpostor:var u=n.scale(.5);a=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(u.x),this._checkWithEpsilon(u.y),this._checkWithEpsilon(u.z)));break;case t.PhysicsImpostor.PlaneImpostor:t.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),a=new this.BJSCANNON.Plane;break;case t.PhysicsImpostor.MeshImpostor:var h=i.getVerticesData?i.getVerticesData(t.VertexBuffer.PositionKind):[],d=i.getIndices?i.getIndices():[];if(!h)return;var p=i.position.clone(),m=i.rotation&&i.rotation.clone(),_=i.rotationQuaternion&&i.rotationQuaternion.clone();i.position.copyFromFloats(0,0,0),i.rotation&&i.rotation.copyFromFloats(0,0,0),i.rotationQuaternion&&i.rotationQuaternion.copyFrom(r.getParentsRotation()),i.rotationQuaternion&&i.parent&&i.rotationQuaternion.conjugateInPlace();var v=i.computeWorldMatrix(!0),S=new Array,P;for(P=0;P<h.length;P+=3)t.Vector3.TransformCoordinates(t.Vector3.FromArray(h,P),v).toArray(S,P);t.Tools.Warn("MeshImpostor only collides against spheres."),a=new this.BJSCANNON.Trimesh(S,d),i.position.copyFrom(p),m&&i.rotation&&i.rotation.copyFrom(m),_&&i.rotationQuaternion&&i.rotationQuaternion.copyFrom(_);break;case t.PhysicsImpostor.HeightmapImpostor:var x=i.position.clone(),R=i.rotation&&i.rotation.clone(),w=i.rotationQuaternion&&i.rotationQuaternion.clone();i.position.copyFromFloats(0,0,0),i.rotation&&i.rotation.copyFromFloats(0,0,0),i.rotationQuaternion&&i.rotationQuaternion.copyFrom(r.getParentsRotation()),i.rotationQuaternion&&i.parent&&i.rotationQuaternion.conjugateInPlace(),i.rotationQuaternion&&i.rotationQuaternion.multiplyInPlace(this._minus90X),a=this._createHeightmap(i),i.position.copyFrom(x),R&&i.rotation&&i.rotation.copyFrom(R),w&&i.rotationQuaternion&&i.rotationQuaternion.copyFrom(w),i.computeWorldMatrix(!0);break;case t.PhysicsImpostor.ParticleImpostor:a=new this.BJSCANNON.Particle;break}return a},c.prototype._createHeightmap=function(r,i){var a=r.getVerticesData(t.VertexBuffer.PositionKind),n=r.computeWorldMatrix(!0),s=new Array,o;for(o=0;o<a.length;o+=3)t.Vector3.TransformCoordinates(t.Vector3.FromArray(a,o),n).toArray(s,o);a=s;for(var l=new Array,u=i||~~(Math.sqrt(a.length/3)-1),h=r.getBoundingInfo(),d=Math.min(h.boundingBox.extendSizeWorld.x,h.boundingBox.extendSizeWorld.y),p=h.boundingBox.extendSizeWorld.z,m=d*2/u,_=0;_<a.length;_=_+3){var v=Math.round(a[_+0]/m+u/2),S=Math.round((a[_+1]/m-u/2)*-1),P=-a[_+2]+p;l[v]||(l[v]=[]),l[v][S]||(l[v][S]=P),l[v][S]=Math.max(P,l[v][S])}for(var v=0;v<=u;++v){if(!l[v]){for(var x=1;!l[(v+x)%u];)x++;l[v]=l[(v+x)%u].slice()}for(var S=0;S<=u;++S)if(!l[v][S]){for(var x=1,R;R===void 0;)R=l[v][(S+x++)%u];l[v][S]=R}}var w=new this.BJSCANNON.Heightfield(l,{elementSize:m});return w.minY=p,w},c.prototype._updatePhysicsBodyTransformation=function(r){var i=r.object;i.computeWorldMatrix&&i.computeWorldMatrix(!0);var a=i.getBoundingInfo();if(a){var n=r.getObjectCenter();this._tmpDeltaPosition.copyFrom(i.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(r.object.scaling),this._tmpPosition.copyFrom(n);var s=i.rotationQuaternion;if(s){if((r.type===t.PhysicsImpostor.PlaneImpostor||r.type===t.PhysicsImpostor.HeightmapImpostor||r.type===t.PhysicsImpostor.CylinderImpostor)&&(s=s.multiply(this._minus90X),r.setDeltaRotation(this._plus90X)),r.type===t.PhysicsImpostor.HeightmapImpostor){var o=i,l=o.getBoundingInfo(),u=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var h=n.clone(),d=o.getPivotMatrix()||t.Matrix.Translation(0,0,0),p=t.Matrix.Translation(l.boundingBox.extendSizeWorld.x,0,-l.boundingBox.extendSizeWorld.z);o.setPreTransformMatrix(p),o.computeWorldMatrix(!0);var m=l.boundingBox.centerWorld.subtract(n).subtract(o.position).negate();this._tmpPosition.copyFromFloats(m.x,m.y-l.boundingBox.extendSizeWorld.y,m.z),this._tmpDeltaPosition.copyFrom(l.boundingBox.centerWorld.subtract(h)),this._tmpDeltaPosition.y+=l.boundingBox.extendSizeWorld.y,o.rotationQuaternion=u,o.setPreTransformMatrix(d),o.computeWorldMatrix(!0)}else r.type===t.PhysicsImpostor.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);r.setDeltaPosition(this._tmpDeltaPosition),r.physicsBody.position.copy(this._tmpPosition),r.physicsBody.quaternion.copy(s)}}},c.prototype.setTransformationFromPhysicsBody=function(r){r.object.position.copyFrom(r.physicsBody.position),r.object.rotationQuaternion&&r.object.rotationQuaternion.copyFrom(r.physicsBody.quaternion)},c.prototype.setPhysicsBodyTransformation=function(r,i,a){r.physicsBody.position.copy(i),r.physicsBody.quaternion.copy(a)},c.prototype.isSupported=function(){return this.BJSCANNON!==void 0},c.prototype.setLinearVelocity=function(r,i){r.physicsBody.velocity.copy(i)},c.prototype.setAngularVelocity=function(r,i){r.physicsBody.angularVelocity.copy(i)},c.prototype.getLinearVelocity=function(r){var i=r.physicsBody.velocity;return i?new t.Vector3(i.x,i.y,i.z):null},c.prototype.getAngularVelocity=function(r){var i=r.physicsBody.angularVelocity;return i?new t.Vector3(i.x,i.y,i.z):null},c.prototype.setBodyMass=function(r,i){r.physicsBody.mass=i,r.physicsBody.updateMassProperties()},c.prototype.getBodyMass=function(r){return r.physicsBody.mass},c.prototype.getBodyFriction=function(r){return r.physicsBody.material.friction},c.prototype.setBodyFriction=function(r,i){r.physicsBody.material.friction=i},c.prototype.getBodyRestitution=function(r){return r.physicsBody.material.restitution},c.prototype.setBodyRestitution=function(r,i){r.physicsBody.material.restitution=i},c.prototype.sleepBody=function(r){r.physicsBody.sleep()},c.prototype.wakeUpBody=function(r){r.physicsBody.wakeUp()},c.prototype.updateDistanceJoint=function(r,i,a){r.physicsJoint.distance=i},c.prototype.setMotor=function(r,i,a,n){n||(r.physicsJoint.enableMotor(),r.physicsJoint.setMotorSpeed(i),a&&this.setLimit(r,a))},c.prototype.setLimit=function(r,i,a){r.physicsJoint.motorEquation.maxForce=i,r.physicsJoint.motorEquation.minForce=a===void 0?-i:a},c.prototype.syncMeshWithImpostor=function(r,i){var a=i.physicsBody;r.position.x=a.position.x,r.position.y=a.position.y,r.position.z=a.position.z,r.rotationQuaternion&&(r.rotationQuaternion.x=a.quaternion.x,r.rotationQuaternion.y=a.quaternion.y,r.rotationQuaternion.z=a.quaternion.z,r.rotationQuaternion.w=a.quaternion.w)},c.prototype.getRadius=function(r){var i=r.physicsBody.shapes[0];return i.boundingSphereRadius},c.prototype.getBoxSizeToRef=function(r,i){var a=r.physicsBody.shapes[0];i.x=a.halfExtents.x*2,i.y=a.halfExtents.y*2,i.z=a.halfExtents.z*2},c.prototype.dispose=function(){},c.prototype._extendNamespace=function(){var r=new this.BJSCANNON.Vec3,i=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(a,n,s){if(s=s||10,n=n||0,n===0)this.internalStep(a),this.time+=a;else{var o=Math.floor((this.time+n)/a)-Math.floor(this.time/a);o=Math.min(o,s)||1;for(var l=performance.now(),u=0;u!==o&&(this.internalStep(a),!(performance.now()-l>a*1e3));u++);this.time+=n;for(var h=this.time%a,d=h/a,p=r,m=this.bodies,_=0;_!==m.length;_++){var v=m[_];v.type!==i.Body.STATIC&&v.sleepState!==i.Body.SLEEPING?(v.position.vsub(v.previousPosition,p),p.scale(d,p),v.position.vadd(p,v.interpolatedPosition)):(v.interpolatedPosition.copy(v.position),v.interpolatedQuaternion.copy(v.quaternion))}}}},c}();t.CannonJSPlugin=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=t.Vector3.Zero(),this.BJSOIMO=OIMO,this.world=new this.BJSOIMO.World({iterations:r}),this.world.clear()}return c.prototype.setGravity=function(r){this.world.gravity.copy(r)},c.prototype.setTimeStep=function(r){this.world.timeStep=r},c.prototype.getTimeStep=function(){return this.world.timeStep},c.prototype.executeStep=function(r,i){var a=this;i.forEach(function(l){l.beforeStep()}),this.world.step(),i.forEach(function(l){l.afterStep(),a._tmpImpostorsArray[l.uniqueId]=l});for(var n=this.world.contacts;n!==null;){if(n.touching&&!n.body1.sleeping&&!n.body2.sleeping){n=n.next;continue}var s=this._tmpImpostorsArray[+n.body1.name],o=this._tmpImpostorsArray[+n.body2.name];if(!s||!o){n=n.next;continue}s.onCollide({body:o.physicsBody}),o.onCollide({body:s.physicsBody}),n=n.next}},c.prototype.applyImpulse=function(r,i,a){var n=r.physicsBody.mass;r.physicsBody.applyImpulse(a.scale(this.world.invScale),i.scale(this.world.invScale*n))},c.prototype.applyForce=function(r,i,a){t.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(r,i,a)},c.prototype.generatePhysicsBody=function(r){var i=this;if(r.parent){r.physicsBody&&(this.removePhysicsBody(r),r.forceUpdate());return}if(r.isBodyInitRequired()){var a={name:r.uniqueId,config:[r.getParam("mass")||1,r.getParam("friction"),r.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:r.getParam("mass")!==0,density:r.getParam("mass"),friction:r.getParam("friction"),restitution:r.getParam("restitution"),world:this.world},n=[r],s=function(u){u.getChildMeshes&&u.getChildMeshes().forEach(function(h){h.physicsImpostor&&n.push(h.physicsImpostor)})};s(r.object);var o=function(u){return Math.max(u,t.PhysicsEngine.Epsilon)},l=new t.Quaternion;n.forEach(function(u){if(u.object.rotationQuaternion){var h=u.object.rotationQuaternion;l=h.clone();var d=h.toEulerAngles(),p=u.getObjectExtendSize(),m=57.29577951308232;if(u===r){var _=r.getObjectCenter();r.object.getAbsolutePivotPoint().subtractToRef(_,i._tmpPositionVector),i._tmpPositionVector.divideInPlace(r.object.scaling),a.pos.push(_.x),a.pos.push(_.y),a.pos.push(_.z),a.posShape.push(0,0,0),a.rot.push(0),a.rot.push(0),a.rot.push(0),a.rotShape.push(0,0,0)}else{var v=u.object.getAbsolutePosition().subtract(r.object.getAbsolutePosition());a.posShape.push(v.x),a.posShape.push(v.y),a.posShape.push(v.z),a.pos.push(0,0,0),a.rot.push(0),a.rot.push(0),a.rot.push(0),a.rotShape.push(d.x*m),a.rotShape.push(d.y*m),a.rotShape.push(d.z*m)}switch(u.type){case t.PhysicsImpostor.ParticleImpostor:t.Tools.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case t.PhysicsImpostor.SphereImpostor:var S=p.x,P=p.y,x=p.z,R=Math.max(o(S),o(P),o(x))/2;a.type.push("sphere"),a.size.push(R),a.size.push(R),a.size.push(R);break;case t.PhysicsImpostor.CylinderImpostor:var w=o(p.x)/2,I=o(p.y);a.type.push("cylinder"),a.size.push(w),a.size.push(I),a.size.push(I);break;case t.PhysicsImpostor.PlaneImpostor:case t.PhysicsImpostor.BoxImpostor:default:var w=o(p.x),I=o(p.y),F=o(p.z);a.type.push("box"),a.size.push(w),a.size.push(I),a.size.push(F);break}u.object.rotationQuaternion=h}}),r.physicsBody=this.world.add(a),r.physicsBody.resetQuaternion(l),r.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);r.setDeltaPosition(this._tmpPositionVector)},c.prototype.removePhysicsBody=function(r){this.world.removeRigidBody(r.physicsBody)},c.prototype.generateJoint=function(r){var i=r.mainImpostor.physicsBody,a=r.connectedImpostor.physicsBody;if(!(!i||!a)){var n=r.joint.jointData,s=n.nativeParams||{},o,l={body1:i,body2:a,axe1:s.axe1||(n.mainAxis?n.mainAxis.asArray():null),axe2:s.axe2||(n.connectedAxis?n.connectedAxis.asArray():null),pos1:s.pos1||(n.mainPivot?n.mainPivot.asArray():null),pos2:s.pos2||(n.connectedPivot?n.connectedPivot.asArray():null),min:s.min,max:s.max,collision:s.collision||n.collision,spring:s.spring,world:this.world};switch(r.joint.type){case t.PhysicsJoint.BallAndSocketJoint:o="jointBall";break;case t.PhysicsJoint.SpringJoint:t.Tools.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var u=n;l.min=u.length||l.min,l.max=Math.max(l.min,l.max);case t.PhysicsJoint.DistanceJoint:o="jointDistance",l.max=n.maxDistance;break;case t.PhysicsJoint.PrismaticJoint:o="jointPrisme";break;case t.PhysicsJoint.SliderJoint:o="jointSlide";break;case t.PhysicsJoint.WheelJoint:o="jointWheel";break;case t.PhysicsJoint.HingeJoint:default:o="jointHinge";break}l.type=o,r.joint.physicsJoint=this.world.add(l)}},c.prototype.removeJoint=function(r){try{this.world.removeJoint(r.joint.physicsJoint)}catch(i){t.Tools.Warn(i)}},c.prototype.isSupported=function(){return this.BJSOIMO!==void 0},c.prototype.setTransformationFromPhysicsBody=function(r){r.physicsBody.sleeping||(r.object.position.copyFrom(r.physicsBody.getPosition()),r.object.rotationQuaternion&&r.object.rotationQuaternion.copyFrom(r.physicsBody.getQuaternion()))},c.prototype.setPhysicsBodyTransformation=function(r,i,a){var n=r.physicsBody;n.position.copy(i),n.orientation.copy(a),n.syncShapes(),n.awake()},c.prototype.setLinearVelocity=function(r,i){r.physicsBody.linearVelocity.copy(i)},c.prototype.setAngularVelocity=function(r,i){r.physicsBody.angularVelocity.copy(i)},c.prototype.getLinearVelocity=function(r){var i=r.physicsBody.linearVelocity;return i?new t.Vector3(i.x,i.y,i.z):null},c.prototype.getAngularVelocity=function(r){var i=r.physicsBody.angularVelocity;return i?new t.Vector3(i.x,i.y,i.z):null},c.prototype.setBodyMass=function(r,i){var a=i===0;r.physicsBody.shapes.density=a?1:i,r.physicsBody.setupMass(a?2:1)},c.prototype.getBodyMass=function(r){return r.physicsBody.shapes.density},c.prototype.getBodyFriction=function(r){return r.physicsBody.shapes.friction},c.prototype.setBodyFriction=function(r,i){r.physicsBody.shapes.friction=i},c.prototype.getBodyRestitution=function(r){return r.physicsBody.shapes.restitution},c.prototype.setBodyRestitution=function(r,i){r.physicsBody.shapes.restitution=i},c.prototype.sleepBody=function(r){r.physicsBody.sleep()},c.prototype.wakeUpBody=function(r){r.physicsBody.awake()},c.prototype.updateDistanceJoint=function(r,i,a){r.physicsJoint.limitMotor.upperLimit=i,a!==void 0&&(r.physicsJoint.limitMotor.lowerLimit=a)},c.prototype.setMotor=function(r,i,a,n){var s=n?r.physicsJoint.rotationalLimitMotor2:r.physicsJoint.rotationalLimitMotor1||r.physicsJoint.rotationalLimitMotor||r.physicsJoint.limitMotor;s&&s.setMotor(i,a)},c.prototype.setLimit=function(r,i,a,n){var s=n?r.physicsJoint.rotationalLimitMotor2:r.physicsJoint.rotationalLimitMotor1||r.physicsJoint.rotationalLimitMotor||r.physicsJoint.limitMotor;s&&s.setLimit(i,a===void 0?-i:a)},c.prototype.syncMeshWithImpostor=function(r,i){var a=i.physicsBody;r.position.x=a.position.x,r.position.y=a.position.y,r.position.z=a.position.z,r.rotationQuaternion&&(r.rotationQuaternion.x=a.orientation.x,r.rotationQuaternion.y=a.orientation.y,r.rotationQuaternion.z=a.orientation.z,r.rotationQuaternion.w=a.orientation.s)},c.prototype.getRadius=function(r){return r.physicsBody.shapes.radius},c.prototype.getBoxSizeToRef=function(r,i){var a=r.physicsBody.shapes;i.x=a.halfWidth*2,i.y=a.halfHeight*2,i.z=a.halfDepth*2},c.prototype.dispose=function(){this.world.clear()},c}();t.OimoJSPlugin=f})(T||(T={}));var T;(function(t){t.Scene.prototype.getPhysicsEngine=function(){return this._physicsEngine},t.Scene.prototype.enablePhysics=function(c,r){if(c===void 0&&(c=null),this._physicsEngine)return!0;var i=this._getComponent(t.SceneComponentConstants.NAME_PHYSICSENGINE);i||(i=new f(this),this._addComponent(i));try{return this._physicsEngine=new t.PhysicsEngine(c,r),!0}catch(a){return t.Tools.Error(a.message),!1}},t.Scene.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},t.Scene.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0},t.Scene.prototype.deleteCompoundImpostor=function(c){var r=c.parts[0].mesh;r.physicsImpostor&&(r.physicsImpostor.dispose(),r.physicsImpostor=null)},t.Scene.prototype._advancePhysicsEngineStep=function(c){this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(c/1e3),this.onAfterPhysicsObservable.notifyObservers(this))},Object.defineProperty(t.AbstractMesh.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(c){var r=this;this._physicsImpostor!==c&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=c,c&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){r.physicsImpostor&&(r.physicsImpostor.dispose(),r.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),t.AbstractMesh.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},t.AbstractMesh.prototype.applyImpulse=function(c,r){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(c,r),this):this},t.AbstractMesh.prototype.setPhysicsLinkWith=function(c,r,i,a){return!this.physicsImpostor||!c.physicsImpostor?this:(this.physicsImpostor.createJoint(c.physicsImpostor,t.PhysicsJoint.HingeJoint,{mainPivot:r,connectedPivot:i,nativeParams:a}),this)};var f=function(){function c(r){var i=this;this.name=t.SceneComponentConstants.NAME_PHYSICSENGINE,this.scene=r,this.scene.onBeforePhysicsObservable=new t.Observable,this.scene.onAfterPhysicsObservable=new t.Observable,this.scene.getDeterministicFrameTime=function(){return i.scene._physicsEngine?i.scene._physicsEngine.getTimeStep()*1e3:1e3/60}}return c.prototype.register=function(){},c.prototype.rebuild=function(){},c.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},c}();t.PhysicsEngineSceneComponent=f})(T||(T={}));var T;(function(t){var f=542327876,c=131072,r=512,i=4,a=64,n=131072;function s(z){return z.charCodeAt(0)+(z.charCodeAt(1)<<8)+(z.charCodeAt(2)<<16)+(z.charCodeAt(3)<<24)}function o(z){return String.fromCharCode(z&255,z>>8&255,z>>16&255,z>>24&255)}var l=s("DXT1"),u=s("DXT3"),h=s("DXT5"),d=s("DX10"),p=113,m=116,_=10,v=88,S=31,P=0,x=1,R=2,w=3,I=4,F=7,k=20,E=21,g=22,y=23,M=24,C=25,D=26,V=28,G=32,U=function(){function z(){}return z.GetDDSInfo=function(H){var W=new Int32Array(H,0,S),X=new Int32Array(H,0,S+4),K=1;W[R]&c&&(K=Math.max(1,W[F]));var j=W[E],ee=j===d?X[G]:0,$=t.Engine.TEXTURETYPE_UNSIGNED_INT;switch(j){case p:$=t.Engine.TEXTURETYPE_HALF_FLOAT;break;case m:$=t.Engine.TEXTURETYPE_FLOAT;break;case d:if(ee===_){$=t.Engine.TEXTURETYPE_HALF_FLOAT;break}}return{width:W[I],height:W[w],mipmapCount:K,isFourCC:(W[k]&i)===i,isRGB:(W[k]&a)===a,isLuminance:(W[k]&n)===n,isCube:(W[V]&r)===r,isCompressed:j===l||j===u||j===h,dxgiFormat:ee,textureType:$}},z._ToHalfFloat=function(H){z._FloatView||(z._FloatView=new Float32Array(1),z._Int32View=new Int32Array(z._FloatView.buffer)),z._FloatView[0]=H;var W=z._Int32View[0],X=W>>16&32768,K=W>>12&2047,j=W>>23&255;return j<103?X:j>142?(X|=31744,X|=(j==255?0:1)&&W&8388607,X):j<113?(K|=2048,X|=(K>>114-j)+(K>>113-j&1),X):(X|=j-112<<10|K>>1,X+=K&1,X)},z._FromHalfFloat=function(H){var W=(H&32768)>>15,X=(H&31744)>>10,K=H&1023;return X===0?(W?-1:1)*Math.pow(2,-14)*(K/Math.pow(2,10)):X==31?K?NaN:(W?-1:1)*(1/0):(W?-1:1)*Math.pow(2,X-15)*(1+K/Math.pow(2,10))},z._GetHalfFloatAsFloatRGBAArrayBuffer=function(H,W,X,K,j,ee){for(var $=new Float32Array(K),L=new Uint16Array(j,X),Q=0,J=0;J<W;J++)for(var te=0;te<H;te++){var re=(te+J*H)*4;$[Q]=z._FromHalfFloat(L[re]),$[Q+1]=z._FromHalfFloat(L[re+1]),$[Q+2]=z._FromHalfFloat(L[re+2]),z.StoreLODInAlphaChannel?$[Q+3]=ee:$[Q+3]=z._FromHalfFloat(L[re+3]),Q+=4}return $},z._GetHalfFloatRGBAArrayBuffer=function(H,W,X,K,j,ee){if(z.StoreLODInAlphaChannel){for(var $=new Uint16Array(K),L=new Uint16Array(j,X),Q=0,J=0;J<W;J++)for(var te=0;te<H;te++){var re=(te+J*H)*4;$[Q]=L[re],$[Q+1]=L[re+1],$[Q+2]=L[re+2],$[Q+3]=z._ToHalfFloat(ee),Q+=4}return $}return new Uint16Array(j,X,K)},z._GetFloatRGBAArrayBuffer=function(H,W,X,K,j,ee){if(z.StoreLODInAlphaChannel){for(var $=new Float32Array(K),L=new Float32Array(j,X),Q=0,J=0;J<W;J++)for(var te=0;te<H;te++){var re=(te+J*H)*4;$[Q]=L[re],$[Q+1]=L[re+1],$[Q+2]=L[re+2],$[Q+3]=ee,Q+=4}return $}return new Float32Array(j,X,K)},z._GetFloatAsUIntRGBAArrayBuffer=function(H,W,X,K,j,ee){for(var $=new Uint8Array(K),L=new Float32Array(j,X),Q=0,J=0;J<W;J++)for(var te=0;te<H;te++){var re=(te+J*H)*4;$[Q]=t.Scalar.Clamp(L[re])*255,$[Q+1]=t.Scalar.Clamp(L[re+1])*255,$[Q+2]=t.Scalar.Clamp(L[re+2])*255,z.StoreLODInAlphaChannel?$[Q+3]=ee:$[Q+3]=t.Scalar.Clamp(L[re+3])*255,Q+=4}return $},z._GetHalfFloatAsUIntRGBAArrayBuffer=function(H,W,X,K,j,ee){for(var $=new Uint8Array(K),L=new Uint16Array(j,X),Q=0,J=0;J<W;J++)for(var te=0;te<H;te++){var re=(te+J*H)*4;$[Q]=t.Scalar.Clamp(z._FromHalfFloat(L[re]))*255,$[Q+1]=t.Scalar.Clamp(z._FromHalfFloat(L[re+1]))*255,$[Q+2]=t.Scalar.Clamp(z._FromHalfFloat(L[re+2]))*255,z.StoreLODInAlphaChannel?$[Q+3]=ee:$[Q+3]=t.Scalar.Clamp(z._FromHalfFloat(L[re+3]))*255,Q+=4}return $},z._GetRGBAArrayBuffer=function(H,W,X,K,j,ee,$,L,Q){for(var J=new Uint8Array(K),te=new Uint8Array(j,X),re=0,le=0;le<W;le++)for(var ie=0;ie<H;ie++){var ce=(ie+le*H)*4;J[re]=te[ce+ee],J[re+1]=te[ce+$],J[re+2]=te[ce+L],J[re+3]=te[ce+Q],re+=4}return J},z._ExtractLongWordOrder=function(H){return H===0||H===255||H===-16777216?0:1+z._ExtractLongWordOrder(H>>8)},z._GetRGBArrayBuffer=function(H,W,X,K,j,ee,$,L){for(var Q=new Uint8Array(K),J=new Uint8Array(j,X),te=0,re=0;re<W;re++)for(var le=0;le<H;le++){var ie=(le+re*H)*3;Q[te]=J[ie+ee],Q[te+1]=J[ie+$],Q[te+2]=J[ie+L],te+=3}return Q},z._GetLuminanceArrayBuffer=function(H,W,X,K,j){for(var ee=new Uint8Array(K),$=new Uint8Array(j,X),L=0,Q=0;Q<W;Q++)for(var J=0;J<H;J++){var te=J+Q*H;ee[L]=$[te],L++}return ee},z.UploadDDSLevels=function(H,W,X,K,j,ee,$,L){$===void 0&&($=-1);var Q=null;K.sphericalPolynomial&&(Q=new Array);var J=H.getCaps().s3tc,te=new Int32Array(X,0,S),re,le,ie,ce=0,de,_e,ge,me,ve=0,be=1;if(te[P]!==f){t.Tools.Error("Invalid magic number in DDS header");return}if(!K.isFourCC&&!K.isRGB&&!K.isLuminance){t.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(K.isCompressed&&!J){t.Tools.Error("Compressed textures are not supported on this platform.");return}var Te=te[g];de=te[x]+4;var He=!1;if(K.isFourCC)switch(re=te[E],re){case l:be=8,ve=J.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:be=16,ve=J.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case h:be=16,ve=J.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case p:He=!0;break;case m:He=!0;break;case d:de+=5*4;var De=!1;switch(K.dxgiFormat){case _:He=!0,De=!0;break;case v:K.isRGB=!0,K.isFourCC=!1,Te=32,De=!0;break}if(De)break;default:console.error("Unsupported FourCC code:",o(re));return}var Fe=z._ExtractLongWordOrder(te[y]),Qe=z._ExtractLongWordOrder(te[M]),at=z._ExtractLongWordOrder(te[C]),Rt=z._ExtractLongWordOrder(te[D]);He&&(ve=H._getRGBABufferInternalSizedFormat(K.textureType)),ge=1,te[R]&c&&j!==!1&&(ge=Math.max(1,te[F]));for(var Ge=0;Ge<ee;Ge++){for(le=te[I],ie=te[w],me=0;me<ge;++me){if($===-1||$===me){var Se=$===-1?me:0;if(!K.isCompressed&&K.isFourCC){W.format=t.Engine.TEXTUREFORMAT_RGBA,ce=le*ie*4;var ze=null;H._badOS||H._badDesktopOS||!H.getCaps().textureHalfFloat&&!H.getCaps().textureFloat?(Te===128?(ze=z._GetFloatAsUIntRGBAArrayBuffer(le,ie,de,ce,X,Se),Q&&Se==0&&Q.push(z._GetFloatRGBAArrayBuffer(le,ie,de,ce,X,Se))):Te===64&&(ze=z._GetHalfFloatAsUIntRGBAArrayBuffer(le,ie,de,ce,X,Se),Q&&Se==0&&Q.push(z._GetHalfFloatAsFloatRGBAArrayBuffer(le,ie,de,ce,X,Se))),W.type=t.Engine.TEXTURETYPE_UNSIGNED_INT):Te===128?(W.type=t.Engine.TEXTURETYPE_FLOAT,ze=z._GetFloatRGBAArrayBuffer(le,ie,de,ce,X,Se),Q&&Se==0&&Q.push(ze)):Te===64&&!H.getCaps().textureHalfFloat?(W.type=t.Engine.TEXTURETYPE_FLOAT,ze=z._GetHalfFloatAsFloatRGBAArrayBuffer(le,ie,de,ce,X,Se),Q&&Se==0&&Q.push(ze)):(W.type=t.Engine.TEXTURETYPE_HALF_FLOAT,ze=z._GetHalfFloatRGBAArrayBuffer(le,ie,de,ce,X,Se),Q&&Se==0&&Q.push(z._GetHalfFloatAsFloatRGBAArrayBuffer(le,ie,de,ce,X,Se))),ze&&H._uploadDataToTextureDirectly(W,ze,Ge,Se)}else if(K.isRGB)W.type=t.Engine.TEXTURETYPE_UNSIGNED_INT,Te===24?(W.format=t.Engine.TEXTUREFORMAT_RGB,ce=le*ie*3,_e=z._GetRGBArrayBuffer(le,ie,de,ce,X,Fe,Qe,at),H._uploadDataToTextureDirectly(W,_e,Ge,Se)):(W.format=t.Engine.TEXTUREFORMAT_RGBA,ce=le*ie*4,_e=z._GetRGBAArrayBuffer(le,ie,de,ce,X,Fe,Qe,at,Rt),H._uploadDataToTextureDirectly(W,_e,Ge,Se));else if(K.isLuminance){var dr=H._getUnpackAlignement(),Ga=le,Ua=Math.floor((le+dr-1)/dr)*dr;ce=Ua*(ie-1)+Ga,_e=z._GetLuminanceArrayBuffer(le,ie,de,ce,X),W.format=t.Engine.TEXTUREFORMAT_LUMINANCE,W.type=t.Engine.TEXTURETYPE_UNSIGNED_INT,H._uploadDataToTextureDirectly(W,_e,Ge,Se)}else ce=Math.max(4,le)/4*Math.max(4,ie)/4*be,_e=new Uint8Array(X,de,ce),W.type=t.Engine.TEXTURETYPE_UNSIGNED_INT,H._uploadCompressedDataToTextureDirectly(W,ve,le,ie,_e,Ge,Se)}de+=Te?le*ie*(Te/8):ce,le*=.5,ie*=.5,le=Math.max(1,le),ie=Math.max(1,ie)}if(L!==void 0)break}Q&&Q.length>0?K.sphericalPolynomial=t.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial({size:te[I],right:Q[0],left:Q[1],up:Q[2],down:Q[3],front:Q[4],back:Q[5],format:t.Engine.TEXTUREFORMAT_RGBA,type:t.Engine.TEXTURETYPE_FLOAT,gammaSpace:!1}):K.sphericalPolynomial=void 0},z.StoreLODInAlphaChannel=!1,z}();t.DDSTools=U})(T||(T={}));var T;(function(t){var f=function(){function c(){this.supportCascades=!0}return c.prototype.canLoad=function(r,i,a,n,s){return r.indexOf(".dds")===0},c.prototype.transformUrl=function(r,i){return r},c.prototype.getFallbackTextureUrl=function(r,i){return null},c.prototype.loadCubeData=function(r,i,a,n,s){var o=i.getEngine(),l,u=!1;if(Array.isArray(r))for(var h=0;h<r.length;h++){var d=r[h];l=t.DDSTools.GetDDSInfo(d),i.width=l.width,i.height=l.height,u=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&i.generateMipMaps,o._unpackFlipY(l.isCompressed),t.DDSTools.UploadDDSLevels(o,i,d,l,u,6,-1,h),!l.isFourCC&&l.mipmapCount===1&&o.generateMipMapsForCubemap(i)}else{var p=r;l=t.DDSTools.GetDDSInfo(p),i.width=l.width,i.height=l.height,a&&(l.sphericalPolynomial=new t.SphericalPolynomial),u=(l.isRGB||l.isLuminance||l.mipmapCount>1)&&i.generateMipMaps,o._unpackFlipY(l.isCompressed),t.DDSTools.UploadDDSLevels(o,i,p,l,u,6),!l.isFourCC&&l.mipmapCount===1&&o.generateMipMapsForCubemap(i)}o._setCubeMapTextureParams(u),i.isReady=!0,n&&n({isDDS:!0,width:i.width,info:l,data:r,texture:i})},c.prototype.loadData=function(r,i,a){var n=t.DDSTools.GetDDSInfo(r),s=(n.isRGB||n.isLuminance||n.mipmapCount>1)&&i.generateMipMaps&&n.width>>n.mipmapCount-1===1;a(n.width,n.height,s,n.isFourCC,function(){t.DDSTools.UploadDDSLevels(i.getEngine(),i,r,n,s,1)})},c}();t.Engine._TextureLoaders.push(new f)})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.GetTGAHeader=function(r){var i=0,a={id_length:r[i++],colormap_type:r[i++],image_type:r[i++],colormap_index:r[i++]|r[i++]<<8,colormap_length:r[i++]|r[i++]<<8,colormap_size:r[i++],origin:[r[i++]|r[i++]<<8,r[i++]|r[i++]<<8],width:r[i++]|r[i++]<<8,height:r[i++]|r[i++]<<8,pixel_size:r[i++],flags:r[i++]};return a},c.UploadContent=function(r,i){if(i.length<19){t.Tools.Error("Unable to load TGA file - Not enough data to contain header");return}var a=18,n=c.GetTGAHeader(i);if(n.id_length+a>i.length){t.Tools.Error("Unable to load TGA file - Not enough data");return}a+=n.id_length;var s=!1,o=!1,l=!1;switch(n.image_type){case c._TYPE_RLE_INDEXED:s=!0;case c._TYPE_INDEXED:o=!0;break;case c._TYPE_RLE_RGB:s=!0;case c._TYPE_RGB:break;case c._TYPE_RLE_GREY:s=!0;case c._TYPE_GREY:l=!0;break}var u,h=n.pixel_size>>3,d=n.width*n.height*h,p;if(o&&(p=i.subarray(a,a+=n.colormap_length*(n.colormap_size>>3))),s){u=new Uint8Array(d);for(var m,_,v,S=0,P=new Uint8Array(h);a<d&&S<d;)if(m=i[a++],_=(m&127)+1,m&128){for(v=0;v<h;++v)P[v]=i[a++];for(v=0;v<_;++v)u.set(P,S+v*h);S+=h*_}else{for(_*=h,v=0;v<_;++v)u[S+v]=i[a++];S+=_}}else u=i.subarray(a,a+=o?n.width*n.height:d);var x,R,w,I,F,k;switch((n.flags&c._ORIGIN_MASK)>>c._ORIGIN_SHIFT){default:case c._ORIGIN_UL:x=0,w=1,k=n.width,R=0,I=1,F=n.height;break;case c._ORIGIN_BL:x=0,w=1,k=n.width,R=n.height-1,I=-1,F=-1;break;case c._ORIGIN_UR:x=n.width-1,w=-1,k=-1,R=0,I=1,F=n.height;break;case c._ORIGIN_BR:x=n.width-1,w=-1,k=-1,R=n.height-1,I=-1,F=-1;break}var E="_getImageData"+(l?"Grey":"")+n.pixel_size+"bits",g=c[E](n,p,u,R,I,F,x,w,k),y=r.getEngine();y._uploadDataToTextureDirectly(r,g)},c._getImageData8bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=i,m=r.width,_=r.height,v,S=0,P,x,R=new Uint8Array(m*_*4);for(x=n;x!==o;x+=s)for(P=l;P!==h;P+=u,S++)v=d[S],R[(P+m*x)*4+3]=255,R[(P+m*x)*4+2]=p[v*3+0],R[(P+m*x)*4+1]=p[v*3+1],R[(P+m*x)*4+0]=p[v*3+2];return R},c._getImageData16bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=r.width,m=r.height,_,v=0,S,P,x=new Uint8Array(p*m*4);for(P=n;P!==o;P+=s)for(S=l;S!==h;S+=u,v+=2){_=d[v+0]+(d[v+1]<<8);var R=((_&31744)>>10)*255/31|0,w=((_&992)>>5)*255/31|0,I=(_&31)*255/31|0;x[(S+p*P)*4+0]=R,x[(S+p*P)*4+1]=w,x[(S+p*P)*4+2]=I,x[(S+p*P)*4+3]=_&32768?0:255}return x},c._getImageData24bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=r.width,m=r.height,_=0,v,S,P=new Uint8Array(p*m*4);for(S=n;S!==o;S+=s)for(v=l;v!==h;v+=u,_+=3)P[(v+p*S)*4+3]=255,P[(v+p*S)*4+2]=d[_+0],P[(v+p*S)*4+1]=d[_+1],P[(v+p*S)*4+0]=d[_+2];return P},c._getImageData32bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=r.width,m=r.height,_=0,v,S,P=new Uint8Array(p*m*4);for(S=n;S!==o;S+=s)for(v=l;v!==h;v+=u,_+=4)P[(v+p*S)*4+2]=d[_+0],P[(v+p*S)*4+1]=d[_+1],P[(v+p*S)*4+0]=d[_+2],P[(v+p*S)*4+3]=d[_+3];return P},c._getImageDataGrey8bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=r.width,m=r.height,_,v=0,S,P,x=new Uint8Array(p*m*4);for(P=n;P!==o;P+=s)for(S=l;S!==h;S+=u,v++)_=d[v],x[(S+p*P)*4+0]=_,x[(S+p*P)*4+1]=_,x[(S+p*P)*4+2]=_,x[(S+p*P)*4+3]=255;return x},c._getImageDataGrey16bits=function(r,i,a,n,s,o,l,u,h){var d=a,p=r.width,m=r.height,_=0,v,S,P=new Uint8Array(p*m*4);for(S=n;S!==o;S+=s)for(v=l;v!==h;v+=u,_+=2)P[(v+p*S)*4+0]=d[_+0],P[(v+p*S)*4+1]=d[_+0],P[(v+p*S)*4+2]=d[_+0],P[(v+p*S)*4+3]=d[_+1];return P},c._TYPE_INDEXED=1,c._TYPE_RGB=2,c._TYPE_GREY=3,c._TYPE_RLE_INDEXED=9,c._TYPE_RLE_RGB=10,c._TYPE_RLE_GREY=11,c._ORIGIN_MASK=48,c._ORIGIN_SHIFT=4,c._ORIGIN_BL=0,c._ORIGIN_BR=1,c._ORIGIN_UL=2,c._ORIGIN_UR=3,c}();t.TGATools=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.supportCascades=!1}return c.prototype.canLoad=function(r,i,a,n,s){return r.indexOf(".tga")===0},c.prototype.transformUrl=function(r,i){return r},c.prototype.getFallbackTextureUrl=function(r,i){return null},c.prototype.loadCubeData=function(r,i,a,n,s){throw".env not supported in Cube."},c.prototype.loadData=function(r,i,a){var n=new Uint8Array(r),s=t.TGATools.GetTGAHeader(n);a(s.width,s.height,i.generateMipMaps,!1,function(){t.TGATools.UploadContent(i,n)})},c}();t.Engine._TextureLoaders.push(new f)})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n){this.arrayBuffer=r;var s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10){t.Tools.Error("texture missing KTX identifier");return}var o=new Int32Array(this.arrayBuffer,12,13),l=o[0]===16909060;if(this.glType=l?this.switchEndianness(o[1]):o[1],this.glTypeSize=l?this.switchEndianness(o[2]):o[2],this.glFormat=l?this.switchEndianness(o[3]):o[3],this.glInternalFormat=l?this.switchEndianness(o[4]):o[4],this.glBaseInternalFormat=l?this.switchEndianness(o[5]):o[5],this.pixelWidth=l?this.switchEndianness(o[6]):o[6],this.pixelHeight=l?this.switchEndianness(o[7]):o[7],this.pixelDepth=l?this.switchEndianness(o[8]):o[8],this.numberOfArrayElements=l?this.switchEndianness(o[9]):o[9],this.numberOfFaces=l?this.switchEndianness(o[10]):o[10],this.numberOfMipmapLevels=l?this.switchEndianness(o[11]):o[11],this.bytesOfKeyValueData=l?this.switchEndianness(o[12]):o[12],this.glType!==0){t.Tools.Error("only compressed formats currently supported");return}else this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels);if(this.pixelHeight===0||this.pixelDepth!==0){t.Tools.Error("only 2D textures currently supported");return}if(this.numberOfArrayElements!==0){t.Tools.Error("texture arrays not currently supported");return}if(this.numberOfFaces!==i){t.Tools.Error("number of faces expected"+i+", but found "+this.numberOfFaces);return}this.loadType=c.COMPRESSED_2D}return c.prototype.switchEndianness=function(r){return(r&255)<<24|(r&65280)<<8|r>>8&65280|r>>24&255},c.prototype.uploadLevels=function(r,i){switch(this.loadType){case c.COMPRESSED_2D:this._upload2DCompressedLevels(r,i);break;case c.TEX_2D:case c.COMPRESSED_3D:case c.TEX_3D:}},c.prototype._upload2DCompressedLevels=function(r,i){for(var a=c.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,s=this.pixelHeight,o=i?this.numberOfMipmapLevels:1,l=0;l<o;l++){var u=new Int32Array(this.arrayBuffer,a,1)[0];a+=4;for(var h=0;h<this.numberOfFaces;h++){var d=new Uint8Array(this.arrayBuffer,a,u),p=r.getEngine();p._uploadCompressedDataToTextureDirectly(r,this.glInternalFormat,n,s,d,h,l),a+=u,a+=3-(u+3)%4}n=Math.max(1,n*.5),s=Math.max(1,s*.5)}},c.HEADER_LEN=64,c.COMPRESSED_2D=0,c.COMPRESSED_3D=1,c.TEX_2D=2,c.TEX_3D=3,c}();t.KhronosTextureContainer=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.supportCascades=!1}return c.prototype.canLoad=function(r,i,a,n,s){return!!(i&&!n&&!a&&!s)},c.prototype.transformUrl=function(r,i){var a=r.lastIndexOf(".");return(a>-1?r.substring(0,a):r)+i},c.prototype.getFallbackTextureUrl=function(r,i){var a=new RegExp(""+i+"$");return r.replace(a,"")},c.prototype.loadCubeData=function(r,i,a,n,s){if(!Array.isArray(r)){var o=i.getEngine(),l=new t.KhronosTextureContainer(r,6),u=l.numberOfMipmapLevels>1&&i.generateMipMaps;o._unpackFlipY(!0),l.uploadLevels(i,i.generateMipMaps),i.width=l.pixelWidth,i.height=l.pixelHeight,o._setCubeMapTextureParams(u),i.isReady=!0}},c.prototype.loadData=function(r,i,a){var n=new t.KhronosTextureContainer(r,1);a(n.pixelWidth,n.pixelHeight,!1,!0,function(){n.uploadLevels(i,i.generateMipMaps)})},c}();t.Engine._TextureLoaders.unshift(new f)})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.GetEnvInfo=function(r){for(var i=new DataView(r),a=0,n=0;n<c._MagicBytes.length;n++)if(i.getUint8(a++)!==c._MagicBytes[n])return t.Tools.Error("Not a babylon environment map"),null;for(var s="",o=0;o=i.getUint8(a++);)s+=String.fromCharCode(o);var l=JSON.parse(s);return l.specular&&(l.specular.specularDataPosition=a,l.specular.lodGenerationScale=l.specular.lodGenerationScale||.8),l},c.CreateEnvTextureAsync=function(r){var i=this,a=r.getInternalTexture();if(!a)return Promise.reject("The cube texture is invalid.");if(!r._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var n=a.getEngine();if(n&&n.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(r.textureType===t.Engine.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var s=n.getRenderingCanvas();if(!s)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var o=t.Engine.TEXTURETYPE_FLOAT;if(!n.getCaps().textureFloatRender&&(o=t.Engine.TEXTURETYPE_HALF_FLOAT,!n.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var l=a.width,u=new t.Scene(n),h={},d=[],p=t.Scalar.Log2(a.width);p=Math.round(p);for(var m=function(v){for(var S=Math.pow(2,p-v),P=function(R){var w=r.readPixels(R,v),I=n.createRawTexture(w,S,S,t.Engine.TEXTUREFORMAT_RGBA,!1,!1,t.Texture.NEAREST_SAMPLINGMODE,null,o),F=new Promise(function(k,E){var g=new t.PostProcess("rgbdEncode","rgbdEncode",null,null,1,null,t.Texture.NEAREST_SAMPLINGMODE,n,!1,void 0,t.Engine.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);g.getEffect().executeWhenCompiled(function(){g.onApply=function(C){C._bindTexture("textureSampler",I)};var y=n.getRenderWidth(),M=n.getRenderHeight();n.setSize(S,S),u.postProcessManager.directRender([g],null),t.Tools.ToBlob(s,function(C){var D=new FileReader;D.onload=function(V){var G=V.target.result;h[v*6+R]=G,k()},D.readAsArrayBuffer(C)}),n.setSize(y,M)})});d.push(F)},x=0;x<6;x++)P(x)},_=0;_<=p;_++)m(_);return Promise.all(d).then(function(){u.dispose();for(var v={version:1,width:l,irradiance:i._CreateEnvTextureIrradiance(r),specular:{mipmaps:[],lodGenerationScale:r.lodGenerationScale}},S=0,P=0;P<=p;P++)for(var x=0;x<6;x++){var R=h[P*6+x].byteLength;v.specular.mipmaps.push({length:R,position:S}),S+=R}for(var w=JSON.stringify(v),I=new ArrayBuffer(w.length+1),F=new Uint8Array(I),P=0,k=w.length;P<k;P++)F[P]=w.charCodeAt(P);F[w.length]=0;for(var E=c._MagicBytes.length+S+I.byteLength,g=new ArrayBuffer(E),y=new Uint8Array(g),M=new DataView(g),C=0,P=0;P<c._MagicBytes.length;P++)M.setUint8(C++,c._MagicBytes[P]);y.set(new Uint8Array(I),C),C+=I.byteLength;for(var P=0;P<=p;P++)for(var x=0;x<6;x++){var D=h[P*6+x];y.set(new Uint8Array(D),C),C+=D.byteLength}return g})},c._CreateEnvTextureIrradiance=function(r){var i=r.sphericalPolynomial;return i==null?null:{x:[i.x.x,i.x.y,i.x.z],y:[i.y.x,i.y.y,i.y.z],z:[i.z.x,i.z.y,i.z.z],xx:[i.xx.x,i.xx.y,i.xx.z],yy:[i.yy.x,i.yy.y,i.yy.z],zz:[i.zz.x,i.zz.y,i.zz.z],yz:[i.yz.x,i.yz.y,i.yz.z],zx:[i.zx.x,i.zx.y,i.zx.z],xy:[i.xy.x,i.xy.y,i.xy.z]}},c.UploadEnvLevelsAsync=function(r,i,a){if(a.version!==1)throw new Error('Unsupported babylon environment map version "'+a.version+'"');var n=a.specular;if(!n)return Promise.resolve();var s=t.Scalar.Log2(a.width);if(s=Math.round(s)+1,n.mipmaps.length!==6*s)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');r._lodGenerationScale=n.lodGenerationScale;for(var o=new Array(s),l=0;l<s;l++){o[l]=new Array(6);for(var u=0;u<6;u++){var h=n.mipmaps[l*6+u];o[l][u]=new Uint8Array(i,n.specularDataPosition+h.position,h.length)}}return c.UploadLevelsAsync(r,o)},c.UploadLevelsAsync=function(r,i){if(!t.Tools.IsExponentOfTwo(r.width))throw new Error("Texture size must be a power of two");var a=Math.round(t.Scalar.Log2(r.width))+1,n=r.getEngine(),s=!1,o=!1,l=null,u=null,h=null,d=n.getCaps();if(r.format=t.Engine.TEXTUREFORMAT_RGBA,r.type=t.Engine.TEXTURETYPE_UNSIGNED_INT,r.generateMipMaps=!0,n.updateTextureSamplingMode(t.Texture.TRILINEAR_SAMPLINGMODE,r),d.textureLOD?n.webGLVersion<2?s=!1:d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(s=!0,r.type=t.Engine.TEXTURETYPE_HALF_FLOAT):d.textureFloatRender&&d.textureFloatLinearFiltering&&(s=!0,r.type=t.Engine.TEXTURETYPE_FLOAT):(s=!1,o=!0,h={}),s)l=new t.PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,t.Texture.TRILINEAR_SAMPLINGMODE,n,!1,void 0,r.type,void 0,null,!1),r._isRGBD=!1,r.invertY=!1,u=n.createRenderTargetCubeTexture(r.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:t.Texture.TRILINEAR_SAMPLINGMODE,type:r.type,format:t.Engine.TEXTUREFORMAT_RGBA});else if(r._isRGBD=!0,r.invertY=!0,o)for(var p=3,m=r._lodGenerationScale,_=r._lodGenerationOffset,v=0;v<p;v++){var S=v/(p-1),P=1-S,x=_,R=(a-1)*m+_,w=x+(R-x)*P,I=Math.round(Math.min(Math.max(w,0),R)),F=new t.InternalTexture(n,t.InternalTexture.DATASOURCE_TEMP);F.isCube=!0,F.invertY=!0,F.generateMipMaps=!1,n.updateTextureSamplingMode(t.Texture.LINEAR_LINEAR,F);var k=new t.BaseTexture(null);switch(k.isCube=!0,k._texture=F,h[I]=k,v){case 0:r._lodTextureLow=k;break;case 1:r._lodTextureMid=k;break;case 2:r._lodTextureHigh=k;break}}for(var E=[],g=function(V){for(var G=function(z){var H=i[V][z],W=new Blob([H],{type:"image/png"}),X=URL.createObjectURL(W),K=new Image;K.src=X;var j=new Promise(function(ee,$){K.onload=function(){if(s){var L=n.createTexture(null,!0,!0,null,t.Texture.NEAREST_SAMPLINGMODE,null,function(J){$(J)},K);l.getEffect().executeWhenCompiled(function(){l.onApply=function(J){J._bindTexture("textureSampler",L),J.setFloat2("scale",1,1)},n.scenes[0].postProcessManager.directRender([l],u,!0,z,V),n.restoreDefaultFramebuffer(),L.dispose(),window.URL.revokeObjectURL(X),ee()})}else{if(n._uploadImageToTexture(r,K,z,V),o){var Q=h[V];Q&&n._uploadImageToTexture(Q._texture,K,z,0)}ee()}},K.onerror=function(L){$(L)}});E.push(j)},U=0;U<6;U++)G(U)},v=0;v<i.length;v++)g(v);if(i.length<a){var y=void 0,M=Math.pow(2,a-1-i.length),C=M*M*4;switch(r.type){case t.Engine.TEXTURETYPE_UNSIGNED_INT:{y=new Uint8Array(C);break}case t.Engine.TEXTURETYPE_HALF_FLOAT:{y=new Uint16Array(C);break}case t.Engine.TEXTURETYPE_FLOAT:{y=new Float32Array(C);break}}for(var v=i.length;v<a;v++)for(var D=0;D<6;D++)n._uploadArrayBufferViewToTexture(r,y,D,v)}return Promise.all(E).then(function(){u&&(n._releaseFramebufferObjects(u),u._swapAndDie(r)),l&&l.dispose(),o&&(r._lodTextureHigh&&r._lodTextureHigh._texture&&(r._lodTextureHigh._texture.isReady=!0),r._lodTextureMid&&r._lodTextureMid._texture&&(r._lodTextureMid._texture.isReady=!0),r._lodTextureLow&&r._lodTextureLow._texture&&(r._lodTextureLow._texture.isReady=!0))})},c.UploadEnvSpherical=function(r,i){i.version!==1&&t.Tools.Warn('Unsupported babylon environment map version "'+i.version+'"');var a=i.irradiance;if(a){var n=new t.SphericalPolynomial;t.Vector3.FromArrayToRef(a.x,0,n.x),t.Vector3.FromArrayToRef(a.y,0,n.y),t.Vector3.FromArrayToRef(a.z,0,n.z),t.Vector3.FromArrayToRef(a.xx,0,n.xx),t.Vector3.FromArrayToRef(a.yy,0,n.yy),t.Vector3.FromArrayToRef(a.zz,0,n.zz),t.Vector3.FromArrayToRef(a.yz,0,n.yz),t.Vector3.FromArrayToRef(a.zx,0,n.zx),t.Vector3.FromArrayToRef(a.xy,0,n.xy),r._sphericalPolynomial=n}},c._MagicBytes=[134,22,135,150,246,214,150,54],c}();t.EnvironmentTextureTools=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.supportCascades=!1}return c.prototype.canLoad=function(r,i,a,n,s){return r.indexOf(".env")===0},c.prototype.transformUrl=function(r,i){return r},c.prototype.getFallbackTextureUrl=function(r,i){return null},c.prototype.loadCubeData=function(r,i,a,n,s){if(!Array.isArray(r)){r=r;var o=t.EnvironmentTextureTools.GetEnvInfo(r);o?(i.width=o.width,i.height=o.width,t.EnvironmentTextureTools.UploadEnvSpherical(i,o),t.EnvironmentTextureTools.UploadEnvLevelsAsync(i,r,o).then(function(){i.isReady=!0,n&&n()})):s&&s("Can not parse the environment file",null)}},c.prototype.loadData=function(r,i,a){throw".env not supported in 2d."},c}();t.Engine._TextureLoaders.push(new f)})(T||(T={}));var T;(function(t){var f=function(){function c(r){var i=this;this.originalScene=r,this._pointerCaptures={},this._lastPointerEvents={},this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new t.Observable,this.utilityLayerScene=new t.Scene(r.getEngine()),this.utilityLayerScene.useRightHandedSystem=r.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,r.getEngine().scenes.pop(),this.utilityLayerScene.detachControl(),this._originalPointerObserver=r.onPrePointerObservable.add(function(a,n){if(!(!i.processAllEvents&&a.type!==t.PointerEventTypes.POINTERMOVE&&a.type!==t.PointerEventTypes.POINTERUP&&a.type!==t.PointerEventTypes.POINTERDOWN)){var s=a.event;if(r.isPointerCaptured(s.pointerId)){i._pointerCaptures[s.pointerId]=!1;return}var o=a.ray?i.utilityLayerScene.pickWithRay(a.ray):i.utilityLayerScene.pick(r.pointerX,r.pointerY);if(!a.ray&&o&&(a.ray=o.ray),i.utilityLayerScene.onPrePointerObservable.notifyObservers(a),i.onlyCheckPointerDownEvents&&a.type!=t.PointerEventTypes.POINTERDOWN){a.skipOnPointerObservable||i.utilityLayerScene.onPointerObservable.notifyObservers(new t.PointerInfo(a.type,a.event,o)),a.type===t.PointerEventTypes.POINTERUP&&i._pointerCaptures[s.pointerId]&&(i._pointerCaptures[s.pointerId]=!1);return}if(i.utilityLayerScene.autoClearDepthAndStencil)o&&o.hit&&(a.skipOnPointerObservable||i.utilityLayerScene.onPointerObservable.notifyObservers(new t.PointerInfo(a.type,a.event,o)),a.skipOnPointerObservable=!0);else{var l=a.ray?r.pickWithRay(a.ray):r.pick(r.pointerX,r.pointerY),u=a.event;l&&o&&(o.distance===0&&l.pickedMesh?i.mainSceneTrackerPredicate&&i.mainSceneTrackerPredicate(l.pickedMesh)?(i._notifyObservers(a,l,u),a.skipOnPointerObservable=!0):a.type===t.PointerEventTypes.POINTERDOWN?i._pointerCaptures[u.pointerId]=!0:i._lastPointerEvents[u.pointerId]&&(i.onPointerOutObservable.notifyObservers(u.pointerId),delete i._lastPointerEvents[u.pointerId]):!i._pointerCaptures[u.pointerId]&&(o.distance<l.distance||l.distance===0)?(i._notifyObservers(a,o,u),a.skipOnPointerObservable||(a.skipOnPointerObservable=o.distance>0)):!i._pointerCaptures[u.pointerId]&&o.distance>l.distance&&(i.mainSceneTrackerPredicate&&i.mainSceneTrackerPredicate(l.pickedMesh)?(i._notifyObservers(a,l,u),a.skipOnPointerObservable=!0):i._lastPointerEvents[u.pointerId]&&(i.onPointerOutObservable.notifyObservers(u.pointerId),delete i._lastPointerEvents[u.pointerId])),a.type===t.PointerEventTypes.POINTERUP&&i._pointerCaptures[u.pointerId]&&(i._pointerCaptures[u.pointerId]=!1))}}}),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderObservable.add(function(){i.shouldRender&&i.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){i.dispose()}),this._updateCamera()}return Object.defineProperty(c,"DefaultUtilityLayer",{get:function(){return c._DefaultUtilityLayer==null&&(c._DefaultUtilityLayer=new c(t.Engine.LastCreatedScene),c._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){c._DefaultUtilityLayer=null})),c._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(c,"DefaultKeepDepthUtilityLayer",{get:function(){return c._DefaultKeepDepthUtilityLayer==null&&(c._DefaultKeepDepthUtilityLayer=new c(t.Engine.LastCreatedScene),c._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,c._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){c._DefaultKeepDepthUtilityLayer=null})),c._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),c.prototype._notifyObservers=function(r,i,a){r.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new t.PointerInfo(r.type,r.event,i)),this._lastPointerEvents[a.pointerId]=!0)},c.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var r=this.utilityLayerScene.activeCamera.getScene(),i=this.utilityLayerScene.activeCamera;i._scene=this.utilityLayerScene,i.leftCamera&&(i.leftCamera._scene=this.utilityLayerScene),i.rightCamera&&(i.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),i._scene=r,i.leftCamera&&(i.leftCamera._scene=r),i.rightCamera&&(i.rightCamera._scene=r)}},c.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},c.prototype._updateCamera=function(){this.utilityLayerScene.activeCamera=this.originalScene.activeCamera},c._DefaultUtilityLayer=null,c._DefaultKeepDepthUtilityLayer=null,c}();t.UtilityLayerRenderer=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new t.Observable,this.onDragStartObservable=new t.Observable,this.onDragEndObservable=new t.Observable,this.moveAttached=!0,this.enabled=!0,this.detachCameraControls=!0,this.useObjectOrienationForDragging=!0,this._tmpVector=new t.Vector3(0,0,0),this._alternatePickedPoint=new t.Vector3(0,0,0),this._worldDragAxis=new t.Vector3(0,0,0),this._targetPosition=new t.Vector3(0,0,0),this._attachedElement=null,this._startDragRay=new t.Ray(new t.Vector3,new t.Vector3),this._lastPointerRay={},this._dragDelta=new t.Vector3,this._pointA=new t.Vector3(0,0,0),this._pointB=new t.Vector3(0,0,0),this._pointC=new t.Vector3(0,0,0),this._lineA=new t.Vector3(0,0,0),this._lineB=new t.Vector3(0,0,0),this._localAxis=new t.Vector3(0,0,0),this._lookAt=new t.Vector3(0,0,0),this._options=r||{};var i=0;if(this._options.dragAxis&&i++,this._options.dragPlaneNormal&&i++,i>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(c.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){var i=this;this._scene=r.getScene(),this._attachedNode=r,c._planeScene||(this._debugMode?c._planeScene=this._scene:(c._planeScene=new t.Scene(this._scene.getEngine()),c._planeScene.detachControl(),this._scene.getEngine().scenes.pop(),this._scene.onDisposeObservable.addOnce(function(){c._planeScene.dispose(),c._planeScene=null}))),this._dragPlane=t.Mesh.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,c._planeScene,!1,t.Mesh.DOUBLESIDE),this.lastDragPosition=new t.Vector3(0,0,0);var a=function(n){return i._attachedNode==n||n.isDescendantOf(i._attachedNode)};this._pointerObserver=this._scene.onPointerObservable.add(function(n,s){if(i.enabled){if(n.type==t.PointerEventTypes.POINTERDOWN)!i.dragging&&n.pickInfo&&n.pickInfo.hit&&n.pickInfo.pickedMesh&&n.pickInfo.pickedPoint&&n.pickInfo.ray&&a(n.pickInfo.pickedMesh)&&i._startDrag(n.event.pointerId,n.pickInfo.ray,n.pickInfo.pickedPoint);else if(n.type==t.PointerEventTypes.POINTERUP)i.currentDraggingPointerID==n.event.pointerId&&i.releaseDrag();else if(n.type==t.PointerEventTypes.POINTERMOVE){var o=n.event.pointerId;i.currentDraggingPointerID===c._AnyMouseID&&o!==c._AnyMouseID&&n.event.pointerType=="mouse"&&(i._lastPointerRay[i.currentDraggingPointerID]&&(i._lastPointerRay[o]=i._lastPointerRay[i.currentDraggingPointerID],delete i._lastPointerRay[i.currentDraggingPointerID]),i.currentDraggingPointerID=o),i._lastPointerRay[o]||(i._lastPointerRay[o]=new t.Ray(new t.Vector3,new t.Vector3)),n.pickInfo&&n.pickInfo.ray&&(i._lastPointerRay[o].origin.copyFrom(n.pickInfo.ray.origin),i._lastPointerRay[o].direction.copyFrom(n.pickInfo.ray.direction),i.currentDraggingPointerID==o&&i.dragging&&i._moveDrag(n.pickInfo.ray))}}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){i._moving&&i.moveAttached&&(t.BoundingBoxGizmo._RemoveAndStorePivotPoint(i._attachedNode),i._targetPosition.subtractToRef(i._attachedNode.absolutePosition,i._tmpVector),i._tmpVector.scaleInPlace(i.dragDeltaRatio),i._attachedNode.getAbsolutePosition().addToRef(i._tmpVector,i._tmpVector),i._attachedNode.setAbsolutePosition(i._tmpVector),t.BoundingBoxGizmo._RestorePivotPoint(i._attachedNode))})},c.prototype.releaseDrag=function(){this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!0)},c.prototype.startDrag=function(r,i,a){r===void 0&&(r=c._AnyMouseID),this._startDrag(r,i,a);var n=this._lastPointerRay[r];r===c._AnyMouseID&&(n=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),n&&this._moveDrag(n)},c.prototype._startDrag=function(r,i,a){if(!(!this._scene.activeCamera||this.dragging||!this._attachedNode)){t.BoundingBoxGizmo._RemoveAndStorePivotPoint(this._attachedNode),i?(this._startDragRay.direction.copyFrom(i.direction),this._startDragRay.origin.copyFrom(i.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,a||this._tmpVector);var n=this._pickWithRayOnDragPlane(this._startDragRay);n&&(this.dragging=!0,this.currentDraggingPointerID=r,this.lastDragPosition.copyFrom(n),this.onDragStartObservable.notifyObservers({dragPlanePoint:n,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this._attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),t.BoundingBoxGizmo._RestorePivotPoint(this._attachedNode)}},c.prototype._moveDrag=function(r){this._moving=!0;var i=this._pickWithRayOnDragPlane(r);if(i){this.updateDragPlane&&this._updateDragPlanePosition(r,i);var a=0;this._options.dragAxis?(t.Vector3.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis),i.subtractToRef(this.lastDragPosition,this._tmpVector),a=t.Vector3.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(a,this._dragDelta)):(a=this._dragDelta.length(),i.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:a,delta:this._dragDelta,dragPlanePoint:i,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(i)}},c.prototype._pickWithRayOnDragPlane=function(r){var i=this;if(!r)return null;var a=Math.acos(t.Vector3.Dot(this._dragPlane.forward,r.direction));if(a>Math.PI/2&&(a=Math.PI-a),this.maxDragAngle>0&&a>this.maxDragAngle)if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(r.direction),this._attachedNode.absolutePosition.subtractToRef(r.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(-2*t.Vector3.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var n=t.Vector3.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-n,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),this._alternatePickedPoint}else return null;var s=c._planeScene.pickWithRay(r,function(o){return o==i._dragPlane});return s&&s.hit&&s.pickedMesh&&s.pickedPoint?s.pickedPoint:null},c.prototype._updateDragPlanePosition=function(r,i){this._pointA.copyFrom(i),this._options.dragAxis?(this.useObjectOrienationForDragging?t.Vector3.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),r.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),t.Vector3.CrossToRef(this._lineA,this._lineB,this._lookAt),t.Vector3.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.subtractToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrienationForDragging?t.Vector3.TransformCoordinatesToRef(this._options.dragPlaneNormal,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.subtractToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(r.origin)),this._dragPlane.computeWorldMatrix(!0)},c.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},c._AnyMouseID=-2,c}();t.PointerDragBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._startDistance=0,this._initialScale=new t.Vector3(0,0,0),this._targetScale=new t.Vector3(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new t.PointerDragBehavior({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new t.PointerDragBehavior({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(c.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},c.prototype.attach=function(r){var i=this;this._ownerNode=r,this._dragBehaviorA.onDragStartObservable.add(function(a){i._dragBehaviorA.dragging&&i._dragBehaviorB.dragging&&(i._dragBehaviorA.currentDraggingPointerID==i._dragBehaviorB.currentDraggingPointerID?i._dragBehaviorA.releaseDrag():(i._initialScale.copyFrom(r.scaling),i._startDistance=i._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(a){i._dragBehaviorA.dragging&&i._dragBehaviorB.dragging&&(i._dragBehaviorA.currentDraggingPointerID==i._dragBehaviorB.currentDraggingPointerID?i._dragBehaviorB.releaseDrag():(i._initialScale.copyFrom(r.scaling),i._startDistance=i._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(a){a.onDragObservable.add(function(){if(i._dragBehaviorA.dragging&&i._dragBehaviorB.dragging){var n=i._getCurrentDistance()/i._startDistance;i._initialScale.scaleToRef(n,i._targetScale)}})}),r.addBehavior(this._dragBehaviorA),r.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=r.getScene().onBeforeRenderObservable.add(function(){if(i._dragBehaviorA.dragging&&i._dragBehaviorB.dragging){var a=i._targetScale.subtract(r.scaling).scaleInPlace(.1);a.length()>.01&&r.scaling.addInPlace(a)}})},c.prototype.detach=function(){var r=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(i){i.onDragStartObservable.clear(),i.onDragObservable.clear(),r._ownerNode.removeBehavior(i)})},c}();t.MultiPointerScaleBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._sceneRenderObserver=null,this._targetPosition=new t.Vector3(0,0,0),this._moving=!1,this._startingOrientation=new t.Quaternion,this.zDragFactor=3,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new t.Observable,this.onDragEndObservable=new t.Observable}return Object.defineProperty(c.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){var i=this;this._ownerNode=r,this._scene=this._ownerNode.getScene(),c._virtualScene||(c._virtualScene=new t.Scene(this._scene.getEngine()),c._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var a=null,n=new t.Vector3(0,0,0);this._virtualOriginMesh=new t.AbstractMesh("",c._virtualScene),this._virtualOriginMesh.rotationQuaternion=new t.Quaternion,this._virtualDragMesh=new t.AbstractMesh("",c._virtualScene),this._virtualDragMesh.rotationQuaternion=new t.Quaternion;var s=function(u){return i._ownerNode==u||u.isDescendantOf(i._ownerNode)},o=null;this._pointerObserver=this._scene.onPointerObservable.add(function(u,h){if(u.type==t.PointerEventTypes.POINTERDOWN){if(!i.dragging&&u.pickInfo&&u.pickInfo.hit&&u.pickInfo.pickedMesh&&u.pickInfo.ray&&s(u.pickInfo.pickedMesh)){i._scene.activeCamera&&i._scene.activeCamera.cameraRigMode==t.Camera.RIG_MODE_NONE&&u.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position),a=i._ownerNode,t.BoundingBoxGizmo._RemoveAndStorePivotPoint(a),n.copyFrom(u.pickInfo.ray.origin),i._virtualOriginMesh.position.copyFrom(u.pickInfo.ray.origin),i._virtualOriginMesh.lookAt(u.pickInfo.ray.origin.subtract(u.pickInfo.ray.direction)),i._virtualOriginMesh.removeChild(i._virtualDragMesh),a.computeWorldMatrix(),i._virtualDragMesh.position.copyFrom(a.absolutePosition),a.rotationQuaternion||(a.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(a.rotation.y,a.rotation.x,a.rotation.z));var d=a.parent;a.setParent(null),i._virtualDragMesh.rotationQuaternion.copyFrom(a.rotationQuaternion),a.setParent(d),i._virtualOriginMesh.addChild(i._virtualDragMesh),i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition),i.dragging=!0,i.currentDraggingPointerID=u.event.pointerId,i.detachCameraControls&&i._scene.activeCamera&&!i._scene.activeCamera.leftCamera&&(i._scene.activeCamera.inputs.attachedElement?(o=i._scene.activeCamera.inputs.attachedElement,i._scene.activeCamera.detachControl(i._scene.activeCamera.inputs.attachedElement)):o=null),t.BoundingBoxGizmo._RestorePivotPoint(a),i.onDragStartObservable.notifyObservers({})}}else if(u.type==t.PointerEventTypes.POINTERUP)i.currentDraggingPointerID==u.event.pointerId&&(i.dragging=!1,i._moving=!1,i.currentDraggingPointerID=-1,a=null,i._virtualOriginMesh.removeChild(i._virtualDragMesh),i.detachCameraControls&&o&&i._scene.activeCamera&&!i._scene.activeCamera.leftCamera&&i._scene.activeCamera.attachControl(o,!0),i.onDragEndObservable.notifyObservers({}));else if(u.type==t.PointerEventTypes.POINTERMOVE&&i.currentDraggingPointerID==u.event.pointerId&&i.dragging&&u.pickInfo&&u.pickInfo.ray&&a){var p=i.zDragFactor;i._scene.activeCamera&&i._scene.activeCamera.cameraRigMode==t.Camera.RIG_MODE_NONE&&(u.pickInfo.ray.origin.copyFrom(i._scene.activeCamera.position),p=0);var m=u.pickInfo.ray.origin.subtract(n);n.copyFrom(u.pickInfo.ray.origin);var _=-t.Vector3.Dot(m,u.pickInfo.ray.direction);i._virtualOriginMesh.addChild(i._virtualDragMesh),i._virtualDragMesh.position.z-=i._virtualDragMesh.position.z<1?_*i.zDragFactor:_*p*i._virtualDragMesh.position.z,i._virtualDragMesh.position.z<0&&(i._virtualDragMesh.position.z=0),i._virtualOriginMesh.position.copyFrom(u.pickInfo.ray.origin),i._virtualOriginMesh.lookAt(u.pickInfo.ray.origin.subtract(u.pickInfo.ray.direction)),i._virtualOriginMesh.removeChild(i._virtualDragMesh),i._targetPosition.copyFrom(i._virtualDragMesh.absolutePosition),a.parent&&t.Vector3.TransformCoordinatesToRef(i._targetPosition,t.Matrix.Invert(a.parent.getWorldMatrix()),i._targetPosition),i._moving||i._startingOrientation.copyFrom(i._virtualDragMesh.rotationQuaternion),i._moving=!0}});var l=new t.Quaternion;this._sceneRenderObserver=r.getScene().onBeforeRenderObservable.add(function(){if(i.dragging&&i._moving&&a){t.BoundingBoxGizmo._RemoveAndStorePivotPoint(a),a.position.addInPlace(i._targetPosition.subtract(a.position).scale(i.dragDeltaRatio)),l.copyFrom(i._startingOrientation),l.x=-l.x,l.y=-l.y,l.z=-l.z,i._virtualDragMesh.rotationQuaternion.multiplyToRef(l,l),t.Quaternion.RotationYawPitchRollToRef(l.toEulerAngles("xyz").y,0,0,l),l.multiplyToRef(i._startingOrientation,l);var u=a.parent;a.setParent(null),t.Quaternion.SlerpToRef(a.rotationQuaternion,l,i.dragDeltaRatio,a.rotationQuaternion),a.setParent(u),t.BoundingBoxGizmo._RestorePivotPoint(a)}})},c.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},c}();t.SixDofDragBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function r(i,a,n,s){a===void 0&&(a=new t.Vector3),n===void 0&&(n=0),s===void 0&&(s=!1),this.direction=i,this.rotatedDirection=a,this.diff=n,this.ignore=s}return r}(),c=function(){function r(i){this.ui=i,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new f(t.Vector3.Up()),new f(t.Vector3.Down()),new f(t.Vector3.Left()),new f(t.Vector3.Right()),new f(t.Vector3.Forward()),new f(t.Vector3.Forward().scaleInPlace(-1))],this._tmpMatrix=new t.Matrix,this._tmpVector=new t.Vector3,this._zeroVector=t.Vector3.Zero(),this._lookAtTmpMatrix=new t.Matrix}return r.prototype.init=function(){},r.prototype._closestFace=function(i){var a=this;return this._faceVectors.forEach(function(n){a._target.rotationQuaternion||(a._target.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(a._target.rotation.y,a._target.rotation.x,a._target.rotation.z)),a._target.rotationQuaternion.toRotationMatrix(a._tmpMatrix),t.Vector3.TransformCoordinatesToRef(n.direction,a._tmpMatrix,n.rotatedDirection),n.diff=t.Vector3.GetAngleBetweenVectors(n.rotatedDirection,i,t.Vector3.Cross(n.rotatedDirection,i))}),this._faceVectors.reduce(function(n,s){return n.ignore?s:s.ignore||n.diff<s.diff?n:s},this._faceVectors[0])},r.prototype._lookAtToRef=function(i,a,n){a===void 0&&(a=new t.Vector3(0,1,0)),t.Matrix.LookAtLHToRef(this._zeroVector,i,a,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),t.Quaternion.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},r.prototype.attach=function(i){var a=this;this._target=i,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(a._scene.activeCamera){var n=a._scene.activeCamera.position;a._scene.activeCamera.devicePosition&&(n=a._scene.activeCamera.devicePosition);var s=a._closestFace(n.subtract(i.position));a._scene.activeCamera.leftCamera?a._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(a._tmpMatrix):a._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(a._tmpMatrix),t.Vector3.TransformCoordinatesToRef(t.Vector3.Up(),a._tmpMatrix,a._tmpVector),a._faceVectors.forEach(function(l){s.direction.x&&l.direction.x&&(l.ignore=!0),s.direction.y&&l.direction.y&&(l.ignore=!0),s.direction.z&&l.direction.z&&(l.ignore=!0)});var o=a._closestFace(a._tmpVector);a._faceVectors.forEach(function(l){l.ignore=!1}),a.ui.position.copyFrom(i.position),s.direction.x&&(s.rotatedDirection.scaleToRef(i.scaling.x/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),s.direction.y&&(s.rotatedDirection.scaleToRef(i.scaling.y/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),s.direction.z&&(s.rotatedDirection.scaleToRef(i.scaling.z/2+a.distanceAwayFromFace,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)),a.ui.rotationQuaternion||(a.ui.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(a.ui.rotation.y,a.ui.rotation.x,a.ui.rotation.z)),s.rotatedDirection.scaleToRef(-1,a._tmpVector),a._lookAtToRef(a._tmpVector,o.rotatedDirection,a.ui.rotationQuaternion),o.direction.x&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-i.scaling.x/2,a._tmpVector),o.direction.y&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-i.scaling.y/2,a._tmpVector),o.direction.z&&a.ui.up.scaleToRef(a.distanceAwayFromBottomOfFace-i.scaling.z/2,a._tmpVector),a.ui.position.addInPlace(a._tmpVector)}})},r.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},r}();t.AttachToBoxBehavior=c})(T||(T={}));var T;(function(t){var f=function(){function c(){var r=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=16.666666666666668,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(r._ownerNode){if(r._hoverValue+=r._hovered?r._millisecondsPerFrame:-r._millisecondsPerFrame,r._setAllVisibility(r._ownerNode,(r._hoverValue-r.delay)/r.fadeInTime),r._ownerNode.visibility>1){r._setAllVisibility(r._ownerNode,1),r._hoverValue=r.fadeInTime+r.delay;return}else if(r._ownerNode.visibility<0&&(r._setAllVisibility(r._ownerNode,0),r._hoverValue<0)){r._hoverValue=0;return}setTimeout(r._update,r._millisecondsPerFrame)}}}return Object.defineProperty(c.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){this._ownerNode=r,this._setAllVisibility(this._ownerNode,0)},c.prototype.detach=function(){this._ownerNode=null},c.prototype.fadeIn=function(r){this._hovered=r,this._update()},c.prototype._setAllVisibility=function(r,i){var a=this;r.visibility=i,r.getChildMeshes().forEach(function(n){a._setAllVisibility(n,i)})},c}();t.FadeInOutBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){r===void 0&&(r=t.UtilityLayerRenderer.DefaultUtilityLayer);var i=this;this.gizmoLayer=r,this.scaleRatio=1,this._tmpMatrix=new t.Matrix,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new t.Vector3,this._rootMesh=new t.Mesh("gizmoRootNode",r.utilityLayerScene),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){i._update()}),this.attachedMesh=null}return Object.defineProperty(c.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(r){this._attachedMesh=r,this._rootMesh.setEnabled(!!r),this._attachedMeshChanged(r)},enumerable:!0,configurable:!0}),c.prototype.setCustomMesh=function(r){if(r.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(i){i.dispose()}),r.parent=this._rootMesh,this._customMeshSet=!0},c.prototype._attachedMeshChanged=function(r){},c.prototype._update=function(){if(this.attachedMesh&&(this.updateGizmoRotationToMatchAttachedMesh?(this._rootMesh.rotationQuaternion||(this._rootMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this._rootMesh.rotation.y,this._rootMesh.rotation.x,this._rootMesh.rotation.z)),this._tempVector.copyFrom(this.attachedMesh.scaling),this.attachedMesh.scaling.x<0&&(this.attachedMesh.scaling.x*=-1),this.attachedMesh.scaling.y<0&&(this.attachedMesh.scaling.y*=-1),this.attachedMesh.scaling.z<0&&(this.attachedMesh.scaling.z*=-1),this.attachedMesh.computeWorldMatrix().getRotationMatrixToRef(this._tmpMatrix),this.attachedMesh.scaling.copyFrom(this._tempVector),this.attachedMesh.computeWorldMatrix(),t.Quaternion.FromRotationMatrixToRef(this._tmpMatrix,this._rootMesh.rotationQuaternion)):this._rootMesh.rotationQuaternion&&this._rootMesh.rotationQuaternion.set(0,0,0,1),this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(this.attachedMesh.absolutePosition),this._updateScale&&this.gizmoLayer.utilityLayerScene.activeCamera&&this.attachedMesh)){var r=this.gizmoLayer.utilityLayerScene.activeCamera.position;this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition&&(r=this.gizmoLayer.utilityLayerScene.activeCamera.devicePosition),this._rootMesh.position.subtractToRef(r,this._tempVector);var i=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(i,i,i)}},c.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},c}();t.Gizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n){a===void 0&&(a=t.Color3.Gray()),n===void 0&&(n=t.UtilityLayerRenderer.DefaultUtilityLayer);var s=c.call(this,n)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new t.Observable;var o=new t.StandardMaterial("",n.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=a;var l=new t.StandardMaterial("",n.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=a.add(new t.Color3(.3,.3,.3));var u=new t.AbstractMesh("",n.utilityLayerScene),h=t.MeshBuilder.CreateCylinder("yPosMesh",{diameterTop:0,height:1.5,diameterBottom:.75,tessellation:96},n.utilityLayerScene),d=t.MeshBuilder.CreateLines("yPosMesh",{points:[new t.Vector3(0,0,0),new t.Vector3(0,1.1,0)]},n.utilityLayerScene);d.color=o.emissiveColor,u.addChild(h),u.addChild(d),h.scaling.scaleInPlace(.05),h.material=o,h.rotation.x=Math.PI/2,h.position.z+=.3,d.scaling.scaleInPlace(.26),d.rotation.x=Math.PI/2,d.material=o,u.lookAt(s._rootMesh.position.subtract(i)),u.scaling.scaleInPlace(.3333333333333333),s._rootMesh.addChild(u);var p=0,m=new t.Vector3,_={snapDistance:0};s.dragBehavior=new t.PointerDragBehavior({dragAxis:i}),s.dragBehavior.moveAttached=!1,s._rootMesh.addBehavior(s.dragBehavior);var v=new t.Vector3,S=new t.Matrix;return s.dragBehavior.onDragObservable.add(function(P){if(s.attachedMesh){if(s.attachedMesh.parent?(s.attachedMesh.parent.computeWorldMatrix().invertToRef(S),S.setTranslationFromFloats(0,0,0),t.Vector3.TransformCoordinatesToRef(P.delta,S,v)):v.copyFrom(P.delta),s.snapDistance==0)s.attachedMesh.position.addInPlace(v);else if(p+=P.dragDistance,Math.abs(p)>s.snapDistance){var x=Math.floor(Math.abs(p)/s.snapDistance);p=p%s.snapDistance,v.normalizeToRef(m),m.scaleInPlace(s.snapDistance*x),s.attachedMesh.position.addInPlace(m),_.snapDistance=s.snapDistance*x,s.onSnapObservable.notifyObservers(_)}}}),s._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(P,x){if(!s._customMeshSet){var R=P.pickInfo&&s._rootMesh.getChildMeshes().indexOf(P.pickInfo.pickedMesh)!=-1,w=R?l:o;s._rootMesh.getChildMeshes().forEach(function(I){I.material=w,I.color&&(I.color=w.emissiveColor)})}}),s}return r.prototype._attachedMeshChanged=function(i){this.dragBehavior&&(this.dragBehavior.enabled=!!i)},r.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),c.prototype.dispose.call(this)},r}(t.Gizmo);t.AxisDragGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n){a===void 0&&(a=t.Color3.Gray()),n===void 0&&(n=t.UtilityLayerRenderer.DefaultUtilityLayer);var s=c.call(this,n)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new t.Observable,s.uniformScaling=!1,s._coloredMaterial=new t.StandardMaterial("",n.utilityLayerScene),s._coloredMaterial.disableLighting=!0,s._coloredMaterial.emissiveColor=a;var o=new t.StandardMaterial("",n.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=a.add(new t.Color3(.3,.3,.3));var l=new t.AbstractMesh("",n.utilityLayerScene),u=t.MeshBuilder.CreateBox("yPosMesh",{size:.4},n.utilityLayerScene),h=t.MeshBuilder.CreateLines("yPosMesh",{points:[new t.Vector3(0,0,0),new t.Vector3(0,1.1,0)]},n.utilityLayerScene);h.color=s._coloredMaterial.emissiveColor,l.addChild(u),l.addChild(h),u.scaling.scaleInPlace(.1),u.material=s._coloredMaterial,u.rotation.x=Math.PI/2,u.position.z+=.3,h.scaling.scaleInPlace(.26),h.rotation.x=Math.PI/2,h.material=s._coloredMaterial,l.lookAt(s._rootMesh.position.subtract(i)),s._rootMesh.addChild(l),l.scaling.scaleInPlace(.3333333333333333),s.dragBehavior=new t.PointerDragBehavior({dragAxis:i}),s.dragBehavior.moveAttached=!1,s._rootMesh.addBehavior(s.dragBehavior);var d=0,p=new t.Vector3,m={snapDistance:0};return s.dragBehavior.onDragObservable.add(function(_){if(s.attachedMesh){var v=!1,S=0;s.uniformScaling?(s.attachedMesh.scaling.normalizeToRef(p),p.y<0&&p.scaleInPlace(-1)):p.copyFrom(i),s.snapDistance==0?p.scaleToRef(_.dragDistance,p):(d+=_.dragDistance,Math.abs(d)>s.snapDistance?(S=Math.floor(d/s.snapDistance),d=d%s.snapDistance,p.scaleToRef(s.snapDistance*S,p),v=!0):p.scaleInPlace(0)),s.attachedMesh.scaling.addInPlace(p),v&&(m.snapDistance=s.snapDistance*S,s.onSnapObservable.notifyObservers(m))}}),s._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(_,v){if(!s._customMeshSet){var S=_.pickInfo&&s._rootMesh.getChildMeshes().indexOf(_.pickInfo.pickedMesh)!=-1,P=S?o:s._coloredMaterial;s._rootMesh.getChildMeshes().forEach(function(x){x.material=P,x.color&&(x.color=P.emissiveColor)})}}),s}return r.prototype._attachedMeshChanged=function(i){this.dragBehavior&&(this.dragBehavior.enabled=!!i)},r.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),c.prototype.dispose.call(this)},r.prototype.setCustomMesh=function(i,a){var n=this;a===void 0&&(a=!1),c.prototype.setCustomMesh.call(this,i),a&&(this._rootMesh.getChildMeshes().forEach(function(s){s.material=n._coloredMaterial,s.color&&(s.color=n._coloredMaterial.emissiveColor)}),this._customMeshSet=!1)},r}(t.Gizmo);t.AxisScaleGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){a===void 0&&(a=t.Color3.Gray()),n===void 0&&(n=t.UtilityLayerRenderer.DefaultUtilityLayer),s===void 0&&(s=32);var o=c.call(this,n)||this;o._pointerObserver=null,o.snapDistance=0,o.onSnapObservable=new t.Observable;var l=new t.StandardMaterial("",n.utilityLayerScene);l.disableLighting=!0,l.emissiveColor=a;var u=new t.StandardMaterial("",n.utilityLayerScene);u.disableLighting=!0,u.emissiveColor=a.add(new t.Color3(.3,.3,.3));for(var h=new t.AbstractMesh("",n.utilityLayerScene),d=.8,p=new Array,m=0;m<s;m++){var _=2*Math.PI*(m/(s-1));p.push(new t.Vector3(d*Math.sin(_),0,d*Math.cos(_)))}var v=t.Mesh.CreateLines("",p,n.utilityLayerScene);v.color=l.emissiveColor,v.scaling.scaleInPlace(.26),v.material=l,v.rotation.x=Math.PI/2,h.addChild(v),h.lookAt(o._rootMesh.position.subtract(i)),o._rootMesh.addChild(h),h.scaling.scaleInPlace(.3333333333333333),o.dragBehavior=new t.PointerDragBehavior({dragPlaneNormal:i}),o.dragBehavior.moveAttached=!1,o.dragBehavior.maxDragAngle=Math.PI*9/20,o.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,o._rootMesh.addBehavior(o.dragBehavior);var S=new t.Vector3;o.dragBehavior.onDragStartObservable.add(function(g){o.attachedMesh&&S.copyFrom(g.dragPlanePoint)});var P=new t.Matrix,x=new t.Vector3,R=new t.Vector3,w={snapDistance:0},I=0,F=new t.Matrix,k=new t.Vector3,E=new t.Quaternion;return o.dragBehavior.onDragObservable.add(function(g){if(o.attachedMesh){o.attachedMesh.rotationQuaternion||(o.attachedMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(o.attachedMesh.rotation.y,o.attachedMesh.rotation.x,o.attachedMesh.rotation.z));var y=g.dragPlanePoint.subtract(o.attachedMesh.absolutePosition).normalize(),M=S.subtract(o.attachedMesh.absolutePosition).normalize(),C=t.Vector3.Cross(y,M),D=t.Vector3.Dot(y,M),V=Math.atan2(C.length(),D);if(x.copyFrom(i),R.copyFrom(i),o.updateGizmoRotationToMatchAttachedMesh&&(o.attachedMesh.rotationQuaternion.toRotationMatrix(P),R=t.Vector3.TransformCoordinates(x,P)),n.utilityLayerScene.activeCamera){var G=n.utilityLayerScene.activeCamera.position.subtract(o.attachedMesh.position);t.Vector3.Dot(G,R)>0&&(x.scaleInPlace(-1),R.scaleInPlace(-1))}var U=t.Vector3.Dot(R,C)>0;U&&(V=-V);var z=!1;if(o.snapDistance!=0)if(I+=V,Math.abs(I)>o.snapDistance){var H=Math.floor(I/o.snapDistance);I=I%o.snapDistance,V=o.snapDistance*H,z=!0}else V=0;F.reset(),o.attachedMesh.parent&&(o.attachedMesh.parent.computeWorldMatrix().invertToRef(F),F.getRotationMatrixToRef(F),t.Vector3.TransformCoordinatesToRef(x,F,x));var W=Math.sin(V/2);E.set(x.x*W,x.y*W,x.z*W,Math.cos(V/2)),F.determinant()>0&&(E.toEulerAnglesToRef(k),t.Quaternion.RotationYawPitchRollToRef(k.y,-k.x,-k.z,E)),o.updateGizmoRotationToMatchAttachedMesh?o.attachedMesh.rotationQuaternion.multiplyToRef(E,o.attachedMesh.rotationQuaternion):E.multiplyToRef(o.attachedMesh.rotationQuaternion,o.attachedMesh.rotationQuaternion),S.copyFrom(g.dragPlanePoint),z&&(w.snapDistance=V,o.onSnapObservable.notifyObservers(w))}}),o._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(g,y){if(!o._customMeshSet){var M=g.pickInfo&&o._rootMesh.getChildMeshes().indexOf(g.pickInfo.pickedMesh)!=-1,C=M?u:l;o._rootMesh.getChildMeshes().forEach(function(D){D.material=C,D.color&&(D.color=C.emissiveColor)})}}),o}return r.prototype._attachedMeshChanged=function(i){this.dragBehavior&&(this.dragBehavior.enabled=!!i)},r.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),c.prototype.dispose.call(this)},r}(t.Gizmo);t.PlaneRotationGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){i===void 0&&(i=t.UtilityLayerRenderer.DefaultUtilityLayer);var a=c.call(this,i)||this;return a.onDragStartObservable=new t.Observable,a.onDragEndObservable=new t.Observable,a.xGizmo=new t.AxisDragGizmo(new t.Vector3(1,0,0),t.Color3.Red().scale(.5),i),a.yGizmo=new t.AxisDragGizmo(new t.Vector3(0,1,0),t.Color3.Green().scale(.5),i),a.zGizmo=new t.AxisDragGizmo(new t.Vector3(0,0,1),t.Color3.Blue().scale(.5),i),[a.xGizmo,a.yGizmo,a.zGizmo].forEach(function(n){n.dragBehavior.onDragStartObservable.add(function(){a.onDragStartObservable.notifyObservers({})}),n.dragBehavior.onDragEndObservable.add(function(){a.onDragEndObservable.notifyObservers({})})}),a.attachedMesh=null,a}return Object.defineProperty(r.prototype,"attachedMesh",{set:function(i){this.xGizmo&&(this.xGizmo.attachedMesh=i,this.yGizmo.attachedMesh=i,this.zGizmo.attachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(i){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(i){this.xGizmo&&(this.xGizmo.snapDistance=i,this.yGizmo.snapDistance=i,this.zGizmo.snapDistance=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(i){this.xGizmo&&(this.xGizmo.scaleRatio=i,this.yGizmo.scaleRatio=i,this.zGizmo.scaleRatio=i)},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},r.prototype.setCustomMesh=function(i){t.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},r}(t.Gizmo);t.PositionGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){i===void 0&&(i=t.UtilityLayerRenderer.DefaultUtilityLayer),a===void 0&&(a=32);var n=c.call(this,i)||this;return n.onDragStartObservable=new t.Observable,n.onDragEndObservable=new t.Observable,n.xGizmo=new t.PlaneRotationGizmo(new t.Vector3(1,0,0),t.Color3.Red().scale(.5),i,a),n.yGizmo=new t.PlaneRotationGizmo(new t.Vector3(0,1,0),t.Color3.Green().scale(.5),i,a),n.zGizmo=new t.PlaneRotationGizmo(new t.Vector3(0,0,1),t.Color3.Blue().scale(.5),i,a),[n.xGizmo,n.yGizmo,n.zGizmo].forEach(function(s){s.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),s.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n}return Object.defineProperty(r.prototype,"attachedMesh",{set:function(i){this.xGizmo&&(this.xGizmo.attachedMesh=i,this.yGizmo.attachedMesh=i,this.zGizmo.attachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(i){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(i){this.xGizmo&&(this.xGizmo.snapDistance=i,this.yGizmo.snapDistance=i,this.zGizmo.snapDistance=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(i){this.xGizmo&&(this.xGizmo.scaleRatio=i,this.yGizmo.scaleRatio=i,this.zGizmo.scaleRatio=i)},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},r.prototype.setCustomMesh=function(i){t.Tools.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},r}(t.Gizmo);t.RotationGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i){i===void 0&&(i=t.UtilityLayerRenderer.DefaultUtilityLayer);var a=c.call(this,i)||this;a.onDragStartObservable=new t.Observable,a.onDragEndObservable=new t.Observable,a.xGizmo=new t.AxisScaleGizmo(new t.Vector3(1,0,0),t.Color3.Red().scale(.5),i),a.yGizmo=new t.AxisScaleGizmo(new t.Vector3(0,1,0),t.Color3.Green().scale(.5),i),a.zGizmo=new t.AxisScaleGizmo(new t.Vector3(0,0,1),t.Color3.Blue().scale(.5),i),a.uniformScaleGizmo=new t.AxisScaleGizmo(new t.Vector3(0,1,0),t.Color3.Yellow().scale(.5),i),a.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,a.uniformScaleGizmo.uniformScaling=!0;var n=t.Mesh.CreatePolyhedron("",{type:1},a.uniformScaleGizmo.gizmoLayer.utilityLayerScene);n.scaling.scaleInPlace(.02),n.visibility=0;var s=t.Mesh.CreatePolyhedron("",{type:1},a.uniformScaleGizmo.gizmoLayer.utilityLayerScene);return s.scaling.scaleInPlace(.007),n.addChild(s),a.uniformScaleGizmo.setCustomMesh(n,!0),[a.xGizmo,a.yGizmo,a.zGizmo,a.uniformScaleGizmo].forEach(function(o){o.dragBehavior.onDragStartObservable.add(function(){a.onDragStartObservable.notifyObservers({})}),o.dragBehavior.onDragEndObservable.add(function(){a.onDragEndObservable.notifyObservers({})})}),a.attachedMesh=null,a}return Object.defineProperty(r.prototype,"attachedMesh",{set:function(i){this.xGizmo&&(this.xGizmo.attachedMesh=i,this.yGizmo.attachedMesh=i,this.zGizmo.attachedMesh=i,this.uniformScaleGizmo.attachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(i){i||t.Tools.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=i,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(i){this.xGizmo&&(this.xGizmo.snapDistance=i,this.yGizmo.snapDistance=i,this.zGizmo.snapDistance=i,this.uniformScaleGizmo.snapDistance=i)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(i){this.xGizmo&&(this.xGizmo.scaleRatio=i,this.yGizmo.scaleRatio=i,this.zGizmo.scaleRatio=i,this.uniformScaleGizmo.scaleRatio=i)},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},r}(t.Gizmo);t.ScaleGizmo=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a){i===void 0&&(i=t.Color3.Gray()),a===void 0&&(a=t.UtilityLayerRenderer.DefaultKeepDepthUtilityLayer);var n=c.call(this,a)||this;n._boundingDimensions=new t.Vector3(1,1,1),n._renderObserver=null,n._pointerObserver=null,n._scaleDragSpeed=.2,n._tmpQuaternion=new t.Quaternion,n._tmpVector=new t.Vector3(0,0,0),n._tmpRotationMatrix=new t.Matrix,n.ignoreChildren=!1,n.includeChildPredicate=null,n.rotationSphereSize=.1,n.scaleBoxSize=.1,n.fixedDragMeshScreenSize=!1,n.fixedDragMeshScreenSizeDistanceFactor=10,n.onDragStartObservable=new t.Observable,n.onScaleBoxDragObservable=new t.Observable,n.onScaleBoxDragEndObservable=new t.Observable,n.onRotationSphereDragObservable=new t.Observable,n.onRotationSphereDragEndObservable=new t.Observable,n.scalePivot=null,n._existingMeshScale=new t.Vector3,n._updateScale=!1,n._anchorMesh=new t.AbstractMesh("anchor",a.utilityLayerScene);var s=new t.StandardMaterial("",a.utilityLayerScene);s.disableLighting=!0,s.emissiveColor=i;var o=new t.StandardMaterial("",a.utilityLayerScene);o.disableLighting=!0,o.emissiveColor=i.clone().add(new t.Color3(.3,.3,.3)),n._lineBoundingBox=new t.AbstractMesh("",a.utilityLayerScene),n._lineBoundingBox.rotationQuaternion=new t.Quaternion;var l=[];l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,0,0),new t.Vector3(n._boundingDimensions.x,0,0)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,0,0),new t.Vector3(0,n._boundingDimensions.y,0)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,0,0),new t.Vector3(0,0,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(n._boundingDimensions.x,0,0),new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,0)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(n._boundingDimensions.x,0,0),new t.Vector3(n._boundingDimensions.x,0,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,n._boundingDimensions.y,0),new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,0)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,n._boundingDimensions.y,0),new t.Vector3(0,n._boundingDimensions.y,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,0,n._boundingDimensions.z),new t.Vector3(n._boundingDimensions.x,0,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(0,0,n._boundingDimensions.z),new t.Vector3(0,n._boundingDimensions.y,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,n._boundingDimensions.z),new t.Vector3(0,n._boundingDimensions.y,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,n._boundingDimensions.z),new t.Vector3(n._boundingDimensions.x,0,n._boundingDimensions.z)]},a.utilityLayerScene)),l.push(t.MeshBuilder.CreateLines("lines",{points:[new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,n._boundingDimensions.z),new t.Vector3(n._boundingDimensions.x,n._boundingDimensions.y,0)]},a.utilityLayerScene)),l.forEach(function(R){R.color=i,R.position.addInPlace(new t.Vector3(-n._boundingDimensions.x/2,-n._boundingDimensions.y/2,-n._boundingDimensions.z/2)),R.isPickable=!1,n._lineBoundingBox.addChild(R)}),n._rootMesh.addChild(n._lineBoundingBox),n._rotateSpheresParent=new t.AbstractMesh("",a.utilityLayerScene),n._rotateSpheresParent.rotationQuaternion=new t.Quaternion;for(var u=function(R){var w=t.MeshBuilder.CreateSphere("",{diameter:1},a.utilityLayerScene);w.rotationQuaternion=new t.Quaternion,w.material=s,d=new t.PointerDragBehavior({}),d.moveAttached=!1,d.updateDragPlane=!1,w.addBehavior(d);var I=new t.Vector3(1,0,0),F=0;d.onDragStartObservable.add(function(k){I.copyFrom(w.forward),F=0}),d.onDragObservable.add(function(k){if(n.onRotationSphereDragObservable.notifyObservers({}),n.attachedMesh){r._RemoveAndStorePivotPoint(n.attachedMesh);var E=I,g=k.dragPlaneNormal.scale(t.Vector3.Dot(k.dragPlaneNormal,E)),y=E.subtract(g).normalizeToNew(),M=-t.Vector3.Dot(y,k.delta);M=M/n._boundingDimensions.length()*n._anchorMesh.scaling.length(),n.attachedMesh.rotationQuaternion||(n.attachedMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(n.attachedMesh.rotation.y,n.attachedMesh.rotation.x,n.attachedMesh.rotation.z)),n._anchorMesh.rotationQuaternion||(n._anchorMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(n._anchorMesh.rotation.y,n._anchorMesh.rotation.x,n._anchorMesh.rotation.z)),F+=M,Math.abs(F)<=2*Math.PI&&(R>=8?t.Quaternion.RotationYawPitchRollToRef(0,0,M,n._tmpQuaternion):R>=4?t.Quaternion.RotationYawPitchRollToRef(M,0,0,n._tmpQuaternion):t.Quaternion.RotationYawPitchRollToRef(0,M,0,n._tmpQuaternion),n._anchorMesh.addChild(n.attachedMesh),n._anchorMesh.rotationQuaternion.multiplyToRef(n._tmpQuaternion,n._anchorMesh.rotationQuaternion),n._anchorMesh.removeChild(n.attachedMesh)),n.updateBoundingBox(),r._RestorePivotPoint(n.attachedMesh)}}),d.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({}),n._selectNode(w)}),d.onDragEndObservable.add(function(){n.onRotationSphereDragEndObservable.notifyObservers({}),n._selectNode(null)}),h._rotateSpheresParent.addChild(w)},h=this,d,p=0;p<12;p++)u(p);n._rootMesh.addChild(n._rotateSpheresParent),n._scaleBoxesParent=new t.AbstractMesh("",a.utilityLayerScene),n._scaleBoxesParent.rotationQuaternion=new t.Quaternion;for(var m=0;m<2;m++)for(var _=0;_<2;_++)for(var v=function(){var w=t.MeshBuilder.CreateBox("",{size:1},a.utilityLayerScene);w.material=s;var I=new t.Vector3(m==0?-1:1,_==0?-1:1,P==0?-1:1);d=new t.PointerDragBehavior({dragAxis:I}),d.moveAttached=!1,w.addBehavior(d),d.onDragObservable.add(function(F){if(n.onScaleBoxDragObservable.notifyObservers({}),n.attachedMesh){r._RemoveAndStorePivotPoint(n.attachedMesh);var k=F.dragDistance/n._boundingDimensions.length()*n._anchorMesh.scaling.length(),E=new t.Vector3(k,k,k);E.scaleInPlace(n._scaleDragSpeed),n.updateBoundingBox(),n.scalePivot?(n.attachedMesh.getWorldMatrix().getRotationMatrixToRef(n._tmpRotationMatrix),n._boundingDimensions.scaleToRef(.5,n._tmpVector),t.Vector3.TransformCoordinatesToRef(n._tmpVector,n._tmpRotationMatrix,n._tmpVector),n._anchorMesh.position.subtractInPlace(n._tmpVector),n._boundingDimensions.multiplyToRef(n.scalePivot,n._tmpVector),t.Vector3.TransformCoordinatesToRef(n._tmpVector,n._tmpRotationMatrix,n._tmpVector),n._anchorMesh.position.addInPlace(n._tmpVector)):(w.absolutePosition.subtractToRef(n._anchorMesh.position,n._tmpVector),n._anchorMesh.position.subtractInPlace(n._tmpVector)),n._anchorMesh.addChild(n.attachedMesh),n._anchorMesh.scaling.addInPlace(E),(n._anchorMesh.scaling.x<0||n._anchorMesh.scaling.y<0||n._anchorMesh.scaling.z<0)&&n._anchorMesh.scaling.subtractInPlace(E),n._anchorMesh.removeChild(n.attachedMesh),r._RestorePivotPoint(n.attachedMesh)}}),d.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({}),n._selectNode(w)}),d.onDragEndObservable.add(function(){n.onScaleBoxDragEndObservable.notifyObservers({}),n._selectNode(null)}),S._scaleBoxesParent.addChild(w)},S=this,d,P=0;P<2;P++)v();n._rootMesh.addChild(n._scaleBoxesParent);var x=new Array;return n._pointerObserver=a.utilityLayerScene.onPointerObservable.add(function(R,w){x[R.event.pointerId]?R.pickInfo&&R.pickInfo.pickedMesh!=x[R.event.pointerId]&&(x[R.event.pointerId].material=s,delete x[R.event.pointerId]):n._rotateSpheresParent.getChildMeshes().concat(n._scaleBoxesParent.getChildMeshes()).forEach(function(I){R.pickInfo&&R.pickInfo.pickedMesh==I&&(x[R.event.pointerId]=I,I.material=o)})}),n._renderObserver=n.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){n.attachedMesh&&!n._existingMeshScale.equals(n.attachedMesh.scaling)&&n.updateBoundingBox()}),n.updateBoundingBox(),n}return r._RemoveAndStorePivotPoint=function(i){i&&r._PivotCached===0&&(i.getPivotPointToRef(r._OldPivotPoint),r._OldPivotPoint.equalsToFloats(0,0,0)||(i.setPivotMatrix(t.Matrix.IdentityReadOnly),r._OldPivotPoint.subtractToRef(i.getPivotPoint(),r._PivotTranslation),r._PivotTmpVector.copyFromFloats(1,1,1),r._PivotTmpVector.subtractInPlace(i.scaling),r._PivotTmpVector.multiplyInPlace(r._PivotTranslation),i.position.addInPlace(r._PivotTmpVector))),r._PivotCached++},r._RestorePivotPoint=function(i){i&&!r._OldPivotPoint.equalsToFloats(0,0,0)&&r._PivotCached===1&&(i.setPivotPoint(r._OldPivotPoint),r._PivotTmpVector.copyFromFloats(1,1,1),r._PivotTmpVector.subtractInPlace(i.scaling),r._PivotTmpVector.multiplyInPlace(r._PivotTranslation),i.position.subtractInPlace(r._PivotTmpVector)),this._PivotCached--},r.prototype._attachedMeshChanged=function(i){i&&(r._RemoveAndStorePivotPoint(i),this._anchorMesh.addChild(i),this._anchorMesh.removeChild(i),r._RestorePivotPoint(i),this.updateBoundingBox())},r.prototype._selectNode=function(i){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(a,n){a.isVisible=!i||a==i})},r.prototype.updateBoundingBox=function(){if(this.attachedMesh){r._RemoveAndStorePivotPoint(this.attachedMesh),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var i=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);i.max.subtractToRef(i.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((i.max.x+i.min.x)/2,(i.max.y+i.min.y)/2,(i.max.z+i.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector)}for(var a=this._rotateSpheresParent.getChildMeshes(),n=0;n<3;n++)for(var s=0;s<2;s++)for(var o=0;o<2;o++){var l=n*4+s*2+o;if(n==0&&(a[l].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*s,this._boundingDimensions.z*o),a[l].position.addInPlace(new t.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[l].lookAt(t.Vector3.Cross(t.Vector3.Right(),a[l].position.normalizeToNew()).normalizeToNew().add(a[l].position))),n==1&&(a[l].position.set(this._boundingDimensions.x*s,this._boundingDimensions.y/2,this._boundingDimensions.z*o),a[l].position.addInPlace(new t.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[l].lookAt(t.Vector3.Cross(t.Vector3.Up(),a[l].position.normalizeToNew()).normalizeToNew().add(a[l].position))),n==2&&(a[l].position.set(this._boundingDimensions.x*s,this._boundingDimensions.y*o,this._boundingDimensions.z/2),a[l].position.addInPlace(new t.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),a[l].lookAt(t.Vector3.Cross(t.Vector3.Forward(),a[l].position.normalizeToNew()).normalizeToNew().add(a[l].position))),this.fixedDragMeshScreenSize){this._rootMesh.computeWorldMatrix(),this._rotateSpheresParent.computeWorldMatrix(),a[l].computeWorldMatrix(),a[l].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var u=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;a[l].scaling.set(u,u,u)}else a[l].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}for(var h=this._scaleBoxesParent.getChildMeshes(),n=0;n<2;n++)for(var s=0;s<2;s++)for(var o=0;o<2;o++){var l=n*4+s*2+o;if(h[l])if(h[l].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y*s,this._boundingDimensions.z*o),h[l].position.addInPlace(new t.Vector3(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize){this._rootMesh.computeWorldMatrix(),this._scaleBoxesParent.computeWorldMatrix(),h[l].computeWorldMatrix(),h[l].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var u=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;h[l].scaling.set(u,u,u)}else h[l].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),r._RestorePivotPoint(this.attachedMesh))},r.prototype.setEnabledRotationAxis=function(i){this._rotateSpheresParent.getChildMeshes().forEach(function(a,n){n<4?a.setEnabled(i.indexOf("x")!=-1):n<8?a.setEnabled(i.indexOf("y")!=-1):a.setEnabled(i.indexOf("z")!=-1)})},r.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),c.prototype.dispose.call(this)},r.MakeNotPickableAndWrapInBoundingBox=function(i){var a=function(u){u.isPickable=!1,u.getChildMeshes().forEach(function(h){a(h)})};a(i),i.rotationQuaternion||(i.rotationQuaternion=t.Quaternion.RotationYawPitchRoll(i.rotation.y,i.rotation.x,i.rotation.z));var n=i.position.clone(),s=i.rotationQuaternion.clone();i.rotationQuaternion.set(0,0,0,1),i.position.set(0,0,0);var o=t.MeshBuilder.CreateBox("box",{size:1},i.getScene()),l=i.getHierarchyBoundingVectors();return l.max.subtractToRef(l.min,o.scaling),o.position.set((l.max.x+l.min.x)/2,(l.max.y+l.min.y)/2,(l.max.z+l.min.z)/2),i.addChild(o),i.rotationQuaternion.copyFrom(s),i.position.copyFrom(n),i.removeChild(o),o.addChild(i),o.visibility=0,o},r.prototype.setCustomMesh=function(i){t.Tools.Error("Custom meshes are not supported on this gizmo")},r._PivotCached=0,r._OldPivotPoint=new t.Vector3,r._PivotTranslation=new t.Vector3,r._PivotTmpVector=new t.Vector3,r}(t.Gizmo);t.BoundingBoxGizmo=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){var i=this;this.scene=r,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=t.Color3.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new t.SixDofDragBehavior,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new t.UtilityLayerRenderer(r),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=new t.UtilityLayerRenderer(r),this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=r.onPointerObservable.add(function(a,n){if(i.usePointerToAttachGizmos&&a.type==t.PointerEventTypes.POINTERDOWN)if(a.pickInfo&&a.pickInfo.pickedMesh){var s=a.pickInfo.pickedMesh;if(i.attachableMeshes==null)for(;s&&s.parent!=null;)s=s.parent;else{var o=!1;i.attachableMeshes.forEach(function(l){s&&(s==l||s.isDescendantOf(l))&&(s=l,o=!0)}),o||(s=null)}s instanceof t.AbstractMesh?i._attachedMesh!=s&&i.attachToMesh(s):i.attachToMesh(null)}else i.attachToMesh(null)})}return c.prototype.attachToMesh=function(r){this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=r;for(var i in this.gizmos){var a=this.gizmos[i];a&&this._gizmosEnabled[i]&&(a.attachedMesh=r)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior)},Object.defineProperty(c.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(r){r?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new t.PositionGizmo(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(r){r?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new t.RotationGizmo(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(r){r?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new t.ScaleGizmo(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(r){r?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new t.BoundingBoxGizmo(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=r},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){this.scene.onPointerObservable.remove(this._pointerObserver);for(var r in this.gizmos){var i=this.gizmos[r];i&&i.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this._defaultUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach()},c}();t.GizmoManager=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){i===void 0&&(i=0),a===void 0&&(a=null),this.name=r,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new t.Observable,this._onDataLayoutChanged=new t.Observable,this._animationPropertiesOverride=null,this._scene=a||t.Engine.LastCreatedScene,this.influence=i}return Object.defineProperty(c.prototype,"influence",{get:function(){return this._influence},set:function(r){if(this._influence!==r){var i=this._influence;this._influence=r,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(i===0||r===0)}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(r){this._animationPropertiesOverride=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),c.prototype.setPositions=function(r){var i=this.hasPositions;this._positions=r,i!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},c.prototype.getPositions=function(){return this._positions},c.prototype.setNormals=function(r){var i=this.hasNormals;this._normals=r,i!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},c.prototype.getNormals=function(){return this._normals},c.prototype.setTangents=function(r){var i=this.hasTangents;this._tangents=r,i!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},c.prototype.getTangents=function(){return this._tangents},c.prototype.serialize=function(){var r={};return r.name=this.name,r.influence=this.influence,r.positions=Array.prototype.slice.call(this.getPositions()),this.hasNormals&&(r.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(r.tangents=Array.prototype.slice.call(this.getTangents())),t.Animation.AppendSerializedAnimations(this,r),r},c.Parse=function(r){var i=new c(r.name,r.influence);if(i.setPositions(r.positions),r.normals&&i.setNormals(r.normals),r.tangents&&i.setTangents(r.tangents),r.animations)for(var a=0;a<r.animations.length;a++){var n=r.animations[a];i.animations.push(t.Animation.Parse(n))}return i},c.FromMesh=function(r,i,a){i||(i=r.name);var n=new c(i,a,r.getScene());return n.setPositions(r.getVerticesData(t.VertexBuffer.PositionKind)),r.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&n.setNormals(r.getVerticesData(t.VertexBuffer.NormalKind)),r.isVerticesDataPresent(t.VertexBuffer.TangentKind)&&n.setTangents(r.getVerticesData(t.VertexBuffer.TangentKind)),n},c}();t.MorphTarget=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){r===void 0&&(r=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new t.SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,r||(r=t.Engine.LastCreatedScene),this._scene=r,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(c.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),c.prototype.getActiveTarget=function(r){return this._activeTargets.data[r]},c.prototype.getTarget=function(r){return this._targets[r]},c.prototype.addTarget=function(r){var i=this;this._targets.push(r),this._targetInfluenceChangedObservers.push(r.onInfluenceChanged.add(function(a){i._syncActiveTargets(a)})),this._targetDataLayoutChangedObservers.push(r._onDataLayoutChanged.add(function(){i._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},c.prototype.removeTarget=function(r){var i=this._targets.indexOf(r);i>=0&&(this._targets.splice(i,1),r.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(i,1)[0]),r._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(i,1)[0]),this._syncActiveTargets(!0))},c.prototype.serialize=function(){var r={};r.id=this.uniqueId,r.targets=[];for(var i=0,a=this._targets;i<a.length;i++){var n=a[i];r.targets.push(n.serialize())}return r},c.prototype._syncActiveTargets=function(r){var i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var a=0,n=this._targets;a<n.length;a++){var s=n[a];if(s.influence!==0){this._activeTargets.push(s),this._tempInfluences[i++]=s.influence,this._supportsNormals=this._supportsNormals&&s.hasNormals,this._supportsTangents=this._supportsTangents&&s.hasTangents;var o=s.getPositions();if(o){var l=o.length/3;if(this._vertexCount===0)this._vertexCount=l;else if(this._vertexCount!==l){t.Tools.Error("Incompatible target. Targets must all have the same vertices count.");return}}}}(!this._influences||this._influences.length!==i)&&(this._influences=new Float32Array(i));for(var u=0;u<i;u++)this._influences[u]=this._tempInfluences[u];r&&this.synchronize()},c.prototype.synchronize=function(){if(this._scene)for(var r=0,i=this._scene.meshes;r<i.length;r++){var a=i[r];a.morphTargetManager===this&&a._syncGeometryWithMorphTargetManager()}},c.Parse=function(r,i){var a=new c(i);a._uniqueId=r.id;for(var n=0,s=r.targets;n<s.length;n++){var o=s[n];a.addTarget(t.MorphTarget.Parse(o))}return a},c}();t.MorphTargetManager=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a){a===void 0&&(a=2),this.maxDepth=a,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new t.SmartArrayNoDuplicate(1024),this._creationFunc=r}return c.prototype.update=function(r,i,a){c._CreateBlocks(r,i,a,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},c.prototype.addMesh=function(r){for(var i=0;i<this.blocks.length;i++){var a=this.blocks[i];a.addEntry(r)}},c.prototype.select=function(r,i){this._selectionContent.reset();for(var a=0;a<this.blocks.length;a++){var n=this.blocks[a];n.select(r,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},c.prototype.intersects=function(r,i,a){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++){var s=this.blocks[n];s.intersects(r,i,this._selectionContent,a)}return a?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},c.prototype.intersectsRay=function(r){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){var a=this.blocks[i];a.intersectsRay(r,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},c._CreateBlocks=function(r,i,a,n,s,o,l,u){l.blocks=new Array;for(var h=new t.Vector3((i.x-r.x)/2,(i.y-r.y)/2,(i.z-r.z)/2),d=0;d<2;d++)for(var p=0;p<2;p++)for(var m=0;m<2;m++){var _=r.add(h.multiplyByFloats(d,p,m)),v=r.add(h.multiplyByFloats(d+1,p+1,m+1)),S=new t.OctreeBlock(_,v,n,s+1,o,u);S.addEntries(a),l.blocks.push(S)}},c.CreationFuncForMeshes=function(r,i){var a=r.getBoundingInfo();!r.isBlocked&&a.boundingBox.intersectsMinMax(i.minPoint,i.maxPoint)&&i.entries.push(r)},c.CreationFuncForSubMeshes=function(r,i){var a=r.getBoundingInfo();a.boundingBox.intersectsMinMax(i.minPoint,i.maxPoint)&&i.entries.push(r)},c}();t.Octree=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=a,this._depth=n,this._maxDepth=s,this._creationFunc=o,this._minPoint=r,this._maxPoint=i,this._boundingVectors.push(r.clone()),this._boundingVectors.push(i.clone()),this._boundingVectors.push(r.clone()),this._boundingVectors[2].x=i.x,this._boundingVectors.push(r.clone()),this._boundingVectors[3].y=i.y,this._boundingVectors.push(r.clone()),this._boundingVectors[4].z=i.z,this._boundingVectors.push(i.clone()),this._boundingVectors[5].z=r.z,this._boundingVectors.push(i.clone()),this._boundingVectors[6].x=r.x,this._boundingVectors.push(i.clone()),this._boundingVectors[7].y=r.y}return Object.defineProperty(c.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),c.prototype.addEntry=function(r){if(this.blocks){for(var i=0;i<this.blocks.length;i++){var a=this.blocks[i];a.addEntry(r)}return}this._creationFunc(r,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},c.prototype.addEntries=function(r){for(var i=0;i<r.length;i++){var a=r[i];this.addEntry(a)}},c.prototype.select=function(r,i,a){if(t.BoundingBox.IsInFrustum(this._boundingVectors,r)){if(this.blocks){for(var n=0;n<this.blocks.length;n++){var s=this.blocks[n];s.select(r,i,a)}return}a?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},c.prototype.intersects=function(r,i,a,n){if(t.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,r,i)){if(this.blocks){for(var s=0;s<this.blocks.length;s++){var o=this.blocks[s];o.intersects(r,i,a,n)}return}n?a.concat(this.entries):a.concatWithNoDuplicate(this.entries)}},c.prototype.intersectsRay=function(r,i){if(r.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var a=0;a<this.blocks.length;a++){var n=this.blocks[a];n.intersectsRay(r,i)}return}i.concatWithNoDuplicate(this.entries)}},c.prototype.createInnerBlocks=function(){t.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},c}();t.OctreeBlock=f})(T||(T={}));var T;(function(t){t.Scene.prototype.createOrUpdateSelectionOctree=function(c,r){c===void 0&&(c=64),r===void 0&&(r=2);var i=this._getComponent(t.SceneComponentConstants.NAME_OCTREE);i||(i=new f(this),this._addComponent(i)),this._selectionOctree||(this._selectionOctree=new t.Octree(t.Octree.CreationFuncForMeshes,c,r));var a=this.getWorldExtends();return this._selectionOctree.update(a.min,a.max,this.meshes),this._selectionOctree},Object.defineProperty(t.Scene.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),t.AbstractMesh.prototype.createOrUpdateSubmeshesOctree=function(c,r){c===void 0&&(c=64),r===void 0&&(r=2);var i=this.getScene(),a=i._getComponent(t.SceneComponentConstants.NAME_OCTREE);a||(a=new f(i),i._addComponent(a)),this._submeshesOctree||(this._submeshesOctree=new t.Octree(t.Octree.CreationFuncForSubMeshes,c,r)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo(),s=n.boundingBox;return this._submeshesOctree.update(s.minimumWorld,s.maximumWorld,this.subMeshes),this._submeshesOctree};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new t.Ray(t.Vector3.Zero(),new t.Vector3(1,1,1)),this.scene=r,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return c.prototype.register=function(){var r=this;this.scene.onMeshRemovedObservable.add(function(i){var a=r.scene.selectionOctree;if(a!=null){var n=a.dynamicContent.indexOf(i);n!==-1&&a.dynamicContent.splice(n,1)}}),this.scene.onMeshImportedObservable.add(function(i){var a=r.scene.selectionOctree;a?.addMesh(i)})},c.prototype.getActiveMeshCandidates=function(){if(this.scene._selectionOctree){var r=this.scene._selectionOctree.select(this.scene.frustumPlanes);return r}return this.scene._getDefaultMeshCandidates()},c.prototype.getActiveSubMeshCandidates=function(r){if(r._submeshesOctree&&r.useOctreeForRenderingSelection){var i=r._submeshesOctree.select(this.scene.frustumPlanes);return i}return this.scene._getDefaultSubMeshCandidates(r)},c.prototype.getIntersectingSubMeshCandidates=function(r,i){if(r._submeshesOctree&&r.useOctreeForPicking){t.Ray.TransformToRef(i,r.getWorldMatrix(),this._tempRay);var a=r._submeshesOctree.intersectsRay(this._tempRay);return a}return this.scene._getDefaultSubMeshCandidates(r)},c.prototype.getCollidingSubMeshCandidates=function(r,i){if(r._submeshesOctree&&r.useOctreeForCollisions){var a=i._velocityWorldLength+Math.max(i._radius.x,i._radius.y,i._radius.z),n=r._submeshesOctree.intersects(i._basePointWorld,a);return n}return this.scene._getDefaultSubMeshCandidates(r)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){},c}();t.OctreeSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){var u=c.call(this,i,"anaglyph",null,["leftSampler"],a,n[1],s,o,l)||this;return u._passedProcess=n[0]._rigPostProcess,u.onApplyObservable.add(function(h){h.setTextureFromPostProcess("leftSampler",u._passedProcess)}),u}return r}(t.PostProcess);t.AnaglyphPostProcess=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("AnaglyphArcRotateCamera",function(c,r,i){return function(){return new f(c,0,0,1,t.Vector3.Zero(),i.interaxial_distance,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o,l,u){var h=c.call(this,i,a,n,s,o,u)||this;return h.interaxialDistance=l,h.setCameraRigMode(t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:l}),h}return r.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},r}(t.ArcRotateCamera);t.AnaglyphArcRotateCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("AnaglyphFreeCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,r)}});var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,a,s)||this;return o.interaxialDistance=n,o.setCameraRigMode(t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return r.prototype.getClassName=function(){return"AnaglyphFreeCamera"},r}(t.FreeCamera);t.AnaglyphFreeCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("AnaglyphGamepadCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,r)}});var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,a,s)||this;return o.interaxialDistance=n,o.setCameraRigMode(t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return r.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},r}(t.GamepadCamera);t.AnaglyphGamepadCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("AnaglyphUniversalCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,r)}});var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,a,s)||this;return o.interaxialDistance=n,o.setCameraRigMode(t.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),o}return r.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},r}(t.UniversalCamera);t.AnaglyphUniversalCamera=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o,l){var u=c.call(this,i,"stereoscopicInterlace",["stepSize"],["camASampler"],1,a[1],s,o,l,n?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return u._passedProcess=a[0]._rigPostProcess,u._stepSize=new t.Vector2(1/u.width,1/u.height),u.onSizeChangedObservable.add(function(){u._stepSize=new t.Vector2(1/u.width,1/u.height)}),u.onApplyObservable.add(function(h){h.setTextureFromPostProcess("camASampler",u._passedProcess),h.setFloat2("stepSize",u._stepSize.x,u._stepSize.y)}),u}return r}(t.PostProcess);t.StereoscopicInterlacePostProcess=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("StereoscopicArcRotateCamera",function(c,r,i){return function(){return new f(c,0,0,1,t.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){var d=c.call(this,i,a,n,s,o,h)||this;return d.interaxialDistance=l,d.isStereoscopicSideBySide=u,d.setCameraRigMode(u?t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:l}),d}return r.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},r}(t.ArcRotateCamera);t.StereoscopicArcRotateCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("StereoscopicFreeCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o){var l=c.call(this,i,a,o)||this;return l.interaxialDistance=n,l.isStereoscopicSideBySide=s,l.setCameraRigMode(s?t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),l}return r.prototype.getClassName=function(){return"StereoscopicFreeCamera"},r}(t.FreeCamera);t.StereoscopicFreeCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("StereoscopicGamepadCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o){var l=c.call(this,i,a,o)||this;return l.interaxialDistance=n,l.isStereoscopicSideBySide=s,l.setCameraRigMode(s?t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),l}return r.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},r}(t.GamepadCamera);t.StereoscopicGamepadCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("StereoscopicFreeCamera",function(c,r,i){return function(){return new f(c,t.Vector3.Zero(),i.interaxial_distance,i.isStereoscopicSideBySide,r)}});var f=function(c){N(r,c);function r(i,a,n,s,o){var l=c.call(this,i,a,o)||this;return l.interaxialDistance=n,l.isStereoscopicSideBySide=s,l.setCameraRigMode(s?t.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:t.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),l}return r.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},r}(t.UniversalCamera);t.StereoscopicUniversalCamera=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,s.postProcessScaleFactor,a,t.Texture.BILINEAR_SAMPLINGMODE)||this;return o._isRightEye=n,o._distortionFactors=s.distortionK,o._postProcessScaleFactor=s.postProcessScaleFactor,o._lensCenterOffset=s.lensCenterOffset,o.adaptScaleToCurrentViewport=!0,o.onSizeChangedObservable.add(function(){o._scaleIn=new t.Vector2(2,2/o.aspectRatio),o._scaleFactor=new t.Vector2(.5*(1/o._postProcessScaleFactor),.5*(1/o._postProcessScaleFactor)*o.aspectRatio),o._lensCenter=new t.Vector2(o._isRightEye?.5-o._lensCenterOffset*.5:.5+o._lensCenterOffset*.5,.5)}),o.onApplyObservable.add(function(l){l.setFloat2("LensCenter",o._lensCenter.x,o._lensCenter.y),l.setFloat2("Scale",o._scaleFactor.x,o._scaleFactor.y),l.setFloat2("ScaleIn",o._scaleIn.x,o._scaleIn.y),l.setFloat4("HmdWarpParam",o._distortionFactors[0],o._distortionFactors[1],o._distortionFactors[2],o._distortionFactors[3])}),o}return r}(t.PostProcess);t.VRDistortionCorrectionPostProcess=f})(T||(T={}));var T;(function(t){var f=function(){function c(){var r=this;this._screenOrientationAngle=0,this._screenQuaternion=new t.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){r._screenOrientationAngle=window.orientation!==void 0?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,r._screenOrientationAngle=-t.Tools.ToRadians(r._screenOrientationAngle/2),r._screenQuaternion.copyFromFloats(0,Math.sin(r._screenOrientationAngle),0,Math.cos(r._screenOrientationAngle))},this._deviceOrientation=function(i){r._alpha=i.alpha!==null?i.alpha:0,r._beta=i.beta!==null?i.beta:0,r._gamma=i.gamma!==null?i.gamma:0},this._constantTranform=new t.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(c.prototype,"camera",{get:function(){return this._camera},set:function(r){this._camera=r,this._camera!=null&&!this._camera.rotationQuaternion&&(this._camera.rotationQuaternion=new t.Quaternion)},enumerable:!0,configurable:!0}),c.prototype.attachControl=function(r,i){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},c.prototype.detachControl=function(r){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},c.prototype.checkInputs=function(){this._alpha&&(t.Quaternion.RotationYawPitchRollToRef(t.Tools.ToRadians(this._alpha),t.Tools.ToRadians(this._beta),-t.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},c.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},c.prototype.getSimpleName=function(){return"deviceOrientation"},c}();t.FreeCameraDeviceOrientationInput=f,t.CameraInputTypes.FreeCameraDeviceOrientationInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return c.prototype.attachControl=function(r,i){this.camera.attachControl(r,i),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},c.prototype._onOrientationEvent=function(r){r.alpha!==null&&(this._alpha=+r.alpha|0),r.gamma!==null&&(this._gamma=+r.gamma|0),this._dirty=!0},c.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},c.prototype.detachControl=function(r){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},c.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},c.prototype.getSimpleName=function(){return"VRDeviceOrientation"},c}();t.ArcRotateCameraVRDeviceOrientationInput=f,t.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.compensateDistortion=!0}return Object.defineProperty(c.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"leftHMatrix",{get:function(){var r=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*r/this.hScreenSize;return t.Matrix.Translation(i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rightHMatrix",{get:function(){var r=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*r/this.hScreenSize;return t.Matrix.Translation(-i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"leftPreViewMatrix",{get:function(){return t.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rightPreViewMatrix",{get:function(){return t.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),c.GetDefault=function(){var r=new c;return r.hResolution=1280,r.vResolution=800,r.hScreenSize=.149759993,r.vScreenSize=.0935999975,r.vScreenCenter=.0467999987,r.eyeToScreenDistance=.0410000011,r.lensSeparationDistance=.063500002,r.interpupillaryDistance=.064000003,r.distortionK=[1,.219999999,.239999995,0],r.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],r.postProcessScaleFactor=1.714605507808412,r.lensCenterOffset=.151976421,r},c}();t.VRCameraMetrics=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("WebVRFreeCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}}),t.Node.AddNodeConstructor("WebVRGamepadCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s){s===void 0&&(s={});var o=c.call(this,i,a,n)||this;o.webVROptions=s,o._vrDevice=null,o.rawPose=null,o._specsVersion="1.1",o._attached=!1,o._descendants=[],o._deviceRoomPosition=t.Vector3.Zero(),o._deviceRoomRotationQuaternion=t.Quaternion.Identity(),o._standingMatrix=null,o.devicePosition=t.Vector3.Zero(),o.deviceRotationQuaternion=t.Quaternion.Identity(),o.deviceScaleFactor=1,o._deviceToWorld=t.Matrix.Identity(),o._worldToDevice=t.Matrix.Identity(),o.controllers=[],o.onControllersAttachedObservable=new t.Observable,o.onControllerMeshLoadedObservable=new t.Observable,o.onPoseUpdatedFromDeviceObservable=new t.Observable,o._poseSet=!1,o.rigParenting=!0,o._defaultHeight=void 0,o._htmlElementAttached=null,o._detachIfAttached=function(){var u=o.getEngine().getVRDevice();u&&!u.isPresenting&&o._htmlElementAttached&&o.detachControl(o._htmlElementAttached)},o._workingVector=t.Vector3.Zero(),o._oneVector=t.Vector3.One(),o._workingMatrix=t.Matrix.Identity(),o._tmpMatrix=new t.Matrix,o._cache.position=t.Vector3.Zero(),s.defaultHeight&&(o._defaultHeight=s.defaultHeight,o.position.y=o._defaultHeight),o.minZ=.1,arguments.length===5&&(o.webVROptions=arguments[4]),o.webVROptions.trackPosition==null&&(o.webVROptions.trackPosition=!0),o.webVROptions.controllerMeshes==null&&(o.webVROptions.controllerMeshes=!0),o.webVROptions.defaultLightingOnControllers==null&&(o.webVROptions.defaultLightingOnControllers=!0),o.rotationQuaternion=new t.Quaternion,o.webVROptions&&o.webVROptions.positionScale&&(o.deviceScaleFactor=o.webVROptions.positionScale);var l=o.getEngine();return o._onVREnabled=function(u){u&&o.initControllers()},l.onVRRequestPresentComplete.add(o._onVREnabled),l.initWebVR().add(function(u){!u.vrDisplay||o._vrDevice===u.vrDisplay||(o._vrDevice=u.vrDisplay,o.setCameraRigMode(t.Camera.RIG_MODE_WEBVR,{parentCamera:o,vrDisplay:o._vrDevice,frameData:o._frameData,specs:o._specsVersion}),o._attached&&o.getEngine().enableVR())}),typeof VRFrameData<"u"&&(o._frameData=new VRFrameData),n.onBeforeCameraRenderObservable.add(function(u){u.parent===o&&o.rigParenting&&(o._descendants=o.getDescendants(!0,function(h){var d=o.controllers.some(function(m){return m._mesh===h}),p=o._rigCameras.indexOf(h)!==-1;return!d&&!p}),o._descendants.forEach(function(h){h.parent=u}))}),n.onAfterCameraRenderObservable.add(function(u){u.parent===o&&o.rigParenting&&o._descendants.forEach(function(h){h.parent=o})}),o}return r.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},r.prototype.useStandingMatrix=function(i){var a=this;i===void 0&&(i=function(n){}),this.getEngine().initWebVRAsync().then(function(n){!n.vrDisplay||!n.vrDisplay.stageParameters||!n.vrDisplay.stageParameters.sittingToStandingTransform||!a.webVROptions.trackPosition?i(!1):(a._standingMatrix=new t.Matrix,t.Matrix.FromFloat32ArrayToRefScaled(n.vrDisplay.stageParameters.sittingToStandingTransform,0,1,a._standingMatrix),a.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(s){a._standingMatrix&&(a._standingMatrix.m[s]*=-1)}),i(!0))})},r.prototype.useStandingMatrixAsync=function(){var i=this;return new Promise(function(a,n){i.useStandingMatrix(function(s){a(s)})})},r.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),c.prototype.dispose.call(this)},r.prototype.getControllerByName=function(i){for(var a=0,n=this.controllers;a<n.length;a++){var s=n[a];if(s.hand===i)return s}return null},Object.defineProperty(r.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),r.prototype.getForwardRay=function(i){return i===void 0&&(i=100),this.leftCamera?c.prototype.getForwardRay.call(this,i,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):c.prototype.getForwardRay.call(this,i)},r.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),c.prototype._checkInputs.call(this)},r.prototype.updateFromDevice=function(i){i&&i.orientation&&(this.rawPose=i,this._deviceRoomRotationQuaternion.copyFromFloats(i.orientation[0],i.orientation[1],-i.orientation[2],-i.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},r.prototype.attachControl=function(i,a){c.prototype.attachControl.call(this,i,a),this._attached=!0,this._htmlElementAttached=i,a=t.Camera.ForceAttachControlToAlwaysPreventDefault?!1:a,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},r.prototype.detachControl=function(i){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),c.prototype.detachControl.call(this,i),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},r.prototype.getClassName=function(){return"WebVRFreeCamera"},r.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},r.prototype._updateRigCameras=function(){var i=this._rigCameras[0],a=this._rigCameras[1];i.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),a.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),i.position.copyFrom(this._deviceRoomPosition),a.position.copyFrom(this._deviceRoomPosition)},r.prototype._correctPositionIfNotTrackPosition=function(i,a){a===void 0&&(a=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(t.Matrix.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),a||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(i,i))},r.prototype._updateCache=function(i){var a=this;(!this.rotationQuaternion.equals(this._cache.rotationQuaternion)||!this.position.equals(this._cache.position))&&(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),t.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),t.Matrix.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(n){n._deviceToWorld.copyFrom(a._deviceToWorld),a._correctPositionIfNotTrackPosition(n._deviceToWorld),n.update()})),i||c.prototype._updateCache.call(this),this.updateCacheCalled=!1},r.prototype._computeDevicePosition=function(){t.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},r.prototype.update=function(){this._computeDevicePosition(),t.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),t.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),c.prototype.update.call(this)},r.prototype._getViewMatrix=function(){return t.Matrix.Identity()},r.prototype._getWebVRViewMatrix=function(){var i=this,a=this._cameraRigParams.parentCamera;a._updateCache();var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return t.Matrix.FromArrayToRef(n,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(s){i._webvrViewMatrix.m[s]*=-1}),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),t.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),a.deviceScaleFactor!==1&&(this._webvrViewMatrix.invert(),a.deviceScaleFactor&&(this._webvrViewMatrix.m[12]*=a.deviceScaleFactor,this._webvrViewMatrix.m[13]*=a.deviceScaleFactor,this._webvrViewMatrix.m[14]*=a.deviceScaleFactor),this._webvrViewMatrix.invert()),a._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),a._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||t.Matrix.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(a.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},r.prototype._getWebVRProjectionMatrix=function(){var i=this,a=this.parent;a._vrDevice.depthNear=a.minZ,a._vrDevice.depthFar=a.maxZ;var n=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return t.Matrix.FromArrayToRef(n,0,this._projectionMatrix),this.getScene().useRightHandedSystem||[8,9,10,11].forEach(function(s){i._projectionMatrix.m[s]*=-1}),this._projectionMatrix},r.prototype.initControllers=function(){var i=this;this.controllers=[];var a=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=a.onGamepadDisconnectedObservable.add(function(n){if(n.type===t.Gamepad.POSE_ENABLED){var s=n;s.defaultModel&&s.defaultModel.setEnabled(!1),s.hand==="right"&&(i._rightController=null),s.hand==="left"&&(i._leftController=null);var o=i.controllers.indexOf(s);o!==-1&&i.controllers.splice(o,1)}}),this._onGamepadConnectedObserver=a.onGamepadConnectedObservable.add(function(n){if(n.type===t.Gamepad.POSE_ENABLED){var s=n;if(i.webVROptions.trackPosition||(s._disableTrackPosition(new t.Vector3(s.hand=="left"?-.15:.15,-.5,.25)),i._updateCacheWhenTrackingDisabledObserver||(i._updateCacheWhenTrackingDisabledObserver=i._scene.onBeforeRenderObservable.add(function(){i._updateCache()}))),s.deviceScaleFactor=i.deviceScaleFactor,s._deviceToWorld.copyFrom(i._deviceToWorld),i._correctPositionIfNotTrackPosition(s._deviceToWorld),i.webVROptions.controllerMeshes&&(s.defaultModel?s.defaultModel.setEnabled(!0):s.initControllerMesh(i.getScene(),function(u){if(u.scaling.scaleInPlace(i.deviceScaleFactor),i.onControllerMeshLoadedObservable.notifyObservers(s),i.webVROptions.defaultLightingOnControllers){i._lightOnControllers||(i._lightOnControllers=new t.HemisphericLight("vrControllersLight",new t.Vector3(0,1,0),i.getScene()));var h=function(d,p){var m=d.getChildren();m&&m.length!==0&&m.forEach(function(_){p.includedOnlyMeshes.push(_),h(_,p)})};i._lightOnControllers.includedOnlyMeshes.push(u),h(u,i._lightOnControllers)}})),s.attachToPoseControlledCamera(i),i.controllers.indexOf(s)===-1){i.controllers.push(s);for(var o=!1,l=0;l<i.controllers.length;l++)i.controllers[l].controllerType===t.PoseEnabledControllerType.VIVE&&(o?i.controllers[l].hand="right":(o=!0,i.controllers[l].hand="left"));i.controllers.length>=2&&i.onControllersAttachedObservable.notifyObservers(i.controllers)}}})},r}(t.FreeCamera);t.WebVRFreeCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("DeviceOrientationCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,a,n)||this;return s._quaternionCache=new t.Quaternion,s.inputs.addDeviceOrientation(),s}return r.prototype.getClassName=function(){return"DeviceOrientationCamera"},r.prototype._checkInputs=function(){c.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},r.prototype.resetToCurrentRotation=function(i){var a=this;i===void 0&&(i=t.Axis.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new t.Quaternion),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(n){i[n]?a._initialQuaternion[n]*=-1:a._initialQuaternion[n]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},r}(t.FreeCamera);t.DeviceOrientationCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s,o){s===void 0&&(s=!0),o===void 0&&(o=t.VRCameraMetrics.GetDefault());var l=c.call(this,i,a,n)||this;return o.compensateDistortion=s,l.setCameraRigMode(t.Camera.RIG_MODE_VR,{vrCameraMetrics:o}),l}return r.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},r}(t.DeviceOrientationCamera);t.VRDeviceOrientationFreeCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(c,r){return function(){return new f(c,0,0,1,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s,o,l,u,h){u===void 0&&(u=!0),h===void 0&&(h=t.VRCameraMetrics.GetDefault());var d=c.call(this,i,a,n,s,o,l)||this;return h.compensateDistortion=u,d.setCameraRigMode(t.Camera.RIG_MODE_VR,{vrCameraMetrics:h}),d.inputs.addVRDeviceOrientation(),d}return r.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},r}(t.ArcRotateCamera);t.VRDeviceOrientationArcRotateCamera=f})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n,s,o){s===void 0&&(s=!0),o===void 0&&(o=t.VRCameraMetrics.GetDefault());var l=c.call(this,i,a,n,s,o)||this;return l.inputs.addGamepad(),l}return r.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},r}(t.VRDeviceOrientationFreeCamera);t.VRDeviceOrientationGamepadCamera=f})(T||(T={}));var T;(function(t){var f=function(){function a(n,s){if(s===void 0&&(s=null),this.scene=n,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=a._idCounter++,s)this._gazeTracker=s.clone("gazeTracker");else{this._gazeTracker=t.Mesh.CreateTorus("gazeTracker",.0035,.0025,20,n,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var o=new t.StandardMaterial("targetMat",n);o.specularColor=t.Color3.Black(),o.emissiveColor=new t.Color3(.7,.7,.7),o.backFaceCulling=!1,this._gazeTracker.material=o}}return a.prototype._getForwardRay=function(n){return new t.Ray(t.Vector3.Zero(),new t.Vector3(0,0,n))},a.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},a.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},a.prototype._activatePointer=function(){this._activePointer=!0},a.prototype._deactivatePointer=function(){this._activePointer=!1},a.prototype._updatePointerDistance=function(n){n===void 0&&(n=100)},a.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},a._idCounter=0,a}(),c=function(a){N(n,a);function n(s,o,l){var u=a.call(this,o,l)||this;u.webVRController=s,u._laserPointer=t.Mesh.CreateCylinder("laserPointer",1,.004,2e-4,20,1,o,!1);var h=new t.StandardMaterial("laserPointerMat",o);if(h.emissiveColor=new t.Color3(.7,.7,.7),h.alpha=.6,u._laserPointer.material=h,u._laserPointer.rotation.x=Math.PI/2,u._laserPointer.position.z=-.5,u._laserPointer.isVisible=!1,u._laserPointer.isPickable=!1,!s.mesh){var d=new t.Mesh("preloadControllerMesh",o),p=new t.Mesh(t.PoseEnabledController.POINTING_POSE,o);p.rotation.x=-.7,d.addChild(p),s.attachToMesh(d)}return u._setLaserPointerParent(s.mesh),u._meshAttachedObserver=s._meshAttachedObservable.add(function(m){u._setLaserPointerParent(m)}),u}return n.prototype._getForwardRay=function(s){return this.webVRController.getForwardRay(s)},n.prototype._activatePointer=function(){a.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},n.prototype._deactivatePointer=function(){a.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},n.prototype._setLaserPointerColor=function(s){this._laserPointer.material.emissiveColor=s},n.prototype._setLaserPointerParent=function(s){var o=function(h){h.isPickable=!1,h.getChildMeshes().forEach(function(d){o(d)})};o(s);var l=s.getChildMeshes();this.webVRController._pointingPoseNode=null;for(var u=0;u<l.length;u++)if(l[u].name&&l[u].name.indexOf(t.PoseEnabledController.POINTING_POSE)>=0){s=l[u],this.webVRController._pointingPoseNode=s;break}this._laserPointer.parent=s},n.prototype._updatePointerDistance=function(s){s===void 0&&(s=100),this._laserPointer.scaling.y=s,this._laserPointer.position.z=-s/2},n.prototype.dispose=function(){a.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},n}(f),r=function(a){N(n,a);function n(s,o){var l=a.call(this,o)||this;return l.getCamera=s,l}return n.prototype._getForwardRay=function(s){var o=this.getCamera();return o?o.getForwardRay(s):new t.Ray(t.Vector3.Zero(),t.Vector3.Forward())},n}(f),i=function(){function a(n,s){s===void 0&&(s={});var o=this;if(this.webVROptions=s,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new t.Observable,this.onExitingVRObservable=new t.Observable,this.onControllerMeshLoadedObservable=new t.Observable,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new t.Vector3(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new t.Vector3(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new t.Observable,this.onNewMeshPicked=new t.Observable,this.onBeforeCameraTeleport=new t.Observable,this.onAfterCameraTeleport=new t.Observable,this.onSelectedMeshUnselected=new t.Observable,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this._onResize=function(){o.moveButtonToBottomRight(),o._fullscreenVRpresenting&&o._webVRready&&o.exitVR()},this._onFullscreenChange=function(){document.fullscreen!==void 0?o._fullscreenVRpresenting=document.fullscreen:document.mozFullScreen!==void 0?o._fullscreenVRpresenting=document.mozFullScreen:document.webkitIsFullScreen!==void 0?o._fullscreenVRpresenting=document.webkitIsFullScreen:document.msIsFullScreen!==void 0?o._fullscreenVRpresenting=document.msIsFullScreen:document.msFullscreenElement!==void 0&&(o._fullscreenVRpresenting=document.msFullscreenElement),!o._fullscreenVRpresenting&&o._canvas&&(o.exitVR(),o._useCustomVRButton||(o._btnVR.style.top=o._canvas.offsetTop+o._canvas.offsetHeight-70+"px",o._btnVR.style.left=o._canvas.offsetLeft+o._canvas.offsetWidth-100+"px"))},this.beforeRender=function(){o._leftController&&o._leftController._activePointer&&o._castRayAndSelectObject(o._leftController),o._rightController&&o._rightController._activePointer&&o._castRayAndSelectObject(o._rightController),o._noControllerIsActive?o._castRayAndSelectObject(o._cameraGazer):o._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(d){if(d.type!==t.Gamepad.POSE_ENABLED)d.leftStick&&d.onleftstickchanged(function(_){o._teleportationInitialized&&o.teleportationEnabled&&(!o._leftController&&!o._rightController||o._leftController&&!o._leftController._activePointer&&o._rightController&&!o._rightController._activePointer)&&(o._checkTeleportWithRay(_,o._cameraGazer),o._checkTeleportBackwards(_,o._cameraGazer))}),d.rightStick&&d.onrightstickchanged(function(_){o._teleportationInitialized&&o._checkRotate(_,o._cameraGazer)}),d.type===t.Gamepad.XBOX&&(d.onbuttondown(function(_){o._interactionsEnabled&&_===t.Xbox360Button.A&&o._cameraGazer._selectionPointerDown()}),d.onbuttonup(function(_){o._interactionsEnabled&&_===t.Xbox360Button.A&&o._cameraGazer._selectionPointerUp()}));else{var p=d,m=new c(p,o._scene,o._cameraGazer._gazeTracker);p.hand==="right"||o._leftController&&o._leftController.webVRController!=p?o._rightController=m:o._leftController=m,o._tryEnableInteractionOnController(m)}},this._tryEnableInteractionOnController=function(d){o._interactionsRequested&&!d._interactionsEnabled&&o._enableInteractionOnController(d),o._teleportationRequested&&!d._teleportationEnabled&&o._enableTeleportationOnController(d)},this._onNewGamepadDisconnected=function(d){d instanceof t.WebVRController&&(d.hand==="left"&&o._leftController!=null&&(o._leftController.dispose(),o._leftController=null),d.hand==="right"&&o._rightController!=null&&(o._rightController.dispose(),o._rightController=null))},this._workingVector=t.Vector3.Zero(),this._workingQuaternion=t.Quaternion.Identity(),this._workingMatrix=t.Matrix.Identity(),this._scene=n,this._canvas=n.getEngine().getRenderingCanvas(),s.createFallbackVRDeviceOrientationFreeCamera===void 0&&(s.createFallbackVRDeviceOrientationFreeCamera=!0),s.createDeviceOrientationCamera===void 0&&(s.createDeviceOrientationCamera=!0),s.laserToggle===void 0&&(s.laserToggle=!0),s.defaultHeight===void 0&&(s.defaultHeight=1.7),s.useCustomVRButton&&(this._useCustomVRButton=!0,s.customVRButton&&(this._btnVR=s.customVRButton)),s.rayLength&&(this._rayLength=s.rayLength),this._defaultHeight=s.defaultHeight,s.positionScale&&(this._rayLength*=s.positionScale,this._defaultHeight*=s.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new t.Vector3(0,this._defaultHeight,0),s.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new t.DeviceOrientationCamera("deviceOrientationVRHelper",this._position.clone(),n),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof t.TargetCamera&&this._scene.activeCamera.rotation)){var l=this._scene.activeCamera;l.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(l.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(t.Quaternion.RotationYawPitchRoll(l.rotation.y,l.rotation.x,l.rotation.z)),this._deviceOrientationCamera.rotation=l.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(s.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new t.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper",this._position,this._scene)),this._webVRCamera=new t.WebVRFreeCamera("WebVRHelper",this._position,this._scene,s),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new r(function(){return o.currentVRCamera},n),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var u=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";u+=".babylonVRicon.vrdisplaypresenting { display: none; }";var h=document.createElement("style");h.appendChild(document.createTextNode(u)),document.getElementsByTagName("head")[0].appendChild(h),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){o.isInVRMode?o.exitVR():o.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,s.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(d){d.vrDisplay&&o.displayVRButton()}),this._onKeyDown=function(d){d.keyCode===27&&o.isInVRMode&&o.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(d,p){o.isInVRMode&&(o.exitVR(),o._fullscreenVRpresenting&&o._scene.getEngine().switchFullscreen(!0))},t.PointerEventTypes.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(d){return o.onVRDisplayChanged(d)},this._onVrDisplayPresentChange=function(){return o.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){o._webVRrequesting=!0,o.updateButtonVisibility()},this._onVRRequestPresentComplete=function(d){o._webVRrequesting=!1,o.updateButtonVisibility()},n.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),n.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),n.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),n.onDisposeObservable.add(function(){o.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(d){return o._onDefaultMeshLoaded(d)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new t.CircleEase,this._circleEase.setEasingMode(t.EasingFunction.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(a.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(n){n&&(n.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=n)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(n){n&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=n,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(n){this._displayGaze=n,n||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(n){this._displayLaserPointer=n,n?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_teleportationRequestInitiated",{get:function(){var n=this._cameraGazer._teleportationRequestInitiated||this._leftController!==null&&this._leftController._teleportationRequestInitiated||this._rightController!==null&&this._rightController._teleportationRequestInitiated;return n},enumerable:!0,configurable:!0}),a.prototype._onDefaultMeshLoaded=function(n){this._leftController&&this._leftController.webVRController==n&&n.mesh&&this._leftController._setLaserPointerParent(n.mesh),this._rightController&&this._rightController.webVRController==n&&n.mesh&&this._rightController._setLaserPointerParent(n.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(n)}catch(s){t.Tools.Warn("Error in your custom logic onControllerMeshLoaded: "+s)}},Object.defineProperty(a.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),a.prototype.onVrDisplayPresentChange=function(){var n=this._scene.getEngine().getVRDevice();if(n){var s=this._webVRpresenting;this._webVRpresenting=n.isPresenting,s&&!this._webVRpresenting&&this.exitVR()}else t.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},a.prototype.onVRDisplayChanged=function(n){this._webVRsupported=n.vrSupported,this._webVRready=!!n.vrDisplay,this._webVRpresenting=n.vrDisplay&&n.vrDisplay.isPresenting,this.updateButtonVisibility()},a.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},a.prototype.displayVRButton=function(){!this._useCustomVRButton&&!this._btnVRDisplayed&&(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},a.prototype.updateButtonVisibility=function(){!this._btnVR||this._useCustomVRButton||(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},a.prototype.enterVR=function(){if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(n){t.Tools.Warn("Error in your custom logic onEnteringVR: "+n)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone(),this._existingCamera=this._scene.activeCamera),!this._webVRrequesting&&(this._webVRready?this._webVRpresenting||(this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().switchFullscreen(!0),this.updateButtonVisibility()),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._hasEnteredVR=!0)},a.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(n){t.Tools.Warn("Error in your custom logic onExitingVR: "+n)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),this._hasEnteredVR=!1}},Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(n){this._position=n,this._scene.activeCamera&&(this._scene.activeCamera.position=n)},enumerable:!0,configurable:!0}),a.prototype.enableInteractions=function(){var n=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(s){return s.isVisible&&(s.isPickable||s.name===n._floorMeshName)},this.meshSelectionPredicate=function(s){return!0},this._raySelectionPredicate=function(s){return n._isTeleportationFloor(s)||s.name.indexOf("gazeTracker")===-1&&s.name.indexOf("teleportationTarget")===-1&&s.name.indexOf("torusTeleportation")===-1?n.raySelectionPredicate(s):!1},this._interactionsEnabled=!0)},Object.defineProperty(a.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer)&&!(this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),a.prototype._isTeleportationFloor=function(n){for(var s=0;s<this._floorMeshesCollection.length;s++)if(this._floorMeshesCollection[s].id===n.id)return!0;return!!(this._floorMeshName&&n.name===this._floorMeshName)},a.prototype.addFloorMesh=function(n){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(n)>-1||this._floorMeshesCollection.push(n))},a.prototype.removeFloorMesh=function(n){if(this._floorMeshesCollection){var s=this._floorMeshesCollection.indexOf(n);s!==-1&&this._floorMeshesCollection.splice(s,1)}},a.prototype.enableTeleportation=function(n){if(n===void 0&&(n={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),n.floorMeshName&&(this._floorMeshName=n.floorMeshName),n.floorMeshes&&(this._floorMeshesCollection=n.floorMeshes),this._leftController!=null&&this._enableTeleportationOnController(this._leftController),this._rightController!=null&&this._enableTeleportationOnController(this._rightController);var s=new t.ImageProcessingConfiguration;s.vignetteColor=new t.Color4(0,0,0,0),s.vignetteEnabled=!0,this._postProcessMove=new t.ImageProcessingPostProcess("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,s),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},a.prototype._enableInteractionOnController=function(n){var s=this,o=n.webVRController.mesh;o&&(n._interactionsEnabled=!0,n._activatePointer(),this.webVROptions.laserToggle&&n.webVRController.onMainButtonStateChangedObservable.add(function(l){s._displayLaserPointer&&l.value===1&&(n._activePointer?n._deactivatePointer():n._activatePointer(),s.displayGaze&&(n._gazeTracker.isVisible=n._activePointer))}),n.webVRController.onTriggerStateChangedObservable.add(function(l){var u=n;s._noControllerIsActive&&(u=s._cameraGazer),u._pointerDownOnMeshAsked?l.value<s._padSensibilityDown&&u._selectionPointerUp():l.value>s._padSensibilityUp&&u._selectionPointerDown()}))},a.prototype._checkTeleportWithRay=function(n,s){this._teleportationRequestInitiated&&!s._teleportationRequestInitiated||(s._teleportationRequestInitiated?Math.sqrt(n.y*n.y+n.x*n.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),s._teleportationRequestInitiated=!1):n.y<-this._padSensibilityUp&&s._dpadPressed&&(s._activatePointer(),s._teleportationRequestInitiated=!0))},a.prototype._checkRotate=function(n,s){s._teleportationRequestInitiated||(s._rotationLeftAsked?n.x>-this._padSensibilityDown&&(s._rotationLeftAsked=!1):n.x<-this._padSensibilityUp&&s._dpadPressed&&(s._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),s._rotationRightAsked?n.x<this._padSensibilityDown&&(s._rotationRightAsked=!1):n.x>this._padSensibilityUp&&s._dpadPressed&&(s._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},a.prototype._checkTeleportBackwards=function(n,s){if(!s._teleportationRequestInitiated)if(n.y>this._padSensibilityUp&&s._dpadPressed){if(!s._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var o=t.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),l=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(o=this.currentVRCamera.deviceRotationQuaternion,l=this.currentVRCamera.devicePosition),o.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,t.Quaternion.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),t.Vector3.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var u=new t.Ray(l,this._workingVector),h=this._scene.pickWithRay(u,this._raySelectionPredicate);h&&h.pickedPoint&&h.pickedMesh&&this._isTeleportationFloor(h.pickedMesh)&&h.distance<5&&this.teleportCamera(h.pickedPoint),s._teleportationBackRequestInitiated=!0}}else s._teleportationBackRequestInitiated=!1},a.prototype._enableTeleportationOnController=function(n){var s=this,o=n.webVRController.mesh;o&&(n._interactionsEnabled||this._enableInteractionOnController(n),n._interactionsEnabled=!0,n._teleportationEnabled=!0,n.webVRController.controllerType===t.PoseEnabledControllerType.VIVE&&(n._dpadPressed=!1,n.webVRController.onPadStateChangedObservable.add(function(l){n._dpadPressed=l.pressed,n._dpadPressed||(n._rotationLeftAsked=!1,n._rotationRightAsked=!1,n._teleportationBackRequestInitiated=!1)})),n.webVRController.onPadValuesChangedObservable.add(function(l){s.teleportationEnabled&&(s._checkTeleportBackwards(l,n),s._checkTeleportWithRay(l,n)),s._checkRotate(l,n)}))},a.prototype._createTeleportationCircles=function(){this._teleportationTarget=t.Mesh.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var n=512,s=new t.DynamicTexture("DynamicTexture",n,this._scene,!0);s.hasAlpha=!0;var o=s.getContext(),l=n/2,u=n/2,h=200;o.beginPath(),o.arc(l,u,h,0,2*Math.PI,!1),o.fillStyle=this._teleportationFillColor,o.fill(),o.lineWidth=10,o.strokeStyle=this._teleportationBorderColor,o.stroke(),o.closePath(),s.update();var d=new t.StandardMaterial("TextPlaneMaterial",this._scene);d.diffuseTexture=s,this._teleportationTarget.material=d;var p=t.Mesh.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);p.isPickable=!1,p.parent=this._teleportationTarget;var m=new t.Animation("animationInnerCircle","position.y",30,t.Animation.ANIMATIONTYPE_FLOAT,t.Animation.ANIMATIONLOOPMODE_CYCLE),_=[];_.push({frame:0,value:0}),_.push({frame:30,value:.4}),_.push({frame:60,value:0}),m.setKeys(_);var v=new t.SineEase;v.setEasingMode(t.EasingFunction.EASINGMODE_EASEINOUT),m.setEasingFunction(v),p.animations=[],p.animations.push(m),this._scene.beginAnimation(p,0,60,!0),this._hideTeleportationTarget()},a.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},a.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},a.prototype._rotateCamera=function(n){var s=this;if(this.currentVRCamera instanceof t.FreeCamera){n?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var o=t.Quaternion.FromRotationMatrix(t.Matrix.RotationY(Math.PI/4*this._rotationAngle)),l=new t.Animation("animationRotation","rotationQuaternion",90,t.Animation.ANIMATIONTYPE_QUATERNION,t.Animation.ANIMATIONLOOPMODE_CONSTANT),u=[];u.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),u.push({frame:6,value:o}),l.setKeys(u),l.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(l),this._postProcessMove.animations=[];var h=new t.Animation("animationPP","vignetteWeight",90,t.Animation.ANIMATIONTYPE_FLOAT,t.Animation.ANIMATIONLOOPMODE_CONSTANT),d=[];d.push({frame:0,value:0}),d.push({frame:3,value:4}),d.push({frame:6,value:0}),h.setKeys(d),h.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(h);var p=new t.Animation("animationPP2","vignetteStretch",90,t.Animation.ANIMATIONTYPE_FLOAT,t.Animation.ANIMATIONLOOPMODE_CONSTANT),m=[];m.push({frame:0,value:0}),m.push({frame:3,value:10}),m.push({frame:6,value:0}),p.setKeys(m),p.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(p),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){s._webVRCamera.detachPostProcess(s._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},a.prototype._moveTeleportationSelectorTo=function(n,s,o){if(n.pickedPoint){s._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(n.pickedPoint),this._teleportationTarget.position.copyFrom(n.pickedPoint));var l=this._convertNormalToDirectionOfRay(n.getNormal(!0,!1),o);if(l){var u=t.Vector3.Cross(t.Axis.Y,l),h=t.Vector3.Cross(l,u);t.Vector3.RotationFromAxisToRef(h,l,u,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},a.prototype.teleportCamera=function(n){var s=this;if(this.currentVRCamera instanceof t.FreeCamera){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),n.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(n),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var o=new t.Animation("animationCameraTeleportation","position",90,t.Animation.ANIMATIONTYPE_VECTOR3,t.Animation.ANIMATIONLOOPMODE_CONSTANT),l=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];o.setKeys(l),o.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(o),this._postProcessMove.animations=[];var u=new t.Animation("animationPP","vignetteWeight",90,t.Animation.ANIMATIONTYPE_FLOAT,t.Animation.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:5,value:8}),h.push({frame:11,value:0}),u.setKeys(h),this._postProcessMove.animations.push(u);var d=new t.Animation("animationPP2","vignetteStretch",90,t.Animation.ANIMATIONTYPE_FLOAT,t.Animation.ANIMATIONLOOPMODE_CONSTANT),p=[];p.push({frame:0,value:0}),p.push({frame:5,value:10}),p.push({frame:11,value:0}),d.setKeys(p),this._postProcessMove.animations.push(d),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){s._webVRCamera.detachPostProcess(s._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,function(){s.onAfterCameraTeleport.notifyObservers(s._workingVector)}),this._hideTeleportationTarget()}},a.prototype._convertNormalToDirectionOfRay=function(n,s){if(n){var o=Math.acos(t.Vector3.Dot(n,s.direction));o<Math.PI/2&&n.scaleInPlace(-1)}return n},a.prototype._castRayAndSelectObject=function(n){if(this.currentVRCamera instanceof t.FreeCamera){var s=n._getForwardRay(this._rayLength),o=this._scene.pickWithRay(s,this._raySelectionPredicate);if(o&&(n._laserPointer&&(o.originMesh=n._laserPointer.parent),this._scene.simulatePointerMove(o,{pointerId:n._id})),n._currentHit=o,o&&o.pickedPoint){if(this._displayGaze){var l=1;n._gazeTracker.isVisible=!0,n._isActionableMesh&&(l=3),this.updateGazeTrackerScale&&(n._gazeTracker.scaling.x=o.distance*l,n._gazeTracker.scaling.y=o.distance*l,n._gazeTracker.scaling.z=o.distance*l);var u=this._convertNormalToDirectionOfRay(o.getNormal(),s),h=.002;if(u){var d=t.Vector3.Cross(t.Axis.Y,u),p=t.Vector3.Cross(u,d);t.Vector3.RotationFromAxisToRef(p,u,d,n._gazeTracker.rotation)}n._gazeTracker.position.copyFrom(o.pickedPoint),n._gazeTracker.position.x<0?n._gazeTracker.position.x+=h:n._gazeTracker.position.x-=h,n._gazeTracker.position.y<0?n._gazeTracker.position.y+=h:n._gazeTracker.position.y-=h,n._gazeTracker.position.z<0?n._gazeTracker.position.z+=h:n._gazeTracker.position.z-=h}n._updatePointerDistance(o.distance)}else n._updatePointerDistance(),n._gazeTracker.isVisible=!1;if(o&&o.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(o.pickedMesh)&&o.pickedPoint){n._currentMeshSelected&&!this._isTeleportationFloor(n._currentMeshSelected)&&this._notifySelectedMeshUnselected(n._currentMeshSelected),n._currentMeshSelected=null,n._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(o,n,s);return}if(o.pickedMesh!==n._currentMeshSelected)if(this.meshSelectionPredicate(o.pickedMesh)){this.onNewMeshPicked.notifyObservers(o),n._currentMeshSelected=o.pickedMesh,o.pickedMesh.isPickable&&o.pickedMesh.actionManager?(this.changeGazeColor(new t.Color3(0,0,1)),this.changeLaserColor(new t.Color3(.2,.2,1)),n._isActionableMesh=!0):(this.changeGazeColor(new t.Color3(.7,.7,.7)),this.changeLaserColor(new t.Color3(.7,.7,.7)),n._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(o.pickedMesh)}catch(m){t.Tools.Warn("Error in your custom logic onNewMeshSelected: "+m)}}else this._notifySelectedMeshUnselected(n._currentMeshSelected),n._currentMeshSelected=null,this.changeGazeColor(new t.Color3(.7,.7,.7)),this.changeLaserColor(new t.Color3(.7,.7,.7))}else this._notifySelectedMeshUnselected(n._currentMeshSelected),n._currentMeshSelected=null,this.changeGazeColor(new t.Color3(.7,.7,.7)),this.changeLaserColor(new t.Color3(.7,.7,.7))}},a.prototype._notifySelectedMeshUnselected=function(n){n&&this.onSelectedMeshUnselected.notifyObservers(n)},a.prototype.changeLaserColor=function(n){this._leftController&&this._leftController._setLaserPointerColor(n),this._rightController&&this._rightController._setLaserPointerColor(n)},a.prototype.changeGazeColor=function(n){this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=n,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=n),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=n))},a.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},a.prototype.getClassName=function(){return"VRExperienceHelper"},a}();t.VRExperienceHelper=i})(T||(T={}));var T;(function(t){var f;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(f=t.JoystickAxis||(t.JoystickAxis={}));var c=function(){function r(i){var a=this;if(i?this._leftJoystick=!0:this._leftJoystick=!1,r._globalJoystickIndex++,this._axisTargetedByLeftAndRight=f.X,this._axisTargetedByUpAndDown=f.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new t.StringDictionary,this.deltaPosition=t.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(s){r.vjCanvasWidth=window.innerWidth,r.vjCanvasHeight=window.innerHeight,r.vjCanvas&&(r.vjCanvas.width=r.vjCanvasWidth,r.vjCanvas.height=r.vjCanvasHeight),r.halfWidth=r.vjCanvasWidth/2},!r.vjCanvas){window.addEventListener("resize",this._onResize,!1),r.vjCanvas=document.createElement("canvas"),r.vjCanvasWidth=window.innerWidth,r.vjCanvasHeight=window.innerHeight,r.vjCanvas.width=window.innerWidth,r.vjCanvas.height=window.innerHeight,r.vjCanvas.style.width="100%",r.vjCanvas.style.height="100%",r.vjCanvas.style.position="absolute",r.vjCanvas.style.backgroundColor="transparent",r.vjCanvas.style.top="0px",r.vjCanvas.style.left="0px",r.vjCanvas.style.zIndex="5",r.vjCanvas.style.msTouchAction="none",r.vjCanvas.setAttribute("touch-action","none");var n=r.vjCanvas.getContext("2d");if(!n)throw new Error("Unable to create canvas for virtual joystick");r.vjCanvasContext=n,r.vjCanvasContext.strokeStyle="#ffffff",r.vjCanvasContext.lineWidth=2,document.body.appendChild(r.vjCanvas)}r.halfWidth=r.vjCanvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new t.Vector2(0,0),this._joystickPreviousPointerPos=new t.Vector2(0,0),this._joystickPointerStartPos=new t.Vector2(0,0),this._deltaJoystickVector=new t.Vector2(0,0),this._onPointerDownHandlerRef=function(s){a._onPointerDown(s)},this._onPointerMoveHandlerRef=function(s){a._onPointerMove(s)},this._onPointerUpHandlerRef=function(s){a._onPointerUp(s)},r.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),r.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),r.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),r.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),r.vjCanvas.addEventListener("contextmenu",function(s){s.preventDefault()},!1),requestAnimationFrame(function(){a._drawVirtualJoystick()})}return r.prototype.setJoystickSensibility=function(i){this._joystickSensibility=i,this._inversedSensibility=1/(this._joystickSensibility/1e3)},r.prototype._onPointerDown=function(i){var a;i.preventDefault(),this._leftJoystick===!0?a=i.clientX<r.halfWidth:a=i.clientX>r.halfWidth,a&&this._joystickPointerID<0?(this._joystickPointerID=i.pointerId,this._joystickPointerStartPos.x=i.clientX,this._joystickPointerStartPos.y=i.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(i.pointerId.toString(),i)):r._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(i.pointerId.toString(),{x:i.clientX,y:i.clientY,prevX:i.clientX,prevY:i.clientY}))},r.prototype._onPointerMove=function(i){if(this._joystickPointerID==i.pointerId){this._joystickPointerPos.x=i.clientX,this._joystickPointerPos.y=i.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var a=this.reverseLeftRight?-1:1,n=a*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case f.X:this.deltaPosition.x=Math.min(1,Math.max(-1,n));break;case f.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,n));break;case f.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,n));break}var s=this.reverseUpDown?1:-1,o=s*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case f.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case f.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case f.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o));break}}else{var l=this._touches.get(i.pointerId.toString());l&&(l.x=i.clientX,l.y=i.clientY)}},r.prototype._onPointerUp=function(i){if(this._joystickPointerID==i.pointerId)r.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),r.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var a=this._touches.get(i.pointerId.toString());a&&r.vjCanvasContext.clearRect(a.prevX-44,a.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(i.pointerId.toString())},r.prototype.setJoystickColor=function(i){this._joystickColor=i},r.prototype.setActionOnTouch=function(i){this._action=i},r.prototype.setAxisForLeftRight=function(i){switch(i){case f.X:case f.Y:case f.Z:this._axisTargetedByLeftAndRight=i;break;default:this._axisTargetedByLeftAndRight=f.X;break}},r.prototype.setAxisForUpDown=function(i){switch(i){case f.X:case f.Y:case f.Z:this._axisTargetedByUpAndDown=i;break;default:this._axisTargetedByUpAndDown=f.Y;break}},r.prototype._drawVirtualJoystick=function(){var i=this;this.pressed&&this._touches.forEach(function(a,n){n.pointerId===i._joystickPointerID?(r.vjCanvasContext.clearRect(i._joystickPointerStartPos.x-64,i._joystickPointerStartPos.y-64,128,128),r.vjCanvasContext.clearRect(i._joystickPreviousPointerPos.x-42,i._joystickPreviousPointerPos.y-42,84,84),r.vjCanvasContext.beginPath(),r.vjCanvasContext.lineWidth=6,r.vjCanvasContext.strokeStyle=i._joystickColor,r.vjCanvasContext.arc(i._joystickPointerStartPos.x,i._joystickPointerStartPos.y,40,0,Math.PI*2,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle=i._joystickColor,r.vjCanvasContext.lineWidth=2,r.vjCanvasContext.arc(i._joystickPointerStartPos.x,i._joystickPointerStartPos.y,60,0,Math.PI*2,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle=i._joystickColor,r.vjCanvasContext.arc(i._joystickPointerPos.x,i._joystickPointerPos.y,40,0,Math.PI*2,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),i._joystickPreviousPointerPos=i._joystickPointerPos.clone()):(r.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88),r.vjCanvasContext.beginPath(),r.vjCanvasContext.fillStyle="white",r.vjCanvasContext.beginPath(),r.vjCanvasContext.strokeStyle="red",r.vjCanvasContext.lineWidth=6,r.vjCanvasContext.arc(n.x,n.y,40,0,Math.PI*2,!0),r.vjCanvasContext.stroke(),r.vjCanvasContext.closePath(),n.prevX=n.x,n.prevY=n.y)}),requestAnimationFrame(function(){i._drawVirtualJoystick()})},r.prototype.releaseCanvas=function(){r.vjCanvas&&(r.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),r.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),r.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),r.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(r.vjCanvas),r.vjCanvas=null)},r._globalJoystickIndex=0,r}();t.VirtualJoystick=c})(T||(T={}));var T;(function(t){t.Node.AddNodeConstructor("VirtualJoysticksCamera",function(c,r){return function(){return new f(c,t.Vector3.Zero(),r)}});var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,a,n)||this;return s.inputs.addVirtualJoystick(),s}return r.prototype.getClassName=function(){return"VirtualJoysticksCamera"},r}(t.FreeCamera);t.VirtualJoysticksCamera=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.prototype.getLeftJoystick=function(){return this._leftjoystick},c.prototype.getRightJoystick=function(){return this._rightjoystick},c.prototype.checkInputs=function(){if(this._leftjoystick){var r=this.camera,i=r._computeLocalCameraSpeed()*50,a=t.Matrix.RotationYawPitchRoll(r.rotation.y,r.rotation.x,0),n=t.Vector3.TransformCoordinates(new t.Vector3(this._leftjoystick.deltaPosition.x*i,this._leftjoystick.deltaPosition.y*i,this._leftjoystick.deltaPosition.z*i),a);r.cameraDirection=r.cameraDirection.add(n),r.cameraRotation=r.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},c.prototype.attachControl=function(r,i){this._leftjoystick=new t.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(t.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(t.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new t.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(t.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(t.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},c.prototype.detachControl=function(r){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},c.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},c.prototype.getSimpleName=function(){return"virtualJoystick"},c}();t.FreeCameraVirtualJoystickInput=f,t.CameraInputTypes.FreeCameraVirtualJoystickInput=f})(T||(T={}));var T;(function(t){var f=function(){function l(u,h,d){this.quality=u,this.distance=h,this.optimizeMesh=d}return l}();t.SimplificationSettings=f;var c=function(){function l(){this.running=!1,this._simplificationArray=[]}return l.prototype.addTask=function(u){this._simplificationArray.push(u)},l.prototype.executeNext=function(){var u=this._simplificationArray.pop();u?(this.running=!0,this.runSimplification(u)):this.running=!1},l.prototype.runSimplification=function(u){var h=this;if(u.parallelProcessing)u.settings.forEach(function(m){var _=h.getSimplifier(u);_.simplify(m,function(v){u.mesh.addLODLevel(m.distance,v),v.isVisible=!0,m.quality===u.settings[u.settings.length-1].quality&&u.successCallback&&u.successCallback(),h.executeNext()})});else{var d=this.getSimplifier(u),p=function(m,_){d.simplify(m,function(v){u.mesh.addLODLevel(m.distance,v),v.isVisible=!0,_()})};t.AsyncLoop.Run(u.settings.length,function(m){p(u.settings[m.index],function(){m.executeNext()})},function(){u.successCallback&&u.successCallback(),h.executeNext()})}},l.prototype.getSimplifier=function(u){switch(u.simplificationType){case r.QUADRATIC:default:return new o(u.mesh)}},l}();t.SimplificationQueue=c;var r;(function(l){l[l.QUADRATIC=0]="QUADRATIC"})(r=t.SimplificationType||(t.SimplificationType={}));var i=function(){function l(u){this.vertices=u,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return l}(),a=function(){function l(u,h){this.position=u,this.id=h,this.isBorder=!0,this.q=new n,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return l.prototype.updatePosition=function(u){this.position.copyFrom(u)},l}(),n=function(){function l(u){this.data=new Array(10);for(var h=0;h<10;++h)u&&u[h]?this.data[h]=u[h]:this.data[h]=0}return l.prototype.det=function(u,h,d,p,m,_,v,S,P){var x=this.data[u]*this.data[m]*this.data[P]+this.data[d]*this.data[p]*this.data[S]+this.data[h]*this.data[_]*this.data[v]-this.data[d]*this.data[m]*this.data[v]-this.data[u]*this.data[_]*this.data[S]-this.data[h]*this.data[p]*this.data[P];return x},l.prototype.addInPlace=function(u){for(var h=0;h<10;++h)this.data[h]+=u.data[h]},l.prototype.addArrayInPlace=function(u){for(var h=0;h<10;++h)this.data[h]+=u[h]},l.prototype.add=function(u){for(var h=new l,d=0;d<10;++d)h.data[d]=this.data[d]+u.data[d];return h},l.FromData=function(u,h,d,p){return new l(l.DataFromNumbers(u,h,d,p))},l.DataFromNumbers=function(u,h,d,p){return[u*u,u*h,u*d,u*p,h*h,h*d,h*p,d*d,d*p,p*p]},l}(),s=function(){function l(u,h){this.vertexId=u,this.triangleId=h}return l}(),o=function(){function l(u){this._mesh=u,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=t.Epsilon}return l.prototype.simplify=function(u,h){var d=this;this.initDecimatedMesh(),t.AsyncLoop.Run(this._mesh.subMeshes.length,function(p){d.initWithMesh(p.index,function(){d.runDecimation(u,p.index,function(){p.executeNext()})},u.optimizeMesh)},function(){setTimeout(function(){h(d._reconstructedMesh)},0)})},l.prototype.runDecimation=function(u,h,d){var p=this,m=~~(this.triangles.length*u.quality),_=0,v=this.triangles.length,S=function(P,x){setTimeout(function(){P%5===0&&p.updateMesh(P===0);for(var R=0;R<p.triangles.length;++R)p.triangles[R].isDirty=!1;var w=1e-9*Math.pow(P+3,p.aggressiveness),I=function(F){var k=~~((p.triangles.length/2+F)%p.triangles.length),E=p.triangles[k];if(E&&!(E.error[3]>w||E.deleted||E.isDirty)){for(var g=0;g<3;++g)if(E.error[g]<w){var y=[],M=[],C=E.vertices[g],D=E.vertices[(g+1)%3];if(C.isBorder||D.isBorder)continue;var V=t.Vector3.Zero(),G=t.Vector3.Zero(),U=t.Vector2.Zero(),z=new t.Color4(0,0,0,1);p.calculateError(C,D,V,G,U,z);var H=new Array;if(p.isFlipped(C,D,V,y,E.borderFactor,H)||p.isFlipped(D,C,V,M,E.borderFactor,H)||y.indexOf(!0)<0||M.indexOf(!0)<0)continue;var W=new Array;if(H.forEach(function(ee){W.indexOf(ee)===-1&&(ee.deletePending=!0,W.push(ee))}),W.length%2!==0)continue;C.q=D.q.add(C.q),C.updatePosition(V);var X=p.references.length;_=p.updateTriangles(C,C,y,_),_=p.updateTriangles(C,D,M,_);var K=p.references.length-X;if(K<=C.triangleCount){if(K)for(var j=0;j<K;j++)p.references[C.triangleStart+j]=p.references[X+j]}else C.triangleStart=X;C.triangleCount=K;break}}};t.AsyncLoop.SyncAsyncForLoop(p.triangles.length,p.syncIterations,I,x,function(){return v-_<=m})},0)};t.AsyncLoop.Run(this.decimationIterations,function(P){v-_<=m?P.breakLoop():S(P.index,function(){P.executeNext()})},function(){setTimeout(function(){p.reconstructMesh(h),d()},0)})},l.prototype.initWithMesh=function(u,h,d){var p=this;this.vertices=[],this.triangles=[];var m=this._mesh.getVerticesData(t.VertexBuffer.PositionKind),_=this._mesh.getIndices(),v=this._mesh.subMeshes[u],S=function(w){if(d){for(var I=0;I<p.vertices.length;++I)if(p.vertices[I].position.equals(w))return p.vertices[I]}return null},P=[],x=function(w){if(m){var I=w+v.verticesStart,F=t.Vector3.FromArray(m,I*3),k=S(F)||new a(F,p.vertices.length);k.originalOffsets.push(I),k.id===p.vertices.length&&p.vertices.push(k),P.push(k.id)}},R=v.verticesCount;t.AsyncLoop.SyncAsyncForLoop(R,this.syncIterations/4>>0,x,function(){var w=function(I){if(_){var F=v.indexStart/3+I,k=F*3,E=_[k+0],g=_[k+1],y=_[k+2],M=p.vertices[P[E-v.verticesStart]],C=p.vertices[P[g-v.verticesStart]],D=p.vertices[P[y-v.verticesStart]],V=new i([M,C,D]);V.originalOffset=k,p.triangles.push(V)}};t.AsyncLoop.SyncAsyncForLoop(v.indexCount/3,p.syncIterations,w,function(){p.init(h)})})},l.prototype.init=function(u){var h=this,d=function(p){var m=h.triangles[p];m.normal=t.Vector3.Cross(m.vertices[1].position.subtract(m.vertices[0].position),m.vertices[2].position.subtract(m.vertices[0].position)).normalize();for(var _=0;_<3;_++)m.vertices[_].q.addArrayInPlace(n.DataFromNumbers(m.normal.x,m.normal.y,m.normal.z,-t.Vector3.Dot(m.normal,m.vertices[0].position)))};t.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,d,function(){var p=function(m){for(var _=h.triangles[m],v=0;v<3;++v)_.error[v]=h.calculateError(_.vertices[v],_.vertices[(v+1)%3]);_.error[3]=Math.min(_.error[0],_.error[1],_.error[2])};t.AsyncLoop.SyncAsyncForLoop(h.triangles.length,h.syncIterations,p,function(){u()})})},l.prototype.reconstructMesh=function(u){var h=[],d;for(d=0;d<this.vertices.length;++d)this.vertices[d].triangleCount=0;var p,m;for(d=0;d<this.triangles.length;++d)if(!this.triangles[d].deleted){for(p=this.triangles[d],m=0;m<3;++m)p.vertices[m].triangleCount=1;h.push(p)}var _=this._reconstructedMesh.getVerticesData(t.VertexBuffer.PositionKind)||[],v=this._reconstructedMesh.getVerticesData(t.VertexBuffer.NormalKind)||[],S=this._reconstructedMesh.getVerticesData(t.VertexBuffer.UVKind)||[],P=this._reconstructedMesh.getVerticesData(t.VertexBuffer.ColorKind)||[],x=this._mesh.getVerticesData(t.VertexBuffer.NormalKind),R=this._mesh.getVerticesData(t.VertexBuffer.UVKind),w=this._mesh.getVerticesData(t.VertexBuffer.ColorKind),I=0;for(d=0;d<this.vertices.length;++d){var F=this.vertices[d];F.id=I,F.triangleCount&&F.originalOffsets.forEach(function(D){x&&(_.push(F.position.x),_.push(F.position.y),_.push(F.position.z),v.push(x[D*3]),v.push(x[D*3+1]),v.push(x[D*3+2]),R&&R.length?(S.push(R[D*2]),S.push(R[D*2+1])):w&&w.length&&(P.push(w[D*4]),P.push(w[D*4+1]),P.push(w[D*4+2]),P.push(w[D*4+3])),++I)})}var k=this._reconstructedMesh.getTotalIndices(),E=this._reconstructedMesh.getTotalVertices(),g=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var y=this._reconstructedMesh.getIndices(),M=this._mesh.getIndices();for(d=0;d<h.length;++d)p=h[d],[0,1,2].forEach(function(D){var V=M[p.originalOffset+D],G=p.vertices[D].originalOffsets.indexOf(V);G<0&&(G=0),y.push(p.vertices[D].id+G+E)});this._reconstructedMesh.setIndices(y),this._reconstructedMesh.setVerticesData(t.VertexBuffer.PositionKind,_),this._reconstructedMesh.setVerticesData(t.VertexBuffer.NormalKind,v),S.length>0&&this._reconstructedMesh.setVerticesData(t.VertexBuffer.UVKind,S),P.length>0&&this._reconstructedMesh.setVerticesData(t.VertexBuffer.ColorKind,P);var C=this._mesh.subMeshes[u];u>0&&(this._reconstructedMesh.subMeshes=[],g.forEach(function(D){t.SubMesh.AddToMesh(D.materialIndex,D.verticesStart,D.verticesCount,D.indexStart,D.indexCount,D.getMesh())}),t.SubMesh.AddToMesh(C.materialIndex,E,I,k,h.length*3,this._reconstructedMesh))},l.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new t.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},l.prototype.isFlipped=function(u,h,d,p,m,_){for(var v=0;v<u.triangleCount;++v){var S=this.triangles[this.references[u.triangleStart+v].triangleId];if(!S.deleted){var P=this.references[u.triangleStart+v].vertexId,x=S.vertices[(P+1)%3],R=S.vertices[(P+2)%3];if(x===h||R===h){p[v]=!0,_.push(S);continue}var w=x.position.subtract(d);w=w.normalize();var I=R.position.subtract(d);if(I=I.normalize(),Math.abs(t.Vector3.Dot(w,I))>.999)return!0;var F=t.Vector3.Cross(w,I).normalize();if(p[v]=!1,t.Vector3.Dot(F,S.normal)<.2)return!0}}return!1},l.prototype.updateTriangles=function(u,h,d,p){for(var m=p,_=0;_<h.triangleCount;++_){var v=this.references[h.triangleStart+_],S=this.triangles[v.triangleId];if(!S.deleted){if(d[_]&&S.deletePending){S.deleted=!0,m++;continue}S.vertices[v.vertexId]=u,S.isDirty=!0,S.error[0]=this.calculateError(S.vertices[0],S.vertices[1])+S.borderFactor/2,S.error[1]=this.calculateError(S.vertices[1],S.vertices[2])+S.borderFactor/2,S.error[2]=this.calculateError(S.vertices[2],S.vertices[0])+S.borderFactor/2,S.error[3]=Math.min(S.error[0],S.error[1],S.error[2]),this.references.push(v)}}return m},l.prototype.identifyBorder=function(){for(var u=0;u<this.vertices.length;++u){var h=[],d=[],p=this.vertices[u],m;for(m=0;m<p.triangleCount;++m)for(var _=this.triangles[this.references[p.triangleStart+m].triangleId],v=0;v<3;v++){for(var S=0,P=_.vertices[v];S<h.length&&d[S]!==P.id;)++S;S===h.length?(h.push(1),d.push(P.id)):h[S]++}for(m=0;m<h.length;++m)h[m]===1?this.vertices[d[m]].isBorder=!0:this.vertices[d[m]].isBorder=!1}},l.prototype.updateMesh=function(u){u===void 0&&(u=!1);var h;if(!u){var d=[];for(h=0;h<this.triangles.length;++h)this.triangles[h].deleted||d.push(this.triangles[h]);this.triangles=d}for(h=0;h<this.vertices.length;++h)this.vertices[h].triangleCount=0,this.vertices[h].triangleStart=0;var p,m,_;for(h=0;h<this.triangles.length;++h)for(p=this.triangles[h],m=0;m<3;++m)_=p.vertices[m],_.triangleCount++;var v=0;for(h=0;h<this.vertices.length;++h)this.vertices[h].triangleStart=v,v+=this.vertices[h].triangleCount,this.vertices[h].triangleCount=0;var S=new Array(this.triangles.length*3);for(h=0;h<this.triangles.length;++h)for(p=this.triangles[h],m=0;m<3;++m)_=p.vertices[m],S[_.triangleStart+_.triangleCount]=new s(m,h),_.triangleCount++;this.references=S,u&&this.identifyBorder()},l.prototype.vertexError=function(u,h){var d=h.x,p=h.y,m=h.z;return u.data[0]*d*d+2*u.data[1]*d*p+2*u.data[2]*d*m+2*u.data[3]*d+u.data[4]*p*p+2*u.data[5]*p*m+2*u.data[6]*p+u.data[7]*m*m+2*u.data[8]*m+u.data[9]},l.prototype.calculateError=function(u,h,d,p,m,_){var v=u.q.add(h.q),S=u.isBorder&&h.isBorder,P=0,x=v.det(0,1,2,1,4,5,2,5,7);if(x!==0&&!S)d||(d=t.Vector3.Zero()),d.x=-1/x*v.det(1,2,3,4,5,6,5,7,8),d.y=1/x*v.det(0,2,3,1,5,6,2,7,8),d.z=-1/x*v.det(0,1,3,1,4,6,2,5,8),P=this.vertexError(v,d);else{var R=u.position.add(h.position).divide(new t.Vector3(2,2,2)),w=this.vertexError(v,u.position),I=this.vertexError(v,h.position),F=this.vertexError(v,R);P=Math.min(w,I,F),P===w?d&&d.copyFrom(u.position):P===I?d&&d.copyFrom(h.position):d&&d.copyFrom(R)}return P},l}()})(T||(T={}));var T;(function(t){Object.defineProperty(t.Scene.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new t.SimplificationQueue;var c=this._getComponent(t.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE);c||(c=new f(this),this._addComponent(c))}return this._simplificationQueue},set:function(c){this._simplificationQueue=c},enumerable:!0,configurable:!0}),t.Mesh.prototype.simplify=function(c,r,i,a){return r===void 0&&(r=!0),i===void 0&&(i=t.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:c,parallelProcessing:r,mesh:this,simplificationType:i,successCallback:a}),this};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE,this.scene=r}return c.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(t.SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){},c.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},c}();t.SimplicationQueueSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i){this.distance=r,this.mesh=i}return c}();t.MeshLODLevel=f})(T||(T={}));var T;(function(t){var f=function(){function p(m){m===void 0&&(m=0),this.priority=m}return p.prototype.getDescription=function(){return""},p.prototype.apply=function(m,_){return!0},p}();t.SceneOptimization=f;var c=function(p){N(m,p);function m(_,v,S){_===void 0&&(_=0),v===void 0&&(v=1024),S===void 0&&(S=.5);var P=p.call(this,_)||this;return P.priority=_,P.maximumSize=v,P.step=S,P}return m.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},m.prototype.apply=function(_,v){for(var S=!0,P=0;P<_.textures.length;P++){var x=_.textures[P];if(!(!x.canRescale||x.getContext)){var R=x.getSize(),w=Math.max(R.width,R.height);w>this.maximumSize&&(x.scale(this.step),S=!1)}}return S},m}(f);t.TextureOptimization=c;var r=function(p){N(m,p);function m(_,v,S){_===void 0&&(_=0),v===void 0&&(v=2),S===void 0&&(S=.25);var P=p.call(this,_)||this;return P.priority=_,P.maximumScale=v,P.step=S,P._currentScale=-1,P._directionOffset=1,P}return m.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},m.prototype.apply=function(_,v){return this._currentScale===-1&&(this._currentScale=_.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,_.getEngine().setHardwareScalingLevel(this._currentScale),this._directionOffset===1?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},m}(f);t.HardwareScalingOptimization=r;var i=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return"Turning shadows on/off"},m.prototype.apply=function(_,v){return _.shadowsEnabled=v.isInImprovementMode,!0},m}(f);t.ShadowsOptimization=i;var a=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return"Turning post-processes on/off"},m.prototype.apply=function(_,v){return _.postProcessesEnabled=v.isInImprovementMode,!0},m}(f);t.PostProcessesOptimization=a;var n=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return"Turning lens flares on/off"},m.prototype.apply=function(_,v){return _.lensFlaresEnabled=v.isInImprovementMode,!0},m}(f);t.LensFlaresOptimization=n;var s=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},m.prototype.apply=function(_,v){return this.onApply?this.onApply(_,v):!0},m}(f);t.CustomOptimization=s;var o=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return"Turning particles on/off"},m.prototype.apply=function(_,v){return _.particlesEnabled=v.isInImprovementMode,!0},m}(f);t.ParticlesOptimization=o;var l=function(p){N(m,p);function m(){return p!==null&&p.apply(this,arguments)||this}return m.prototype.getDescription=function(){return"Turning render targets off"},m.prototype.apply=function(_,v){return _.renderTargetsEnabled=v.isInImprovementMode,!0},m}(f);t.RenderTargetsOptimization=l;var u=function(p){N(m,p);function m(){var _=p!==null&&p.apply(this,arguments)||this;return _._canBeMerged=function(v){if(!(v instanceof t.Mesh))return!1;var S=v;return!(S.isDisposed()||!S.isVisible||!S.isEnabled()||S.instances.length>0||S.skeleton||S.hasLODLevels)},_}return Object.defineProperty(m,"UpdateSelectionTree",{get:function(){return m._UpdateSelectionTree},set:function(_){m._UpdateSelectionTree=_},enumerable:!0,configurable:!0}),m.prototype.getDescription=function(){return"Merging similar meshes together"},m.prototype.apply=function(_,v,S){for(var P=_.meshes.slice(0),x=P.length,R=0;R<x;R++){var w=new Array,I=P[R];if(this._canBeMerged(I)){w.push(I);for(var F=R+1;F<x;F++){var k=P[F];this._canBeMerged(k)&&k.material===I.material&&k.checkCollisions===I.checkCollisions&&(w.push(k),x--,P.splice(F,1),F--)}w.length<2||t.Mesh.MergeMeshes(w,void 0,!0)}}var E=_;return E.createOrUpdateSelectionOctree&&(S!=null?S&&E.createOrUpdateSelectionOctree():m.UpdateSelectionTree&&E.createOrUpdateSelectionOctree()),!0},m._UpdateSelectionTree=!1,m}(f);t.MergeMeshesOptimization=u;var h=function(){function p(m,_){m===void 0&&(m=60),_===void 0&&(_=2e3),this.targetFrameRate=m,this.trackerDuration=_,this.optimizations=new Array}return p.prototype.addOptimization=function(m){return this.optimizations.push(m),this},p.prototype.addCustomOptimization=function(m,_,v){v===void 0&&(v=0);var S=new s(v);return S.onApply=m,S.onGetDescription=_,this.optimizations.push(S),this},p.LowDegradationAllowed=function(m){var _=new p(m),v=0;return _.addOptimization(new u(v)),_.addOptimization(new i(v)),_.addOptimization(new n(v)),v++,_.addOptimization(new a(v)),_.addOptimization(new o(v)),v++,_.addOptimization(new c(v,1024)),_},p.ModerateDegradationAllowed=function(m){var _=new p(m),v=0;return _.addOptimization(new u(v)),_.addOptimization(new i(v)),_.addOptimization(new n(v)),v++,_.addOptimization(new a(v)),_.addOptimization(new o(v)),v++,_.addOptimization(new c(v,512)),v++,_.addOptimization(new l(v)),v++,_.addOptimization(new r(v,2)),_},p.HighDegradationAllowed=function(m){var _=new p(m),v=0;return _.addOptimization(new u(v)),_.addOptimization(new i(v)),_.addOptimization(new n(v)),v++,_.addOptimization(new a(v)),_.addOptimization(new o(v)),v++,_.addOptimization(new c(v,256)),v++,_.addOptimization(new l(v)),v++,_.addOptimization(new r(v,4)),_},p}();t.SceneOptimizerOptions=h;var d=function(){function p(m,_,v,S){v===void 0&&(v=!0),S===void 0&&(S=!1);var P=this;if(this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new t.Observable,this.onNewOptimizationAppliedObservable=new t.Observable,this.onFailureObservable=new t.Observable,_?this._options=_:this._options=new h,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),v)for(var x=0,R=0,w=this._options.optimizations;R<w.length;R++){var I=w[R];I.priority=x++}this._improvementMode=S,this._scene=m||t.Engine.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){P._sceneDisposeObserver=null,P.dispose()})}return Object.defineProperty(p.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(m){this._targetFrameRate=m},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(m){this._trackerDuration=m},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),p.prototype.stop=function(){this._isRunning=!1},p.prototype.reset=function(){this._currentPriorityLevel=0},p.prototype.start=function(){var m=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){m._checkCurrentState()},m._trackerDuration)}))},p.prototype._checkCurrentState=function(){var m=this;if(this._isRunning){var _=this._scene,v=this._options;if(this._currentFrameRate=Math.round(_.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate){this._isRunning=!1,this.onSuccessObservable.notifyObservers(this);return}for(var S=!0,P=!0,x=0;x<v.optimizations.length;x++){var R=v.optimizations[x];R.priority===this._currentPriorityLevel&&(P=!1,S=S&&R.apply(_,this),this.onNewOptimizationAppliedObservable.notifyObservers(R))}if(P){this._isRunning=!1,this.onFailureObservable.notifyObservers(this);return}S&&this._currentPriorityLevel++,_.executeWhenReady(function(){setTimeout(function(){m._checkCurrentState()},m._trackerDuration)})}},p.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},p.OptimizeAsync=function(m,_,v,S){var P=new p(m,_||h.ModerateDegradationAllowed(),!1);return v&&P.onSuccessObservable.add(function(){v()}),S&&P.onFailureObservable.add(function(){S()}),P.start(),P},p}();t.SceneOptimizer=d})(T||(T={}));var T;(function(t){t.Scene.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new f(this)),this._outlineRenderer},Object.defineProperty(t.AbstractMesh.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(c){c&&this.getScene().getOutlineRenderer(),this._renderOutline=c},enumerable:!0,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(c){c&&this.getScene().getOutlineRenderer(),this._renderOverlay=c},enumerable:!0,configurable:!0});var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=r,this._engine=r.getEngine(),this.scene._addComponent(this)}return c.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(t.SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(t.SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},c.prototype.rebuild=function(){},c.prototype.dispose=function(){},c.prototype.render=function(r,i,a){var n=this;a===void 0&&(a=!1);var s=this.scene,o=s.getEngine(),l=o.getCaps().instancedArrays&&i.visibleInstances[r._id]!==null&&i.visibleInstances[r._id]!==void 0;if(this.isReady(r,l)){var u=r.getRenderingMesh(),h=r.getMaterial();if(!(!h||!s.activeCamera)){if(o.enableEffect(this._effect),h.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(s.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",a?0:u.outlineWidth),this._effect.setColor4("color",a?u.overlayColor:u.outlineColor,a?u.overlayAlpha:h.alpha),this._effect.setMatrix("viewProjection",s.getTransformMatrix()),u.useBones&&u.computeBonesUsingShaders&&u.skeleton&&this._effect.setMatrices("mBones",u.skeleton.getTransformMatrices(u)),u._bind(r,this._effect,t.Material.TriangleFillMode),h&&h.needAlphaTesting()){var d=h.getAlphaTestTexture();d&&(this._effect.setTexture("diffuseSampler",d),this._effect.setMatrix("diffuseMatrix",d.getTextureMatrix()))}o.setZOffset(-this.zOffset),u._processRendering(r,this._effect,t.Material.TriangleFillMode,i,l,function(p,m){n._effect.setMatrix("world",m)}),o.setZOffset(0)}}},c.prototype.isReady=function(r,i){var a=[],n=[t.VertexBuffer.PositionKind,t.VertexBuffer.NormalKind],s=r.getMesh(),o=r.getMaterial();o&&(o.needAlphaTesting()&&(a.push("#define ALPHATEST"),s.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(n.push(t.VertexBuffer.UVKind),a.push("#define UV1")),s.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&(n.push(t.VertexBuffer.UV2Kind),a.push("#define UV2"))),o.useLogarithmicDepth&&a.push("#define LOGARITHMICDEPTH")),s.useBones&&s.computeBonesUsingShaders?(n.push(t.VertexBuffer.MatricesIndicesKind),n.push(t.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(n.push(t.VertexBuffer.MatricesIndicesExtraKind),n.push(t.VertexBuffer.MatricesWeightsExtraKind)),a.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),a.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):a.push("#define NUM_BONE_INFLUENCERS 0"),i&&(a.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var l=a.join(`
`);return this._cachedDefines!==l&&(this._cachedDefines=l,this._effect=this.scene.getEngine().createEffect("outline",n,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],l)),this._effect.isReady()},c.prototype._beforeRenderingMesh=function(r,i,a){this._savedDepthWrite=this._engine.getDepthWrite(),r.renderOutline&&(this._engine.setDepthWrite(!1),this.render(i,a),this._engine.setDepthWrite(this._savedDepthWrite))},c.prototype._afterRenderingMesh=function(r,i,a){if(r.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(i,a),this._engine.setColorWrite(!0)),r.renderOverlay){var n=this._engine.getAlphaMode();this._engine.setAlphaMode(t.Engine.ALPHA_COMBINE),this.render(i,a,!0),this._engine.setAlphaMode(n)}},c}();t.OutlineRenderer=f})(T||(T={}));var T;(function(t){t.AbstractMesh.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},t.AbstractMesh.prototype.enableEdgesRendering=function(r,i){return r===void 0&&(r=.95),i===void 0&&(i=!1),this.disableEdgesRendering(),this._edgesRenderer=new c(this,r,i),this},Object.defineProperty(t.AbstractMesh.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),t.LinesMesh.prototype.enableEdgesRendering=function(r,i){return r===void 0&&(r=.95),i===void 0&&(i=!1),this.disableEdgesRendering(),this._edgesRenderer=new t.LineEdgesRenderer(this,r,i),this};var f=function(){function r(){this.edges=new Array,this.edgesConnectedCount=0}return r}(),c=function(){function r(i,a,n,s){a===void 0&&(a=.95),n===void 0&&(n=!1),s===void 0&&(s=!0);var o=this;this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=i,this._checkVerticesInsteadOfIndices=n,this._epsilon=a,this._prepareRessources(),s&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){o._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){o.dispose()})}return r.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new t.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},r.prototype._rebuild=function(){var i=this._buffers[t.VertexBuffer.PositionKind];i&&i._rebuild(),i=this._buffers[t.VertexBuffer.NormalKind],i&&i._rebuild();var a=this._source.getScene(),n=a.getEngine();this._ib=n.createIndexBuffer(this._linesIndices)},r.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var i=this._buffers[t.VertexBuffer.PositionKind];i&&(i.dispose(),this._buffers[t.VertexBuffer.PositionKind]=null),i=this._buffers[t.VertexBuffer.NormalKind],i&&(i.dispose(),this._buffers[t.VertexBuffer.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},r.prototype._processEdgeForAdjacencies=function(i,a,n,s,o){return i===n&&a===s||i===s&&a===n?0:i===s&&a===o||i===o&&a===s?1:i===o&&a===n||i===n&&a===o?2:-1},r.prototype._processEdgeForAdjacenciesWithVertices=function(i,a,n,s,o){return i.equalsWithEpsilon(n)&&a.equalsWithEpsilon(s)||i.equalsWithEpsilon(s)&&a.equalsWithEpsilon(n)?0:i.equalsWithEpsilon(s)&&a.equalsWithEpsilon(o)||i.equalsWithEpsilon(o)&&a.equalsWithEpsilon(s)?1:i.equalsWithEpsilon(o)&&a.equalsWithEpsilon(n)||i.equalsWithEpsilon(n)&&a.equalsWithEpsilon(o)?2:-1},r.prototype._checkEdge=function(i,a,n,s,o){var l;if(a===void 0)l=!0;else{var u=t.Vector3.Dot(n[i],n[a]);l=u<this._epsilon}if(l){var h=this._linesPositions.length/3,d=s.subtract(o);d.normalize(),this._linesPositions.push(s.x),this._linesPositions.push(s.y),this._linesPositions.push(s.z),this._linesPositions.push(s.x),this._linesPositions.push(s.y),this._linesPositions.push(s.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(-1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(1),this._linesNormals.push(s.x),this._linesNormals.push(s.y),this._linesNormals.push(s.z),this._linesNormals.push(-1),this._linesNormals.push(s.x),this._linesNormals.push(s.y),this._linesNormals.push(s.z),this._linesNormals.push(1),this._linesIndices.push(h),this._linesIndices.push(h+1),this._linesIndices.push(h+2),this._linesIndices.push(h),this._linesIndices.push(h+2),this._linesIndices.push(h+3)}},r.prototype._generateEdgesLines=function(){var i=this._source.getVerticesData(t.VertexBuffer.PositionKind),a=this._source.getIndices();if(!(!a||!i)){var n=new Array,s=new Array,o,l;for(o=0;o<a.length;o+=3){l=new f;var u=a[o],h=a[o+1],d=a[o+2];l.p0=new t.Vector3(i[u*3],i[u*3+1],i[u*3+2]),l.p1=new t.Vector3(i[h*3],i[h*3+1],i[h*3+2]),l.p2=new t.Vector3(i[d*3],i[d*3+1],i[d*3+2]);var p=t.Vector3.Cross(l.p1.subtract(l.p0),l.p2.subtract(l.p1));p.normalize(),s.push(p),n.push(l)}for(o=0;o<n.length;o++){l=n[o];for(var m=o+1;m<n.length;m++){var _=n[m];if(l.edgesConnectedCount===3)break;if(_.edgesConnectedCount!==3)for(var v=a[m*3],S=a[m*3+1],P=a[m*3+2],x=0;x<3;x++){var R=0;if(l.edges[x]===void 0){switch(x){case 0:this._checkVerticesInsteadOfIndices?R=this._processEdgeForAdjacenciesWithVertices(l.p0,l.p1,_.p0,_.p1,_.p2):R=this._processEdgeForAdjacencies(a[o*3],a[o*3+1],v,S,P);break;case 1:this._checkVerticesInsteadOfIndices?R=this._processEdgeForAdjacenciesWithVertices(l.p1,l.p2,_.p0,_.p1,_.p2):R=this._processEdgeForAdjacencies(a[o*3+1],a[o*3+2],v,S,P);break;case 2:this._checkVerticesInsteadOfIndices?R=this._processEdgeForAdjacenciesWithVertices(l.p2,l.p0,_.p0,_.p1,_.p2):R=this._processEdgeForAdjacencies(a[o*3+2],a[o*3],v,S,P);break}if(R!==-1&&(l.edges[x]=m,_.edges[R]=o,l.edgesConnectedCount++,_.edgesConnectedCount++,l.edgesConnectedCount===3))break}}}}for(o=0;o<n.length;o++){var w=n[o];this._checkEdge(o,w.edges[0],s,w.p0,w.p1),this._checkEdge(o,w.edges[1],s,w.p1,w.p2),this._checkEdge(o,w.edges[2],s,w.p2,w.p0)}var I=this._source.getScene().getEngine();this._buffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(I,this._linesPositions,t.VertexBuffer.PositionKind,!1),this._buffers[t.VertexBuffer.NormalKind]=new t.VertexBuffer(I,this._linesNormals,t.VertexBuffer.NormalKind,!1,!1,4),this._ib=I.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},r.prototype.isReady=function(){return this._lineShader.isReady()},r.prototype.render=function(){var i=this._source.getScene();if(!(!this.isReady()||!i.activeCamera)){var a=i.getEngine();this._lineShader._preBind(),this._source.edgesColor.a!==1?a.setAlphaMode(t.Engine.ALPHA_COMBINE):a.setAlphaMode(t.Engine.ALPHA_DISABLE),a.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),i.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),i.activeCamera.mode===t.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",a.getAspectRatio(i.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),a.drawElementsType(t.Material.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},r}();t.EdgesRenderer=c})(T||(T={}));var T;(function(t){var f=function(){function r(){this.edges=new Array,this.edgesConnectedCount=0}return r}(),c=function(r){N(i,r);function i(a,n,s){n===void 0&&(n=.95),s===void 0&&(s=!1);var o=r.call(this,a,n,s,!1)||this;return o._generateEdgesLines(),o}return i.prototype._checkEdge=function(a,n,s,o,l){var u=this._linesPositions.length/3,h=o.subtract(l);h.normalize(),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(l.x),this._linesPositions.push(l.y),this._linesPositions.push(l.z),this._linesPositions.push(l.x),this._linesPositions.push(l.y),this._linesPositions.push(l.z),this._linesNormals.push(l.x),this._linesNormals.push(l.y),this._linesNormals.push(l.z),this._linesNormals.push(-1),this._linesNormals.push(l.x),this._linesNormals.push(l.y),this._linesNormals.push(l.z),this._linesNormals.push(1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(-1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(1),this._linesIndices.push(u),this._linesIndices.push(u+1),this._linesIndices.push(u+2),this._linesIndices.push(u),this._linesIndices.push(u+2),this._linesIndices.push(u+3)},i.prototype._generateEdgesLines=function(){var a=this._source.getVerticesData(t.VertexBuffer.PositionKind),n=this._source.getIndices();if(!(!n||!a)){for(var s=new Array,o=new Array,l,u=0;u<a.length/3-1;u++){var h=new f;h.p0=new t.Vector3(a[u*3],a[u*3+1],a[u*3+2]),h.p1=new t.Vector3(a[(u+1)*3],a[(u+1)*3+1],a[(u+1)*3+2]),s.push(h)}for(l=0;l<s.length;l++){var d=s[l];this._checkEdge(l,d.edges[0],o,d.p0,d.p1)}var p=this._source.getScene().getEngine();this._buffers[t.VertexBuffer.PositionKind]=new t.VertexBuffer(p,this._linesPositions,t.VertexBuffer.PositionKind,!1),this._buffers[t.VertexBuffer.NormalKind]=new t.VertexBuffer(p,this._linesNormals,t.VertexBuffer.NormalKind,!1,!1,4),this._ib=p.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i}(t.EdgesRenderer);t.LineEdgesRenderer=c})(T||(T={}));var T;(function(t){t.AbstractScene.AddParser(t.SceneComponentConstants.NAME_EFFECTLAYER,function(c,r,i,a){if(c.effectLayers){i.effectLayers||(i.effectLayers=new Array);for(var n=0;n<c.effectLayers.length;n++){var s=t.EffectLayer.Parse(c.effectLayers[n],r,a);i.effectLayers.push(s)}}}),t.AbstractScene.prototype.removeEffectLayer=function(c){var r=this.effectLayers.indexOf(c);return r!==-1&&this.effectLayers.splice(r,1),r},t.AbstractScene.prototype.addEffectLayer=function(c){this.effectLayers.push(c)};var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=r,this._engine=r.getEngine(),r.effectLayers=new Array}return c.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(t.SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(t.SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},c.prototype.rebuild=function(){for(var r=this.scene.effectLayers,i=0,a=r;i<a.length;i++){var n=a[i];n._rebuild()}},c.prototype.serialize=function(r){r.effectLayers=[];for(var i=this.scene.effectLayers,a=0,n=i;a<n.length;a++){var s=n[a];s.serialize&&r.effectLayers.push(s.serialize())}},c.prototype.addFromContainer=function(r){var i=this;r.effectLayers&&r.effectLayers.forEach(function(a){i.scene.addEffectLayer(a)})},c.prototype.removeFromContainer=function(r){var i=this;r.effectLayers&&r.effectLayers.forEach(function(a){i.scene.removeEffectLayer(a)})},c.prototype.dispose=function(){for(var r=this.scene.effectLayers;r.length;)r[0].dispose()},c.prototype._isReadyForMesh=function(r,i){for(var a=this.scene.effectLayers,n=0,s=a;n<s.length;n++){var o=s[n];if(o.hasMesh(r))for(var l=0,u=r.subMeshes;l<u.length;l++){var h=u[l];if(!o.isReady(h,i))return!1}}return!0},c.prototype._renderMainTexture=function(r){this._renderEffects=!1,this._needStencil=!1;var i=this.scene.effectLayers;if(i&&i.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var a=0,n=i;a<n.length;a++){var s=n[a];if(s.shouldRender()&&(!s.camera||s.camera.cameraRigMode===t.Camera.RIG_MODE_NONE&&r===s.camera||s.camera.cameraRigMode!==t.Camera.RIG_MODE_NONE&&s.camera._rigCameras.indexOf(r)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||s.needStencil();var o=s._mainTexture;o._shouldRender()&&(this.scene.incrementRenderId(),o.render(!1,!1))}}this.scene.incrementRenderId()}},c.prototype._setStencil=function(r){this._needStencil&&this._engine.setStencilBuffer(!0)},c.prototype._setStencilBack=function(r){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},c.prototype._draw=function(r){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var i=this.scene.effectLayers,a=0;a<i.length;a++){var n=i[a];n.renderingGroupId===r&&n.shouldRender()&&n.render()}this._engine.setDepthBuffer(!0)}},c.prototype._drawCamera=function(r){this._renderEffects&&this._draw(-1)},c.prototype._drawRenderingGroup=function(r){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(r)},c}();t.EffectLayerSceneComponent=f})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function c(r,i){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new t.Color4},this.neutralColor=new t.Color4,this.isEnabled=!0,this.onDisposeObservable=new t.Observable,this.onBeforeRenderMainTextureObservable=new t.Observable,this.onBeforeComposeObservable=new t.Observable,this.onAfterComposeObservable=new t.Observable,this.onSizeChangedObservable=new t.Observable,this.name=r,this._scene=i||t.Engine.LastCreatedScene;var a=this._scene._getComponent(t.SceneComponentConstants.NAME_EFFECTLAYER);a||(a=new t.EffectLayerSceneComponent(this._scene),this._scene._addComponent(a)),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._genrateVertexBuffer()}return Object.defineProperty(c.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),c.prototype._init=function(r){this._effectLayerOptions=Ve({mainTextureRatio:.5,alphaBlendingMode:t.Engine.ALPHA_COMBINE,camera:null,renderingGroupId:-1},r),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},c.prototype._generateIndexBuffer=function(){var r=[];r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),this._indexBuffer=this._engine.createIndexBuffer(r)},c.prototype._genrateVertexBuffer=function(){var r=[];r.push(1,1),r.push(-1,1),r.push(-1,-1),r.push(1,-1);var i=new t.VertexBuffer(this._engine,r,t.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[t.VertexBuffer.PositionKind]=i},c.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},c.prototype._createMainTexture=function(){var r=this;this._mainTexture=new t.RenderTargetTexture("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,t.Engine.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(i,a,n,s){r.onBeforeRenderMainTextureObservable.notifyObservers(r);var o,l=r._scene.getEngine();if(s.length){for(l.setColorWrite(!1),o=0;o<s.length;o++)r._renderSubMesh(s.data[o]);l.setColorWrite(!0)}for(o=0;o<i.length;o++)r._renderSubMesh(i.data[o]);for(o=0;o<a.length;o++)r._renderSubMesh(a.data[o]);for(o=0;o<n.length;o++)r._renderSubMesh(n.data[o])},this._mainTexture.onClearObservable.add(function(i){i.clear(r.neutralColor,!0,!0,!0)})},c.prototype._isReady=function(r,i,a){var n=r.getMaterial();if(!n||!n.isReady(r.getMesh(),i))return!1;var s=[],o=[t.VertexBuffer.PositionKind],l=r.getMesh(),u=!1,h=!1;if(n&&n.needAlphaTesting()){var d=n.getAlphaTestTexture();d&&(s.push("#define ALPHATEST"),l.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&d.coordinatesIndex===1?(s.push("#define DIFFUSEUV2"),h=!0):l.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(s.push("#define DIFFUSEUV1"),u=!0))}a&&(s.push("#define EMISSIVE"),l.isVerticesDataPresent(t.VertexBuffer.UV2Kind)&&a.coordinatesIndex===1?(s.push("#define EMISSIVEUV2"),h=!0):l.isVerticesDataPresent(t.VertexBuffer.UVKind)&&(s.push("#define EMISSIVEUV1"),u=!0)),u&&(o.push(t.VertexBuffer.UVKind),s.push("#define UV1")),h&&(o.push(t.VertexBuffer.UV2Kind),s.push("#define UV2")),l.useBones&&l.computeBonesUsingShaders?(o.push(t.VertexBuffer.MatricesIndicesKind),o.push(t.VertexBuffer.MatricesWeightsKind),l.numBoneInfluencers>4&&(o.push(t.VertexBuffer.MatricesIndicesExtraKind),o.push(t.VertexBuffer.MatricesWeightsExtraKind)),s.push("#define NUM_BONE_INFLUENCERS "+l.numBoneInfluencers),s.push("#define BonesPerMesh "+(l.skeleton?l.skeleton.bones.length+1:0))):s.push("#define NUM_BONE_INFLUENCERS 0");var p=l.morphTargetManager,m=0;p&&p.numInfluencers>0&&(s.push("#define MORPHTARGETS"),m=p.numInfluencers,s.push("#define NUM_MORPH_INFLUENCERS "+m),t.MaterialHelper.PrepareAttributesForMorphTargets(o,l,{NUM_MORPH_INFLUENCERS:m})),i&&(s.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var _=s.join(`
`);return this._cachedDefines!==_&&(this._cachedDefines=_,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",o,["world","mBones","viewProjection","diffuseMatrix","color","emissiveMatrix","morphTargetInfluences"],["diffuseSampler","emissiveSampler"],_,void 0,void 0,void 0,{maxSimultaneousMorphTargets:m})),this._effectLayerMapGenerationEffect.isReady()},c.prototype.render=function(){var r=this._mergeEffect;if(r.isReady()){for(var i=0;i<this._postProcesses.length;i++)if(!this._postProcesses[i].isReady())return;var a=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),a.enableEffect(r),a.setState(!1),a.bindBuffers(this._vertexBuffers,this._indexBuffer,r);var n=a.getAlphaMode();a.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(r),a.setAlphaMode(n),this.onAfterComposeObservable.notifyObservers(this);var s=this._mainTexture.getSize();this._setMainTextureSize(),(s.width!==this._mainTextureDesiredSize.width||s.height!==this._mainTextureDesiredSize.height)&&(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},c.prototype.hasMesh=function(r){return this.renderingGroupId===-1||r.renderingGroupId===this.renderingGroupId},c.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},c.prototype._shouldRenderMesh=function(r){return!0},c.prototype._shouldRenderEmissiveTextureForMesh=function(r){return!0},c.prototype._renderSubMesh=function(r){var i=this;if(this.shouldRender()){var a=r.getMaterial(),n=r.getRenderingMesh(),s=this._scene,o=s.getEngine();if(a&&!a.needAlphaBlendingForMesh(n)){o.setState(a.backFaceCulling);var l=n._getInstancesRenderList(r._id);if(!l.mustReturn&&this._shouldRenderMesh(n)){var u=o.getCaps().instancedArrays&&l.visibleInstances[r._id]!==null&&l.visibleInstances[r._id]!==void 0;if(this._setEmissiveTextureAndColor(n,r,a),this._isReady(r,u,this._emissiveTextureAndColor.texture)){if(o.enableEffect(this._effectLayerMapGenerationEffect),n._bind(r,this._effectLayerMapGenerationEffect,t.Material.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",s.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("color",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a),a&&a.needAlphaTesting()){var h=a.getAlphaTestTexture();if(h){this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",h);var d=h.getTextureMatrix();d&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",d)}}this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),n.useBones&&n.computeBonesUsingShaders&&n.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),t.MaterialHelper.BindMorphTargetParameters(n,this._effectLayerMapGenerationEffect),n._processRendering(r,this._effectLayerMapGenerationEffect,t.Material.TriangleFillMode,l,u,function(p,m){return i._effectLayerMapGenerationEffect.setMatrix("world",m)})}else this._mainTexture.resetRefreshCounter()}}}},c.prototype._rebuild=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&r._rebuild(),this._generateIndexBuffer()},c.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var r=0;r<this._postProcesses.length;r++)this._postProcesses[r]&&this._postProcesses[r].dispose();this._postProcesses=[];for(var r=0;r<this._textures.length;r++)this._textures[r]&&this._textures[r].dispose();this._textures=[]},c.prototype.dispose=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&(r.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var i=this._scene.effectLayers.indexOf(this,0);i>-1&&this._scene.effectLayers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},c.prototype.getClassName=function(){return"EffectLayer"},c.Parse=function(r,i,a){var n=t.Tools.Instantiate(r.customType);return n.Parse(r,i,a)},A([t.serialize()],c.prototype,"name",void 0),A([t.serializeAsColor4()],c.prototype,"neutralColor",void 0),A([t.serialize()],c.prototype,"isEnabled",void 0),A([t.serializeAsCameraReference()],c.prototype,"camera",null),A([t.serialize()],c.prototype,"renderingGroupId",null),c}();t.EffectLayer=f})(T||(T={}));var T;(function(t){t.AbstractScene.prototype.getHighlightLayerByName=function(r){for(var i=0;i<this.effectLayers.length;i++)if(this.effectLayers[i].name===r&&this.effectLayers[i].getEffectName()===c.EffectName)return this.effectLayers[i];return null};var f=function(r){N(i,r);function i(a,n,s,o,l,u,h,d){u===void 0&&(u=t.Texture.BILINEAR_SAMPLINGMODE);var p=r.call(this,a,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,o,l,u,h,d)||this;return p.direction=n,p.kernel=s,p.onApplyObservable.add(function(m){m.setFloat2("screenSize",p.width,p.height),m.setVector2("direction",p.direction),m.setFloat("blurWidth",p.kernel)}),p}return i}(t.PostProcess),c=function(r){N(i,r);function i(a,n,s){var o=r.call(this,a,n)||this;return o.name=a,o.innerGlow=!0,o.outerGlow=!0,o.onBeforeBlurObservable=new t.Observable,o.onAfterBlurObservable=new t.Observable,o._instanceGlowingMeshStencilReference=i.GlowingMeshStencilReference++,o._meshes={},o._excludedMeshes={},o.neutralColor=i.NeutralColor,o._engine.isStencilEnable||t.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"),o._options=Ve({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:t.Engine.ALPHA_COMBINE,camera:null,renderingGroupId:-1},s),o._init({alphaBlendingMode:o._options.alphaBlendingMode,camera:o._options.camera,mainTextureFixedSize:o._options.mainTextureFixedSize,mainTextureRatio:o._options.mainTextureRatio,renderingGroupId:o._options.renderingGroupId}),o._shouldRender=!1,o}return Object.defineProperty(i.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(a){this._horizontalBlurPostprocess.kernel=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(a){this._verticalBlurPostprocess.kernel=a},enumerable:!0,configurable:!0}),i.prototype.getEffectName=function(){return i.EffectName},i.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[t.VertexBuffer.PositionKind],["offset"],["textureSampler"],this._options.isStroke?`#define STROKE 
`:void 0)},i.prototype._createTextureAndPostProcesses=function(){var a=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,s=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(n,this._maxSize):n,s=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(s,this._maxSize):s;var o=0;this._engine.getCaps().textureHalfFloatRender?o=t.Engine.TEXTURETYPE_HALF_FLOAT:o=t.Engine.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new t.RenderTargetTexture("HighlightLayerBlurRTT",{width:n,height:s},this._scene,!1,!0,o),this._blurTexture.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(t.Texture.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===t.Engine.ALPHA_COMBINE?(this._downSamplePostprocess=new t.PassPostProcess("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",a._mainTexture)}),this._horizontalBlurPostprocess=new f("HighlightLayerHBP",new t.Vector2(1,0),this._options.blurHorizontalSize,1,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,s)}),this._verticalBlurPostprocess=new f("HighlightLayerVBP",new t.Vector2(0,1),this._options.blurVerticalSize,1,null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(l){l.setFloat2("screenSize",n,s)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new t.BlurPostProcess("HighlightLayerHBP",new t.Vector2(1,0),this._options.blurHorizontalSize/2,{width:n,height:s},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._horizontalBlurPostprocess.width=n,this._horizontalBlurPostprocess.height=s,this._horizontalBlurPostprocess.onApplyObservable.add(function(l){l.setTexture("textureSampler",a._mainTexture)}),this._verticalBlurPostprocess=new t.BlurPostProcess("HighlightLayerVBP",new t.Vector2(0,1),this._options.blurVerticalSize/2,{width:n,height:s},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,o),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){a.onBeforeBlurObservable.notifyObservers(a);var l=a._blurTexture.getInternalTexture();l&&a._scene.postProcessManager.directRender(a._postProcesses,l,!0),a.onAfterBlurObservable.notifyObservers(a)}),this._postProcesses.map(function(l){l.autoClear=!1})},i.prototype.needStencil=function(){return!0},i.prototype.isReady=function(a,n){var s=a.getMaterial(),o=a.getRenderingMesh();if(!s||!o||!this._meshes)return!1;var l=null,u=this._meshes[o.uniqueId];return u&&u.glowEmissiveOnly&&s&&(l=s.emissiveTexture),r.prototype._isReady.call(this,a,n,l)},i.prototype._internalRender=function(a){a.setTexture("textureSampler",this._blurTexture);var n=this._engine,s=n.getStencilBuffer(),o=n.getStencilFunction(),l=n.getStencilMask(),u=n.getStencilOperationPass(),h=n.getStencilOperationFail(),d=n.getStencilOperationDepthFail(),p=n.getStencilFunctionReference();n.setStencilOperationPass(t.Engine.REPLACE),n.setStencilOperationFail(t.Engine.KEEP),n.setStencilOperationDepthFail(t.Engine.KEEP),n.setStencilMask(0),n.setStencilBuffer(!0),n.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(a.setFloat("offset",0),n.setStencilFunction(t.Engine.NOTEQUAL),n.drawElementsType(t.Material.TriangleFillMode,0,6)),this.innerGlow&&(a.setFloat("offset",1),n.setStencilFunction(t.Engine.EQUAL),n.drawElementsType(t.Material.TriangleFillMode,0,6)),n.setStencilFunction(o),n.setStencilMask(l),n.setStencilBuffer(s),n.setStencilOperationPass(u),n.setStencilOperationFail(h),n.setStencilOperationDepthFail(d),n.setStencilFunctionReference(p)},i.prototype.shouldRender=function(){return r.prototype.shouldRender.call(this)?!!this._meshes:!1},i.prototype._shouldRenderMesh=function(a){return!(this._excludedMeshes&&this._excludedMeshes[a.uniqueId]||!r.prototype.hasMesh.call(this,a))},i.prototype._setEmissiveTextureAndColor=function(a,n,s){var o=this._meshes[a.uniqueId];o?this._emissiveTextureAndColor.color.set(o.color.r,o.color.g,o.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),o&&o.glowEmissiveOnly&&s?(this._emissiveTextureAndColor.texture=s.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},i.prototype.addExcludedMesh=function(a){if(this._excludedMeshes){var n=this._excludedMeshes[a.uniqueId];n||(this._excludedMeshes[a.uniqueId]={mesh:a,beforeRender:a.onBeforeRenderObservable.add(function(s){s.getEngine().setStencilBuffer(!1)}),afterRender:a.onAfterRenderObservable.add(function(s){s.getEngine().setStencilBuffer(!0)})})}},i.prototype.removeExcludedMesh=function(a){if(this._excludedMeshes){var n=this._excludedMeshes[a.uniqueId];n&&(n.beforeRender&&a.onBeforeRenderObservable.remove(n.beforeRender),n.afterRender&&a.onAfterRenderObservable.remove(n.afterRender)),this._excludedMeshes[a.uniqueId]=null}},i.prototype.hasMesh=function(a){return!this._meshes||!r.prototype.hasMesh.call(this,a)?!1:this._meshes[a.uniqueId]!==void 0&&this._meshes[a.uniqueId]!==null},i.prototype.addMesh=function(a,n,s){var o=this;if(s===void 0&&(s=!1),!!this._meshes){var l=this._meshes[a.uniqueId];l?l.color=n:(this._meshes[a.uniqueId]={mesh:a,color:n,observerHighlight:a.onBeforeRenderObservable.add(function(u){o._excludedMeshes&&o._excludedMeshes[u.uniqueId]?o._defaultStencilReference(u):u.getScene().getEngine().setStencilFunctionReference(o._instanceGlowingMeshStencilReference)}),observerDefault:a.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:s},a.onDisposeObservable.add(function(){o._disposeMesh(a)})),this._shouldRender=!0}},i.prototype.removeMesh=function(a){if(this._meshes){var n=this._meshes[a.uniqueId];n&&(n.observerHighlight&&a.onBeforeRenderObservable.remove(n.observerHighlight),n.observerDefault&&a.onAfterRenderObservable.remove(n.observerDefault),delete this._meshes[a.uniqueId]),this._shouldRender=!1;for(var s in this._meshes)if(this._meshes[s]){this._shouldRender=!0;break}}},i.prototype._defaultStencilReference=function(a){a.getScene().getEngine().setStencilFunctionReference(i.NormalMeshStencilReference)},i.prototype._disposeMesh=function(a){this.removeMesh(a),this.removeExcludedMesh(a)},i.prototype.dispose=function(){if(this._meshes){for(var a in this._meshes){var n=this._meshes[a];n&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeRenderObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(var a in this._excludedMeshes){var n=this._excludedMeshes[a];n&&(n.beforeRender&&n.mesh.onBeforeRenderObservable.remove(n.beforeRender),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}r.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"HighlightLayer"},i.prototype.serialize=function(){var a=t.SerializationHelper.Serialize(this);if(a.customType="BABYLON.HighlightLayer",a.meshes=[],this._meshes)for(var n in this._meshes){var s=this._meshes[n];s&&a.meshes.push({glowEmissiveOnly:s.glowEmissiveOnly,color:s.color.asArray(),meshId:s.mesh.id})}if(a.excludedMeshes=[],this._excludedMeshes)for(var o in this._excludedMeshes){var l=this._excludedMeshes[o];l&&a.excludedMeshes.push(l.mesh.id)}return a},i.Parse=function(a,n,s){var o=t.SerializationHelper.Parse(function(){return new i(a.name,n,a.options)},a,n,s),l;for(l=0;l<a.excludedMeshes.length;l++){var u=n.getMeshByID(a.excludedMeshes[l]);u&&o.addExcludedMesh(u)}for(l=0;l<a.meshes.length;l++){var h=a.meshes[l],u=n.getMeshByID(h.meshId);u&&o.addMesh(u,t.Color3.FromArray(h.color),h.glowEmissiveOnly)}return o},i.EffectName="HighlightLayer",i.NeutralColor=new t.Color4(0,0,0,0),i.GlowingMeshStencilReference=2,i.NormalMeshStencilReference=1,A([t.serialize()],i.prototype,"innerGlow",void 0),A([t.serialize()],i.prototype,"outerGlow",void 0),A([t.serialize()],i.prototype,"blurHorizontalSize",null),A([t.serialize()],i.prototype,"blurVerticalSize",null),A([t.serialize("options")],i.prototype,"_options",void 0),i}(t.EffectLayer);t.HighlightLayer=c})(T||(T={}));var T;(function(t){t.AbstractScene.prototype.getGlowLayerByName=function(c){for(var r=0;r<this.effectLayers.length;r++)if(this.effectLayers[r].name===c&&this.effectLayers[r].getEffectName()===f.EffectName)return this.effectLayers[r];return null};var f=function(c){N(r,c);function r(i,a,n){var s=c.call(this,i,a)||this;return s._intensity=1,s._includedOnlyMeshes=[],s._excludedMeshes=[],s.neutralColor=new t.Color4(0,0,0,1),s._options=Ve({mainTextureRatio:r.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},n),s._init({alphaBlendingMode:t.Engine.ALPHA_ADD,camera:s._options.camera,mainTextureFixedSize:s._options.mainTextureFixedSize,mainTextureRatio:s._options.mainTextureRatio,renderingGroupId:s._options.renderingGroupId}),s}return Object.defineProperty(r.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(i){this._horizontalBlurPostprocess1.kernel=i,this._verticalBlurPostprocess1.kernel=i,this._horizontalBlurPostprocess2.kernel=i,this._verticalBlurPostprocess2.kernel=i},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"intensity",{get:function(){return this._intensity},set:function(i){this._intensity=i},enumerable:!0,configurable:!0}),r.prototype.getEffectName=function(){return r.EffectName},r.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[t.VertexBuffer.PositionKind],["offset"],["textureSampler","textureSampler2"],`#define EMISSIVE 
`)},r.prototype._createTextureAndPostProcesses=function(){var i=this,a=this._mainTextureDesiredSize.width,n=this._mainTextureDesiredSize.height;a=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(a,this._maxSize):a,n=this._engine.needPOTTextures?t.Tools.GetExponentOfTwo(n,this._maxSize):n;var s=0;this._engine.getCaps().textureHalfFloatRender?s=t.Engine.TEXTURETYPE_HALF_FLOAT:s=t.Engine.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new t.RenderTargetTexture("GlowLayerBlurRTT",{width:a,height:n},this._scene,!1,!0,s),this._blurTexture1.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var o=Math.floor(a/2),l=Math.floor(n/2);this._blurTexture2=new t.RenderTargetTexture("GlowLayerBlurRTT2",{width:o,height:l},this._scene,!1,!0,s),this._blurTexture2.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(t.Texture.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new t.BlurPostProcess("GlowLayerHBP1",new t.Vector2(1,0),this._options.blurKernelSize/2,{width:a,height:n},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,s),this._horizontalBlurPostprocess1.width=a,this._horizontalBlurPostprocess1.height=n,this._horizontalBlurPostprocess1.onApplyObservable.add(function(u){u.setTexture("textureSampler",i._mainTexture)}),this._verticalBlurPostprocess1=new t.BlurPostProcess("GlowLayerVBP1",new t.Vector2(0,1),this._options.blurKernelSize/2,{width:a,height:n},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,s),this._horizontalBlurPostprocess2=new t.BlurPostProcess("GlowLayerHBP2",new t.Vector2(1,0),this._options.blurKernelSize/2,{width:o,height:l},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,s),this._horizontalBlurPostprocess2.width=o,this._horizontalBlurPostprocess2.height=l,this._horizontalBlurPostprocess2.onApplyObservable.add(function(u){u.setTexture("textureSampler",i._blurTexture1)}),this._verticalBlurPostprocess2=new t.BlurPostProcess("GlowLayerVBP2",new t.Vector2(0,1),this._options.blurKernelSize/2,{width:o,height:l},null,t.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,s),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var u=i._blurTexture1.getInternalTexture();u&&(i._scene.postProcessManager.directRender(i._postProcesses1,u,!0),u=i._blurTexture2.getInternalTexture(),u&&i._scene.postProcessManager.directRender(i._postProcesses2,u,!0))}),this._postProcesses.map(function(u){u.autoClear=!1})},r.prototype.isReady=function(i,a){var n=i.getMaterial(),s=i.getRenderingMesh();if(!n||!s)return!1;var o=n.emissiveTexture;return c.prototype._isReady.call(this,i,a,o)},r.prototype.needStencil=function(){return!1},r.prototype._internalRender=function(i){i.setTexture("textureSampler",this._blurTexture1),i.setTexture("textureSampler2",this._blurTexture2),i.setFloat("offset",this._intensity);var a=this._engine,n=a.getStencilBuffer();a.setStencilBuffer(!1),a.drawElementsType(t.Material.TriangleFillMode,0,6),a.setStencilBuffer(n)},r.prototype._setEmissiveTextureAndColor=function(i,a,n){var s=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(i,a,n):n?(this._emissiveTextureAndColor.texture=n.emissiveTexture,this._emissiveTextureAndColor.texture&&(s=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(i,a,n,this._emissiveTextureAndColor.color):n.emissiveColor?this._emissiveTextureAndColor.color.set(n.emissiveColor.r*s,n.emissiveColor.g*s,n.emissiveColor.b*s,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},r.prototype._shouldRenderMesh=function(i){return this.hasMesh(i)},r.prototype.addExcludedMesh=function(i){this._excludedMeshes.indexOf(i.uniqueId)===-1&&this._excludedMeshes.push(i.uniqueId)},r.prototype.removeExcludedMesh=function(i){var a=this._excludedMeshes.indexOf(i.uniqueId);a!==-1&&this._excludedMeshes.splice(a,1)},r.prototype.addIncludedOnlyMesh=function(i){this._includedOnlyMeshes.indexOf(i.uniqueId)===-1&&this._includedOnlyMeshes.push(i.uniqueId)},r.prototype.removeIncludedOnlyMesh=function(i){var a=this._includedOnlyMeshes.indexOf(i.uniqueId);a!==-1&&this._includedOnlyMeshes.splice(a,1)},r.prototype.hasMesh=function(i){return c.prototype.hasMesh.call(this,i)?this._includedOnlyMeshes.length?this._includedOnlyMeshes.indexOf(i.uniqueId)!==-1:this._excludedMeshes.length?this._excludedMeshes.indexOf(i.uniqueId)===-1:!0:!1},r.prototype._disposeMesh=function(i){this.removeIncludedOnlyMesh(i),this.removeExcludedMesh(i)},r.prototype.getClassName=function(){return"GlowLayer"},r.prototype.serialize=function(){var i=t.SerializationHelper.Serialize(this);i.customType="BABYLON.GlowLayer";var a;if(i.includedMeshes=[],this._includedOnlyMeshes.length)for(a=0;a<this._includedOnlyMeshes.length;a++){var n=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[a]);n&&i.includedMeshes.push(n.id)}if(i.excludedMeshes=[],this._excludedMeshes.length)for(a=0;a<this._excludedMeshes.length;a++){var n=this._scene.getMeshByUniqueID(this._excludedMeshes[a]);n&&i.excludedMeshes.push(n.id)}return i},r.Parse=function(i,a,n){var s=t.SerializationHelper.Parse(function(){return new r(i.name,a,i.options)},i,a,n),o;for(o=0;o<i.excludedMeshes.length;o++){var l=a.getMeshByID(i.excludedMeshes[o]);l&&s.addExcludedMesh(l)}for(o=0;o<i.includedMeshes.length;o++){var l=a.getMeshByID(i.includedMeshes[o]);l&&s.addIncludedOnlyMesh(l)}return s},r.EffectName="GlowLayer",r.DefaultBlurKernelSize=32,r.DefaultTextureRatio=.5,A([t.serialize()],r.prototype,"blurKernelSize",null),A([t.serialize()],r.prototype,"intensity",null),A([t.serialize("options")],r.prototype,"_options",void 0),r}(t.EffectLayer);t.GlowLayer=f})(T||(T={}));var T;(function(t){var f;(function(d){d[d.INIT=0]="INIT",d[d.RUNNING=1]="RUNNING",d[d.DONE=2]="DONE",d[d.ERROR=3]="ERROR"})(f=t.AssetTaskState||(t.AssetTaskState={}));var c=function(){function d(p){this.name=p,this._isCompleted=!1,this._taskState=f.INIT}return Object.defineProperty(d.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),d.prototype._setErrorObject=function(p,m){this._errorObject||(this._errorObject={message:p,exception:m})},d.prototype.run=function(p,m,_){var v=this;this._taskState=f.RUNNING,this.runTask(p,function(){v.onDoneCallback(m,_)},function(S,P){v.onErrorCallback(_,S,P)})},d.prototype.runTask=function(p,m,_){throw new Error("runTask is not implemented")},d.prototype.reset=function(){this._taskState=f.INIT},d.prototype.onErrorCallback=function(p,m,_){this._taskState=f.ERROR,this._errorObject={message:m,exception:_},this.onError&&this.onError(this,m,_),p()},d.prototype.onDoneCallback=function(p,m){try{this._taskState=f.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),p()}catch(_){this.onErrorCallback(m,"Task is done, error executing success callback(s)",_)}},d}();t.AbstractAssetTask=c;var r=function(){function d(p,m,_){this.remainingCount=p,this.totalCount=m,this.task=_}return d}();t.AssetsProgressEvent=r;var i=function(d){N(p,d);function p(m,_,v,S){var P=d.call(this,m)||this;return P.name=m,P.meshesNames=_,P.rootUrl=v,P.sceneFilename=S,P}return p.prototype.runTask=function(m,_,v){var S=this;t.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,m,function(P,x,R){S.loadedMeshes=P,S.loadedParticleSystems=x,S.loadedSkeletons=R,_()},null,function(P,x,R){v(x,R)})},p}(c);t.MeshAssetTask=i;var a=function(d){N(p,d);function p(m,_){var v=d.call(this,m)||this;return v.name=m,v.url=_,v}return p.prototype.runTask=function(m,_,v){var S=this;m._loadFile(this.url,function(P){S.text=P,_()},void 0,!1,!1,function(P,x){P&&v(P.status+" "+P.statusText,x)})},p}(c);t.TextFileAssetTask=a;var n=function(d){N(p,d);function p(m,_){var v=d.call(this,m)||this;return v.name=m,v.url=_,v}return p.prototype.runTask=function(m,_,v){var S=this;m._loadFile(this.url,function(P){S.data=P,_()},void 0,!0,!0,function(P,x){P&&v(P.status+" "+P.statusText,x)})},p}(c);t.BinaryFileAssetTask=n;var s=function(d){N(p,d);function p(m,_){var v=d.call(this,m)||this;return v.name=m,v.url=_,v}return p.prototype.runTask=function(m,_,v){var S=this,P=new Image;t.Tools.SetCorsBehavior(this.url,P),P.onload=function(){S.image=P,_()},P.onerror=function(x){v("Error loading image",x)},P.src=this.url},p}(c);t.ImageAssetTask=s;var o=function(d){N(p,d);function p(m,_,v,S,P){P===void 0&&(P=t.Texture.TRILINEAR_SAMPLINGMODE);var x=d.call(this,m)||this;return x.name=m,x.url=_,x.noMipmap=v,x.invertY=S,x.samplingMode=P,x}return p.prototype.runTask=function(m,_,v){var S=function(){_()},P=function(x,R){v(x,R)};this.texture=new t.Texture(this.url,m,this.noMipmap,this.invertY,this.samplingMode,S,P)},p}(c);t.TextureAssetTask=o;var l=function(d){N(p,d);function p(m,_,v,S,P){var x=d.call(this,m)||this;return x.name=m,x.url=_,x.extensions=v,x.noMipmap=S,x.files=P,x}return p.prototype.runTask=function(m,_,v){var S=function(){_()},P=function(x,R){v(x,R)};this.texture=new t.CubeTexture(this.url,m,this.extensions,this.noMipmap,this.files,S,P)},p}(c);t.CubeTextureAssetTask=l;var u=function(d){N(p,d);function p(m,_,v,S,P,x,R){S===void 0&&(S=!1),P===void 0&&(P=!0),x===void 0&&(x=!1),R===void 0&&(R=!1);var w=d.call(this,m)||this;return w.name=m,w.url=_,w.size=v,w.noMipmap=S,w.generateHarmonics=P,w.gammaSpace=x,w.reserved=R,w}return p.prototype.run=function(m,_,v){var S=function(){_()},P=function(x,R){v(x,R)};this.texture=new t.HDRCubeTexture(this.url,m,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,S,P)},p}(c);t.HDRCubeTextureAssetTask=u;var h=function(){function d(p){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new t.Observable,this.onTaskErrorObservable=new t.Observable,this.onTasksDoneObservable=new t.Observable,this.onProgressObservable=new t.Observable,this.useDefaultLoadingScreen=!0,this._scene=p}return d.prototype.addMeshTask=function(p,m,_,v){var S=new i(p,m,_,v);return this._tasks.push(S),S},d.prototype.addTextFileTask=function(p,m){var _=new a(p,m);return this._tasks.push(_),_},d.prototype.addBinaryFileTask=function(p,m){var _=new n(p,m);return this._tasks.push(_),_},d.prototype.addImageTask=function(p,m){var _=new s(p,m);return this._tasks.push(_),_},d.prototype.addTextureTask=function(p,m,_,v,S){S===void 0&&(S=t.Texture.TRILINEAR_SAMPLINGMODE);var P=new o(p,m,_,v,S);return this._tasks.push(P),P},d.prototype.addCubeTextureTask=function(p,m,_,v,S){var P=new l(p,m,_,v,S);return this._tasks.push(P),P},d.prototype.addHDRCubeTextureTask=function(p,m,_,v,S,P,x){v===void 0&&(v=!1),S===void 0&&(S=!0),P===void 0&&(P=!1),x===void 0&&(x=!1);var R=new u(p,m,_,v,S,P,x);return this._tasks.push(R),R},d.prototype.removeTask=function(p){var m=this._tasks.indexOf(p);m>-1&&this._tasks.splice(m,1)},d.prototype._decreaseWaitingTasksCount=function(p){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,p),this.onProgressObservable.notifyObservers(new r(this._waitingTasksCount,this._totalTasksCount,p))}catch(P){t.Tools.Error("Error running progress callbacks."),console.log(P)}if(this._waitingTasksCount===0){try{this.onFinish&&this.onFinish(this._tasks);for(var m=this._tasks.slice(),_=0,v=m;_<v.length;_++){var p=v[_];if(p.taskState===f.DONE){var S=this._tasks.indexOf(p);S>-1&&this._tasks.splice(S,1)}}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(P){t.Tools.Error("Error running tasks-done callbacks."),console.log(P)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},d.prototype._runTask=function(p){var m=this,_=function(){try{m.onTaskSuccess&&m.onTaskSuccess(p),m.onTaskSuccessObservable.notifyObservers(p),m._decreaseWaitingTasksCount(p)}catch(S){v("Error executing task success callbacks",S)}},v=function(S,P){p._setErrorObject(S,P),m.onTaskError&&m.onTaskError(p),m.onTaskErrorObservable.notifyObservers(p),m._decreaseWaitingTasksCount(p)};p.run(this._scene,_,v)},d.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},d.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,this._waitingTasksCount===0)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var p=0;p<this._tasks.length;p++){var m=this._tasks[p];m.taskState===f.INIT&&this._runTask(m)}return this},d}();t.AssetsManager=h})(T||(T={}));var T;(function(t){var f=[],c=function(n,s){if(!f[n.id]&&!n.doNotSerialize){if(n instanceof t.BoxGeometry)s.boxes.push(n.serialize());else if(n instanceof t.SphereGeometry)s.spheres.push(n.serialize());else if(n instanceof t.CylinderGeometry)s.cylinders.push(n.serialize());else if(n instanceof t.TorusGeometry)s.toruses.push(n.serialize());else if(n instanceof t.GroundGeometry)s.grounds.push(n.serialize());else if(n instanceof t.Plane)s.planes.push(n.serialize());else if(n instanceof t.TorusKnotGeometry)s.torusKnots.push(n.serialize());else{if(n instanceof t._PrimitiveGeometry)throw new Error("Unknown primitive type");s.vertexData.push(n.serializeVerticeData())}f[n.id]=!0}},r=function(n,s){var o={},l=n._geometry;return l&&(n.getScene().getGeometryByID(l.id)||c(l,s.geometries)),n.serialize&&n.serialize(o),o},i=function(n,s){if(n.delayLoadState===t.Engine.DELAYLOADSTATE_LOADED||n.delayLoadState===t.Engine.DELAYLOADSTATE_NONE){if(n.material)if(n.material instanceof t.MultiMaterial){if(s.multiMaterials=s.multiMaterials||[],s.materials=s.materials||[],!s.multiMaterials.some(function(p){return p.id===n.material.id})){s.multiMaterials.push(n.material.serialize());for(var o=function(p){p&&(s.materials.some(function(m){return m.id===p.id})||s.materials.push(p.serialize()))},l=0,u=n.material.subMaterials;l<u.length;l++){var h=u[l];o(h)}}}else s.materials=s.materials||[],s.materials.some(function(p){return p.id===n.material.id})||s.materials.push(n.material.serialize());var d=n._geometry;d&&(s.geometries||(s.geometries={},s.geometries.boxes=[],s.geometries.spheres=[],s.geometries.cylinders=[],s.geometries.toruses=[],s.geometries.grounds=[],s.geometries.planes=[],s.geometries.torusKnots=[],s.geometries.vertexData=[]),c(d,s.geometries)),n.skeleton&&(s.skeletons=s.skeletons||[],s.skeletons.push(n.skeleton.serialize())),s.meshes=s.meshes||[],s.meshes.push(r(n,s))}},a=function(){function n(){}return n.ClearCache=function(){f=[]},n.Serialize=function(s){var o={};if(n.ClearCache(),o.useDelayedTextureLoading=s.useDelayedTextureLoading,o.autoClear=s.autoClear,o.clearColor=s.clearColor.asArray(),o.ambientColor=s.ambientColor.asArray(),o.gravity=s.gravity.asArray(),o.collisionsEnabled=s.collisionsEnabled,o.workerCollisions=s.workerCollisions,s.fogMode&&s.fogMode!==0&&(o.fogMode=s.fogMode,o.fogColor=s.fogColor.asArray(),o.fogStart=s.fogStart,o.fogEnd=s.fogEnd,o.fogDensity=s.fogDensity),s.isPhysicsEnabled()){var l=s.getPhysicsEngine();l&&(o.physicsEnabled=!0,o.physicsGravity=l.gravity.asArray(),o.physicsEngine=l.getPhysicsPluginName())}s.metadata&&(o.metadata=s.metadata),o.morphTargetManagers=[];for(var u=0,h=s.meshes;u<h.length;u++){var d=h[u],p=d.morphTargetManager;p&&o.morphTargetManagers.push(p.serialize())}o.lights=[];var m,_;for(m=0;m<s.lights.length;m++)_=s.lights[m],_.doNotSerialize||o.lights.push(_.serialize());for(o.cameras=[],m=0;m<s.cameras.length;m++){var v=s.cameras[m];v.doNotSerialize||o.cameras.push(v.serialize())}s.activeCamera&&(o.activeCameraID=s.activeCamera.id),t.Animation.AppendSerializedAnimations(s,o),o.materials=[],o.multiMaterials=[];var S;for(m=0;m<s.materials.length;m++)S=s.materials[m],S.doNotSerialize||o.materials.push(S.serialize());for(o.multiMaterials=[],m=0;m<s.multiMaterials.length;m++){var P=s.multiMaterials[m];o.multiMaterials.push(P.serialize())}for(s.environmentTexture&&(o.environmentTexture=s.environmentTexture.name),o.skeletons=[],m=0;m<s.skeletons.length;m++){var x=s.skeletons[m];x.doNotSerialize||o.skeletons.push(x.serialize())}for(o.transformNodes=[],m=0;m<s.transformNodes.length;m++)o.transformNodes.push(s.transformNodes[m].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],f=[];var R=s.getGeometries();for(m=0;m<R.length;m++){var w=R[m];w.isReady()&&c(w,o.geometries)}for(o.meshes=[],m=0;m<s.meshes.length;m++){var d=s.meshes[m];if(d instanceof t.Mesh){var I=d;I.doNotSerialize||(I.delayLoadState===t.Engine.DELAYLOADSTATE_LOADED||I.delayLoadState===t.Engine.DELAYLOADSTATE_NONE)&&o.meshes.push(r(I,o))}}for(o.particleSystems=[],m=0;m<s.particleSystems.length;m++)o.particleSystems.push(s.particleSystems[m].serialize());s.actionManager&&(o.actions=s.actionManager.serialize("scene"));for(var F=0,k=s._serializableComponents;F<k.length;F++){var E=k[F];E.serialize(o)}return o},n.SerializeMesh=function(s,o,l){o===void 0&&(o=!1),l===void 0&&(l=!1);var u={};if(n.ClearCache(),s=s instanceof Array?s:[s],o||l)for(var h=0;h<s.length;++h)l&&s[h].getDescendants().forEach(function(d){d instanceof t.Mesh&&s.indexOf(d)<0&&s.push(d)}),o&&s[h].parent&&s.indexOf(s[h].parent)<0&&s.push(s[h].parent);return s.forEach(function(d){i(d,u)}),u},n}();t.SceneSerializer=a})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s){n===void 0&&(n=!0),s===void 0&&(s=!1);var o=this;this.name=r,this._viewMatrix=t.Matrix.Identity(),this._target=t.Vector3.Zero(),this._add=t.Vector3.Zero(),this._invertYAxis=!1,this.position=t.Vector3.Zero(),this._scene=a,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new t.RenderTargetTexture(r,i,a,n,!0,s?t.Engine.TEXTURETYPE_FLOAT:t.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(l){switch(l){case 0:o._add.copyFromFloats(1,0,0);break;case 1:o._add.copyFromFloats(-1,0,0);break;case 2:o._add.copyFromFloats(0,o._invertYAxis?1:-1,0);break;case 3:o._add.copyFromFloats(0,o._invertYAxis?-1:1,0);break;case 4:o._add.copyFromFloats(0,0,1);break;case 5:o._add.copyFromFloats(0,0,-1);break}o._attachedMesh&&o.position.copyFrom(o._attachedMesh.getAbsolutePosition()),o.position.addToRef(o._add,o._target),t.Matrix.LookAtLHToRef(o.position,o._target,t.Vector3.Up(),o._viewMatrix),a.setTransformMatrix(o._viewMatrix,o._projectionMatrix),a._forcedViewPosition=o.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){a._forcedViewPosition=null,a.updateTransformMatrix(!0)}),a.activeCamera&&(this._projectionMatrix=t.Matrix.PerspectiveFovLH(Math.PI/2,1,a.activeCamera.minZ,a.activeCamera.maxZ))}return Object.defineProperty(c.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(r){this._renderTargetTexture.samples=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(r){this._renderTargetTexture.refreshRate=r},enumerable:!0,configurable:!0}),c.prototype.getScene=function(){return this._scene},Object.defineProperty(c.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),c.prototype.attachToMesh=function(r){this._attachedMesh=r},c.prototype.setRenderingAutoClearDepthStencil=function(r,i){this._renderTargetTexture.setRenderingAutoClearDepthStencil(r,i)},c.prototype.dispose=function(){var r=this._scene.reflectionProbes.indexOf(this);r!==-1&&this._scene.reflectionProbes.splice(r,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},c}();t.ReflectionProbe=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.name=t.SceneComponentConstants.NAME_LAYER,this.scene=r,this._engine=r.getEngine(),r.layers=new Array}return c.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER,this,this._drawBackground),this.scene._afterCameraDrawStage.registerStep(t.SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER,this,this._drawForeground)},c.prototype.rebuild=function(){for(var r=this.scene.layers,i=0,a=r;i<a.length;i++){var n=a[i];n._rebuild()}},c.prototype.dispose=function(){for(var r=this.scene.layers;r.length;)r[0].dispose()},c.prototype._draw=function(r,i){var a=this.scene.layers;if(a.length){this._engine.setDepthBuffer(!1);for(var n=r.layerMask,s=0,o=a;s<o.length;s++){var l=o[s];l.isBackground===i&&l.layerMask&n&&l.render()}this._engine.setDepthBuffer(!0)}},c.prototype._drawBackground=function(r){this._draw(r,!0)},c.prototype._drawForeground=function(r){this._draw(r,!1)},c}();t.LayerSceneComponent=f})(T||(T={}));var T;(function(t){var f=function(){function c(r,i,a,n,s){this.name=r,this.scale=new t.Vector2(1,1),this.offset=new t.Vector2(0,0),this.alphaBlendingMode=t.Engine.ALPHA_COMBINE,this.layerMask=268435455,this._vertexBuffers={},this.onDisposeObservable=new t.Observable,this.onBeforeRenderObservable=new t.Observable,this.onAfterRenderObservable=new t.Observable,this.texture=i?new t.Texture(i,a,!0):null,this.isBackground=n===void 0?!0:n,this.color=s===void 0?new t.Color4(1,1,1,1):s,this._scene=a||t.Engine.LastCreatedScene;var o=this._scene._getComponent(t.SceneComponentConstants.NAME_LAYER);o||(o=new t.LayerSceneComponent(this._scene),this._scene._addComponent(o)),this._scene.layers.push(this);var l=this._scene.getEngine(),u=[];u.push(1,1),u.push(-1,1),u.push(-1,-1),u.push(1,-1);var h=new t.VertexBuffer(l,u,t.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[t.VertexBuffer.PositionKind]=h,this._createIndexBuffer(),this._effect=l.createEffect("layer",[t.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=l.createEffect("layer",[t.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(c.prototype,"onDispose",{set:function(r){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBeforeRender",{set:function(r){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(r)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterRender",{set:function(r){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(r)},enumerable:!0,configurable:!0}),c.prototype._createIndexBuffer=function(){var r=this._scene.getEngine(),i=[];i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),this._indexBuffer=r.createIndexBuffer(i)},c.prototype._rebuild=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&r._rebuild(),this._createIndexBuffer()},c.prototype.render=function(){var r=this.alphaTest?this._alphaTestEffect:this._effect;if(!(!r.isReady()||!this.texture||!this.texture.isReady())){var i=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),i.enableEffect(r),i.setState(!1),r.setTexture("textureSampler",this.texture),r.setMatrix("textureMatrix",this.texture.getTextureMatrix()),r.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),r.setVector2("offset",this.offset),r.setVector2("scale",this.scale),i.bindBuffers(this._vertexBuffers,this._indexBuffer,r),this.alphaTest?i.drawElementsType(t.Material.TriangleFillMode,0,6):(i.setAlphaMode(this.alphaBlendingMode),i.drawElementsType(t.Material.TriangleFillMode,0,6),i.setAlphaMode(t.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},c.prototype.dispose=function(){var r=this._vertexBuffers[t.VertexBuffer.PositionKind];r&&(r.dispose(),this._vertexBuffers[t.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var i=this._scene.layers.indexOf(this);this._scene.layers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},c}();t.Layer=f})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.CreateResizedCopy=function(r,i,a,n){n===void 0&&(n=!0);var s=r.getScene(),o=s.getEngine(),l=new t.RenderTargetTexture("resized"+r.name,{width:i,height:a},s,!r.noMipmap,!0,r._texture.type,!1,r._samplingMode,!1);l.wrapU=r.wrapU,l.wrapV=r.wrapV,l.uOffset=r.uOffset,l.vOffset=r.vOffset,l.uScale=r.uScale,l.vScale=r.vScale,l.uAng=r.uAng,l.vAng=r.vAng,l.wAng=r.wAng,l.coordinatesIndex=r.coordinatesIndex,l.level=r.level,l.anisotropicFilteringLevel=r.anisotropicFilteringLevel,l._texture.isReady=!1,r.wrapU=t.Texture.CLAMP_ADDRESSMODE,r.wrapV=t.Texture.CLAMP_ADDRESSMODE;var u=new t.PassPostProcess("pass",1,null,n?t.Texture.BILINEAR_SAMPLINGMODE:t.Texture.NEAREST_SAMPLINGMODE,o,!1,t.Engine.TEXTURETYPE_UNSIGNED_INT);return u.getEffect().executeWhenCompiled(function(){u.onApply=function(d){d.setTexture("textureSampler",r)};var h=l.getInternalTexture();h&&(s.postProcessManager.directRender([u],h),o.unBindFramebuffer(h),l.disposeFramebufferObjects(),u.dispose(),h.isReady=!0)}),l},c.GetEnvironmentBRDFTexture=function(r){if(!r._environmentBRDFTexture){var i=t.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",r,!0,!1,t.Texture.BILINEAR_SAMPLINGMODE);i.wrapU=t.Texture.CLAMP_ADDRESSMODE,i.wrapV=t.Texture.CLAMP_ADDRESSMODE,r._environmentBRDFTexture=i}return r._environmentBRDFTexture},c._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",c}();t.TextureTools=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._mode=c.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(c.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mode",{get:function(){return this._mode},set:function(r){this._mode=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(r){this._radiusScale=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"positionScale",{get:function(){return this._positionScale},set:function(r){this._positionScale=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(r){this._defaultElevation=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(r){this._elevationReturnTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(r){this._elevationReturnWaitTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(r){this._zoomStopsAnimation=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"framingTime",{get:function(){return this._framingTime},set:function(r){this._framingTime=r},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){var i=this;this._attachedCamera=r;var a=this._attachedCamera.getScene();c.EasingFunction.setEasingMode(c.EasingMode),this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(n){if(n.type===t.PointerEventTypes.POINTERDOWN){i._isPointerDown=!0;return}n.type===t.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1)}),this._onMeshTargetChangedObserver=r.onMeshTargetChangedObservable.add(function(n){n&&i.zoomOnMesh(n)}),this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add(function(){i._applyUserInteraction(),i._maintainCameraAboveGround()})},c.prototype.detach=function(){if(this._attachedCamera){var r=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&r.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},c.prototype.zoomOnMesh=function(r,i,a){i===void 0&&(i=!1),a===void 0&&(a=null),r.computeWorldMatrix(!0);var n=r.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,i,a)},c.prototype.zoomOnMeshHierarchy=function(r,i,a){i===void 0&&(i=!1),a===void 0&&(a=null),r.computeWorldMatrix(!0);var n=r.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,i,a)},c.prototype.zoomOnMeshesHierarchy=function(r,i,a){i===void 0&&(i=!1),a===void 0&&(a=null);for(var n=new t.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new t.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=0;o<r.length;o++){var l=r[o].getHierarchyBoundingVectors(!0);t.Tools.CheckExtends(l.min,n,s),t.Tools.CheckExtends(l.max,n,s)}this.zoomOnBoundingInfo(n,s,i,a)},c.prototype.zoomOnBoundingInfo=function(r,i,a,n){var s=this;a===void 0&&(a=!1),n===void 0&&(n=null);var o;if(this._attachedCamera){var l=r.y,u=i.y,h=l+(u-l)*this._positionScale,d=i.subtract(r).scale(.5);if(a)o=new t.Vector3(0,h,0);else{var p=r.add(d);o=new t.Vector3(p.x,h,p.z)}this._vectorTransition||(this._vectorTransition=t.Animation.CreateAnimation("target",t.Animation.ANIMATIONTYPE_VECTOR3,60,c.EasingFunction)),this._betaIsAnimating=!0;var m=t.Animation.TransitionTo("target",o,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);m&&this._animatables.push(m);var _=0;if(this._mode===c.FitFrustumSidesMode){var v=this._calculateLowerRadiusFromModelBoundingSphere(r,i);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=d.length()+this._attachedCamera.minZ),_=v}else this._mode===c.IgnoreBoundsSizeMode&&(_=this._calculateLowerRadiusFromModelBoundingSphere(r,i),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var S=i.subtract(r).length();this._attachedCamera.panningSensibility=5e3/S,this._attachedCamera.wheelPrecision=100/_}this._radiusTransition||(this._radiusTransition=t.Animation.CreateAnimation("radius",t.Animation.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),m=t.Animation.TransitionTo("radius",_,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){s.stopAllAnimations(),n&&n(),s._attachedCamera&&s._attachedCamera.useInputToRestoreState&&s._attachedCamera.storeState()}),m&&this._animatables.push(m)}},c.prototype._calculateLowerRadiusFromModelBoundingSphere=function(r,i){var a=i.subtract(r),n=a.length(),s=this._getFrustumSlope(),o=n*.5,l=o*this._radiusScale,u=l*Math.sqrt(1+1/(s.x*s.x)),h=l*Math.sqrt(1+1/(s.y*s.y)),d=Math.max(u,h),p=this._attachedCamera;return p?(p.lowerRadiusLimit&&this._mode===c.IgnoreBoundsSizeMode&&(d=d<p.lowerRadiusLimit?p.lowerRadiusLimit:d),p.upperRadiusLimit&&(d=d>p.upperRadiusLimit?p.upperRadiusLimit:d),d):0},c.prototype._maintainCameraAboveGround=function(){var r=this;if(!(this._elevationReturnTime<0)){var i=t.Tools.Now-this._lastInteractionTime,a=Math.PI*.5-this._defaultElevation,n=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&i>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=t.Animation.CreateAnimation("beta",t.Animation.ANIMATIONTYPE_FLOAT,60,c.EasingFunction));var s=t.Animation.TransitionTo("beta",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){r._clearAnimationLocks(),r.stopAllAnimations()});s&&this._animatables.push(s)}}},c.prototype._getFrustumSlope=function(){var r=this._attachedCamera;if(!r)return t.Vector2.Zero();var i=r.getScene().getEngine(),a=i.getAspectRatio(r),n=Math.tan(r.fov/2),s=n*a;return new t.Vector2(s,n)},c.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},c.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=t.Tools.Now,this.stopAllAnimations(),this._clearAnimationLocks())},c.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(c.prototype,"isUserIsMoving",{get:function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},enumerable:!0,configurable:!0}),c.EasingFunction=new t.ExponentialEase,c.EasingMode=t.EasingFunction.EASINGMODE_EASEINOUT,c.IgnoreBoundsSizeMode=0,c.FitFrustumSidesMode=1,c}();t.FramingBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(c.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(r){var i=this;if(this._autoTransitionRange!==r){this._autoTransitionRange=r;var a=this._attachedCamera;a&&(r?this._onMeshTargetChangedObserver=a.onMeshTargetChangedObservable.add(function(n){if(n){n.computeWorldMatrix(!0);var s=n.getBoundingInfo().diagonalLength;i.lowerRadiusTransitionRange=s*.05,i.upperRadiusTransitionRange=s*.05}}):this._onMeshTargetChangedObserver&&a.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){var i=this;this._attachedCamera=r,this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add(function(){i._attachedCamera&&(i._isRadiusAtLimit(i._attachedCamera.lowerRadiusLimit)&&i._applyBoundRadiusAnimation(i.lowerRadiusTransitionRange),i._isRadiusAtLimit(i._attachedCamera.upperRadiusLimit)&&i._applyBoundRadiusAnimation(i.upperRadiusTransitionRange))})},c.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},c.prototype._isRadiusAtLimit=function(r){return this._attachedCamera?this._attachedCamera.radius===r&&!this._radiusIsAnimating:!1},c.prototype._applyBoundRadiusAnimation=function(r){var i=this;if(this._attachedCamera){this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=t.Animation.CreateAnimation("radius",t.Animation.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var a=t.Animation.TransitionTo("radius",this._attachedCamera.radius+r,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return i._clearAnimationLocks()});a&&this._animatables.push(a)}},c.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},c.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},c.EasingFunction=new t.BackEase(.3),c.EasingMode=t.EasingFunction.EASINGMODE_EASEOUT,c}();t.BouncingBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(c.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(r){this._zoomStopsAnimation=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(r){this._idleRotationSpeed=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(r){this._idleRotationWaitTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(r){this._idleRotationSpinupTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),c.prototype.init=function(){},c.prototype.attach=function(r){var i=this;this._attachedCamera=r;var a=this._attachedCamera.getScene();this._onPrePointerObservableObserver=a.onPrePointerObservable.add(function(n){if(n.type===t.PointerEventTypes.POINTERDOWN){i._isPointerDown=!0;return}n.type===t.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1)}),this._onAfterCheckInputsObserver=r.onAfterCheckInputsObservable.add(function(){var n=t.Tools.Now,s=0;i._lastFrameTime!=null&&(s=n-i._lastFrameTime),i._lastFrameTime=n,i._applyUserInteraction();var o=n-i._lastInteractionTime-i._idleRotationWaitTime,l=Math.max(Math.min(o/i._idleRotationSpinupTime,1),0);i._cameraRotationSpeed=i._idleRotationSpeed*l,i._attachedCamera&&(i._attachedCamera.alpha-=i._cameraRotationSpeed*(s/1e3))})},c.prototype.detach=function(){if(this._attachedCamera){var r=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&r.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},c.prototype._userIsZooming=function(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1},c.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var r=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(r=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?r:this._userIsZooming()},c.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=t.Tools.Now)},c.prototype._userIsMoving=function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},c}();t.AutoRotationBehavior=f})(T||(T={}));var T;(function(t){var f=function(){function r(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4}return r}();t.NullEngineOptions=f;var c=function(r){N(i,r);function i(a){a===void 0&&(a=new f);var n=r.call(this,null)||this;return a.deterministicLockstep===void 0&&(a.deterministicLockstep=!1),a.lockstepMaxSteps===void 0&&(a.lockstepMaxSteps=4),n._options=a,n._caps=new t.EngineCapabilities,n._caps.maxTexturesImageUnits=16,n._caps.maxVertexTextureImageUnits=16,n._caps.maxTextureSize=512,n._caps.maxCubemapTextureSize=512,n._caps.maxRenderTextureSize=512,n._caps.maxVertexAttribs=16,n._caps.maxVaryingVectors=16,n._caps.maxFragmentUniformVectors=16,n._caps.maxVertexUniformVectors=16,n._caps.standardDerivatives=!1,n._caps.astc=null,n._caps.s3tc=null,n._caps.pvrtc=null,n._caps.etc1=null,n._caps.etc2=null,n._caps.textureAnisotropicFilterExtension=null,n._caps.maxAnisotropy=0,n._caps.uintIndices=!1,n._caps.fragmentDepthSupported=!1,n._caps.highPrecisionShaderSupported=!0,n._caps.colorBufferFloat=!1,n._caps.textureFloat=!1,n._caps.textureFloatLinearFiltering=!1,n._caps.textureFloatRender=!1,n._caps.textureHalfFloat=!1,n._caps.textureHalfFloatLinearFiltering=!1,n._caps.textureHalfFloatRender=!1,n._caps.textureLOD=!1,n._caps.drawBuffersExtension=!1,n._caps.depthTextureExtension=!1,n._caps.vertexArrayObject=!1,n._caps.instancedArrays=!1,t.Tools.Log("Babylon.js null engine (v"+t.Engine.Version+") launched"),typeof URL>"u"&&(URL={createObjectURL:function(){},revokeObjectURL:function(){}}),typeof Blob>"u"&&(Blob=function(){}),n}return i.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},i.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},i.prototype.getHardwareScalingLevel=function(){return 1},i.prototype.createVertexBuffer=function(a){return{capacity:0,references:1,is32Bits:!1}},i.prototype.createIndexBuffer=function(a){return{capacity:0,references:1,is32Bits:!1}},i.prototype.clear=function(a,n,s,o){o===void 0&&(o=!1)},i.prototype.getRenderWidth=function(a){return a===void 0&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},i.prototype.getRenderHeight=function(a){return a===void 0&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},i.prototype.setViewport=function(a,n,s){this._cachedViewport=a},i.prototype.createShaderProgram=function(a,n,s,o){return{transformFeedback:null,__SPECTOR_rebuildProgram:null}},i.prototype.getUniforms=function(a,n){return[]},i.prototype.getAttributes=function(a,n){return[]},i.prototype.bindSamplers=function(a){this._currentEffect=null},i.prototype.enableEffect=function(a){this._currentEffect=a,a.onBind&&a.onBind(a),a._onBindObservable&&a._onBindObservable.notifyObservers(a)},i.prototype.setState=function(a,n,s,o){n===void 0&&(n=0),o===void 0&&(o=!1)},i.prototype.setIntArray=function(a,n){},i.prototype.setIntArray2=function(a,n){},i.prototype.setIntArray3=function(a,n){},i.prototype.setIntArray4=function(a,n){},i.prototype.setFloatArray=function(a,n){},i.prototype.setFloatArray2=function(a,n){},i.prototype.setFloatArray3=function(a,n){},i.prototype.setFloatArray4=function(a,n){},i.prototype.setArray=function(a,n){},i.prototype.setArray2=function(a,n){},i.prototype.setArray3=function(a,n){},i.prototype.setArray4=function(a,n){},i.prototype.setMatrices=function(a,n){},i.prototype.setMatrix=function(a,n){},i.prototype.setMatrix3x3=function(a,n){},i.prototype.setMatrix2x2=function(a,n){},i.prototype.setFloat=function(a,n){},i.prototype.setFloat2=function(a,n,s){},i.prototype.setFloat3=function(a,n,s,o){},i.prototype.setBool=function(a,n){},i.prototype.setFloat4=function(a,n,s,o,l){},i.prototype.setColor3=function(a,n){},i.prototype.setColor4=function(a,n,s){},i.prototype.setAlphaMode=function(a,n){n===void 0&&(n=!1),this._alphaMode!==a&&(this._alphaState.alphaBlend=a!==t.Engine.ALPHA_DISABLE,n||this.setDepthWrite(a===t.Engine.ALPHA_DISABLE),this._alphaMode=a)},i.prototype.bindBuffers=function(a,n,s){},i.prototype.wipeCaches=function(a){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,a&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},i.prototype.draw=function(a,n,s,o){},i.prototype.drawElementsType=function(a,n,s,o){},i.prototype.drawArraysType=function(a,n,s,o){},i.prototype._createTexture=function(){return{}},i.prototype._releaseTexture=function(a){},i.prototype.createTexture=function(a,n,s,o,l,u,h,d,p,m){l===void 0&&(l=t.Texture.TRILINEAR_SAMPLINGMODE),u===void 0&&(u=null),h===void 0&&(h=null),d===void 0&&(d=null);var _=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_URL),v=String(a);return _.url=v,_.generateMipMaps=!n,_.samplingMode=l,_.invertY=s,_.baseWidth=this._options.textureSize,_.baseHeight=this._options.textureSize,_.width=this._options.textureSize,_.height=this._options.textureSize,m&&(_.format=m),_.isReady=!0,u&&u(),this._internalTexturesCache.push(_),_},i.prototype.createRenderTargetTexture=function(a,n){var s=new t.RenderTargetCreationOptions;n!==void 0&&typeof n=="object"?(s.generateMipMaps=n.generateMipMaps,s.generateDepthBuffer=n.generateDepthBuffer===void 0?!0:n.generateDepthBuffer,s.generateStencilBuffer=s.generateDepthBuffer&&n.generateStencilBuffer,s.type=n.type===void 0?t.Engine.TEXTURETYPE_UNSIGNED_INT:n.type,s.samplingMode=n.samplingMode===void 0?t.Texture.TRILINEAR_SAMPLINGMODE:n.samplingMode):(s.generateMipMaps=n,s.generateDepthBuffer=!0,s.generateStencilBuffer=!1,s.type=t.Engine.TEXTURETYPE_UNSIGNED_INT,s.samplingMode=t.Texture.TRILINEAR_SAMPLINGMODE);var o=new t.InternalTexture(this,t.InternalTexture.DATASOURCE_RENDERTARGET),l=a.width||a,u=a.height||a;return o._depthStencilBuffer={},o._framebuffer={},o.baseWidth=l,o.baseHeight=u,o.width=l,o.height=u,o.isReady=!0,o.samples=1,o.generateMipMaps=!!s.generateMipMaps,o.samplingMode=s.samplingMode,o.type=s.type,o._generateDepthBuffer=s.generateDepthBuffer,o._generateStencilBuffer=!!s.generateStencilBuffer,this._internalTexturesCache.push(o),o},i.prototype.updateTextureSamplingMode=function(a,n){n.samplingMode=a},i.prototype.bindFramebuffer=function(a,n,s,o,l){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=a,this._currentFramebuffer=a._MSAAFramebuffer?a._MSAAFramebuffer:a._framebuffer,this._cachedViewport&&!l&&this.setViewport(this._cachedViewport,s,o)},i.prototype.unBindFramebuffer=function(a,n,s){n===void 0&&(n=!1),this._currentRenderTarget=null,s&&(a._MSAAFramebuffer&&(this._currentFramebuffer=a._framebuffer),s()),this._currentFramebuffer=null},i.prototype.createDynamicVertexBuffer=function(a){var n={capacity:1,references:1,is32Bits:!1};return n},i.prototype.updateDynamicTexture=function(a,n,s,o,l){o===void 0&&(o=!1)},i.prototype.getError=function(){return 0},i.prototype._getUnpackAlignement=function(){return 1},i.prototype._unpackFlipY=function(a){},i.prototype.updateDynamicIndexBuffer=function(a,n,s){s===void 0&&(s=0)},i.prototype.updateDynamicVertexBuffer=function(a,n,s,o){},i.prototype._bindTextureDirectly=function(a,n){return this._boundTexturesCache[this._activeChannel]!==n?(this._boundTexturesCache[this._activeChannel]=n,!0):!1},i.prototype._bindTexture=function(a,n){a<0||this._bindTextureDirectly(0,n)},i.prototype._releaseBuffer=function(a){return a.references--,a.references===0},i.prototype.releaseEffects=function(){},i.prototype.displayLoadingUI=function(){},i.prototype.hideLoadingUI=function(){},i.prototype._uploadCompressedDataToTextureDirectly=function(a,n,s,o,l,u,h){u===void 0&&(u=0),h===void 0&&(h=0)},i.prototype._uploadDataToTextureDirectly=function(a,n,s,o){s===void 0&&(s=0),o===void 0&&(o=0)},i.prototype._uploadArrayBufferViewToTexture=function(a,n,s,o){s===void 0&&(s=0),o===void 0&&(o=0)},i.prototype._uploadImageToTexture=function(a,n,s,o){s===void 0&&(s=0),o===void 0&&(o=0)},i}(t.Engine);t.NullEngine=c})(T||(T={}));var T;(function(t){var f=function(){function c(r){this.engine=r,this._captureGPUFrameTime=!1,this._gpuFrameTime=new t.PerfCounter,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new t.PerfCounter,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(c.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(r){var i=this;r!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=r,r?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){i._gpuFrameTimeToken||(i._gpuFrameTimeToken=i.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(i._gpuFrameTimeToken){var a=i.engine.endTimeQuery(i._gpuFrameTimeToken);a>-1&&(i._gpuFrameTimeToken=null,i._gpuFrameTime.fetchNewFrame(),i._gpuFrameTime.addCount(a,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(r){var i=this;r!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=r,r?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){i._shaderCompilationTime.fetchNewFrame(),i._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){i._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},c}();t.EngineInstrumentation=f})(T||(T={}));var T;(function(t){var f=function(){function c(r){var i=this;this.scene=r,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new t.PerfCounter,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new t.PerfCounter,this._captureFrameTime=!1,this._frameTime=new t.PerfCounter,this._captureRenderTime=!1,this._renderTime=new t.PerfCounter,this._captureInterFrameTime=!1,this._interFrameTime=new t.PerfCounter,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new t.PerfCounter,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new t.PerfCounter,this._capturePhysicsTime=!1,this._physicsTime=new t.PerfCounter,this._captureAnimationsTime=!1,this._animationsTime=new t.PerfCounter,this._captureCameraRenderTime=!1,this._cameraRenderTime=new t.PerfCounter,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=r.onBeforeAnimationsObservable.add(function(){i._captureActiveMeshesEvaluationTime&&i._activeMeshesEvaluationTime.fetchNewFrame(),i._captureRenderTargetsRenderTime&&i._renderTargetsRenderTime.fetchNewFrame(),i._captureFrameTime&&(t.Tools.StartPerformanceCounter("Scene rendering"),i._frameTime.beginMonitoring()),i._captureInterFrameTime&&i._interFrameTime.endMonitoring(),i._captureParticlesRenderTime&&i._particlesRenderTime.fetchNewFrame(),i._captureSpritesRenderTime&&i._spritesRenderTime.fetchNewFrame(),i._captureAnimationsTime&&i._animationsTime.beginMonitoring(),i.scene.getEngine()._drawCalls.fetchNewFrame(),i.scene.getEngine()._textureCollisions.fetchNewFrame()}),this._onAfterRenderObserver=r.onAfterRenderObservable.add(function(){i._captureFrameTime&&(t.Tools.EndPerformanceCounter("Scene rendering"),i._frameTime.endMonitoring()),i._captureRenderTime&&i._renderTime.endMonitoring(!1),i._captureInterFrameTime&&i._interFrameTime.beginMonitoring()})}return Object.defineProperty(c.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(r){var i=this;r!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=r,r?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){t.Tools.StartPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){t.Tools.EndPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(r){var i=this;r!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=r,r?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){t.Tools.StartPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){t.Tools.EndPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(r){var i=this;r!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=r,r?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){t.Tools.StartPerformanceCounter("Particles"),i._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){t.Tools.EndPerformanceCounter("Particles"),i._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(r){var i=this;r!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=r,this.scene.spriteManagers&&(r?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){t.Tools.StartPerformanceCounter("Sprites"),i._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){t.Tools.EndPerformanceCounter("Sprites"),i._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(r){var i=this;r!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=r,r?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){t.Tools.StartPerformanceCounter("Physics"),i._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){t.Tools.EndPerformanceCounter("Physics"),i._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(r){var i=this;r!==this._captureAnimationsTime&&(this._captureAnimationsTime=r,r?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){i._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(r){this._captureFrameTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(r){this._captureInterFrameTime=r},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(r){var i=this;r!==this._captureRenderTime&&(this._captureRenderTime=r,r?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){i._renderTime.beginMonitoring(),t.Tools.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){i._renderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(r){var i=this;r!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=r,r?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(a){i._cameraRenderTime.beginMonitoring(),t.Tools.StartPerformanceCounter("Rendering camera "+a.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(a){i._cameraRenderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter("Rendering camera "+a.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureCollisionsCounter",{get:function(){return this.scene.getEngine()._textureCollisions},enumerable:!0,configurable:!0}),c.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},c}();t.SceneInstrumentation=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this._timeElapsedQueryEnded=!1}return c}();t._TimeToken=f})(T||(T={}));var T;(function(t){var f=function(r){N(i,r);function i(){var a=r.call(this)||this;return a.DIFFUSE=!1,a.DIFFUSEDIRECTUV=0,a.GAMMADIFFUSE=!1,a.DIFFUSEHASALPHA=!1,a.OPACITYFRESNEL=!1,a.REFLECTIONBLUR=!1,a.REFLECTIONFRESNEL=!1,a.REFLECTIONFALLOFF=!1,a.TEXTURELODSUPPORT=!1,a.PREMULTIPLYALPHA=!1,a.USERGBCOLOR=!1,a.USEHIGHLIGHTANDSHADOWCOLORS=!1,a.NOISE=!1,a.REFLECTIONBGR=!1,a.IMAGEPROCESSING=!1,a.VIGNETTE=!1,a.VIGNETTEBLENDMODEMULTIPLY=!1,a.VIGNETTEBLENDMODEOPAQUE=!1,a.TONEMAPPING=!1,a.TONEMAPPING_ACES=!1,a.CONTRAST=!1,a.COLORCURVES=!1,a.COLORGRADING=!1,a.COLORGRADING3D=!1,a.SAMPLER3DGREENDEPTH=!1,a.SAMPLER3DBGRMAP=!1,a.IMAGEPROCESSINGPOSTPROCESS=!1,a.EXPOSURE=!1,a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1,a.RGBDREFLECTION=!1,a.EQUIRECTANGULAR_RELFECTION_FOV=!1,a.MAINUV1=!1,a.MAINUV2=!1,a.UV1=!1,a.UV2=!1,a.CLIPPLANE=!1,a.CLIPPLANE2=!1,a.CLIPPLANE3=!1,a.CLIPPLANE4=!1,a.POINTSIZE=!1,a.FOG=!1,a.NORMAL=!1,a.NUM_BONE_INFLUENCERS=0,a.BonesPerMesh=0,a.INSTANCES=!1,a.SHADOWFLOAT=!1,a.rebuild(),a}return i}(t.MaterialDefines),c=function(r){N(i,r);function i(a,n){var s=r.call(this,a,n)||this;return s.primaryColor=t.Color3.White(),s._primaryColorShadowLevel=0,s._primaryColorHighlightLevel=0,s.reflectionTexture=null,s.reflectionBlur=0,s.diffuseTexture=null,s._shadowLights=null,s.shadowLights=null,s.shadowLevel=0,s.sceneCenter=t.Vector3.Zero(),s.opacityFresnel=!0,s.reflectionFresnel=!1,s.reflectionFalloffDistance=0,s.reflectionAmount=1,s.reflectionReflectance0=.05,s.reflectionReflectance90=.5,s.useRGBColor=!0,s.enableNoise=!1,s._fovMultiplier=1,s.useEquirectangularFOV=!1,s._maxSimultaneousLights=4,s.maxSimultaneousLights=4,s._imageProcessingObserver=null,s.switchToBGR=!1,s._renderTargets=new t.SmartArray(16),s._reflectionControls=t.Vector4.Zero(),s._white=t.Color3.White(),s._primaryShadowColor=t.Color3.Black(),s._primaryHighlightColor=t.Color3.Black(),s._attachImageProcessingConfiguration(null),s.getRenderTargetTextures=function(){return s._renderTargets.reset(),s._diffuseTexture&&s._diffuseTexture.isRenderTarget&&s._renderTargets.push(s._diffuseTexture),s._reflectionTexture&&s._reflectionTexture.isRenderTarget&&s._renderTargets.push(s._reflectionTexture),s._renderTargets},s}return Object.defineProperty(i.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(a){this.__perceptualColor=a,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(a){this._primaryColorShadowLevel=a,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(a){this._primaryColorHighlightLevel=a,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reflectionStandardFresnelWeight",{set:function(a){var n=a;n<.5?(n=n*2,this.reflectionReflectance0=i.StandardReflectance0*n,this.reflectionReflectance90=i.StandardReflectance90*n):(n=n*2-1,this.reflectionReflectance0=i.StandardReflectance0+(1-i.StandardReflectance0)*n,this.reflectionReflectance90=i.StandardReflectance90+(1-i.StandardReflectance90)*n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(a){isNaN(a)&&(a=1),this._fovMultiplier=Math.max(0,Math.min(2,a))},enumerable:!0,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(a){var n=this;a!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),a?this._imageProcessingConfiguration=a:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(s){n._computePrimaryColorFromPerceptualColor(),n._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(a){this._attachImageProcessingConfiguration(a),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(a){this.imageProcessingConfiguration.colorCurvesEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(a){this.imageProcessingConfiguration.colorGradingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(a){this._imageProcessingConfiguration.toneMappingEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(a){this._imageProcessingConfiguration.exposure=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(a){this._imageProcessingConfiguration.contrast=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(a){this.imageProcessingConfiguration.colorGradingTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(a){this.imageProcessingConfiguration.colorCurves=a},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(this._diffuseTexture&&this._diffuseTexture.isRenderTarget||this._reflectionTexture&&this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),i.prototype.needAlphaTesting=function(){return!0},i.prototype.needAlphaBlending=function(){return this.alpha<0||this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha},i.prototype.isReadyForSubMesh=function(a,n,s){var o=this;if(s===void 0&&(s=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new f);var l=this.getScene(),u=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&u._renderId===l.getRenderId())return!0;var h=l.getEngine();if(t.MaterialHelper.PrepareDefinesForLights(l,a,u,!1,this._maxSimultaneousLights),u._needNormals=!0,u._areTexturesDirty){if(u._needUVs=!1,l.texturesEnabled){if(l.getEngine().getCaps().textureLOD&&(u.TEXTURELODSUPPORT=!0),this._diffuseTexture&&t.StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;t.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,u,"DIFFUSE"),u.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,u.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,u.OPACITYFRESNEL=this._opacityFresnel}else u.DIFFUSE=!1,u.DIFFUSEHASALPHA=!1,u.GAMMADIFFUSE=!1,u.OPACITYFRESNEL=!1;var d=this._reflectionTexture;if(d&&t.StandardMaterial.ReflectionTextureEnabled){if(!d.isReadyOrNotBlocking())return!1;switch(u.REFLECTION=!0,u.GAMMAREFLECTION=d.gammaSpace,u.RGBDREFLECTION=d.isRGBD,u.REFLECTIONBLUR=this._reflectionBlur>0,u.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!d.invertZ:d.invertZ,u.LODINREFLECTIONALPHA=d.lodLevelInAlpha,u.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,u.REFLECTIONBGR=this.switchToBGR,d.coordinatesMode===t.Texture.INVCUBIC_MODE&&(u.INVERTCUBICMAP=!0),u.REFLECTIONMAP_3D=d.isCube,d.coordinatesMode){case t.Texture.EXPLICIT_MODE:u.REFLECTIONMAP_EXPLICIT=!0;break;case t.Texture.PLANAR_MODE:u.REFLECTIONMAP_PLANAR=!0;break;case t.Texture.PROJECTION_MODE:u.REFLECTIONMAP_PROJECTION=!0;break;case t.Texture.SKYBOX_MODE:u.REFLECTIONMAP_SKYBOX=!0,u.REFLECTIONMAP_SKYBOX_TRANSFORMED=!d.getReflectionTextureMatrix().isIdentity();break;case t.Texture.SPHERICAL_MODE:u.REFLECTIONMAP_SPHERICAL=!0;break;case t.Texture.EQUIRECTANGULAR_MODE:u.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case t.Texture.FIXED_EQUIRECTANGULAR_MODE:u.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case t.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:u.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case t.Texture.CUBIC_MODE:case t.Texture.INVCUBIC_MODE:default:u.REFLECTIONMAP_CUBIC=!0;break}this.reflectionFresnel?(u.REFLECTIONFRESNEL=!0,u.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(u.REFLECTIONFRESNEL=!1,u.REFLECTIONFALLOFF=!1)}else u.REFLECTION=!1,u.REFLECTIONFRESNEL=!1,u.REFLECTIONFALLOFF=!1,u.REFLECTIONBLUR=!1,u.REFLECTIONMAP_3D=!1,u.REFLECTIONMAP_SPHERICAL=!1,u.REFLECTIONMAP_PLANAR=!1,u.REFLECTIONMAP_CUBIC=!1,u.REFLECTIONMAP_PROJECTION=!1,u.REFLECTIONMAP_SKYBOX=!1,u.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,u.REFLECTIONMAP_EXPLICIT=!1,u.REFLECTIONMAP_EQUIRECTANGULAR=!1,u.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,u.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,u.INVERTCUBICMAP=!1,u.REFLECTIONMAP_OPPOSITEZ=!1,u.LODINREFLECTIONALPHA=!1,u.GAMMAREFLECTION=!1,u.RGBDREFLECTION=!1}u.PREMULTIPLYALPHA=this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===t.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,u.USERGBCOLOR=this._useRGBColor,u.NOISE=this._enableNoise}if(u._areLightsDirty&&(u.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(this._primaryColorShadowLevel!==0||this._primaryColorHighlightLevel!==0)),u._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(u)}if(t.MaterialHelper.PrepareDefinesForMisc(a,l,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(a),u),t.MaterialHelper.PrepareDefinesForFrameBoundValues(l,h,u,s),t.MaterialHelper.PrepareDefinesForAttributes(a,u,!1,!0,!1)&&a&&!l.getEngine().getCaps().standardDerivatives&&!a.isVerticesDataPresent(t.VertexBuffer.NormalKind)&&(a.createNormals(!0),t.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: "+a.name)),u.isDirty){u.markAsProcessed(),l.resetCachedMaterial();var p=new t.EffectFallbacks;u.FOG&&p.addFallback(0,"FOG"),u.POINTSIZE&&p.addFallback(1,"POINTSIZE"),t.MaterialHelper.HandleFallbacksForShadows(u,p,this._maxSimultaneousLights),u.NUM_BONE_INFLUENCERS>0&&p.addCPUSkinningFallback(0,a);var m=[t.VertexBuffer.PositionKind];u.NORMAL&&m.push(t.VertexBuffer.NormalKind),u.UV1&&m.push(t.VertexBuffer.UVKind),u.UV2&&m.push(t.VertexBuffer.UV2Kind),t.MaterialHelper.PrepareAttributesForBones(m,a,u,p),t.MaterialHelper.PrepareAttributesForInstances(m,u);var _=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],v=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],S=["Material","Scene"];t.ImageProcessingConfiguration&&(t.ImageProcessingConfiguration.PrepareUniforms(_,u),t.ImageProcessingConfiguration.PrepareSamplers(v,u)),t.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:_,uniformBuffersNames:S,samplers:v,defines:u,maxSimultaneousLights:this._maxSimultaneousLights});var P=function(R){o.onCompiled&&o.onCompiled(R),o.bindSceneUniformBuffer(R,l.getSceneUniformBuffer())},x=u.toString();n.setEffect(l.getEngine().createEffect("background",{attributes:m,uniformsNames:_,uniformBuffersNames:S,samplers:v,defines:x,fallbacks:p,onCompiled:P,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},h),u),this.buildUniformLayout()}return!n.effect||!n.effect.isReady()?!1:(u._renderId=l.getRenderId(),this._wasPreviouslyReady=!0,!0)},i.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},i.prototype._computePrimaryColors=function(){this._primaryColorShadowLevel===0&&this._primaryColorHighlightLevel===0||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},i.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},i.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),r.prototype.unbind.call(this)},i.prototype.bindOnlyWorldMatrix=function(a){this._activeEffect.setMatrix("world",a)},i.prototype.bindForSubMesh=function(a,n,s){var o=this.getScene(),l=s._materialDefines;if(l){var u=s.effect;if(u){this._activeEffect=u,this.bindOnlyWorldMatrix(a),t.MaterialHelper.BindBonesParameters(n,this._activeEffect);var h=this._mustRebind(o,u,n.visibility);if(h){this._uniformBuffer.bindToEffect(u,"Material"),this.bindViewProjection(u);var d=this._reflectionTexture;(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync)&&(o.texturesEnabled&&(this._diffuseTexture&&t.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),t.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),d&&t.StandardMaterial.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",d.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",d.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",d.getSize().width,d.lodGenerationScale,d.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),l.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),o.texturesEnabled&&(this._diffuseTexture&&t.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),d&&t.StandardMaterial.ReflectionTextureEnabled&&(l.REFLECTIONBLUR&&l.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",d):l.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",d._lodTextureMid||d),this._uniformBuffer.setTexture("reflectionSamplerLow",d._lodTextureLow||d),this._uniformBuffer.setTexture("reflectionSamplerHigh",d._lodTextureHigh||d)):this._uniformBuffer.setTexture("reflectionSampler",d),l.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),t.MaterialHelper.BindClipPlane(this._activeEffect,o),t.MaterialHelper.BindEyePosition(u,o)}(h||!this.isFrozen)&&(o.lightsEnabled&&t.MaterialHelper.BindLights(o,n,this._activeEffect,l,this._maxSimultaneousLights,!1),this.bindView(u),t.MaterialHelper.BindFogParameters(o,n,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(n,this._activeEffect)}}},i.prototype.dispose=function(a,n){a===void 0&&(a=!1),n===void 0&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),r.prototype.dispose.call(this,a)},i.prototype.clone=function(a){var n=this;return t.SerializationHelper.Clone(function(){return new i(a,n.getScene())},this)},i.prototype.serialize=function(){var a=t.SerializationHelper.Serialize(this);return a.customType="BABYLON.BackgroundMaterial",a},i.prototype.getClassName=function(){return"BackgroundMaterial"},i.Parse=function(a,n,s){return t.SerializationHelper.Parse(function(){return new i(a.name,n)},a,n,s)},i.StandardReflectance0=.05,i.StandardReflectance90=.5,A([t.serializeAsColor3()],i.prototype,"_primaryColor",void 0),A([t.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"primaryColor",void 0),A([t.serializeAsColor3()],i.prototype,"__perceptualColor",void 0),A([t.serialize()],i.prototype,"_primaryColorShadowLevel",void 0),A([t.serialize()],i.prototype,"_primaryColorHighlightLevel",void 0),A([t.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"primaryColorHighlightLevel",null),A([t.serializeAsTexture()],i.prototype,"_reflectionTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),A([t.serialize()],i.prototype,"_reflectionBlur",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionBlur",void 0),A([t.serializeAsTexture()],i.prototype,"_diffuseTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"diffuseTexture",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"shadowLights",void 0),A([t.serialize()],i.prototype,"_shadowLevel",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"shadowLevel",void 0),A([t.serializeAsVector3()],i.prototype,"_sceneCenter",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"sceneCenter",void 0),A([t.serialize()],i.prototype,"_opacityFresnel",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"opacityFresnel",void 0),A([t.serialize()],i.prototype,"_reflectionFresnel",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionFresnel",void 0),A([t.serialize()],i.prototype,"_reflectionFalloffDistance",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionFalloffDistance",void 0),A([t.serialize()],i.prototype,"_reflectionAmount",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionAmount",void 0),A([t.serialize()],i.prototype,"_reflectionReflectance0",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionReflectance0",void 0),A([t.serialize()],i.prototype,"_reflectionReflectance90",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionReflectance90",void 0),A([t.serialize()],i.prototype,"_useRGBColor",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRGBColor",void 0),A([t.serialize()],i.prototype,"_enableNoise",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableNoise",void 0),A([t.serialize()],i.prototype,"_maxSimultaneousLights",void 0),A([t.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"maxSimultaneousLights",void 0),A([t.serializeAsImageProcessingConfiguration()],i.prototype,"_imageProcessingConfiguration",void 0),i}(t.PushMaterial);t.BackgroundMaterial=c})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function c(r,i){var a=this;this._errorHandler=function(n,s){a.onErrorObservable.notifyObservers({message:n,exception:s})},this._options=Ve({},c._getDefaultOptions(),r),this._scene=i,this.onErrorObservable=new t.Observable,this._setupBackground(),this._setupImageProcessing()}return c._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new t.Color3(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:t.Engine.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new t.Color3(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:t.Vector3.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(c.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),c.prototype.updateOptions=function(r){var i=Ve({},this._options,r);this._ground&&!i.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!i.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=i.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!i.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!i.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=i.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!i.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=i.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=i,this._setupBackground(),this._setupImageProcessing()},c.prototype.setMainColor=function(r){this.groundMaterial&&(this.groundMaterial.primaryColor=r),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=r),this.groundMirror&&(this.groundMirror.clearColor=new t.Color4(r.r,r.g,r.b,1))},c.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},c.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture){if(this._options.environmentTexture instanceof t.BaseTexture){this._scene.environmentTexture=this._options.environmentTexture;return}var r=t.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=r}},c.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new t.Mesh("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var r=this._getSceneSize();this._options.createGround&&(this._setupGround(r),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(r),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(r),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=r.rootPosition.x,this._rootMesh.position.z=r.rootPosition.z,this._rootMesh.position.y=r.rootPosition.y},c.prototype._getSceneSize=function(){var r=this,i=this._options.groundSize,a=this._options.skyboxSize,n=this._options.rootPosition;if(!this._scene.meshes||this._scene.meshes.length===1)return{groundSize:i,skyboxSize:a,rootPosition:n};var s=this._scene.getWorldExtends(function(u){return u!==r._ground&&u!==r._rootMesh&&u!==r._skybox}),o=s.max.subtract(s.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof t.ArcRotateCamera&&this._scene.activeCamera.upperRadiusLimit&&(i=this._scene.activeCamera.upperRadiusLimit*2,a=i);var l=o.length();l>i&&(i=l*2,a=i),i*=1.1,a*=1.5,n=s.min.add(o.scale(.5)),n.y=s.min.y-this._options.groundYBias}return{groundSize:i,skyboxSize:a,rootPosition:n}},c.prototype._setupGround=function(r){var i=this;(!this._ground||this._ground.isDisposed())&&(this._ground=t.Mesh.CreatePlane("BackgroundPlane",r.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){i._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},c.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new t.BackgroundMaterial("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=t.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},c.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture){if(this._options.groundTexture instanceof t.BaseTexture){this._groundMaterial.diffuseTexture=this._options.groundTexture;return}var r=new t.Texture(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);r.gammaSpace=!1,r.hasAlpha=!0,this._groundMaterial.diffuseTexture=r}},c.prototype._setupGroundMirrorTexture=function(r){var i=t.Texture.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new t.MirrorTexture("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,t.Texture.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new t.Plane(0,-1,0,r.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=i,this._groundMirror.wrapV=i,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var a=0;a<this._scene.meshes.length;a++){var n=this._scene.meshes[a];n!==this._ground&&n!==this._skybox&&n!==this._rootMesh&&this._groundMirror.renderList.push(n)}this._groundMirror.clearColor=new t.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},c.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},c.prototype._setupSkybox=function(r){var i=this;(!this._skybox||this._skybox.isDisposed())&&(this._skybox=t.Mesh.CreateBox("BackgroundSkybox",r.skyboxSize,this._scene,void 0,t.Mesh.BACKSIDE),this._skybox.onDisposeObservable.add(function(){i._skybox=null})),this._skybox.parent=this._rootMesh},c.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new t.BackgroundMaterial("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},c.prototype._setupSkyboxReflectionTexture=function(){if(this._skyboxMaterial&&!this._skyboxTexture){if(this._options.skyboxTexture instanceof t.BaseTexture){this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture;return}this._skyboxTexture=new t.CubeTexture(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=t.Texture.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture}},c.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},c._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",c._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",c._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",c}();t.EnvironmentHelper=f})(T||(T={}));var T;(function(t){var f=function(){function r(){}return r}(),c=function(){function r(){this.systems=new Array}return Object.defineProperty(r.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),r.prototype.setEmitterAsSphere=function(i,a,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:i,renderingGroupId:a};var s=t.MeshBuilder.CreateSphere("emitterSphere",{diameter:i.diameter,segments:i.segments},n);s.renderingGroupId=a;var o=new t.StandardMaterial("emitterSphereMaterial",n);o.emissiveColor=i.color,s.material=o;for(var l=0,u=this.systems;l<u.length;l++){var h=u[l];h.emitter=s}this._emitterNode=s},r.prototype.start=function(i){for(var a=0,n=this.systems;a<n.length;a++){var s=n[a];i&&(s.emitter=i),s.start()}},r.prototype.dispose=function(){for(var i=0,a=this.systems;i<a.length;i++){var n=a[i];n.dispose()}this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},r.prototype.serialize=function(){var i={};i.systems=[];for(var a=0,n=this.systems;a<n.length;a++){var s=n[a];i.systems.push(s.serialize())}return this._emitterNode&&(i.emitter=this._emitterCreationOptions),i},r.Parse=function(i,a,n){n===void 0&&(n=!1);var s=new r,o=t.ParticleHelper.BaseAssetsUrl+"/textures/";a=a||t.Engine.LastCreatedScene;for(var l=0,u=i.systems;l<u.length;l++){var h=u[l];s.systems.push(n?t.GPUParticleSystem.Parse(h,a,o,!0):t.ParticleSystem.Parse(h,a,o,!0))}if(i.emitter){var d=i.emitter.options;switch(i.emitter.kind){case"Sphere":s.setEmitterAsSphere({diameter:d.diameter,segments:d.segments,color:t.Color3.FromArray(d.color)},i.emitter.renderingGroupId,a);break}}return s},r}();t.ParticleSystemSet=c})(T||(T={}));var T;(function(t){var f=function(){function c(){}return c.CreateDefault=function(r,i,a,n){i===void 0&&(i=500),n===void 0&&(n=!1);var s;return n?s=new t.GPUParticleSystem("default system",{capacity:i},a):s=new t.ParticleSystem("default system",i,a),s.emitter=r,s.particleTexture=new t.Texture("https://www.babylonjs.com/assets/Flare.png",s.getScene()),s.createConeEmitter(.1,Math.PI/4),s.color1=new t.Color4(1,1,1,1),s.color2=new t.Color4(1,1,1,1),s.colorDead=new t.Color4(1,1,1,0),s.minSize=.1,s.maxSize=.1,s.minEmitPower=2,s.maxEmitPower=2,s.updateSpeed=.016666666666666666,s.emitRate=30,s},c.CreateAsync=function(r,i,a){a===void 0&&(a=!1),i||(i=t.Engine.LastCreatedScene);var n={};return i._addPendingData(n),new Promise(function(s,o){if(a&&!t.GPUParticleSystem.IsSupported)return i._removePendingData(n),o("Particle system with GPU is not supported.");t.Tools.LoadFile(c.BaseAssetsUrl+"/systems/"+r+".json",function(l,u){i._removePendingData(n);var h=JSON.parse(l.toString());return s(t.ParticleSystemSet.Parse(h,i,a))},void 0,void 0,void 0,function(l,u){return i._removePendingData(n),o("An error occured while the creation of your particle system. Check if your type '"+r+"' exists.")})})},c.ExportSet=function(r){for(var i=new t.ParticleSystemSet,a=0,n=r;a<n.length;a++){var s=n[a];i.systems.push(s)}return i},c.BaseAssetsUrl="https://assets.babylonjs.com/particles",c}();t.ParticleHelper=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s){var o=c.call(this,i,s)||this;o._useDirectMapping=!1,i=i||"videoDome",n.resolution=Math.abs(n.resolution)|0||32,n.clickToPlay=!!n.clickToPlay,n.autoPlay=n.autoPlay===void 0?!0:!!n.autoPlay,n.loop=n.loop===void 0?!0:!!n.loop,n.size=Math.abs(n.size)||(s.activeCamera?s.activeCamera.maxZ*.48:1e3),n.useDirectMapping===void 0?o._useDirectMapping=!0:o._useDirectMapping=n.useDirectMapping,o._setReady(!1);var l={loop:n.loop,autoPlay:n.autoPlay,autoUpdateTexture:!0,poster:n.poster},u=o._material=new t.BackgroundMaterial(i+"_material",s),h=o._videoTexture=new t.VideoTexture(i+"_texture",a,s,!1,o._useDirectMapping,t.Texture.TRILINEAR_SAMPLINGMODE,l);return o._mesh=t.Mesh.CreateSphere(i+"_mesh",n.resolution,n.size,s,!1,t.Mesh.BACKSIDE),h.onLoadObservable.addOnce(function(){o._setReady(!0)}),u.useEquirectangularFOV=!0,u.fovMultiplier=1,u.opacityFresnel=!1,o._useDirectMapping?(h.wrapU=t.Texture.CLAMP_ADDRESSMODE,h.wrapV=t.Texture.CLAMP_ADDRESSMODE,u.diffuseTexture=h):(h.coordinatesMode=t.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,h.wrapV=t.Texture.CLAMP_ADDRESSMODE,u.reflectionTexture=h),o._mesh.material=u,o._mesh.parent=o,n.clickToPlay&&(s.onPointerUp=function(){o._videoTexture.video.play()}),o}return Object.defineProperty(r.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(i){this._material.fovMultiplier=i},enumerable:!0,configurable:!0}),r.prototype.dispose=function(i,a){a===void 0&&(a=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),c.prototype.dispose.call(this,i,a)},r}(t.TransformNode);t.VideoDome=f})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){o===void 0&&(o=null);var l=c.call(this,i,s)||this;l._useDirectMapping=!1,l.onLoadErrorObservable=new t.Observable,i=i||"photoDome",n.resolution=Math.abs(n.resolution)|0||32,n.size=Math.abs(n.size)||(s.activeCamera?s.activeCamera.maxZ*.48:1e3),n.useDirectMapping===void 0?l._useDirectMapping=!0:l._useDirectMapping=n.useDirectMapping,l._setReady(!1);var u=l._material=new t.BackgroundMaterial(i+"_material",s);return l._mesh=t.Mesh.CreateSphere(i+"_mesh",n.resolution,n.size,s,!1,t.Mesh.BACKSIDE),u.opacityFresnel=!1,u.useEquirectangularFOV=!0,u.fovMultiplier=1,l.photoTexture=new t.Texture(a,s,!0,!l._useDirectMapping,void 0,void 0,function(h,d){l.onLoadErrorObservable.notifyObservers(h||"Unknown error occured"),o&&o(h,d)}),l.photoTexture.onLoadObservable.addOnce(function(){l._setReady(!0)}),l._mesh.material=u,l._mesh.parent=l,l}return Object.defineProperty(r.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(i){this._photoTexture!==i&&(this._photoTexture=i,this._useDirectMapping?(this._photoTexture.wrapU=t.Texture.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=t.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=t.Texture.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(i){this._material.fovMultiplier=i},enumerable:!0,configurable:!0}),r.prototype.dispose=function(i,a){a===void 0&&(a=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),c.prototype.dispose.call(this,i,a)},r}(t.TransformNode);t.PhotoDome=f})(T||(T={}));var T;(function(t){var f=function(){function c(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=t.AbstractMesh.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=t.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE}return c}();t.Engine.prototype.createQuery=function(){return this._gl.createQuery()},t.Engine.prototype.deleteQuery=function(c){return this._gl.deleteQuery(c),this},t.Engine.prototype.isQueryResultAvailable=function(c){return this._gl.getQueryParameter(c,this._gl.QUERY_RESULT_AVAILABLE)},t.Engine.prototype.getQueryResult=function(c){return this._gl.getQueryParameter(c,this._gl.QUERY_RESULT)},t.Engine.prototype.beginOcclusionQuery=function(c,r){var i=this._getGlAlgorithmType(c);return this._gl.beginQuery(i,r),this},t.Engine.prototype.endOcclusionQuery=function(c){var r=this._getGlAlgorithmType(c);return this._gl.endQuery(r),this},t.Engine.prototype._createTimeQuery=function(){var c=this.getCaps().timerQuery;return c.createQueryEXT?c.createQueryEXT():this.createQuery()},t.Engine.prototype._deleteTimeQuery=function(c){var r=this.getCaps().timerQuery;if(r.deleteQueryEXT){r.deleteQueryEXT(c);return}this.deleteQuery(c)},t.Engine.prototype._getTimeQueryResult=function(c){var r=this.getCaps().timerQuery;return r.getQueryObjectEXT?r.getQueryObjectEXT(c,r.QUERY_RESULT_EXT):this.getQueryResult(c)},t.Engine.prototype._getTimeQueryAvailability=function(c){var r=this.getCaps().timerQuery;return r.getQueryObjectEXT?r.getQueryObjectEXT(c,r.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(c)},t.Engine.prototype.startTimeQuery=function(){var c=this.getCaps(),r=c.timerQuery;if(!r)return null;var i=new t._TimeToken;if(this._gl.getParameter(r.GPU_DISJOINT_EXT),c.canUseTimestampForTimerQuery)i._startTimeQuery=this._createTimeQuery(),r.queryCounterEXT(i._startTimeQuery,r.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;i._timeElapsedQuery=this._createTimeQuery(),r.beginQueryEXT?r.beginQueryEXT(r.TIME_ELAPSED_EXT,i._timeElapsedQuery):this._gl.beginQuery(r.TIME_ELAPSED_EXT,i._timeElapsedQuery),this._currentNonTimestampToken=i}return i},t.Engine.prototype.endTimeQuery=function(c){var r=this.getCaps(),i=r.timerQuery;if(!i||!c)return-1;if(r.canUseTimestampForTimerQuery){if(!c._startTimeQuery)return-1;c._endTimeQuery||(c._endTimeQuery=this._createTimeQuery(),i.queryCounterEXT(c._endTimeQuery,i.TIMESTAMP_EXT))}else if(!c._timeElapsedQueryEnded){if(!c._timeElapsedQuery)return-1;i.endQueryEXT?i.endQueryEXT(i.TIME_ELAPSED_EXT):this._gl.endQuery(i.TIME_ELAPSED_EXT),c._timeElapsedQueryEnded=!0}var a=this._gl.getParameter(i.GPU_DISJOINT_EXT),n=!1;if(c._endTimeQuery?n=this._getTimeQueryAvailability(c._endTimeQuery):c._timeElapsedQuery&&(n=this._getTimeQueryAvailability(c._timeElapsedQuery)),n&&!a){var s=0;if(r.canUseTimestampForTimerQuery){if(!c._startTimeQuery||!c._endTimeQuery)return-1;var o=this._getTimeQueryResult(c._startTimeQuery),l=this._getTimeQueryResult(c._endTimeQuery);s=l-o,this._deleteTimeQuery(c._startTimeQuery),this._deleteTimeQuery(c._endTimeQuery),c._startTimeQuery=null,c._endTimeQuery=null}else{if(!c._timeElapsedQuery)return-1;s=this._getTimeQueryResult(c._timeElapsedQuery),this._deleteTimeQuery(c._timeElapsedQuery),c._timeElapsedQuery=null,c._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return s}return-1},t.Engine.prototype._getGlAlgorithmType=function(c){return c===t.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(t.AbstractMesh.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new f),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(c){this._occlusionDataStorage.isOccluded=c},enumerable:!0,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(c){this._occlusionDataStorage.occlusionQueryAlgorithmType=c},enumerable:!0,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(c){this._occlusionDataStorage.occlusionType=c},enumerable:!0,configurable:!0}),Object.defineProperty(t.AbstractMesh.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(c){this._occlusionDataStorage.occlusionRetryCount=c},enumerable:!0,configurable:!0}),t.AbstractMesh.prototype._checkOcclusionQuery=function(){var c=this._occlusionDataStorage;if(c.occlusionType===t.AbstractMesh.OCCLUSION_TYPE_NONE)return c.isOccluded=!1,!1;var r=this.getEngine();if(r.webGLVersion<2||!r.isQueryResultAvailable)return c.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery){var i=r.isQueryResultAvailable(this._occlusionQuery);if(i){var a=r.getQueryResult(this._occlusionQuery);c.isOcclusionQueryInProgress=!1,c.occlusionInternalRetryCounter=0,c.isOccluded=a!==1}else if(c.occlusionInternalRetryCounter++,c.occlusionRetryCount!==-1&&c.occlusionInternalRetryCounter>c.occlusionRetryCount)c.isOcclusionQueryInProgress=!1,c.occlusionInternalRetryCounter=0,c.isOccluded=c.occlusionType===t.AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC?!1:c.isOccluded;else return!1}var n=this.getScene();if(n.getBoundingBoxRenderer){var s=n.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=r.createQuery()),r.beginOcclusionQuery(c.occlusionQueryAlgorithmType,this._occlusionQuery),s.renderOcclusionBoundingBox(this),r.endOcclusionQuery(c.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return c.isOccluded}})(T||(T={}));var T;(function(t){var f=function(c){N(r,c);function r(i,a,n,s,o){a===void 0&&(a=256),n===void 0&&(n=t.Engine.LastCreatedScene);var l=c.call(this,i,a,"noise",n,s,o)||this;return l._time=0,l.brightness=.2,l.octaves=3,l.persistence=.8,l.animationSpeedFactor=1,l.autoClear=!1,l._updateShaderUniforms(),l}return r.prototype._updateShaderUniforms=function(){var i=this.getScene();i&&(this._time+=i.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},r.prototype._getDefines=function(){return"#define OCTAVES "+(this.octaves|0)},r.prototype.render=function(i){this._updateShaderUniforms(),c.prototype.render.call(this,i)},r.prototype.serialize=function(){var i={};return i.customType="BABYLON.NoiseProceduralTexture",i.brightness=this.brightness,i.octaves=this.octaves,i.persistence=this.persistence,i.animationSpeedFactor=this.animationSpeedFactor,i.size=this.getSize().width,i.generateMipMaps=this._generateMipMaps,i},r.Parse=function(i,a,n){var s=new r(i.name,i.size,a,void 0,i.generateMipMaps);return s.brightness=i.brightness,s.octaves=i.octaves,s.persistence=i.persistence,s.animationSpeedFactor=i.animationSpeedFactor,s},r}(t.ProceduralTexture);t.NoiseProceduralTexture=f})(T||(T={}));var Ve=function(){return Ve=Object.assign||function(t){for(var f,c=1,r=arguments.length;c<r;c++){f=arguments[c];for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i])}return t},Ve.apply(this,arguments)},T;(function(t){var f=function(){function c(r,i){if(i===void 0&&(i=null),!c.IsSupported(r))throw"Your browser does not support recording so far.";var a=r.getRenderingCanvas();if(!a)throw"The babylon engine must have a canvas to be recorded";this._canvas=a,this._canvas.isRecording=!1,this._options=Ve({},c._defaultOptions,i);var n=this._canvas.captureStream(this._options.fps);this._mediaRecorder=new MediaRecorder(n,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return c.IsSupported=function(r){var i=r.getRenderingCanvas();return!!i&&typeof i.captureStream=="function"},Object.defineProperty(c.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),c.prototype.stopRecording=function(){!this._canvas||!this._mediaRecorder||this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},c.prototype.startRecording=function(r,i){var a=this;if(r===void 0&&(r="babylonjs.webm"),i===void 0&&(i=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return i>0&&setTimeout(function(){a.stopRecording()},i*1e3),this._fileName=r,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(n,s){a._resolve=n,a._reject=s})},c.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},c.prototype._handleDataAvailable=function(r){r.data.size>0&&this._recordedChunks.push(r.data)},c.prototype._handleError=function(r){if(this.stopRecording(),this._reject)this._reject(r.error);else throw new r.error},c.prototype._handleStop=function(){this.stopRecording();var r=new Blob(this._recordedChunks);this._resolve&&this._resolve(r),window.URL.createObjectURL(r),this._fileName&&t.Tools.Download(r,this._fileName)},c._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},c}();t.VideoRecorder=f})(T||(T={}));var T;(function(t){t.Scene.prototype.createDefaultLight=function(f){if(f===void 0&&(f=!1),f&&this.lights)for(var c=0;c<this.lights.length;c++)this.lights[c].dispose();this.lights.length===0&&new t.HemisphericLight("default light",t.Vector3.Up(),this)},t.Scene.prototype.createDefaultCamera=function(f,c,r){if(f===void 0&&(f=!1),c===void 0&&(c=!1),r===void 0&&(r=!1),c&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var i=this.getWorldExtends(),a=i.max.subtract(i.min),n=i.min.add(a.scale(.5)),s,o=a.length()*1.5;if(isFinite(o)||(o=1,n.copyFromFloats(0,0,0)),f){var l=new t.ArcRotateCamera("default camera",-(Math.PI/2),Math.PI/2,o,n,this);l.lowerRadiusLimit=o*.01,l.wheelPrecision=100/o,s=l}else{var u=new t.FreeCamera("default camera",new t.Vector3(n.x,n.y,-o),this);u.setTarget(n),s=u}s.minZ=o*.01,s.maxZ=o*1e3,s.speed=o*.2,this.activeCamera=s;var h=this.getEngine().getRenderingCanvas();r&&h&&s.attachControl(h)}},t.Scene.prototype.createDefaultCameraOrLight=function(f,c,r){f===void 0&&(f=!1),c===void 0&&(c=!1),r===void 0&&(r=!1),this.createDefaultLight(c),this.createDefaultCamera(f,c,r)},t.Scene.prototype.createDefaultSkybox=function(f,c,r,i,a){if(c===void 0&&(c=!1),r===void 0&&(r=1e3),i===void 0&&(i=0),a===void 0&&(a=!0),!f)return t.Tools.Warn("Can not create default skybox without environment texture."),null;a&&f&&(this.environmentTexture=f);var n=t.Mesh.CreateBox("hdrSkyBox",r,this);if(c){var s=new t.PBRMaterial("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=f.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=t.Texture.SKYBOX_MODE),s.microSurface=1-i,s.disableLighting=!0,s.twoSidedLighting=!0,n.infiniteDistance=!0,n.material=s}else{var o=new t.StandardMaterial("skyBox",this);o.backFaceCulling=!1,o.reflectionTexture=f.clone(),o.reflectionTexture&&(o.reflectionTexture.coordinatesMode=t.Texture.SKYBOX_MODE),o.disableLighting=!0,n.infiniteDistance=!0,n.material=o}return n},t.Scene.prototype.createDefaultEnvironment=function(f){return t.EnvironmentHelper?new t.EnvironmentHelper(f,this):null},t.Scene.prototype.createDefaultVRExperience=function(f){return f===void 0&&(f={}),new t.VRExperienceHelper(this,f)}})(T||(T={}));T.Effect.ShadersStore={defaultVertexShader:`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL 
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;
#else
vPositionUVW=position;
#endif
#endif 
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`,defaultPixelShader:`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY 
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#ifdef ALPHATEST
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec3 refractionColor=vec3(0.,0.,0.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor=toGammaSpace(refractionColor);
#endif
refractionColor*=vRefractionInfos.x;
#endif

vec3 reflectionColor=vec3(0.,0.,0.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords).rgb;
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor=toGammaSpace(reflectionColor);
#endif
reflectionColor*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor;
#else
color.rgb+=lightmapColor;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
gl_FragColor=color;
}
`,pbrVertexShader:`precision highp float;
#include<__decl__pbrVertex>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2; 
#endif 
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#if defined(ALBEDO) && ALBEDODIRECTUV == 0
varying vec2 vAlbedoUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0
varying vec2 vReflectivityUV;
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0
varying vec2 vMicroSurfaceSamplerUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#include<harmonicsFunctions>
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
void main(void) {
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;
#else
vPositionUVW=positionUpdated;
#endif
#endif 
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
vec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
vEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);
#endif
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif 
#ifdef MAINUV2
vMainUV2=uv2;
#endif 
#if defined(ALBEDO) && ALBEDODIRECTUV == 0 
if (vAlbedoInfos.x == 0.)
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));
}
else
{
vAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0 
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 
if (vReflectivityInfos.x == 0.)
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));
}
else
{
vReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 
if (vMicroSurfaceSamplerInfos.x == 0.)
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));
}
else
{
vMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0 
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<bumpVertex>

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif

#include<logDepthVertex>
}`,pbrPixelShader:`#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA)
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef LODBASEDMICROSFURACE
#extension GL_EXT_shader_texture_lod : enable
#endif
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
precision highp float;
#include<__decl__pbrFragment>
uniform vec4 vEyePosition;
uniform vec3 vAmbientColor;
uniform vec4 vCameraInfos;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif 
#ifdef MAINUV2 
varying vec2 vMainUV2;
#endif 
#ifdef NORMAL
varying vec3 vNormalW;
#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)
varying vec3 vEnvironmentIrradiance;
#endif
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif

#include<__decl__lightFragment>[0..maxSimultaneousLights]

#ifdef ALBEDO
#if ALBEDODIRECTUV == 1
#define vAlbedoUV vMainUV1
#elif ALBEDODIRECTUV == 2
#define vAlbedoUV vMainUV2
#else
varying vec2 vAlbedoUV;
#endif
uniform sampler2D albedoSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFLECTIVITY
#if REFLECTIVITYDIRECTUV == 1
#define vReflectivityUV vMainUV1
#elif REFLECTIVITYDIRECTUV == 2
#define vReflectivityUV vMainUV2
#else
varying vec2 vReflectivityUV;
#endif
uniform sampler2D reflectivitySampler;
#endif
#ifdef MICROSURFACEMAP
#if MICROSURFACEMAPDIRECTUV == 1
#define vMicroSurfaceSamplerUV vMainUV1
#elif MICROSURFACEMAPDIRECTUV == 2
#define vMicroSurfaceSamplerUV vMainUV2
#else
varying vec2 vMicroSurfaceSamplerUV;
#endif
uniform sampler2D microSurfaceSampler;
#endif

#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
#define sampleRefraction(s,c) textureCube(s,c)
uniform samplerCube refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#else
#define sampleRefraction(s,c) texture2D(s,c)
uniform sampler2D refractionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube refractionSamplerLow;
uniform samplerCube refractionSamplerHigh;
#endif
#endif
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef LODBASEDMICROSFURACE
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#ifdef ENVIRONMENTBRDF
uniform sampler2D environmentBrdfSampler;
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>

#include<shadowsFragmentFunctions>
#include<pbrFunctions>
#include<harmonicsFunctions>
#include<pbrLightFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>

#include<fogFragmentDeclaration>
void main(void) {
#include<clipPlaneFragment>


vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#endif
#include<bumpFragment>
#ifdef SPECULARAA
vec3 nDfdx=dFdx(normalW.xyz);
vec3 nDfdy=dFdy(normalW.xyz);
float slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));

float geometricRoughnessFactor=pow(clamp(slopeSquare ,0.,1.),0.333);

float geometricAlphaGFactor=sqrt(slopeSquare);
#else
float geometricRoughnessFactor=0.;
#endif
#if defined(FORCENORMALFORWARD) && defined(NORMAL)
vec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;
#if defined(TWOSIDEDLIGHTING)
faceNormal=gl_FrontFacing ? faceNormal : -faceNormal;
#endif
normalW*=sign(dot(normalW,faceNormal));
#endif
#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)
normalW=gl_FrontFacing ? normalW : -normalW;
#endif


vec3 surfaceAlbedo=vAlbedoColor.rgb;

float alpha=vAlbedoColor.a;
#ifdef ALBEDO
vec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);
#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)
alpha*=albedoTexture.a;
#endif
surfaceAlbedo*=toLinearSpace(albedoTexture.rgb);
surfaceAlbedo*=vAlbedoInfos.y;
#endif

#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
alpha=getLuminance(opacityMap.rgb);
#else
alpha*=opacityMap.a;
#endif
alpha*=vOpacityInfos.y;
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
surfaceAlbedo*=vColor.rgb;
#endif

vec3 ambientOcclusionColor=vec3(1.,1.,1.);
#ifdef AMBIENT
vec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#ifdef AMBIENTINGRAYSCALE
ambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);
#endif
ambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);
#endif
#ifdef UNLIT
vec3 diffuseBase=vec3(1.,1.,1.);
#else

float microSurface=vReflectivityColor.a;
vec3 surfaceReflectivityColor=vReflectivityColor.rgb;
#ifdef METALLICWORKFLOW
vec2 metallicRoughness=surfaceReflectivityColor.rg;
#ifdef REFLECTIVITY
vec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
#ifdef AOSTOREINMETALMAPRED
vec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);
ambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);
#endif
#ifdef METALLNESSSTOREINMETALMAPBLUE
metallicRoughness.r*=surfaceMetallicColorMap.b;
#else
metallicRoughness.r*=surfaceMetallicColorMap.r;
#endif
#ifdef ROUGHNESSSTOREINMETALMAPALPHA
metallicRoughness.g*=surfaceMetallicColorMap.a;
#else
#ifdef ROUGHNESSSTOREINMETALMAPGREEN
metallicRoughness.g*=surfaceMetallicColorMap.g;
#endif
#endif
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
metallicRoughness.g*=microSurfaceTexel.r;
#endif

microSurface=1.0-metallicRoughness.g;

vec3 baseColor=surfaceAlbedo;


const vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);

surfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);

surfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);
#else
#ifdef REFLECTIVITY
vec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);
surfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);
surfaceReflectivityColor*=vReflectivityInfos.y;
#ifdef MICROSURFACEFROMREFLECTIVITYMAP
microSurface*=surfaceReflectivityColorMap.a;
microSurface*=vReflectivityInfos.z;
#else
#ifdef MICROSURFACEAUTOMATIC
microSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);
#endif
#ifdef MICROSURFACEMAP
vec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;
microSurface*=microSurfaceTexel.r;
#endif
#endif
#endif
#endif

microSurface=clamp(microSurface,0.,1.);

float roughness=1.-microSurface;

#ifdef ALPHAFRESNEL
#if defined(ALPHATEST) || defined(ALPHABLEND)



float opacityPerceptual=alpha;
#ifdef LINEARALPHAFRESNEL
float opacity0=opacityPerceptual;
#else
float opacity0=opacityPerceptual*opacityPerceptual;
#endif
float opacity90=fresnelGrazingReflectance(opacity0);
vec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);

alpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;
#ifdef ALPHATEST
if (alpha<ALPHATESTVALUE)
discard;
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif
#endif
#endif


float NdotVUnclamped=dot(normalW,viewDirectionW);
float NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;
float alphaG=convertRoughnessToAverageSlope(roughness);
#ifdef SPECULARAA


alphaG+=(0.75*geometricAlphaGFactor);
#endif

#ifdef REFRACTION
vec4 environmentRefraction=vec4(0.,0.,0.,0.);
vec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);
#ifdef REFRACTIONMAP_OPPOSITEZ
refractionVector.z*=-1.0;
#endif

#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
vec3 refractionCoords=refractionVector;
refractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
#endif
#ifdef LODINREFRACTIONALPHA
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#else
float refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);
#endif
#ifdef LODBASEDMICROSFURACE

refractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;
#ifdef LODINREFRACTIONALPHA









float automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);
float requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);
#else
float requestedRefractionLOD=refractionLOD;
#endif
environmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);
#else
float lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);
float lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;
vec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);
if(lodRefractionNormalizedDoubled<1.0){
environmentRefraction=mix(
sampleRefraction(refractionSamplerHigh,refractionCoords),
environmentRefractionMid,
lodRefractionNormalizedDoubled
);
}else{
environmentRefraction=mix(
environmentRefractionMid,
sampleRefraction(refractionSamplerLow,refractionCoords),
lodRefractionNormalizedDoubled-1.0
);
}
#endif
#ifdef GAMMAREFRACTION
environmentRefraction.rgb=fromRGBD(environmentRefraction);
#endif
#ifdef RGBDREFRACTION
environmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);
#endif

environmentRefraction.rgb*=vRefractionInfos.x;
#endif

#ifdef REFLECTION
vec4 environmentRadiance=vec4(0.,0.,0.,0.);
vec3 environmentIrradiance=vec3(0.,0.,0.);
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);
#else
float reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);
#endif
#ifdef LODBASEDMICROSFURACE

reflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
#ifdef LODINREFLECTIONALPHA









float automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);
float requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);
#else
float requestedReflectionLOD=reflectionLOD;
#endif
environmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);
#else
float lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
environmentRadiance=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
environmentSpecularMid,
lodReflectionNormalizedDoubled
);
}else{
environmentRadiance=mix(
environmentSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#ifdef RGBDREFLECTION
environmentRadiance.rgb=fromRGBD(environmentRadiance);
#endif
#ifdef GAMMAREFLECTION
environmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);
#endif

#ifdef USESPHERICALFROMREFLECTIONMAP
#if defined(NORMAL) && defined(USESPHERICALINVERTEX)
environmentIrradiance=vEnvironmentIrradiance;
#else
vec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;
#ifdef REFLECTIONMAP_OPPOSITEZ
irradianceVector.z*=-1.0;
#endif
environmentIrradiance=environmentIrradianceJones(irradianceVector);
#endif
#endif

environmentRadiance.rgb*=vReflectionInfos.x;
environmentRadiance.rgb*=vReflectionColor.rgb;
environmentIrradiance*=vReflectionColor.rgb;
#endif



float reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);
float reflectance90=fresnelGrazingReflectance(reflectance);
vec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;
vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;

vec3 diffuseBase=vec3(0.,0.,0.);
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
#ifdef LIGHTMAP
vec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;
#ifdef GAMMALIGHTMAP
lightmapColor=toLinearSpace(lightmapColor);
#endif
lightmapColor*=vLightmapInfos.y;
#endif
lightingInfo info;
pointLightingInfo pointInfo;
spotLightingInfo spotInfo;
float shadow=1.; 
float NdotL=-1.;
#include<lightFragment>[0..maxSimultaneousLights]

#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)

vec2 brdfSamplerUV=vec2(NdotV,roughness);

vec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);
vec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#ifdef RADIANCEOCCLUSION
#ifdef AMBIENTINGRAYSCALE
float ambientMonochrome=ambientOcclusionColor.r;
#else
float ambientMonochrome=getLuminance(ambientOcclusionColor);
#endif
float seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);
specularEnvironmentReflectance*=seo;
#endif
#ifdef HORIZONOCCLUSION
#ifdef BUMP
#ifdef REFLECTIONMAP_3D
float eho=environmentHorizonOcclusion(-viewDirectionW,normalW);
specularEnvironmentReflectance*=eho;
#endif
#endif
#endif
#else

vec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));
#endif

#ifdef REFRACTION
vec3 refractance=vec3(0.0,0.0,0.0);
vec3 transmission=vec3(1.0,1.0,1.0);
#ifdef LINKREFRACTIONTOTRANSPARENCY

transmission*=(1.0-alpha);


vec3 mixedAlbedo=surfaceAlbedo;
float maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);
vec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);

surfaceAlbedo*=alpha;

environmentIrradiance*=alpha;

environmentRefraction.rgb*=tint;

alpha=1.0;
#endif

vec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);
specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);

transmission*=1.0-specularEnvironmentReflectance;

refractance=transmission;
#endif




surfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;

#ifdef REFLECTION
vec3 finalIrradiance=environmentIrradiance;
finalIrradiance*=surfaceAlbedo.rgb;
#endif

#ifdef SPECULARTERM
vec3 finalSpecular=specularBase;
finalSpecular=max(finalSpecular,0.0);

vec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;
#endif

#ifdef REFLECTION
vec3 finalRadiance=environmentRadiance.rgb;
finalRadiance*=specularEnvironmentReflectance;

vec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;
#endif

#ifdef REFRACTION
vec3 finalRefraction=environmentRefraction.rgb;
finalRefraction*=refractance;
#endif

#ifdef ALPHABLEND
float luminanceOverAlpha=0.0;
#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)
luminanceOverAlpha+=getLuminance(finalRadianceScaled);
#endif
#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)
luminanceOverAlpha+=getLuminance(finalSpecularScaled);
#endif
#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)
alpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);
#endif
#endif
#endif

vec3 finalDiffuse=diffuseBase;
finalDiffuse.rgb+=vAmbientColor;
finalDiffuse*=surfaceAlbedo.rgb;
finalDiffuse=max(finalDiffuse,0.0);

vec3 finalEmissive=vEmissiveColor;
#ifdef EMISSIVE
vec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;
finalEmissive*=toLinearSpace(emissiveColorTex.rgb);
finalEmissive*=vEmissiveInfos.y;
#endif

#ifdef AMBIENT
vec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);
#else
vec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;
#endif



vec4 finalColor=vec4(
finalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +
#ifndef UNLIT
#ifdef REFLECTION
finalIrradiance*ambientOcclusionColor*vLightingIntensity.z +
#endif
#ifdef SPECULARTERM


finalSpecularScaled +
#endif
#ifdef REFLECTION


finalRadianceScaled +
#endif
#ifdef REFRACTION
finalRefraction*vLightingIntensity.z +
#endif
#endif
finalEmissive*vLightingIntensity.y,
alpha);

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
finalColor.rgb*=lightmapColor;
#else
finalColor.rgb+=lightmapColor;
#endif
#endif
#endif

finalColor=max(finalColor,0.0);
#include<logDepthFragment>
#include<fogFragment>(color,finalColor)
#ifdef IMAGEPROCESSINGPOSTPROCESS


finalColor.rgb=clamp(finalColor.rgb,0.,30.0);
#else

finalColor=applyImageProcessing(finalColor);
#endif
#ifdef PREMULTIPLYALPHA

finalColor.rgb*=finalColor.a;
#endif
gl_FragColor=finalColor;



































}`,rgbdEncodePixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void) 
{
gl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);
}`,rgbdDecodePixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<helperFunctions>
void main(void) 
{
gl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);
}`,spritesVertexShader:`
attribute vec4 position;
attribute vec4 options;
attribute vec4 cellInfo;
attribute vec4 color;

uniform vec2 textureInfos;
uniform mat4 view;
uniform mat4 projection;

varying vec2 vUV;
varying vec4 vColor;
#include<fogVertexDeclaration>
void main(void) { 
vec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; 
vec2 cornerPos;
float angle=position.w;
vec2 size=vec2(options.x,options.y);
vec2 offset=options.zw;
vec2 uvScale=textureInfos.xy;
cornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

viewPos+=rotatedCorner;
gl_Position=projection*vec4(viewPos,1.0); 

vColor=color;

vec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));
vUV=(uvOffset+cellInfo.zw)*uvScale;

#ifdef FOG
vFogDistance=viewPos;
#endif
}`,spritesPixelShader:`uniform bool alphaTest;
varying vec4 vColor;

varying vec2 vUV;
uniform sampler2D diffuseSampler;

#include<fogFragmentDeclaration>
void main(void) {
vec4 color=texture2D(diffuseSampler,vUV);
if (alphaTest) 
{
if (color.a<0.95)
discard;
}
color*=vColor;
#include<fogFragment>
gl_FragColor=color;
}`,particlesVertexShader:`
attribute vec3 position;
attribute vec4 color;
attribute float angle;
attribute vec2 size;
#ifdef ANIMATESHEET 
attribute float cellIndex;
#endif
#ifndef BILLBOARD 
attribute vec3 direction;
#endif
#ifdef BILLBOARDSTRETCHED
attribute vec3 direction; 
#endif
#ifdef RAMPGRADIENT
attribute vec4 remapData;
#endif
attribute vec2 offset;

uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;
#ifdef ANIMATESHEET 
uniform vec3 particlesInfos; 
#endif

varying vec2 vUV;
varying vec4 vColor;
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
#endif
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration>
#ifdef BILLBOARD
uniform vec3 eyePosition; 
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner; 
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner; 
}
#endif
void main(void) { 
vec2 cornerPos;
cornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;
#ifdef BILLBOARD 

vec3 rotatedCorner;
#ifdef BILLBOARDY 
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz; 
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition; 
vec3 worldPos=rotateAlign(toCamera,rotatedCorner);
vec3 viewPos=(view*vec4(worldPos,1.0)).xyz; 
#else
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner; 
#endif
#ifdef RAMPGRADIENT
remapRanges=remapData;
#endif

gl_Position=projection*vec4(viewPos,1.0); 
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=normalize(direction);
vec3 worldPos=rotate(yaxis,rotatedCorner);
gl_Position=projection*view*vec4(worldPos,1.0); 
#endif 
vColor=color;
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/particlesInfos.z);
float columnOffset=cellIndex-rowOffset*particlesInfos.z;
vec2 uvScale=particlesInfos.xy;
vec2 uvOffset=vec2(offset.x ,1.0-offset.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else
vUV=offset;
#endif

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
vec4 worldPos=invView*vec4(viewPos,1.0);
#endif
#include<clipPlaneVertex>
}`,particlesPixelShader:`
varying vec2 vUV;
varying vec4 vColor;
uniform vec4 textureMask;
uniform sampler2D diffuseSampler;
#include<clipPlaneFragmentDeclaration>
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
#ifdef RAMPGRADIENT
varying vec4 remapRanges;
uniform sampler2D rampSampler;
#endif
void main(void) {
#include<clipPlaneFragment>
vec4 textureColor=texture2D(diffuseSampler,vUV);
vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;
#ifdef RAMPGRADIENT
float alpha=baseColor.a;
float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);
vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));
baseColor.rgb*=rampColor.rgb;

float finalAlpha=baseColor.a;
baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);
#endif
#ifdef BLENDMULTIPLYMODE
float sourceAlpha=vColor.a*textureColor.a;
baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);
#endif


#ifdef IMAGEPROCESSINGPOSTPROCESS
baseColor.rgb=toLinearSpace(baseColor.rgb);
#else
#ifdef IMAGEPROCESSING
baseColor.rgb=toLinearSpace(baseColor.rgb);
baseColor=applyImageProcessing(baseColor);
#endif
#endif
gl_FragColor=baseColor;
}`,colorVertexShader:`
attribute vec3 position;
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;

#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
void main(void) {
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#ifdef VERTEXCOLOR

vColor=color;
#endif
}`,colorPixelShader:`#ifdef VERTEXCOLOR
varying vec4 vColor;
#else
uniform vec4 color;
#endif
void main(void) {
#ifdef VERTEXCOLOR
gl_FragColor=vColor;
#else
gl_FragColor=color;
#endif
}`,gpuRenderParticlesVertexShader:`#version 300 es
uniform mat4 view;
uniform mat4 projection;
uniform vec2 translationPivot;

in vec3 position;
in float age;
in float life;
in vec3 size;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef BILLBOARDSTRETCHED
in vec3 direction;
#endif
in float angle;
#ifdef ANIMATESHEET
in float cellIndex;
#endif
in vec2 offset;
in vec2 uv;
out vec2 vUV;
out vec4 vColor;
#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
uniform mat4 invView;
#endif
#include<clipPlaneVertexDeclaration2>
#ifdef COLORGRADIENTS
uniform sampler2D colorGradientSampler;
#else
uniform vec4 colorDead;
in vec4 color;
#endif
#ifdef ANIMATESHEET
uniform vec3 sheetInfos;
#endif
#ifdef BILLBOARD
uniform vec3 eyePosition; 
#endif
vec3 rotate(vec3 yaxis,vec3 rotatedCorner) {
vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));
vec3 zaxis=normalize(cross(yaxis,xaxis));
vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);
vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);
vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner;
}
#ifdef BILLBOARDSTRETCHED
vec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {
vec3 normalizedToCamera=normalize(toCamera);
vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));
vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));
vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);
vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);
vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);
mat3 rotMatrix=mat3(row0,row1,row2);
vec3 alignedCorner=rotMatrix*rotatedCorner;
return position+alignedCorner; 
}
#endif
void main() {
#ifdef ANIMATESHEET
float rowOffset=floor(cellIndex/sheetInfos.z);
float columnOffset=cellIndex-rowOffset*sheetInfos.z;
vec2 uvScale=sheetInfos.xy;
vec2 uvOffset=vec2(uv.x ,1.0-uv.y);
vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;
#else 
vUV=uv;
#endif
float ratio=age/life;
#ifdef COLORGRADIENTS
vColor=texture(colorGradientSampler,vec2(ratio,0));
#else
vColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);
#endif
vec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;
#ifdef BILLBOARD
vec4 rotatedCorner;
rotatedCorner.w=0.;
#ifdef BILLBOARDY 
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.y=0.;
vec3 yaxis=position-eyePosition;
yaxis.y=0.;
vec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0)); 
#elif defined(BILLBOARDSTRETCHED)
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;
vec3 toCamera=position-eyePosition; 
vec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);
vec4 viewPosition=(view*vec4(worldPos,1.0)); 
#else

rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
rotatedCorner.z=0.;

vec4 viewPosition=view*vec4(position,1.0)+rotatedCorner;
#endif
#else

vec3 rotatedCorner;
rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);
rotatedCorner.y=0.;
rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);
vec3 yaxis=normalize(initialDirection);
vec3 worldPos=rotate(yaxis,rotatedCorner);

vec4 viewPosition=view*vec4(worldPos,1.0); 
#endif
gl_Position=projection*viewPosition;

#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)
vec4 worldPos=invView*viewPosition;
#endif 
#include<clipPlaneVertex>
}`,gpuRenderParticlesPixelShader:`#version 300 es
uniform sampler2D textureSampler;
in vec2 vUV;
in vec4 vColor;
out vec4 outFragColor;
#include<clipPlaneFragmentDeclaration2> 
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main() {
#include<clipPlaneFragment> 
vec4 textureColor=texture(textureSampler,vUV);
outFragColor=textureColor*vColor;
#ifdef BLENDMULTIPLYMODE
float alpha=vColor.a*textureColor.a;
outFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha); 
#endif 


#ifdef IMAGEPROCESSINGPOSTPROCESS
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
#else
#ifdef IMAGEPROCESSING
outFragColor.rgb=toLinearSpace(outFragColor.rgb);
outFragColor=applyImageProcessing(outFragColor);
#endif
#endif
}
`,gpuUpdateParticlesVertexShader:`#version 300 es
#define PI 3.14159
uniform float currentCount;
uniform float timeDelta;
uniform float stopFactor;
uniform mat4 emitterWM;
uniform vec2 lifeTime;
uniform vec2 emitPower;
uniform vec2 sizeRange;
uniform vec4 scaleRange;
#ifndef COLORGRADIENTS
uniform vec4 color1;
uniform vec4 color2;
#endif
uniform vec3 gravity;
uniform sampler2D randomSampler;
uniform sampler2D randomSampler2;
uniform vec4 angleRange;
#ifdef BOXEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
uniform vec3 minEmitBox;
uniform vec3 maxEmitBox;
#endif
#ifdef POINTEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#endif
#ifdef HEMISPHERICEMITTER
uniform float radius;
uniform float radiusRange;
uniform float directionRandomizer;
#endif
#ifdef SPHEREEMITTER
uniform float radius;
uniform float radiusRange;
#ifdef DIRECTEDSPHEREEMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CYLINDEREMITTER
uniform float radius;
uniform float height;
uniform float radiusRange;
#ifdef DIRECTEDCYLINDEREMITTER
uniform vec3 direction1;
uniform vec3 direction2;
#else
uniform float directionRandomizer;
#endif
#endif
#ifdef CONEEMITTER
uniform vec2 radius;
uniform float coneAngle;
uniform vec2 height;
uniform float directionRandomizer;
#endif

in vec3 position;
in float age;
in float life;
in vec4 seed;
in vec3 size;
#ifndef COLORGRADIENTS
in vec4 color;
#endif
in vec3 direction;
#ifndef BILLBOARD
in vec3 initialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
in float angle;
#else
in vec2 angle;
#endif
#ifdef ANIMATESHEET
in float cellIndex;
#ifdef ANIMATESHEETRANDOMSTART
in float cellStartOffset;
#endif
#endif
#ifdef NOISE
in vec3 noiseCoordinates1;
in vec3 noiseCoordinates2;
#endif

out vec3 outPosition;
out float outAge;
out float outLife;
out vec4 outSeed;
out vec3 outSize;
#ifndef COLORGRADIENTS
out vec4 outColor;
#endif
out vec3 outDirection;
#ifndef BILLBOARD
out vec3 outInitialDirection;
#endif
#ifdef ANGULARSPEEDGRADIENTS
out float outAngle;
#else
out vec2 outAngle;
#endif
#ifdef ANIMATESHEET
out float outCellIndex;
#ifdef ANIMATESHEETRANDOMSTART
out float outCellStartOffset;
#endif
#endif
#ifdef NOISE
out vec3 outNoiseCoordinates1;
out vec3 outNoiseCoordinates2;
#endif
#ifdef SIZEGRADIENTS
uniform sampler2D sizeGradientSampler;
#endif 
#ifdef ANGULARSPEEDGRADIENTS
uniform sampler2D angularSpeedGradientSampler;
#endif 
#ifdef VELOCITYGRADIENTS
uniform sampler2D velocityGradientSampler;
#endif
#ifdef LIMITVELOCITYGRADIENTS
uniform sampler2D limitVelocityGradientSampler;
uniform float limitVelocityDamping;
#endif
#ifdef DRAGGRADIENTS
uniform sampler2D dragGradientSampler;
#endif
#ifdef NOISE
uniform vec3 noiseStrength;
uniform sampler2D noiseSampler;
#endif
#ifdef ANIMATESHEET
uniform vec3 cellInfos;
#endif
vec3 getRandomVec3(float offset) {
return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;
}
vec4 getRandomVec4(float offset) {
return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));
}
void main() {
float newAge=age+timeDelta; 

if (newAge>=life && stopFactor != 0.) {
vec3 position;
vec3 direction;

vec4 randoms=getRandomVec4(seed.x);

outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;
outAge=mod(newAge,outLife);

outSeed=seed;

#ifdef SIZEGRADIENTS 
outSize.x=texture(sizeGradientSampler,vec2(0,0)).r;
#else
outSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;
#endif
outSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;
outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; 
#ifndef COLORGRADIENTS

outColor=color1+(color2-color1)*randoms.b;
#endif

#ifndef ANGULARSPEEDGRADIENTS 
outAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;
outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#else
outAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;
#endif 

#ifdef POINTEMITTER
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
position=vec3(0,0,0);
direction=direction1+(direction2-direction1)*randoms3;
#elif defined(BOXEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);
position=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;
direction=direction1+(direction2-direction1)*randoms3; 
#elif defined(HEMISPHERICEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
position=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);
direction=position+directionRandomizer*randoms3; 
#elif defined(SPHEREEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float phi=2.0*PI*randoms2.x;
float theta=acos(2.0*randoms2.y-1.0);
float randX=cos(phi)*sin(theta);
float randY=cos(theta);
float randZ=sin(phi)*sin(theta);
position=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);
#ifdef DIRECTEDSPHEREEMITTER
direction=direction1+(direction2-direction1)*randoms3;
#else

direction=position+directionRandomizer*randoms3;
#endif
#elif defined(CYLINDEREMITTER)
vec3 randoms2=getRandomVec3(seed.y);
vec3 randoms3=getRandomVec3(seed.z);

float yPos=(randoms2.x-0.5)*height;
float angle=randoms2.y*PI*2.;
float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));
float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));
float xPos=positionRadius*cos(angle);
float zPos=positionRadius*sin(angle);
position=vec3(xPos,yPos,zPos);
#ifdef DIRECTEDCYLINDEREMITTER
direction=direction1+(direction2-direction1)*randoms3;
#else

angle=angle+((randoms3.x-0.5)*PI);
direction=vec3(cos(angle),randoms3.y-0.5,sin(angle));
direction=normalize(direction);
#endif
#elif defined(CONEEMITTER)
vec3 randoms2=getRandomVec3(seed.y);
float s=2.0*PI*randoms2.x;
#ifdef CONEEMITTERSPAWNPOINT
float h=0.00001;
#else
float h=randoms2.y*height.y;

h=1.-h*h; 
#endif
float lRadius=radius.x-radius.x*randoms2.z*radius.y;
lRadius=lRadius*h;
float randX=lRadius*sin(s);
float randZ=lRadius*cos(s);
float randY=h*height.x;
position=vec3(randX,randY,randZ); 

if (abs(cos(coneAngle)) == 1.0) {
direction=vec3(0.,1.0,0.);
} else {
vec3 randoms3=getRandomVec3(seed.z);
direction=position+directionRandomizer*randoms3;
}
#else 

position=vec3(0.,0.,0.);

direction=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));
#endif
float power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;
outPosition=(emitterWM*vec4(position,1.)).xyz;
vec3 initial=(emitterWM*vec4(direction,0.)).xyz;
outDirection=initial*power;
#ifndef BILLBOARD 
outInitialDirection=initial;
#endif
#ifdef ANIMATESHEET 
outCellIndex=cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=randoms.a*outLife;
#endif 
#endif
#ifdef NOISE
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif
} else {
float directionScale=timeDelta;
outAge=newAge;
float ageGradient=newAge/life;
#ifdef VELOCITYGRADIENTS
directionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;
#endif
#ifdef DRAGGRADIENTS
directionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;
#endif
outPosition=position+direction*directionScale;
outLife=life;
outSeed=seed;
#ifndef COLORGRADIENTS 
outColor=color;
#endif
#ifdef SIZEGRADIENTS
outSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;
outSize.yz=size.yz;
#else
outSize=size;
#endif 
#ifndef BILLBOARD 
outInitialDirection=initialDirection;
#endif
vec3 updatedDirection=direction+gravity*timeDelta;
#ifdef LIMITVELOCITYGRADIENTS
float limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;
float currentVelocity=length(updatedDirection);
if (currentVelocity>limitVelocity) {
updatedDirection=updatedDirection*limitVelocityDamping;
}
#endif
outDirection=updatedDirection;
#ifdef NOISE
vec3 localPosition=outPosition-emitterWM[3].xyz;
float fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;
float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;
float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;
vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;
outDirection=outDirection+force*timeDelta;
outNoiseCoordinates1=noiseCoordinates1;
outNoiseCoordinates2=noiseCoordinates2;
#endif 
#ifdef ANGULARSPEEDGRADIENTS
float angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;
outAngle=angle+angularSpeed*timeDelta;
#else
outAngle=vec2(angle.x+angle.y*timeDelta,angle.y);
#endif
#ifdef ANIMATESHEET 
float offsetAge=outAge;
float dist=cellInfos.y-cellInfos.x;
#ifdef ANIMATESHEETRANDOMSTART
outCellStartOffset=cellStartOffset;
offsetAge+=cellStartOffset;
#endif 
float ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);
outCellIndex=float(int(cellInfos.x+ratio*dist));
#endif
}
}`,gpuUpdateParticlesPixelShader:`#version 300 es
void main() {
discard;
}
`,postprocessVertexShader:`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`,passPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
void main(void) 
{
gl_FragColor=texture2D(textureSampler,vUV);
}`,shadowMapVertexShader:`
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
uniform vec3 lightData;
#endif
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
#include<helperFunctions>
uniform mat4 viewProjection;
uniform vec3 biasAndScale;
uniform vec2 depthValues;
varying float vDepthMetric;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
void main(void)
{
vec3 positionUpdated=position;
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);

#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vec3 worldNor=normalize(normalWorld*normal);
#ifdef DIRECTIONINLIGHTDATA
vec3 worldLightDir=normalize(-lightData.xyz);
#else
vec3 directionToLight=lightData.xyz-worldPos.xyz;
vec3 worldLightDir=normalize(directionToLight);
#endif
float ndl=dot(worldNor,worldLightDir);
float sinNL=sqrt(1.0-ndl*ndl);
float normalBias=biasAndScale.y*sinNL;
worldPos.xyz-=worldNor*normalBias;
#endif

gl_Position=viewProjection*worldPos;
#ifdef DEPTHTEXTURE

gl_Position.z+=biasAndScale.x*gl_Position.w;
#endif

vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`,shadowMapPixelShader:`#ifndef FLOAT
vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
#endif
varying float vDepthMetric;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
uniform vec3 biasAndScale;
uniform vec2 depthValues;
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
float depth=vDepthMetric;
#ifdef ESM
depth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);
#endif
#ifdef FLOAT
gl_FragColor=vec4(depth,1.0,1.0,1.0);
#else
gl_FragColor=pack(depth);
#endif
}`,depthBoxBlurPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
void main(void)
{
vec4 colorDepth=vec4(0.0);
for (int x=-OFFSET; x<=OFFSET; x++)
for (int y=-OFFSET; y<=OFFSET; y++)
colorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);
gl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));
}`,proceduralVertexShader:`
attribute vec2 position;

varying vec2 vPosition;
varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
vPosition=position;
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`,depthVertexShader:`
attribute vec3 position;
#include<bonesDeclaration>

#include<instancesDeclaration>
uniform mat4 viewProjection;
uniform vec2 depthValues;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
varying float vDepthMetric;
void main(void)
{
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`,depthPixelShader:`#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
varying float vDepthMetric;
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
gl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);
}`,geometryVertexShader:`precision highp float;
precision highp int;
#include<bonesDeclaration>
#include<instancesDeclaration>
attribute vec3 position;
attribute vec3 normal;
#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
varying vec2 uv;
#endif
#ifdef UV2
varying vec2 uv2;
#endif
#endif

uniform mat4 viewProjection;
uniform mat4 view;
varying vec3 vNormalV;
varying vec4 vViewPos;
#ifdef POSITION
varying vec3 vPosition;
#endif
void main(void)
{
#include<instancesVertex>
#include<bonesVertex>
vec4 pos=vec4(finalWorld*vec4(position,1.0));
vNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));
vViewPos=view*pos;
#ifdef POSITION
vPosition=pos.xyz/pos.w;
#endif
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#if defined(ALPHATEST) || defined(BASIC_RENDER)
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`,geometryPixelShader:`#extension GL_EXT_draw_buffers : require
precision highp float;
precision highp int;
varying vec3 vNormalV;
varying vec4 vViewPos;
#ifdef POSITION
varying vec3 vPosition;
#endif
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#ifdef POSITION
#include<mrtFragmentDeclaration>[3]
#else
#include<mrtFragmentDeclaration>[2]
#endif
void main() {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
gl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);

gl_FragData[1]=vec4(normalize(vNormalV),1.0);

#ifdef POSITION
gl_FragData[2]=vec4(vPosition,1.0);
#endif
}`,ssaoPixelShader:`
uniform sampler2D textureSampler;
varying vec2 vUV;
#ifdef SSAO
uniform sampler2D randomSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float radius;
uniform float area;
uniform float fallOff;
uniform float base;
vec3 normalFromDepth(float depth,vec2 coords)
{
vec2 offset1=vec2(0.0,radius);
vec2 offset2=vec2(radius,0.0);
float depth1=texture2D(textureSampler,coords+offset1).r;
float depth2=texture2D(textureSampler,coords+offset2).r;
vec3 p1=vec3(offset1,depth1-depth);
vec3 p2=vec3(offset2,depth2-depth);
vec3 normal=cross(p1,p2);
normal.z=-normal.z;
return normalize(normal);
}
void main()
{
vec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);
float depth=texture2D(textureSampler,vUV).r;
vec3 position=vec3(vUV,depth);
vec3 normal=normalFromDepth(depth,vUV);
float radiusDepth=radius/depth;
float occlusion=0.0;
vec3 ray;
vec3 hemiRay;
float occlusionDepth;
float difference;
for (int i=0; i<SAMPLES; i++)
{
ray=radiusDepth*reflect(sampleSphere[i],random);
hemiRay=position+sign(dot(ray,normal))*ray;
occlusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;
difference=depth-occlusionDepth;
occlusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));
}
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor.r=result;
gl_FragColor.g=result;
gl_FragColor.b=result;
gl_FragColor.a=1.0;
}
#endif
`,ssao2PixelShader:`
precision highp float;
uniform sampler2D textureSampler;
uniform float near;
uniform float far;
uniform float radius;
float scales[16]=float[16](
0.1,
0.11406250000000001,
0.131640625,
0.15625,
0.187890625,
0.2265625,
0.272265625,
0.325,
0.384765625,
0.4515625,
0.525390625,
0.60625,
0.694140625,
0.7890625,
0.891015625,
1.0
);
varying vec2 vUV;
float perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {
return ( near*far )/( ( far-near )*invClipZ-far );
}
float viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {
return ( near*far/viewZ+far)/( far-near );
}
float viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {
return ( viewZ+near )/( near-far );
}
#ifdef SSAO
uniform sampler2D randomSampler;
uniform sampler2D normalSampler;
uniform float randTextureTiles;
uniform float samplesFactor;
uniform vec3 sampleSphere[SAMPLES];
uniform float totalStrength;
uniform float base;
uniform float xViewport;
uniform float yViewport;
uniform float maxZ;
uniform float minZAspect;
uniform vec2 texelSize;
uniform mat4 projection;
void main()
{
vec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;
float depth=texture2D(textureSampler,vUV).r;
float depthSign=depth/abs(depth);
depth=depth*depthSign;
vec3 normal=texture2D(normalSampler,vUV).rgb; 
float occlusion=0.0;
float correctedRadius=min(radius,minZAspect*depth/near);
vec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);
vec3 origin=vViewRay*depth;
vec3 rvec=random*2.0-1.0;
rvec.z=0.0;

float dotProduct=dot(rvec,normal);
rvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);
vec3 tangent=normalize(rvec-normal*dot(rvec,normal));
vec3 bitangent=cross(normal,tangent);
mat3 tbn=mat3(tangent,bitangent,normal);
float difference;
for (int i=0; i<SAMPLES; ++i) {

vec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];
samplePosition=samplePosition*correctedRadius+origin;

vec4 offset=vec4(samplePosition,1.0);
offset=projection*offset;
offset.xyz/=offset.w;
offset.xy=offset.xy*0.5+0.5;
if (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {
continue;
}

float sampleDepth=abs(texture2D(textureSampler,offset.xy).r);

difference=depthSign*samplePosition.z-sampleDepth;
float rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);
occlusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;
}
occlusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));
float ao=1.0-totalStrength*occlusion*samplesFactor;
float result=clamp(ao+base,0.0,1.0);
gl_FragColor=vec4(vec3(result),1.0);
}
#endif
#ifdef BILATERAL_BLUR
uniform sampler2D depthSampler;
uniform float outSize;
uniform float samplerOffsets[SAMPLES];
vec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.3846153846)*direction;
vec2 off2=vec2(3.2307692308)*direction;
color+=texture2D(image,uv)*0.2270270270;
color+=texture2D(image,uv+(off1/resolution))*0.3162162162;
color+=texture2D(image,uv-(off1/resolution))*0.3162162162;
color+=texture2D(image,uv+(off2/resolution))*0.0702702703;
color+=texture2D(image,uv-(off2/resolution))*0.0702702703;
return color;
}
vec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
color+=texture2D(image,uv)*0.1964825501511404;
color+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;
color+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;
color+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;
color+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;
return color;
}
vec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {
vec4 color=vec4(0.0);
vec2 off1=vec2(1.411764705882353)*direction;
vec2 off2=vec2(3.2941176470588234)*direction;
vec2 off3=vec2(5.176470588235294)*direction;
float compareDepth=abs(texture2D(depthSampler,uv).r);
float sampleDepth;
float weight;
float weightSum=30.0;
color+=texture2D(image,uv)*30.0;
sampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off1/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off2/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv+(off3/resolution))*weight;
sampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);
weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);
weightSum+=weight;
color+=texture2D(image,uv-(off3/resolution))*weight;
return color/weightSum;
}
void main()
{
#if EXPENSIVE
float compareDepth=abs(texture2D(depthSampler,vUV).r);
float texelsize=1.0/outSize;
float result=0.0;
float weightSum=0.0;
for (int i=0; i<SAMPLES; ++i)
{
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
vec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);
#else
vec2 direction=vec2(0.0,1.0);
vec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);
#endif
vec2 samplePos=vUV+sampleOffset;
float sampleDepth=abs(texture2D(depthSampler,samplePos).r);
float weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);
result+=texture2D(textureSampler,samplePos).r*weight;
weightSum+=weight;
}
result/=weightSum;
gl_FragColor.rgb=vec3(result);
gl_FragColor.a=1.0;
#else
vec4 color;
#ifdef BILATERAL_BLUR_H
vec2 direction=vec2(1.0,0.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#else
vec2 direction=vec2(0.0,1.0);
color=blur13Bilateral(textureSampler,vUV,outSize,direction);
#endif
gl_FragColor.rgb=vec3(color.r);
gl_FragColor.a=1.0;
#endif
}
#endif
`,ssaoCombinePixelShader:`uniform sampler2D textureSampler;
uniform sampler2D originalColor;
uniform vec4 viewport;
varying vec2 vUV;
void main(void) {
vec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);
vec4 sceneColor=texture2D(originalColor,vUV);
gl_FragColor=sceneColor*ssaoColor;
}
`,lensHighlightsPixelShader:`
uniform sampler2D textureSampler; 

uniform float gain;
uniform float threshold;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;

vec4 highlightColor(vec4 color) {
vec4 highlight=color;
float luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));
float lum_threshold;
if (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }
else { lum_threshold=0.5+0.44*threshold; }
luminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);
highlight*=luminance*gain;
highlight.a=1.0;
return highlight;
}
void main(void)
{
vec4 original=texture2D(textureSampler,vUV);

if (gain == -1.0) {
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
return;
}
float w=2.0/screen_width;
float h=2.0/screen_height;
float weight=1.0;

vec4 blurred=vec4(0.0,0.0,0.0,0.0);
#ifdef PENTAGON
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));
#else
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));
blurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));
#endif
blurred/=39.0;
gl_FragColor=blurred;

}`,depthOfFieldPixelShader:`




uniform sampler2D textureSampler;
uniform sampler2D highlightsSampler;
uniform sampler2D depthSampler;
uniform sampler2D grainSampler;

uniform float grain_amount;
uniform bool blur_noise;
uniform float screen_width;
uniform float screen_height;
uniform float distortion;
uniform bool dof_enabled;

uniform float screen_distance; 
uniform float aperture;
uniform float darken;
uniform float edge_blur;
uniform bool highlights;

uniform float near;
uniform float far;

varying vec2 vUV;

#define PI 3.14159265
#define TWOPI 6.28318530
#define inverse_focal_length 0.1 

vec2 centered_screen_pos;
vec2 distorted_coords;
float radius2;
float radius;

vec2 rand(vec2 co)
{
float noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));
float noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));
return clamp(vec2(noise1,noise2),0.0,1.0);
}

vec2 getDistortedCoords(vec2 coords) {
if (distortion == 0.0) { return coords; }
vec2 direction=1.0*normalize(centered_screen_pos);
vec2 dist_coords=vec2(0.5,0.5);
dist_coords.x=0.5+direction.x*radius2*1.0;
dist_coords.y=0.5+direction.y*radius2*1.0;
float dist_amount=clamp(distortion*0.23,0.0,1.0);
dist_coords=mix(coords,dist_coords,dist_amount);
return dist_coords;
}

float sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {

vec2 coords=distorted_coords;
float angle=rand(coords*100.0).x*TWOPI;
coords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));
color+=texture2D(textureSampler,coords)*weight;
return weight;
}

float getBlurLevel(float size) {
return min(3.0,ceil(size/1.0));
}

vec4 getBlurColor(float size) {
vec4 col=texture2D(textureSampler,distorted_coords);
if (size == 0.0) { return col; }


float blur_level=getBlurLevel(size);
float w=(size/screen_width);
float h=(size/screen_height);
float total_weight=1.0;
vec2 sample_coords;
total_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);
total_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);
total_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);
total_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);
total_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);
total_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);
total_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);
total_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);
total_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);
total_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);
if (blur_level>1.0) {
total_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);
total_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);
total_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);
total_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);
total_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);
total_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);
total_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);
total_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);
total_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);
total_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);
}
if (blur_level>2.0) {
total_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);
total_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);
total_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);
total_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);
total_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);
total_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);
total_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);
total_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);
total_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);
}
col/=total_weight; 

if (darken>0.0) {
col.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);
}




return col;
}
void main(void)
{

centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);
radius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;
radius=sqrt(radius2);
distorted_coords=getDistortedCoords(vUV); 
vec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); 
float depth=texture2D(depthSampler,distorted_coords).r; 
float distance=near+(far-near)*depth; 
vec4 color=texture2D(textureSampler,vUV); 


float coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));

if (dof_enabled == false || coc<0.07) { coc=0.0; }

float edge_blur_amount=0.0;
if (edge_blur>0.0) {
edge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;
}

float blur_amount=max(edge_blur_amount,coc);

if (blur_amount == 0.0) {
gl_FragColor=texture2D(textureSampler,distorted_coords);
}
else {

gl_FragColor=getBlurColor(blur_amount*1.7);

if (highlights) {
gl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;
}
if (blur_noise) {

vec2 noise=rand(distorted_coords)*0.01*blur_amount;
vec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);
gl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;
}
}

if (grain_amount>0.0) {
vec4 grain_color=texture2D(grainSampler,texels_coords*0.003);
gl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;
}
}
`,standardPixelShader:`uniform sampler2D textureSampler;
varying vec2 vUV;
#if defined(PASS_POST_PROCESS)
void main(void)
{
vec4 color=texture2D(textureSampler,vUV);
gl_FragColor=color;
}
#endif
#if defined(DOWN_SAMPLE_X4)
uniform vec2 dsOffsets[16];
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+dsOffsets[0]);
average+=texture2D(textureSampler,vUV+dsOffsets[1]);
average+=texture2D(textureSampler,vUV+dsOffsets[2]);
average+=texture2D(textureSampler,vUV+dsOffsets[3]);
average+=texture2D(textureSampler,vUV+dsOffsets[4]);
average+=texture2D(textureSampler,vUV+dsOffsets[5]);
average+=texture2D(textureSampler,vUV+dsOffsets[6]);
average+=texture2D(textureSampler,vUV+dsOffsets[7]);
average+=texture2D(textureSampler,vUV+dsOffsets[8]);
average+=texture2D(textureSampler,vUV+dsOffsets[9]);
average+=texture2D(textureSampler,vUV+dsOffsets[10]);
average+=texture2D(textureSampler,vUV+dsOffsets[11]);
average+=texture2D(textureSampler,vUV+dsOffsets[12]);
average+=texture2D(textureSampler,vUV+dsOffsets[13]);
average+=texture2D(textureSampler,vUV+dsOffsets[14]);
average+=texture2D(textureSampler,vUV+dsOffsets[15]);
average/=16.0;
gl_FragColor=average;
}
#endif
#if defined(BRIGHT_PASS)
uniform vec2 dsOffsets[4];
uniform float brightThreshold;
void main(void)
{
vec4 average=vec4(0.0,0.0,0.0,0.0);
average=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));
average+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));
average*=0.25;
float luminance=length(average.rgb);
if (luminance<brightThreshold) {
average=vec4(0.0,0.0,0.0,1.0);
}
gl_FragColor=average;
}
#endif
#if defined(TEXTURE_ADDER)
uniform sampler2D otherSampler;
uniform sampler2D lensSampler;
uniform float exposure;
void main(void)
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
colour*=exposure;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
colour+=colour*texture2D(lensSampler,vUV).rgb;
vec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);
gl_FragColor=finalColor;
}
#endif
#if defined(VLS)
#define PI 3.1415926535897932384626433832795
uniform mat4 shadowViewProjection;
uniform mat4 lightWorld;
uniform vec3 cameraPosition;
uniform vec3 sunDirection;
uniform vec3 sunColor;
uniform vec2 depthValues;
uniform float scatteringCoefficient;
uniform float scatteringPower;
uniform sampler2D shadowMapSampler;
uniform sampler2D positionSampler;
float computeScattering(float lightDotView)
{
float result=1.0-scatteringCoefficient*scatteringCoefficient;
result/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));
return result;
}
void main(void)
{

vec3 worldPos=texture2D(positionSampler,vUV).rgb;
vec3 startPosition=cameraPosition;
vec3 rayVector=worldPos-startPosition;
float rayLength=length(rayVector);
vec3 rayDirection=rayVector/rayLength;
float stepLength=rayLength/NB_STEPS;
vec3 stepL=rayDirection*stepLength;
vec3 currentPosition=startPosition;
vec3 accumFog=vec3(0.0);
for (int i=0; i<int(NB_STEPS); i++)
{
vec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);
float depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depthMetric,0.0,1.0);
worldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;
worldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);
float shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;
if (shadowMapValue>shadowPixelDepth)
accumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));
currentPosition+=stepL;
}
accumFog/=NB_STEPS;
vec3 color=accumFog*scatteringPower;
gl_FragColor=vec4(color*exp(color) ,1.0);
}
#endif
#if defined(VLSMERGE)
uniform sampler2D originalSampler;
void main(void)
{
gl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);
}
#endif
#if defined(LUMINANCE)
uniform vec2 lumOffsets[4];
void main()
{
float average=0.0;
vec4 color=vec4(0.0);
float maximum=-1e20;
vec3 weight=vec3(0.299,0.587,0.114);
for (int i=0; i<4; i++)
{
color=texture2D(textureSampler,vUV+ lumOffsets[i]);

float GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));

#ifdef WEIGHTED_AVERAGE
float GreyValue=dot(color.rgb,weight);
#endif
#ifdef BRIGHTNESS
float GreyValue=max(color.r,max(color.g,color.b));
#endif
#ifdef HSL_COMPONENT
float GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));
#endif
#ifdef MAGNITUDE
float GreyValue=length(color.rgb);
#endif
maximum=max(maximum,GreyValue);
average+=(0.25*log(1e-5+GreyValue));
}
average=exp(average);
gl_FragColor=vec4(average,maximum,0.0,1.0);
}
#endif
#if defined(LUMINANCE_DOWN_SAMPLE)
uniform vec2 dsOffsets[9];
uniform float halfDestPixelSize;
#ifdef FINAL_DOWN_SAMPLER
vec4 pack(float value) {
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(value*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
#endif
void main()
{
vec4 color=vec4(0.0);
float average=0.0;
for (int i=0; i<9; i++)
{
color=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);
average+=color.r;
}
average/=9.0;
#ifdef FINAL_DOWN_SAMPLER
gl_FragColor=pack(average);
#else
gl_FragColor=vec4(average,average,0.0,1.0);
#endif
}
#endif
#if defined(HDR)
uniform sampler2D textureAdderSampler;
uniform float averageLuminance;
void main()
{
vec4 color=texture2D(textureAdderSampler,vUV);
vec4 adjustedColor=color/averageLuminance;
color=adjustedColor;
color.a=1.0;
gl_FragColor=color;
}
#endif
#if defined(LENS_FLARE)
#define GHOSTS 3
uniform sampler2D lensColorSampler;
uniform float strength;
uniform float ghostDispersal;
uniform float haloWidth;
uniform vec2 resolution;
uniform float distortionStrength;
float hash(vec2 p)
{
float h=dot(p,vec2(127.1,311.7));
return -1.0+2.0*fract(sin(h)*43758.5453123);
}
float noise(in vec2 p)
{
vec2 i=floor(p);
vec2 f=fract(p);
vec2 u=f*f*(3.0-2.0*f);
return mix(mix(hash(i+vec2(0.0,0.0)),
hash(i+vec2(1.0,0.0)),u.x),
mix(hash(i+vec2(0.0,1.0)),
hash(i+vec2(1.0,1.0)),u.x),u.y);
}
float fbm(vec2 p)
{
float f=0.0;
f+=0.5000*noise(p); p*=2.02;
f+=0.2500*noise(p); p*=2.03;
f+=0.1250*noise(p); p*=2.01;
f+=0.0625*noise(p); p*=2.04;
f/=0.9375;
return f;
}
vec3 pattern(vec2 uv)
{
vec2 p=-1.0+2.0*uv;
float p2=dot(p,p);
float f=fbm(vec2(15.0*p2))/2.0;
float r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));
float g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));
float b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));
return (1.0-f)*vec3(r,g,b);
}
float luminance(vec3 color)
{
return dot(color.rgb,vec3(0.2126,0.7152,0.0722));
}
vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)
{
return vec4(
texture2D(tex,texcoord+direction*distortion.r).r,
texture2D(tex,texcoord+direction*distortion.g).g,
texture2D(tex,texcoord+direction*distortion.b).b,
1.0
);
}
void main(void)
{
vec2 uv=-vUV+vec2(1.0);
vec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;
vec2 texelSize=1.0/resolution;
vec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);
vec4 result=vec4(0.0);
float ghostIndice=1.0;
for (int i=0; i<GHOSTS; ++i)
{
vec2 offset=fract(uv+ghostDir*ghostIndice);
float weight=length(vec2(0.5)-offset)/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;
ghostIndice+=1.0;
}
vec2 haloVec=normalize(ghostDir)*haloWidth;
float weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));
weight=pow(1.0-weight,10.0);
result+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;
result*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));
gl_FragColor=result;
}
#endif
#if defined(LENS_FLARE_COMPOSE)
uniform sampler2D otherSampler;
uniform sampler2D lensDirtSampler;
uniform sampler2D lensStarSampler;
uniform mat4 lensStarMatrix;
void main(void)
{
vec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;
vec4 lensMod=texture2D(lensDirtSampler,vUV);
lensMod+=texture2D(lensStarSampler,vUV);
vec4 result=texture2D(textureSampler,vUV)*lensMod;
gl_FragColor=texture2D(otherSampler,vUV)+result;
}
#endif
#if defined(DEPTH_OF_FIELD)
uniform sampler2D otherSampler;
uniform sampler2D depthSampler;
uniform float distance;
void main(void)
{
vec4 sharp=texture2D(otherSampler,vUV);
vec4 blur=texture2D(textureSampler,vUV);
float dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);
float factor=0.0;
if (dist<0.05)
factor=1.0;
else if (dist<0.1)
factor=20.0*(0.1-dist);
else if (dist<0.5)
factor=0.0;
else
factor=2.0*(dist-0.5);
factor=clamp(factor,0.0,0.90);
gl_FragColor=mix(sharp,blur,factor);
}
#endif
#if defined(MOTION_BLUR)
uniform mat4 inverseViewProjection;
uniform mat4 prevViewProjection;
uniform vec2 screenSize;
uniform float motionScale;
uniform float motionStrength;
uniform sampler2D depthSampler;
void main(void)
{
vec2 texelSize=1.0/screenSize;
float depth=texture2D(depthSampler,vUV).r;
vec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);
cpos=cpos*inverseViewProjection;
vec4 ppos=cpos*prevViewProjection;
ppos.xyz/=ppos.w;
ppos.xy=ppos.xy*0.5+0.5;
vec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;
float speed=length(velocity/texelSize);
int nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));
vec4 result=texture2D(textureSampler,vUV);
for (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {
if (i>=nSamples)
break;
vec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);
result+=texture2D(textureSampler,offset1);
}
gl_FragColor=result/float(nSamples);
}
#endif
`,fxaaVertexShader:`
attribute vec2 position;
uniform vec2 texelSize;

varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
vUV=(position*madd+madd);
sampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;
sampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;
sampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;
sampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;
sampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;
sampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;
sampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;
sampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;
gl_Position=vec4(position,0.0,1.0);
}`,fxaaPixelShader:`uniform sampler2D textureSampler;
uniform vec2 texelSize;
varying vec2 vUV;
varying vec2 sampleCoordS;
varying vec2 sampleCoordE;
varying vec2 sampleCoordN;
varying vec2 sampleCoordW;
varying vec2 sampleCoordNW;
varying vec2 sampleCoordSE;
varying vec2 sampleCoordNE;
varying vec2 sampleCoordSW;
const float fxaaQualitySubpix=1.0;
const float fxaaQualityEdgeThreshold=0.166;
const float fxaaQualityEdgeThresholdMin=0.0833;
const vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);
#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)
void main(){
vec2 posM;
posM.x=vUV.x;
posM.y=vUV.y;
vec4 rgbyM=texture2D(textureSampler,vUV,0.0);
float lumaM=FxaaLuma(rgbyM);
float lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));
float lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));
float lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));
float lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
#ifndef MALI
if(range<rangeMaxClamped) 
{
gl_FragColor=rgbyM;
return;
}
#endif
float lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));
float lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));
float lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));
float lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=texelSize.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)
{
lumaN=lumaW;
}
if (!horzSpan) 
{
lumaS=lumaE;
}
if (horzSpan) 
{
lengthSign=texelSize.y;
}
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)
{
lengthSign=-lengthSign;
}
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan) ? 0.0 : texelSize.x;
offNP.y=(horzSpan) ? 0.0 : texelSize.y;
if (!horzSpan) 
{
posB.x+=lengthSign*0.5;
}
if (horzSpan)
{
posB.y+=lengthSign*0.5;
}
vec2 posN;
posN.x=posB.x-offNP.x*1.5;
posN.y=posB.y-offNP.y*1.5;
vec2 posP;
posP.x=posB.x+offNP.x*1.5;
posP.y=posB.y+offNP.y*1.5;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));
if (!pairN) 
{
lumaNN=lumaSS;
}
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) 
{
posN.x-=offNP.x*3.0;
}
if (!doneN) 
{
posN.y-=offNP.y*3.0;
}
bool doneNP=(!doneN) || (!doneP);
if (!doneP) 
{
posP.x+=offNP.x*3.0;
}
if (!doneP)
{
posP.y+=offNP.y*3.0;
}
if (doneNP)
{
if (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));
if (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));
if (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN) posN.x-=offNP.x*12.0;
if (!doneN) posN.y-=offNP.y*12.0;
doneNP=(!doneN) || (!doneP);
if (!doneP) posP.x+=offNP.x*12.0;
if (!doneP) posP.y+=offNP.y*12.0;
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)
{
dstN=posM.y-posN.y;
}
if (!horzSpan) 
{
dstP=posP.y-posM.y;
}
bool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN ? goodSpanN : goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan ? pixelOffset : 0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)
{
posM.x+=pixelOffsetSubpix*lengthSign;
}
if (horzSpan)
{
posM.y+=pixelOffsetSubpix*lengthSign;
}
#ifdef MALI
if(range<rangeMaxClamped) 
{
gl_FragColor=rgbyM;
}
else
{
gl_FragColor=texture2D(textureSampler,posM,0.0);
}
#else
gl_FragColor=texture2D(textureSampler,posM,0.0);
#endif
}`,chromaticAberrationPixelShader:`
uniform sampler2D textureSampler; 

uniform float chromatic_aberration;
uniform float radialIntensity;
uniform vec2 direction;
uniform vec2 centerPosition;
uniform float screen_width;
uniform float screen_height;

varying vec2 vUV;
void main(void)
{
vec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);
vec2 directionOfEffect=direction;
if(directionOfEffect.x == 0. && directionOfEffect.y == 0.){
directionOfEffect=normalize(centered_screen_pos);
}
float radius2=centered_screen_pos.x*centered_screen_pos.x
+centered_screen_pos.y*centered_screen_pos.y;
float radius=sqrt(radius2);
vec4 original=texture2D(textureSampler,vUV);

vec3 ref_indices=vec3(-0.3,0.0,0.3);
float ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;
float ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;

vec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);
vec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);
vec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);
original.r=texture2D(textureSampler,ref_coords_r).r;
original.g=texture2D(textureSampler,ref_coords_g).g;
original.b=texture2D(textureSampler,ref_coords_b).b;
original.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);
gl_FragColor=original;
}`,grainPixelShader:`#include<helperFunctions>

uniform sampler2D textureSampler; 

uniform float intensity;
uniform float animatedSeed;

varying vec2 vUV;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec2 seed=vUV*(animatedSeed);
float grain=dither(seed,intensity);

float lum=getLuminance(gl_FragColor.rgb);
float grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;
gl_FragColor.rgb+=grain*grainAmount;
gl_FragColor.rgb=max(gl_FragColor.rgb,0.0);
}`,sharpenPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform vec2 sharpnessAmounts;
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 color=texture2D(textureSampler,vUV);
vec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(1,0)) +
texture2D(textureSampler,vUV+onePixel*vec2(0,1)) -
color*4.0;
gl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);
}`,kernelBlurVertexShader:`
attribute vec2 position;

uniform vec2 delta;

varying vec2 sampleCenter;
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
sampleCenter=(position*madd+madd);
#include<kernelBlurVertex>[0..varyingCount]
gl_Position=vec4(position,0.0,1.0);
}`,kernelBlurPixelShader:`
uniform sampler2D textureSampler;
uniform vec2 delta;

varying vec2 sampleCenter;
#ifdef DOF
uniform sampler2D circleOfConfusionSampler;
uniform vec2 cameraMinMaxZ;
float sampleDistance(const in vec2 offset) {
float depth=texture2D(circleOfConfusionSampler,offset).g; 
return cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth; 
}
float sampleCoC(const in vec2 offset) {
float coc=texture2D(circleOfConfusionSampler,offset).r; 
return coc; 
}
#endif
#include<kernelBlurVaryingDeclaration>[0..varyingCount]
#ifdef PACKEDFLOAT
vec4 pack(float depth)
{
const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);
const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);
vec4 res=fract(depth*bit_shift);
res-=res.xxyz*bit_mask;
return res;
}
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
void main(void)
{
float computedWeight=0.0;
#ifdef PACKEDFLOAT 
float blend=0.;
#else
vec4 blend=vec4(0.);
#endif
#ifdef DOF
float sumOfWeights=CENTER_WEIGHT; 
float factor=0.0;

#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;
#else
blend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;
#endif
#endif
#include<kernelBlurFragment>[0..varyingCount]
#include<kernelBlurFragment2>[0..depCount]
#ifdef PACKEDFLOAT
gl_FragColor=pack(blend);
#else
gl_FragColor=blend;
#endif
#ifdef DOF
gl_FragColor/=sumOfWeights;
#endif
}`,depthOfFieldMergePixelShader:`uniform sampler2D textureSampler;
varying vec2 vUV;
uniform sampler2D circleOfConfusionSampler;
uniform sampler2D blurStep0;
#if BLUR_LEVEL>0
uniform sampler2D blurStep1;
#endif
#if BLUR_LEVEL>1
uniform sampler2D blurStep2;
#endif
void main(void)
{
float coc=texture2D(circleOfConfusionSampler,vUV).r;
#if BLUR_LEVEL == 0
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred0=texture2D(blurStep0,vUV);
gl_FragColor=mix(original,blurred0,coc);
#endif
#if BLUR_LEVEL == 1
if(coc<0.5){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(original,blurred1,coc/0.5);
}else{
vec4 blurred0=texture2D(blurStep0,vUV); 
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);
}
#endif
#if BLUR_LEVEL == 2
if(coc<0.33){
vec4 original=texture2D(textureSampler,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(original,blurred2,coc/0.33);
}else if(coc<0.66){
vec4 blurred1=texture2D(blurStep1,vUV);
vec4 blurred2=texture2D(blurStep2,vUV);
gl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);
}else{
vec4 blurred0=texture2D(blurStep0,vUV);
vec4 blurred1=texture2D(blurStep1,vUV);
gl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);
}
#endif
}
`,circleOfConfusionPixelShader:`
uniform sampler2D depthSampler;

varying vec2 vUV;

uniform vec2 cameraMinMaxZ;

uniform float focusDistance;
uniform float cocPrecalculation;
void main(void)
{
float depth=texture2D(depthSampler,vUV).r;
float pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0; 
float coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));
coc=clamp(coc,0.0,1.0);
gl_FragColor=vec4(coc,depth,coc,1.0);
}
`,bloomMergePixelShader:`uniform sampler2D textureSampler;
uniform sampler2D bloomBlur;
varying vec2 vUV;
uniform float bloomWeight;
void main(void)
{
gl_FragColor=texture2D(textureSampler,vUV);
vec3 blurred=texture2D(bloomBlur,vUV).rgb;
gl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight); 
}
`,extractHighlightsPixelShader:`#include<helperFunctions>

varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float threshold;
uniform float exposure;
void main(void) 
{
gl_FragColor=texture2D(textureSampler,vUV);
float luma=getLuminance(gl_FragColor.rgb*exposure);
gl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;
}`,refractionPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D refractionSampler;

uniform vec3 baseColor;
uniform float depth;
uniform float colorLevel;
void main() {
float ref=1.0-texture2D(refractionSampler,vUV).r;
vec2 uv=vUV-vec2(0.5);
vec2 offset=uv*depth*ref;
vec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;
gl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);
}`,blackAndWhitePixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform float degree;
void main(void) 
{
vec3 color=texture2D(textureSampler,vUV).rgb;
float luminance=dot(color,vec3(0.3,0.59,0.11)); 
vec3 blackAndWhite=vec3(luminance,luminance,luminance);
gl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);
}`,convolutionPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 screenSize;
uniform float kernel[9];
void main(void)
{
vec2 onePixel=vec2(1.0,1.0)/screenSize;
vec4 colorSum =
texture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +
texture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +
texture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +
texture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +
texture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +
texture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +
texture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +
texture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];
float kernelWeight =
kernel[0] +
kernel[1] +
kernel[2] +
kernel[3] +
kernel[4] +
kernel[5] +
kernel[6] +
kernel[7] +
kernel[8];
if (kernelWeight<=0.0) {
kernelWeight=1.0;
}
gl_FragColor=vec4((colorSum/kernelWeight).rgb,1);
}`,filterPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform mat4 kernelMatrix;
void main(void)
{
vec3 baseColor=texture2D(textureSampler,vUV).rgb;
vec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;
gl_FragColor=vec4(updatedColor,1.0);
}`,volumetricLightScatteringPixelShader:`uniform sampler2D textureSampler;
uniform sampler2D lightScatteringSampler;
uniform float decay;
uniform float exposure;
uniform float weight;
uniform float density;
uniform vec2 meshPositionOnScreen;
varying vec2 vUV;
void main(void) {
vec2 tc=vUV;
vec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);
deltaTexCoord*=1.0/float(NUM_SAMPLES)*density;
float illuminationDecay=1.0;
vec4 color=texture2D(lightScatteringSampler,tc)*0.4;
for(int i=0; i<NUM_SAMPLES; i++) {
tc-=deltaTexCoord;
vec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;
dataSample*=illuminationDecay*weight;
color+=dataSample;
illuminationDecay*=decay;
}
vec4 realColor=texture2D(textureSampler,vUV);
gl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));
}
`,volumetricLightScatteringPassPixelShader:`#if defined(ALPHATEST) || defined(NEED_UV)
varying vec2 vUV;
#endif
#if defined(ALPHATEST)
uniform sampler2D diffuseSampler;
#endif
void main(void)
{
#if defined(ALPHATEST)
vec4 diffuseColor=texture2D(diffuseSampler,vUV);
if (diffuseColor.a<0.4)
discard;
#endif
gl_FragColor=vec4(0.0,0.0,0.0,1.0);
}
`,colorCorrectionPixelShader:`
uniform sampler2D textureSampler; 
uniform sampler2D colorTable; 

varying vec2 vUV;

const float SLICE_COUNT=16.0; 

vec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {
float sliceSize=1.0/width; 
float slicePixelSize=sliceSize/width; 
float sliceInnerSize=slicePixelSize*(width-1.0); 
float zSlice0=min(floor(uv.z*width),width-1.0);
float zSlice1=min(zSlice0+1.0,width-1.0);
float xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;
float s0=xOffset+(zSlice0*sliceSize);
float s1=xOffset+(zSlice1*sliceSize);
vec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));
vec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));
float zOffset=mod(uv.z*width,1.0);
vec4 result=mix(slice0Color,slice1Color,zOffset);
return result;
}
void main(void)
{
vec4 screen_color=texture2D(textureSampler,vUV);
gl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);
}`,tonemapPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform float _ExposureAdjustment;
#if defined(HABLE_TONEMAPPING)
const float A=0.15;
const float B=0.50;
const float C=0.10;
const float D=0.20;
const float E=0.02;
const float F=0.30;
const float W=11.2;
#endif
float Luminance(vec3 c)
{
return dot(c,vec3(0.22,0.707,0.071));
}
void main(void) 
{
vec3 colour=texture2D(textureSampler,vUV).rgb;
#if defined(REINHARD_TONEMAPPING)
float lum=Luminance(colour.rgb); 
float lumTm=lum*_ExposureAdjustment;
float scale=lumTm/(1.0+lumTm); 
colour*=scale/lum;
#elif defined(HABLE_TONEMAPPING)
colour*=_ExposureAdjustment;
const float ExposureBias=2.0;
vec3 x=ExposureBias*colour;
vec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;
x=vec3(W,W,W);
vec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);
colour=curr*whiteScale;
#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)
colour*=_ExposureAdjustment;
vec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);
vec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);
colour=retColor*retColor;
#elif defined(PHOTOGRAPHIC_TONEMAPPING)
colour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);
#endif
gl_FragColor=vec4(colour.rgb,1.0);
}`,displayPassPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D passSampler;
void main(void)
{
gl_FragColor=texture2D(passSampler,vUV);
}`,highlightsPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
const vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);
void main(void) 
{
vec4 tex=texture2D(textureSampler,vUV);
vec3 c=tex.rgb;
float luma=dot(c.rgb,RGBLuminanceCoefficients);


gl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a); 
}`,imageProcessingPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
#include<imageProcessingDeclaration>
#include<helperFunctions>
#include<imageProcessingFunctions>
void main(void)
{
vec4 result=texture2D(textureSampler,vUV);
#ifdef IMAGEPROCESSING
#ifndef FROMLINEARSPACE

result.rgb=toLinearSpace(result.rgb);
#endif
result=applyImageProcessing(result);
#else

#ifdef FROMLINEARSPACE
result=applyImageProcessing(result);
#endif
#endif
gl_FragColor=result;
}`,lensFlareVertexShader:`
attribute vec2 position;

uniform mat4 viewportMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
vUV=position*madd+madd;
gl_Position=viewportMatrix*vec4(position,0.0,1.0);
}`,lensFlarePixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
gl_FragColor=baseColor*color;
}`,anaglyphPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform sampler2D leftSampler;
void main(void)
{
vec4 leftFrag=texture2D(leftSampler,vUV);
leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);
vec4 rightFrag=texture2D(textureSampler,vUV);
rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);
gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);
}`,stereoscopicInterlacePixelShader:`const vec3 TWO=vec3(2.0,2.0,2.0);
varying vec2 vUV;
uniform sampler2D camASampler;
uniform sampler2D textureSampler;
uniform vec2 stepSize;
void main(void)
{
bool useCamB;
vec2 texCoord1;
vec2 texCoord2;
vec3 frag1;
vec3 frag2;
#ifdef IS_STEREOSCOPIC_HORIZ
useCamB=vUV.x>0.5;
texCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);
texCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);
#else
useCamB=vUV.y>0.5;
texCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);
texCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);
#endif

if (useCamB){
frag1=texture2D(textureSampler,texCoord1).rgb;
frag2=texture2D(textureSampler,texCoord2).rgb;
}else{
frag1=texture2D(camASampler ,texCoord1).rgb;
frag2=texture2D(camASampler ,texCoord2).rgb;
}
gl_FragColor=vec4((frag1+frag2)/TWO,1.0);
}`,vrDistortionCorrectionPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
uniform vec2 LensCenter;
uniform vec2 Scale;
uniform vec2 ScaleIn;
uniform vec4 HmdWarpParam;
vec2 HmdWarp(vec2 in01) {
vec2 theta=(in01-LensCenter)*ScaleIn; 
float rSq=theta.x*theta.x+theta.y*theta.y;
vec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);
return LensCenter+Scale*rvector;
}
void main(void)
{
vec2 tc=HmdWarp(vUV);
if (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)
gl_FragColor=vec4(0.0,0.0,0.0,0.0);
else{
gl_FragColor=texture2D(textureSampler,tc);
}
}`,glowBlurPostProcessPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec2 screenSize;
uniform vec2 direction;
uniform float blurWidth;

float getLuminance(vec3 color)
{
return dot(color,vec3(0.2126,0.7152,0.0722));
}
void main(void)
{
float weights[7];
weights[0]=0.05;
weights[1]=0.1;
weights[2]=0.2;
weights[3]=0.3;
weights[4]=0.2;
weights[5]=0.1;
weights[6]=0.05;
vec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);
vec2 texelStep=texelSize*direction*blurWidth;
vec2 start=vUV-3.0*texelStep;
vec4 baseColor=vec4(0.,0.,0.,0.);
vec2 texelOffset=vec2(0.,0.);
for (int i=0; i<7; i++)
{

vec4 texel=texture2D(textureSampler,start+texelOffset);
baseColor.a+=texel.a*weights[i];

float luminance=getLuminance(baseColor.rgb);
float luminanceTexel=getLuminance(texel.rgb);
float choice=step(luminanceTexel,luminance);
baseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;
texelOffset+=texelStep;
}
gl_FragColor=baseColor;
}`,glowMapGenerationPixelShader:`#ifdef ALPHATEST
varying vec2 vUVDiffuse;
uniform sampler2D diffuseSampler;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform sampler2D emissiveSampler;
#endif
uniform vec4 color;
void main(void)
{
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUVDiffuse).a<0.4)
discard;
#endif
#ifdef EMISSIVE
gl_FragColor=texture2D(emissiveSampler,vUVEmissive)*color;
#else
gl_FragColor=color;
#endif
}`,glowMapGenerationVertexShader:`
attribute vec3 position;
#include<bonesDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]

#include<instancesDeclaration>
uniform mat4 viewProjection;
varying vec4 vPosition;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef ALPHATEST
varying vec2 vUVDiffuse;
uniform mat4 diffuseMatrix;
#endif
#ifdef EMISSIVE
varying vec2 vUVEmissive;
uniform mat4 emissiveMatrix;
#endif
void main(void)
{
vec3 positionUpdated=position;
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#include<instancesVertex>
#include<bonesVertex>
#ifdef CUBEMAP
vPosition=finalWorld*vec4(positionUpdated,1.0);
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
#else
vPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
gl_Position=vPosition;
#endif
#ifdef ALPHATEST
#ifdef DIFFUSEUV1
vUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef DIFFUSEUV2
vUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#ifdef EMISSIVE
#ifdef EMISSIVEUV1
vUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef EMISSIVEUV2
vUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
}`,glowMapMergePixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;
#ifdef EMISSIVE
uniform sampler2D textureSampler2;
#endif

uniform float offset;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef EMISSIVE
baseColor+=texture2D(textureSampler2,vUV);
baseColor*=offset;
#else
baseColor.a=abs(offset-baseColor.a);
#ifdef STROKE
float alpha=smoothstep(.0,.1,baseColor.a);
baseColor.a=alpha;
baseColor.rgb=baseColor.rgb*alpha;
#endif
#endif
gl_FragColor=baseColor;
}`,glowMapMergeVertexShader:`
attribute vec2 position;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=position*madd+madd;
gl_Position=vec4(position,0.0,1.0);
}`,lineVertexShader:`
attribute vec3 position;
attribute vec4 normal;

uniform mat4 worldViewProjection;
uniform float width;
uniform float aspectRatio;
void main(void) {
vec4 viewPosition=worldViewProjection*vec4(position,1.0);
vec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);
vec2 currentScreen=viewPosition.xy/viewPosition.w;
vec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;
currentScreen.x*=aspectRatio;
nextScreen.x*=aspectRatio;
vec2 dir=normalize(nextScreen-currentScreen);
vec2 normalDir=vec2(-dir.y,dir.x);
normalDir*=width/2.0;
normalDir.x/=aspectRatio;
vec4 offset=vec4(normalDir*normal.w,0.0,0.0);
gl_Position=viewPosition+offset;
}`,linePixelShader:`uniform vec4 color;
void main(void) {
gl_FragColor=color;
}`,outlineVertexShader:`
attribute vec3 position;
attribute vec3 normal;
#include<bonesDeclaration>

uniform float offset;
#include<instancesDeclaration>
uniform mat4 viewProjection;
#ifdef ALPHATEST
varying vec2 vUV;
uniform mat4 diffuseMatrix;
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#endif
#include<logDepthDeclaration>
void main(void)
{
vec3 offsetPosition=position+normal*offset;
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);
#ifdef ALPHATEST
#ifdef UV1
vUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
#endif
#ifdef UV2
vUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
#endif
#endif
#include<logDepthVertex>
}
`,outlinePixelShader:`#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
uniform vec4 color;
#ifdef ALPHATEST
varying vec2 vUV;
uniform sampler2D diffuseSampler;
#endif
#include<logDepthDeclaration>
void main(void) {
#ifdef ALPHATEST
if (texture2D(diffuseSampler,vUV).a<0.4)
discard;
#endif
#include<logDepthFragment>
gl_FragColor=color;
}`,layerVertexShader:`
attribute vec2 position;

uniform vec2 scale;
uniform vec2 offset;
uniform mat4 textureMatrix;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) { 
vec2 shiftedPosition=position*scale+offset;
vUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));
gl_Position=vec4(shiftedPosition,0.0,1.0);
}`,layerPixelShader:`
varying vec2 vUV;
uniform sampler2D textureSampler;

uniform vec4 color;
void main(void) {
vec4 baseColor=texture2D(textureSampler,vUV);
#ifdef ALPHATEST
if (baseColor.a<0.4)
discard;
#endif
gl_FragColor=baseColor*color;
}`,backgroundVertexShader:`precision highp float;
#include<__decl__backgroundVertex>
#include<helperFunctions>

attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#include<bonesDeclaration>

#include<instancesDeclaration>
#ifdef POINTSIZE
uniform float pointSize;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2; 
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
void main(void) {
#ifdef REFLECTIONMAP_SKYBOX
#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED
vPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;
#else
vPositionUVW=position;
#endif
#endif 
#include<instancesVertex>
#include<bonesVertex>
gl_Position=viewProjection*finalWorld*vec4(position,1.0);
vec4 worldPos=finalWorld*vec4(position,1.0);
vPositionW=vec3(worldPos);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normal);
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));
#ifdef EQUIRECTANGULAR_RELFECTION_FOV
mat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));
vec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));
if (fFovMultiplier<=1.0) {
vDirectionW=normalize(segment);
} else {
vDirectionW=normalize(vDirectionW+(vDirectionW-segment));
}
#endif
#endif
#ifndef UV1
vec2 uv=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uv;
#endif 
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0 
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif

#include<clipPlaneVertex>

#include<fogVertex>

#include<shadowsVertex>[0..maxSimultaneousLights]

#ifdef VERTEXCOLOR
vColor=color;
#endif

#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif
}
`,backgroundPixelShader:`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#define RECIPROCAL_PI2 0.15915494

uniform vec3 vEyePosition;

varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif 
#ifdef MAINUV2 
varying vec2 vMainUV2; 
#endif 
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;
uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif

#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif

#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<helperFunctions>
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#include<clipPlaneFragmentDeclaration>

#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);
}
#endif
void main(void) {
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif

float shadow=1.;
float globalShadow=0.;
float shadowLightCount=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif

vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif

#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT

reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;
reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=clamp(reflectionLOD,0.,1.);
float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;
vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);
if(lodReflectionNormalizedDoubled<1.0){
reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);
} else {
reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);
}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);
reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif

reflectionColor.rgb*=vReflectionInfos.x;
#endif

vec3 diffuseColor=vec3(1.,1.,1.);
float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif

diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif

#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);

#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif

#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;
vec3 reflectionReflectance0=vReflectionControl.yyy;
vec3 reflectionReflectance90=vReflectionControl.zzz;
float VdotN=dot(normalize(vEyePosition),normalW);
vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(clamp(VdotN,0.0,1.0),reflectionReflectance0,reflectionReflectance90,1.0);
reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-clamp(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w,0.0,1.0);
reflectionDistanceFalloff*=reflectionDistanceFalloff;
reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,clamp(reflectionAmount,0.,1.));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));

const float startAngle=0.1;
float fadeFactor=clamp(viewAngleToFloor/startAngle,0.0,1.0);
finalAlpha*=fadeFactor*fadeFactor;
#endif

#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif

vec4 color=vec4(finalColor,finalAlpha);
#include<fogFragment>
#ifdef IMAGEPROCESSINGPOSTPROCESS


color.rgb=clamp(color.rgb,0.,30.0);
#else

color=applyImageProcessing(color);
#endif
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#ifdef NOISE
color.rgb+=dither(vPositionW.xy,0.5);
color=max(color,0.0);
#endif
gl_FragColor=color;
}
`,noisePixelShader:`

uniform float brightness;
uniform float persistence;
uniform float timeScale;

varying vec2 vUV;

vec2 hash22(vec2 p)
{
p=p*mat2(127.1,311.7,269.5,183.3);
p=-1.0+2.0*fract(sin(p)*43758.5453123);
return sin(p*6.283+timeScale);
}
float interpolationNoise(vec2 p)
{
vec2 pi=floor(p);
vec2 pf=p-pi;
vec2 w=pf*pf*(3.-2.*pf);
float f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));
float f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));
float f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));
float f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));
float xm1=mix(f00,f10,w.x);
float xm2=mix(f01,f11,w.x);
float ym=mix(xm1,xm2,w.y); 
return ym;
}
float perlinNoise2D(float x,float y)
{
float sum=0.0;
float frequency=0.0;
float amplitude=0.0;
for(int i=0; i<OCTAVES; i++)
{
frequency=pow(2.0,float(i));
amplitude=pow(persistence,float(i));
sum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;
}
return sum;
}

void main(void)
{
float x=abs(vUV.x);
float y=abs(vUV.y);
float noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);
gl_FragColor=vec4(noise,noise,noise,1.0);
}
`};T.Effect.IncludesShadersStore={depthPrePass:`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`,bonesDeclaration:`#if NUM_BONE_INFLUENCERS>0
uniform mat4 mBones[BonesPerMesh];
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#endif`,instancesDeclaration:`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#else
uniform mat4 world;
#endif`,pointCloudVertexDeclaration:`#ifdef POINTSIZE
uniform float pointSize;
#endif`,bumpVertexDeclaration:`#if defined(BUMP) || defined(PARALLAX)
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#endif
`,clipPlaneVertexDeclaration:`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif`,fogVertexDeclaration:`#ifdef FOG
varying vec3 vFogDistance;
#endif`,morphTargetsVertexGlobalDeclaration:`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`,morphTargetsVertexDeclaration:`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#endif`,logDepthDeclaration:`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`,morphTargetsVertex:`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#endif`,instancesVertex:`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#else
mat4 finalWorld=world;
#endif`,bonesVertex:`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif 
finalWorld=finalWorld*influence;
#endif`,bumpVertex:`#if defined(BUMP) || defined(PARALLAX)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`,clipPlaneVertex:`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif`,fogVertex:`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`,shadowsVertex:`#ifdef SHADOWS
#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`,pointCloudVertex:`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`,logDepthVertex:`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`,helperFunctions:`const float PI=3.1415926535897932384626433832795;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
vec3 applyEaseInOut(vec3 x){
return x*x*(3.0-2.0*x);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
float square(float value)
{
return value*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=max(0.0000001,max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D); 
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}`,lightFragmentDeclaration:`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec3 vLightSpecular{X};
#else
vec3 vLightSpecular{X}=vec3(0.);
#endif
#ifdef SHADOW{X}
#if defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`,lightsFragmentFunctions:`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`,lightUboDeclaration:`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec3 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#if defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X}; 
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`,defaultVertexDeclaration:`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`,defaultFragmentDeclaration:`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY 
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#ifdef REFLECTIONMAP_SKYBOX
#else
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)
uniform mat4 reflectionMatrix;
#endif
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize; 
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`,defaultUboDeclaration:`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor; 
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix; 
vec4 vTangentSpaceParams;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
vec4 vDiffuseColor;
float pointSize; 
};
uniform Scene {
mat4 viewProjection;
mat4 view;
};`,shadowsFragmentFunctions:`#ifdef SHADOWS
#ifndef SHADOWFLOAT
float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
if (depth>shadow)
{
return darkness;
}
return 1.0;
}
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); 
return esm;
}
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
if (shadowPixelDepth>shadow)
{
return computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);
}
return 1.;
}
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
float shadowPixelDepth=clamp(depthMetric,0.,1.0); 
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
#ifdef WEBGL2

float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#endif
#endif
`,fresnelFunction:`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`,reflectionFunction:`#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
#endif
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vec3 direction=normalize(vDirectionW);
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y; 
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
return vec3(1.0-s,t,0);
#else
return vec3(s,t,0);
#endif
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
vec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y; 
return vec3(s,t,0);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
#endif
#ifdef REFLECTIONMAP_PLANAR
vec3 viewDir=worldPos.xyz-vEyePosition.xyz;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
#endif
#ifdef REFLECTIONMAP_CUBIC
vec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);

vec3 coords=reflect(viewDir,worldNormal);
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
coords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);
#endif
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
#endif
#ifdef REFLECTIONMAP_PROJECTION
return vec3(reflectionMatrix*(view*worldPos));
#endif
#ifdef REFLECTIONMAP_SKYBOX
return vPositionUVW;
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}`,imageProcessingDeclaration:`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`,imageProcessingFunctions:`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x; 
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=clamp(sliceUV,0.,1.);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=clamp(sliceUV,0.,1.);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=clamp(color,0.0,1.0);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=clamp(result.rgb,0.0,1.0);
#ifdef CONTRAST

vec3 resultHighContrast=applyEaseInOut(result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`,bumpFragmentFunctions:`#ifdef BUMP
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=vTangentSpaceParams.x;
bitangent*=vTangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
vec3 map=texture2D(bumpSampler,uv).xyz;
map=map*2.0-1.0;
#ifdef NORMALXYSCALE
map=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));
#endif
return normalize(cotangentFrame*map);
}
#ifdef PARALLAX
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif
#endif`,clipPlaneFragmentDeclaration:`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif`,fogFragmentDeclaration:`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`,clipPlaneFragment:`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif`,bumpFragment:`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#else 
float normalScale=vBumpInfos.y;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW); 
#else
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#endif
#endif`,lightFragment:`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))

#else
#ifdef PBR
#ifdef SPOTLIGHT{X}
spotInfo=computeSpotLightingInfo(light{X}.vLightData);
#ifdef LIGHT_FALLOFF_GLTF{X}
spotInfo.attenuation=computeDistanceLightFalloff_GLTF(spotInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
spotInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
spotInfo.attenuation=computeDistanceLightFalloff_Physical(spotInfo.lightDistanceSquared);
spotInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
spotInfo.attenuation=computeDistanceLightFalloff_Standard(spotInfo.lightOffset,light{X}.vLightFalloff.x);
spotInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
spotInfo.attenuation=computeDistanceLightFalloff(spotInfo.lightOffset,spotInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
spotInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,spotInfo.directionToLightCenterW,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
info=computeSpotLighting(spotInfo,viewDirectionW,normalW,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);
#elif defined(POINTLIGHT{X})
pointInfo=computePointLightingInfo(light{X}.vLightData);
#ifdef LIGHT_FALLOFF_GLTF{X}
pointInfo.attenuation=computeDistanceLightFalloff_GLTF(pointInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
pointInfo.attenuation=computeDistanceLightFalloff_Physical(pointInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
pointInfo.attenuation=computeDistanceLightFalloff_Standard(pointInfo.lightOffset,light{X}.vLightFalloff.x);
#else
pointInfo.attenuation=computeDistanceLightFalloff(pointInfo.lightOffset,pointInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
info=computePointLighting(pointInfo,viewDirectionW,normalW,light{X}.vLightDiffuse.rgb,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);
#elif defined(DIRLIGHT{X})
info=computeDirectionalLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,geometricRoughnessFactor,NdotL);
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCLOSEESM{X}
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor;
#endif
#endif
#else
diffuseBase+=info.diffuse*shadow;
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#endif
#endif
#endif`,logDepthFragment:`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`,fogFragment:`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`,pbrVertexDeclaration:`uniform mat4 view;
uniform mat4 viewProjection;
#ifdef ALBEDO
uniform mat4 albedoMatrix;
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec4 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#ifdef REFLECTIVITY 
uniform vec3 vReflectivityInfos;
uniform mat4 reflectivityMatrix;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
uniform mat4 microSurfaceSamplerMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif

#ifdef REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
`,pbrFragmentDeclaration:`uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;

uniform vec4 vLightingIntensity;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;

#ifdef ALBEDO
uniform vec2 vAlbedoInfos;
#endif
#ifdef AMBIENT
uniform vec4 vAmbientInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#ifdef OPACITY 
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef REFLECTIVITY
uniform vec3 vReflectivityInfos;
#endif
#ifdef MICROSURFACEMAP
uniform vec2 vMicroSurfaceSamplerInfos;
#endif

#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif

#ifdef REFRACTION
uniform vec4 vRefractionInfos;
uniform mat4 refractionMatrix;
uniform vec3 vRefractionMicrosurfaceInfos;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize; 
#endif
#endif`,pbrUboDeclaration:`layout(std140,column_major) uniform;
uniform Material
{
uniform vec2 vAlbedoInfos;
uniform vec4 vAmbientInfos;
uniform vec2 vOpacityInfos;
uniform vec2 vEmissiveInfos;
uniform vec2 vLightmapInfos;
uniform vec3 vReflectivityInfos;
uniform vec2 vMicroSurfaceSamplerInfos;
uniform vec4 vRefractionInfos;
uniform vec2 vReflectionInfos;
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize; 
uniform vec3 vBumpInfos;
uniform mat4 albedoMatrix;
uniform mat4 ambientMatrix;
uniform mat4 opacityMatrix;
uniform mat4 emissiveMatrix;
uniform mat4 lightmapMatrix;
uniform mat4 reflectivityMatrix;
uniform mat4 microSurfaceSamplerMatrix;
uniform mat4 bumpMatrix;
uniform vec2 vTangentSpaceParams;
uniform mat4 refractionMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionColor;
uniform vec4 vAlbedoColor;
uniform vec4 vLightingIntensity;
uniform vec3 vRefractionMicrosurfaceInfos;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform vec4 vReflectivityColor;
uniform vec3 vEmissiveColor;
uniform float pointSize;
};
uniform Scene {
mat4 viewProjection;
mat4 view;
};`,pbrFunctions:`
#define RECIPROCAL_PI2 0.15915494
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25

const float kRougnhessToAlphaScale=0.1;
const float kRougnhessToAlphaOffset=0.29248125;
float convertRoughnessToAverageSlope(float roughness)
{

const float kMinimumVariance=0.0005;
float alphaG=square(roughness)+kMinimumVariance;
return alphaG;
}

float smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)
{
float tanSquared=(1.0-dot*dot)/(dot*dot);
return 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));
}
float smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)
{
return smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);
}


float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);
}
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);
}

vec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor)
{
roughness=max(roughness,geometricRoughnessFactor);
float alphaG=convertRoughnessToAverageSlope(roughness);
float distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);
float visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);
visibility/=(4.0*NdotL*NdotV); 
float specTerm=max(0.,visibility*distribution)*NdotL;
vec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);
return fresnel*specTerm;
}
float computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)
{


float diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);
float diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel*NdotL/PI;
}
float adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)
{
#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)

float lightRoughness=lightRadius/lightDistance;

float totalRoughness=clamp(lightRoughness+roughness,0.,1.);
return totalRoughness;
#else
return roughness;
#endif
}
float computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)
{
const float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;
float reflectivityLuminance=getLuminance(reflectivityColor);
float reflectivityLuma=sqrt(reflectivityLuminance);
microSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;
return microSurface;
}


float fresnelGrazingReflectance(float reflectance0) {
float reflectance90=clamp(reflectance0*25.0,0.0,1.0);
return reflectance90;
}


#define UNPACK_LOD(x) (1.0-x)*255.0
float getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {
float microsurfaceAverageSlope=alphaG;






microsurfaceAverageSlope*=sqrt(abs(NdotV));
float microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;
float lod=log2(microsurfaceAverageSlopeTexels);
return lod;
}
float environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {


float temp=NdotVUnclamped+ambientOcclusion;
return clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);
}
float environmentHorizonOcclusion(vec3 view,vec3 normal) {

vec3 reflection=reflect(view,normal);
float temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);
return square(temp);
}`,harmonicsFunctions:`#ifdef USESPHERICALFROMREFLECTIONMAP
uniform vec3 vSphericalX;
uniform vec3 vSphericalY;
uniform vec3 vSphericalZ;
uniform vec3 vSphericalXX_ZZ;
uniform vec3 vSphericalYY_ZZ;
uniform vec3 vSphericalZZ;
uniform vec3 vSphericalXY;
uniform vec3 vSphericalYZ;
uniform vec3 vSphericalZX;
vec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){
vec3 T=cross(Q.xyz,V);
T+=Q.www*V;
return cross(Q.xyz,T)+V;
}
vec3 environmentIrradianceJones(vec3 normal)
{









float Nx=normal.x;
float Ny=normal.y;
float Nz=normal.z;
vec3 C1=vSphericalZZ.rgb;
vec3 Cx=vSphericalX.rgb;
vec3 Cy=vSphericalY.rgb;
vec3 Cz=vSphericalZ.rgb;
vec3 Cxx_zz=vSphericalXX_ZZ.rgb;
vec3 Cyy_zz=vSphericalYY_ZZ.rgb;
vec3 Cxy=vSphericalXY.rgb;
vec3 Cyz=vSphericalYZ.rgb;
vec3 Czx=vSphericalZX.rgb;
vec3 a1=Cyy_zz*Ny+Cy;
vec3 a2=Cyz*Nz+a1;
vec3 b1=Czx*Nz+Cx;
vec3 b2=Cxy*Ny+b1;
vec3 b3=Cxx_zz*Nx+b2;
vec3 t1=Cz*Nz+C1;
vec3 t2=a2*Ny+t1;
vec3 t3=b3*Nx+t2;
return t3;
}
#endif`,pbrLightFunctions:`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
};
struct pointLightingInfo
{
vec3 lightOffset;
float lightDistanceSquared;
float attenuation;
};
struct spotLightingInfo
{
vec3 lightOffset;
float lightDistanceSquared;
vec3 directionToLightCenterW;
float attenuation;
};
float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)
{
return max(0.,1.0-length(lightOffset)/range);
}
float computeDistanceLightFalloff_Physical(float lightDistanceSquared)
{
return 1.0/((lightDistanceSquared+0.001));
}
float computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)
{
const float minDistanceSquared=0.01*0.01;
float lightDistanceFalloff=1.0/(max(lightDistanceSquared,minDistanceSquared));
float factor=lightDistanceSquared*inverseSquaredRange;
float attenuation=clamp(1.0-factor*factor,0.,1.);
attenuation*=attenuation;

lightDistanceFalloff*=attenuation;
return lightDistanceFalloff;
}
float computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)
{ 
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDistanceLightFalloff_Physical(lightDistanceSquared);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);
#else
return computeDistanceLightFalloff_Standard(lightOffset,range);
#endif
}
float computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)
{
float falloff=0.0;
float cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));
if (cosAngle>=cosHalfAngle)
{
falloff=max(0.,pow(cosAngle,exponent));
}
return falloff;
}
float computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)
{
const float kMinusLog2ConeAngleIntensityRatio=6.64385618977; 





float concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);


vec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);
float falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));
return falloff;
}
float computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)
{



float cd=dot(-lightDirection,directionToLightCenterW);
float falloff=clamp(cd*lightAngleScale+lightAngleOffset,0.,1.);

falloff*=falloff;
return falloff;
}
float computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)
{
#ifdef USEPHYSICALLIGHTFALLOFF
return computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);
#elif defined(USEGLTFLIGHTFALLOFF)
return computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);
#else
return computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);
#endif
}
pointLightingInfo computePointLightingInfo(vec4 lightData) {
pointLightingInfo result;
result.lightOffset=lightData.xyz-vPositionW;
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);
return result;
}
spotLightingInfo computeSpotLightingInfo(vec4 lightData) {
spotLightingInfo result;
result.lightOffset=lightData.xyz-vPositionW;
result.directionToLightCenterW=normalize(result.lightOffset);
result.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);
return result;
}
lightingInfo computePointLighting(pointLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {
lightingInfo result;
float lightDistance=sqrt(info.lightDistanceSquared);
vec3 lightDirection=normalize(info.lightOffset);

roughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);

vec3 H=normalize(viewDirectionW+lightDirection);
NdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);
float VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);
float diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);
result.diffuse=diffuseTerm*diffuseColor*info.attenuation;
#ifdef SPECULARTERM

float NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);
vec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);
result.specular=specTerm*diffuseColor*info.attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(spotLightingInfo info,vec3 viewDirectionW,vec3 vNormal,vec4 lightDirection,vec3 diffuseColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {
lightingInfo result;

float lightDistance=sqrt(info.lightDistanceSquared);
roughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);

vec3 H=normalize(viewDirectionW+info.directionToLightCenterW);
NdotL=clamp(dot(vNormal,info.directionToLightCenterW),0.000000000001,1.0);
float VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);
float diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);
result.diffuse=diffuseTerm*diffuseColor*info.attenuation;
#ifdef SPECULARTERM

float NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);
vec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);
result.specular=specTerm*diffuseColor*info.attenuation;
#endif
return result;
}
lightingInfo computeDirectionalLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float lightRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {
lightingInfo result;
float lightDistance=length(-lightData.xyz);
vec3 lightDirection=normalize(-lightData.xyz);

roughness=adjustRoughnessFromLightProperties(roughness,lightRadius,lightDistance);

vec3 H=normalize(viewDirectionW+lightDirection);
NdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);
float VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);
float diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);
result.diffuse=diffuseTerm*diffuseColor;
#ifdef SPECULARTERM

float NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);
vec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);
result.specular=specTerm*diffuseColor;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,out float NdotL) {
lightingInfo result;



NdotL=dot(vNormal,lightData.xyz)*0.5+0.5;
result.diffuse=mix(groundColor,diffuseColor,NdotL);
#ifdef SPECULARTERM

vec3 lightVectorW=normalize(lightData.xyz);
vec3 H=normalize(viewDirectionW+lightVectorW);
float NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);
NdotL=clamp(NdotL,0.000000000001,1.0);
float VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);
vec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90,geometricRoughnessFactor);
result.specular=specTerm*diffuseColor;
#endif
return result;
}
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return toLinearSpace(textureColor);
}`,clipPlaneVertexDeclaration2:`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
out float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
out float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
out float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
out float fClipDistance4;
#endif`,clipPlaneFragmentDeclaration2:`#ifdef CLIPPLANE
in float fClipDistance;
#endif
#ifdef CLIPPLANE2
in float fClipDistance2;
#endif
#ifdef CLIPPLANE3
in float fClipDistance3;
#endif
#ifdef CLIPPLANE4
in float fClipDistance4;
#endif`,mrtFragmentDeclaration:`#if __VERSION__>=200
layout(location=0) out vec4 glFragData[{X}];
#endif
`,bones300Declaration:`#if NUM_BONE_INFLUENCERS>0
uniform mat4 mBones[BonesPerMesh];
in vec4 matricesIndices;
in vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
in vec4 matricesIndicesExtra;
in vec4 matricesWeightsExtra;
#endif
#endif`,instances300Declaration:`#ifdef INSTANCES
in vec4 world0;
in vec4 world1;
in vec4 world2;
in vec4 world3;
#else
uniform mat4 world;
#endif`,kernelBlurFragment:`#ifdef DOF
factor=sampleCoC(sampleCoord{X}); 
computedWeight=KERNEL_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;
#endif`,kernelBlurFragment2:`#ifdef DOF
factor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});
computedWeight=KERNEL_DEP_WEIGHT{X}*factor;
sumOfWeights+=computedWeight;
#else
computedWeight=KERNEL_DEP_WEIGHT{X};
#endif
#ifdef PACKEDFLOAT
blend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;
#else
blend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;
#endif`,kernelBlurVaryingDeclaration:"varying vec2 sampleCoord{X};",kernelBlurVertex:"sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",backgroundVertexDeclaration:`uniform mat4 view;
uniform mat4 viewProjection;
uniform float shadowLevel;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif`,backgroundFragmentDeclaration:` uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;
uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif`,backgroundUboDeclaration:`layout(std140,column_major) uniform;
uniform Material
{
uniform vec4 vPrimaryColor;
uniform vec4 vPrimaryColorShadow;
uniform vec2 vDiffuseInfos;
uniform vec2 vReflectionInfos;
uniform mat4 diffuseMatrix;
uniform mat4 reflectionMatrix;
uniform vec3 vReflectionMicrosurfaceInfos;
uniform float fFovMultiplier;
uniform float pointSize;
uniform float shadowLevel;
uniform float alpha;
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
};
uniform Scene {
mat4 viewProjection;
mat4 view;
};`};var Ze=void 0,Cs=!1,Ta=!1,Rs=!1,ws="",xt,ne,Br,ae={};var rr,Qa,Gr=!1,xe=!1,kt=null;var Dl=null,$t=!1;var ar={},Is,nr=!1,Ds=null,Tt,kl,xr,Mr,Jt={},Ci=!1,ks=!1,Fs=!1;var Yr,Za=null,Un=null,bt=null,Sr=!1,zn=!1;var Fl=!1,Al=[],Vl={},Ea,Ri,Gl,sr=0,ai,Pi,As,Ul=!1,ir=null,ea=null;var Pa=!1;var qa,ot=[],zl=!1;var ut,vi,Ai,Vs=document.createElement("canvas"),Hl,sn,tr,ta=!1,qr,on=!1,Wt,Wi;var ci=!0,Ja=navigator.language,$a;var Ol=parsedUrl.query.debug;var Ut=null,Wl;var Xl=null,Yt=!0,Gs=!1,Ll=!1,Us="",ni=null;var hs=1e4;var Nl=!1,Hn=!1;var Ui=null;var jl=5831,zs=!1,Hs=!0,fs=!1,ln=!1,yi=null,On,cn=!1,Et;var Kl,Ql=!1;var un=!1,Kt=null,Wn=!1,ds={discord:0,ticTok:0},Tr={},Os=["midMonthGiveMeEggs","newYolkerSignupReward","newYolkerItemReward","newYolkerWelcomeBack","WelcomeBack","mercZoneFinalGift","merryEggsmas"],Zl={premFeatOne:0,premFeatTwo:0},Ht={text:["rgba(254,216,56,1)","rgba(64, 224, 255, 1)","rgba(255, 192, 160, 1)"],meBackground:["rgba(255, 192, 64, 0.75)","rgba(0, 192, 255, 0.8)","rgba(192, 64, 32, 0.8)"],themBackground:["rgba(0, 0, 0, 0.25)","rgba(0, 64, 192, 0.3)","rgba(192, 64, 32, 0.3)"],summaryBackground:["rgba(64, 64, 64, 0.75)","rgba(0, 64, 192, 0.75)","rgba(192, 64, 32, 0.75)"],outline:[new T.Color4(1,1,1,0),new T.Color4(0,.75,1,1),new T.Color4(1,.25,.25,1)],textColor:[new T.Color4(1,1,1,1),new T.Color4(0,.75,1,1),new T.Color4(1,.25,.25,1)],meClass:["playerSlot-me","playerSlot-me-blue","playerSlot-me-red"],themClass:["playerSlot-them","playerSlot-them-blue","playerSlot-them-red"]},ql={isCaseSensitive:!1,includeScore:!0,shouldSort:!0,includeMatches:!0,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.2,distance:100,useExtendedSearch:!0,keys:["name","unlock","item_data.tags","item_data.meshName"]},Ws=!1,Xs=[{version:"0.46.6",date:"January 15 2024",content:["Welcome to a massive year in Shell Shockers!","Introducing first, the Racer set PERMANENTLY to the store - made by Discord's tz","2x VIP items for the Very Important Poultry - Grab the Premium Racer Wings & Rogue Tire Grenade now","The Premium Infernal Free-Ranger - truly an egg's best fiend (get it?)","It's still a happy Blue year - pick up the 2024 skins before they are gone next update!","Boundaries on ALL maps tweaked to make way for low gravity... coming soon!","Map Changes: KotC added to Shellville & Rameses, Palace Siege UPGRADED, Rameses Overhauled!","Public maps are: Raceway, Cash, Blue, Palace Siege, Shellville, Rameses, Chicken Itza, Two Towers, Castle, Ruins, Helix, & Jail Break!"]}],Ot=Xs[0].version,Gt=[{itemIds:null,sku:"egg_pack_small",name:"Small Pack",price:3,salePrice:5,flagText:"",type:"currency",inStore:1,currency:3e4,isActive:!0},{itemIds:null,sku:"egg_pack_medium",name:"Medium Pack",price:6,salePrice:10,flagText:"",type:"currency",inStore:1,currency:65e3,isActive:!0},{itemIds:null,sku:"egg_pack_large",name:"Large Pack",price:12,salePrice:20,flagText:"",type:"currency",inStore:1,currency:15e4,isActive:!0},{itemIds:null,sku:"egg_pack_giant",name:"Giant Pack",price:50,salePrice:25,flagText:"p_egg_shop_bestvalue",type:"currency",inStore:0,currency:5e4,isActive:!0},{itemIds:null,sku:"golden_chicken_pass",name:"Golden Chicken Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:null,sku:"chicken_nugget_pass",name:"Chicken Nugget Pass",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:null,sku:"test_nugget_pass",name:"Test Nugget",price:null,salePrice:null,flagText:"",type:"pass",inStore:0,currency:0,isActive:!1},{itemIds:[4223],sku:"item_gun_m24_techno",name:"Untz Untz Gun",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1112],sku:"item_hat_yolk_arms",name:"Yolk Arms",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1105],sku:"item_hat_cape",name:"Magic Cape",price:1,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1092],sku:"item_hat_dragon",name:"GoE Dragon",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1110],sku:"item_hat_space_gladi",name:"Space Gladiator",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1126],sku:"item_hat_zombie_mask",name:"Zombie Mask",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3016],sku:"item_gun_9mm_space",name:"Cluck 9mm Space Egg",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1125],sku:"item_hat_oni",name:"Oni Hat",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3416],sku:"item_gun_csg1_space",name:"CSG1 Space Egg Skin",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1160],sku:"item_hat_galeggsy",name:"Galeggsy Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3025],sku:"item_gun_9mm_techno",name:"Cluck 9mm Techno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1171],sku:"item_hat_rooter_wing",name:"Rooster Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4026],sku:"item_gun_smg_techno",name:"Tuh SMG",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1174],sku:"item_hat_demon_wings",name:"Demon Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3627],sku:"gun_gauge_techno",name:"Badoosh Dozen Gauge",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1184],sku:"item_hat_fallen_wing",name:"Fallen Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3426],sku:"item_gun_csg1_techno",name:"CSG1 Techno Catz",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"1oOnkjL7",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"K5JjxL1z",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"TymKKdoQ",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!0},{itemIds:[1185,2204,16011],sku:"item_hat_golden_wing",name:"Golden Wings",price:null,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1186],sku:"item_hat_chrome_wing",name:"Chrome Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3126],sku:"gun_eggk47_techno",name:"Eggk Poggers",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1193],sku:"item_hat_steamWings",name:"Steampunk Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3828],sku:"item_gun_rpeggTechno",name:"RPEGGTechno",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3029],sku:"item_gun_retro_9mm",name:"Retro Skin Cluck9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1195],sku:"item_hat_pixel_wings",name:"Angel Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16014],sku:"item_gre_skullnado",name:"Skullnado",price:7,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1202],sku:"item_hat_skull_wings",name:"Skull Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4512],sku:"item_gun_aug_retro",name:"Retro TriHard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1215],sku:"item_hat_robot_wings",name:"Robot Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16019],sku:"item_gre_unicorn",name:"Unicorn Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1222],sku:"item_hat_uni_wing",name:"Unicorn Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4229],sku:"item_gun_m24_retro",name:"M2DZ Retro Skin",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1226],sku:"item_hat_fairy_wings",name:"Fairy Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16023],sku:"item_gre_toilet_papr",name:"Grenade Toilet Paper",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1232],sku:"item_hat_toilet_papr",name:"Hat Toilet Paper",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3431],sku:"item_gun_csg1_retro",name:"CSG1 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1235],sku:"item_hat_pixel_fire",name:"Fire Pixel Wings",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16027],sku:"item_gre_glitterbomb",name:"Grenade Glitterbomb",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1241],sku:"item_hat_glitch_wing",name:"Glitch Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3634],sku:"item_gun_crack_retro",name:"Scrambler Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1245],sku:"item_hat_moth_wings",name:"Moth Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16032],sku:"item_gre_thermal",name:"Grenade Thermal Detonator",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1248],sku:"hat_thermal_wings",name:"Thermal Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4032],sku:"item_gun_smg_retro",name:"SMEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1269],sku:"item_hat_pixel_butt",name:"Pixel Butterfly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1272],sku:"item_hat_pixel_bird",name:"Pixel Bird Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16036],sku:"item_gre_supernova",name:"Grenade Supernova",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16038],sku:"item_gre_octopus",name:"Grenade Octopus",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3835],sku:"item_gun_rpegg_retro",name:"RPEGG Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1212],sku:"item_hat_dog_cap",name:"Dog Cap",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1044],sku:"item_hat_egg_glasses",name:"Egg Glasses",price:2,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1288],sku:"item_hat_luckywings",name:"Lucky Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1290],sku:"item_hat_ukraine",name:"Ukraine Bandana",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3637],sku:"item_gun_bros",name:"Dozen Gauge Bros",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4528],sku:"item_gun_valk_aug",name:"Trihard Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16041],sku:"item_gre_diablo",name:"Grenade Diablo",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3134],sku:"item_gun_ak_retro",name:"Eggk47 Retro",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3136],sku:"item_gun_ak_valkyrie",name:"Eggk47 Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1312],sku:"item_hat_dinowings",name:"Dino Pterodactyl Win",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1316],sku:"item_hat_airplane",name:"Airplane Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1320],sku:"item_hat_crosswing",name:"Cross Fighter",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16044],sku:"item_gre_bumble",name:"Grenade Bumblebee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3642],sku:"item_gauge_valk",name:"Valkyrie Scrambler",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16046],sku:"item_gre_football",name:"Grenade Football",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16048],sku:"item_gre_valk",name:"Grenade Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3439],sku:"item_csg1_rubchick",name:"CSG1 Rubber Chicken",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16049],sku:"item_gre_milk",name:"Grenade Milk",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4240],sku:"item_gun_m24_scav",name:"Crackshot Scavenger",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3045],sku:"item_gun_9mm_valk",name:"Cluck 9mm Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1341],sku:"item_hat_rainbow",name:"Rainbow Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3441],sku:"item_range_valk",name:"Free-Ranger Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1349],sku:"item_hat_teggtris",name:"Teggtris wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16054],sku:"item_gre_blood",name:"Grenade Blood",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1356],sku:"item_hat_bloodwing",name:"Blood Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3843],sku:"item_gun_rpegg_valk",name:"RPEGG Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4040],sku:"item_gun_smg_turk",name:"Turkey-Supreme Whipp",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4242],sku:"item_gun_m24_valk",name:"Crackshot Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1363],sku:"item_hat_fall",name:"Fall Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3844],sku:"item_rpegg_christ",name:"RPEGG Santa Boot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1369],sku:"item_holy_wings",name:"Holly Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[4042],sku:"item_gun_smg_valk",name:"Whipper Valkyrie",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1372,3650],sku:"item_jan_2023",name:"Jan2023 Bundle",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[3443],sku:"item_csg1_fusion",name:"Free-Ranger Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1372],sku:"item_hat_soundwave",name:"Sound Wave Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3650],sku:"item_gauge_octopus",name:"Octopus Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3050],sku:"item_9mm_cloud",name:"Cluck 9mm Clouds",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3142],sku:"item_ak47_fusion",name:"Eggk47 Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16059],sku:"item_gre_pail",name:"Slop Bucket Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1389],sku:"item_hat_harp",name:"Harp Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4044],sku:"item_smg_fusion",name:"Whipper Fusion",price:3,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1394],sku:"item_hat_hooped",name:"Hooped",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3654],sku:"item_gauge_monster",name:"Beholder Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1400],sku:"item_qwings",name:"Question Block Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3054],sku:"item_9mm_fusion",name:"Cluck 9mm Fusion",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[15023],sku:"item_melee_stone",name:"Stone Hammer Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3445],sku:"item_csg1_shellpreme",name:"Free-Ranger Shellpre",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3655],sku:"item_gauge_fusion",name:"Fusion Scrambler",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3055],sku:"item_9mm_camera",name:"Cluck 9mm Camera",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1417],sku:"item_hat_surf",name:"Octopus Surfboard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[15013],sku:"item_melee_valk",name:"Melee Valkyrie",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[15030],sku:"item_melee_fusion",name:"The Fusion Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1423],sku:"item_hat_scales",name:"Scales of Justice",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1225,3420,4208,16013],sku:"bun_master_items",name:"Master items",price:10,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[4540],sku:"item_aug_fusion",name:"Fusion Trihard",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1428],sku:"item_hat_glider",name:"Glider Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[16064],sku:"item_gre_timebomb",name:"Timebomb Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1349,2157,3029,4039],sku:"bun_gamer",name:"Gamer Bundle",price:8,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"kD7geYv2",name:"12 month membership",price:4999,salePrice:null,flagText:"p_egg_shop_bestvalue",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"gCLa2qqV",name:"1 month membership",price:699,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[1185,2204,16011],sku:"x0iYBjs4",name:"3 month membership",price:1499,salePrice:null,flagText:"",type:"subscription",inStore:0,currency:0,isActive:!1},{itemIds:[15037],sku:"item_melee_cat",name:"Harrison Cat Melee",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3059],sku:"item_9mm_mega",name:"Megaphone Cluck 9mm",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1118,2242,3060,15040],sku:"bun_cat",name:"Cats Pajamas Bundle",price:6,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1445],sku:"item_hat_wbs",name:"The Grand Entrance W",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[4248],sku:"item_m24_fusion",name:"The Fusion Crackshot",price:6,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1450],sku:"item_hat_demonpixel",name:"Demon Pixel Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3951],sku:"item_rpegg_fusion",name:"Fusion RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1031,2454,3035,16054],sku:"bun_demon",name:"Demonic Bundle",price:4,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[3952],sku:"item_rpegg_skele",name:"Skellington RPEGG",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[3149],sku:"item_ak_infernal",name:"Infernal Eggk47",price:4,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1107,2467,15045,16062],sku:"bun_mayan",name:"Mayan Bundle",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1461],sku:"item_hat_mayan",name:"Ruins Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[15045],sku:"item_melee_mayan",name:"Mayan Macuahuitl",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1465],sku:"item_hat_breadcat",name:"Bread Cat",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[15047],sku:"item_melee_turkcar",name:"The Turkey Carver",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1465,2372,15025,16022],sku:"bun_breadcat",name:"BreadCat Bundle",price:7,salePrice:null,flagText:"",type:"bundle",inStore:0,currency:0,isActive:!1},{itemIds:[1470],sku:"item_hat_owl",name:"Snow Owl Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!1},{itemIds:[1263,2229,3844,15049],sku:"bun_mistle",name:"Mistletoe Bundle",price:9,salePrice:null,flagText:"",type:"bundle",inStore:1,currency:0,isActive:!0},{itemIds:[4253],sku:"item_m24_infernal",name:"Infernal Crackshot",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1475],sku:"item_hat_disco",name:"Disco Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[3455],sku:"item_csg1_infernal",name:"Infernal CSG1",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[1480],sku:"item_hat_racecar",name:"Racecar Wings",price:5,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0},{itemIds:[16071],sku:"item_gre_racecar",name:"Pireggi Grenade",price:5,salePrice:null,flagText:"",type:"item",inStore:1,currency:0,isActive:!0},{itemIds:[3455,16071],sku:"bun_Jan24",name:"Jan Bundle",price:10,salePrice:null,flagText:"",type:"item",inStore:0,currency:0,isActive:!0}],st=[{id:1001,name:"Ball Cap",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ballCap",tags:["Green","White"]},is_available:!0,unlock:"default"},{id:1002,name:"Boat Fedora",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boatHat",tags:["Blue","Yellow"]},is_available:!0,unlock:"default"},{id:1003,name:"Top Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_topHat",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"default"},{id:1004,name:"Derby Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_derby",tags:["Orange","Brown"]},is_available:!0,unlock:"default"},{id:1005,name:"Mountie Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mounty",tags:["Brown","Police"]},is_available:!0,unlock:"default"},{id:1006,name:"Pablo Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowSheriff",tags:["Orange","Brown","Police","Meme"]},is_available:!0,unlock:"default"},{id:1007,name:"Blue Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaBlue",tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:1008,name:"Hero Mask",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batman",tags:["Black","Brown","Blue"]},is_available:!0,unlock:"purchase"},{id:1009,name:"Cop Hat",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cop",tags:["Blue","Gold","Black"]},is_available:!0,unlock:"purchase"},{id:1010,name:"Robber Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg2",tags:["Black","Purple"]},is_available:!0,unlock:"purchase"},{id:1011,name:"Red Bandana",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaRed",tags:["Red"]},is_available:!0,unlock:"purchase"},{id:1012,name:"Pink Bow",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bowPink",tags:["Pink"]},is_available:!0,unlock:"purchase"},{id:1013,name:"Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glasses",tags:["Black"]},is_available:!0,unlock:"purchase"},{id:1014,name:"Pompadour",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pompadour",tags:["Black","Hair"]},is_available:!0,unlock:"purchase"},{id:1015,name:"Plague Doctor Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_plagueDoctor",tags:["Black"]},is_available:!0,unlock:"purchase"},{id:1016,name:"Poop Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_poop",tags:["Brown","Yellow","Gold","Poop"]},is_available:!0,unlock:"purchase"},{id:1017,name:"Unicorn Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_unicorn",tags:["Red","Orange","Yellow","Green","Blue","Silver","Rainbow"]},is_available:!0,unlock:"purchase"},{id:1018,name:"Baws Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pimp",tags:["Black","White","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:1019,name:"Pirate Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pirateHat",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1023,name:"Hunting Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hunting",tags:["Red"]},is_available:!0,unlock:"purchase"},{id:1024,name:"Hunting Bear Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_huntingBear",tags:["Pink","Heart","Cute"]},is_available:!0,unlock:"purchase"},{id:1025,name:"Crown",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crown",tags:["Gold","Red","Royal"]},is_available:!0,unlock:"purchase"},{id:1020,name:"ShellShockers Hat",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shellshockers",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_hat",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/splat-hat",tags:["White","Brown","Egg"]},is_available:!1,unlock:"physical"},{id:1021,name:"Frying Pan",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fryingPan",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_pan",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/no-pans-tee",tags:["Black","Silver"]},is_available:!1,unlock:"physical"},{id:1022,name:"Viking Horns",price:0,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_horns",unlock:"physical",physicalUnlockLocKey:"p_physical_unlock_shirt",physicalItemStoreURL:"https://shell-shockers.myshopify.com/products/logo-tee",tags:["Brown","Bone"]},is_available:!1,unlock:"physical"},{id:1026,name:"Jack O' Lantern Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkin",tags:["Halloween","Oct23","Orange"]},is_available:!1,unlock:"purchase"},{id:1027,name:"Bat Wings",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_batWings",tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:1028,name:"Witch Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_witch",tags:["Halloween","Purple","Gold","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:1029,name:"Axe-in-head",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_axe",tags:["Halloween","Oct23","Red","Brown","Wood"]},is_available:!1,unlock:"purchase"},{id:1030,name:"Executioner's Cowl",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_executioner",tags:["Halloween","Oct23","Red","Black"]},is_available:!1,unlock:"purchase"},{id:1031,name:"Devil Horns",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_devilHorns",tags:["Halloween","Oct23","Red"]},is_available:!1,unlock:"purchase"},{id:1032,name:"Angel Wings & Halo",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angel",tags:["Halloween","Oct23","Gold","White"]},is_available:!1,unlock:"purchase"},{id:1033,name:"Hockey Mask",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hockeyMask",tags:["Halloween","Oct23","Black","White"]},is_available:!1,unlock:"purchase"},{id:1034,name:"Pilgrim Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pilgrim",tags:["NovM23","Thanksgiving","Black","Brown","Gold"]},is_available:!1,unlock:"purchase"},{id:1035,name:"Cooked Turkey Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyDead",tags:["NovM23","Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:1036,name:"Turkey Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turkeyAlive",tags:["NovM23","Thanksgiving","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1037,name:"Golden Chicken Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_Top1Percent",tags:["Reward","RewardTopPercent","Gold"]},is_available:!1,unlock:"manual"},{id:1038,name:"Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier1",tags:["Reward","RewardKills","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:1039,name:"Bronze Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier2",tags:["Reward","RewardKills","Red","Brown"]},is_available:!1,unlock:"manual"},{id:1040,name:"Silver Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier3",tags:["Reward","RewardKills","Gray","Blue"]},is_available:!1,unlock:"manual"},{id:1041,name:"Gold Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KillTier4",tags:["Reward","RewardKills","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:1042,name:"Cracked Egg Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier1",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1043,name:"Egg Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier2",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1044,name:"Egg Glasses",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier3",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_egg_glasses"]},{id:1045,name:"Cracked Egg Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_DeathTier4",tags:["Reward","RewardDeaths","Yellow","White"]},is_available:!1,unlock:"manual"},{id:1046,name:"Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier1",tags:["Reward","RewardKDR","Bone"]},is_available:!1,unlock:"manual"},{id:1047,name:"Bronze Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier2",tags:["Reward","RewardKDR","Red","Brown"]},is_available:!1,unlock:"manual"},{id:1048,name:"Silver Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier3",tags:["Reward","RewardKDR","Silver","Blue"]},is_available:!1,unlock:"manual"},{id:1049,name:"Gold Chicken Skull Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_KDRTier4",tags:["Reward","RewardKDR","Yellow","Gold"]},is_available:!1,unlock:"manual"},{id:1050,name:"Golden Egg Trophy",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier1",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1051,name:"Golden Faberge Egg Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier2",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1052,name:"Dollar Sign Glasses",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier3",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1053,name:"Golden Baws Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_GoldenEggTier4",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1054,name:"Nate's Headphones",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headphones",tags:["Nate","Green","Black"]},is_available:!1,unlock:"manual"},{id:1055,name:"Reindeer Antlers",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_reindeer",tags:["Dec23","Christmas","Green","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1056,name:"Elf Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elf",tags:["Dec23","Christmas","Green","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:1057,name:"Santa Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santa",tags:["Dec23","Christmas","White","Red"]},is_available:!1,unlock:"purchase"},{id:1058,name:"Party Hat 2019",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase"},{id:1059,name:"Headband 2019",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2019",tags:["NewYears","2019","Black","Gold","Yellow"]},is_available:!1,unlock:"purchase"},{id:1060,name:"Happy New Yolk Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_newYolk",tags:["NewYears","Black","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:1061,name:"Ski Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badEgg1",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:1062,name:"Pirate Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaPirate",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:1063,name:"Colander Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_colander",tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:1064,name:"Hamburger Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffsHamburger",tags:["Newsletter","Brown","Pickles"]},is_available:!1,unlock:"manual"},{id:1065,name:"Fez Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fez",tags:["Newsletter","Red","Gold"]},is_available:!1,unlock:"manual"},{id:1066,name:"Blue Wizard Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_blueWizard",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1067,name:"Chef Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chef",tags:["Newsletter","White"]},is_available:!1,unlock:"manual"},{id:1068,name:"Jester Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jester",tags:["Newsletter","Black","Gold"]},is_available:!1,unlock:"manual"},{id:1069,name:"Straw Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_straw",tags:["Newsletter","Blue","Gold"]},is_available:!1,unlock:"manual"},{id:1070,name:"Spring Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spring",tags:["Groundhog","Feb23","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1071,name:"Winter Sapling Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winter",tags:["Groundhog","Feb23","White","Brown"]},is_available:!1,unlock:"purchase"},{id:1072,name:"Groundhog Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:1073,name:"Skull Bandana",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaSkull",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1074,name:"Firefighter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fireFighter",tags:["Promotional","Red"]},is_available:!1,unlock:"manual"},{id:1075,name:"Sunglasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sunglasses",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1076,name:"Monocle",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_monocle",tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:1077,name:"Gas Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gasMask",tags:["Promotional","Black","Green"]},is_available:!1,unlock:"manual"},{id:1078,name:"Aviator Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_aviator",tags:["Promotional","Brown"]},is_available:!1,unlock:"manual"},{id:1079,name:"Red Goggles",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gogglesRed",tags:["Promotional","Black"]},is_available:!1,unlock:"manual"},{id:1080,name:"Astronaut Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_astronaut",tags:["Promotional","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:1081,name:"Heart Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHeart",tags:["ValentinesDay","Pink","Red"]},is_available:!1,unlock:"purchase"},{id:1082,name:"Baws Fedora",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fedoraPimp",tags:["ValentinesDay","Pink","Brown"]},is_available:!1,unlock:"purchase"},{id:1083,name:"Valentine's Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valentines",tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:1084,name:"Shamrock Glasses",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesShamrock",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:1085,name:"Pot O' Gold Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_potOfGold",tags:["StPatricksDay","MarM23","Black","Gold"]},is_available:!1,unlock:"purchase"},{id:1086,name:"Leprechaun Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leprechaun",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:1087,name:"Bunny Ears",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bunnyEars",tags:["Easter","White","Pink"]},is_available:!1,unlock:"purchase"},{id:1088,name:"Egg Nest",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggNest",tags:["Easter","Brown","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:1089,name:"Egg Basket",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggBasket",tags:["Easter","Brown"]},is_available:!1,unlock:"purchase"},{id:1090,name:"Egg Crown",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggCrown",tags:["Easter","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1091,name:"GoE Ice Crown",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_iceCrown",tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:1092,name:"GoE Dragon",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dragon",tags:["GameOfEggs","May23","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dragon"]},{id:1093,name:"Green Bandana",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaGreen",tags:["Green"]},is_available:!0,unlock:"purchase"},{id:1094,name:"Mohawk Hair",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_moHawk",tags:["Purple","Pink"]},is_available:!0,unlock:"purchase"},{id:1095,name:"Bihawk Hair",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_biHawk",tags:["Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:1096,name:"Trihawk Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_triHawk",tags:["Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:1097,name:"Pigtails Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pigtails",tags:["Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:1098,name:"Side Pony",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sidePony",tags:["Black","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1099,name:"Egg Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggHelmet",tags:["Aveggers","Gold","Bone"]},is_available:!1,unlock:"purchase"},{id:1100,name:"Fohawk Wig",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_arrow",tags:["Aveggers","Brown","Black"]},is_available:!1,unlock:"purchase"},{id:1101,name:"American Bandana",price:2e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaAmerica",tags:["Aveggers","JulyM23","Red","White","Blue"]},is_available:!1,unlock:"purchase"},{id:1102,name:"Bike Helmet",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bikeHelmet",tags:["Aveggers","Red","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1103,name:"Bucket Hero Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bucketMan",tags:["Aveggers","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1104,name:"Bug Mask",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bugMask",tags:["Aveggers","Jun23","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1105,name:"Magic Cape",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cape",tags:["Aveggers","Jun23","Red","Purple","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_cape"]},{id:1106,name:"Eyepatch",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eyepatch",tags:["Aveggers","May23","Black"]},is_available:!1,unlock:"purchase"},{id:1107,name:"Panther Mask",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pantherMask",tags:["Aveggers","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:1108,name:"Red Hair Wig",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_redHair",tags:["Aveggers","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1109,name:"Helmet of Sight",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sightHelmet",tags:["Aveggers","Purple","Black"]},is_available:!1,unlock:"purchase"},{id:1110,name:"Space Gladiator Hat",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceGladiator",tags:["Aveggers","JunM23","Red","Brown"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_space_gladi"]},{id:1111,name:"Spider Mask",price:12e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spiderMask",tags:["Aveggers","Sep23","Red","Black","White"]},is_available:!1,unlock:"purchase"},{id:1112,name:"Yolk Arms Hat",price:1,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_yolkArms",tags:["Aveggers","Mar23","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_yolk_arms"]},{id:1113,name:"Guy Fawkes Mask",price:1105,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fawkes",tags:["Bone"]},is_available:!0,unlock:"purchase"},{id:1114,name:"Birthday Hat 1",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday1",tags:["HappyBirthday","Yellow","Red","Blue"]},is_available:!0,unlock:"purchase"},{id:1115,name:"Birthday Hat 2",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_birthday2",tags:["HappyBirthday","Red","Blue"]},is_available:!0,unlock:"purchase"},{id:1116,name:"Birthday Cake Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cake",tags:["HappyBirthday","Red","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:1117,name:"League Staff Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_leagueStaff",tags:["League","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:1118,name:"Cat Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cat",tags:["Orange","Black","Cat"]},is_available:!0,unlock:"purchase"},{id:1119,name:"Egg Shell Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggshell",tags:["Bone"]},is_available:!0,unlock:"purchase"},{id:1120,name:"Dino Shell Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinoShell",tags:["Orange","Brown"]},is_available:!1,unlock:"purchase"},{id:1121,name:"Penguin Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_penguin",tags:["Black","White"]},is_available:!0,unlock:"purchase"},{id:1122,name:"Pot Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pot",tags:["Black","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:1123,name:"Tiny Tophat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tophatTiny",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1124,name:"Nurse Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nurse",tags:["White","Red"]},is_available:!0,unlock:"purchase"},{id:1125,name:"Oni Hat",price:4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oni",tags:["Sidearms","White","Red","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_oni"]},{id:1126,name:"Zombie Mask",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_zombieMask",tags:["July23","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_zombie_mask"]},{id:1127,name:"Cinnamon Bun Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cinnamonBun",tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:1128,name:"Bounty Egger",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bountyEgger",tags:["Eggwalker","Green","Black"]},is_available:!1,unlock:"purchase"},{id:1129,name:"Good Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goodRobes",tags:["Eggwalker","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1130,name:"Bad Robes Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_badRobes",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1131,name:"Space Emo Hair",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceEmo",tags:["Eggwalker","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1132,name:"Space Monk Cloak",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spaceMonk",tags:["Eggwalker","Blue","Bone"]},is_available:!1,unlock:"purchase"},{id:1133,name:"Eggperor Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggperor",tags:["Eggwalker","Black","Yellow","Meme"]},is_available:!1,unlock:"purchase"},{id:1134,name:"BBEgg Hat",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bbEgg",tags:["Eggwalker","Orange","White"]},is_available:!1,unlock:"purchase"},{id:1135,name:"C3PYolk Mask",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c3pYolk",tags:["Eggwalker","Rainbow","Gold"]},is_available:!1,unlock:"purchase"},{id:1136,name:"2020 Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2020",tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:1137,name:"Eggy Cash Ensemble",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyCash",tags:["EggyCash","Brown","Black"]},is_available:!0,unlock:"purchase"},{id:1138,name:"Soda Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drinkdew",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1139,name:"Surgical Mask",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalMask",tags:["Surgical","Green"]},is_available:!0,unlock:"purchase"},{id:1140,name:"Surgical Mask White",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalWhite",tags:["Surgical","White"]},is_available:!0,unlock:"purchase"},{id:1141,name:"Surgical Mask Smile",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_surgicalSmile",tags:["Surgical","Black"]},is_available:!0,unlock:"purchase"},{id:1142,name:"Falcon Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_falconHunter",tags:["RaidLand","Yellow","Nov23"]},is_available:!1,unlock:"purchase"},{id:1143,name:"Shadow Hunter Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shadowHunter",tags:["RaidLand","Mar23","Purple"]},is_available:!1,unlock:"purchase"},{id:1144,name:"Frost Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frostBerserker",tags:["RaidLand","Blue"]},is_available:!1,unlock:"purchase"},{id:1145,name:"Grim Berserker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_grimBerserker",tags:["RaidLand","Blue","Gray"]},is_available:!1,unlock:"purchase"},{id:1146,name:"Golem Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_golemWarrior",tags:["RaidLand","Green"]},is_available:!1,unlock:"purchase"},{id:1147,name:"Immortal Warrior Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_immortalWarrior",tags:["RaidLand","Blue","Gray"]},is_available:!1,unlock:"purchase"},{id:1148,name:"Sheep Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sheep",tags:["Newsletter","White","Brown"]},is_available:!1,unlock:"manual"},{id:1149,name:"Blue Toxic  Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicBlue",tags:["Rotten","Blue","Green"]},is_available:!0,unlock:"purchase"},{id:1150,name:"Green Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicGreen",tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:1151,name:"Orange Toxic Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toxicOrange",tags:["Rotten","Orange","Green"]},is_available:!0,unlock:"purchase"},{id:1152,name:"Double Filter Gas Mask",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_doubleFilter",tags:["Black","Red"]},is_available:!0,unlock:"purchase"},{id:1153,name:"Brown Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar1",tags:["Rockstar","JanM23","Brown","Music"]},is_available:!1,unlock:"purchase"},{id:1154,name:"Black & Red Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar3",tags:["Rockstar","JanM23","Black","Red","Music"]},is_available:!1,unlock:"purchase"},{id:1155,name:"Black & White Rockstar Hair",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rockstar2",tags:["Rockstar","JanM23","Black","White","Music"]},is_available:!1,unlock:"purchase"},{id:1156,name:"Umbrella Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_umbrella",tags:["Newsletter","Rainbow"]},is_available:!1,unlock:"manual"},{id:1157,name:"Star Glasses",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesStar",tags:["Galeggsy","AprM23","Pink"]},is_available:!1,unlock:"purchase"},{id:1158,name:"Star Bandana",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaStars",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1159,name:"Alien Antennae",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headbandAlien",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1160,name:"Galeggsy Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premiumButterfly",tags:["Galeggsy","AprM23","Purple","Pink"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_galeggsy"]},{id:1161,name:"Black Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneBlack",tags:["MercZone","Black","Suit"]},is_available:!1,unlock:"manual"},{id:1162,name:"Red Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZoneRed",tags:["MercZone","Red","Suit"]},is_available:!1,unlock:"manual"},{id:1163,name:"Pink Suit Ensemble",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mercZonePink",tags:["MercZone","Pink","Suit"]},is_available:!1,unlock:"manual"},{id:1164,name:"Academic Cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academic",tags:["Newsletter","Black","Yellow"]},is_available:!1,unlock:"manual"},{id:1166,name:"Fuzzy Earmuffs",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_earmuffs",tags:["Newsletter","Pink"]},is_available:!1,unlock:"manual"},{id:1167,name:"Chains Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chains",tags:["Newsletter","Gray"]},is_available:!1,unlock:"manual"},{id:1168,name:"Hen Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hen",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:1169,name:"Rooster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rooster",tags:["Chicken","Brown","Red"]},is_available:!1,unlock:"purchase"},{id:1170,name:"Rooster Tail Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roosterTail",tags:["Chicken","Green"]},is_available:!1,unlock:"purchase"},{id:1171,name:"Rooster Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RoosterWings",tags:["MayM23","Chicken","Green","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_rooter_wing"]},{id:1172,name:"Bee Wings",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_BeeWings",tags:["Rainbow","Pink","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:1173,name:"Jason Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_F13",tags:["f13","Bone","Red"]},is_available:!1,unlock:"manual"},{id:1174,name:"Demon Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DemonWings",tags:["Premium","Red","OctM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_demon_wings"]},{id:1175,name:"Among Egg Hat 1",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_01",tags:["AmongEgg","Blue","White","Meme"]},is_available:!0,unlock:"purchase"},{id:1176,name:"Among Egg Hat 2",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_02",tags:["AmongEgg","Blue","Meme"]},is_available:!1,unlock:"purchase"},{id:1177,name:"Among Egg Hat 3",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_03",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1178,name:"Among Egg Hat 4",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_04",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1179,name:"Among Egg Hat 5",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_05",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1180,name:"Among Egg Hat 6",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_06",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1181,name:"Among Egg Hat 7",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_amongEgg_07",tags:["AmongEgg","Blue","Brown","Meme"]},is_available:!1,unlock:"purchase"},{id:1182,name:"Eggolorian Helmet",price:75e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggolorianBig",tags:["Eggolorian","Brown"]},is_available:!0,unlock:"purchase"},{id:1183,name:"Toadstool Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toadstool",tags:["Newsletter","Red","White"]},is_available:!1,unlock:"manual"},{id:1184,name:"Fallen Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_FallenWings",tags:["Premium","FebM23","Gray","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_fallen_wing"]},{id:1185,name:"Golden Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GoldenWings",tags:["Premium","vipItem","Gray","Silver"]},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:1186,name:"Chrome Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ChromeWings",tags:["July23","Gold","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_chrome_wing"]},{id:1187,name:"Wero Viking Hair",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wero",tags:["Wero","Brown"]},is_available:!0,unlock:"purchase"},{id:1188,name:"Mech Energy Wings",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MechEnergyWings",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1189,name:"Egg Sandwich Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandwich",tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:1190,name:"Party Hat 2021",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2021",tags:["NewYears","2021","Red","Green"]},is_available:!1,unlock:"purchase"},{id:1191,name:"Headband 2021",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2021",tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:1192,name:"Hindsight Glasses",price:24e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_glassesHindsight",tags:["NewYears","Black","Purple"]},is_available:!0,unlock:"purchase"},{id:1193,name:"Steampunk Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SteampunkWings",tags:["Premium","JulyM23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_steamWings"]},{id:1194,name:"Thee_Owl Hat",price:1e5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_theeowl",tags:["TheeOwl","Red","Orange","Green","Blue","Hair"]},is_available:!0,unlock:"purchase"},{id:1195,name:"Angel Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelAngel",tags:["Jun23","Blue","Yellow","White"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_wings"]},{id:1196,name:"C4bra Hair",price:15e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4bra",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase"},{id:1197,name:"C4bra Ram Hat",price:35e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_c4brahorn",tags:["C4bra","Brown"]},is_available:!0,unlock:"purchase"},{id:1198,name:"Hazmatt Mask",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hazmat",tags:["Hazmat","Yellow","Gold"]},is_available:!0,unlock:"purchase"},{id:1199,name:"Slashy Camp Mask",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slashy",tags:["SlashyCamp","White","Bone","Red","Brown","Skullface","Slayaway"]},is_available:!1,unlock:"manual"},{id:1200,name:"Discord Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discord",tags:["Discord","Black","Purple","White"]},is_available:!1,unlock:"manual"},{id:1201,name:"Funny Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_funnyGlasses",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1202,name:"Skull Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SkullWings",tags:["Red","Brown","Black","Bone","Oct23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_skull_wings"]},{id:1203,name:"Egg Earpods",price:25e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_airpods",tags:["White"]},is_available:!0,unlock:"purchase"},{id:1204,name:"Paper Bag Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bag",tags:["Brown"]},is_available:!0,unlock:"purchase"},{id:1205,name:"Backwards Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hipster",tags:["Egg","Black"]},is_available:!0,unlock:"purchase"},{id:1206,name:"Beret",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beret",tags:["White","Red","Egg"]},is_available:!0,unlock:"purchase"},{id:1207,name:"Spike Hat",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spike",tags:["Gold","Black","Yellow"]},is_available:!0,unlock:"purchase"},{id:1208,name:"TikTok Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tiktok",tags:["Pink","Blue","Black","Gray"]},is_available:!1,unlock:"manual"},{id:1209,name:"Propeller Beanie",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beanie",tags:["Newsletter","Rainbow","Blue"]},is_available:!1,unlock:"manual"},{id:1210,name:"Riddler Bowler",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_riddler",tags:["Purple","Yellow","Green"]},is_available:!1,unlock:"manual"},{id:1211,name:"Miner Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_miner",tags:["Yellow","Black"]},is_available:!1,unlock:"manual"},{id:1212,name:"Dog Ears",price:2,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dog",tags:["sale","Mar23","Brown","NovM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_dog_cap"]},{id:1213,name:"Satellite Headgear",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_satellite",tags:["Gray","Grey"]},is_available:!1,unlock:"manual"},{id:1214,name:"Diablo Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_evilpablo",tags:["EGGORG","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1215,name:"Robot Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelRobot",tags:["Aug23","Green","Gray","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_robot_wings"]},{id:1216,name:"Train Conductor",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_conductor",tags:["Trains","Cars","Yellow","Black"]},is_available:!0,unlock:"purchase"},{id:1217,name:"Train Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_train",tags:["Trains","Cars","Red","Gray"]},is_available:!0,unlock:"purchase"},{id:1218,name:"Bindle Hat",price:4500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bindle",tags:["Trains","Cars","Red","Brown"]},is_available:!0,unlock:"purchase"},{id:1219,name:"Instagram Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_instagram",tags:["Purple","Orange","Gray"]},is_available:!1,unlock:"manual"},{id:1220,name:"UFO Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ufo",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1221,name:"RandomLife Headgear",price:5e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_randomlife",tags:["Random","Red","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1222,name:"Unicorn Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_UnicornWings",tags:["Mar23","Pink","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_uni_wing"]},{id:1223,name:"Steam Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_steam",tags:["Pink"]},is_available:!1,unlock:"manual"},{id:1224,name:"Ice Cream Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_icecream",tags:["Newsletter","Blue","Brown"]},is_available:!1,unlock:"manual"},{id:1225,name:"Ethan Gamer Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ethangamer",tags:["EthanGamer","Brown","Green","Hair"]},is_available:!0,unlock:"purchase"},{id:1226,name:"Fairy Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFairy",tags:["Dec23","Pink","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fairy_wings"]},{id:1227,name:"Facebook Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_facebook",tags:["Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:1228,name:"Sun Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sun",tags:["Summer","JunM23","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1229,name:"Picnic Basket Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_picnic",tags:["Summer","JunM23","Brown","White","Red"]},is_available:!1,unlock:"purchase"},{id:1230,name:"Beehive Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beehive",tags:["Summer","JunM23","Yellow","Black"]},is_available:!1,unlock:"purchase"},{id:1231,name:"Parrot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_parrot",tags:["Newsletter","Red","Green"]},is_available:!1,unlock:"manual"},{id:1232,name:"Toilet Paper Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ToiletPaperWings",tags:["Premium","White","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_toilet_papr"]},{id:1233,name:"Watermelon Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_watermelon",tags:["Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1234,name:"Twitter Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twitter",tags:["Blue","White"]},is_available:!1,unlock:"manual"},{id:1235,name:"Fire Pixel Wings",price:10,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelFire",tags:["Premium","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_pixel_fire"]},{id:1236,name:"Backpack Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpack",tags:["Pencil","Sep23","Red"]},is_available:!1,unlock:"purchase"},{id:1237,name:"Backpack Rainbow Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_backpackrainbow",tags:["Pencil","Sep23","Rainbow","White"]},is_available:!1,unlock:"purchase"},{id:1238,name:"Round Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_roundglasses",tags:["Pencil","Sep23","Black"]},is_available:!1,unlock:"purchase"},{id:1239,name:"Books Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_books",tags:["Newsletter","Yellow","Brown","Red"]},is_available:!1,unlock:"manual"},{id:1240,name:"Wero Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weroShort",tags:["Wero","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1241,name:"Glitch Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_GlitchWings",tags:["Premium","Purple","Pink","Black","NovM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_glitch_wing"]},{id:1242,name:"Sherlock Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sherlock",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1243,name:"Grave Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_RIP",tags:["Halloween2","Oct23","Grey","Gray","Egg"]},is_available:!1,unlock:"purchase"},{id:1244,name:"Ghost Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ghost",tags:["Halloween2","Oct23","White"]},is_available:!1,unlock:"purchase"},{id:1245,name:"Moth Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelMoth",tags:["Nov23","Brown","Black","Skull","Lambs"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_moth_wings"]},{id:1246,name:"Android Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_android",tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:1247,name:"Bravo Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bravo",tags:["Newsletter","Yellow","Hair"]},is_available:!1,unlock:"manual"},{id:1248,name:"Thermal Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_ThermalWings",tags:["Red","premFeatOne","DecM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["hat_thermal_wings"]},{id:1249,name:"Apple Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_applepie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase"},{id:1250,name:"Pumpkin Pie Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pumpkinpie",tags:["Food","Brown"]},is_available:!1,unlock:"purchase"},{id:1251,name:"Cheese Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cheese",tags:["Food","Yellow"]},is_available:!1,unlock:"purchase"},{id:1252,name:"Gravy hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gravy",tags:["Food","Brown","Yellow","NovM23"]},is_available:!1,unlock:"purchase"},{id:1253,name:"Dollar Sign Glasses Black",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_PremiumEggTier3",tags:["Black Fryday","MayM23","Black"]},is_available:!1,unlock:"purchase"},{id:1254,name:"Pink Hair",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkwarrior",tags:["Eggs of Legends","Pink"]},is_available:!0,unlock:"purchase"},{id:1255,name:"Blue Braids",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluebraids",tags:["Eggs of Legends","Blue","Hair"]},is_available:!0,unlock:"purchase"},{id:1256,name:"Weather Vane",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_weathervane",tags:["KotC","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:1257,name:"Red Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerRed",tags:["KotC","Gold","Red"]},is_available:!0,unlock:"purchase"},{id:1258,name:"Blue Crown Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_winnerBlue",tags:["KotC","Gold","Blue"]},is_available:!0,unlock:"purchase"},{id:1259,name:"Bison Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bison",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1260,name:"Egg Cluster Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcluster",tags:["KotC","Brown"]},is_available:!0,unlock:"purchase"},{id:1261,name:"Party Hat 2022",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2022",tags:["NewYears","2022","Brown","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1262,name:"Headband 2022",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2022",tags:["NewYears","2022","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:1263,name:"Nervous Elf Belt",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_nervouself",tags:["Christmas2","Elf","Brown","Gold","Green","Red"]},is_available:!1,unlock:"purchase"},{id:1264,name:"Bugs Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bluehair",tags:["Meggtrix","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:1265,name:"Meggtrix Glasses",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_clampglasses",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase"},{id:1266,name:"Agent Smithe Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_smith",tags:["Meggtrix","Black"]},is_available:!1,unlock:"purchase"},{id:1267,name:"Dreadlocks Hair",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_twins",tags:["Meggtrix","Gray"]},is_available:!1,unlock:"purchase"},{id:1268,name:"Twitch Bits",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bits",tags:["Purple","Green","Red"]},is_available:!1,unlock:"manual"},{id:1269,name:"Butterfly Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelButterfly",tags:["Purple","Blurple"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_pixel_butt"]},{id:1270,name:"Mandrake Glasses",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mandrake",tags:["Drops","Blue","Black","Gray"]},is_available:!1,unlock:"manual"},{id:1271,name:"Lyerpald Wolf Helmut",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lyerpald",tags:["Drops","Gray"]},is_available:!1,unlock:"manual"},{id:1272,name:"Pixel Bird Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelBird",tags:["Premium","AugM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_pixel_bird"]},{id:1273,name:"xSerpius Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xserpiusbeard",tags:["Drops","Yellow"]},is_available:!1,unlock:"manual"},{id:1274,name:"Blue & Yellow Toque ",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toque",tags:["Chilly","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1275,name:"Purple & Red Toque",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pufftoque",tags:["Chilly","Purple","Red"]},is_available:!1,unlock:"purchase"},{id:1276,name:"Ear Flaps Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greenearhat",tags:["Chilly","Sep23","Green"]},is_available:!1,unlock:"purchase"},{id:1277,name:"Bow Headband",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkbow",tags:["Kawaii","Blue","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1278,name:"Cute Ponytail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pinkpony",tags:["Kawaii","Pink","Hair"]},is_available:!0,unlock:"purchase"},{id:1279,name:"High Pigtails",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hightails",tags:["Kawaii","Purple","Hair"]},is_available:!0,unlock:"purchase"},{id:1280,name:"Orange Hair Buns",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spacebuns",tags:["Kawaii","Orange"]},is_available:!0,unlock:"purchase"},{id:1281,name:"Cat Braids",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_catbraids",tags:["Kawaii","Brown","Hair"]},is_available:!0,unlock:"purchase"},{id:1282,name:"Sashimi Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sushi",tags:["Kawaii","Pink","White"]},is_available:!0,unlock:"purchase"},{id:1283,name:"Big Cat Ears",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bigears",tags:["Kawaii","Brown"]},is_available:!0,unlock:"purchase"},{id:1284,name:"Spiky Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spikyband",tags:["Kawaii","White","Black"]},is_available:!0,unlock:"purchase"},{id:1285,name:"Gamer Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerhair",tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:1286,name:"Purple Hair",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplehair",tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:1287,name:"Mmm Donut Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_donut",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1288,name:"Lucky Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_LuckyWings",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_luckywings"]},{id:1289,name:"Turtle Power Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_turtle",tags:["Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1290,name:"Ukraine Bandana",price:3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bandanaUkraine",tags:["UA","Blue","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_ukraine"]},{id:1291,name:"Sweatband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sweatband",tags:["Bros","Egg","Purple","Gold"]},is_available:!1,unlock:"purchase"},{id:1292,name:"Spartan Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_spartan",tags:["Bros","Green"]},is_available:!1,unlock:"purchase"},{id:1293,name:"Gators Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gators",tags:["Bros","Blue","Orange"]},is_available:!1,unlock:"purchase"},{id:1294,name:"Rams Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_rams",tags:["Bros","Aug23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1295,name:"Knight Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knight",tags:["EGGORG","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1296,name:"Viking Helmet",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_viking",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1297,name:"Egg Cape",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcape",tags:["EGGORG","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1298,name:"Joker Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_joker",tags:["EGGORG","Blue","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1299,name:"Shield Hat",price:1520,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shield",tags:["EGGORG","Apr23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1300,name:"Valkyrie Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_valkyrie",tags:["Newsletter","Blue","Gray"]},is_available:!1,unlock:"manual"},{id:1301,name:"Tattered Cape",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggcapeRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual"},{id:1302,name:"Gold Joker Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_jokerGold",tags:["Relic","Drops2","Yellow"]},is_available:!1,unlock:"manual"},{id:1303,name:"Rusty Viking Helmet",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_vikingRust",tags:["Relic","Drops2","Brown","Gold"]},is_available:!1,unlock:"manual"},{id:1304,name:"Rusty Knight Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_knightRust",tags:["Relic","Drops2","Brown","Red"]},is_available:!1,unlock:"manual"},{id:1305,name:"JWBerry3D Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerglasses",tags:["Relic","Red","Black"]},is_available:!0,unlock:"purchase"},{id:1306,name:"Ocean Glasses",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oceanglasses",tags:["Relic","Blue"]},is_available:!0,unlock:"purchase"},{id:1307,name:"Tooth Survivor Bandana",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toothbandana",tags:["Dino","May23","Gray"]},is_available:!1,unlock:"purchase"},{id:1308,name:"Steggasauras Scales",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stego",tags:["Dino","May23","Orange","Green","Dec23"]},is_available:!1,unlock:"purchase"},{id:1309,name:"Red Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailred",tags:["Dino","May23","Yellow","Red"]},is_available:!1,unlock:"purchase"},{id:1310,name:"Green Dino Tail",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailgreen",tags:["Dino","May23","Green"]},is_available:!1,unlock:"purchase"},{id:1311,name:"Dino Mouth Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinomouth",tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:1312,name:"Dino Pterodactyl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_DinoWings",tags:["Dino","May23","Green"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_dinowings"]},{id:1313,name:"Dino Triceratops Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dino",tags:["Dino","Newsletter","Orange"]},is_available:!1,unlock:"manual"},{id:1314,name:"Tablet Backpack",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tabletpack",tags:["Mobile","SepM23","Red","Egg"]},is_available:!1,unlock:"purchase"},{id:1315,name:"Telephone Hat ",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_telephone",tags:["Mobile","AugM23","Red"]},is_available:!1,unlock:"purchase"},{id:1316,name:"Airplane Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Airplane",tags:["Sep23","Premium","White","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_airplane"]},{id:1317,name:"Head Tail",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headtails",tags:["Eggwalker2","White","Green","Black"]},is_available:!1,unlock:"purchase"},{id:1318,name:"Eggpire Cap",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_imperial",tags:["Eggwalker2","Green"]},is_available:!1,unlock:"purchase"},{id:1319,name:"Sci-fi Visor",price:6500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_obiwan",tags:["Eggwalker2","Black"]},is_available:!1,unlock:"purchase"},{id:1320,name:"Cross Fighter Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_CrossWing",tags:["Eggwalker2","Premium","White","Grey","Gray","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_crosswing"]},{id:1321,name:"Pineapple Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pineapple",tags:["Summer","JunM23","Green","White"]},is_available:!1,unlock:"purchase"},{id:1322,name:"Kite Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kite",tags:["Summer","JunM23","Rainbow","Yellow"]},is_available:!1,unlock:"purchase"},{id:1323,name:"UK Bucket Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_buckethat",tags:["Summer","Newsletter","Yellow"]},is_available:!1,unlock:"manual"},{id:1324,name:"Baseball Helmet",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_baseball",tags:["Sports","JulyM23","Black"]},is_available:!1,unlock:"purchase"},{id:1325,name:"Football Helmet",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_football",tags:["Sports","JulyM23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:1326,name:"Swim Cap",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_swimcap",tags:["Sports","JulyM23","Oct23","Blue"]},is_available:!1,unlock:"purchase"},{id:1327,name:"Frisbee Damage Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_frisbee",tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:1328,name:"SPORTS headband",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_headband",tags:["Sports","JulyM23","Green","Egg"]},is_available:!1,unlock:"purchase"},{id:1329,name:"Cone Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cone",tags:["Newsletter","Sports","JulyM23","Orange"]},is_available:!1,unlock:"manual"},{id:1330,name:"Egg Yolk Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggyolk",tags:["Breakfast","Egg","White","Yellow"]},is_available:!1,unlock:"purchase"},{id:1331,name:"Waffles Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_waffles",tags:["Breakfast","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1332,name:"Pancakes Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pancakes",tags:["Breakfast","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1333,name:"Teacup Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_teacup",tags:["Breakfast","White","Red"]},is_available:!1,unlock:"purchase"},{id:1334,name:"Captain Breakfast Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_captaincrunch",tags:["Breakfast","Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1335,name:"Keyhole Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_keyhole",tags:["Scavenger","Black"]},is_available:!1,unlock:"purchase"},{id:1336,name:"Distinguished Gentlemen Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pipe",tags:["Dec23","Scavenger","Brown","Hair"]},is_available:!1,unlock:"purchase"},{id:1337,name:"Wizskull Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wizskull",tags:["Scavenger","Blue","White","Bone","BWD"]},is_available:!1,unlock:"purchase"},{id:1338,name:"Tucked Pencil Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_pencilhair",tags:["Pencil2","Sep23","Yellow","Hair"]},is_available:!1,unlock:"purchase"},{id:1339,name:"Slide Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slide",tags:["Pencil2","Sep23","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1340,name:"Scavenger Hunt Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scavenger",tags:["Pencil2","Sep23","Red","Black"]},is_available:!1,unlock:"manual"},{id:1341,name:"Rainbow Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_RainbowWings",tags:["Pencil2","Premium"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_rainbow"]},{id:1342,name:"Paper Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paper",tags:["Newsletter","Pencil2","Blue","White"]},is_available:!1,unlock:"manual"},{id:1343,name:"Albino Book Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snake",tags:["Sep22","Drops3","ABHS"]},is_available:!1,unlock:"manual"},{id:1344,name:"Heart Backpack",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_heartpack",tags:["Sep22","Drops3","Red","Pink"]},is_available:!1,unlock:"manual"},{id:1345,name:"Deal with it Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_deal",tags:["Sep22","Drops3","Black","Meme"]},is_available:!1,unlock:"manual"},{id:1346,name:"Kilzomatic Hat",price:6e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kilzomatic",tags:["Sep22","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:1347,name:"Sharkbucks Hat",price:6900,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sharkbucks",tags:["Sep22","Pink","Blue"]},is_available:!0,unlock:"purchase"},{id:1348,name:"The cap cap",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cap",tags:["Newsletter","Blue"]},is_available:!1,unlock:"manual"},{id:1349,name:"Teggtris wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Tetris",tags:["Sep22","Premium","Rainbow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_teggtris"]},{id:1350,name:"Scary Balloon Hat",price:1990,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_balloon",tags:["Halloween3","OctM23","Blue"]},is_available:!1,unlock:"purchase"},{id:1351,name:"Witch Cobwebs Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cobweb",tags:["Halloween3","Newsletter","OctM23","Purple","Black"]},is_available:!1,unlock:"manual"},{id:1352,name:"Cauldron Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cauldron",tags:["Halloween3","OctM23","Black"]},is_available:!1,unlock:"purchase"},{id:1353,name:"Mummy Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mummy",tags:["Halloween3","OctM23","White"]},is_available:!1,unlock:"purchase"},{id:1354,name:"Black Cat Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kitten",tags:["Halloween3","OctM23","Black"]},is_available:!1,unlock:"purchase"},{id:1355,name:"Dracula Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dracula",tags:["Halloween3","OctM23","White","Grey","Gray","Black"]},is_available:!1,unlock:"purchase"},{id:1356,name:"Blood Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_BloodWings",tags:["Halloween3","Jun23","Red"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_bloodwing"]},{id:1357,name:"It's Corn Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_corn",tags:["NovM23","Thanksgiving2","Meme","Yellow","Food","Nov23"]},is_available:!1,unlock:"purchase"},{id:1358,name:"NPS Clan Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_NPS",tags:["League"]},is_available:!1,unlock:"manual"},{id:1359,name:"Drone Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_drone",tags:["Badegg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1360,name:"Tactical Vest",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tacticalvest",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:1361,name:"Medbox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_medbox",tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:1362,name:"Crash Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crash",tags:["Badegg","Red"]},is_available:!1,unlock:"purchase"},{id:1363,name:"Fall Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Fall",tags:["Badegg","SepM23","Orange","Brown"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_fall"]},{id:1364,name:"Ribbon Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ribbon",tags:["Red"]},is_available:!1,unlock:"purchase"},{id:1365,name:"Santa hat & Beard",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_santabeard",tags:["Christmas2","Newsletter","Red","White"]},is_available:!1,unlock:"manual"},{id:1366,name:"Sailor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sailor",tags:["Newsletter","White"]},is_available:!1,unlock:"manual"},{id:1367,name:"Party Hat 2023",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1368,name:"2023 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1369,name:"Holly Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Holly",tags:["Dec23","Red","Green"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_holy_wings"]},{id:1370,name:"Piano Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piano",tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:1371,name:"Gramophone Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gramaphone",tags:["Rockstar","JanM23","Gold","Yellow","Brown","Music"]},is_available:!1,unlock:"purchase"},{id:1372,name:"Sound Wave Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Music",tags:["Rockstar","Premium","JanM23","Blue","Purple","Blurple","Music"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_soundwave"]},{id:1373,name:"Fancy Band Hat",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fancyband",tags:["Rockstar","JanM23","Blue","Green","Gold","Music"]},is_available:!1,unlock:"purchase"},{id:1374,name:"Winter Scarf",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scarf",tags:["Groundhog","Feb23","Red"]},is_available:!1,unlock:"purchase"},{id:1375,name:"Bull hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bull",tags:["farm","FebM23","Bone","Brown","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1376,name:"Farmer Shirt",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_farmer",tags:["farm","FebM23","Red"]},is_available:!1,unlock:"purchase"},{id:1377,name:"Cowbell Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cowbell",tags:["farm","FebM23","Silver"]},is_available:!1,unlock:"purchase"},{id:1378,name:"Barrel Eye",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_barrel",tags:["Drops4","Mar23","AugM23","Brown","Silver","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1379,name:"Kiwi Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kiwi",tags:["Drops4","Mar23","AugM23","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1380,name:"Eggscellent Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggscellent",tags:["Drops4","Mar23","AugM23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1381,name:"KJs Dad",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_oldman",tags:["Drops4","Mar23","Old","Grey","Gray","Meme","Hair"]},is_available:!1,unlock:"purchase"},{id:1382,name:"Novosuper Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_novo",tags:["Drops4","Mar23","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:1383,name:"Bracket Shell",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_banana",tags:["Drops4","Mar23","Yellow","Blue","Bananas"]},is_available:!1,unlock:"manual"},{id:1384,name:"The Mask of Paradise",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_paradise",tags:["Drops4","Mar23","Black"]},is_available:!1,unlock:"manual"},{id:1385,name:"xQc Hair",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_xhair",tags:["Drops4","Mar23","White","Black","Red","Meme"]},is_available:!1,unlock:"manual"},{id:1386,name:"Marshmallow Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_marshmallow",tags:["Drops4","Mar23","White","Red"]},is_available:!1,unlock:"manual"},{id:1387,name:"Big Brain Hat",price:100,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brain",tags:["Drops4","Mar23","AugM23","OctM23","Pink"]},is_available:!1,unlock:"purchase"},{id:1388,name:"Fusion Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fusion",tags:["Newsletter","Mar23","White","Blue"]},is_available:!1,unlock:"manual"},{id:1389,name:"Harp Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Harp",tags:["Premium","Mar23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_harp"]},{id:1390,name:"Longhorn Bros",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_longhorns",tags:["Bros","MarM23","Bone","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:1391,name:"Purdue Bros",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purdue",tags:["Bros","MarM23","Yellow","White","Black"]},is_available:!1,unlock:"purchase"},{id:1392,name:"Scoreboard Bros",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_scoreboard",tags:["Bros","MarM23","Blue","Red"]},is_available:!1,unlock:"purchase"},{id:1393,name:"Drenched Bros",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gamerjuice",tags:["Bros","MarM23","Blue","Grey","Gray","Orange","Electrolytes"]},is_available:!1,unlock:"purchase"},{id:1394,name:"Hooped Hat",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Hoop",tags:["Bros","MarM23","White","Red"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_hooped"]},{id:1395,name:"Brown Wizard Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_brownwizard",tags:["Heroes","Apr23","Brown"]},is_available:!1,unlock:"purchase"},{id:1396,name:"Elf Ears Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_elfear",tags:["Heroes","Apr23","Grey","Gray","Hair"]},is_available:!1,unlock:"purchase"},{id:1397,name:"Dwarf Beard",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dwarf",tags:["Heroes","Apr23","Orange"]},is_available:!1,unlock:"purchase"},{id:1398,name:"Gelatinous Cube Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cube",tags:["Monsters","Apr23","Green"]},is_available:!1,unlock:"purchase"},{id:1399,name:"Purple Worm Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wurm",tags:["Monsters","Apr23","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:1400,name:"Question Block Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_MysteryWings",tags:["AprM23","Aug23","JanM24","White","Yellow","?","premFeatTwo"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_qwings"]},{id:1401,name:"Green Dino Head",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_greendino",tags:["Dino2","May23","Green"]},is_available:!1,unlock:"purchase"},{id:1402,name:"Blue Dino Tail",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinotailblue",tags:["Dino2","May23","Blue"]},is_available:!1,unlock:"purchase"},{id:1403,name:"Caveman Hair",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_caveman",tags:["Dino2","May23","Brown"]},is_available:!1,unlock:"purchase"},{id:1404,name:"Leopard Sash",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skinsash",tags:["Dino2","May23","Orange","Black"]},is_available:!1,unlock:"purchase"},{id:1405,name:"Tiger Sash",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_tigersash",tags:["Dino2","May23","Newsletter","Orange","Black"]},is_available:!1,unlock:"manual"},{id:1406,name:"Egg Chest Hat",price:3e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldchest",tags:["Eggflation","MayM23","Gold","Brown"]},is_available:!0,unlock:"purchase"},{id:1407,name:"Golden Nugget Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_goldnugget",tags:["Eggflation","MayM23","Gold"]},is_available:!0,unlock:"purchase"},{id:1408,name:"Photobooth Top Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothtophat",tags:["Photo","Jun23","Black"]},is_available:!1,unlock:"purchase"},{id:1409,name:"Photobooth Bow",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothbow",tags:["Photo","Jun23","Black","Red"]},is_available:!1,unlock:"purchase"},{id:1410,name:"Photobooth Crown",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcrown",tags:["Photo","Jun23","Gold"]},is_available:!1,unlock:"purchase"},{id:1411,name:"Photobooth Cake",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_boothcake",tags:["Newsletter","Photo","Jun23","White"]},is_available:!1,unlock:"manual"},{id:1412,name:"Red Snorkel",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelred",tags:["Summer2","JunM23","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:1413,name:"Blue Snorkel",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snorkelblue",tags:["Summer2","JunM23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1414,name:"Beach Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_beach",tags:["Summer2","JunM23","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1415,name:"Sandcastle Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sandcastle",tags:["Summer2","JunM23","Gold","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:1416,name:"Crab Hat",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_crab",tags:["Summer2","JunM23","Red","Meme"]},is_available:!1,unlock:"purchase"},{id:1417,name:"Octopus Surfboard",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Octopus",tags:["Summer2","JunM23","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_surf"]},{id:1418,name:"Equinox Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinox",tags:["Equinox","July23","Gold","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1419,name:"Equinox Sun Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxSun",tags:["Equinox","July23","Gold","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:1420,name:"Equinox Moon Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_equinoxMoon",tags:["Equinox","July23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1421,name:"Bonsai Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bonsai",tags:["Equinox","July23","Blue","Yellow","Green","Brown"]},is_available:!1,unlock:"purchase"},{id:1422,name:"Skull Trio Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skulls",tags:["Newsletter","July23","Bone","Brown"]},is_available:!1,unlock:"manual"},{id:1423,name:"Scales of Justice Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Scales",tags:["July23","Gold"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_scales"]},{id:1424,name:"Biker Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremehelm",tags:["Sports2","JulyM23","Black","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:1425,name:"Climbing Gear Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeclimb",tags:["Sports2","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:1426,name:"Ski Bum Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_extremeskis",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"purchase"},{id:1427,name:"Stickers Helmet",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_stickers",tags:["Sports2","JulyM23","Black","Egg"]},is_available:!1,unlock:"purchase"},{id:1428,name:"Hang Glider Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Glider",tags:["Sports2","JulyM23","Rainbow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_glider"]},{id:1429,name:"Red Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartRed",tags:["Kart","Aug23","Red"]},is_available:!1,unlock:"purchase"},{id:1430,name:"Green Kart",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartGreen",tags:["Kart","Aug23","Green"]},is_available:!1,unlock:"purchase"},{id:1431,name:"Pink Kart",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartPink",tags:["Kart","Aug23","Pink"]},is_available:!1,unlock:"purchase"},{id:1432,name:"Yellow Kart",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_kartYellow",tags:["Kart","Aug23","Yellow"]},is_available:!1,unlock:"purchase"},{id:1433,name:"Piranha Hat",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_piranha",tags:["Kart","Aug23","Red","White","Green"]},is_available:!1,unlock:"purchase"},{id:1434,name:"Big Biter Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_chomp",tags:["Kart","Aug23","Blue","Chomp"]},is_available:!1,unlock:"purchase"},{id:1435,name:"Gang Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_gang",tags:["SL","Blue"]},is_available:!1,unlock:"manual"},{id:1436,name:"Fluffly Meteor Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fluffy",tags:["Drops5","AugM23","Blue"]},is_available:!1,unlock:"manual"},{id:1437,name:"King Hayden Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_hayden",tags:["Drops5","AugM23","Gold"]},is_available:!1,unlock:"manual"},{id:1438,name:"Anarchy Arden",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academymale",tags:["Sep23","Pencil3","Egg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1439,name:"Anarchy Ashley",price:2500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_academyfemale",tags:["Sep23","Pencil3","Egg","Blue","White"]},is_available:!1,unlock:"purchase"},{id:1440,name:"Dunce Cap",price:4e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dunce",tags:["Sep23","Pencil3","White"]},is_available:!1,unlock:"purchase"},{id:1441,name:"The Toolbelt",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toolbelt",tags:["Sep23","Pencil3","Newsletter","Brown"]},is_available:!1,unlock:"manual"},{id:1442,name:"Wrestle Shoes Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shoetie",tags:["SepM23","WBs","Black"]},is_available:!1,unlock:"purchase"},{id:1443,name:"Wrestling Belt",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlebelt",tags:["SepM23","WBs","Gold","Black"]},is_available:!1,unlock:"purchase"},{id:1444,name:"Wrestling Ring Hat",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wrestlering",tags:["SepM23","WBs","White","Black","Red","White","Blue"]},is_available:!1,unlock:"purchase"},{id:1445,name:"The Grand Entrance Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Firework",tags:["SepM23","WBs","Red","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_wbs"]},{id:1446,name:"Angler Fish Hat",price:3500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_angler",tags:["Oct23","Halloween4","Brown"]},is_available:!1,unlock:"purchase"},{id:1447,name:"Hungry Shark Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_shark",tags:["Oct23","Halloween4","Grey","Gray","Silver"]},is_available:!1,unlock:"purchase"},{id:1448,name:"Baby Ghost Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_babyghost",tags:["Oct23","Halloween4","White"]},is_available:!1,unlock:"purchase"},{id:1449,name:"Captain Inksalot Hat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_squidpatch",tags:["Oct23","Halloween4","Newsletter","Green"]},is_available:!1,unlock:"manual"},{id:1450,name:"Demon Pixel Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_PixelDemon",tags:["Oct23","Halloween4","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_demonpixel"]},{id:1451,name:"Purple Witch's Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_purplewitch",tags:["OctM23","Halloween4","Purple"]},is_available:!1,unlock:"purchase"},{id:1452,name:"Wednesday Morning Hair",price:2020,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_addams",tags:["OctM23","Halloween4","Black"]},is_available:!1,unlock:"purchase"},{id:1453,name:"Ectoplasmic Goo",price:1980,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_slime",tags:["OctM23","Halloween4","Green"]},is_available:!1,unlock:"purchase"},{id:1454,name:"Stapled Bear Friend",price:2010,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_bear",tags:["OctM23","Halloween4","Brown"]},is_available:!1,unlock:"purchase"},{id:1455,name:"Ancient Egg Hat",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruins",tags:["Nov23","Mayan","Green","Gray","Grey","Stone","Plant"]},is_available:!1,unlock:"purchase"},{id:1456,name:"The Ruins Explorer",price:250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_ruinsexplorer",tags:["Nov23","Mayan","Brown","Stone","Plant","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1457,name:"Indianapolis Jones",price:1750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_explorer",tags:["Nov23","Mayan","Brown"]},is_available:!1,unlock:"purchase"},{id:1458,name:"Mayan Warrior Mask",price:1500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan",tags:["Nov23","Mayan","Brown","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:1459,name:"Meso-Mage Mask",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mayan2",tags:["Nov23","Mayan","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:1460,name:"The Fallen Explorer",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_overgrown",tags:["Nov23","Newsletter","Mayan","Red","Green"]},is_available:!1,unlock:"manual"},{id:1461,name:"Ruins Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_Ruins",tags:["Nov23","Mayan","Green","Gray","Grey"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_mayan"]},{id:1462,name:"Fall Pilgrim Hat",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_fallhat",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1463,name:"Kindergarden Turkey",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_sillyturkey",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1464,name:"All the Fixin's Hat",price:1250,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_dinner",tags:["NovM23","Thanksgiving3","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:1465,name:"Bread Cat",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_toastcat",tags:["Xsolla","Brown","Meow","Kitty","Kitten"]},is_available:!1,unlock:"manual",activeProduct:!1,sku:["item_hat_breadcat"]},{id:1466,name:"Wreathed Egg",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_wreath",tags:["Christmas3","Dec23","Green","Red"]},is_available:!1,unlock:"purchase"},{id:1467,name:"Frosty",price:2e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_snowman",tags:["Christmas3","Dec23","White","Yellow","Carrot"]},is_available:!1,unlock:"purchase"},{id:1468,name:"Mistletoe Hat",price:750,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_mistletoe",tags:["Christmas3","Dec23","Green","Red","Kiss"]},is_available:!1,unlock:"purchase"},{id:1469,name:"Eggsmas Tree",price:500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_christmastree",tags:["Christmas3","Dec23","Green","Red","Star"]},is_available:!1,unlock:"purchase"},{id:1470,name:"Snow Owl Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SnowOwl",tags:["Christmas3","Dec23","Green","Red"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_hat_owl"]},{id:1471,name:"Egg'Noggin",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_eggnog",tags:["Christmas3","Dec23","Green","Red"]},is_available:!1,unlock:"manual"},{id:1472,name:"Party Hat 2024",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_party2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!0,unlock:"purchase"},{id:1473,name:"2024 Headband",price:1e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_2024",tags:["NewYears","2024","DecM23","Blue","White"]},is_available:!0,unlock:"purchase"},{id:1474,name:"Discord Dev Day Crown",price:2147483647,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_discorders",tags:["promo","Blurple"]},is_available:!1,unlock:"manual"},{id:1475,name:"Disco Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_NewYearsDisco",tags:["NewYears","2024","DecM23","Blurple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_hat_disco"]},{id:1476,name:"The CyberCluck",price:125e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_cybercar",tags:["Cybertruck","Truck","Musk","Silver","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:1477,name:"Lightning Helmet",price:5e3,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_lightninghelm",tags:["JanM24","Racer","Orange"]},is_available:!0,unlock:"purchase"},{id:1478,name:"Skull Helmet",price:1e4,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_skullhelm",tags:["JanM24","Racer","Gray","Grey","Silver"]},is_available:!0,unlock:"purchase"},{id:1479,name:"Targeted Bandana",price:7500,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_targetbandana",tags:["JanM24","Black","Racer"]},is_available:!0,unlock:"purchase"},{id:1480,name:"The Racing Spoiler Wings",price:5,item_type_id:1,item_type_name:"Hat",category_name:"Hats",exclusive_for_class:null,item_data:{meshName:"hat_premium_SpoilerWings",tags:["JanM24","Egg","Racer","Orange"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_hat_racecar"]},{id:2001,name:"Target Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:0,tags:["Default","Red","Blue","Yellow"]},is_available:!0,unlock:"default"},{id:2002,name:"No Sign Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:0,tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:2003,name:"Question Mark Stamp?",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:0,tags:["Default","Black","?"]},is_available:!0,unlock:"default"},{id:2004,name:"Peace Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:0,tags:["Default","Black"]},is_available:!0,unlock:"default"},{id:2005,name:"Thumbs Up Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:0,tags:["Default","White"]},is_available:!0,unlock:"default"},{id:2006,name:"Pablo Smile Stamp",price:0,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:0,tags:["Default","Happy","Face","Yellow"]},is_available:!0,unlock:"default"},{id:2007,name:"Skull & Crossbones Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2008,name:"Tyrant Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:3,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2009,name:"Shifty Eye Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:5,tags:["Purple"]},is_available:!0,unlock:"purchase"},{id:2010,name:"Arrow & Heart Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:6,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2011,name:"Grade A Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:1,tags:["Red","USDA"]},is_available:!0,unlock:"purchase"},{id:2012,name:"Anarchy Sign Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:1,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2013,name:"Derp Face Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:2,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2014,name:"Wolf Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2015,name:"Chicken Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:6,tags:["Brown"]},is_available:!0,unlock:"purchase"},{id:2016,name:"Phoenix Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:7,tags:["Red"]},is_available:!0,unlock:"purchase"},{id:2017,name:"Alien Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:7,tags:["Green"]},is_available:!0,unlock:"purchase"},{id:2018,name:"Dapper Mustache Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2019,name:"Happy Bear Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:8,tags:["Pink","Smile"]},is_available:!0,unlock:"purchase"},{id:2020,name:"Ghost Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:8,tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2021,name:"Jack Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:8,tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2022,name:"Cracks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:9,tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2023,name:"Bat Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:9,tags:["Halloween","Oct23","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2024,name:"Cthulhu Fhtagn Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:9,tags:["Halloween","Oct23","Green"]},is_available:!1,unlock:"purchase"},{id:2025,name:"Elder Sign Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:9,tags:["Halloween","Oct23","Red"]},is_available:!1,unlock:"purchase"},{id:2026,name:"Scary Teeth Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:9,tags:["Halloween","Oct23","Smile","Green"]},is_available:!1,unlock:"purchase"},{id:2027,name:"Monster Tongue Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:9,tags:["Halloween","Oct23","Face"]},is_available:!1,unlock:"purchase"},{id:2028,name:"Spooky Lady Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:9,tags:["Halloween","Oct23","Face"]},is_available:!1,unlock:"purchase"},{id:2029,name:"Clown Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:10,tags:["Halloween","Oct23","Smile"]},is_available:!1,unlock:"purchase"},{id:2030,name:"Stitch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:10,tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2031,name:"Devil Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:10,tags:["Halloween","Oct23","Smile"]},is_available:!1,unlock:"purchase"},{id:2032,name:"Face Mask Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:10,tags:["Halloween","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2033,name:"Hand Turkey Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:10,tags:["NovM23","Thanksgiving"]},is_available:!1,unlock:"purchase"},{id:2034,name:"Turkey Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:10,tags:["NovM23","Thanksgiving"]},is_available:!1,unlock:"purchase"},{id:2035,name:"Turkey Crossbones Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:10,tags:["NovM23","Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2036,name:"Reindeer Face Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:11,tags:["Dec23","Christmas","Red"]},is_available:!1,unlock:"purchase"},{id:2037,name:"Gingerbread Cookie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:11,tags:["Dec23","Christmas","Brown"]},is_available:!1,unlock:"purchase"},{id:2038,name:"Santa Skull Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:11,tags:["Christmas2","Red"]},is_available:!1,unlock:"purchase"},{id:2039,name:"2019 Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:11,tags:["NewYears","2019","Yellow","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2040,name:"Fireworks Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:11,tags:["NewYears","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:2041,name:"Midnight Clock Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:11,tags:["NewYears"]},is_available:!0,unlock:"purchase"},{id:2042,name:"Stressed Out Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:7,tags:["Newsletter","Face"]},is_available:!1,unlock:"manual"},{id:2043,name:"Chicken Finger Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:8,tags:["Newsletter"]},is_available:!1,unlock:"manual"},{id:2044,name:"Lyerpald Stamp ",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Contentcreator"]},is_available:!1,unlock:"manual"},{id:2045,name:"Groundhog Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:11,tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:2046,name:"Winter Snowflake Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:12,tags:["Groundhog","Feb23","Blue"]},is_available:!1,unlock:"purchase"},{id:2047,name:"Spring Flower Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:12,tags:["Groundhog","Feb23","Pink"]},is_available:!1,unlock:"purchase"},{id:2048,name:"Broken Heart Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:12,tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:2049,name:"Rose Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:12,tags:["ValentinesDay","Red"]},is_available:!1,unlock:"purchase"},{id:2050,name:"Anatomical Heart Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:12,tags:["ValentinesDay","Heart"]},is_available:!1,unlock:"purchase"},{id:2051,name:"Shamrock Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:12,tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:2052,name:"Ginger Beard Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:12,tags:["StPatricksDay","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2053,name:"Pot of Gold Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:13,tags:["StPatricksDay","MarM23"]},is_available:!1,unlock:"purchase"},{id:2054,name:"Bunny Face Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:13,tags:["Easter","AprM23","Heart"]},is_available:!0,unlock:"purchase"},{id:2055,name:"Easter Egg Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:13,tags:["Easter","AprM23","Blue","White"]},is_available:!1,unlock:"purchase"},{id:2056,name:"Golden Easter Egg Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:13,tags:["Easter"]},is_available:!1,unlock:"purchase"},{id:2057,name:"Shell League Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:13,tags:["League"]},is_available:!0,unlock:"purchase"},{id:2058,name:"TXC Clan Logo Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:13,tags:["Green","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:2071,name:"GOD Clan Logo",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:15,tags:["Blue"]},is_available:!0,unlock:"purchase"},{id:2059,name:"Sherrif Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2060,name:"Rainbow Cloud Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:5,tags:["Cute"]},is_available:!0,unlock:"purchase"},{id:2061,name:"Angel Wings Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:6,tags:["Yellow"]},is_available:!0,unlock:"purchase"},{id:2062,name:"GoE Sigil - Wolf Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:13,tags:["GameOfEggs","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2063,name:"GoE Sigil - Lion Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:14,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2064,name:"GoE Sigil - Bird Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:14,tags:["GameOfEggs","Blue"]},is_available:!0,unlock:"purchase"},{id:2065,name:"GoE Sigil - Stag Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:14,tags:["GameOfEggs","Yellow"]},is_available:!0,unlock:"purchase"},{id:2066,name:"GoE Sigil - Fish Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:14,tags:["GameOfEggs","Orange"]},is_available:!0,unlock:"purchase"},{id:2067,name:"GoE Sigil - Squid Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:14,tags:["GameOfEggs","Black"]},is_available:!0,unlock:"purchase"},{id:2068,name:"GoE Sigil - Sun Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:14,tags:["GameOfEggs","Orange","Red"]},is_available:!0,unlock:"purchase"},{id:2069,name:"GoE Sigil - Flower Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:14,tags:["GameOfEggs","Green","Yellow"]},is_available:!0,unlock:"purchase"},{id:2070,name:"GoE Sigil - Dragon Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:0,y:15,tags:["GameOfEggs","Red"]},is_available:!0,unlock:"purchase"},{id:2072,name:"4th of July Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:15,tags:["July4","Red","Blue","Fireworks"]},is_available:!1,unlock:"purchase"},{id:2073,name:"SL MVP Division A Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2074,name:"SL MVP Division B Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:15,tags:["League"]},is_available:!1,unlock:"manual"},{id:2075,name:"CRGI Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:15,tags:["League","Dog"]},is_available:!1,unlock:"manual"},{id:2076,name:"Robot Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:6,tags:["Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2077,name:"Poop Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:7,tags:["Brown","Poop"]},is_available:!0,unlock:"purchase"},{id:2078,name:"Heart Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2079,name:"Spade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2080,name:"Club Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:1,tags:["Cards","Black"]},is_available:!1,unlock:"purchase"},{id:2081,name:"Diamond Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:1,tags:["Cards","Red"]},is_available:!1,unlock:"purchase"},{id:2082,name:"What Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:4,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2083,name:"Yes Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2084,name:"No Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:6,y:2,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2085,name:"Ribcage Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:5,tags:["Black"]},is_available:!0,unlock:"purchase"},{id:2086,name:"Angry Cartridge Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:8,tags:["Grey","Gray","Mouth"]},is_available:!0,unlock:"purchase"},{id:2087,name:"DXG Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:0,tags:["League"]},is_available:!1,unlock:"manual"},{id:2088,name:"Tired Space Goblin Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:2,tags:["Eggwalker","Green"]},is_available:!1,unlock:"purchase"},{id:2089,name:"Angry Space Dog Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:3,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2090,name:"No Trying Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:4,tags:["Eggwalker","Red"]},is_available:!1,unlock:"purchase"},{id:2091,name:"Disgruntled Space Weasel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:5,tags:["Eggwalker","Brown"]},is_available:!1,unlock:"purchase"},{id:2092,name:"White Beard Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:1,tags:["Newsletter","Christmas","Santa"]},is_available:!1,unlock:"manual"},{id:2093,name:"Strong Egg Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:5,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2094,name:"New Years 2020 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:6,tags:["NewYears","2020","Yellow","White"]},is_available:!1,unlock:"purchase"},{id:2095,name:"Bad Eggs For Life Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:8,tags:["BadEggsForLife","Jun23"]},is_available:!1,unlock:"purchase"},{id:2096,name:"Pixel Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:9,tags:["Newsletter","Red"]},is_available:!1,unlock:"manual"},{id:2097,name:"Eggy Cash Face Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:2,y:15,tags:["EggyCash","Face","Black"]},is_available:!0,unlock:"purchase"},{id:2098,name:"DXG Clan Logo 2 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2099,name:"Raid Land Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:11,tags:["RaidLand"]},is_available:!1,unlock:"purchase"},{id:2100,name:"Egg Org Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:12,tags:["AprilFools","Black"]},is_available:!1,unlock:"purchase"},{id:2101,name:"MVP 2020 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:13,tags:["League"]},is_available:!1,unlock:"manual"},{id:2102,name:"TXC Clan Skull Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:14,tags:["League","Purple"]},is_available:!1,unlock:"manual"},{id:2103,name:"Toxic Skull Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:15,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2104,name:"Toxic Nuke Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:0,tags:["Rotten","Green"]},is_available:!0,unlock:"purchase"},{id:2105,name:"Toxic Derp Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:1,tags:["Rotten","Green","Smile"]},is_available:!0,unlock:"purchase"},{id:2106,name:"Facepaint Heart Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:5,tags:["Rockstar","JanM23","Pink","Music"]},is_available:!1,unlock:"purchase"},{id:2107,name:"Facepaint Star Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:6,tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:2108,name:"Facepaint Lightning Bolt Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:4,tags:["Rockstar","JanM23","Yellow","Music"]},is_available:!1,unlock:"purchase"},{id:2109,name:"Pink Starburst Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:7,tags:["Galeggsy","AprM23"]},is_available:!1,unlock:"purchase"},{id:2110,name:"Alien Eyes 1 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:8,tags:["Galeggsy","AprM23","Face"]},is_available:!1,unlock:"purchase"},{id:2111,name:"Alien Eyes 2 Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:9,tags:["Galeggsy","AprM23","Face","Cute"]},is_available:!1,unlock:"purchase"},{id:2112,name:"Flame Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:7,y:7,tags:["Newsletter","Fire","Red","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2113,name:"Discord Mod Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:13,tags:["mod"]},is_available:!1,unlock:"manual"},{id:2114,name:"Black Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:14,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2115,name:"Red Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:15,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2116,name:"Pink Tie Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:0,tags:["MercZone","Suit","Tie"]},is_available:!1,unlock:"manual"},{id:2117,name:"Killstreak Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:1,tags:["Killstreak","Smile","Red"]},is_available:!1,unlock:"manual"},{id:2118,name:"Red Rooster Wings Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:10,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2119,name:"White Rooster Wings Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:11,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2120,name:"Gold Rooster Wings Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:8,y:12,tags:["Chicken","July23"]},is_available:!1,unlock:"purchase"},{id:2121,name:"Ugly Jason Face Stamp",price:1300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:2,tags:["f13"]},is_available:!0,unlock:"purchase"},{id:2122,name:"Little Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:3,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2123,name:"Angry Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:4,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2124,name:"Why Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:5,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2125,name:"Influenced Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:6,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2126,name:"Nervous Crush Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:7,tags:["Stampede","Face","Red"]},is_available:!0,unlock:"purchase"},{id:2127,name:"Girly Eyes Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:8,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2128,name:"Big Smile Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:9,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2129,name:"Cyclops Face Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:10,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2130,name:"Grumpy Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:11,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2131,name:"Big Happy Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:12,tags:["Stampede","Smile","Face"]},is_available:!0,unlock:"purchase"},{id:2132,name:"Scared Stamp",price:1005,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:13,tags:["Stampede","Face"]},is_available:!0,unlock:"purchase"},{id:2133,name:"This Guy Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:14,tags:["Stampede","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2134,name:"Tumble Dude Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:9,y:15,tags:["Stampede","White","Face"]},is_available:!0,unlock:"purchase"},{id:2135,name:"Thee_Owl Angry Face Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:0,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2136,name:"Blow Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:1,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2137,name:"Whip Em Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:2,tags:["Stampede","Blue","Whisk"]},is_available:!0,unlock:"purchase"},{id:2138,name:"Baby on Board Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:3,tags:["Stampede","Chick","Yellow"]},is_available:!0,unlock:"purchase"},{id:2139,name:"Thee_Owl Scared Face Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:4,tags:["Stampede"]},is_available:!0,unlock:"purchase"},{id:2140,name:"Yin Yang Chicken Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:5,tags:["Stampede","Black","White"]},is_available:!0,unlock:"purchase"},{id:2141,name:"Blue Wizard Guy Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:3,y:8,tags:["Newsletter","Black"]},is_available:!1,unlock:"manual"},{id:2142,name:"God Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:6,tags:["League","Red","Orange"]},is_available:!1,unlock:"manual"},{id:2143,name:"Wero Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:7,tags:["Wero","Beard"]},is_available:!0,unlock:"purchase"},{id:2144,name:"New Years 2021 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:8,tags:["NewYears","2021","Green"]},is_available:!1,unlock:"purchase"},{id:2145,name:"Thee_Owl Logo Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:9,tags:["ThreeOwl","Green"]},is_available:!0,unlock:"purchase"},{id:2146,name:"Biggest Mouth Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:5,tags:["Newsletter","Ahh"]},is_available:!1,unlock:"manual"},{id:2147,name:"C4bra Ram Outfit Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:7,tags:["C4bra"]},is_available:!0,unlock:"purchase"},{id:2148,name:"Hazmatt Thumbs Up Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:8,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2149,name:"Hazmatt POG Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:9,tags:["Hazmat","Yellow"]},is_available:!0,unlock:"purchase"},{id:2150,name:"Pixel Tech Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:10,tags:["Pixel","Green"]},is_available:!0,unlock:"purchase"},{id:2151,name:"Pixel Chicken Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:11,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2152,name:"Pixel Gun Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:12,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2153,name:"Pixel Robot Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:13,tags:["Pixel","Blue"]},is_available:!0,unlock:"purchase"},{id:2154,name:"Pixel Shield Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:14,tags:["Pixel","Eggs"]},is_available:!0,unlock:"purchase"},{id:2155,name:"Pixel Egg Splat Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:10,y:15,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2156,name:"Pixel Swords Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:0,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2157,name:"Pixel Happy Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:1,tags:["Pixel","Smile"]},is_available:!0,unlock:"purchase"},{id:2158,name:"Pixel Angry Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:2,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2159,name:"Pixel Annoyed Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:3,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2160,name:"Pixel Dead Face Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:4,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2161,name:"Pixel Deal With It Sunglasses Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:5,tags:["Pixel"]},is_available:!0,unlock:"purchase"},{id:2162,name:"Angry Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:12,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2163,name:"Cat Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:13,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2164,name:"Crazy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:14,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2165,name:"Dog Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:15,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2166,name:"Evil Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:0,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2167,name:"Grinning Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:1,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2168,name:"Happy Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:2,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2169,name:"Laughing Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:3,tags:["Mouth","Smile"]},is_available:!0,unlock:"purchase"},{id:2170,name:"Pirate Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:4,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2171,name:"Sick Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:5,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2172,name:"Smiling Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:6,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2173,name:"Tongue-Out Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:7,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2174,name:"Upset Mouth Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:8,tags:["Mouth"]},is_available:!0,unlock:"purchase"},{id:2175,name:"Dead BW Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:10,tags:["EGGORG","Wizard","Blue"]},is_available:!1,unlock:"purchase"},{id:2176,name:"Egg Org Spokesperson Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:11,tags:["EGGORG"]},is_available:!1,unlock:"purchase"},{id:2177,name:"Aries Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:12,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2178,name:"Diablo Frown Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:9,tags:["EGGORG"]},is_available:!1,unlock:"purchase"},{id:2179,name:"Train Ticket Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:11,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2180,name:"Train Engine Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:13,tags:["Trains","Cars","Black"]},is_available:!0,unlock:"purchase"},{id:2181,name:"All Aboard Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:14,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2182,name:"Pain Train's Comin Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:12,y:15,tags:["Trains","Cars"]},is_available:!0,unlock:"purchase"},{id:2183,name:"Random Life Logo Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:0,tags:["Random","RL"]},is_available:!0,unlock:"purchase"},{id:2184,name:"Shell Mobile QR Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:5},is_available:!0,unlock:"purchase"},{id:2185,name:"Ethan Gamer Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:4,tags:["EthanGamer","Red"]},is_available:!0,unlock:"purchase"},{id:2186,name:"Red Aries Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:10,tags:["League"]},is_available:!1,unlock:"manual"},{id:2187,name:"Toilet Paper Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:11,y:6,tags:["TP","Poop"]},is_available:!1,unlock:"purchase"},{id:2188,name:"Water Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:8,tags:["Summer","JunM23","Blue","Water"]},is_available:!1,unlock:"purchase"},{id:2189,name:"Popsicle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:6,tags:["Summer","JunM23","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:2190,name:"Sun Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:7,tags:["Summer","JunM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2191,name:"Postage Stamp",price:3e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:9,tags:["Summer","JunM23"]},is_available:!1,unlock:"purchase"},{id:2192,name:"Blue Wizard Skull Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:5,y:6,tags:["BWD"]},is_available:!0,unlock:"purchase"},{id:2193,name:"Lyerpald Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:1,y:8,tags:["Dog","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:2194,name:"SL NA#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:1,tags:["League","Yellow"]},is_available:!1,unlock:"manual"},{id:2195,name:"SL EU#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:2,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2196,name:"SL OCE#1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:3,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2197,name:"I <3 New Yolker Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:11,tags:["Newsletter","Heart","NY"]},is_available:!1,unlock:"manual"},{id:2198,name:"Egg Heart Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:12,tags:["White"]},is_available:!1,unlock:"manual"},{id:2199,name:"Chantigg Face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:13,tags:["Chantigg","Smile"]},is_available:!0,unlock:"purchase"},{id:2200,name:"Chantigg Cake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:14,tags:["Chantigg","Food"]},is_available:!0,unlock:"purchase"},{id:2201,name:"Grade A+ Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:0,tags:["Pencil","Sep23","Red"]},is_available:!1,unlock:"purchase"},{id:2202,name:"Globe Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:1,tags:["Pencil","Sep23","Earth","Green","Blue"]},is_available:!1,unlock:"purchase"},{id:2203,name:"Nerd Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:13,y:15,tags:["Pencil","Sep23","Smile"]},is_available:!1,unlock:"purchase"},{id:2204,name:"Gold Beak Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:13,tags:["vipItem","Premium"]},is_available:!0,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:2205,name:"Zombie Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:10,tags:["Halloween2","Oct23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2206,name:"Werewolf Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:9,tags:["Halloween2","Oct23","Pink"]},is_available:!1,unlock:"purchase"},{id:2207,name:"Vampire Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:8,tags:["Halloween2","Oct23","Red"]},is_available:!1,unlock:"purchase"},{id:2208,name:"Sasquatch Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:7,tags:["Halloween2","Oct23","Brown"]},is_available:!1,unlock:"purchase"},{id:2209,name:"Medusa Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:6,tags:["Halloween2","Oct23","Green"]},is_available:!1,unlock:"purchase"},{id:2210,name:"Blue Cyclops Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:5,tags:["Halloween2","Oct23","Blue"]},is_available:!1,unlock:"purchase"},{id:2211,name:"Cthulu Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:4,tags:["Halloween2","Oct23","Green"]},is_available:!1,unlock:"purchase"},{id:2212,name:"Baldwiz Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:3,tags:["Halloween2","Oct23","Skull"]},is_available:!1,unlock:"purchase"},{id:2213,name:"Fang Pablo Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:11,tags:["Halloween2","Oct23","Smile"]},is_available:!1,unlock:"purchase"},{id:2214,name:"Jack'o'lantern Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:12,tags:["Halloween2","Oct23","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2215,name:"Circle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:0,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2216,name:"Square Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:15,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2217,name:"Umbrella Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:1,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2218,name:"Triangle Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:14,y:14,tags:["Egg Game","Black"]},is_available:!0,unlock:"purchase"},{id:2219,name:"NACL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:2,tags:["League","Yellow","Blue"]},is_available:!1,unlock:"manual"},{id:2220,name:"RBL Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:3,tags:["League","Black","Red"]},is_available:!1,unlock:"manual"},{id:2221,name:"Sheesh Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:11},is_available:!0,unlock:"purchase"},{id:2222,name:"Black Eggs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:10,tags:["Black Fryday"]},is_available:!1,unlock:"purchase"},{id:2223,name:"Black Fries Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:9,tags:["Black Fryday"]},is_available:!1,unlock:"purchase"},{id:2224,name:"Red Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:4,tags:["KotC","Red"]},is_available:!0,unlock:"purchase"},{id:2225,name:"Blue Wins Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:5,tags:["KotC","Blue"]},is_available:!0,unlock:"purchase"},{id:2226,name:"I put the OP in Coop Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:6,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2227,name:"I rule the Roost Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:7,tags:["KotC"]},is_available:!0,unlock:"purchase"},{id:2228,name:"2022 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:12,tags:["2022","Blue"]},is_available:!1,unlock:"purchase"},{id:2229,name:"Nervous Elf Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:14,tags:["Christmas2","Face","Smile"]},is_available:!1,unlock:"purchase"},{id:2230,name:"Pro Plays Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:13,tags:["Drops","White"]},is_available:!1,unlock:"manual"},{id:2231,name:"Ganbaru Okan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:15,y:15,tags:["Drops","Black","Pink"]},is_available:!1,unlock:"manual"},{id:2232,name:"Cold Face Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:0,tags:["Chilly","Ice"]},is_available:!1,unlock:"purchase"},{id:2233,name:"Snowman Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:1,tags:["Chilly","Smile","Face"]},is_available:!1,unlock:"purchase"},{id:2234,name:"Hockey Sticks Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:2,tags:["Chilly","Brown","Canada"]},is_available:!1,unlock:"purchase"},{id:2235,name:"Happy Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:3,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2236,name:"Sad Aww Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:4,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2237,name:"Heart Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:5,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2238,name:"Star Eyes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:6,tags:["Kawaii","Cute","Face","Yellow"]},is_available:!0,unlock:"purchase"},{id:2239,name:"Shocked Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:7,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2240,name:"Ecstatic Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:8,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2241,name:"Pleased Eyes Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:9,tags:["Kawaii","Cute","Face","Smile"]},is_available:!0,unlock:"purchase"},{id:2242,name:"Cat Wink Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:10,tags:["Kawaii","Cute","Face"]},is_available:!0,unlock:"purchase"},{id:2243,name:"Nate's Monies Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:11,tags:["Nate","MayM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2244,name:"Nate's Bomb Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:12,tags:["Nate","Black"]},is_available:!1,unlock:"purchase"},{id:2245,name:"Nate's Eel Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:13,tags:["Nate","Oct23","Black"]},is_available:!1,unlock:"purchase"},{id:2246,name:"Nate's Skypunch Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:14,tags:["Nate","MarM23","Pixel"]},is_available:!1,unlock:"purchase"},{id:2247,name:"Nate's Stonks Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:16,y:15,tags:["Nate","Yellow","Ahh"]},is_available:!1,unlock:"purchase"},{id:2248,name:"Nate's Dead Jason Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:15,tags:["Nate","Black","White"]},is_available:!1,unlock:"purchase"},{id:2249,name:"Nate's Alive Jason Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:14,tags:["Nate","Black","White"]},is_available:!1,unlock:"purchase"},{id:2250,name:"Nate's Noodly Appendages Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:13,tags:["Nate","Smile"]},is_available:!1,unlock:"purchase"},{id:2251,name:"Phoenix BLZ Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:10,tags:["SL","Orange","Yellow"]},is_available:!1,unlock:"manual"},{id:2252,name:"Navi Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:9,tags:["SL","Blue","Red"]},is_available:!1,unlock:"manual"},{id:2253,name:"NCR Clan Logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:8,tags:["SL","Black","Purple"]},is_available:!1,unlock:"manual"},{id:2254,name:"Ukraine Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:7,tags:["UA","Blue","Yellow","Heart"]},is_available:!1,unlock:"purchase"},{id:2255,name:"Nothin' but Net Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:11,tags:["Bros","Basketball"]},is_available:!1,unlock:"purchase"},{id:2256,name:"On Fire Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:12,tags:["Bros","Basketball","Orange"]},is_available:!1,unlock:"purchase"},{id:2257,name:"Diamonds Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:6,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2258,name:"Clubs Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:5,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2259,name:"Spades Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:4,tags:["EGGORG","Black"]},is_available:!1,unlock:"purchase"},{id:2260,name:"Hearts Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:3,tags:["EGGORG","Red"]},is_available:!1,unlock:"purchase"},{id:2261,name:"Egg Org Shield Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:2,tags:["EGGORG","Apr23","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2262,name:"Polarized Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:1,tags:["Relic","White"]},is_available:!0,unlock:"purchase"},{id:2263,name:"Shattered EGG ORG Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:17,y:0,tags:["Relic","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:2264,name:"Wizard Neko Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:15,tags:["Relic","Mar23","AugM23","Dog"]},is_available:!1,unlock:"purchase"},{id:2265,name:"Jason Eyes Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:14,tags:["Relic","Mar23","AugM23"]},is_available:!1,unlock:"purchase"},{id:2266,name:"Wizard Cheer Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:13,tags:["Relic","Mar23","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2267,name:"Egg Love Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:12,tags:["Relic","Mar23","AugM23","Heart"]},is_available:!1,unlock:"purchase"},{id:2268,name:"Going Eggstinct Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:11,tags:["Dino","May23","Black"]},is_available:!1,unlock:"purchase"},{id:2269,name:"No Tar Pits Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:10,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2270,name:"Clutch Up! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:9,tags:["Dino","May23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2271,name:"No Meteors Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:8,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2272,name:"No Volcanos Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:7,tags:["Dino","May23","Red"]},is_available:!1,unlock:"purchase"},{id:2273,name:"RAWR Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:6,tags:["Dino","MarM23","Yellow","Purple"]},is_available:!1,unlock:"purchase"},{id:2274,name:"Baby Dino Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:5,tags:["Dino","May23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:2275,name:"Bluetooth Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:0,tags:["Mobile","JunM23","Smile"]},is_available:!1,unlock:"purchase"},{id:2276,name:"Happy Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:1,tags:["Mobile","Green"]},is_available:!1,unlock:"purchase"},{id:2277,name:"Mad Phone Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:2,tags:["Mobile","Red"]},is_available:!1,unlock:"purchase"},{id:2278,name:"Signal Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:3,tags:["Mobile","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2279,name:"Charging! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:18,y:4,tags:["Mobile","Black"]},is_available:!1,unlock:"purchase"},{id:2280,name:"Eggy-wan Beard Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:0,tags:["Eggwalker2","Face","Brown"]},is_available:!1,unlock:"purchase"},{id:2281,name:"Control Panel Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:1,tags:["Eggwalker2","Red","Black"]},is_available:!1,unlock:"purchase"},{id:2282,name:"Evader face Stamp",price:5e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:2,tags:["Eggwalker2","Red"]},is_available:!1,unlock:"purchase"},{id:2283,name:"Ladybug Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:3,tags:["Summer","JunM23","Red"]},is_available:!1,unlock:"purchase"},{id:2284,name:"Camper Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:4,tags:["Summer","JunM23","Green","Tent"]},is_available:!1,unlock:"purchase"},{id:2285,name:"Oasis Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:5,tags:["Summer","JunM23","Black","Red","Blue","Tree"]},is_available:!1,unlock:"purchase"},{id:2286,name:"Hot Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:6,tags:["Summer","JunM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2287,name:"Sun's out Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:7,tags:["Summer","JunM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2288,name:"Blue's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:8,tags:["Sports","JulyM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2289,name:"Red's #1 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:9,tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:2290,name:"Football Laces Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:10,tags:["Sports","JulyM23","White"]},is_available:!1,unlock:"purchase"},{id:2291,name:"Hockey crossed sticks Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:11,tags:["Sports","JulyM23","Black"]},is_available:!1,unlock:"purchase"},{id:2292,name:"Trophy #1 Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:12,tags:["Sports","JulyM23","Yellow","Gold"]},is_available:!1,unlock:"purchase"},{id:2293,name:"What's the play? Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:13,tags:["Sports","JulyM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2294,name:"Whistle Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:14,tags:["Sports","JulyM23","Red"]},is_available:!1,unlock:"purchase"},{id:2295,name:"Go Team Eggs Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:19,y:15,tags:["Sports","JulyM23"]},is_available:!1,unlock:"purchase"},{id:2296,name:"GOAL Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:0,tags:["Sports","JulyM23"]},is_available:!1,unlock:"purchase"},{id:2297,name:"Cooked Chicken Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:1,tags:["Chicken","Food"]},is_available:!1,unlock:"purchase"},{id:2298,name:"Lil Nugz Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:2,tags:["Chicken"]},is_available:!1,unlock:"purchase"},{id:2299,name:"Toast Face Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:3,tags:["Breakfast","Eggs"]},is_available:!1,unlock:"purchase"},{id:2300,name:"Butter believe it Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:4,tags:["Breakfast","Food","NovM23"]},is_available:!1,unlock:"purchase"},{id:2301,name:"Sour Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:5,tags:["Breakfast","July23"]},is_available:!1,unlock:"purchase"},{id:2302,name:"Pancakes Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:6,tags:["Breakfast","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2303,name:"Hard Boiled Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:7,tags:["Breakfast","Eggs"]},is_available:!1,unlock:"purchase"},{id:2304,name:"Coffee makes me happy! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:8,tags:["Breakfast","Smile"]},is_available:!1,unlock:"purchase"},{id:2305,name:"Bacon Bacon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:9,tags:["Breakfast","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2306,name:"Scavenger Statue Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:10,tags:["Scavenger","Blue","Wizard"]},is_available:!1,unlock:"purchase"},{id:2307,name:"Scavenger Map Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:11,tags:["Scavenger","Wizard"]},is_available:!1,unlock:"purchase"},{id:2308,name:"Scavenger Magnifeye Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:12,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2309,name:"Scavenger Compass Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:13,tags:["Scavenger","Blue"]},is_available:!1,unlock:"purchase"},{id:2310,name:"Scavenger Monocle Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:14,tags:["Scavenger","Yellow"]},is_available:!1,unlock:"purchase"},{id:2311,name:"Paint Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:20,y:15,tags:["Pencil2","Sep23","Rainbow"]},is_available:!1,unlock:"purchase"},{id:2312,name:"Science Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:0,tags:["Pencil2","Sep23","Blue","Purple","Red"]},is_available:!1,unlock:"purchase"},{id:2313,name:"Schoolbus Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:1,tags:["Pencil2","Sep23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2314,name:"Math Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:2,tags:["Pencil2","Sep23","Black"]},is_available:!1,unlock:"purchase"},{id:2315,name:"Sharkbucks Stamp",price:6900,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:3,tags:["Sep22","Green","Face"]},is_available:!0,unlock:"purchase"},{id:2316,name:"Kilzomatic Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:4,tags:["Sep22","Drops3","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2317,name:"Diablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:5,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2318,name:"Pablo Sticker Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:6,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2319,name:"The Jaw Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:8,tags:["Sep22","Drops3","Face","Black"]},is_available:!1,unlock:"manual"},{id:2320,name:"Pablo GG Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:7,tags:["Sep22","Mar23","AugM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2321,name:"Trick Or Treat Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:9,tags:["Halloween3","OctM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2322,name:"Scary Clown Face Stamp",price:1990,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:10,tags:["Halloween3","OctM23","It"]},is_available:!1,unlock:"purchase"},{id:2323,name:"KJDCitsme Jacko Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:14,tags:["Halloween3","OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2324,name:"KJDCitsme Shock Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:11,tags:["Halloween3","OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2325,name:"Thee_Owl Breakout Yolk Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:13,tags:["Halloween3","OctM23","Yellow","Face"]},is_available:!1,unlock:"purchase"},{id:2326,name:"Thee_Owl Peekout Yolk Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:9,tags:["Halloween3","OctM23","Yellow","Face"]},is_available:!1,unlock:"purchase"},{id:2327,name:"Waldoh Scratch Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:12,tags:["Halloween3","OctM23","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2328,name:"Artshocks Half Asleep Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:10,tags:["Halloween3","OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2329,name:"Scared Stupid Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:8,tags:["Halloween3","OctM23","Face","Black"]},is_available:!1,unlock:"purchase"},{id:2330,name:"One Cluck Man Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:7,tags:["Halloween3","OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2331,name:"Skullface Kills Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:6,tags:["Halloween3","OctM23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2332,name:"Witches Broom Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:15,tags:["Halloween3","OctM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2333,name:"Fall Leaf Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:11,tags:["NovM23","Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2334,name:"Turkey head on Stamp",price:400,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:12,tags:["NovM23","Thanksgiving","Brown"]},is_available:!1,unlock:"purchase"},{id:2335,name:"Forest Shroom Stamp",price:600,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:13,tags:["NovM23","Thanksgiving2","Red","Food"]},is_available:!1,unlock:"purchase"},{id:2336,name:"Apple Core Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:14,tags:["NovM23","Thanksgiving2","Food"]},is_available:!1,unlock:"purchase"},{id:2337,name:"Drumstick Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:21,y:15,tags:["NovM23","Thanksgiving2","Brown","Food"]},is_available:!1,unlock:"purchase"},{id:2338,name:"It's Corn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:4,tags:["NovM23","Thanksgiving2","Yellow","Green","Food"]},is_available:!1,unlock:"purchase"},{id:2339,name:"Corntastic Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:5,tags:["NovM23","Thanksgiving","Yellow","Orange"]},is_available:!1,unlock:"purchase"},{id:2340,name:"You won a 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:3,tags:["Badegg","Purple","Blue","Eggs"]},is_available:!1,unlock:"manual"},{id:2341,name:"Wizard Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2342,name:"Reload the clip Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2343,name:"Regeneration Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:22,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2344,name:"Upgrade Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:0,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2345,name:"Health Drop Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:1,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2346,name:"Sleeps Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:2,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2347,name:"Marksman Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:3,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2348,name:"Restocked Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:4,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2349,name:"Rambod Face Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:5,tags:["Badegg","Black","DecM23","premFeatOne"]},is_available:!1,unlock:"purchase"},{id:2350,name:"Surprise! Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:6,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2351,name:"Goose Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:7,tags:["Badegg","Black"]},is_available:!1,unlock:"purchase"},{id:2352,name:"New year 2023 Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:8,tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2353,name:"Mixtape Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:9,tags:["Rockstar","JanM23","Grey","Gray","Music"]},is_available:!1,unlock:"purchase"},{id:2354,name:"Treble clef Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:10,tags:["Rockstar","JanM23","Black","Music"]},is_available:!1,unlock:"purchase"},{id:2355,name:"Rock on Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:11,tags:["Rockstar","JanM23","Yellow","Music"]},is_available:!1,unlock:"purchase"},{id:2356,name:"Buck Teeth",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:13,tags:["Groundhog","Feb23","Face"]},is_available:!1,unlock:"purchase"},{id:2357,name:"Alarm Clock Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:12,tags:["Groundhog","Newsletter","Feb23","White","Silver"]},is_available:!1,unlock:"manual"},{id:2358,name:"Horseshoe Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:15,tags:["farm","FebM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2359,name:"Sunflower Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:23,y:14,tags:["farm","FebM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2360,name:"CEO Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:0,tags:["League","Red"]},is_available:!1,unlock:"manual"},{id:2361,name:"LEV Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:1,tags:["League","Green"]},is_available:!1,unlock:"manual"},{id:2362,name:"RTV Clan Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:2,tags:["League","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2363,name:"Shell Tournaments Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:3,tags:["League","Orange"]},is_available:!0,unlock:"purchase"},{id:2364,name:"NPS Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:4,tags:["League","White"]},is_available:!1,unlock:"manual"},{id:2365,name:"Shell Tournaments #1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:5,tags:["League","Blue"]},is_available:!1,unlock:"manual"},{id:2366,name:"Hello my name is Pablo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:6,tags:["Drops4","Mar23","AugM23","Red"]},is_available:!1,unlock:"purchase"},{id:2367,name:"Happily Fried Stamp",price:300,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:7,tags:["Drops4","Mar23","AugM23","White","Eggs"]},is_available:!1,unlock:"purchase"},{id:2368,name:"Game Of The Year Stamp",price:350,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:8,tags:["Drops4","Mar23","Yellow","GOTY"]},is_available:!1,unlock:"purchase"},{id:2369,name:"Wizards on Fire! Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:9,tags:["Drops4","Mar23","Blue","BWD"]},is_available:!1,unlock:"purchase"},{id:2370,name:"Banned Aid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:10,tags:["Drops4","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:2371,name:"xQc Ape Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:11,tags:["Drops4","Mar23","White"]},is_available:!1,unlock:"manual"},{id:2372,name:"Shell Shockers Logo Stamp",price:50,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:12,tags:["Drops4","Mar23","Eggs","White"]},is_available:!1,unlock:"purchase"},{id:2373,name:"Griffen Chin Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:13,tags:["Drops4","Mar23","Face","Black"]},is_available:!1,unlock:"manual"},{id:2374,name:"That's a Fowl Stamp",price:150,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:14,tags:["Bros","MarM23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2375,name:"Stuffed Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:24,y:15,tags:["Bros","MarM23"]},is_available:!1,unlock:"purchase"},{id:2376,name:"Bear Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:0,tags:["Bros","MarM23","Brown"]},is_available:!1,unlock:"purchase"},{id:2377,name:"Tiger Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:1,tags:["Bros","MarM23","Tiger","Cat"]},is_available:!1,unlock:"purchase"},{id:2378,name:"Basket Bros Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:2,tags:["Bros","MarM23","Orange"]},is_available:!1,unlock:"purchase"},{id:2379,name:"Hydrate! Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:3,tags:["Bros","MarM23","Blue"]},is_available:!1,unlock:"purchase"},{id:2380,name:"Egg Jordan Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:4,tags:["Bros","MarM23","Black","Eggs"]},is_available:!1,unlock:"purchase"},{id:2381,name:"Kiss me I'm Irish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:5,tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:2382,name:"Monster Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:6,tags:["Monsters","Apr23"]},is_available:!1,unlock:"purchase"},{id:2383,name:"Hero Talisman Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:7,tags:["Heroes","Apr23"]},is_available:!1,unlock:"purchase"},{id:2384,name:"Judgement arrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:8,tags:["Apr23","Gold","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:2385,name:"Critical Hit Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:9,tags:["Apr23","Red","Gold","D20","Yellow"]},is_available:!1,unlock:"purchase"},{id:2386,name:"Breath Weapon Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:10,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2387,name:"Egg Org & Eggventure Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:11,tags:["Apr23","Red","Gold","Dragon"]},is_available:!1,unlock:"purchase"},{id:2388,name:"Heroes Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:12,tags:["Heroes","Apr23","Green","Heart"]},is_available:!1,unlock:"manual"},{id:2389,name:"Monsters Potion Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:13,tags:["Apr23","Monsters","Red","Skull"]},is_available:!1,unlock:"manual"},{id:2390,name:"Monobrow Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:14,tags:["May23","Dino2","Black","Face"]},is_available:!1,unlock:"purchase"},{id:2391,name:"Slay the Beast Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:25,y:15,tags:["May23","Dino2","Black"]},is_available:!1,unlock:"purchase"},{id:2392,name:"Caveman Classic Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:0,tags:["May23","Dino2","Face","Smile"]},is_available:!1,unlock:"purchase"},{id:2393,name:"Stone Tools Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:1,tags:["May23","Dino2","Brown"]},is_available:!1,unlock:"purchase"},{id:2394,name:"Chart Stamp",price:10,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:3,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2395,name:"Money Tree Stamp",price:100,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:4,tags:["MayM23","Eggflation","Green"]},is_available:!0,unlock:"purchase"},{id:2396,name:"Eggflation Rollercoaster Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:2,tags:["MayM23","Eggflation","Red"]},is_available:!0,unlock:"purchase"},{id:2397,name:"HODL Stamp",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:5,tags:["MayM23","Eggflation"]},is_available:!0,unlock:"purchase"},{id:2398,name:"Polaroid Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:6,tags:["Jun23","Photo","Eggs"]},is_available:!1,unlock:"purchase"},{id:2399,name:"Wedding Crasher Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:7,tags:["Jun23","Photo","Blue"]},is_available:!1,unlock:"purchase"},{id:2400,name:"Apature Stamp",price:825,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:8,tags:["Jun23","Photo","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2401,name:"Dour Mustache Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:9,tags:["Jun23","Photo","Brown"]},is_available:!1,unlock:"purchase"},{id:2402,name:"Starfish Stamp",price:505,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:10,tags:["JunM23","Summer2","Red"]},is_available:!1,unlock:"purchase"},{id:2403,name:"Jellyfish Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:11,tags:["JunM23","Summer2","White"]},is_available:!1,unlock:"purchase"},{id:2404,name:"Beach Vibes Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:12,tags:["JunM23","Summer2"]},is_available:!1,unlock:"purchase"},{id:2405,name:"Beach Ball Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:13,tags:["JunM23","Summer2","White","Blue","Yellow","Red"]},is_available:!1,unlock:"purchase"},{id:2406,name:"Equinox Sun Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:0,tags:["July23","Equinox","Yellow"]},is_available:!1,unlock:"purchase"},{id:2407,name:"Equinox Moon Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:1,tags:["July23","Equinox","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2408,name:"Equinox YinYang Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:14,tags:["July23","Equinox","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2409,name:"Pablodala Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:26,y:15,tags:["July23","Equinox","Mandala","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2410,name:"Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:2,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2411,name:"Grind Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:4,tags:["JulyM23","Sports2","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:2412,name:"Fellow Kids Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:3,tags:["JulyM23","Sports2","Red","Skateboard"]},is_available:!1,unlock:"purchase"},{id:2413,name:"Safety Team Approved Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:5,tags:["JulyM23","Sports2"]},is_available:!1,unlock:"purchase"},{id:2414,name:"The MenoXD Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:6,tags:["JulyM23","Red","xd"]},is_available:!0,unlock:"purchase"},{id:2415,name:"Red S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:7,tags:["Aug23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2416,name:"Green S-tier Racing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:8,tags:["Aug23","Eggs"]},is_available:!1,unlock:"purchase"},{id:2417,name:"Question block Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:9,tags:["Aug23","Yellow","?","JanM24","premFeatTwo"]},is_available:!0,unlock:"purchase"},{id:2418,name:"Racing Flags Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:10,tags:["Aug23","Black","White"]},is_available:!1,unlock:"purchase"},{id:2419,name:"Stopwatch Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:11,tags:["Newsletter","Aug23","White","Clock"]},is_available:!1,unlock:"manual"},{id:2420,name:"Shy Egg Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:12,tags:["Aug23","White"]},is_available:!1,unlock:"purchase"},{id:2421,name:"Banana Peel Stamp",price:1200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:13,tags:["Aug23","Yellow"]},is_available:!1,unlock:"purchase"},{id:2422,name:"Respawn Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:14,tags:["Aug23","Mushroom","Green","1up"]},is_available:!1,unlock:"purchase"},{id:2423,name:"Om Nom Stamp",price:200,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:27,y:15,tags:["AugM23","Drops5","Yellow"]},is_available:!1,unlock:"purchase"},{id:2424,name:"Harrison Cat Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:0,tags:["AugM23","Drops5","Thumb","Black"]},is_available:!1,unlock:"purchase"},{id:2425,name:"Flushed Face Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:1,tags:["AugM23","Drops5"]},is_available:!1,unlock:"purchase"},{id:2426,name:"Albino Snake Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:2,tags:["AugM23","Drops5","Grey","Gray","ABHS"]},is_available:!1,unlock:"manual"},{id:2427,name:"Shell Wiki Stamp",price:3210,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:3,tags:["AugM23","Drops5","Egg","White"]},is_available:!0,unlock:"purchase"},{id:2428,name:"Wiz Ears Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:4,tags:["AugM23","Drops5","Blue","BWD"]},is_available:!1,unlock:"purchase"},{id:2429,name:"r/place Pablo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:5,tags:["AugM23","Drops5","Yellow","Orange","Smile"]},is_available:!1,unlock:"manual"},{id:2430,name:"r/place BWD skull Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:6,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2431,name:"r/place BWD logo Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:7,tags:["AugM23","Drops5","Blue"]},is_available:!1,unlock:"manual"},{id:2432,name:"Solve for X Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:8,tags:["Sep23","Pencil3","Orange"]},is_available:!1,unlock:"purchase"},{id:2433,name:"Anarchy Academy",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:9,tags:["Sep23","Pencil3","Red"]},is_available:!1,unlock:"purchase"},{id:2434,name:"Egg-lectrons Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:10,tags:["Sep23","Pencil3","Science","Black"]},is_available:!1,unlock:"purchase"},{id:2435,name:"Blue Wizard Wrestling Federation Logo",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:12,tags:["SepM23","WBs","Wrestle","BWD","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:2436,name:"Bron Lester Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:13,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2437,name:"Jan Seeya Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:14,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2438,name:"Rocky Star Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:15,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2439,name:"Brogan Paw Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:0,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2440,name:"Romeo Rain Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:1,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2441,name:"Nacho Mann Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:2,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2442,name:"Death Brawlin Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:3,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2443,name:"Bulk Logan Stamp",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:4,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2444,name:"Ray Mystery Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:5,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2445,name:"Binky Flinch Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:6,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2446,name:"Bonka Beware Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:7,tags:["SepM23","WBs","Wrestle"]},is_available:!1,unlock:"purchase"},{id:2447,name:"Wrestlebros 1v1 Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:28,y:11,tags:["SepM23","WBs","Blue","Purple"]},is_available:!1,unlock:"manual"},{id:2448,name:"Rotting Zombie Fish Stamp",price:1750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:8,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2449,name:"Shark Chomp Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:9,tags:["Oct23","Halloween4","Blue"]},is_available:!1,unlock:"purchase"},{id:2450,name:"Squiddy Friend Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:10,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2451,name:"Venomous Sea Snake Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:11,tags:["Oct23","Halloween4","Green"]},is_available:!1,unlock:"purchase"},{id:2452,name:"Bait Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:12,tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:2453,name:"Wilson. Wilson... WILSON!",price:1500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:13,tags:["Oct23","Halloween4","Red"]},is_available:!1,unlock:"purchase"},{id:2454,name:"Demonic Face Stamp",price:2147483647,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:14,tags:["Oct23","Face"]},is_available:!1,unlock:"manual"},{id:2455,name:"Boo Crew Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:29,y:15,tags:["OctM23","Text","Purple"]},is_available:!1,unlock:"purchase"},{id:2456,name:"Cool Maid Face",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:0,tags:["OctM23","Face"]},is_available:!1,unlock:"purchase"},{id:2457,name:"Ghoul Power Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:1,tags:["OctM23","Text","Pink"]},is_available:!1,unlock:"purchase"},{id:2458,name:"Ghost Malone",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:2,tags:["OctM23","Meme","White"]},is_available:!1,unlock:"purchase"},{id:2459,name:"Seen too much Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:3,tags:["OctM23","Purple"]},is_available:!1,unlock:"purchase"},{id:2460,name:"Pumpkin Wizard Digital",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:4,tags:["OctM23","Orange","BWD","Infinite Smasher"]},is_available:!1,unlock:"purchase"},{id:2461,name:"Get Ghosted Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:5,tags:["OctM23","Black","Ghost","Text"]},is_available:!1,unlock:"purchase"},{id:2462,name:"Sacred Sun Stamp",price:1250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:6,tags:["Nov23","Mayan","Calendar","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:2463,name:"Sea to Sun Totem Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:7,tags:["Nov23","Mayan","Red","Orange","Blue","Eye"]},is_available:!1,unlock:"purchase"},{id:2464,name:"Ancient Skull Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:8,tags:["Nov23","Mayan","Bone","Yellow"]},is_available:!1,unlock:"purchase"},{id:2465,name:"Snake Deity Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:9,tags:["Nov23","Mayan","Green","Snek"]},is_available:!1,unlock:"purchase"},{id:2466,name:"Raven Lord Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:10,tags:["Nov23","Mayan","Black","Nevermore"]},is_available:!1,unlock:"purchase"},{id:2467,name:"Tepey\xF3llotl Stamp",price:5e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:11,tags:["Nov23","Mayan","Leopard","Orange"]},is_available:!1,unlock:"purchase"},{id:2468,name:"Give Thanksing Stamp",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:12,tags:["NovM23","Text","Thanksgiving3","Orange","Red"]},is_available:!1,unlock:"purchase"},{id:2469,name:"Football Turkey Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:13,tags:["NovM23","Thanksgiving3","Brown","Basted"]},is_available:!1,unlock:"purchase"},{id:2470,name:"Basted Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:14,tags:["NovM23","Thanksgiving3","Yellow","Text"]},is_available:!1,unlock:"purchase"},{id:2471,name:"Feast Mode Stamp",price:2e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:30,y:15,tags:["NovM23","Thanksgiving3","Red","Text"]},is_available:!1,unlock:"purchase"},{id:2472,name:"HoHoHo Stamp",price:250,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:3,tags:["Dec23","Christmas3","Red","Green","Text"]},is_available:!1,unlock:"purchase"},{id:2473,name:"Nice Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:1,tags:["Dec23","Christmas3","Red","Green","Text"]},is_available:!1,unlock:"purchase"},{id:2474,name:"Naughty Egg Stamp",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:0,tags:["Dec23","Christmas3","Pink","Purple","Text"]},is_available:!1,unlock:"purchase"},{id:2475,name:"Big Baubles Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:2,tags:["Dec23","Christmas3","Red","Green"]},is_available:!1,unlock:"purchase"},{id:2476,name:"2024 Stamp",price:1e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:6,tags:["NewYears","DecM23","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:2477,name:"Out with the Old",price:500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:4,tags:["NewYears","DecM23","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:2478,name:"In with the New",price:750,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:5,tags:["NewYears","DecM23","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:2479,name:"Yolk Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:8,tags:["JanM24","Text","Racer","Grey","Gray","Yellow"]},is_available:!0,unlock:"purchase"},{id:2480,name:"Crown Stamp",price:25e3,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:9,tags:["JanM24","Winner","Racer","Gold","Yellow"]},is_available:!0,unlock:"purchase"},{id:2481,name:"Stop Healing Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:10,tags:["JanM24","Winner","Racer"]},is_available:!0,unlock:"purchase"},{id:2482,name:"Chinese Egg Stamp",price:2500,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:11,tags:["JanM24","Purple","Yellow","Text","Racer"]},is_available:!0,unlock:"purchase"},{id:2483,name:"Pireggi Logo",price:1e4,item_type_id:2,item_type_name:"Stamp",category_name:"Stamps",exclusive_for_class:null,item_data:{x:31,y:7,tags:["JanM24","Text","Black","Pireggi"]},is_available:!0,unlock:"purchase"},{id:3100,name:"The Eggk-47",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47",tags:["default","Blue","Purple"]},is_available:!0,unlock:"default"},{id:3101,name:"GOLD Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3102,name:"Happy Bear Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3103,name:"Halloween Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:3104,name:"Thanksgiving Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3105,name:"Christmas Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3106,name:"New Year 2019 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3107,name:"Groundhog Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3108,name:"Buck Rogers Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3109,name:"Valentines Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3110,name:"St Patricks Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3111,name:"Easter Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Easter",tags:["Easter","Red","Eggs"]},is_available:!1,unlock:"purchase"},{id:3112,name:"Flame Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3113,name:"Rainbow Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3114,name:"Steampunk Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3115,name:"Memphis Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3116,name:"Eggwalker Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3117,name:"Nuke Zone Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NukeZone",tags:["NukeZone","Black","Neon","Pink"]},is_available:!0,unlock:"purchase"},{id:3118,name:"New Year 2020 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3119,name:"Country Singer Eggk-47",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3120,name:"Albino Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3121,name:"Raid Land Eggk-47",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaidLand",tags:["RaidLand","Blue","Black"]},is_available:!1,unlock:"purchase"},{id:3122,name:"Toxic Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3123,name:"Music Eggk-47",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Music",tags:["Rockstar","JanM23","Black"]},is_available:!1,unlock:"purchase"},{id:3124,name:"Galeggsy Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3125,name:"Chicken Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3126,name:"Techno Eggk-47",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Techno",tags:["Dec23","Blue","Yellow","Black","Pog"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_eggk47_techno"]},{id:3127,name:"New Year 2021 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3128,name:"Car Eggk-47",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_car",tags:["Cars","Trains","Blue"]},is_available:!0,unlock:"purchase"},{id:3129,name:"Merc Zone Eggk-47",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Merc",tags:["Merc","Suit","Black","Tie","Blue"]},is_available:!0,unlock:"purchase"},{id:3130,name:"Summer Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3131,name:"Pencil Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Pencil",tags:["Pencil","Sep23","Yellow"]},is_available:!1,unlock:"purchase"},{id:3132,name:"New Year 2022 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3133,name:"Cards Eggk-47",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3134,name:"Retro Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Retro",tags:["Retro","Pixel","FebM23","Blue","Purple","Wings","DecM23","premFeatOne"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_retro"]},{id:3135,name:"Dino Eggk-47",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Dino",tags:["Dino","May23","Red","Brown"]},is_available:!1,unlock:"purchase"},{id:3136,name:"Valkyrie Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_ak_valkyrie"]},{id:3137,name:"Eggwalker Alt Eggk-47",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3138,name:"SPORTS Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Sports",tags:["Sports","JulyM23","Brown","Orange","Cricket","Bat"]},is_available:!1,unlock:"purchase"},{id:3139,name:"Breakfast Eggk-47",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Breakfast",tags:["Breakfast","Food","Brown","Syrup","Waffles"]},is_available:!1,unlock:"purchase"},{id:3140,name:"New Year 2023 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3141,name:"Farm Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Farm",tags:["Farm","FebM23","Food","Orange","Green","Carrot"]},is_available:!1,unlock:"purchase"},{id:3142,name:"Fusion Eggk-47",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fusion",tags:["Premium","fusion","FebM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak47_fusion"]},{id:3143,name:"Hero Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Fantasy",tags:["Heroes","Apr23","Sword","Silver"]},is_available:!1,unlock:"purchase"},{id:3144,name:"Monster Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_FantasyEvil",tags:["Monsters","Apr23","Purple","Sword"]},is_available:!1,unlock:"purchase"},{id:3145,name:"Equinox Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3146,name:"Paintball Eggk-47",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Paintball",tags:["Sports2","JulyM23","Grey","Gray","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:3147,name:"Kart Eggk-47",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3148,name:"BWD Eggk-47",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Wizard",tags:["Drops5","AugM23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3149,name:"Infernal Eggk-47",price:4,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Infernal",tags:["OctM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_ak_infernal"]},{id:3150,name:"Ancient Eggk-47",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3151,name:"Holideggs Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3152,name:"2024 Eggk-47",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:3153,name:"Racer Eggk-47",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Soldier Primary Weapons",exclusive_for_class:0,item_data:{meshName:"gun_eggk47_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3400,name:"The Free Ranger",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1",tags:["default","Orange","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3401,name:"GOLD Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3402,name:"Happy Bear Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3403,name:"Halloween Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:3404,name:"Thanksgiving Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3405,name:"Christmas Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3406,name:"New Year 2019 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3407,name:"Groundhog Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3408,name:"Buck Rogers Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3409,name:"Valentines Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3410,name:"St Patricks Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3411,name:"Easter Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Easter",tags:["Easter","Blue","Eggs"]},is_available:!1,unlock:"purchase"},{id:3412,name:"Flame Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3413,name:"Rainbow Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3414,name:"Steampunk Free Ranger",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3415,name:"Memphis Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Memphis",tags:["Memphis","Blue","Orange","Purple"]},is_available:!0,unlock:"purchase"},{id:3416,name:"Eggwalker Free Ranger",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEgg",tags:["sale","Eggwalker","July23","Black","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_csg1_space"]},{id:3417,name:"Nuke Zone Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:3418,name:"New Year 2020 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3419,name:"Country Singer Free Ranger",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3420,name:"Albino Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3421,name:"Raid Land Free Ranger",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaidLand",tags:["RaidLand","Blue","Yellow","Brown","Wings"]},is_available:!1,unlock:"purchase"},{id:3422,name:"Toxic Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3423,name:"Music Free Ranger",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Music",tags:["Rockstar","JanM23","Black","Guitar"]},is_available:!1,unlock:"purchase"},{id:3424,name:"Galeggsy Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3425,name:"Chicken Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3426,name:"Techno Free Ranger",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Techno",tags:["Premium","Techno","Cats","Catz","Purple","Yellow","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_csg1_techno"]},{id:3427,name:"New Year 2021 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3428,name:"Car Free Ranger",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_car",tags:["Cars","Trains","Red","Firetruck"]},is_available:!0,unlock:"purchase"},{id:3429,name:"Merc Zone Free Ranger",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Merc",tags:["Merc","Suit","Black","Tie","Yellow"]},is_available:!0,unlock:"purchase"},{id:3430,name:"Summer Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3431,name:"Retro Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Retro",tags:["Retro","Premium","Pixel","Green","Wings","premFeatTwo","JanM24"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_csg1_retro"]},{id:3432,name:"Pencil Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Pencil",tags:["Pencil","Sep23","Yellow","Paintbrush"]},is_available:!1,unlock:"purchase"},{id:3433,name:"New Year 2022 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3434,name:"BWD Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Wizard",tags:["Drops","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3435,name:"Cards Free Ranger",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3436,name:"Dino Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Dino",tags:["Dino","May23","Green","Orange"]},is_available:!1,unlock:"purchase"},{id:3437,name:"Eggpire Free Ranger",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3438,name:"SPORTS Free Ranger",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Sports",tags:["Sports","JulyM23","Brown","White","Baseball"]},is_available:!1,unlock:"purchase"},{id:3439,name:"Rubber Chicken Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RubberChicken",tags:["Aug23","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_csg1_rubchick"]},{id:3440,name:"Breakfast Free Ranger",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Breakfast",tags:["Breakfast","Food","Toast","Brown","Eggs","Bread"]},is_available:!1,unlock:"purchase"},{id:3441,name:"Valkyrie Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Valkyrie",tags:["Valkyrie","Premium","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_range_valk"]},{id:3442,name:"New Year 2023 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3443,name:"Fusion Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Fusion",tags:["Premium","JanM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_fusion"]},{id:3444,name:"Farm Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Farm",tags:["Farm","FebM23","Food","Yellow","Green","Corn"]},is_available:!1,unlock:"purchase"},{id:3445,name:"Shellpreme Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Shellpreme",tags:["MayM23","Eggflation","Premium","Red"]},is_available:!0,unlock:"premium",activeProduct:!1,sku:["item_csg1_shellpreme"]},{id:3446,name:"Equinox Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3447,name:"Kart Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3448,name:"lifeofnurse Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Nurse",tags:["AugM23","Drops5","Blue","Purple","Heart"]},is_available:!1,unlock:"manual"},{id:3449,name:"Bone Free Ranger",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Bones",tags:["OctM23","Halloween4","Bone","White"]},is_available:!1,unlock:"purchase"},{id:3450,name:"Ancient Free Ranger",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3451,name:"Holideggs Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3452,name:"2024 Free Ranger",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!0,unlock:"purchase"},{id:3453,name:"Sleigh Free Ranger",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Christmas",tags:["DecM23","Gold","Green","Red"]},is_available:!1,unlock:"manual"},{id:3454,name:"Racer Free Ranger",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3455,name:"Infernal Free Ranger",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Ranger Primary Weapons",exclusive_for_class:2,item_data:{meshName:"gun_csg1_Infernal",tags:["JanM24","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_csg1_infernal"]},{id:3600,name:"The Scrambler",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge",tags:["default","Orange","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3601,name:"GOLD Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3602,name:"Happy Bear Scrambler ",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3603,name:"Halloween Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:3604,name:"Thanksgiving Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3605,name:"Christmas Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3606,name:"New Year 2019 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3607,name:"Groundhog Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3608,name:"Buck Rogers Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3609,name:"Valentines Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3610,name:"St Patricks Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3611,name:"Easter Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Easter",tags:["Easter","Yellow","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:3612,name:"Flame Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3613,name:"Rainbow Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3614,name:"Steampunk Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3615,name:"Memphis Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Memphis",tags:["Memphis","Yellow","Green","Black","White"]},is_available:!0,unlock:"purchase"},{id:3616,name:"Eggwalker Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3617,name:"Nuke Zone Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NukeZone",tags:["NukeZone","Black","Blue","Neon"]},is_available:!0,unlock:"purchase"},{id:3618,name:"New Year 2020 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3619,name:"Country Singer Scrambler",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3620,name:"Albino Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3621,name:"Raid Land Scrambler",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaidLand",tags:["RaidLand","Brown","White"]},is_available:!1,unlock:"purchase"},{id:3622,name:"Toxic Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3623,name:"Music Scrambler",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Music",tags:["Rockstar","JanM23","Red","Gold","Guitar"]},is_available:!1,unlock:"purchase"},{id:3624,name:"Galeggsy Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3625,name:"Killstreak Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Killstreak",tags:["Killstreak","Smile","Yellow","Brown","Blue"]},is_available:!1,unlock:"manual"},{id:3626,name:"Chicken Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3627,name:"Techno Scrambler",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Techno",tags:["Techno","premium","SepM23","Badoosh","Red","Purple","Black"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["gun_gauge_techno"]},{id:3628,name:"New Year 2021 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3629,name:"Car Scrambler",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_car",tags:["Cars","Trains","Yellow"]},is_available:!0,unlock:"purchase"},{id:3630,name:"Merc Zone Scrambler",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Merc",tags:["Merc","Suit","Black","Tie","Orange"]},is_available:!0,unlock:"purchase"},{id:3631,name:"Summer Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3632,name:"Pencil Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Pencil",tags:["Pencil","Sep23","Highlighter"]},is_available:!1,unlock:"purchase"},{id:3633,name:"BWD Fan-art Scrambler",price:15e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_BWD",tags:["Kids","Wizard","Blue","Rainbow"]},is_available:!0,unlock:"purchase"},{id:3634,name:"Retro Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Retro",tags:["Retro","Premium","Pixel","Grey","Gray","Orange","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_crack_retro"]},{id:3635,name:"New Year 2022 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3636,name:"Thee_Owl Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_TheeOwl",tags:["Relic","Drops2","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3637,name:"Basket Bros Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Basketball",tags:["Bros","JulyM23","Orange","Hoops"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_bros"]},{id:3638,name:"Cards Scrambler",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3639,name:"JWBerry3D Scrambler",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_JWBerry",tags:["Relic","Black","Red","Glasses"]},is_available:!0,unlock:"purchase"},{id:3640,name:"Dino Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Dino",tags:["Dino","May23","Blue"]},is_available:!1,unlock:"purchase"},{id:3641,name:"Eggpire Scrambler",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3642,name:"Valkyrie Scrambler",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Valkyrie",tags:["Eggwalker2","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_valk"]},{id:3643,name:"SPORTS Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sports",tags:["Sports","JulyM23","Black","White","Green","Soccer","Football"]},is_available:!1,unlock:"purchase"},{id:3644,name:"Breakfast Scrambler",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Breakfast",tags:["Breakfast","Food","Red","Ketchup"]},is_available:!1,unlock:"purchase"},{id:3645,name:"Sharkbucks Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Sharkbucks",tags:["Sep22","Drops3","Blue","Smile"]},is_available:!1,unlock:"manual"},{id:3646,name:"Kilzomatic Scrambler",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kilzomatic",tags:["Sep22","Blue","Yellow"]},is_available:!0,unlock:"purchase"},{id:3647,name:"Badegg Scrambler",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Badegg",tags:["Badegg","Red","Yellow","DecM23","premFeatOne"]},is_available:!1,unlock:"purchase"},{id:3648,name:"New Year 2023 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3649,name:"Sleigh Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Christmas",tags:["Christmas2","Newsletter","Red","White","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3650,name:"Octopus Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Octopus",tags:["JanM23","Oct23","Blue","Pink"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gauge_octopus"]},{id:3651,name:"Farm Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Farm",tags:["Farm","FebM23","Food","Yellow","Gold","Wheat"]},is_available:!1,unlock:"purchase"},{id:3652,name:"BWD Scrambler",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Wizard",tags:["Drops4","Mar23","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3653,name:"Green Snake Scrambler",price:15e4,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_SnakePatrick",tags:["Mar23","StPatricksDay","Snek"]},is_available:!1,unlock:"purchase"},{id:3654,name:"Beholder Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fantasy",tags:["Monsters","Apr23","Purple","Yellow","Eyes"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gauge_monster"]},{id:3655,name:"Fusion Scrambler",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Fusion",tags:["Premium","MidM23","Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gauge_fusion"]},{id:3656,name:"Equinox Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3657,name:"Kart Scrambler",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Kart",tags:["Aug23","Kart","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3658,name:"Ancient Scrambler",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3659,name:"Holideggs Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3660,name:"2024 Scrambler",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_NewYear2024",tags:["DecM23","2024","NewYears","White","Blue"]},is_available:!0,unlock:"purchase"},{id:3661,name:"Racer Scrambler",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Scrambler Primary Weapons",exclusive_for_class:1,item_data:{meshName:"gun_dozenGauge_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3e3,name:"The Cluck 9mm",price:0,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm",tags:["Red","Grey","Gray","Silver"]},is_available:!0,unlock:"default"},{id:3001,name:"GOLD Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3002,name:"Happy Bear Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3003,name:"Halloween Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:3004,name:"Thanksgiving Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3005,name:"Christmas Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3006,name:"New Years 2019 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3007,name:"Groundhog Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3008,name:"Buck Rogers Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Buck",tags:["Promotional","Gray","Grey","Silver"]},is_available:!1,unlock:"manual"},{id:3009,name:"Valentines Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3010,name:"St Patricks Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3011,name:"Easter Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Easter",tags:["Easter","Pink","Blue","Eggs"]},is_available:!1,unlock:"purchase"},{id:3012,name:"Flame Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3013,name:"Rainbow Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3014,name:"Steampunk Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3015,name:"Memphis Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:3016,name:"Eggwalker Cluck 9mm",price:4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_space"]},{id:3017,name:"Nuke Zone Skin Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NukeZone",tags:["NukeZone","Yellow","Black","Neon"]},is_available:!1,unlock:"manual"},{id:3018,name:"New Years 2020 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3019,name:"Country Singer Cluck 9mm",price:1e5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3020,name:"Albino Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_SnakeAlbino",tags:["EggyCashAlbino","Snek","White","Gray","Grey","Red","ABHS"]},is_available:!1,unlock:"manual"},{id:3021,name:"Raid Land Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaidLand",tags:["RaidLand","Newsletter","Rabbit","Wabbit","Heart","Green","Brown"]},is_available:!1,unlock:"manual"},{id:3022,name:"Toxic Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3023,name:"Music Cluck 9mm",price:8e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Music",tags:["Rockstar","JanM23","Grey","Gray","Harmonica"]},is_available:!1,unlock:"purchase"},{id:3024,name:"Galeggsy Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3025,name:"Techno Cluck 9mm",price:10,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Techno",tags:["AprM23","Red","Orange","Yellow","Pop","Black"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_9mm_techno"]},{id:3026,name:"Cubic Castles Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_CubicCastles",tags:["CubicCastles","White","Black","Red","Skull"]},is_available:!1,unlock:"manual"},{id:3027,name:"Chicken Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3028,name:"New Years 2021 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3029,name:"Retro Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Retro",tags:["Retro","Premium","Pixel","Red","Gray","Grey","Silver","Wings","OctM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_retro_9mm"]},{id:3030,name:"Car Cluck 9mm",price:7500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_car",tags:["Cars","Trains","Red"]},is_available:!0,unlock:"purchase"},{id:3031,name:"Merc Zone Cluck 9mm",price:7e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Merc",tags:["Merc","Suit","Black","Tie","Red"]},is_available:!0,unlock:"purchase"},{id:3032,name:"Summer Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3033,name:"Lyerpald Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_lyerpald",tags:["Dog","Grey","Gray","Purple"]},is_available:!0,unlock:"purchase"},{id:3034,name:"Pencil Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Pencil",tags:["Pencil","Sep23","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3035,name:"Devilish Cluck 9mm",price:15e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Devilish",tags:["Kids","Red","Black","Purple","Fork"]},is_available:!0,unlock:"purchase"},{id:3036,name:"Bone Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Bones",tags:["Halloween2","Oct23"]},is_available:!1,unlock:"purchase"},{id:3037,name:"New Years 2022 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3038,name:"Sleigh Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Christmas",tags:["Christmas2","Newsletter","Red","Yellow","Green","Gold","Sleigh"]},is_available:!1,unlock:"manual"},{id:3039,name:"Cards Cluck 9mm",price:1520,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Cards",tags:["EGGORG","Apr23"]},is_available:!1,unlock:"purchase"},{id:3040,name:"BWD Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Wizard",tags:["Relic","Drops2","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:3041,name:"Dino Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Dino",tags:["Dino","May23","Brown","Yellow"]},is_available:!1,unlock:"purchase"},{id:3042,name:"Eggpire Cluck 9mm",price:12500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3043,name:"SPORTS Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Sports",tags:["Sports","JulyM23","White","Bowling","Pin"]},is_available:!1,unlock:"purchase"},{id:3044,name:"Breakfast Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Breakfast",tags:["Breakfast","Food","Apple","Juice","Red"]},is_available:!1,unlock:"purchase"},{id:3045,name:"Valkyrie Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Valkyrie",tags:["Scavenger","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_9mm_valk"]},{id:3046,name:"Protractor Cluck 9mm",price:1500,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Protractor",tags:["Pencil2","Sep23","Grey","Gray","Black"]},is_available:!1,unlock:"purchase"},{id:3047,name:"Badegg Cluck 9mm",price:5e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Badegg",tags:["Badegg","Yellow"]},is_available:!1,unlock:"purchase"},{id:3048,name:"New Year 2023 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3049,name:"Aquarius Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Aquarius",tags:["Groundhog","Feb23","Blue","Stars"]},is_available:!1,unlock:"purchase"},{id:3050,name:"Cloudkicker Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Clouds",tags:["Premium","Feb23","Clouds","Rainbow","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_9mm_cloud"]},{id:3051,name:"Farm Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Farm",tags:["Farm","FebM23","Food","Red","Tomato"]},is_available:!1,unlock:"purchase"},{id:3052,name:"Thee_Owl Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_TheeOwl",tags:["Drops4","Mar23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3053,name:"Merc Zone Final Cluck 9mm",price:2147483647,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_MercF",tags:["Merc","Suit","Black","Tie"]},is_available:!1,unlock:"manual"},{id:3054,name:"Fusion Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Fusion",tags:["Premium","AprM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_9mm_fusion"]},{id:3055,name:"Camera Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Camera",tags:["Jun23","Photo","Smile","Meme"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_9mm_camera"]},{id:3056,name:"Equinox Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3057,name:"Kart Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Kart",tags:["Aug23","Kart","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:3058,name:"Slingshot Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Slingshot",tags:["Sep23","Pencil3"]},is_available:!1,unlock:"purchase"},{id:3059,name:"Megaphone Cluck 9mm",price:5,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Megaphone",tags:["Sep23","Red","White"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_9mm_mega"]},{id:3060,name:"Mouse Cluck 9mm",price:1e4,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Mouse",tags:["Sep23","Grey","Gray","Yellow","Cheese"]},is_available:!1,unlock:"purchase"},{id:3061,name:"Ancient Cluck 9mm",price:2e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3062,name:"Holideggs Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3063,name:"2024 Cluck 9mm",price:3e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!0,unlock:"purchase"},{id:3064,name:"Racer Cluck 9mm",price:25e3,item_type_id:4,item_type_name:"Secondary",category_name:"Shared Secondary Weapons",exclusive_for_class:null,item_data:{meshName:"gun_cluck9mm_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3800,name:"The RPEGG",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg",tags:["default","Yellow","Green","Grey","Gray"]},is_available:!0,unlock:"default"},{id:3801,name:"GOLD RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:3802,name:"Happy Bear RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:3804,name:"Thanksgiving RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:3805,name:"Christmas RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3806,name:"New Year 2019 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:3807,name:"Groundhog RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:3808,name:"Buck Rogers RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:3809,name:"Valentines RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:3810,name:"St Patricks RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:3811,name:"Easter RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Easter",tags:["Easter","Orange","Eggs"]},is_available:!1,unlock:"purchase"},{id:3812,name:"Flame RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:3813,name:"Rainbow RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:3814,name:"Steampunk RPEGG",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:3815,name:"Memphis RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Memphis",tags:["Memphis","Black","White"]},is_available:!0,unlock:"purchase"},{id:3816,name:"Halloween Skin RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:3817,name:"Eggwalker RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:3818,name:"Nuke Zone RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NukeZone",tags:["NukeZone","Black","Green","Neon"]},is_available:!0,unlock:"purchase"},{id:3819,name:"New Year 2020 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:3820,name:"Country Singer RPEGG",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:3821,name:"Albino RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:3822,name:"Raid Lands RPEGG",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaidLand",tags:["RaidLand","Silver","Grey","Gray","Green"]},is_available:!1,unlock:"purchase"},{id:3823,name:"Toxic RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:3824,name:"Music RPEGG",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Music",tags:["Rockstar","JanM23","Yellow","Gold","Tuba"]},is_available:!1,unlock:"purchase"},{id:3825,name:"Galeggsy RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:3826,name:"Chicken RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:3827,name:"New Year 2021 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:3828,name:"Techno RPEGG",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Techno",tags:["Techno","Premium","JunM23","Yeet","Rainbow","Red","Yellow","Green","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_rpeggTechno"]},{id:3829,name:"Car RPEGG",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_car",tags:["Cars","Trains","Silver"]},is_available:!0,unlock:"purchase"},{id:3830,name:"Merc Zone RPEGG",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Merc",tags:["Merc","Suit","Black","Tie","Green"]},is_available:!0,unlock:"purchase"},{id:3831,name:"Summer RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:3832,name:"Pencil RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Pencil",tags:["Pencil","Sep23","Yellow","Tape"]},is_available:!1,unlock:"purchase"},{id:3833,name:"Bone RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Bones",tags:["Halloween2","Oct23"]},is_available:!1,unlock:"purchase"},{id:3834,name:"New Year 2022 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:3835,name:"Retro RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Retro",tags:["Retro","Premium","Pixel","Mar23","Green","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_rpegg_retro"]},{id:3836,name:"Cards RPEGG",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:3837,name:"Dino RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:3838,name:"Eggpire RPEGG",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:3839,name:"SPORTS RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Sports",tags:["Sports","JulyM23","Brown","Football"]},is_available:!1,unlock:"purchase"},{id:3840,name:"Breakfast RPEGG",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Breakfast",tags:["Breakfast","Food","Sausage"]},is_available:!1,unlock:"purchase"},{id:3841,name:"Scavenger RPEGG",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Scavenger",tags:["Scavenger","Black","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:3842,name:"Egg Carton RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Eggs",tags:["Sep22","Drops3","Purple","Grey","Gray","Food"]},is_available:!1,unlock:"manual"},{id:3843,name:"Valkyrie RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Valkyrie",tags:["Valkyrie","Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_rpegg_valk"]},{id:3844,name:"Missile Toe RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Christmas",tags:["Christmas2","Premium","Red","White","Hohoho"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_rpegg_christ"]},{id:3845,name:"New Year 2023 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:3846,name:"Farm RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Farm",tags:["Farm","FebM23","Barn","Red"]},is_available:!1,unlock:"purchase"},{id:3947,name:"Equinox RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:3948,name:"MenoXD RPEGG",price:75e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Meno",tags:["JulyM23","Red","Black","xd"]},is_available:!0,unlock:"purchase"},{id:3949,name:"Kart RPEGG",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Kart",tags:["Kart","Aug23","Blue","Green"]},is_available:!1,unlock:"purchase"},{id:3950,name:"Thee_Owl RPEGG",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_TheeOwl",tags:["Drops5","AugM23","Twitch","Green","Fingers"]},is_available:!1,unlock:"manual"},{id:3951,name:"Fusion RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Fusion",tags:["Oct23","Premium","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_rpegg_fusion"]},{id:3952,name:"Skellington RPEGG",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Skeleton",tags:["OctM23","Premium","Black","White"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_rpegg_skele"]},{id:3953,name:"Ancient RPEGG",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:3954,name:"Holideggs RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:3955,name:"2024 RPEGG",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!0,unlock:"purchase"},{id:3956,name:"Racer RPEGG",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Eggsploder Primary Weapons",exclusive_for_class:3,item_data:{meshName:"gun_rpegg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4e3,name:"The Whipper",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg",tags:["default","Grey","Gray","Purple"]},is_available:!0,unlock:"default"},{id:4001,name:"GOLD Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4002,name:"Happy Bear Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4003,name:"Halloween Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:4004,name:"Thanksgiving Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4005,name:"Christmas Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4006,name:"New Year 2019 Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4007,name:"Groundhog Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4008,name:"Buck Rogers Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4009,name:"Valentines Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4010,name:"St Patricks Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:4011,name:"Easter Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Easter",tags:["Easter","Eggs","Purple"]},is_available:!1,unlock:"purchase"},{id:4012,name:"Flame Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4013,name:"Rainbow Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4014,name:"Steampunk Whipper",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4015,name:"Memphis Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Memphis",tags:["Memphis","White","Black","Pink"]},is_available:!0,unlock:"purchase"},{id:4016,name:"Eggwalker Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4017,name:"Nuke Zone Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NukeZone",tags:["NukeZone","Red","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:4018,name:"New Year 2020 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4019,name:"Country Singer Whipper",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4020,name:"Albino Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4021,name:"Raid Land Whipper",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaidLand",tags:["RaidLand","Blue"]},is_available:!1,unlock:"purchase"},{id:4022,name:"Toxic Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4023,name:"Music Whipper",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Music",tags:["Rockstar","JanM23","Red","Orange","Keytar","Piano"]},is_available:!1,unlock:"purchase"},{id:4024,name:"Galeggsy Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4025,name:"Chicken Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4026,name:"Techno Whipper",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Techno",tags:["Techno","AugM23","Tuh","Green","Blue"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_techno"]},{id:4027,name:"New Year 2021 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4028,name:"Car Whipper",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_car",tags:["Cars","Trains","Purple"]},is_available:!0,unlock:"purchase"},{id:4029,name:"Merc Zone Whipper",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Merc",tags:["Merc","Suit","Black","Tie","Purple"]},is_available:!0,unlock:"purchase"},{id:4030,name:"Summer Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4031,name:"Pencil Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Pencil",tags:["Pencil","Sep23","Yellow","Crayons"]},is_available:!1,unlock:"purchase"},{id:4032,name:"Retro Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Retro",tags:["Retro","Nov23","Pixel","Purple","Wings"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_retro"]},{id:4033,name:"New Year 2022 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4034,name:"Cards Whipper",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4035,name:"Dino Whipper",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Dino",tags:["Dino","May23","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:4036,name:"Eggpire Whipper",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4037,name:"SPORTS Whipper",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Sports",tags:["Sports","JulyM23","Red","Brown","Badminton"]},is_available:!1,unlock:"purchase"},{id:4038,name:"Breakfast Whipper",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Breakfast",tags:["Breakfast","Food","Brown","Red","Eggs","Bacon"]},is_available:!1,unlock:"purchase"},{id:4039,name:"Teggtris Whipper",price:1980,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Teggtris",tags:["Sep22","Mar23","Red","Orange","Yellow","Blue","Grey","Gray","Tetris","GameBoy"]},is_available:!1,unlock:"purchase"},{id:4040,name:"Turkey-Supreme Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_SpecialTurkey",tags:["NovM23","Thanksgiving","Brown","Yellow"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_turk"]},{id:4041,name:"New Year 2023 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4042,name:"Valkyrie Whipper",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_smg_valk"]},{id:4043,name:"Farm Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Farm",tags:["Farm","FebM23","Food","Green","Peas"]},is_available:!1,unlock:"purchase"},{id:4044,name:"Fusion Whipper",price:3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Fusion",tags:["Premium"," Fusion","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_smg_fusion"]},{id:4045,name:"Eggflation Whipper",price:8e4,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Eggflation",tags:["Eggflation","MayM23","Gold","Yellow","Eggs"]},is_available:!0,unlock:"purchase"},{id:4046,name:"Equinox Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4047,name:"Kart Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Kart",tags:["Kart","Aug23","Pink","Yellow","Princess","Peach"]},is_available:!1,unlock:"purchase"},{id:4048,name:"KJDCitsme Whipper",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_KJ",tags:["Drops5","AugM23","Pink","Purple","Blue"]},is_available:!1,unlock:"manual"},{id:4049,name:"Wrestlebros Whipper",price:3500,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Wrestlebros",tags:["WBs","SepM23","Gold","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4050,name:"Ancient Whipper",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4051,name:"Holideggs Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4052,name:"2024 Whipper",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:4053,name:"Racer Whipper",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Whipper Primary Weapons",exclusive_for_class:4,item_data:{meshName:"gun_smg_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4200,name:"The Crackshot",price:0,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24",tags:["default","Blue","Grey","Gray"]},is_available:!0,unlock:"default"},{id:4201,name:"GOLD Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4202,name:"Happy Bear Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4203,name:"Halloween Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:4204,name:"Thanksgiving Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4205,name:"Christmas Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4206,name:"New Year 2019 Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear",tags:["NewYears","2019","Blue","Yellow"]},is_available:!1,unlock:"manual"},{id:4207,name:"Groundhog Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4208,name:"Buck Rogers Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4209,name:"Valentines Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4210,name:"St Patricks Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Black","Yellow"]},is_available:!1,unlock:"purchase"},{id:4211,name:"Easter Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Easter",tags:["Easter","Eggs","Green"]},is_available:!1,unlock:"purchase"},{id:4212,name:"Flame Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Flames",tags:["Promotional","Red","Brown"]},is_available:!1,unlock:"manual"},{id:4213,name:"Rainbow Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Rainbow",tags:["Rainbow","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4214,name:"Steampunk Crackshot",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4215,name:"Memphis Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Memphis",tags:["Memphis","Yellow","Black","White"]},is_available:!0,unlock:"purchase"},{id:4216,name:"Eggwalker Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEgg",tags:["Eggwalker","July23","Black","Red","Grey","Gray","Yellow"]},is_available:!1,unlock:"purchase"},{id:4217,name:"Nuke Zone Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NukeZone",tags:["NukeZone","Black","Purple","Neon"]},is_available:!0,unlock:"purchase"},{id:4218,name:"New Year 2020 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2020",tags:["NewYears","2020","Purple","Pink"]},is_available:!1,unlock:"purchase"},{id:4219,name:"Country Singer Crackshot",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4220,name:"Albino Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4221,name:"Raid Land Crackshot",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaidLand",tags:["RaidLand","May23","Purple","Brown"]},is_available:!1,unlock:"purchase"},{id:4222,name:"Toxic Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4223,name:"Techno Crackshot",price:10,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Techno",tags:["Premium","MayM23","Untz","Pink","Blue","Purple"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_techno"]},{id:4224,name:"Music Crackshot",price:8e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Music",tags:["Rockstar","JanM23","Red","Guitar"]},is_available:!1,unlock:"purchase"},{id:4225,name:"Galeggsy Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4226,name:"Chicken Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4227,name:"New Year 2021 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2021",tags:["NewYears","2021","Pink","Green"]},is_available:!1,unlock:"purchase"},{id:4228,name:"Car Crackshot",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_car",tags:["Cars","Trains","Blue","White","Limosine"]},is_available:!0,unlock:"purchase"},{id:4229,name:"Retro Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Retro",tags:["Retro","Premium","Pixel","Blue","Wings"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gun_m24_retro"]},{id:4230,name:"Merc Zone Crackshot",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Merc",tags:["Merc","Suit","Black","Tie","Blue","Teal"]},is_available:!0,unlock:"purchase"},{id:4231,name:"Summer Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4232,name:"Pencil Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Pencil",tags:["Pencil","Sep23","Yellow","Stapler"]},is_available:!1,unlock:"purchase"},{id:4233,name:"New Year 2022 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4234,name:"Graysocean Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Graysocean",tags:["Drops","Blue"]},is_available:!1,unlock:"manual"},{id:4235,name:"Cards Crackshot",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4236,name:"Dino Crackshot",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Dino",tags:["Dino","May23","Brown"]},is_available:!1,unlock:"purchase"},{id:4237,name:"Eggpire Crackshot",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4238,name:"SPORTS Crackshot",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Sports",tags:["Sports","JulyM23","Silver","Golf","Clubs"]},is_available:!1,unlock:"purchase"},{id:4239,name:"Breakfast Crackshot",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Breakfast",tags:["Breakfast","Food","Fork","Red","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4240,name:"Scavenger Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Scavenger",tags:["Scavenger","Premium","Black","White","OctM23"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_scav"]},{id:4241,name:"BWD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Wizard",tags:["Sep22","Drops3","Blue","Brown","Crystal"]},is_available:!1,unlock:"manual"},{id:4242,name:"Valkyrie Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_m24_valk"]},{id:4243,name:"New Year 2023 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4244,name:"Farm Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Farm",tags:["Farm","FebM23","Food","Green","Asparagus"]},is_available:!1,unlock:"purchase"},{id:4245,name:"MenoXD Crackshot",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Meno",tags:["Drops4","Mar23","Red","Black","xd"]},is_available:!1,unlock:"manual"},{id:4246,name:"Equinox Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4247,name:"Kart Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Kart",tags:["Kart","Aug23","Red","Blue"]},is_available:!1,unlock:"purchase"},{id:4248,name:"The Fusion Crackshot",price:6,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Fusion",tags:["Fusion","SepM23","Blue","White","Black"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_fusion"]},{id:4249,name:"The Pablo Rifle",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Badegg",tags:["Badegg","Premium"]},is_available:!1,unlock:"premium"},{id:4250,name:"Ancient Crackshot",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4251,name:"Holideggs Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4252,name:"2024 Crackshot",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_NewYear2024",tags:["DecM23","NewYears","2024","White","Blue"]},is_available:!0,unlock:"purchase"},{id:4253,name:"Infernal Crackshot",price:5,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_Infernal",tags:["DecM23","Infernal","Black","Orange","Red","Grey","Gray","Burn"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_m24_infernal"]},{id:4254,name:"Racer Crackshot",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"Crackshot Primary Weapons",exclusive_for_class:5,item_data:{meshName:"gun_m24_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16e3,name:"Grenade",price:0,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade",tags:["default","green"]},is_available:!0,unlock:"default"},{id:16001,name:"GOLD Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:16002,name:"Happy Bear Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:16003,name:"Rainbow Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Rainbow",tags:["boom","White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:16004,name:"Steampunk Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Steampunk",tags:["Steampunk","Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:16005,name:"Memphis Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Memphis",tags:["Memphis","pink","blue"]},is_available:!0,unlock:"purchase"},{id:16006,name:"Nuke Zone Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NukeZone",tags:["NukeZone","Green","Black","Neon"]},is_available:!0,unlock:"purchase"},{id:16007,name:"Country Singer Grenade",price:1e5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:16008,name:"Raid Land Grenade",price:6500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaidLand",tags:["SepM23","brown"]},is_available:!1,unlock:"purchase"},{id:16009,name:"Toxic Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16010,name:"Albino Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SnakeAlbino",tags:["countrysinger","EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:16011,name:"Holy Hand Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Holy",tags:["Premium","vipItem","Blue","Yellow"],sound:"grenade_holy",cell:3,smokeColors:"white",fireColors:"gold"},is_available:!1,unlock:"vip",activeProduct:!1,sku:["item_hat_golden_wing"]},{id:16012,name:"Groundhog Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Groundhog",tags:["Groundhog","Feb23","Brown","Smile"]},is_available:!1,unlock:"purchase"},{id:16013,name:"Corrupted Grenade",price:75e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Corrupted",tags:["Brown","Eye"],sound:"grenade_corrupt",cell:4,smokeColors:"corrupt",fireColors:"corrupt"},is_available:!0,unlock:"purchase"},{id:16014,name:"Skullnado Grenade",price:7,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Skull",tags:["SepM23","OctM23","White","Halloween"],sound:"grenade_skullnado",cell:2,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_skullnado"]},{id:16015,name:"Saint Patricks Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_SaintPaddy",tags:["StPatricksDay","MarM23","Green"]},is_available:!1,unlock:"purchase"},{id:16016,name:"Easter Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Easter",tags:["Easter","Blue","Pink","Eggs"]},is_available:!1,unlock:"purchase"},{id:16017,name:"Pablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pablo",tags:["Brown","Yellow","Hat","Smile"]},is_available:!0,unlock:"purchase"},{id:16018,name:"Diablo Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Diablo",tags:["EGGORG","Apr23","Brown","Frown"]},is_available:!1,unlock:"purchase"},{id:16019,name:"Unicorn Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Unicorn",tags:["FebM23","Sep23","Pink"],sound:"grenade_unicorn",cell:1,smokeColors:"white",fireColors:"rainbow"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_unicorn"]},{id:16020,name:"Phone Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Phone",tags:["Mobile","Fire","Red"],sound:"grenade_cellphone",cell:5,smokeColors:"white"},is_available:!1,unlock:"manual"},{id:16021,name:"Merc Zone Grenade",price:7e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Merc",tags:["Merc","Suit","Black","Tie"]},is_available:!0,unlock:"purchase"},{id:16022,name:"The Coconut Punch",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Coconut",tags:["Summer","JunM23","Food","Brown","Drink","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:16023,name:"Toilet Paper Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_ToiletPaper",tags:["Premium","AugM23","Poop","White"],sound:"grenade_tp",cell:6,smokeColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_toilet_papr"]},{id:16024,name:"Buck Rogers Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:16025,name:"Galeggsy Grenade",price:7500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:16026,name:"ChantiGG Booth Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Booth",tags:["Chantigg","Red","Phone"]},is_available:!0,unlock:"purchase"},{id:16027,name:"Glitterbomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Glitterbomb",tags:["Pencil","Premium","Pink","Disco"],sound:"grenade_glitterbomb",smokeColors:"white",fireColors:"gold",cell:7},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_glitterbomb"]},{id:16028,name:"Apple Grenade",price:750,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Apple",tags:["Pencil","Sep23","Red","Food"]},is_available:!1,unlock:"purchase"},{id:16029,name:"Wero Grenade",price:1250,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Wero",tags:["Wero","Chicken","Yellow"]},is_available:!0,unlock:"purchase"},{id:16030,name:"Halloween Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Halloween",tags:["Halloween","Oct23","Pumpkin","Jack","Orange","Smile"]},is_available:!1,unlock:"purchase"},{id:16031,name:"Thanksgiving Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turkey",tags:["NovM23","Thanksgiving","Eye","Yellow"]},is_available:!1,unlock:"purchase"},{id:16032,name:"Thermal Detonator Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Thermal",tags:["Premium","JunM23","Red","Black"],sound:"grenade_thermal",cell:8,smokeColors:"thermal",fireColors:"thermal"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_thermal"]},{id:16033,name:"Christmas Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Present",tags:["Christmas2","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:16034,name:"Eggs of Legends Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Crystal",tags:["Eggteam","Blue"]},is_available:!0,unlock:"purchase"},{id:16035,name:"New Year 2022 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:16036,name:"Supernova Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Supernova",tags:["AprM23","Rainbow","White","JanM24","premFeatTwo"],sound:"grenade_supernova",cell:9,smokeColors:"supernova",fireColors:"thermal"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_supernova"]},{id:16037,name:"Valentines Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valentines",tags:["Valentines","Heart","Red"]},is_available:!1,unlock:"purchase"},{id:16038,name:"Octopus Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Octopus",tags:["May23","Oct23","White","Cute"],sound:"grenade_octopus",cell:10,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_octopus"]},{id:16039,name:"Bros Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_BBros",tags:["Premium","Bros","Orange"],sound:"grenade_bbros",cell:11,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16040,name:"Cards Grenade",price:1520,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:16041,name:"Diablo Frown Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_DiabloCannon",tags:["Mar23","EGGORG","Blue","Face"],sound:"grenade_diablocannon",cell:12,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_diablo"]},{id:16042,name:"Yoyo Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Yoyo",tags:["Relic","Drops2","Blue","White"]},is_available:!1,unlock:"manual"},{id:16043,name:"Dino Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:16044,name:"Bumblebee Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Bee",tags:["Premium","Summer","Mar23","Yellow","Black","Cute"],sound:"grenade_bees",cell:13,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_bumble"]},{id:16045,name:"Soccer Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Soccer",tags:["Sports","JulyM23","Black","White"]},is_available:!1,unlock:"purchase"},{id:16046,name:"Football Helmet Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Football",tags:["Premium","Sports","JulyM23","Red"],sound:"grenade_football",cell:14,smokeColors:"softblack",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_football"]},{id:16047,name:"Unhatched Chicken Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Chicken",tags:["Chicken","Eggs"]},is_available:!1,unlock:"purchase"},{id:16048,name:"Valkyrie Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"],sound:"grenade_valkyrie",cell:15,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_valk"]},{id:16049,name:"Milk Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Milk",tags:["Premium","Breakfast","MayM23","Pink","Food"],sound:"grenade_milk",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_milk"]},{id:16050,name:"Breakfast Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Breakfast",tags:["Breakfast","Food","Eggs","Bacon"]},is_available:!1,unlock:"purchase"},{id:16051,name:"Eyeball Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Eyeball",tags:["Scavenger","AugM23","Blue"]},is_available:!1,unlock:"purchase"},{id:16052,name:"Padlock Grenade",price:4200,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Padlock",tags:["Pencil2","Sep23","Grey","Gray","Locker"]},is_available:!1,unlock:"purchase"},{id:16053,name:"Barrel Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Barrel",tags:["Sep22","Mar23","Brown"]},is_available:!1,unlock:"purchase"},{id:16054,name:"Bloodonade Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_premium_Blood",tags:["Premium","Halloween3","Red","premFeatOne","DecM23"],sound:"grenade_bloodonade",cell:17,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gre_blood"]},{id:16055,name:"Nutcracker Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Nutcracker",tags:["Christmas2","Red","White","Face"]},is_available:!1,unlock:"purchase"},{id:16056,name:"New Year 2023 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2023",tags:["NewYears","2023","Red","Blue","Yellow"]},is_available:!1,unlock:"purchase"},{id:16057,name:"Tambourine Grenade",price:5e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Tambourine",tags:["Rockstar","JanM23","Aug23","Music"]},is_available:!1,unlock:"purchase"},{id:16058,name:"Blue Shell Grenade",price:2147483647,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Turtle",tags:["Community","BWD"],sound:"grenade_blueshell",cell:20,smokeColors:"white",fireColors:"white"},is_available:!1,unlock:"manual"},{id:16059,name:"Slop Bucket Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Pail",tags:["Premium","farm","FebM23","Food"],sound:"grenade_milkbucket",cell:16,smokeColors:"white",fireColors:"default"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_pail"]},{id:16060,name:"Green Shell Grenade",price:3500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleGreen",tags:["Kart","AprM23","Turtle"]},is_available:!1,unlock:"purchase"},{id:16061,name:"Red Shell Grenade",price:1e4,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_TurtleRed",tags:["Kart","AprM23","Turtle","JanM24","premFeatTwo"]},is_available:!0,unlock:"purchase"},{id:16062,name:"Equinox Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:16063,name:"Kart Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Kart",tags:["Kart","Aug23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:16064,name:"Timebomb Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Timebomb",tags:["Kart","Aug23","Blue","Yellow"],sound:"grenade_Timebomb",cell:18,smokeColors:"blue",fireColors:"blue"},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_gre_timebomb"]},{id:16065,name:"Luchador Grenade",price:2500,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Luchador",tags:["WBs","SepM23","Wrestle","Face"]},is_available:!1,unlock:"purchase"},{id:16066,name:"Smooth Brain Grenade",price:2100,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Brain",tags:["Oct23","Halloween4","Pink"]},is_available:!1,unlock:"purchase"},{id:16067,name:"Ancient Grenade",price:2e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:16068,name:"Holideggs Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:16069,name:"2024 Grenade",price:3e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_NewYear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!0,unlock:"purchase"},{id:16070,name:"Racer Frag Grenade",price:25e3,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarFrag",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:16071,name:"Rogue Tire Grenade",price:5,item_type_id:6,item_type_name:"Grenade",category_name:"Grenades",exclusive_for_class:null,item_data:{meshName:"grenade_RaceCarPremium",tags:["JanM24","Black","Text","Pireggi"],sound:"grenade_tire",cell:21,smokeColors:"white",fireColors:"default"},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gre_racecar"]},{id:4500,name:"The TriHard",price:0,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug",tags:["Default","Red"]},is_available:!0,unlock:"default"},{id:4501,name:"GOLD TriHard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Gold",tags:["Brown","Gold","Grey","Gray","Silver"]},is_available:!0,unlock:"purchase"},{id:4502,name:"Happy Bear TriHard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bear",tags:["White","Pink","Cute","Heart"]},is_available:!0,unlock:"purchase"},{id:4503,name:"Rainbow TriHard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Rainbow",tags:["White","Red","Orange","Yellow","Green","Blue","Purple","Black"]},is_available:!0,unlock:"purchase"},{id:4504,name:"Steampunk TriHard",price:1e4,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Steampunk",tags:["Brown","Gears"]},is_available:!0,unlock:"purchase"},{id:4505,name:"Memphis TriHard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Memphis",tags:["Memphis","Black","Green"]},is_available:!0,unlock:"purchase"},{id:4506,name:"Nuke Zone TriHard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NukeZone",tags:["Purple","Blue","Black","Blurple","Neon"]},is_available:!0,unlock:"purchase"},{id:4507,name:"Country Singer Tri-Hard",price:1e5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Snake",tags:["EggyCash","Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:4508,name:"Raid Land Tri-Hard",price:6500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaidLand",tags:["RaidLand","Yellow","Brown"]},is_available:!1,unlock:"purchase"},{id:4509,name:"Toxic Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Toxic",tags:["Rotten","Black","Green","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:4510,name:"Albino Snake Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SnakeAlbino",tags:["EggyCashAlbino","White","ABHS","Snek","Red","Black","Gray","Grey"]},is_available:!1,unlock:"manual"},{id:4511,name:"Saint Patricks Skin Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_SaintPaddy",tags:["StPatricksDay","MarM23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:4512,name:"Retro Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Retro",tags:["Retro","Premium","Sep23","Red","Green","Pixel","Wings"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_gun_aug_retro"]},{id:4513,name:"Easter Tri-Hard",price:1e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Easter",tags:["Easter","JunM23","Green","Eggs"]},is_available:!1,unlock:"purchase"},{id:4514,name:"Car Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_car",tags:["Cars","Trains","Truck","Green","Red","Yellow"]},is_available:!0,unlock:"purchase"},{id:4515,name:"Merc Zone Tri-Hard",price:7e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Merc",tags:["Merc","Suit","Pink","Black"]},is_available:!0,unlock:"purchase"},{id:4516,name:"Summer Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Watergun",tags:["Summer","JunM23","Blue","Orange","Yellow","Blue","Orange","Yellow"]},is_available:!1,unlock:"purchase"},{id:4517,name:"Buck Rogers Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Buck",tags:["Promotional","Black","Grey","Gray"]},is_available:!1,unlock:"manual"},{id:4518,name:"Galeggsy Tri-Hard",price:7500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Galaxy",tags:["Galeggsy","AprM23","Blue","Purple","Blurple","Stars"]},is_available:!1,unlock:"purchase"},{id:4519,name:"Pencil Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Pencil",tags:["Pencil","Sep23","Smile","Yellow","Blue","Scissors"]},is_available:!1,unlock:"purchase"},{id:4520,name:"Halloween Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Halloween",tags:["Halloween","Oct23","Purple","Green","Bat","Wings"]},is_available:!1,unlock:"purchase"},{id:4521,name:"Thanksgiving Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Turkey",tags:["NovM23","Thanksgiving","Brown","Red","Purple","Eye"]},is_available:!1,unlock:"purchase"},{id:4522,name:"Christmas Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Present",tags:["Christmas","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4523,name:"New Year 2022 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2022",tags:["NewYears","2022","Blue","Red","Gold"]},is_available:!1,unlock:"purchase"},{id:4524,name:"ChantiGG Tri-Hard",price:2147483647,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chantigg",tags:["Drops","Red","Phone","Booth"]},is_available:!1,unlock:"manual"},{id:4525,name:"Valentines Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valentines",tags:["ValentinesDay","Heart","Brown","Leopard","Red"]},is_available:!1,unlock:"purchase"},{id:4526,name:"Kawaii Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cutesy",tags:["Kawaii","Pink","Yellow","Blue"]},is_available:!0,unlock:"purchase"},{id:4527,name:"Cards Tri-Hard",price:1520,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Cards",tags:["EGGORG","Apr23","Blue","Black","Heart"]},is_available:!1,unlock:"purchase"},{id:4528,name:"Valkyrie Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Valkyrie",tags:["Premium","Valkyrie","Gold","Yellow","Blue"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_gun_valk_aug"]},{id:4529,name:"Dino Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Dino",tags:["Dino","May23","Orange"]},is_available:!1,unlock:"purchase"},{id:4530,name:"Eggpire Tri-Hard",price:12500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_spaceEggAlt",tags:["Eggwalker2","Black","Grey","Gray","Blue"]},is_available:!1,unlock:"purchase"},{id:4531,name:"SPORTS Tri-Hard",price:2500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Sports",tags:["Sports","JulyM23","Green","Blue","Tennis"]},is_available:!1,unlock:"purchase"},{id:4532,name:"Chicken Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Chicken",tags:["Chicken","Red","White"]},is_available:!1,unlock:"purchase"},{id:4533,name:"Breakfast Tri-Hard",price:1500,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Breakfast",tags:["Breakfast","Food","Spoon","Red","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:4534,name:"Bone Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Bones",tags:["Halloween3","OctM23"]},is_available:!1,unlock:"purchase"},{id:4535,name:"New Year 2023 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2023",tags:["NewYears","2023","Red","Yellow"]},is_available:!1,unlock:"purchase"},{id:4536,name:"Music Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Music",tags:["Rockstar","JanM23","Gold","Yellow","Saxaphone","Saxamaphone"]},is_available:!1,unlock:"purchase"},{id:4537,name:"Groundhog Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Groundhog",tags:["Groundhog","Feb23","Brown"]},is_available:!1,unlock:"purchase"},{id:4538,name:"Farm Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Farm",tags:["Farm","FebM23","Food","Red","Yellow","Orange","Peppers"]},is_available:!1,unlock:"purchase"},{id:4539,name:"Equinox Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Equinox",tags:["Equinox","July23","Blue","Yellow","Sun","Moon"]},is_available:!1,unlock:"purchase"},{id:4540,name:"Fusion Tri-Hard",price:5,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Fusion",tags:["Premium","Fusion","JulyM23","White","Blue","Grey","Gray"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_aug_fusion"]},{id:4541,name:"Kart Tri-Hard",price:5e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Kart",tags:["Kart","Aug23","Green","Yellow"]},is_available:!1,unlock:"purchase"},{id:4542,name:"Ancient Tri-Hard",price:2e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_Ruins",tags:["Nov23","Mayan","Gray","Grey","Green"]},is_available:!1,unlock:"purchase"},{id:4543,name:"Holideggs Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_PresentRed",tags:["Dec23","Christmas3","Gold","Gray","Grey","Silver","Black","Yellow","Bow","Present"]},is_available:!1,unlock:"purchase"},{id:4544,name:"2024 Tri-Hard",price:3e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_NewYear2024",tags:["DecM23","NewYears","2024","Blue","White"]},is_available:!0,unlock:"purchase"},{id:4545,name:"Racer Tri-Hard",price:25e3,item_type_id:3,item_type_name:"Primary",category_name:"TriHard Primary Weapons",exclusive_for_class:6,item_data:{meshName:"gun_aug_RaceCar",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"},{id:15e3,name:"The Whisk Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"whisk",tags:["Silver"]},is_available:!0,unlock:"default"},{id:15001,name:"Corn Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_corn",tags:["Yellow","Green","Food","Meme"]},is_available:!0,unlock:"default"},{id:15002,name:"Club Melee",price:0,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_stick",tags:["Brown"]},is_available:!0,unlock:"default"},{id:15003,name:"Gold Melee",price:2500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_gold",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15004,name:"Pink Bear Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bear",tags:["Pink","Cute","Heart","Whisk"]},is_available:!0,unlock:"purchase"},{id:15005,name:"Steampunk Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_steampunk",tags:["Brown","Gold","Whisk"]},is_available:!0,unlock:"purchase"},{id:15006,name:"Rainbow Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rainbow",tags:["Red","Orange","Yellow","Green","Blue","Clouds","Whisk"]},is_available:!0,unlock:"purchase"},{id:15007,name:"Memphis Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_memphis",tags:["Black","White","Rainbow","Whisk"]},is_available:!0,unlock:"purchase"},{id:15008,name:"Rotten Melee",price:15e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_toxic",tags:["Pipe","Green","Black"]},is_available:!0,unlock:"purchase"},{id:15009,name:"Car Melee",price:2e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shift",tags:["Black","Silver","Gear"]},is_available:!0,unlock:"purchase"},{id:15010,name:"Brown Snake Melee",price:1e5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_snake",tags:["Brown","Snek"]},is_available:!0,unlock:"purchase"},{id:15011,name:"Hoe Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hoe",tags:["FebM23","farm","Tools"]},is_available:!1,unlock:"purchase"},{id:15012,name:"Flame Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_flame",tags:["Orange","Yellow","Fire"]},is_available:!1,unlock:"manual"},{id:15013,name:"Valkyrie Melee",price:6,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_valkyrie",tags:["Gold","Blue","Yellow","Premium"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_valk"]},{id:15014,name:"BWD Wizard Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wizard",tags:["Drops4","Mar23","Blue","Brown","Staff"]},is_available:!1,unlock:"manual"},{id:15015,name:"Sneaker Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_sneaker",tags:["Bros","MarM23","White","Blue","Shoe"]},is_available:!1,unlock:"purchase"},{id:15016,name:"Fiddle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fiddle",tags:["StPatricksDay","MarM23","Music","Brown"]},is_available:!1,unlock:"purchase"},{id:15017,name:"Medieval Key Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_key",tags:["Apr23","Newsletter","Gold","Yellow"]},is_available:!1,unlock:"manual"},{id:15018,name:"Galeggsy Whisk",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_galaxy",tags:["AprM23","Galeggsy","Blue","Purple","Planets","OctM23"]},is_available:!1,unlock:"purchase"},{id:15019,name:"Giant Spoon Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spoon",tags:["AprM23","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15020,name:"Albino Snake Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_albino",tags:["Giveaway","White","ABHS","Snek"]},is_available:!1,unlock:"manual"},{id:15021,name:"Forkin' Fork! Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fork",tags:["Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15022,name:"Bone Bonker",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_bone",tags:["May23","Dino2","Caveman"]},is_available:!1,unlock:"purchase"},{id:15023,name:"Stone Hammer Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rock",tags:["May23","Nov23","Dino2","Grey","Gray"]},is_available:!1,unlock:"premium",activeProduct:!0,sku:["item_melee_stone"]},{id:15024,name:"Eggflation Whisk",price:8e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_eggflation",tags:["MayM23","Eggflation","Gold","Yellow","80k"]},is_available:!0,unlock:"purchase"},{id:15025,name:"Butterknife Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_butterknife",tags:["MayM23","Eggflation","Silver","Food"]},is_available:!0,unlock:"purchase"},{id:15026,name:"Shellfie Stick Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_selfiestick",tags:["Jun23","Photo","Cheese"]},is_available:!1,unlock:"purchase"},{id:15027,name:"Spatula Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_spatula",tags:["Jun23","Silver"]},is_available:!0,unlock:"purchase"},{id:15028,name:"Popsicle Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_popsicle",tags:["JunM23","Summer2","Pink","Food"]},is_available:!1,unlock:"purchase"},{id:15029,name:"Wrench Melee",price:4500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_wrench",tags:["JunM23","Summer2","Blue","Yellow","Tools"]},is_available:!0,unlock:"purchase"},{id:15030,name:"Fusion Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fusion",tags:["JunM23","Blue","White","Gray","Grey"]},is_available:!0,unlock:"premium",activeProduct:!0,sku:["item_melee_fusion"]},{id:15031,name:"Equinox Melee",price:3e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_equinox",tags:["July23","Equinox","Blue","Yellow","Sun","Moon","Whisk"]},is_available:!1,unlock:"purchase"},{id:15032,name:"Crowbar Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_crowbar",tags:["July23","Blue","Yellow","Red","Tools"]},is_available:!0,unlock:"purchase"},{id:15033,name:"Hockey Melee",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_hockey",tags:["JulyM23","Sports2","Stick"]},is_available:!1,unlock:"purchase"},{id:15034,name:"Shovel Melee",price:7500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_shovel",tags:["JulyM23","Pink","Yellow","Blue"]},is_available:!1,unlock:"purchase"},{id:15035,name:"MenoXD Katana",price:125e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_meno",tags:["JulyM23","Red","Black"]},is_available:!0,unlock:"purchase"},{id:15036,name:"Kart Melee",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_kart",tags:["Aug23","Kart","Red","Blue","Whisk"]},is_available:!1,unlock:"purchase"},{id:15037,name:"Harrison Cat Melee",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_harrison",tags:["AugM23","Drops5","Black","White","Cat"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_cat"]},{id:15039,name:"Ruler Melee",price:6500,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruler",tags:["Sep23","Pencil3","Brown"]},is_available:!1,unlock:"purchase"},{id:15040,name:"Fighting Fish Slapper",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_fish",tags:["Sep23","Bundle","Food"]},is_available:!1,unlock:"premium"},{id:15041,name:"Folding Chair Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_chair",tags:["SepM23","WBs","Wrestle","Grey","Gray"]},is_available:!1,unlock:"purchase"},{id:15042,name:"Pitchfork Melee",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_devil",tags:["Oct23","Halloween4","Red","Black"]},is_available:!1,unlock:"purchase"},{id:15043,name:"Rolling Pin Whalloper",price:8e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_rollingpin",tags:["Oct23","Brown"]},is_available:!0,unlock:"purchase"},{id:15044,name:"Ancient Club",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_ruins",tags:["Nov23","Green","Gray","Grey"]},is_available:!1,unlock:"purchase"},{id:15045,name:"Mayan Macuahuitl",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_mayan",tags:["Nov23","Red","Black","Brown"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_mayan"]},{id:15046,name:"Turkey Drumstick",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_drumstick",tags:["NovM23","Red","Black","Brown"]},is_available:!1,unlock:"purchase"},{id:15047,name:"The Turkey Carver",price:5,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_carver",tags:["NovM23","Blue","Black","Gas"]},is_available:!1,unlock:"premium",activeProduct:!1,sku:["item_melee_turkcar"]},{id:15048,name:"The Candy Cane-r",price:1e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_candycane",tags:["Dec23","Blue","Black","Gas"]},is_available:!1,unlock:"purchase"},{id:15049,name:"Elf on a Shelf Melee",price:2147483647,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_elf",tags:["Dec23","Blue","Black","Gas"]},is_available:!1,unlock:"premium"},{id:15050,name:"2024 Whisk",price:5e3,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_newyear2024",tags:["DecM23","2024","NewYears","Blue","White"]},is_available:!0,unlock:"purchase"},{id:15051,name:"Racer Lug Wrench",price:5e4,item_type_id:7,item_type_name:"Melee",category_name:"Melee",exclusive_for_class:null,item_data:{meshName:"melee_lugwrench",tags:["JanM24","Racer","White","Orange","Grey","Gray"]},is_available:!0,unlock:"purchase"}],Jl=[1012,1023,1115,1256,1257,1258,2017,2394,1118,2007,2396,1284,2395,2085,2132,2201,2184,1260,2153,1282,2104,1121,1017,3034,3402,3802,1175,2100,2354,1179,2065,3113,4003,2266,2315,1237,1206,4201,2135,2086,2126,2134,2168,2247,2209,1203,3833,4017,2155,15015,2117,1263,1205,1150,1225,3117,1172,4213,3639,1198,1127,1220,1224,1323,4216,1137,15024,3820,16013,1183,3017,15010,3645,1101,3437,1078,1167,1076,1210,1211,1213,3625,1080,1079,1075,1074,1073,1066,4524,3012,3020,4212,4008,4220,3821,3620,3420,4006,3108,3612,3020,16010,4020,4206,4208,15012];function pt(t,f,c,r){let i=Nt.cloneMesh(t,f,c);return f.addMesh(i),r?i.material=r:i.material&&i.material._scene!=f&&(i.material=or(i.material.name,f)),i}function xa(t,f){let c=Nt.cloneSkeleton(t,f);return f.addSkeleton(c),c}function or(t,f){let c=f.getMaterialByName(t);return c||(c=Nt.getMaterialByName(t).clone(t,f),f.addMaterial(c)),c}T.Skeleton.prototype.disableBlending=function(){this.bones.forEach(function(t){t.animations.forEach(function(f){f.enableBlending=!1})})};T.Scene.prototype.cloneMesh=function(t,f,c){var r=this.getMeshByName(t);return new T.Mesh(t,f,c,r)};T.chrome84BugWorkaround=!1;T.Scene.prototype.cloneSkeleton=function(t,f){var c=this.getSkeletonByName(t).clone();return c.name=t+Date.now(),c._scene=f,c};T.DynamicTexture.prototype.clearRect=function(t,f,c,r){this._context.clearRect(t,f,c,r)};T.AbstractMesh.prototype.setLayerMask=function(t){this.layerMask=t;for(var f=this.getChildMeshes(),c=0;c<f.length;c++)f[c].setLayerMask(t)};T.AbstractMesh.prototype.setRenderingGroupId=function(t){this.renderingGroupId=t;for(var f=this.getChildMeshes(),c=0;c<f.length;c++)f[c].setRenderingGroupId(t)};T.TransformNode.prototype.setVisible=function(t){this.isVisible=t,this._isWorldMatrixFrozen=!t;for(var f=this.getChildTransformNodes(),c=0;c<f.length;c++)f[c].setVisible(t)};T.AbstractMesh.prototype.setMaterial=function(t){this.material=t;for(var f=this.getChildMeshes(),c=0;c<f.length;c++)f[c].setMaterial(t)};T.Vector3.ClampToRef=function(t,f,c,r){var i=t.x;i=i>c.x?c.x:i,i=i<f.x?f.x:i;var a=t.y;a=a>c.y?c.y:a,a=a<f.y?f.y:a;var n=t.z;n=n>c.z?c.z:n,n=n<f.z?f.z:n,r.copyFromFloats(i,a,n)};function Ae(t){this.scene=t,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.active=!1,this.player=null,this.damage=20,this.range=0,this.velocity=0,this.hitsMap=!1,this.origin=new T.Vector3,this.direction=new T.Vector3,this.end=new T.Vector3,this.meshName="",this.weaponClassId=0,typeof Cr<"u"&&(this.actor=new Cr(this))}Ae.damageExp=4;Ae.v1=new T.Vector3;Ae.v2=new T.Vector3;Ae.v3=new T.Vector3;Ae.position=new T.Vector3;Ae.fire=function(t,f,c,r){var i=Zt.bulletPool.retrieve();i.fireThis(t,f,c,r)};Ae.prototype.fireThis=function(t,f,c,r){this.player=t,this.x=f.x,this.y=f.y,this.z=f.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(c).normalize().scaleInPlace(r.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.dz=this.direction.z,this.weaponClass=r,this.damage=r.damage,this.active=!0,this.range=r.range,this.velocity=r.velocity,this.hitsMap=!1,this.powerful=!1,this.dmgTypeId=r.dmgTypeId;var i=Y.rayCollidesWithMap(f,c,Y.projectileCollidesWithCell);i&&(this.end.copyFrom(i.pick.pickedPoint),this.range=T.Vector3.Distance(f,i.pick.pickedPoint),this.hitsMap=!0),t.activeShellStreaks&je.EggBreaker&&(this.powerful=!0,this.damage*=1.5),this.actor&&(this.player.weapon.tracer==0?this.actor.fire(this.powerful):this.actor.delayFrames=Number.MAX_SAFE_INTEGER)};Ae.prototype.remove=function(){Zt.bulletPool.recycle(this),this.actor&&this.actor.remove()};Ae.prototype.update=function(){if(Ae.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!Y.rayCollidesWithPlayer(Ae.position,this.direction,this)&&(this.x+=this.dx,this.y+=this.dy,this.z+=this.dz,this.range-=this.velocity,this.range<=0)){if(this.actor&&this.hitsMap){var t=this.end,f=-this.dx*.1,c=-this.dy*.1,r=-this.dz*.1;wc(t.x,t.y,t.z,f,c,r)}this.remove();return}};Ae.prototype.collidesWithPlayer=function(t,f){Ae.v1.x=this.dx,Ae.v1.y=this.dy,Ae.v1.z=this.dz,Ae.v1.normalize();var c=-T.Vector3.Dot(Ae.v1,f)*.8+.2;let r=1;var i=this.damage*Math.pow(c,Ae.damageExp+Math.pow(c,Ae.damageExp)*r);isNaN(i)&&console.error("Bullet.collidesWithPlayer damage is NaN",c,Ae.damageExp,r,Ae.v1,f),ua(t,this,i,Ae.v1.x,Ae.v1.z),this.remove()};var hn=class{constructor(){var f=new T.Vector3(0,0,0),c=new T.Vector3(Re.width,Re.height,Re.depth);this.world=new T.BoundingBox(f,c),this.bvh=this.createNode(this.world,2),this.checkTick=0}add(f,c){c=c||this.bvh;for(var r=0;r<c.length;r++){var i=c[r];T.BoundingBox.Intersects(f.bb,i)&&(i.maximumWorld.x-i.minimumWorld.x>(f.bb.maximumWorld.x-f.bb.minimumWorld.x)*.5&&i.maximumWorld.y-i.minimumWorld.y>(f.bb.maximumWorld.y-f.bb.minimumWorld.y)*.5&&i.maximumWorld.z-i.minimumWorld.z>(f.bb.maximumWorld.z-f.bb.minimumWorld.z)*.5?(i.bvh.length==0&&(i.bvh=this.createNode(i,2)),f.checkTick=0,this.add(f,i.bvh)):i.objects.push(f))}}createNode(f,c){var r=[],i=(f.maximumWorld.x-f.minimumWorld.x)/c,a=(f.maximumWorld.z-f.minimumWorld.z)/c;if(i>Re.height)var n=0,s=Re.height,o=Re.height;else var n=f.minimumWorld.y,s=f.maximumWorld.y,o=(s-n)/c;for(var l=f.minimumWorld.x;l<f.maximumWorld.x;l+=i)for(var u=n;u<s;u+=o)for(var h=f.minimumWorld.z;h<f.maximumWorld.z;h+=a){var d=new T.Vector3(l,u,h),p=new T.Vector3(l+i,u+o,h+a),m=new T.BoundingBox(d,p);m.bvh=[],m.objects=[],r.push(m)}return r}getObjects(f,c){this.checkTick++,this.recurseObjects(f,this.bvh,c)}recurseObjects(f,c,r){for(var i=0;i<c.length;i++){var a=c[i];if(T.BoundingBox.Intersects(f,a)){for(var n=0;n<a.objects.length;n++){var s=a.objects[n];s.checkTick!=this.checkTick&&T.BoundingBox.Intersects(f,s.bb)&&(s.checkTick=this.checkTick,r(a.objects[n]))}this.recurseObjects(f,a.bvh,r)}}}getObjectsWithRay(f,c,r){this.checkTick++,this.recurseObjectsWithRay(f,c,this.bvh,r)}recurseObjectsWithRay(f,c,r,i){for(var a=0;a<r.length;a++){var n=r[a];if(T.BoundingBox.IntersectsRay(n,f,c)){for(var s=0;s<n.objects.length;s++){var o=n.objects[s];o.checkTick!=this.checkTick&&T.BoundingBox.IntersectsRay(o.bb,f,c)&&(o.checkTick=this.checkTick,i(n.objects[s]))}this.recurseObjectsWithRay(f,c,n.bvh,i)}}}};O.catalog||(O.catalog=new Ls);function Ls(){if(st==null)throw"Items is undefined or null, cannot create Catalog";this.isSetup=!1,this.filterItems=function(t,f){for(var c=[],r=0;r<t.length;r++)f(t[r])&&c.push(t[r]);return c},this.findItemInListById=function(t,f){for(var c=0;c<f.length;c++)if(f[c]&&f[c].id===t)return f[c];return null},this.findItemsByIds=function(t){return st.filter(f=>t.includes(f.id))},this.findItemById=function(t){return this.findItemInListById(t,st)},this.findItemBy8BitItemId=function(t,f,c){if(this.isSetup===!1&&this.setupCatalog(),f===void 0||f>=vt.length)return null;var r=c;switch(t){case se.Hat:return c===0?null:this.findItemInListById(r,this.hats);case se.Stamp:return c===0?null:this.findItemInListById(r,this.stamps);case se.Primary:return this.findItemInListById(r,this.forClass[f].forWeaponSlot[nt.Primary]);case se.Secondary:return this.findItemInListById(r,this.forClass[f].forWeaponSlot[nt.Secondary]);case se.Grenade:return this.findItemInListById(r,this.grenades);case se.Melee:return this.findItemInListById(r,this.melee)}},this.addWeaponFunctions=function(t){t.instantiateNew=function(f){var c;return this.exclusive_for_class===null?c=new $e(f,this.item_data.meshName):c=new O.classes[this.exclusive_for_class].weapon(f,this.item_data.meshName),f.actor&&f.actor.setWeaponSkeleton(c.actor.skeleton),c}},this.addGrenadeFunctions=function(t){t.instantiateNew=function(f){let c=pt(this.item_data.meshName,f.scene),r={scene:f.scene,player:f,actor:{mesh:c,dispose:()=>{c.dispose()}}};return c.position.y=.5,c.position.z=1,r}},this.addMeleeFunctions=function(t){t.instantiateNew=function(f){let c=pt(this.item_data.meshName,f.scene),r={scene:f.scene,player:f,actor:{weaponMesh:c,skeleton:xa("melee_skeleton",f.scene),dispose:()=>{c.dispose()}}};return f.actor&&f.actor.setWeaponSkeleton(r.actor.skeleton),r}},this.getTaggedItems=function(t,f){if(!t)return[];t=t.replace(/\s/g,"");let c=t.split(","),r=function(i){if(i.item_data.tags!==void 0&&i.item_data.tags!==null&&i.item_data.tags.length>0){if(f!==void 0&&i.item_type_name!==getKeyByValue(se,f))return!1;let n=!1;return i.item_data.tags.forEach(s=>{c.forEach(o=>{o===s&&(n=!0)})}),n}return!1};return this.filterItems(st,r)},this.getTaggedItemsWithItemType=(t,f)=>{},this.premiumSoundValid=function(t){return t.hasOwnProperty("unlock")&&t.unlock==="premium"||t.unlock==="manual"&&t.item_data.meshName==="gun_cluck9mm_CubicCastles"},this.getPremiumGunMeshNames=function(){Object.keys(vt).forEach(t=>{t!=="Soldier"&&(Tr[t]=st.filter(f=>hasValue(f.exclusive_for_class)&&f.exclusive_for_class===vt[t]&&this.premiumSoundValid(f)).map(f=>f.item_data.meshName))}),Object.keys(se).forEach(t=>{t!=="Primary"?Tr[t]=st.filter(f=>hasValue(f.item_type_id)&&f.item_type_id===se[t]&&this.premiumSoundValid(f)).map(f=>f.item_data.meshName):t==="Primary"&&(Tr.Soldier=st.filter(f=>hasValue(f.item_type_id)&&f.item_type_id===se.Primary&&!hasValue(f.exclusive_for_class)&&this.premiumSoundValid(f)).map(f=>f.item_data.meshName))})},this.setupCatalog=function(){this.hats=[],this.stamps=[],this.primaryWeapons=[],this.secondaryWeapons=[],this.grenades=[],this.melee=[],this.forClass=[];for(var t=0;t<st.length;t++)switch(st[t].item_type_id){case se.Hat:this.hats.push(st[t]);break;case se.Stamp:this.stamps.push(st[t]);break;case se.Primary:this.primaryWeapons.push(st[t]),this.addWeaponFunctions(st[t]);break;case se.Secondary:this.secondaryWeapons.push(st[t]),this.addWeaponFunctions(st[t]);break;case se.Grenade:this.grenades.push(st[t]),this.addGrenadeFunctions(st[t]);break;case se.Melee:this.melee.push(st[t]),this.addMeleeFunctions(st[t]);break}for(var f=0;f<vt.length;f++){var c=function(l){return l.price===0&&l.exclusive_for_class===null},r=function(l){return l.price===0&&l.exclusive_for_class===f},i=function(l){return l.price>0&&l.exclusive_for_class===null},a=function(l){return l.price>0&&l.exclusive_for_class===f},n=this,s=function(u){var u=n.filterItems(u,c).concat(n.filterItems(u,r)).concat(n.filterItems(u,i)).concat(n.filterItems(u,a));return u},o={primaryWeapons:s(this.primaryWeapons),secondaryWeapons:s(this.secondaryWeapons)};o.forWeaponSlot=[o.primaryWeapons,o.secondaryWeapons],this.forClass.push(o)}this.isSetup=!0},this.isSetup||this.setupCatalog()}var Y={init:function(t){Y.playerCollisionMesh=T.MeshBuilder.CreateBox("pc",{size:.5,height:.6},t),Y.playerCollisionMesh.position.y=.3,Y.playerCollisionMesh.bakeCurrentTransformIntoVertices(),Y.playerCollisionMesh.setEnabled(!1),Y.wedgeCollisionMesh=T.MeshBuilder.CreateBox("",{size:1.5},t),Y.wedgeCollisionMesh.position.y=-.75,Y.wedgeCollisionMesh.bakeCurrentTransformIntoVertices(),Y.wedgeCollisionMesh.rotation.x=-Math.PI/4,Y.wedgeCollisionMesh.bakeTransformIntoVertices(Y.wedgeCollisionMesh.getWorldMatrix()),Y.wedgeCollisionMesh.setEnabled(!1),Y.iwedgeCollisionMesh=T.MeshBuilder.CreateBox("",{size:1.5},t),Y.iwedgeCollisionMesh.position.y=.75,Y.iwedgeCollisionMesh.bakeCurrentTransformIntoVertices(),Y.iwedgeCollisionMesh.rotation.x=-Math.PI/4,Y.iwedgeCollisionMesh.bakeTransformIntoVertices(Y.iwedgeCollisionMesh.getWorldMatrix()),Y.iwedgeCollisionMesh.setEnabled(!1),Y.fullCollisionMesh=T.MeshBuilder.CreateBox("",{size:1},t),Y.fullCollisionMesh.setEnabled(!1)},v1:new T.Vector3,v2:new T.Vector3,v3:new T.Vector3,v4:new T.Vector3,v5:new T.Vector3,ray:new T.Ray(T.Vector3.Zero(),T.Vector3.Zero(),1),matrix:new T.Matrix,meshCollidesWithMap:function(t,f){var c={};if(isNaN(f.x)||isNaN(f.y)||isNaN(f.z))return!0;for(var r=t.getBoundingInfo().boundingBox,i=0;i<r.vectors.length;i++){var a=Math.floor(f.x+r.vectors[i].x),n=Math.floor(f.y+r.vectors[i].y),s=Math.floor(f.z+r.vectors[i].z);if(a<0||a>=ye.width||s<0||s>=ye.depth||n<0)return!0;var o=a+n*1e3+s*1e6;if(n<ye.height&&!c[o]){var l=Y.meshCollidesWithCell(t,f,a,n,s);if(l)return l;c[o]=!0}}return!1},meshCollidesWithCell:function(t,f,c,r,i,a){var n=ye.data[c][r][i];if(n.idx){var s=it[n.idx];if(a&&s.softness)return!1;switch(s.colliderType){case"full":return{x:c,y:r,z:i,cell:n,mesh:Y.fullCollisionMesh};case"ladder":if(t.name!="pc")return!1;break;case"none":return!1}t.position.x=f.x-c-.5,t.position.y=f.y-r-.5,t.position.z=f.z-i-.5,Y.v1.set(-t.position.x,-t.position.y,-t.position.z),t.setPivotPoint(Y.v1),t.rotation.x=-n.rx,t.rotation.y=-n.ry,t.rotation.z=-n.rz,t.computeWorldMatrix();var o=n.colliderMesh.intersectsMesh(t,n.colliderPrecise,n.colliderChildren);if(o)return{x:c,y:r,z:i,cell:n,mesh:o}}return!1},rayCollidesWithMap:function(t,f,c){if(isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x<0||t.x>=ye.width||t.z<0||t.z>=ye.depth||t.y<0||t.y>=ye.height)return!1;var r=f.length(),i=Math.floor(t.x),a=Math.floor(t.y),n=Math.floor(t.z),s=f.x,o=f.y,l=f.z,u=Math.sign(s),h=Math.sign(o),d=Math.sign(l),p=Y.intbound(t.x,s),m=Y.intbound(t.y,o),_=Y.intbound(t.z,l),v=u/s,S=h/o,P=d/l;if(s===0&&o===0&&l===0)return!1;for(r/=Math.sqrt(s*s+o*o+l*l);(u>0?i<ye.width:i>=0)&&(h>0?a<ye.height:a>=0)&&(d>0?n<ye.depth:n>=0);){if(!(i<0||a<0||n<0||i>=ye.width||a>=ye.height||n>=ye.depth)){var x=c(t,f,{x:i,y:a,z:n});if(x&&it[x.cell.idx].softness!="verysoft")return x}if(p<m)if(p<_){if(p>r)break;i+=u,p+=v}else{if(_>r)break;n+=d,_+=P}else if(m<_){if(m>r)break;a+=h,m+=S}else{if(_>r)break;n+=d,_+=P}}},intbound:function(t,f){return f<0?Y.intbound(-t,-f):(t=(t%1+1)%1,(1-t)/f)},getCellForRay:function(t){try{var f=ye.data[t.x][t.y][t.z]}catch{console.log(t)}if(!f||!f.mesh)return!1;switch(f.mesh.colliderType){case"none":case"ladder":return!1}return f},projectileCollidesWithCell:function(t,f,c){var r=Y.getCellForRay(c);if(!r||r.mesh.softness)return!1;colliderMesh=r.colliderMesh,Y.matrix.copyFrom(r.colliderMatrix),Y.v4.set(c.x+.5,c.y+.5,c.z+.5),Y.v1.set(t.x,t.y,t.z),Y.v2.copyFrom(f),Y.v1.subtractInPlace(Y.v4),Y.ray.origin.copyFrom(Y.v1),Y.ray.direction.copyFrom(Y.v2),Y.ray.length=1,T.Ray.TransformToRef(Y.ray,Y.matrix,Y.ray);var i=Y.intersectsColliderMesh(colliderMesh,!1);if(colliderMesh=i.pickedMesh,i.hit){if(colliderMesh!=Y.fullCollisionMesh&&(Math.abs(i.pickedPoint.x)>.5||Math.abs(i.pickedPoint.y)>.5||Math.abs(i.pickedPoint.z)>.5)){var a=T.Vector3.DistanceSquared(Y.ray.origin,T.Vector3.Zero()),n=T.Vector3.DistanceSquared(Y.ray.origin,i.pickedPoint);n<a&&(i=Y.ray.intersectsMesh(Y.fullCollisionMesh,!1))}if(i.hit){var s=T.Vector3.TransformCoordinates(i.pickedPoint,Y.matrix.invert());return s.addInPlace(Y.v4),i.pickedPoint=s,{cell:r,pick:i}}}return!1},grenadeCollidesWithCell:function(t,f,c,r){var i=Y.getCellForRay(c);if(!i)return!1;colliderMesh=i.colliderMesh,Y.matrix.copyFrom(i.colliderMatrix),Y.v4.set(c.x+.5,c.y+.5,c.z+.5),Y.v1.set(t.x,t.y,t.z),Y.v2.copyFrom(f);var a=f.length();Y.v2.normalize().scaleInPlace(10),Y.v1.subtractInPlace(Y.v4),Y.ray.origin.copyFrom(Y.v1),Y.ray.direction.copyFrom(Y.v2),Y.ray.length=1,T.Ray.TransformToRef(Y.ray,Y.matrix,Y.ray);var n=Y.intersectsColliderMesh(colliderMesh,!1);if(colliderMesh=n.pickedMesh,n.hit){var s=T.Vector3.Distance(Y.ray.origin,n.pickedPoint);if(s<=a){Y.matrix.invert();var o=T.Vector3.TransformCoordinates(n.pickedPoint,Y.matrix);o.addInPlace(Y.v4),n.pickedPoint=o;var l=T.Vector3.TransformCoordinates(n.normal,Y.matrix),u=T.Vector3.Dot(f,l);return{cell:i,pick:n,normal:l,dot:u}}else{if(!n.insideMesh)return!1;var l=n.normal,n=Y.ray.intersectsMesh(Y.fullCollisionMesh,!1);if(n.hit){Y.matrix.invert();var o=T.Vector3.TransformCoordinates(n.pickedPoint,Y.matrix);o.addInPlace(Y.v4),n.pickedPoint=o;var l=n.getNormal(!0,!1);l=T.Vector3.TransformCoordinates(l,Y.matrix);var u=T.Vector3.Dot(f,l);return{cell:i,pick:n,normal:l,dot:u}}}}return!1},intersectsColliderMesh:function(t,f){var c=1e5,r=Y.ray.intersectsMesh(t,f),i=0,a=null,n=!1;if(r.hit){a=r.getNormal(!0,!1);var s=T.Vector3.Dot(Y.ray.direction,a);s>0&&(n=!0),c=T.Vector3.DistanceSquared(Y.ray.origin,r.pickedPoint)}for(var o=t.getChildMeshes(),l=0;l<o.length;l++){var u=Y.ray.intersectsMesh(o[l],f);if(u.hit){var h=T.Vector3.DistanceSquared(Y.ray.origin,u.pickedPoint),d=u.getNormal(!0,!1),s=T.Vector3.Dot(Y.ray.direction,d);s>0&&(n=!0),h<c&&(c=h,r=u,a=d,s>0&&(n=!0))}}return r.normal=a,r.insideMesh=n,r},rayCollidesWithPlayer:function(t,f,c,r){for(var i=c?c.player.team:null,a=c?c.player.id:null,n=0;n<playerLimit;n++){var s=pe[n];if(s&&(s.playing||s.pauseTargetTime>0)&&s.id!=a&&(s.team==0||s.team!=i)){if(Y.ray.origin.copyFrom(t),Y.ray.direction.copyFrom(f),Y.ray.length=1,c.actor)var o=Y.rayCollidesWithPlayerHelper(Y.ray,s,r);else{var l=c.player.serverStateIdx,u=Math.diff(serverStateIdx,l,Dt);u>15&&(l=Math.mod(serverStateIdx-15,Dt));var o=Y.rayCollidesWithPlayerHelper(Y.ray,s.stateBuffer[l],r)}o&&c&&c.collidesWithPlayer(s,o)}}return!1},rayCollidesWithPlayerHelper:function(t,f,c){var r=t.origin,i=c||.3,a=Y.v1;a.copyFrom(r).addInPlace(t.direction);var n=Y.v5;n.set(f.x,f.y+.32,f.z);var s=Y.v2;s.copyFrom(t.origin),s.subtractInPlace(n);var o=T.Vector3.Dot(t.direction,t.direction),l=2*T.Vector3.Dot(t.direction,s),u=T.Vector3.Dot(s,s)-i*i,h=Math.pow(l,2)-4*o*u,d=Y.v3,p=Y.v4;if(h<0)return!1;if(h==0)return T.Vector3.LerpToRef(r,a,h,d),d.subtractToRef(n,p),p.normalize(),p;var m=(-l-Math.sqrt(h))/(2*o),_=(-l+Math.sqrt(h))/(2*o);return m>=0&&m<=1?(T.Vector3.LerpToRef(r,a,m,d),d.subtractToRef(n,p),p.normalize(),p):!1}},We=class t{static init(){t.bvh=new hn}static pointCollidesWithStructure(f){var c=t.box;c.minimumWorld.copyFrom(f),c.maximumWorld.copyFrom(f);let r=!1;return t.bvh.getObjects(c,i=>{t.pointCollidesWithBox(f,i)&&(r=!0)}),r}static pointCollidesWithBox(f,c){var r=t.v3,i=t.mtx2;return r.copyFrom(f),r.subtractInPlace(c.position),c.matrix.invertToRef(i),T.Vector3.TransformNormalToRef(r,i,r),r.x>=c.minimumWorld.x&&r.x<=c.maximumWorld.x&&r.y>=c.minimumWorld.y&&r.y<=c.maximumWorld.y&&r.z>=c.minimumWorld.z&&r.z<=c.maximumWorld.z}static sphereCollidesWithStructure(f,c,r,i){var a=t.box,n=t.v1,s=t.v2;a.minimumWorld.copyFrom(f),a.minimumWorld.x-=c,a.minimumWorld.y-=c,a.minimumWorld.z-=c,a.maximumWorld.copyFrom(f),a.maximumWorld.x+=c,a.maximumWorld.y+=c,a.maximumWorld.z+=c,r.copyFromFloats(0,0,0);var o=0,l=!1;return t.bvh.getObjects(a,u=>{t.sphereCollidesWithBox(f,c,u,n,s)&&(s.y<-.707&&(n.y=n.length(),n.x=0,n.z=0),n.length()>r.length()&&(r.copyFrom(n),i.copyFrom(s),l=u),o++)}),o>0?l:!1}static sphereCollidesWithBox(f,c,r,i,a){var n=t.v3,s=t.v4,o=t.mtx2;n.copyFrom(f),n.subtractInPlace(r.position),r.matrix.invertToRef(o),T.Vector3.TransformNormalToRef(n,o,n),T.Vector3.ClampToRef(n,r.minimumWorld,r.maximumWorld,s);var l=T.Vector3.Distance(n,s);if(l<c){s.subtractInPlace(n),T.Vector3.TransformNormalToRef(s,r.matrix,s),s.addInPlace(f),s.subtractInPlace(r.position),T.Vector3.ClampToRef(s,t.vmin,t.vmax,s),s.addInPlace(r.position);var l=T.Vector3.Distance(f,s);if(s.subtractInPlace(f).normalize(),c*=Math.abs(s.y)*.16+.84,l<c)return a.copyFrom(s),s.scaleInPlace(l-c-.001),i.copyFrom(s),!0}return!1}static add(f){t.bvh.add(f)}};We.v1=new T.Vector3;We.v2=new T.Vector3;We.v3=new T.Vector3;We.v4=new T.Vector3;We.v5=new T.Vector3;We.v6=new T.Vector3;We.v7=new T.Vector3;We.mtx1=new T.Matrix;We.mtx2=new T.Matrix;We.vmin=new T.Vector3(-.5,-.5,-.5);We.vmax=new T.Vector3(.5,.5,.5);We.box=new T.BoundingBox(T.Vector3.Zero(),T.Vector3.Zero());We.Type={full:1,wedge:2,iwedge:4,aabb:8,obb:16,ladder:32};We.aabbMask=We.Type.full|We.Type.aabb|We.Type.ladder;function ct(t){this.dmgTypeId=dt.findIndex(f=>f.name==="Grenade"),this.scene=t,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.ttl=0,this.resting=!1,this.active=!1,this.player=null,typeof Ii<"u"&&(this.actor=new Ii(this))}ct.v1=new T.Vector3;ct.v2=new T.Vector3;ct.v3=new T.Vector3;ct.v4=new T.Vector3;ct.matrix=new T.Matrix;ct.prototype.update=function(){if(this.ttl<=0){if(this.remove(),!this.actor){var t=Ce.getBuffer();t.packInt8(he.explode),t.packInt8(se.Grenade),t.packInt16(this.player.grenadeItem?this.player.grenadeItem.id:16e3),t.packFloat(this.x),t.packFloat(this.y),t.packFloat(this.z),t.packInt8(this.damage),t.packFloat(this.radius),sendToAll(t),checkExplosionCollisions(this)}return}if(!this.resting){var f=this.dx,c=this.dy,r=this.dz,i=.5*(this.dx+f),a=.5*(this.dy+c),n=.5*(this.dz+r),s=Math.length3(i,a,n);this.collidesWithMap()||(this.x+=i,this.y+=a,this.z+=n,this.dy-=.012),this.dx*=.96,this.dz*=.96}this.ttl-=1};ct.prototype.remove=function(){Zt.grenadePool.recycle(this),this.actor&&this.actor.remove()};ct.prototype.collidesWithMap=function(){ct.v1.set(this.x,this.y-.07,this.z),ct.v2.set(this.dx,this.dy,this.dz),ct.v3.set(this.dx,this.dy,this.dz);var t=Y.rayCollidesWithMap(ct.v1,ct.v2,Y.grenadeCollidesWithCell);if(t)if(t.normal.y==1&&ct.v3.length()<.05)this.resting=!0;else return ct.v3.subtractInPlace(t.normal.scale(1.6*t.dot)),this.dx=ct.v3.x*.98,this.dy=ct.v3.y,this.dz=ct.v3.z*.98,this.actor&&this.actor.bounce(),t;return!1};ct.prototype.throw=function(t,f,c){this.player=t,this.x=f.x,this.y=f.y,this.z=f.z,this.dx=c.x,this.dy=c.y,this.dz=c.z,this.ttl=75,this.damage=150,this.radius=3,this.resting=!1,this.active=!0,this.actor&&this.actor.throw()};var Xt=class{constructor(f){this.dmgTypeId=0,this.player=f,this.scene=this.player.scene,this.highPrecision=!1,this.equipTime=13,this.stowWeaponTime=13,this.accuracy=this.constructor.accuracyMax,this.shootingAccuracy=this.constructor.accuracyMax,this.movementAccuracy=this.constructor.accuracyMax,this.accuracyMax=this.constructor.accuracyMax,this.accuracyMin=this.constructor.accuracyMin,this.accuracyLoss=this.constructor.accuracyLoss,this.accuracyRecover=this.constructor.accuracyRecover,this.tracer=0,this.burstQueue=0,this.adsMod=this.constructor.adsMod||.5,this.movementAccuracyMod=this.constructor.movementAccuracyMod||1}update(){this.burstQueue>0&&(this.burstQueue%this.constructor.burstRof==0&&this.fire(),this.burstQueue--),this.player.scope&&this.player.scopeDelay===0?this.accuracyMod=this.adsMod:this.accuracyMod=1;let f=Math.length2(this.player.dx,this.player.dz)*14.41,c=Math.min(1,Math.abs(this.player.dy)*14.41),r=this.constructor.reloadBloom&&this.player.reloadCountdown>0||this.player.swapWeaponCountdown>0||this.player.grenadeCountdown>0,i=this.player.scope&&this.player.scopeDelay===0,n=(f+c+(r?1:0))*this.constructor.accuracyMin;this.movementAccuracy<n?this.movementAccuracy=n:this.movementAccuracy=Math.max(this.movementAccuracy-this.constructor.accuracyRecover,n),i?(this.accuracyMax=this.constructor.accuracyMax*this.adsMod,this.accuracyMin=this.constructor.accuracyMin*this.adsMod,this.accuracyLoss=this.constructor.accuracyLoss*this.adsMod):(this.accuracyMax=this.constructor.accuracyMax,this.accuracyMin=this.constructor.accuracyMin,this.accuracyLoss=this.constructor.accuracyLoss),this.accuracyRecover=Math.min(this.accuracyRecover+this.constructor.accuracyRecover,this.constructor.accuracyRecover);let s=Math.max(this.accuracyRecover,0);this.shootingAccuracy=Math.max(this.shootingAccuracy-s,this.accuracyMax),this.accuracy=this.movementAccuracy*this.movementAccuracyMod+this.shootingAccuracy,this.constructor.absoluteMinAccuracy&&(this.accuracy=Math.min(this.accuracy,this.constructor.absoluteMinAccuracy))}collectAmmo(){return this.actor?(this.ammo.store=Math.min(this.ammo.storeMax,this.ammo.store+this.ammo.pickup),!0):this.ammo.store<this.ammo.storeMax?(this.ammo.store=Math.min(this.ammo.storeMax,this.ammo.store+this.ammo.pickup),!0):!1}fire(){var f=T.Matrix.RotationYawPitchRoll(this.player.yaw,this.player.pitch,0),c=T.Matrix.Translation(0,0,this.constructor.range),r=c.multiply(f),a=r.getTranslation();this.shootingAccuracy=Math.min(this.shootingAccuracy+this.accuracyLoss,this.accuracyMin),this.accuracyRecover=-this.constructor.accuracyRecover*8;let i=this.accuracy;if(isNaN(i)&&(i=0),this.constructor.burst&&this.burstQueue<=0&&(this.burstQueue=(this.constructor.burst-1)*this.constructor.burstRof),this.constructor!==Oe){let l=i,u=T.Matrix.RotationYawPitchRoll((this.player.randomGen.getFloat()-.5)*l,(this.player.randomGen.getFloat()-.5)*l,(this.player.randomGen.getFloat()-.5)*l);r=r.multiply(u)}var a=r.getTranslation(),n=T.Matrix.Translation(0,.1,0);n=n.multiply(f),n=n.add(T.Matrix.Translation(this.player.x,this.player.y+.3,this.player.z));var s=n.getTranslation();if(s.x=Math.floor(s.x*256)/256,s.y=Math.floor(s.y*256)/256,s.z=Math.floor(s.z*256)/256,a.x=Math.floor(a.x*256)/256,a.y=Math.floor(a.y*256)/256,a.z=Math.floor(a.z*256)/256,this.ammo.rounds--,this.actor){this.player.id==ue&&hi(),this.actor.fire(),this.fireMunitions(s,a),--this.tracer<0&&(this.tracer=this.constructor.tracer);return}var o=Ce.getBuffer();o.packInt8(he.fire),o.packInt8(this.player.id),o.packFloat(s.x),o.packFloat(s.y),o.packFloat(s.z),o.packFloat(a.x),o.packFloat(a.y),o.packFloat(a.z),sendToAll(o),this.fireMunitions(s,a)}equip(f){this.player.weaponIdx=this.player.equipWeaponIdx,this.player.weapon=this.player.weapons[this.player.weaponIdx],this.player.weapon.actor.equip(f),this.player.id==ue&&hi(),this.player.lastWeaponChange=0}};Xt.reloadBloom=!0;Xt.reloadTimeMod=1;var ht=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:30,capacity:30,reload:30,store:240,storeMax:240,pickup:30},this.longReloadTime=205,this.shortReloadTime=160,typeof fa<"u"&&(this.actor=new fa(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};ht.dmgTypeId=dt.findIndex(t=>t.name==="Eggk47");ht.weaponName="EggK-47";ht.standardMeshName="eggk47";ht.rof=3;ht.recoil=7;ht.automatic=!0;ht.damage=20;ht.totalDamage=20;ht.range=20;ht.velocity=1.5;ht.tracer=1;var Oe=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:2,capacity:2,reload:2,store:24,storeMax:24,pickup:8},this.longReloadTime=155,this.shortReloadTime=155,this.v1=new T.Vector3,typeof da<"u"&&(this.actor=new da(this,c))}fireMunitions(f,c){for(var r=this.accuracy,i=r*.6,a=0;a<20;a++)this.v1.set(c.x+this.player.randomGen.getFloat(-r,r)*t.range,c.y+this.player.randomGen.getFloat(-i,i)*t.range,c.z+this.player.randomGen.getFloat(-r,r)*t.range),Ae.fire(this.player,f,this.v1,t)}};Oe.dmgTypeId=dt.findIndex(t=>t.name==="Scrambler");Oe.weaponName="Dozen Gauge";Oe.standardMeshName="dozenGauge";Oe.rof=8;Oe.recoil=10;Oe.automatic=!1;Oe.damage=8;Oe.totalDamage=Oe.damage*20;Oe.range=8;Oe.velocity=1;Oe.tracer=0;var ft=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:15,capacity:15,reload:15,store:60,storeMax:60,pickup:15},this.hasScope=!0,this.longReloadTime=225,this.shortReloadTime=165,this.highPrecision=!0,typeof pa<"u"&&(this.actor=new pa(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};ft.dmgTypeId=dt.findIndex(t=>t.name==="FreeRanger");ft.weaponName="CSG-1";ft.standardMeshName="csg1";ft.rof=13;ft.recoil=13;ft.automatic=!1;ft.damage=110;ft.totalDamage=110;ft.range=50;ft.velocity=1.75;ft.tracer=0;var $e=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:15,capacity:15,reload:15,store:60,storeMax:60,pickup:15},this.longReloadTime=195,this.shortReloadTime=160,typeof ma<"u"&&(this.actor=new ma(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};$e.dmgTypeId=dt.findIndex(t=>t.name==="Cluck9mm");$e.weaponName="Cluck 9mm";$e.standardMeshName="cluck9mm";$e.rof=4;$e.recoil=6;$e.automatic=!1;$e.damage=25;$e.totalDamage=25;$e.range=15;$e.velocity=1;$e.tracer=0;var Je=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:1,capacity:1,reload:1,store:3,storeMax:3,pickup:1},this.hasScope=!0,this.longReloadTime=170,this.shortReloadTime=170,typeof _a<"u"&&(this.actor=new _a(this,c))}fireMunitions(f,c){if(Ct.fire(this.player,f,c,t),this.actor)for(var r=10,i=.4,a=0;a<10;a++){var n=Math.random()*.04-.02,s=Math.random()*.04-.02,o=Math.random()*.04-.02;ur(Bt,r,f.x,f.y,f.z,n,s,o,i,!1,0)}}};Je.dmgTypeId=dt.findIndex(t=>t.name==="Rpegg");Je.weaponName="RPEGG";Je.standardMeshName="rpegg";Je.rof=40;Je.recoil=60;Je.automatic=!1;Je.damage=140;Je.radius=2.75;Je.totalDamage=Je.damage*Je.radius*.5;Je.range=45;Je.minRange=3;Je.velocity=.4;var Be=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:40,capacity:40,reload:40,store:200,storeMax:200,pickup:40},this.longReloadTime=225,this.shortReloadTime=190,typeof va<"u"&&(this.actor=new va(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};Be.dmgTypeId=dt.findIndex(t=>t.name==="Whipper");Be.weaponName="SMEGG";Be.standardMeshName="smg";Be.rof=2;Be.recoil=7;Be.automatic=!0;Be.damage=15;Be.totalDamage=15;Be.range=20;Be.velocity=1.25;Be.tracer=2;var Ke=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:1,capacity:1,reload:1,store:20,storeMax:20,pickup:4},this.hasScope=!0,this.longReloadTime=144,this.shortReloadTime=144,typeof ya<"u"&&(this.actor=new ya(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};Ke.dmgTypeId=dt.findIndex(t=>t.name==="Crackshot");Ke.weaponName="M2DZ";Ke.standardMeshName="m24";Ke.rof=15;Ke.recoil=20;Ke.automatic=!1;Ke.damage=200;Ke.totalDamage=15;Ke.range=60;Ke.velocity=2;Ke.tracer=0;var Xe=class t extends Xt{constructor(f,c){super(f),this.ammo={rounds:24,capacity:24,reload:24,store:150,storeMax:150,pickup:24},this.longReloadTime=205,this.shortReloadTime=160,typeof ba<"u"&&(this.actor=new ba(this,c))}fireMunitions(f,c){Ae.fire(this.player,f,c,t)}};Xe.dmgTypeId=dt.findIndex(t=>t.name==="TriHard");Xe.weaponName="TriHard";Xe.standardMeshName="aug";Xe.rof=15;Xe.recoil=18;Xe.automatic=!1;Xe.movementInstability=2;Xe.damage=20;Xe.totalDamage=20;Xe.range=20;Xe.velocity=1.5;Xe.tracer=0;Xe.burst=3;Xe.burstRof=1800/600;ht.damage=30;ht.accuracyMax=.03;ht.accuracyMin=.15;ht.accuracyLoss=.05;ht.accuracyRecover=.025;ht.totalDamage=30;Oe.damage=8.5;Oe.accuracyMax=.14;Oe.accuracyMin=.17;Oe.accuracyLoss=.17;Oe.accuracyRecover=.02;Oe.totalDamage=170;Oe.adsMod=.6;Oe.movementAccuracyMod=.2;ft.damage=105;ft.accuracyMax=.004;ft.accuracyMin=.3;ft.accuracyLoss=.3;ft.accuracyRecover=.025;ft.totalDamage=105;Je.accuracyMax=.015;Je.accuracyMin=.3;Je.accuracyLoss=.3;Je.accuracyRecover=.02;Je.absoluteMinAccuracy=.3;Be.damage=23;Be.accuracyMax=.06;Be.accuracyMin=.19;Be.accuracyLoss=.045;Be.accuracyRecover=.05;Be.totalDamage=23;Be.adsMod=.6;Be.movementAccuracyMod=.7;Ke.damage=170;Ke.accuracyMax=0;Ke.accuracyMin=.35;Ke.accuracyLoss=.1;Ke.accuracyRecover=.023;Ke.totalDamage=170;Ke.movementAccuracyMod=.85;Ke.reloadBloom=!1;Ke.reloadTimeMod=.8;$e.damage=26;$e.accuracyMax=.035;$e.accuracyMin=.15;$e.accuracyLoss=.09;$e.accuracyRecover=.08;$e.totalDamage=26;$e.adsMod=.8;$e.movementAccuracyMod=.6;Xe.damage=35;Xe.accuracyMax=.03;Xe.accuracyMin=.15;Xe.accuracyLoss=.04;Xe.accuracyRecover=.03;Xe.totalDamage=34;Xe.adsMod=.6;Xe.movementAccuracyMod=.8;var zi=[{filename:"aqueduct",hash:"28jf33x9icp",name:"Aqueduct",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"backstage",hash:"2f16w9cv0h5",name:"Backstage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"bastion",hash:"1baur79xgrl",name:"Bastion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"bedrock",hash:"18o959dayxu",name:"Bedrock",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"biohazard",hash:"rku63oicl",name:"BioHazard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"blender",hash:"1m4xadroj52",name:"Blender",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"blue",hash:"1vjawasrx92",name:"Blue",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"bridge",hash:"yhwrty2kdb",name:"Bridge",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"cash",hash:"109a8eqfsv",name:"Cash",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"castle",hash:"1ohl8pdid1j",name:"Castle",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"12"},{filename:"castleArena",hash:"10fqurvpovc",name:"Castle Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"8"},{filename:"catacombs",hash:"26lvz7mtm7c",name:"Catacombs",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"chickenItza",hash:"d61y2ixtkw",name:"Chicken Itza",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"cluckgrounds",hash:"11zqosithhn",name:"Cluckgrounds",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"16"},{filename:"crowsnest",hash:"19mwnq2te9r",name:"Crowsnest",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"8"},{filename:"deathpit",hash:"1b0r2blywas",name:"Death Pit",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"dirt",hash:"1ett2uygvbj",name:"Dirt",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirt2",hash:"ezol41g8ub",name:"Dirt 2",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"dirtbase",hash:"1tuuh5gfnef",name:"Dirt Base",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"downfall",hash:"xo8wjszh6w",name:"Downfall",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"18"},{filename:"duelPyramidLG",hash:"1newvge07p5",name:"Duel Pyramid Low-Grav",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"eggcrates",hash:"25340eipbpz",name:"Eggcrates",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"6"},{filename:"enchanted",hash:"pflyna5tq5",name:"Enchanted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"exposure",hash:"umpd4wdao3",name:"Exposure",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"feedlot",hash:"1c6rortschf",name:"Feedlot",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"field",hash:"13pwzx5f1md",name:"Field",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"fortFlip",hash:"1d6f8ucy19b",name:"Fort Flip",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"fourQuarters",hash:"1e0dogzazf9",name:"Four Quarters",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"10"},{filename:"growler",hash:"2jf082miup",name:"Growler",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"haunted",hash:"3ygypcx8ew",name:"Haunted",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"16"},{filename:"helix",hash:"1aqp7c8qnlt",name:"Helix",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"jailbreak",hash:"g01fcj8gxy",name:"Jail Break",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"jinx",hash:"277lyg65e23",name:"Jinx",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"junction",hash:"68j04g1gq8",name:"Junction",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"kingsCourt",hash:"h6bc14b784",name:"King's Court",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mansion",hash:"26pk2qwx443",name:"Mansion",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"moonbase",hash:"16dcamopmmt",name:"Moonbase",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"mudGulch",hash:"r1edeqyltw",name:"Mud Gulch",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"outer",hash:"2d3t2xcj40e",name:"Outer Reach",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"overcooked",hash:"25mleaa2j5o",name:"Overcooked",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"palaceSiege",hash:"aevymuxzca",name:"Palace Siege",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"14"},{filename:"quarry",hash:"ld2kssz0bu",name:"Quarry",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"raceway",hash:"zo3cplgmyn",name:"Raceway",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"rameses",hash:"ml96x9mcob",name:"Rameses",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"16"},{filename:"rats",hash:"1vwa2o0pbsk",name:"Rats",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"rivals",hash:"113nhmlw9w7",name:"Rivals",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"road",hash:"yhb8yxjk4o",name:"Road",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"14"},{filename:"ruins",hash:"1vjenhltpg2",name:"Ruins",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"scales",hash:"1lcm4phbzei",name:"Scales",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"shellville",hash:"alpo4cn3zq",name:"Shellville",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"16"},{filename:"shipyard",hash:"19avbwnpbg9",name:"Shipyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"skyScratcher",hash:"1xfilhzsds3",name:"Sky Scratcher",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spaceFactory",hash:"2agr2lfddck",name:"Space Factory",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"10"},{filename:"spacearena",hash:"241xmvj0ufg",name:"Space Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"14"},{filename:"sparta",hash:"s4i0hsy8ga",name:"Sparta",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"spellbound",hash:"182fexvavx9",name:"Spellbound",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"stage",hash:"1nwt3fllppr",name:"Stage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"staxarena",hash:"19t57lht2nr",name:"Stax Arena",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"teggtris",hash:"uumhnkbjux",name:"Teggtris",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"temple",hash:"1i5f45tlan5",name:"Temple",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"both",numPlayers:"18"},{filename:"timetwist",hash:"3q5gis7qeh",name:"Timetwist",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"trainyard",hash:"smve6npq9w",name:"Trainyard",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"treefort",hash:"1smqjmht64q",name:"Tree Fort",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!1},availability:"private",numPlayers:"6"},{filename:"twoTowers",hash:"9qzxjqr1d7",name:"Two Towers",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"both",numPlayers:"18"},{filename:"vert",hash:"16mujvanfck",name:"Vert",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"12"},{filename:"wimble",hash:"jmjb04b954",name:"Wimble",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"},{filename:"wreckage",hash:"1u7p7s6mepg",name:"Wreckage",modes:{FFA:!0,Teams:!0,Spatula:!0,King:!0},availability:"private",numPlayers:"18"}];Math.PI2=Math.PI*2;Math.PI90=Math.PI/2;Math.mod=function(t,f){var c=t%f;return c>=0?c:c+f};Math.length2=function(t,f){return Math.sqrt(Math.pow(t,2)+Math.pow(f,2))};Math.length3=function(t,f,c){return Math.sqrt(Math.pow(t,2)+Math.pow(f,2)+Math.pow(c,2))};Math.capVector2=function(t,f){var c=Math.length2(t.x,t.y);return c>f&&(t.x*=f/c,t.y*=f/c),t};Math.capVector3=function(t,f){var c=Math.length3(t.x,t.y,t.z);return c>f&&(t.x*=f/c,t.y*=f/c,t.z*=f/c),t};Math.normalize2=function(t,f){f=f||1;var c=Math.length2(t.x,t.y);return t.x*=f/c,t.y*=f/c,t};Math.normalize3=function(t,f){f=f||1;var c=Math.length3(t.x,t.y,t.z);return t.x*=f/c,t.y*=f/c,t.z*=f/c,t};Math.clamp=function(t,f,c){return Math.max(Math.min(t,c),f)};Math.radAdd=function(t,f){return Math.floor(Math.mod(t+f,Math.PI2)*8192)/8192};Math.radSub=function(t,f){return Math.floor(Math.mod(t-f,Math.PI2)*8192)/8192};Math.radRange=function(t){return Math.mod(t,Math.PI2)};Math.radDifference=function(t,f){var c=(t-f+Math.PI)%Math.PI2-Math.PI;return c=c<-Math.PI?c+Math.PI2:c,c};Math.cardVals=[0,Math.PI90,Math.PI,Math.PI90*3];Math.cardToRad=function(t){return Math.cardVals[t]};Math.randomInt=function(t,f){return Math.floor(Math.random()*(f-t)+t)};Math.diff=function(t,f,c){return t<f?c-t+f:t-f};function Ma(){this.seed=100}Ma.prototype.setSeed=function(t){this.seed=t};Ma.prototype.getFloat=function(t,f){t=t||0,f=f||1,this.seed=(this.seed*9301+49297)%233280;var c=this.seed/233280;return t+c*(f-t)};Ma.prototype.getInt=function(t,f){return Math.floor(this.getFloat(t,f))};var Ki={linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return t<.5?2*t*t:-1+(4-2*t)*t},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},lr=class t{constructor(f){this.player=f,this.scene=this.player.scene,this.collisionCountdown=0,this.dmgTypeId=dt.findIndex(c=>c.name==="Melee"),f.actor&&(this.actor=new Fn(this,this.player.meleeItem.item_data.meshName)),this.dir=new T.Vector3}attack(){this.collisionCountdown=5}checkCollisions(){var f=T.Matrix.RotationYawPitchRoll(this.player.yaw,this.player.pitch,0),c=T.Matrix.Translation(0,0,.8),r=c.multiply(f);this.dir=r.getTranslation(),t.v1.set(this.player.x-this.dir.x*.25,this.player.y-this.dir.y*.25+.3,this.player.z-this.dir.z*.25),Y.rayCollidesWithPlayer(t.v1,this.dir,this,.475)}collidesWithPlayer(f){let c=40;this.player.activeShellStreaks&je.EggBreaker&&(c=255),ua(f,this,c,this.dir.x,this.dir.z)}update(){this.collisionCountdown>0&&--this.collisionCountdown===0&&this.checkCollisions()}};lr.v1=new T.Vector3;lr.v2=new T.Vector3;function fr(t){this.bulletPool=new qt(function(){return new Ae(t)},200),this.rocketPool=new qt(function(){return new Ct(t)},20),this.grenadePool=new qt(function(){return new ct(t)},10)}fr.prototype.updateLogic=function(){this.bulletPool.forEachActive(function(t){t.update()}),this.rocketPool.forEachActive(function(t){t.update()}),this.grenadePool.forEachActive(function(t){t.update()})};fr.prototype.updateActors=function(t){this.bulletPool.forEachActive(function(f){f.actor.update(t)}),this.rocketPool.forEachActive(function(f){f.actor.update(t)}),this.grenadePool.forEachActive(function(f){f.actor.update(t)})};fr.prototype.removeAll=function(){this.bulletPool.forEachActive(function(t){t.remove()}),this.rocketPool.forEachActive(function(t){t.remove()}),this.grenadePool.forEachActive(function(t){t.remove()})};fr.prototype.throwGrenade=function(t,f,c){var r=this.grenadePool.retrieve();r.throw(t,f,c)};fr.prototype.getMapIntersectionPoint=function(t,f){if(f&&!it[f.cell.idx].softness&&f.cell&&f.cell.idx){var c=it[f.cell.idx],r=new T.Ray(new T.Vector3(t.x-t.dx-f.x-.5,t.y-t.dy-f.y-.5,t.z-t.dz-f.z-.5),new T.Vector3(t.dx*2,t.dy*2,t.dz*2),1);c.rotation.x=f.cell.rx,c.rotation.y=f.cell.ry,c.rotation.z=f.cell.rz;var i=r.intersectsMesh(c,!1);if(i.hit){var a=new T.Vector3(-t.dx,-t.dy,-t.dz).normalize().scale(.005);return{x:i.pickedPoint.x+f.x+.5+a.x,y:i.pickedPoint.y+f.y+.5+a.y,z:i.pickedPoint.z+f.z+.5+a.z}}}return!1};var Le={up:1,down:2,left:4,right:8,jump:16,fire:32,melee:64,scope:128,ascend:256,descend:512};O.classes=[{name:"Soldier",weapon:ht},{name:"Scrambler",weapon:Oe},{name:"Free Ranger",weapon:ft},{name:"Eggsploder",weapon:Je},{name:"Whipper",weapon:Be},{name:"Crackshot",weapon:Ke},{name:"TriHard",weapon:Xe}];var Dt=256;function fe(t,f){this.id=t.id,this.uniqueId=t.uniqueId,this.name=t.name,this.normalName=t.normalName,this.safeName=t.safeName,this.charClass=t.charClass,this.team=t.team,this.primaryWeaponItem=t.primaryWeaponItem,this.secondaryWeaponItem=t.secondaryWeaponItem,this.shellColor=t.shellColor,this.hatItem=t.hatItem,this.stampItem=t.stampItem,this.grenadeItem=t.grenadeItem,this.meleeItem=t.meleeItem,this.x=t.x,this.y=t.y,this.z=t.z,this.dx=t.dx,this.dy=t.dy,this.dz=t.dz,this.controlKeys=t.controlKeys,this.yaw=t.yaw,this.pitch=t.pitch,this.speed=0,this.scope=!1,this.scopeDelay=0,this.score=t.score,this.totalKills=0,this.totalDeaths=0,this.bestGameStreak=t.bestGameStreak,this.bestOverallStreak=t.bestOverallStreak,this.stats={streak:t.stats.streak,kills:t.stats.kills,killsCluck9mm:t.stats.killsCluck9mm,killsGrenade:t.stats.killsGrenade,killsRpegg:t.stats.killsRpegg,killsEggk47:t.stats.killsEggk47,killsScrambler:t.stats.killsScrambler,killsFreeRanger:t.stats.killsFreeRanger,killsWhipper:t.stats.killsWhipper,killsCrackshot:t.stats.killsCrackshot,killsTriHard:t.stats.killsTriHard,killsMelee:t.stats.killsMelee,killsPrivate:t.stats.killsPrivate,killsPublic:t.stats.killsPublic,killsKing:t.stats.killsKing,killsSpatula:t.stats.killsSpatula,killsTeams:t.stats.killsTeams,killsFFA:t.stats.killsFFA,deaths:t.stats.deaths,deathsCluck9mm:t.stats.deathsCluck9mm,deathsGrenade:t.stats.deathsGrenade,deathsRpegg:t.stats.deathsRpegg,deathsEggk47:t.stats.deathsEggk47,deathsScrambler:t.stats.deathsScrambler,deathsFreeRanger:t.stats.deathsFreeRanger,deathsWhipper:t.stats.deathsWhipper,deathsCrackshot:t.stats.deathsCrackshot,deathsTriHard:t.stats.deathsTriHard,deathsMelee:t.stats.deathsMelee,deathsPrivate:t.stats.deathsPrivate,deathsPublic:t.stats.deathsPublic,deathsKing:t.stats.deathsKing,deathsSpatula:t.stats.deathsSpatula,deathsTeams:t.stats.deathsTeams,deathsFFA:t.stats.deathsFFA,kotcCaptured:t.stats.kotcCaptured,kotcWins:t.stats.kotcWins},this.gameData=t.gameData,this.shield=t.shield,this.hp=t.hp,this.playing=t.playing,this.weaponIdx=t.weaponIdx,this.upgradeProductId=t.upgradeProductId,this.mobileMultiplier=1,this.isGameOwner=t.isGameOwner,this.capturing=!1,this.activeShellStreaks=t.activeShellStreaks,this.adminRoles=t.adminRoles,this.muted=t.muted,this.scene=f,this.corrected={dx:0,dy:0,dz:0,pitch:0,yaw:0},this.corrections=0,this.totalCorrections=2,this.resetCountdowns(),this.equipWeaponIdx=this.weaponIdx,this.grenadeCount=1,this.grenadeCapacity=3,this.lastWeaponChange=0,this.jumpQueued=0,this.jumping=!1,this.onGround=4,this.climbing=!1,this.bobble=0,this.hardBoiledValue=0,this.eggBreakerValue=0,this.stateIdx=0,this.clientStateIdx=0,this.serverStateIdx=0,this.respawnTargetTime=0,this.pauseTargetTime=0,this.ready=!1,this.chatLineCap=3,this.respawnQueued=!1,this.canTakeTeamBonus=!0,this.lastDamageTakenType=0,this.lastDamageGivenType=0,this.lastDmgType=0,this.damageMod=t.damageMod,this.abBucket=t.abBucket,typeof Me<"u"&&(this.actor=new Me(this)),this.changeWeaponLoadout(this.primaryWeaponItem,this.secondaryWeaponItem),this.stateBuffer=[],this.resetStateBuffer(),this.randomGen=new Ma,this.social=t.social,this.hideBadge=t.hideBadge}fe.v1=new T.Vector3;fe.v2=new T.Vector3;fe.v3=new T.Vector3;fe.v4=new T.Vector3;fe.v5=new T.Vector2;fe.v6=new T.Vector2;fe.v7=new T.Vector3;fe.v8=new T.Vector3;fe.ray=new T.Ray;fe.matrix=new T.Matrix;fe.prototype.changeWeaponLoadout=function(t,f){this.actor&&this.weapons&&(this.weapons[0].actor.dispose(),this.weapons[1].actor.dispose(),this.meleeWeapon.actor.dispose()),this.meleeWeapon=new lr(this),this.primaryWeaponItem=t,this.secondaryWeaponItem=f,this.weapons=[t.instantiateNew(this),f.instantiateNew(this)],this.weapon=this.weapons[this.weaponIdx],this.actor&&this.weapon.actor.equip()};fe.prototype.update=function(t){var f=0,c=0,r=0;if(!t&&this.actor&&this.id==ue&&(this.controlKeys=Ue),!this.actor||this.id!=ue){var i=this.stateIdx;this.actor&&(i=Math.min(i,Vt-1)),this.controlKeys=this.stateBuffer[i].controlKeys,this.yaw=this.stateBuffer[i].yaw,this.pitch=this.stateBuffer[i].pitch,this.stateBuffer[i].controlKeys=0}var a=this.stateBuffer[this.stateIdx];if(this.actor)a.controlKeys=this.controlKeys,a.yaw=this.yaw,a.pitch=this.pitch;else{this.shotsQueued+=a.shots,a.shots=0;var i=Math.mod(this.stateIdx+1,Dt);this.stateBuffer[i].yaw=this.yaw,this.stateBuffer[i].pitch=this.pitch}this.controlKeys&Le.left&&(f-=Math.cos(this.yaw),r+=Math.sin(this.yaw)),this.controlKeys&Le.right&&(f+=Math.cos(this.yaw),r-=Math.sin(this.yaw)),this.controlKeys&Le.up&&(this.climbing?c+=1:(f+=Math.sin(this.yaw),r+=Math.cos(this.yaw))),this.controlKeys&Le.down&&(this.climbing?c-=1:(f-=Math.sin(this.yaw),r-=Math.cos(this.yaw))),this.controlKeys&Le.jump&&(this.jumpQueued=10,this.controlKeys^=this.controlKeys&Le.jump,this.actor&&this.id==ue&&(Ue^=Ue&Le.jump)),this.controlKeys&Le.scope?this.scope||this.scopeIn():this.scope&&this.scopeOut(),this.jumpQueued>0&&(this.jumpQueued--,this.jump());let n=this.scope&&this.scopeDelay===0;if(this.climbing){this.setJumping(!1);var s=this.dy;this.corrections&&(s+=this.corrected.dy/this.totalCorrections,this.corrections--),this.dy+=c*.028;var o=.5*(this.dy+s);this.y+=o,this.dy*=.5,Math.floor(this.y)>=ye.height&&(this.climbing=!1),this.move(0,o,0)}else{var l=new T.Vector3(f,c,r).normalize();n&&(l.x*=.5,l.z*=.5),this.dx+=l.x*.025,this.dz+=l.z*.025,this.dy-=.012,this.dy=Math.max(-.29,this.dy);var u=fe.v4;if(u.copyFromFloats(this.x,this.y,this.z),this.move(this.dx,this.dy,this.dz),this.dx=this.x-u.x,this.dy=this.y-u.y,this.dz=this.z-u.z,this.onGround&&this.dy>0){var h=1-fe.v7.copyFromFloats(this.dx,this.dy,this.dz).normalize().y*.5;this.dx*=h,this.dz*=h}!t&&this.corrections&&(s=0,pdx=this.corrected.dx/this.totalCorrections,this.climbing&&(s=this.corrected.dy/this.totalCorrections),pdz=this.corrected.dz/this.totalCorrections,this.corrections--,this.move(pdx,s,pdz))}if(!t){this.shield>0&&this.playing&&(this.shield-=2,(f!=0||c!=0||this.shield<=0)&&this.disableShield()),this.scopeDelay=Math.max(0,this.scopeDelay-1),this.lastWeaponChange++;var d=Math.max(0,Math.length3(this.dx,this.dy,this.dz)-.012);if(this.speed=d,(this.climbing||this.jumping)&&(d*=2),this.bobble=(this.bobble+(d+.01)*7)%Math.PI2,this.weapon&&this.weapon.update(),this.meleeWeapon.update(),this.meleeCountdown>0&&--this.meleeCountdown===0&&(this.swapWeaponCountdown=this.weapon.equipTime*.5,this.actor&&(this.actor.wieldGun(),this.id===q&&Ie.show())),this.hp>0&&(this.hp=Math.min(100,this.hp+.1)),this.swapWeaponCountdown>0&&(this.swapWeaponCountdown--,this.swapWeaponCountdown<=0&&(this.actor?this.id==ue&&Ie.show():(this.swapWeaponCountdown=0,this.weaponIdx=this.equipWeaponIdx,this.weapon=this.weapons[this.weaponIdx]))),this.reloadCountdown>0&&(this.lastWeaponChange=0,this.reloadCountdown-=2,this.reloadCountdown<=0&&(this.reloadCountdown=0,this.reloaded())),this.rofCountdown>0&&(this.rofCountdown=Math.max(this.rofCountdown-1,0)),this.recoilCountdown>0&&(this.recoilCountdown=Math.max(this.recoilCountdown-2,0)),this.grenadeCountdown>0&&(this.grenadeCountdown-=2,this.grenadeCountdown<=0&&this.grenadesQueued>0&&!this.actor&&this.throwGrenade()),this.actor){if(this.id==ue){this.triggerPulled&&this.fire(),this.activeShellStreaks&je.EggBreaker&&(this.eggBreakerValue=Math.max(0,this.eggBreakerValue-1));var p=Math.floor(this.eggBreakerValue/30),m=document.getElementById("eggBreakerTimer");p!=parseInt(m.innerText)&&(m.innerText=p)}}else if(this.shotsQueued>0?(this.lastActivity=cr,this.fire()):this.meleeQueued>0&&(this.lastActivity=cr,this.melee()&&this.meleeQueued--),this.activeShellStreaks&je.EggBreaker&&--this.eggBreakerValue<=0){this.endShellStreak(je.EggBreaker);var _=Ce.getBuffer();_.packInt8(he.endShellStreak),_.packInt8(this.id),_.packInt8(je.EggBreaker),sendToAll(_)}this.stateIdx=Math.mod(this.stateIdx+1,Dt);var a=this.stateBuffer[this.stateIdx];this.saveState(a),this.actor&&we&&this.id==ue&&q.stateIdx%Vt==0&&we.readyState==we.OPEN&&q.playing&&!Ci&&jc()}this.dx*=.64,this.dz*=.64,this.climbing&&(this.dy*=.64),(!this.actor||this.id!=ue)&&(this.reloadsQueued>0&&this.reload(),this.weaponSwapsQueued>0&&this.swapWeapon(this.equipWeaponIdx))};fe.prototype.saveState=function(t){t.x=this.x,t.y=this.y,t.z=this.z,t.dx=this.dx,t.dy=this.dy,t.dz=this.dz,t.jumping=this.jumping,t.climbing=this.climbing,t.weaponIdx=this.weaponIdx,t.rounds=this.weapon.ammo.rounds,t.store=this.weapon.ammo.store};fe.prototype.move=function(t,f,c){var r=fe.v1,i=fe.v8,a=fe.v2,n=fe.v3,s;this.onGround=Math.max(--this.onGround,0),this.y+=.31,i.copyFromFloats(t,f,c),Math.capVector3(i,.29),r.copyFromFloats(this.x,this.y,this.z),r.addInPlace(i),r.x=Math.clamp(r.x,.1,ye.width-.1),r.z=Math.clamp(r.z,.1,ye.depth-.1);for(var o=0;o<8;o++){var l=We.sphereCollidesWithStructure(r,.31,a,n);if(l)n.y<-.707&&(this.onGround=4),this.climbing||l.colliderType&We.Type.ladder&&this.tryToClimbLadder(l,n),r.addInPlace(a),this.onGround&&(this.jumping?(this.setJumping(!1),this.dy=0):this.controlKeys&Le.down&&(this.climbing=!1));else break}if(o==8&&(i.scaleInPlace(.9),r.subtractInPlace(i)),this.x=r.x,this.y=r.y,this.z=r.z,this.climbing&&(!this.actor||this.id==ue)){var u=this.climbX,h=this.climbZ;this.climbing=!1,this.capturing=!1,s=gr(u,Math.floor(this.y-.25),h),s&&Math.floor(s.ry/Math.PI90)==this.climbRY&&s.mesh&&s.mesh.colliderType=="ladder"&&(this.climbing=!0),s=gr(u,Math.floor(this.y+.25),h),s&&Math.floor(s.ry/Math.PI90)==this.climbRY&&s.mesh&&s.mesh.colliderType=="ladder"&&(this.climbing=!0)}else{var u=Math.floor(this.x),d=Math.floor(this.y),h=Math.floor(this.z);if(this.playing&&(s=gr(u,d,h),s)){var p=s.zone;p?this.actor||(this.capturing=p):this.capturing=!1}s=gr(u,Math.floor(this.y-.5),h),s&&(mesh=s.mesh,mesh&&mesh.shortName=="jump-pad"&&this.canJump()&&Math.length2(u+.5-this.x,h+.5-this.z)<.3&&(this.y+=.26,this.setJumping(!0)))}this.y-=.31};fe.prototype.tryToClimbLadder=function(t,f){if(this.controlKeys&Le.up&&!(Math.abs(t.position.y-(this.y+.18))>.9)){var c=Math.round(this.yaw/Math.PI90)%4,r=t.cell.ry;if(!(c!=r&&(c+2)%4!=r)){var i=fe.v5.set(f.x,f.z).normalize(),a=fe.v6.set(Math.cos(this.yaw),-Math.sin(this.yaw)),n=T.Vector2.Dot(a,i);Math.abs(n)<.4&&(this.climbing=!0,this.climbX=Math.clamp(Math.floor(t.position.x),0,ye.width-1),this.climbZ=Math.clamp(Math.floor(t.position.z),0,ye.depth-1),this.climbRY=t.cell.ry,this.dy=0,this.setJumping(!1))}}};fe.prototype.scopeIn=function(){this.isAtReady()&&(this.weapon.actor&&this.weapon.actor.restPose(),this.scope=!0,this.scopeDelay=7)};fe.prototype.scopeOut=function(){this.scope=!1};fe.prototype.disableShield=function(){this.shield=0,this.actor&&(this.actor.bodyMesh.renderOverlay=!1,this.actor.hands.renderOverlay=!1)};fe.prototype.enableShield=function(){this.shield=120,this.actor&&(this.actor.bodyMesh.overlayColor=fe.OverlayColor.green,this.actor.hands.overlayColor=fe.OverlayColor.green,this.actor.bodyMesh.renderOverlay=!0,this.actor.hands.renderOverlay=!0)};fe.prototype.resetStateBuffer=function(){for(var t=0;t<Dt;t++)this.stateBuffer[t]={yaw:this.yaw,pitch:this.pitch,fire:!1,jumping:this.jumping,climbing:this.climbing,x:this.x,y:this.y,z:this.z,dx:this.dx,dy:this.dy,dz:this.dz,controlKeys:this.controlKeys,shots:0,rounds:[0,0],store:[0,0]}};fe.prototype.canJump=function(){var t=this.climbing|this.onGround;return t};fe.prototype.jump=function(){this.climbing&&(this.dy=.065,this.climbing=!1,this.setJumping(!0)),this.canJump()&&(this.dy=.13,this.scope&&this.scopeDelay===0&&(this.dy*=.66),this.setJumping(!0))};fe.prototype.setJumping=function(t){this.jumpQueued=!1,this.onGround=0,this.jumping=t,this.stateBuffer[this.stateIdx].jumping=t};fe.prototype.changeCharacter=function(t,f,c,r,i,a,n,s){var o=function(u,h){return u&&!h||!u&&h||u!==null&&h!==null&&u.id!==h.id};if(t!==this.charClass||f.id!==this.primaryWeaponItem.id||c.id!==this.secondaryWeaponItem.id||r!==this.shellColor||o(this.hatItem,i)||o(this.stampItem,a)||this.grenadeItem!==n||this.meleeItem!==s){if(this.charClass=t,this.primaryWeaponItem=f,this.secondaryWeaponItem=c,this.shellColor=r,this.hatItem=i,this.stampItem=a,this.grenadeItem=n,this.meleeItem=s,this.actor)this.actor.setShellColor(r),this.id==ue||(this.actor.wearHat(this.hatItem),this.actor.applyStamp(this.stampItem));else{var l=Ce.getBuffer();l.packInt8(he.changeCharacter),l.packInt8(this.id),l.packInt8(t),l.packInt16(this.primaryWeaponItem.id),l.packInt16(this.secondaryWeaponItem.id),l.packInt8(r),l.packInt16(this.hatItem?this.hatItem.id:0),l.packInt16(this.stampItem?this.stampItem.id:0),l.packInt16(this.grenadeItem?this.grenadeItem.id:16e3),l.packInt16(this.meleeItem?this.meleeItem.id:15e3),sendToOthers(l,this.id)}this.changeWeaponLoadout(f,c)}};fe.prototype.swapWeapon=function(t){if(this.actor&&this.id!=ue||this.canSwapOrReload()&&t<2){if(this.equipWeaponIdx=t,this.releaseTrigger(),this.swapWeaponCountdown=this.weapon.stowWeaponTime+this.weapons[t].equipTime,this.actor){if(this.id==ue&&Ie.hide(),this.actor.wieldingMelee=!1,this.weapon.actor.stow(),this.id==ue){var f=Ce.getBuffer();f.packInt8(he.swapWeapon),f.packInt8(t),f.send(we)}}else{this.shotsQueued=0,this.swapWeaponCountdown*=.9,this.weaponSwapsQueued--;var f=Ce.getBuffer();f.packInt8(he.swapWeapon),f.packInt8(this.id),f.packInt8(t),sendToOthers(f,this.id)}return!0}return!1};fe.prototype.collectItem=function(t,f){switch(t){case Pt.AMMO:return this.weapons[f].collectAmmo()?(this.actor&&(qe.play("pickup",this.actor.bodyMesh.absolutePosition,this.id==ue),hi()),!0):!1;case Pt.GRENADE:return this.grenadeCount<this.grenadeCapacity?(this.grenadeCount++,this.actor&&(qe.play("pickup",this.actor.bodyMesh.absolutePosition,this.id==ue),hi()),!0):!1}};fe.prototype.isAtReady=function(){return!!(this.playing&&this.weapon&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0&&this.meleeCountdown<=0&&(!this.actor||At==!1))};fe.prototype.canMelee=function(){return!!(this.playing&&this.weapon&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&(this.actor||this.grenadeCountdown<=0)&&this.shotsQueued<=0)};fe.prototype.canSwapOrReload=function(){return!!(this.playing&&this.weapon&&this.recoilCountdown<=0&&this.reloadCountdown<=0&&this.swapWeaponCountdown<=0&&this.grenadeCountdown<=0&&this.shotsQueued<=0&&this.meleeQueued<=0&&(!this.actor||At==!1))};fe.prototype.fire=function(){this.shield>0?this.releaseTrigger():this.isAtReady()&&this.rofCountdown<=0&&(this.weapon.ammo.rounds>0?(this.recoilCountdown=this.weapon.constructor.recoil,this.rofCountdown=this.weapon.constructor.rof,this.actor?this.actor.fire():(this.recoilCountdown-=this.recoilCountdown*.1+2,this.rofCountdown-=this.rofCountdown*.1+1,this.shotsQueued--),this.weapon.fire(),this.actor&&this.id==ue&&(this.stateBuffer[this.stateIdx].shots++,this.lastWeaponChange=0),this.weapon.constructor.automatic==!1&&this.releaseTrigger()):(this.shotsQueued=0,this.weapon.actor&&(this.weapon.actor.dryFire(),this.releaseTrigger())))};fe.prototype.pullTrigger=function(){if(At==!0&&q.grenadeCountdown<=0)this.cancelGrenade();else if(this.isAtReady()&&this.rofCountdown<=0)return this.weapon.ammo.rounds>0?(this.triggerPulled=!0,this.fire()):this.weapon.ammo.store>0?this.reload():this.weapon.actor.dryFire(),!0;return!1};fe.prototype.releaseTrigger=function(){this.triggerPulled=!1,this.weapon.tracer=0};fe.prototype.melee=function(){if(this.actor&&At==!0&&q.grenadeCountdown<=0&&this.cancelGrenade(),this.shield>0||!this.canMelee())return!1;if(this.meleeCountdown=17,this.recoilCountdown=40,this.actor){this.id===ue&&Ie.hide(),this.actor.melee();var t=Ce.getBuffer();t.packInt8(he.melee),t.send(we)}else{var t=Ce.getBuffer();t.packInt8(he.melee),t.packInt8(this.id),sendToOthers(t,this.id)}return this.meleeWeapon.attack(),!0};fe.prototype.reload=function(){if(this.actor&&this.id!=ue){this.weapon.actor.reload();return}if(this.weapon.ammo.rounds==this.weapon.ammo.capacity||this.weapon.ammo.store==0||!this.canSwapOrReload())return!1;var t=Math.min(Math.min(this.weapon.ammo.capacity,this.weapon.ammo.reload)-this.weapon.ammo.rounds,this.weapon.ammo.store);if(this.roundsToReload=t,this.scopeOut(),this.actor){this.id===ue&&Ie.hide(),this.weapon.actor.reload(),this.actor.wieldingMelee&&this.actor.wieldGun(),this.releaseTrigger();var f=Ce.getBuffer();f.packInt8(he.reload),f.send(we)}else{var f=Ce.getBuffer();f.packInt8(he.reload),f.packInt8(this.id),sendToOthers(f,this.id),this.reloadsQueued--,this.shotsQueued=0}return this.weapon.ammo.rounds==0?this.reloadCountdown=this.weapon.longReloadTime:this.reloadCountdown=this.weapon.shortReloadTime,!0};fe.prototype.reloaded=function(){var t=this.weapon.ammo;t.rounds+=this.roundsToReload,t.store-=this.roundsToReload,this.actor&&this.id==ue&&(Ie.show(),hi())};fe.prototype.queueGrenade=function(t){this.grenadeCountdown>0||(this.grenadesQueued++,this.grenadeThrowPower=Math.clamp(t,0,1),this.grenadeCountdown=20,this.actor||(this.grenadeCountdown*=.9))};fe.prototype.cancelGrenade=function(){At=!1,q.grenadeCountdown=30,this.id==ue&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.actor&&(this.actor.gripBone._frozen=!1)};fe.prototype.throwGrenade=function(){if(this.shield>0&&this.disableShield(),this.actor){var s=Ce.getBuffer();s.packInt8(he.throwGrenade),s.packFloat(Math.clamp(Gi,0,1)),s.send(we),q.grenadeCountdown=80,this.actor.reachForGrenade()}else if(this.isAtReady()&&this.grenadeCount>0){this.grenadeCount--,this.grenadesQueued--,this.grenadeCountdown=1;var t=T.Matrix.RotationYawPitchRoll(this.yaw,this.pitch,0),f=T.Matrix.Translation(0,.1,1),c=f.multiply(t),r=c.getTranslation(),i=T.Matrix.Translation(0,-.05,.2);i=i.multiply(t),i=i.add(T.Matrix.Translation(this.x,this.y+.3,this.z));var a=i.getTranslation(),n=this.grenadeThrowPower*.26+.16;r.x*=n,r.y*=n,r.z*=n,a.x=Math.floor(a.x*256)/256,a.y=Math.floor(a.y*256)/256,a.z=Math.floor(a.z*256)/256,r.x=Math.floor(r.x*256)/256,r.y=Math.floor(r.y*256)/256,r.z=Math.floor(r.z*256)/256;var s=Ce.getBuffer();s.packInt8(he.throwGrenade),s.packInt8(this.id),s.packFloat(a.x),s.packFloat(a.y),s.packFloat(a.z),s.packFloat(r.x),s.packFloat(r.y),s.packFloat(r.z),sendToAll(s),Zt.throwGrenade(this,a,r)}};fe.prototype.removeFromPlay=function(){this.playing=!1,this.controlKeys=0,this.jumping=!1,this.jumpQueued=0,this.scope=!1,this.climbing=!1,this.hardBoiledValue=0,this.eggBreakerValue=0,this.activeShellStreaks=0,this.pauseTargetTime=0,this.lastDmgType=0,this.meleeWeapon.collisionCountdown=0,this.actor&&(this.actor.removeFromPlay(),this.id==ue&&fo())};fe.prototype.setStats=function(t){let f=this.gameData.private?"Private":"Public";this.stats[t+f]++;let c=t+Xa[this.gameData.gameType].shortName;this.stats[c]++;let r=t+dt[this.lastDmgType].name;t!=="deaths"&&(r=t+dt[this.lastDamageGivenType].name),this.stats[r]++};fe.prototype.resetStats=function(){return Object.keys(this.stats).forEach(t=>{if(t!="streak")return this.stats[t]=0})};fe.prototype.scoreKill=function(){if(this.stats.kills++,this.totalKills++,this.stats.streak++,this.bestGameStreak=Math.max(this.bestGameStreak,this.stats.streak),this.bestOverallStreak=Math.max(this.bestOverallStreak,this.stats.streak),this.setStats("kills"),this.lastDmgType=0,this.score=this.stats.streak,this.activeShellStreaks&je.EggBreaker&&(this.eggBreakerValue=Math.min(this.eggBreakerValue+90,450)),!this.actor){var t=0;if(this.stats.streak>0)switch(this.stats.streak){case 5:t=je.HardBoiled;break;case 10:t=je.EggBreaker;break}if(t){this.beginShellStreak(t);var f=Ce.getBuffer();f.packInt8(he.beginShellStreak),f.packInt8(this.id),f.packInt8(t),sendToAll(f)}}};fe.prototype.kotcStatScoreCapture=function(){this.stats.kotcCaptured++};fe.prototype.kotcStatScoreWin=function(){this.stats.kotcWins++};fe.prototype.die=function(){this.score=0,this.stats.streak=0,this.stats.deaths++,this.totalDeaths++,this.setStats("deaths"),this.lastDmgType=0,this.hp=0,this.removeFromPlay()};fe.prototype.beginShellStreak=function(t){switch(this.activeShellStreaks|=t,t){case je.HardBoiled:this.hardBoiledValue=100;break;case je.EggBreaker:this.eggBreakerValue=450;break}this.actor&&(this.actor.beginShellStreak(t),qe.play("shellstreak_start",this.actor.mesh.position,!0))};fe.prototype.endShellStreak=function(t){switch(this.activeShellStreaks^=this.activeShellStreaks&t,t){case je.HardBoiled:this.hardBoiledValue=0;break}this.actor&&(this.actor.endShellStreak(t),qe.play("shellstreak_end",this.actor.mesh.position,!0))};fe.prototype.respawn=function(t,f,c){this.yaw=Math.floor(Math.random()*Math.PI2*8192)/8192,this.pitch=0,this.x=t,this.y=f,this.z=c,this.dx=0,this.dy=0,this.dz=0,this.respawnQueued=!1,this.playing=!0,this.onGround=4,this.climbing=!1,this.jumping=!1,this.controlKeys=0,this.capturing=!1,this.weapons[0].burstQueue=0,this.hp<=0?(this.hp=100,this.resetWeaponState()):this.resetWeaponState(!0),this.actor&&(this.id==ue&&(Wt=ue),this.corrections=0,this.actor.resetLerp(),this.actor.restoreToPlay(),this.weapon.equip(),this.id==Wt&&(yt=0,Ie.show(),Ie.showDot(),hi())),this.enableShield(),this.resetStateBuffer()};fe.prototype.resetWeaponState=function(t){if(t=!1,this.resetCountdowns(),this.releaseTrigger(),this.weaponIdx=0,this.equipWeaponIdx=0,this.weapon=this.weapons[0],this.actor&&(this.weapons[0].actor.gunMesh.setEnabled(!1),this.weapons[1].actor.gunMesh.setEnabled(!1)),!t){for(var f=0;f<this.weapons.length;f++)this.weapons[f]&&(this.weapons[f].ammo.rounds=this.weapons[f].ammo.capacity,this.weapons[f].ammo.store=this.weapons[f].ammo.storeMax);this.grenadeCount=Math.max(this.grenadeCount,1)}var c=this.weapons[0];c.burstQueue=0,c.constructor.burst&&(c.ammo.rounds=Math.ceil(c.ammo.rounds/c.constructor.burst)*c.constructor.burst,c.ammo.store=Math.ceil(c.ammo.store/c.constructor.burst)*c.constructor.burst)};fe.prototype.isDead=function(){return this.hp<=0};fe.prototype.resetCountdowns=function(){this.rofCountdown=0,this.triggerPulled=!1,this.shotsQueued=0,this.meleeQueued=0,this.meleeCountdown=0,this.roundsToReload=0,this.recoilCountdown=0,this.reloadCountdown=0,this.reloadsQueued=0,this.swapWeaponCountdown=0,this.weaponSwapsQueued=0,this.grenadeCountdown=0,this.grenadesQueued=0};try{Ns=Ml("fs"),Ft=void 0}catch{Ft=window.Loader}var Ns,Ft;Ft===void 0&&(Ft={addTask:()=>{},progress:()=>{},finish:()=>{}});var Ft,it,ps=!1;function Ba(t,f,c){var r=T.MeshBuilder.CreateBox(t,{size:1},f),i=new T.StandardMaterial;return i.diffuseColor=c,i.emissiveColor=c,i.specularColor=T.Color3.Black(),i.wireframe=!0,r.material=i,r.setEnabled(!1),r}function $l(t,f){it=[null],it.push(Ba("SPECIAL.barrier.full.verysoft",t,T.Color3.Red())),it.push(Ba("SPECIAL.barrier.full",t,T.Color3.Green())),it.push(Ba("SPECIAL.barrier.none",t,T.Color3.White()));for(var c=[],r=0;r<=1;r+=.125){var i=-Math.PI/2+Math.PI*r,a=Math.cos(i),n=Math.sin(i+.05)*.5+.5;a=Math.pow(a,1.3)*.25,n=Math.pow(n,1.3)*.6-.48,c.push(new T.Vector3(a,n,0))}var s=T.MeshBuilder.CreateLathe("SPECIAL.spawn-blue.none",{shape:c,tessellation:12},t),o=new T.StandardMaterial;o.diffuseColor=new T.Color3(0,.5,1),o.specularColor=new T.Color3(.1,.2,.4),o.specularPower=8,s.material=o,s.setEnabled(!1),it.push(s);var s=T.MeshBuilder.CreateLathe("SPECIAL.spawn-red.none",{shape:c,tessellation:12},t),o=new T.StandardMaterial;o.diffuseColor=new T.Color3(1,.25,.25),o.specularColor=new T.Color3(.4,.3,.3),o.specularPower=8,s.material=o,s.setEnabled(!1),it.push(s),js(t,["map"],function(l){if(l.parent){l.freezeWorldMatrix();return}it.push(l)},function(){for(var l=1;l<it.length;l++){var u=it[l].getChildMeshes()[0];u&&(it[l].colliderMesh=u)}f()})}function Bl(t,f){js(t,["egg","gun_eggk47","gun_csg1","gun_cluck9mm","gun_dozenGauge","gun_rpegg","gun_smg","gun_m24","gun_aug","munitions","muzzleFlash","items","reticle","melee"],null,f)}function Yl(t){BAWK.load("sound/sounds.json?"+Ot).then(()=>t())}function Ca(t){var f;if(f=new T.StandardMaterial("bullet",t),f.emissiveColor=new T.Color3(1,1,1),xt){var c=["#define RECEIVESHADOWS"];O.engineCaps.textureFloat&&c.push("#define SHADOWFULLFLOAT")}else var c=[];if(c.push("#define MAP"),f=new T.ShaderMaterial("map",t,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:c}),xt){f.setTexture("shadowSampler",xt.getShadowMapForRendering()),f.setMatrix("shadowLightMat",xt.getTransformMatrix());var r=xt.getShadowMap();r!==null&&f.setVector3("shadowParams",xt.getDarkness(),r.getSize().width,xt.bias)}f.onBind=function(i){var a=i.material.getEffect();a.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),a.setColor3("vFogColor",t.fogColor)},f=new T.ShaderMaterial("mapNoShadow",t,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor"],defines:["#define MAP"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor)},f=new T.ShaderMaterial("standard",t,"standard",{attributes:["position","normal","color","uv",T.VertexBuffer.MatricesIndicesKind,T.VertexBuffer.MatricesWeightsKind],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","colorMult","sunDirection","sunColor"],defines:["#define COLORMULT"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();if(a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor),a.setColor3("colorMult",i.colorMult||T.Color3.White()),a.setFloat3("sunDirection",n.sunLight.direction.x,n.sunLight.direction.y,n.sunLight.direction.z),a.setFloat3("sunColor",n.sunLight.diffuse.r,n.sunLight.diffuse.g,n.sunLight.diffuse.b),i.useBones&&i.computeBonesUsingShaders&&i.skeleton){var s=i.skeleton.getTransformMatrices(i);s&&a&&a.setMatrices("mBones",s)}},f=new T.ShaderMaterial("standardInstanced",t,"standard",{attributes:["position","normal","color","uv","world0","world1","world2","world3"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","sunDirection","sunColor"],defines:["#define INSTANCES"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor),a.setFloat3("sunDirection",n.sunLight.direction.x,n.sunLight.direction.y,n.sunLight.direction.z),a.setFloat3("sunColor",n.sunLight.diffuse.r,n.sunLight.diffuse.g,n.sunLight.diffuse.b)},f=new T.ShaderMaterial("eggShell",t,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","hp","cameraPosition","outlineColor","colorMult","stampOffset","sunDirection","sunColor"],defines:["#define EGGSHELL"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor),a.setFloat("hp",i.player.hp/100),a.setColor3("colorMult",i.colorMult||T.Color3.White()),a.setFloat3("cameraPosition",n.activeCamera.globalPosition.x,n.activeCamera.globalPosition.y,n.activeCamera.globalPosition.z),a.setColor4("outlineColor",i.outlineColor,i.outlineColor.a),a.setFloat2("stampOffset",i.stampU,i.stampV),a.setFloat3("sunDirection",n.sunLight.direction.x,n.sunLight.direction.y,n.sunLight.direction.z),a.setFloat3("sunColor",n.sunLight.diffuse.r,n.sunLight.diffuse.g,n.sunLight.diffuse.b)},f=new T.ShaderMaterial("emissive",t,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","emissiveColor","sunDirection","sunColor"],defines:["#define FLASH"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor),a.setColor3("emissiveColor",i.emissiveColor||T.Color3.Black()),a.setFloat3("sunDirection",n.sunLight.direction.x,n.sunLight.direction.y,n.sunLight.direction.z),a.setFloat3("sunColor",n.sunLight.diffuse.r,n.sunLight.diffuse.g,n.sunLight.diffuse.b)},f=new T.ShaderMaterial("colorized",t,"standard",{attributes:["position","normal","color","uv"],uniforms:["world","view","viewProjection","vFogInfos","vFogColor","colorMult"],defines:["#define COLORIZE","#define MAP"]}),f.onBind=function(i){var a=i.material.getEffect(),n=i.getScene();a.setFloat4("vFogInfos",n.fogMode,n.fogStart,n.fogEnd,n.fogDensity),a.setColor3("vFogColor",n.fogColor),a.setColor3("colorMult",i.colorMult||T.Color3.Black())},f=new T.StandardMaterial("wireframe",t),f.wireframe=!0,f=new T.StandardMaterial("normalBackface",t),f.diffuseColor=new T.Color3(.5,.5,.5),f.ambientColor=new T.Color3(.5,.5,.5),f.specularColor=new T.Color3(0,0,0),f.backFaceCulling=!1,f.twoSidedLighting=!0,f=new T.StandardMaterial("muzzleFlash",t),f.emissiveColor=T.Color3.White(),f=new T.StandardMaterial("ui",t),f.disableLighting=!0,f.emissiveColor=T.Color3.White(),f.fogEnabled=!1}function js(t,f,c,r){for(var i=f.length,a=this,n=t.getMaterialByName("standard"),s=0,o=0,l=0;l<i;l++){var u="models/",h=f[l]+".babylon";if(typeof window>"u"){var d=Ns.readFileSync(h,"utf8");d=d.replace(/\r?\n|\r/g,""),h="data:"+d,u=""}let p=Ft.addTask();T.SceneLoader.ImportMesh("",u,h,t,function(m,_,v){try{for(var S=0;S<m.length;S++){var P=m[S];P.name=="egg"&&s++,P.name=="hands"&&o++,!ps&&(s>1||o>1)&&(ps=!0,alert("Duplicate egg and/or hand models detected in "+h+`.

Open the weapon models in Blender and make sure egg/hands layers are turned off, then re-export.`)),P.setMaterial&&P.setMaterial(n),P.setEnabled(!1),P.isPickable=!1,c&&c(P)}i--,i==0&&r&&r.call(a)}catch(x){console.log(x)}Ft.finish(p)},function(m){p=Ft.progress(p,m.loaded,m.total)})}}var fn,ec=[];function tc(t){We.init(),ye={width:Re.width,height:Re.height+1,depth:Re.depth,surfaceArea:Re.surfaceArea},ye.data=ic(ye.width,ye.height,ye.depth),fn=0;for(var f={},c=1;c<it.length;c++){var r=it[c];f[r.name]=c}var i={};typeof window>"u"&&(spawnPoints=[[],[],[]]),Object.keys(Re.data).forEach(function(n){var s=Re.data[n],o=f[n],l=it[o];if(!o)i[n]=!0;else{var u=n.split(".");if(l.theme=u[0],l.shortName=u[1],l.colliderType=u[2],l.softness=u[3],typeof window>"u"&&l.theme=="SPECIAL"){if(l.shortName.startsWith("spawn")){for(let P of s)spawnPoints[0].push({x:P.x,y:P.y,z:P.z}),l.shortName=="spawn-blue"?spawnPoints[Wa.blue].push({x:P.x,y:P.y,z:P.z}):spawnPoints[Wa.red].push({x:P.x,y:P.y,z:P.z});return}else if(l.shortName=="spatula"){for(let P of s)spatulaSpawnPoints.push({x:P.x+.5,y:P.y+.1,z:P.z+.5});return}}var h,d,p;switch(l.colliderType){case"full":h=Y.fullCollisionMesh,d=!1,p=!1;break;case"wedge":h=Y.wedgeCollisionMesh,d=!0,p=!1;break;case"iwedge":h=Y.iwedgeCollisionMesh,d=!0,p=!1;break;case"ladder":h=l.colliderMesh,d=!1,p=!1;break;case"aabb":h=l.colliderMesh,d=!1,p=!0;break;case"obb":h=l.colliderMesh,d=!0,p=!0;break}for(let P of s){P.ry===void 0&&(P.ry=0);var m=P.rx*Math.PI90||0,_=P.ry*Math.PI90||0,v=P.rz*Math.PI90||0;ye.data[P.x][P.y][P.z]={item:void 0,mesh:l,idx:o,colliderMesh:h,colliderPrecise:d,colliderChildren:p,colliderMatrix:T.Matrix.RotationYawPitchRoll(-_,-m,-v),rx:m,ry:_,rz:v},h&&Ks(h,We.Type[l.colliderType],P)}if(l.shortName=="capture-zone"){for(let P of s)if(!ye.data[P.x][P.y][P.z].zone){P.zone=++fn,ye.data[P.x][P.y][P.z].zone=P.zone,P.y==0&&(console.log("INVALID ZONE",P),ec.push(P.zone));var S;do{S=0;let x=[{x:-1,z:0},{x:1,z:0},{x:0,z:-1},{x:0,z:1}];for(let R of s)if(!ye.data[R.x][R.y][R.z].zone)for(let w of x){let I=gr(R.x+w.x,R.y,R.z+w.z);if(I&&I.zone==P.zone){S++,R.zone=P.zone,ye.data[R.x][R.y][R.z].zone=P.zone;break}}}while(S>0)}}}});var a="";return Object.keys(i).forEach(function(n){a+=n+`
`}),a!=""&&(console.log("buildMapData error",a),t&&t(a)),f}var pr=new T.Vector3,ms=new T.Vector3,Ff=new T.Vector3(.5,.5,.5);function Ks(t,f,c){var r=c.rx*Math.PI90||0,i=c.ry*Math.PI90||0,a=c.rz*Math.PI90||0;ms.copyFrom(t.position),pr.copyFrom(t.rotation),t.unfreezeWorldMatrix(),t.rotation.copyFromFloats(0,0,0),t.computeWorldMatrix();var n=t.getBoundingInfo().boundingBox.minimumWorld.clone(),s=t.getBoundingInfo().boundingBox.maximumWorld.clone(),o=new T.BoundingBox(n,s);o.matrix=T.Matrix.RotationYawPitchRoll(pr.y,pr.x,pr.z),T.Matrix.RotationYawPitchRollToRef(i,r,a,Y.matrix),o.matrix.multiplyToRef(Y.matrix,o.matrix),o.position=new T.Vector3(c.x+.5,c.y+.5,c.z+.5),o.colliderType=f,o.cell=c;var l=new T.BoundingBox(new T.Vector3(c.x,c.y,c.z),new T.Vector3(c.x+1,c.y+1,c.z+1));o.bb=l,We.add(o),t.position.copyFrom(ms),t.rotation.copyFrom(pr),t.computeWorldMatrix(),t.freezeWorldMatrix();for(var u=t.getChildMeshes(),h=0;h<u.length;h++)Ks(u[h],f,c)}function ic(t,f,c,r){for(var i=Array(t),a=0;a<t;a++){i[a]=Array(f);for(var n=0;n<f;n++){i[a][n]=Array(c);for(var s=0;s<c;s++)i[a][n][s]=r||{}}}return i}function gr(t,f,c){return t<0||t>ye.width-1||c<0||c>ye.depth-1||f<0||f>ye.height-1?null:ye.data[t][f][c]}function Ct(t){this.scene=t,this.x=0,this.y=0,this.z=0,this.dx=0,this.dy=0,this.dz=0,this.active=!1,this.player=null,this.damage=150,this.origin=new T.Vector3,this.direction=new T.Vector3,this.end=new T.Vector3,this.dmgTypeId="",typeof ji<"u"&&(this.actor=new ji(this))}Ct.position=new T.Vector3;Ct.fire=function(t,f,c,r){var i=Zt.rocketPool.retrieve();i.fireThis(t,f,c,r)};Ct.prototype.fireThis=function(t,f,c,r){this.x=f.x,this.y=f.y,this.z=f.z,this.origin.set(this.x,this.y,this.z),this.direction.copyFrom(c).normalize().scaleInPlace(r.velocity),this.dx=this.direction.x,this.dy=this.direction.y,this.dz=this.direction.z,this.radius=r.radius,this.player=t,this.weaponClass=r,this.damage=r.damage,this.active=!0,this.range=r.range,this.minRange=r.minRange,this.velocity=r.velocity,this.dmgTypeId=r.dmgTypeId;var i=Y.rayCollidesWithMap(f,c,Y.projectileCollidesWithCell);i&&(this.end.copyFrom(i.pick.pickedPoint),this.range=T.Vector3.Distance(f,i.pick.pickedPoint)),this.actor&&this.actor.fire()};Ct.prototype.remove=function(){Zt.rocketPool.recycle(this),this.actor&&this.actor.remove()};Ct.prototype.update=function(){if(Ct.position.set(this.x,this.y,this.z),this.range<this.velocity&&this.direction.scaleInPlace(this.range/this.velocity),!Y.rayCollidesWithPlayer(Ct.position,this.direction,this)){this.x+=this.dx,this.y+=this.dy,this.z+=this.dz;var t=this.velocity;if(this.range-=t,this.minRange-=t,this.range<=0){this.x-=this.dx,this.y-=this.dy,this.z-=this.dz,this.minRange<=0?this.explode():this.poof();return}}};Ct.prototype.collidesWithPlayer=function(t){this.minRange<=0?(this.actor||ua(t,this,255,St.x,St.z),this.explode()):(this.actor||ua(t,this,10,St.x,St.z),this.poof())};Ct.prototype.explode=function(){if(!this.actor){var t=Ce.getBuffer();t.packInt8(he.explode),t.packInt8(se.Primary),t.packInt16(0),t.packFloat(this.x),t.packFloat(this.y),t.packFloat(this.z),t.packInt8(this.damage),t.packFloat(this.radius),sendToAll(t),checkExplosionCollisions(this)}this.remove()};Ct.prototype.poof=function(){if(this.actor){Ct.position.set(this.x,this.y,this.z),qe.play("gun_rpegg_rocket_poof",Ct.position);for(var t=10,f=.4,c=0;c<10;c++){var r=Math.random()*.2-.1,i=Math.random()*.2-.1,a=Math.random()*.2-.1;ur(Bt,t,this.x,this.y,this.z,r,i,a,f,!1,0)}}this.remove()};function xi(t,f){this.scene=t,this.x=f.x,this.y=f.y,this.z=f.z,this.dy=0,this.controlledBy=255,this.controlledByTeam=255,this.lastControlTeam=255,typeof Sa<"u"&&(this.actor=new Sa(this))}xi.prototype.capture=function(t){if(this.actor&&q.id==t.id){var f=document.getElementById("spatulaPlayer");f.className="capture"}if(t.team!=this.lastControlTeam&&(Ee.teamScore[t.team]=0),this.controlledBy=t.id,this.controlledByTeam=t.team,this.lastControlTeam=t.team,this.actor){BAWK.play("capture_spatula");var f=document.getElementById("teamScoreNum"+t.team);f.innerText=Ee.teamScore[t.team]}else{for(var c=0;c<playerLimit;c++){var r=pe[c];r&&r.team==t.team&&(r.canTakeTeamBonus=!0)}let i=Ce.getBuffer();Ee.packState(i),sendToAll(i)}};xi.prototype.drop=function(){if(this.actor&&q.id==this.controlledBy){var t=document.getElementById("spatulaPlayer");t.className="drop"}var f=pe[this.controlledBy];if(this.controlledBy=255,this.controlledByTeam=255,this.x=f.x,this.y=f.y,this.z=f.z,this.dy=f.dy+.05,this.actor)this.actor.drop();else{for(var c=0;c<playerLimit;c++){var f=pe[c];f&&(f.canTakeTeamBonus=!1)}let r=Ce.getBuffer();Ee.packState(r),sendToAll(r)}};xi.prototype.update=function(){if(this.controlledBy==255){var t=this.dy;this.dy-=.012;var f=.5*(this.dy+t),c=this.y;if(this.y+=f,this.collidesWithMap()&&(this.y=c,this.dy*=-.5),!this.actor)for(var r=0;r<playerLimit;r++){var i=pe[r];if(i&&i.playing&&Math.abs(this.x-i.x)<.35&&Math.abs(this.y-i.y)<.35&&Math.abs(this.z-i.z)<.35){this.capture(i);break}}}else{var i=pe[this.controlledBy];i&&(this.x=i.x-Math.sin(i.yaw)*.3,this.y=i.y,this.z=i.z-Math.cos(i.yaw)*.3)}};xi.v1=new T.Vector3;xi.prototype.collidesWithMap=function(){return xi.v1.set(this.x,this.y,this.z),Y.meshCollidesWithMap(Y.playerCollisionMesh,xi.v1)};function Qs(t){t=" "+t+" ";var f=t.toLowerCase().replace(/[^a-zA-Z0-9|!\|@|$|;|Â¡]/g,"").replace(/6|g/g,"9").replace(/b/g,"6").replace(/\||l|i|1|;|Â¡/g,"!").replace(/e/g,"3").replace(/a|@/g,"4").replace(/o/g,"0").replace(/s|\$/g,"5").replace(/t/g,"7").replace(/z/g,"2").replace(/7h3|my|y0ur|7h3!r|h!5|h3r/g,""),c=f.search(/( 94y | 455 )/);f=f.replace(/ /g,"");var r=/(n421|5chu72574ff3!|n994|m457ur647|m4r!c4|n!qq4|fck|cn7|57urm4673!!un9|!uf7w4ff3|k!4n|66c|n993r|n!443r|n!99r|m4y473|64ch!ch4|64ch!ch3|c474!uf0|fr4nchu7|fr!j0!3r0|9464ch0|94chup!n|m0r0m!3rd4|54!74mur05|pu74|j0d3r|m0n90|c0n0|c4r4j0|m!3rd4|20rr4|chup4m3!|cu!0|p3nd3j0|c46r0n|0r70|pu70|p!r06|qu33f|455h47|ch04d|cum|k0ck|k0ch|pu74|n!94|n3993r|4fr!c4n|kn336r0|5ch00!5h007|n!qq3r|73rr0r!5t|qu33r|d!ck|w4nk|p!55|7357!c|735735|64!!5|nu75|nu72|j3w|k!k3|r374r|4u7!5|d0wn55|6006|8d|p0rn|5w4!!0w|347m3|347my|d!k|0r4!|5p0093|fuk|j!2|5u!c!d|m4573r6|5p0063|5p3rm|p3nu5|pu55y|6u7753x|fux|6u77h0!3|4n4!|4nu5|k!!!b!4ck5|murd3rb!4ck5|h!7!3r|w3764ck|49!n4|94y|455h0!3|5uck|j3w|5p!c|ch!nk|n!994|n!993|n!663|n!994|n!664|5h!7|6!7ch|fuck|cun7|kkk|wh0r3|f49|7w47|p3n!|r4p3w0m|r4p39!r|r4p!57|r4p3r|r4p3|r4p!n|n!93r|!d!07|c0ck|dum6|5!4v3|7!75|@|455|pu5y|ju!cy|nud3|fk|v!49r4|64n9|53x|h03|d473|h473|d47!n9|d473r|h4ck|h4ck3r|h4ck!n9|60yfr!3nd|9!r!fr!3nd|900k|gf|bf|m0nk3y|m0nk!35|d4ddy|5!u7|pr057!7u7|nud3|33m4!!|d!ckh34d|r374rd|n4993r|n0993r|4d0!f|kn339r0w|6umh0!3|c0kk|cuck|!3573r|!5r43!|p4!357!n3|ph!!3|n3994|f4ck|pr3d470r|pn!5|n!95|fr!ck|m0!3573r|n!94rd!y|m0!357|73rr0r!57|5h!4d|60!!0ck5|7r4n5|64!!649|n!9993r|ky5|60yfr!3nd|9!r!fr!3nd|d0uch3|pu55!35)/g,i=f.search(r);f=f.replace(/(.)(?=\1)/g,"");var a=f.search(r);return c>-1||i>-1||a>-1}var dn=class{constructor(){this.kills=0,this.deaths=0,this.suicides=0,this.streak=0,this.weapons={},this.sessionStart=0,this.sessionEnd=0,this.endTime=0,this.playTime=0,this.ratio=0,this.charClass={},this.init()}init(){this.setupWeapons(),this.start()}start(){this.sessionStart=Date.now()}end(){this.endTime=this.getPlayTimeInGame(),this.getPlayTime()}setupWeapons(){dt.forEach(f=>this.weapons[f.name]={deaths:0,kills:0}),Object.keys(vt).forEach(f=>this.charClass[f]=JSON.parse(JSON.stringify(this.weapons))),Object.keys(this.charClass).forEach(f=>{this.charClass[f].kills=0,this.charClass[f].deaths=0}),console.log(this.charClass)}getRatio(){this.ratio=Math.floor(this.kills/Math.max(this.kills+this.deaths,1)*100)}getPlayTime(){this.sessionEnd=Date.now()-this.sessionStart;let f=(this.sessionEnd%6e4/1e3).toFixed(0);this.playTime=Math.floor(this.sessionEnd/6e4)+":"+(f<10?"0":"")+f}getPlayTimeInGame(){if(!this.sessionStart)return"0:00";let f=Date.now()-this.sessionStart,c=(f%6e4/1e3).toFixed(0);return Math.floor(f/6e4)+":"+(c<10?"0":"")+c}updateTerminus(f,c,r,i){this.charClass[f][c][r]++,this.charClass[f][r]++,this.weapons[c][r]++,this[r]++,i&&this.suicides++}getStats(){return{kills:this.kills,deaths:this.deaths,suicides:this.suicides,weapons:this.weapons,charClass:this.charClass,playTime:this.getPlayTimeInGame(),endTime:this.endTime,ratio:this.ratio}}set kills(f){this._kills=f,this.getRatio()}get kills(){return this._kills}set deaths(f){this._deaths=f,this.getRatio()}get deaths(){return this._deaths}};var bi=(t,f)=>{console.log("%c%s","color: white; background: #006700; padding: 2px 6px; border-radius: 3px; margin-right: 5px;","Chick'n Winner",t,f||"")};function rc(){Ui.count<=gi.dailyLimit&&Ui.ready?(Kt.isChwRequest=!0,vueApp.chicknWinnerError(!1),Ui.count===0?(bi("chwTryPlay() First play!"),pn()):Qi(()=>{O.playerAccount.isUpgraded()?(bi("chwTryPlay() VIP. No ads for you! Thank you!"),pn()):(bi("chwTryPlay() No vip. Subscribe today for no video ads!"),Kt.play("shellshock.io_rpreroll_30s"))},t=>{Kt.isChwRequest=!1,ia("chwTryPlay()",t)})):(bi("checkStartChicknWinner not ready"),Ur())}function Ur(){let t=Math.trunc(Date.now()/1e3)+1,f=gi.dailyLimit,c=0;Ui=new ra(t,f,c),bi("checkStartChicknWinner() start"),vc(r=>{bi("checkStartChicknWinner() success");let i=r.limitData;console.log("api_chicknWinnerPlayerRewardCheck data",r.limitData);let a=Math.trunc(Date.now()/1e3);vueApp.chicknWinnerError(!1),Object.keys(i).length>0?(c=i.limit,i.limit<=gi.dailyLimit?(i.hasOwnProperty("span")?t=a+i.span:t=a+1,f=gi.cooldown):(t=a+i.period,f=gi.dailyCooldown)):(t=a+1,f=gi.cooldown),Ui=new ra(t,f,c)},r=>ia("checkStartChicknWinner()",r.error))}function pn(){Kt.isChwRequest?qs(t=>{Kt.isChwRequest=!1;let f=t.result;if(bi(`getIncetivizedReward() response ${f}`),f!=="SUCCESS"){f==="SESSION_EXPIRED"&&ia("getIncetivizedReward",f);return}let c=Ui.count?Ui.count:"free";if(t.reward.itemIds.length>0){let r=O.catalog.findItemById(t.reward.itemIds[0]);O.playerAccount.addToInventory(r,!0),r&&(ga("send","event","Chickn Winner","Reward",`${c} - item`),(t.reward_lvl||t.reward.rewardTier)&&ga("send","event","Chickn Winner","Reward item",`${r.name} - ${t.reward.rewardTier?t.reward.rewardTier:t.reward_lvl}`))}t.reward.eggsGiven&&t.reward.eggsGiven>0&&(ga("send","event","Chickn Winner","Reward",`${c} - ${t.reward.eggsGiven}`),ga("send","event","Chickn Winner","Reward amount",`${t.reward.eggsGiven}`)),vueApp.chw.reward.ownedItem=t.ownedItemId,vueApp.chw.reward.eggs=t.reward.eggsGiven,t.reward.itemIds.forEach(r=>vueApp.chw.reward.itemIds.push(r)),vueApp.chicknWinnerError(!1),vueApp.showChicknWinnerPopup()},t=>ia("getIncetivizedReward",t.error)):bi("getIncetivizedReward() Request called directly. CHW not played")}function ia(t,f){vueApp.chicknWinnerError(!0),vueApp.chwOnClick(!1),hasValue(f)&&(f==="SESSION_EXPIRED"?vueApp.showGenericPopup("session_expired","session_expired_msg","ok"):vueApp.showGenericPopup("uh_oh","purchase_disabled","ok"),t&&console.log(`${t} fail: `,f))}var Ya,_t=class t{static init(){t.inputs=[0,0,0,0,0],Ya=!1}static add(f){t.inputs[f]=Date.now()}static update(){for(var f=0;f<t.inputs.length;f++){var c=t.inputs[f];if(Date.now()-c<100)switch(f){case t.jump:break;case t.fire:q.pullTrigger()&&t.remove(f);break;case t.swap:q.swapWeapon(q.weaponIdx==0?1:0)&&t.remove(f);break;case t.reload:q.reload()&&t.remove(f);break;case t.melee:q.melee()&&(Ya||(ga("send","event","weapon","triggered","Melee"),Ya=!0),t.remove(f));break}}q.triggerPulled&&!(Ue&Le.fire)&&q.releaseTrigger()}static remove(f){t.inputs[f]=0}};_t.jump=0;_t.fire=1;_t.swap=2;_t.reload=3;_t.melee=4;parsedUrl.query.adTest&&(Pa=!0);var mn=class{constructor(){this.rewardedAdPlayed=!1,this.didVideoPlay=!1,this.adsBlocked=!1,this.isPlayingVideoAd=!1,this.callback=null,this.adUnit=null,this.isChwRequest=!1,this.cgAdType="midgame",this.cgErr=!1,this.cgErrTxt="CG video ad"}init(){if(pokiActive||crazyGamesActive||O.productBlockAds){this.adInPlayActive=!1,console.log("initAdInPlay Cancelled. Is portal?",pokiActive||crazyGamesActive);return}let f=this;try{f.ADSLOG("F79520","Shell Shockers AIP","AIP init success!"),f.adInPlayActive=!testCrazy,aiptag.cmd.player.push(function(){qa=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!1,AD_CENTERPLAYER:!0,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:function(c){f.ADSLOG("F79520","Shell Shockers AIP_COMPLETE",c),f.afterVideoAdComplete(c),ga("send","event","aip-complete","regular",c)},AIP_REMOVE:function(){},AIP_REWARDEDCOMPLETE:function(c){f.ADSLOG("F79520","Shell Shockers AIP Reward Complete",c),f.afterVideoAdComplete(c),ga("send","event","aip-complete","reward",c)},AIP_REWARDEDGRANTED:function(c){f.ADSLOG("F79520","Shell Shockers AIP Reward Granted",c),f.rewardedAdPlayed=!0,ga("send","event","aip-complete","reward-granted",c)}}),f.checkAdBlocker()})}catch(c){f.ADSLOG("F79520","Shell Shockers AIP",`AIP error message: ${c}`),f.error()}}set adBlocker(f){this.adsBlocked=f,this.adsBlocked&&!O.productBlockAds&&this.adBlockerDetected()}get adBlocker(){return this.adsBlocked}checkAdBlocker(){this.adBlocker=aipAPItag&&aipAPItag.hasOwnProperty("sdkBlocked")&&aipAPItag.sdkBlocked}adBlockerDetected(){vueApp.chwAdBlockerDetected(),this.adInPlayActive=!1}play(f,c){if(this.adUnit=f,this.callback=c,Pa&&this.ADSLOG("F79520","Shell Shockers AIP","AD test active"),testCrazy&&this.ADSLOG("3C1E6E","CG video ad","Crazy Games test ads"),this.ADSLOG("F79520","Shell Shockers AIP",`Play video ads Ad unit: ${this.adUnit}`),this.isChwRequest||this.setAdVideoLocalStorage(),crazyGamesActive){this.ADSLOG("3C1E6E",this.cgErrTxt,"Crazy Game video ad request."),this.isChwRequest&&(this.cgAdType="rewarded"),this.cgAdRequested();return}vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),oi(0),this.isPlayingVideoAd=!0,this.preroll()}preroll(){if(this.adBlocker)this.ADSLOG("F79520","Shell Shockers AIP","Ad blocker detected."),this.showAdBlockerVideo();else{let f=this;typeof qa<"u"?aiptag.cmd.display.hasOwnProperty("push")&&aiptag.cmd.player.hasOwnProperty("push")?aiptag.cmd.player.push(function(){try{f.ADSLOG("F79520","Shell Shockers AIP",`Play: ${f.adUnit}`),vueApp.gameUiAddClassForNoScroll(),xe&&(vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame)),qa.startPreRoll(f.adUnit)}catch(c){f.error(c),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")}}):(f.error("push method missing"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error")):(f.error("aipPrerollPlayer undefined"),vueApp.setDarkOverlay(!1),this.onVideoAdCompleted("F79520","preroll error"))}}afterVideoAdComplete(f){this.ADSLOG("F79520","Shell Shockers AIP","afterVideoAdComplete"),this.isChwRequest||vueApp.setDarkOverlay(!1),f&&!["video-ad-skipped","video-ad-completed"].includes(f)?this.error(f):this.didVideoPlay=!0,this.onVideoAdCompleted("F79520","Shell Shockers AIP")}onVideoAdCompleted(f,c){this.ADSLOG(f,c,`is getting chickn winner: ${this.isChwRequest}`),this.isChwRequest?this.didVideoPlay?pn():(this.isChwRequest=!1,vueApp.showGenericPopup("ad_blocker_nugget_title","ad_blocker_nugget_content","ok")):(xe&&(vueApp.disableRespawnButton(!1),vueApp.showGameMenu()),vueApp.gameUiRemoveClassForNoScroll()),oi(),this.didVideoPlay=!1,this.rewardedAdPlayed=!1,this.callback&&(this.callback(),this.callback=null),this.adUnit=null}error(f){f&&this.ADSLOG("F79520","Shell Shockers AIP video error: ",f);let c=this.isChwRequest,r=this.isPlayingVideoAd;f==="user-has-adblock"&&this.adBlockerDetected(),vueApp.chwOnClick(!1),this.didVideoPlay=!1,this.isChwRequest=!1,this.isPlayingVideoAd=!1,r&&c&&Qi(()=>{O.playerAccount.isUpgraded()||c&&(vueApp.showGenericPopup("chw_video_error_title","chw_video_error_msg","ok"),Ur())})}isAdBlocking(){return crazyGamesActive?crazysdk.hasAdblock:this.adBlocker}showAdBlockerVideo(){vueApp.showAdBlockerVideo(),setTimeout(()=>{vueApp.hideAdBlockerVideo(),vueApp.gameUiRemoveClassForNoScroll(),crazyGamesActive||testCrazy?this.onVideoAdCompleted():this.afterVideoAdComplete()},hs)}ADSLOG(f,c,r){console.log("%c%s",`color: white; background: #${f}; padding: 2px 6px; border-radius: 3px; margin-right: 5px;`,c,r)}setAdVideoLocalStorage(){localStore.setItem("lastPreRoll",Date.now())}cgAdRequested(){if(this.ADSLOG("3C1E6E",this.cgErrTxt,"requested."),crazysdk.hasAdblock){this.showAdBlockerVideo(),setTimeout(()=>this.cgRequestAd(),hs);return}else this.cgRequestAd()}cgRequestAd(){this.cgListeners(),crazysdk.requestAd(this.cgAdType),this.cgAdType="midgame"}cgListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"add eventListeners"),this.cgAdStarted=this.cgAdStarted.bind(this),this.cgAdError=this.cgAdError.bind(this),this.cgAdFinished=this.cgAdFinished.bind(this),crazysdk.addEventListener("adStarted",this.cgAdStarted),crazysdk.addEventListener("adError",this.cgAdError),crazysdk.addEventListener("adFinished",this.cgAdFinished)}cgRmListeners(){this.ADSLOG("3C1E6E",this.cgErrTxt,"remove eventListeners"),vueApp.setDarkOverlay(!1),crazysdk.removeEventListener("adStarted",this.cgAdStarted),crazysdk.removeEventListener("adError",this.cgAdError),crazysdk.removeEventListener("adFinished",this.cgAdFinished)}cgAdStarted(f){this.ADSLOG("3C1E6E",this.cgErrTxt,"started.",f),xe&&vueApp.hideGameMenu(),vueApp.setDarkOverlay(!0,vueApp.ui.overlayClass.inGame),this.isPlayingVideoAd=!0,this.didVideoPlay=!0,oi(0)}cgAdFinished(f){this.ADSLOG("3C1E6E",this.cgErrTxt,"ended.",f),vueApp.setDarkOverlay(!1),this.cgErr&&(this.didVideoPlay=!1,this.rewardedAdPlayed=!1),this.onVideoAdCompleted("3C1E6E",this.cgErrTxt),this.cgRmListeners(),this.cgErr=!1,crazysdk.hasAdblock&&vueApp.hideAdBlockerVideo()}cgAdError(f){this.ADSLOG("3C1E6E",this.cgErrTxt,"error.",f),this.cgErr=!0,this.didVideoPlay=!1,this.cgAdFinished()}};Ol&&console.log("adTagDebug debug is on");function rt(t,f,c,r){console.log("'{0}' api command".format(t.cmd));try{console.log("services server: "+O.servicesServer);var i=new WebSocket(O.servicesServer)}catch(a){console.log(a)}i.onopen=function(a){i.send(JSON.stringify(t)),console.log("servicesWs opened, and "+t.cmd+" request sent")},i.onmessage=function(a){var n=null;try{n=JSON.parse(a.data)}catch(s){console.log("Invalid data returned from services API",s.data),c(s);return}n.error?(console.log(t.cmd+" error: "+JSON.stringify(n.error)),c(n)):f(n),i.close()},i.onclose=function(a){console.log(t.cmd+" servicesWs closed, code: "+a.code,"reason: "+a.reason,"clean: "+a.wasClean),r&&r(a.code)},i.onerror=function(a){console.log(t.cmd+" servicesWs error: "+JSON.stringify(a)),Ft.hide(),c(a)}}function ac(t,f,c,r){var i={cmd:"auth",firebaseToken:t};rt(i,f,c,r)}function zr(){var t={cmd:"checkBalance",firebaseId:O.playerAccount.firebaseId},f=function(r){console.log("Check Balance response: "+JSON.stringify(r)),r.error?console.log("Check Balance call failed: "+JSON.stringify(r.error)):O.playerAccount.setEggBalances(r.currentBalance)},c=function(){console.log("Error running check balance call")};rt(t,f,c)}function nc(t,f,c){var r={cmd:"buy",firebaseId:O.playerAccount.firebaseId,itemId:t.id,save:typeof checkStatus<"u"?checkStatus():!0},i=function(n){switch(console.log("purchase response: "+n.result),n.result){case"SUCCESS":if(hasValue(n.itemId)){var s=O.catalog.findItemById(n.itemId);O.playerAccount.addToInventory(s,!0)}O.playerAccount.currentBalance=n.currentBalance,vueApp.statsLoading(),rs(),ls(.5),f();break;case"INSUFFICIENT_FUNDS":vueApp.needMoreEggsPopupCall();break;case"ALREADY_OWNED":vueApp.showGenericPopup("p_buy_owned_title","p_buy_owned_content","ok");break;case"ERROR_CODE_4225":vueApp.showGenericPopup("p_error_4225_title","p_buy_error_content","ok");break;case"PLAYER_NOT_FOUND":case"ITEM_NOT_FOUND":case"ERROR":default:c();break}},a=function(){c()};rt(r,i,a)}function sc(t,f,c){if(t==jl){vueApp.giveStuffPopup.eggOrg=!0,vueApp.showGiveStuffPopup("p_give_stuff_title");return}var r={cmd:"redeem",firebaseId:O.playerAccount.firebaseId,id:O.playerAccount.id,code:t},i=function(n){switch(console.log("Redeem Code response: "+n.result),n.result){case"SUCCESS":n.eggs_given||(n.eggs_given=0),n.item_ids||(n.item_ids=[]),n.eggs_given&&n.eggs_given>0&&zr();var s=[];if(n.item_ids)for(var o=0;o<n.item_ids.length;o++){var l=O.catalog.findItemById(n.item_ids[o]);O.playerAccount.addToInventory(l),s.push(l)}ls(.5),f(n.eggs_given,s);break;case"PLAYER_NOT_FOUND":vueApp.showGenericPopup("p_redeem_error_no_player_title","p_redeem_error_no_player_content","ok");break;case"CODE_DOUBLE_DOUBLE":vueApp.showGenericPopup("p_redeem_code_redeem_in_progress_title","p_redeem_code_redeem_in_progress_content","ok");break;case"CODE_PREV_REDEEMED":vueApp.showGenericPopup("p_redeem_prev_title","p_redeem_prev_content","ok");break;case"CODE_NOT_FOUND":vueApp.showGenericPopup("p_redeem_badcode_title","p_redeem_badcode_content","ok");break;case"RATE_LIMIT_REACHED":vueApp.showGenericPopup("p_redeem_ratelimited_title","p_redeem_ratelimited_content","ok");break;case"ERROR":default:c();break}},a=function(){console.log("there be an error"),c()};rt(r,i,a)}function oc(t,f){var c={cmd:"saveLoadout",firebaseId:O.playerAccount.firebaseId,save:typeof checkStatus<"u"?checkStatus():!0,loadout:t},r;f&&(r=setTimeout(()=>{f()},5e3));var i=function(n){console.log("Save Loadout response: "+JSON.stringify(n)),n.error?console.log("Save Loadout call failed: "+JSON.stringify(n.error)):console.log("Successfully saved player loadout"),f&&(clearTimeout(r),f())},a=function(){console.log("Error running save loadout call")};rt(c,i,a)}O.api_saveLoadout=oc;function lc(t,f,c,r,i){r=r||!1;var a={cmd:"xsollaToken",firebaseId:O.playerAccount.firebaseId,productSku:t,subscription:r,playerSource:i};rt(a,f,c)}function cc(t,f,c){let r=()=>vueApp.showGenericPopup("uh_oh","feedback_error_msg","ok");for(var i=O.engine.getGlInfo(),a=O.engine.getCaps(),n=[],s=0;s<vt.length;s++)n.push([O.playerAccount.pickedWeapons[s][0].id,O.playerAccount.pickedWeapons[s][1].id]);var o="";if(t===Na.deleteAccount&&!hasValue(O.playerAccount.firebaseId)){r();return}try{o=JSON.stringify({debugObject:Vl,debugArray:Al})}catch(d){console.log(d)}var l={cmd:"feedback",feedbackType:t,gameVersion:Ot,userAgent:window.navigator.userAgent,username:vueApp.playerName,comments:c,email:f,firebaseId:O.playerAccount.firebaseId||null,fromEU:isFromEU,gameServer:vueApp.loc[vueApp.currentRegionLocKey]||null,session:O.playerAccount.session||null,ping:Ri>0?Math.floor(Ea/Ri):null,highestPing:sr||null,fps:Pi>0?Math.ceil(ai/Pi):null,gameType:Tt||null,privateGame:kl||null,localKills:wa||0,localDeaths:Hr||0,localStreak:Xi||0,url:parsedUrl.root,referrer:document.referrer,gameCode:xr||null,screenSize:screen.width+"x"+screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerSize:window.innerWidth+"x"+window.innerHeight,glVendor:i.vendor,renderer:i.renderer,glVersion:i.version,maxTextureSize:a.maxTextureSize,fov:ne?ne.fov:null,controls:localStorage.getItem("controls"),ofAge:Ze?Ze.ofAge:null,targetedAds:Ze?Ze.targetedAds:null,volume:ae.volume,mouseSpeed:ae.mouseSpeed,mouseInvert:ae.mouseInvert,holdToAim:ae.holdToAim,enableChat:ae.enableChat,safeNames:ae.safeNames,autoDetail:ae.autoDetail,shadowsEnabled:ae.shadowsEnabled,highRes:ae.highRes,selectedClass:O.playerAccount.classIdx,selectedColor:O.playerAccount.colorIdx,hat:O.playerAccount.hatItem?O.playerAccount.hatItem.id:null,stamp:O.playerAccount.stampItem?O.playerAccount.stampItem.id:null,grenade:O.playerAccount.grenadeItem?O.playerAccount.grenadeItem.id:null,weapons:"[[0,0],[0,0],[0,0]]",timesPlayed:null,xsollaToken:null,current_balance:O.playerAccount.currentBalance,log:console.logArray(),debug:o};rt(l,u,h);function u(d){let p={title:"",desc:""};d.status?d.type===Na.deleteAccount?(p.title="feedback_delete_title",p.desc="feedback_delete_msg"):(p.title="feedback_sent_title",p.desc="feedback_sent_msg"):(p.title="uh_oh",p.desc="feedback_error_msg"),setTimeout(function(){vueApp.showGenericPopup(p.title,p.desc,"ok")},1e3)}function h(d){r()}}function Qi(t,f){var c=function(i){O.playerAccount.setUpgrade(i),!O.playerAccount.isUpgraded()&&xe&&(document.getElementById("chickenBadge").style.display="none"),O.productBlockAds=O.playerAccount.isUpgraded(),O.productBlockAds&&vueApp.runProductCheck(),t&&t(i)},r=function(i){f&&f(i),console.log("Error checking account upgrade status")};uc(c,r)}O.checkUpgrade=Qi;function uc(t,f){var c={cmd:"checkUpgrade",firebase_id:O.playerAccount.firebaseId,session:O.playerAccount.session,sessionId:O.playerAccount.sessionId};rt(c,t,f)}function hc(t,f){let c={cmd:"player_notifications",firebase_id:O.playerAccount.firebaseId};rt(c,t,f)}function fc(t,f){let c={cmd:"notify_mark_as_complete",firebase_id:O.playerAccount.firebaseId};rt(c,t,f)}function dc(t,f,c,r){var i={cmd:"reward",firebaseId:O.playerAccount.firebaseId,rewardTag:t.tag};rt(i,f,c)}function pc(t,f,c){let r={cmd:"inGameReward",firebaseId:O.playerAccount.firebaseId},i=a=>{switch(console.log("In Game reward response: "+a.result),vueApp.hideSpinner(),a.result){case"SUCCESS":case"SUCCESS_FIRST":t();break;case"REACHED_DAILY_LIMIT":c();break;case"ERROR":f();break}};vueApp.showSpinner(),rt(r,i,f)}function mc(t,f,c){let r={cmd:"urlRewardParams",reward:t,firebaseId:O.playerAccount.firebaseId};rt(r,f,c)}function _c(t,f){let c={cmd:"getPlayerSubStatus",playerId:O.playerAccount.id};rt(c,a=>{t&&t(a)},a=>{f&&f()})}function Zs(t,f){rt({cmd:"getScheduledEventData"},t,f)}function gc(t,f){let c={cmd:"checkTwitchEntitlements",playerId:O.playerAccount.id,firebaseId:O.playerAccount.firebaseId};rt(c,t,f)}function qs(t,f){if(!Kt.isChwRequest){console.log("api_incentivizedVideoRewardRequest() API called directly. chw not played");return}let c={cmd:"incentivizedVideoReward",token:Dl,id:O.playerAccount.id,firebaseId:O.playerAccount.firebaseId,sessionId:O.playerAccount.sessionId};rt(c,t,f)}function vc(t,f){let c={cmd:"chicknWinnerReady",id:O.playerAccount.id,sessionId:O.playerAccount.sessionId};rt(c,t,f)}function yc(t,f){let c={cmd:"updatePlayerStats",playerId:O.playerAccount.id};rt(c,t,f)}function bc(t,f,c){let r={cmd:"checkAfterStorePurchase",playerId:O.playerAccount.id,transactionId:t};rt(r,f,c)}var Sc=(t,f,c)=>rt({cmd:"urlRewardParams",reward:t,firebaseId:O.playerAccount.firebaseId},f,c);function Cr(t){this.scene=t.scene,this.bullet=t,this.delayFrames=0,this.mesh=this.scene.getMeshByName("bullet").createInstance(""),this.mesh.setEnabled(!1)}Cr.prototype.fire=function(t){this.delayFrames=3,t?(this.mesh.scaling.x=2,this.mesh.scaling.y=2):(this.mesh.scaling.x=1,this.mesh.scaling.y=1),this.mesh.position.x=this.bullet.x,this.mesh.position.y=this.bullet.y,this.mesh.position.z=this.bullet.z,this.mesh.lookAt(new T.Vector3(this.bullet.x+this.bullet.dx,this.bullet.y+this.bullet.dy,this.bullet.z+this.bullet.dz)),this.mesh.scaling.z=.5};Cr.prototype.update=function(t){this.delayFrames>0?this.delayFrames--:this.mesh.setEnabled(!0),this.mesh.position.x+=(this.bullet.x-this.mesh.position.x)*.5,this.mesh.position.y+=(this.bullet.y-this.mesh.position.y)*.5,this.mesh.position.z+=(this.bullet.z-this.mesh.position.z)*.5,this.bullet.player.id!=ue&&(this.mesh.scaling.z=Math.min(this.mesh.scaling.z+.03,3))};Cr.prototype.remove=function(){this.mesh.setEnabled(!1)};var ra=class{constructor(f,c,r){this.watchedCount=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.progress=1,this.timer=null,this.gap=0,this.end=f,this.span=c,this.limitReached=!1,this.ready=!1,this.count=r}set count(f){this.watchedCount!==f&&(this.watchedCount=f,this.watchedCount>gi.dailyLimit?this.limitReached=!0:this.limitReached=!1),this.chwTimer()}get count(){return this.watchedCount}chwClearTimer(){this.timer!==null&&this.ready&&(clearInterval(this.timer),this.timer=null)}chwTimer(){this.timer===null&&(this.timer=setInterval(()=>this.chwData(),1e3))}chwData(){this.gap=Math.floor(this.end-Math.trunc(Date.now()/1e3)),this.progress=Math.floor((this.span-this.gap)/this.span*100),this.gap<0&&(this.gap=0,this.progress=100);let f=0,c=0;this.progress<100?(this.days=Math.floor(this.gap/24/60/60),f=Math.floor(this.gap-this.days*86400),this.hours=Math.floor(f/3600),c=Math.floor(f-this.hours*3600),this.minutes=Math.floor(c/60),this.seconds=this.gap%60):(this.ready=!0,this.chwClearTimer()),vueApp.chwUiTimerUpdate(this.hours,this.minutes,this.seconds,this.progress,this.ready,this.limitReached,this.watchedCount)}};var St=new T.Vector3,Si=new T.Vector3,It,mr,aa,na,sa,di,en=0,ui,Js,oa,Jr,Vi,Ra,Nr,$s,_n=!1,zt,gn=new T.Vector3,ri,qe,Bt,Hi,At,Zi,Oi,Ie,wi,gt,si,Ue,wa,Hr,Xi,Bs,cr,oe,ye,Re,Lt,Ne,Gi,pe,Rr,$r,vn,jt,lt,yn,Er=!1,Ti=[0,0,0];function Tc(){oe.clearColor=T.Color3.Black(),Lt=new T.DirectionalLight("",new T.Vector3(0,-1,0),oe),Lt.lightmapMode=T.Light.LIGHTMAP_SHADOWSONLY,Lt.intensity=1.2,Lt.autoUpdateExtends=!1,Lt.shadowMinZ=.05,Lt.shadowMaxZ=40,Lt.shadowFrustumSize=15,xt=new T.ShadowGenerator(1024*1,Lt),xt.forceBackFacesOnly=!0}function Ys(){console.log("startGame()");var t=document.getElementById("onesignal-bell-container");$s=Date.now(),t&&(t.style.display="none"),Ra=!1,pe=[],zt=[],It=-1,vueApp.game.respawnTime=0,q=null,Ne=null,At=!1,lt=null,Ue=0,ci=!0,Er=!1,gt=!1,ui=new mi,oa=performance.now(),ping=0,sr=0,Ea=0,Ri=0,ai=-1,Pi=0,As=0,Jr=0,wa=0,Hr=0,Xi=0,Br=Date.now(),Gl=Date.now()+1e3,O.engine.clear(T.Color3.Black()),O.engine.stopRenderLoop(),oe=new T.Scene(O.engine),ae.autoDetail||(oe.shadowsEnabled=ae.shadowsEnabled),oe.autoClear=!0,oe.autoClearDepthAndStencil=!0,Tc(),ne=new T.TargetCamera("camera",T.Vector3.Zero(),oe),oe.activeCameras.push(ne),ne.maxZ=100,ne.fov=1.25,ne.minZ=.05,BAWK.attach(ne.globalPosition,gn),mr=new T.FreeCamera("uiCamera",new T.Vector3(0,0,-1),oe),mr.mode=T.Camera.ORTHOGRAPHIC_CAMERA,mr.layerMask=536870912,mr.autoClear=!1,oe.activeCameras.push(mr),Rr=new T.DynamicTexture("",2048,oe,!0,2),$r=new T.SpriteManager("","",18,{width:512,height:256},oe),$r.fogEnabled=!1,$r.texture=Rr,vn=new T.SpriteManager("","img/particles.png?"+Ot,18,128,oe),vn.fogEnabled=!0,Ca(oe),window.onfocus=function(){oa=performance.now(),q&&Qc()},window.onblur=function(){},document.onpointerlockchange=function(){q&&!document.pointerLockElement&&(Li=null,Ue=0,q.controlKeys=0,q.releaseTrigger(),setTimeout(()=>{var f=Ce.getBuffer();f.packInt8(he.pause),f.send(we),q.resetCountdowns();let c=Gr&&!O.productBlockAds&&!pokiActive?10:5;io(c)},100),ci=!0,vueApp.statsLoading(),Ei.set(function(){q.removeFromPlay(),rs()},3e3),bn!==void 0&&Sn!==void 0&&(aiptag=bn,aipDisplay=Sn),console.log("pausing game via pointerlock exit"),eo(),Xh(),crazyGamesActive&&crazysdk.gameplayStop())},lu(),document.body.style.overflow="hidden",_t.init(),Wc(Mr,Uc),cn&&(vueApp.setDarkOverlay(!0),cn=!1)}function Ec(t){di||xe&&!ci&&document.pointerLockElement&&(document.exitPointerLock(),console.log("pausing game on key: ",t))}function la(){document.pointerLockElement?(console.log("pausing game and breaking pointerlock"),document.exitPointerLock()):(console.log("pausing game via esc key"),eo())}function Pc(){vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("hardBoiledContainer").style.display="block",document.getElementById("killTicker").style.display="block",di&&ut.focus(),Xn(),Ie.show(),document.getElementById("gameAdContainer").style.display="none"}function eo(){if(vueApp.showScreen===vueApp.screens.equip)return;ci=!0,gt=!1,mt.clear(Js),yn=!0,Nn(),Eo(),vueApp.setPause(ci),vueApp.showGameMenu(),document.getElementById("grenadeThrowContainer").style.visibility="hidden",document.getElementById("weaponBox").style.display="none",document.getElementById("healthContainer").style.display="none",document.getElementById("hardBoiledContainer").style.display="none",document.getElementById("killTicker").style.display="none",document.getElementById("spectate").style.display="none",document.getElementById("serverAndMapInfo").style.display="block",document.getElementById("captureIconContainer").style.display="none",document.getElementById("playerList").style.pointerEvents="auto";let t=document.getElementById("gameAdContainer");t&&(t.style.display="block"),Ie.hide(),Ie.hideDot(),di&&ut.focus(),Hs=!1,Vi||(Vi=document.querySelector(".chat-container")),setTimeout(()=>{Vi.scrollTop=Vi.scrollHeight,qi()},300)}function to(){if(console.log("resumeGame called"),q){ci=!1,vueApp.hideGameMenu(),document.getElementById("deathBox").style.display="none",document.getElementById("killTicker").style.display="block",document.getElementById("serverAndMapInfo").style.display="none",Tt==_i.king&&(document.getElementById("captureIconContainer").style.display="block"),document.getElementById("playerList").style.pointerEvents="none",gt?document.getElementById("spectate").style.display="block":(document.getElementById("weaponBox").style.display="block",document.getElementById("healthContainer").style.display="block",document.getElementById("hardBoiledContainer").style.display="block",Or());let t=document.getElementById("gameAdContainer");t&&(t.style.display="block"),cu(),di&&ut.focus(),setTimeout(()=>{qi()},300),Ho()}}function io(t){It=Math.max(t,It),vueApp.game.respawnTime=It,Nr&&mt.clear(Nr),Nr=mt.set(function(){It--,vueApp.game.respawnTime=Math.min(It,t),It<=0&&xe&&(It=-1,mt.clear(Nr),co())},1200)}var Zt,ca,$i={};var bn,Sn;function xc(){if($t){q.playing=!0,canvas.requestPointerLock({unadjustedMovement:ae.fastPollMouse});return}if(console.log("Respawn pressed - respawnTime: "+It),It<0){if(mt.clearAll(),Ei.clearAll(),mt.set(()=>{document.activeElement.tagName=="IFRAME"&&(console.log("iframe attempted to steal focus:",document.activeElement),document.activeElement.blur())},100),ae.autoDetail&&es(),Mc()){Ra=!0,Kt.play("shellshock.io_preroll",la);return}return typeof aiptag<"u"&&typeof aipDisplay<"u"&&(bn=aiptag,Sn=aipDisplay,aiptag={},aipDisplay={}),Cc()}}function Mc(){if(O.productBlockAds||Ra)return!1;let t=Pa?3e4:24e4;pokiActive&&(t=0);let f=!1;(Wn||Yr>1)&&(f=!0);let c=getStoredNumber("lastPreRoll",Date.now()),r=c+t,i=f&&Hr>1&&Date.now()>r,a=fi.timeToPlayVideoAd();return a===!0?!0:!(a===!1||!i)}var jr=!1;function Cc(){if(console.log(`requestRespawnBlocked ${jr}`),!jr){if(jr=!0,setTimeout(()=>jr=!1,1e3),_n){q.changeCharacter(O.playerAccount.classIdx,O.playerAccount.getPrimaryWeapon(),O.playerAccount.getSecondaryWeapon(),O.playerAccount.colorIdx,O.playerAccount.hatItem,O.playerAccount.stampItem,O.playerAccount.grenadeItem,O.playerAccount.meleeItem,0,0);var t=Ce.getBuffer();t.packInt8(he.changeCharacter),t.packInt8(O.playerAccount.classIdx),t.send(we),_n=!1}var t=Ce.getBuffer();t.packInt8(he.requestRespawn),t.send(we),Wh(),vueApp.setPause(!1),crazyGamesActive&&crazysdk.gameplayStart()}}function ro(t){wr("keyboard","MOUSE "+t.button),t.button==1&&t.preventDefault()}function ao(t){Ir("keyboard","MOUSE "+t.button)}function no(t){if(document.pointerLockElement&&!yn&&q&&(q.hp>0||gt)){var f=Math.pow(ae.mouseSpeed*.001,2);q.scope&&(f*=q.weapon.actor.scopeFov);var c=t.movementX,r=t.movementY;$i.x&&Math.sign(c)!=Math.sign($i.x)&&(c=0),$i.y&&Math.sign(r)!=Math.sign($i.y)&&(r=0),$i.x=c,$i.y=r,q.yaw=Math.radAdd(q.yaw,c*f),q.pitch=Math.clamp(q.pitch+r*ae.mouseInvert*f,-1.5,1.5)}yn=!1}function so(t){t.wheelDelta>0?(wr("keyboard","WHEEL UP"),Ir("keyboard","WHEEL UP")):(wr("keyboard","WHEEL DOWN"),Ir("keyboard","WHEEL DOWN"))}var Rc=new T.Color4(1,1,1,1);function Bi(t,f,c,r,i){for(var a=new T.SpriteManager("","img/"+t+"?"+Ot,f,128,i),n=0;n<f;n++){var s=new T.Sprite("",a);s.isVisible=!1}return a.nextIdx=0,a.getSprite=function(o){var l=this.sprites[this.nextIdx];return l.cellIndex=o!==void 0?c+o:Math.randomInt(c,r),l.isVisible=!0,l.easing=Ki.linear,l.startSize=-1,l.endSize=-1,l.gravity=0,l.dx=0,l.dy=0,l.dz=0,l.float=0,l.anim=0,l.slow=0,l.angle=0,l.rotate=0,l.stopped=!1,l.animColors=null,l.collide=!1,l.color.copyFrom(Rc),this.nextIdx=++this.nextIdx%this.sprites.length,l},a}function wc(t,f,c,r,i,a){var n=Bt.getSprite(0);n.animLength=Math.random()*20+30,n.easing=Ki.outQuint,n.position.x=t,n.position.y=f,n.position.z=c,n.dx=r*.1,n.dy=i*.1,n.dz=a*.1,n.startSize=.1,n.endSize=Math.random()*.2+.4,n.angle=Math.random()*Math.PI2,n.rotate=Math.random()*.08-.04,n.animColors=Fc}function ur(t,f,c,r,i,a,n,s,o,l,u){let h=0,d=0,p="default",m="default";u&&(h=u.item_data.cell||0,t==Bt&&h&&(d=u.item_data.smokeCell,isNaN(d)&&(d=h)),p=u.item_data.fireColors||"default",m=u.item_data.smokeColors||"default");var _=t.getSprite(h);return _.animLength=f,_.easing=Ki.inOutQuad,_.position.x=c,_.position.y=r,_.position.z=i,_.size=o,_.dx=a,_.dy=n,_.dz=s,_.slow=.7,_.angle=Math.random()*Math.PI2,_.rotate=Math.random()*.04-.02,t==Hi?_.animColors=Dc[p]:_.animColors=kc[m],_}function Ic(t,f,c,r,i,a){for(var n=0;n<Math.floor(r/4);n++){var s=Math.random()*80+80,o=Math.random()*1+.5,l=(.9-o)*.5,u=(Math.random()*2-1)*l,h=(Math.random()*2-1)*l+.1,d=(Math.random()*2-1)*l,p=ur(Bt,s,t,f,c,u,h,d,o,!0,a);p.float=Math.random()*.015+.001,p.collide=!0,p=ur(Hi,s*.075,t,f,c,u*1.5,h*1.5,d*1.5,o,!0,a),p.collide=!0}if(q){var m=Math.length3(q.x-t,q.y-f,q.z-c);if(i*=1.5,m<i){var _=Math.max(0,(i-m)/i);yt=Math.min(7,yt+_*6)}}}var Dc={default:[{pos:0,color:new T.Color4(1,.9,.8,1)},{pos:.2,color:new T.Color4(1,.5,.1,1)},{pos:.4,color:new T.Color4(.6,.2,.1,1)},{pos:.7,color:new T.Color4(0,0,0,0)},{pos:1,color:new T.Color4(0,0,0,0)}],rainbow:[{pos:0,color:new T.Color4(1,.1,.1,1)},{pos:.2,color:new T.Color4(1,1,.1,1)},{pos:.4,color:new T.Color4(.1,1,.1,1)},{pos:.7,color:new T.Color4(.1,.1,1,.5)},{pos:1,color:new T.Color4(1,.1,1,0)}],gold:[{pos:0,color:new T.Color4(1,1,.3,1)},{pos:.4,color:new T.Color4(1,.8,.2,1)},{pos:1,color:new T.Color4(1,.6,.1,0)}],corrupt:[{pos:0,color:new T.Color4(1,.1,.1,1)},{pos:.3,color:new T.Color4(1,1,1,1)},{pos:.6,color:new T.Color4(1,.1,.1,1)},{pos:1,color:new T.Color4(1,1,1,0)}],thermal:[{pos:0,color:new T.Color4(1,.9,.8,1)},{pos:.2,color:new T.Color4(1,.5,.1,1)},{pos:.4,color:new T.Color4(.6,.2,.1,1)},{pos:.5,color:new T.Color4(1,1,1,1)},{pos:.6,color:new T.Color4(1,1,1,0)},{pos:.7,color:new T.Color4(1,1,1,1)},{pos:1,color:new T.Color4(0,0,0,0)}],black:[{pos:0,color:new T.Color4(0,0,0,1)},{pos:1,color:new T.Color4(0,0,0,0)}],red:[{pos:0,color:new T.Color4(1,.7,.3,1)},{pos:1,color:new T.Color4(0,0,0,0)}],blue:[{pos:0,color:new T.Color4(.3,.7,1,1)},{pos:1,color:new T.Color4(0,0,0,0)}]},kc={default:[{pos:0,color:new T.Color4(.3,.3,.3,1)},{pos:1,color:new T.Color4(.7,.7,.7,0)}],white:[{pos:0,color:new T.Color4(1,1,1,.5)},{pos:1,color:new T.Color4(1,1,1,0)}],corrupt:[{pos:0,color:new T.Color4(1,1,1,.6)},{pos:.5,color:new T.Color4(1,.1,.1,.4)},{pos:1,color:new T.Color4(0,0,0,0)}],thermal:[{pos:0,color:new T.Color4(.5,.1,.01,.3)},{pos:.3,color:new T.Color4(.7,.4,0,.1)},{pos:1,color:new T.Color4(0,0,0,0)}],supernova:[{pos:0,color:new T.Color4(1,1,1,.5)},{pos:1,color:new T.Color4(1,0,1,0)}],black:[{pos:0,color:new T.Color4(0,0,0,1)},{pos:1,color:new T.Color4(0,0,0,0)}],softblack:[{pos:0,color:new T.Color4(0,0,0,.5)},{pos:1,color:new T.Color4(0,0,0,0)}],red:[{pos:0,color:new T.Color4(1,.7,.3,1)},{pos:.5,color:new T.Color4(1,.3,0,.6)},{pos:1,color:new T.Color4(0,0,0,0)}],blue:[{pos:0,color:new T.Color4(.3,.7,1,1)},{pos:.5,color:new T.Color4(0,.3,1,.6)},{pos:1,color:new T.Color4(0,0,0,0)}]},Fc=[{pos:0,color:new T.Color4(1,1,1,1)},{pos:.2,color:new T.Color4(.7,.7,.7,.7)},{pos:1,color:new T.Color4(.7,.7,.7,0)}],oo=[{pos:0,color:new T.Color4(1,1,1,1)},{pos:.8,color:new T.Color4(1,1,1,1)},{pos:1,color:new T.Color4(1,1,1,0)}];function Ac(t,f,c){for(var r=t.length-2;r>=0;r--)if(f>=t[r].pos){T.Color4.LerpToRef(t[r].color,t[r+1].color,(f-t[r].pos)*(1/(t[r+1].pos-t[r].pos)),c);return}}function Vc(t,f,c,r){for(var i=0;i<f;i++){var a=Math.random()*r+r*.5,n=i/(f*.5)*c+c*.5,s=.08/(n+1),o=(Math.random()*2-1)*s,l=(Math.random()*2-.5)*s,u=(Math.random()*2-1)*s,h=na.getSprite();h.animLength=a,h.easing=Ki.inQuad,h.position.x=t.actor.mesh.position.x,h.position.y=t.actor.mesh.position.y+.3,h.position.z=t.actor.mesh.position.z,h.startSize=n,h.endSize=0,h.gravity=.003,h.dx=o,h.dy=l,h.dz=u,h.angle=Math.random()*Math.PI2,h.rotate=Math.random()*.2-.1,h.collide=!0,h.color.r=t.actor.bodyMesh.colorMult.r,h.color.g=t.actor.bodyMesh.colorMult.g,h.color.b=t.actor.bodyMesh.colorMult.b}}function Gc(t){for(var f=10,c=.2,r=0;r<f;r++){var i=Math.random()*80+80,a=r/(f*.5)*c+c,n=.05/(a+1),s=(Math.random()*2-1)*n,o=(Math.random()*2-.25)*n*1.5,l=(Math.random()*2-1)*n,u=yolkManager.getSprite();u.animLength=i,u.easing=Ki.inQuad,u.position.x=t.actor.mesh.position.x,u.position.y=t.actor.mesh.position.y+.3,u.position.z=t.actor.mesh.position.z,u.startSize=a,u.endSize=0,u.gravity=.005,u.dx=s,u.dy=o,u.dz=l,u.slow=.9,u.angle=Math.random()*Math.PI2,u.rotate=Math.random()*.2-.1,u.collide=!0}}function _s(t,f){for(var c=Math.floor(f/33)+1,r=0;r<c;r++){var i=Math.random()*9+9,a=.8,n=.03/(a+1),s=(Math.random()*2-1)*n,o=(Math.random()*2-.25)*n*1.5,l=(Math.random()*2-1)*n;St.set(q.x,q.y,q.z),Si.set(t.x,t.y,t.z),St.subtractInPlace(Si).normalize().scaleInPlace(.26);var u=sa.getSprite();u.animLength=i,u.easing=Ki.linear,u.position.x=t.actor.mesh.position.x,u.position.y=t.actor.mesh.position.y+.3,u.position.z=t.actor.mesh.position.z,u.startSize=a*.2,u.endSize=a,u.gravity=.003,u.dx=s+t.dx,u.dy=o,u.dz=l+t.dz,u.slow=.95,u.angle=Math.random()*Math.PI2,u.rotate=Math.random()*.02-.001,u.collide=!1,u.animColors=oo}}function lo(t,f){for(var c=Math.floor(f/33)+1,r=0;r<c;r++){var i=Math.random()*9+9,a=.8,n=.03/(a+1),s=(Math.random()*2-1)*n,o=(Math.random()*2-.25)*n*1.5,l=(Math.random()*2-1)*n;St.set(q.x,q.y,q.z),Si.set(t.x,t.y,t.z),St.subtractInPlace(Si).normalize().scaleInPlace(.26);var u=aa.getSprite();u.animLength=i,u.easing=Ki.linear,u.position.x=t.actor.mesh.position.x,u.position.y=t.actor.mesh.position.y+.3,u.position.z=t.actor.mesh.position.z,u.startSize=a*.2,u.endSize=a,u.gravity=.003,u.dx=s+t.dx,u.dy=o,u.dz=l+t.dz,u.slow=.95,u.angle=Math.random()*Math.PI2,u.rotate=Math.random()*.02-.001,u.collide=!1,u.animColors=oo}}function Yi(t,f){for(var c=0;c<t.sprites.length;c++){var r=t.sprites[c];if(r.isVisible){var i=r.easing(r.anim);if(r.endSize>=0&&(r.size=r.startSize+i*(r.endSize-r.startSize)),r.animColors&&Ac(r.animColors,i,r.color),!r.stopped){r.position.x+=r.dx*f,r.position.y+=r.dy*f+r.float,r.position.z+=r.dz*f,r.rotate&&(r.angle+=r.rotate*f);var a=!1;r.collide&&(St.set(r.position.x,r.position.y,r.position.z),a=We.pointCollidesWithStructure(St,!0)),a?(r.stopped=!0,r.position.x-=r.dx*f,r.position.y-=r.dy*f,r.position.z-=r.dz*f):r.gravity&&(r.dy-=r.gravity*f),r.slow&&(r.dx*=Math.pow(r.slow,f),r.dy*=Math.pow(r.slow,f),r.dz*=Math.pow(r.slow,f))}r.anim+=f/r.animLength,r.anim>=1&&(r.isVisible=!1)}}}function Uc(){console.log("onLoadingComplete"),qe=new Xr({numChannels:24},{distanceModel:"exponential"});try{Oi=new Jn,wi=new Ia,Ie=new pi,Ie.hide(),Ie.hideDot(),pt("muzzleFlash",oe,null,oe.getMaterialByName("muzzleFlash")).setEnabled(!1),pt("bullet",oe,null,oe.getMaterialByName("bullet")).setEnabled(!1),pt("rocket",oe,null,oe.getMaterialByName("standardInstanced")).setEnabled(!1),pt("ammo",oe,null,oe.getMaterialByName("standardInstanced")).setEnabled(!1),pt("grenadeItem",oe,null,oe.getMaterialByName("standardInstanced")).setEnabled(!1),pt("meleeItem",oe,null,oe.getMaterialByName("standardInstanced")).setEnabled(!1),pt("spatula",oe,null,oe.getMaterialByName("emissive")).setEnabled(!1);for(let c=0;c<O.catalog.grenades.length;c++){let r=O.catalog.grenades[c].item_data.meshName;pt(r,oe,null,oe.getMaterialByName("emissive")).setEnabled(!1)}if(Zt=new fr(oe),ca=new Pt,Bt=Bi("particles.png",300,16,23,oe),Bt.fogEnabled=!0,Bt.noAlphaTest=!0,Hi=Bi("particles.png",300,16,23,oe),Hi.fogEnabled=!0,Hi.blendMode=T.Engine.ALPHA_ADD,na=Bi("particles.png",400,3,6,oe),na.fogEnabled=!0,yolkManager=Bi("particles.png",100,2,2,oe),yolkManager.fogEnabled=!0,vueApp.switchToGameUi(),O.playerAccount.isUpgraded()&&(document.getElementById("chickenBadge").style.display="block"),aa=Bi("particles.png",20,0,0,oe),aa.fogEnabled=!0,sa=Bi("particles.png",20,7,7,oe),sa.fogEnabled=!0,$t){ue=0,fi={update:()=>{},render:()=>{}},Ee={update:()=>{}};var t={id:0,uniqueId:0,name:"Test",charClass:0,team:0,primaryWeaponItem:O.playerAccount.getPrimaryWeapon(),secondaryWeaponItem:O.playerAccount.getSecondaryWeapon(),shellColor:0,hatItem:null,stampItem:null,score:0,kills:0,deaths:0,streak:0,totalKills:0,totalDeaths:0,bestGameStreak:0,bestOverallStreak:0,x:Jt.x+.5,y:Jt.y-.32,z:Jt.z+.5,dx:0,dy:0,dz:0,frame:0,pitch:Jt.pitch,yaw:Jt.yaw,shield:0,hp:0,playing:!1,weaponIdx:0,controlKeys:0,randomSeed:0,upgradeProductId:O.playerAccount.upgradeProductId!==void 0&&O.playerAccount.upgradeProductId!==null?O.playerAccount.upgradeProductId:0,activeShellStreaks:0,social:[],hideBadge:0,damageMod:1};t.stats={},ja.forEach(c=>t.stats[c]=0),po(t),pe[ue].hp=100,Xn(),Ln(),uo(),la(),Ie.show(),Ie.showDot(),It=-1,ai=0,vueApp.delayTheCracking=!0}else{Zi=!0,Oc();var f=Ce.getBuffer();f.packInt8(he.clientReady),f.send(we),Tn=Date.now(),Nh();let c=`${ke("ingame_chat_msg")} <br /> ${ke("ingame_chat_msg_2")}`;qn(c,null,zc,"<i class='fas fa-user-friends'></i>")}}catch(c){console.log(c)}}function zc(){ga("send","event","game","click","openShareLinkChat"),$n()}function co(){ne.parent=null,ne.position=new T.Vector3(0,ye.height+1,0),ne.lockedTarget=null,ne.setTarget(new T.Vector3(ye.width/2,ye.height/4,ye.depth/2)),Zi=!0,Ne=q,Wt=ue,oe.autoClear=!0,oe.autoClearDepthAndStencil=!0}function Xn(t){ne.position=T.Vector3.Zero(),ne.rotation=T.Vector3.Zero(),t?ne.parent=t.actor.eye:ne.parent=q.actor.eye,ne.lockedTarget=null,Zi=!1,oe.autoClear=!1,oe.autoClearDepthAndStencil=!1}var tn=!1;function Hc(){tn||(tn=!0,setTimeout(()=>tn=!1,1e3),It<0&&(Zi=!1,gt=!0,si=li.freeCamera,vueApp.setPause(!1),vueApp.setInGame(gt),ui.freeCamera(),to(),canvas.requestPointerLock({unadjustedMovement:ae.fastPollMouse}),q.yaw=Math.radRange(ne.rotation.y),q.pitch=Math.radRange(ne.rotation.x),Js=mt.set(function(){var t=Ce.getBuffer();t.packInt8(he.keepAlive),t.send(q.ws)},15e3),Nn()))}function Ln(t){hasValue(t)||qi(),O.engine.runRenderLoop(function(){Nc(),Ne&&(Lt.position.x=Ne.x,Lt.position.y=Ne.y+2,Lt.position.z=Ne.z),oe.render(),fi.render()})}function uo(){Kn(),Zi&&co(),Bs=setInterval(Lc,1e3/30)}var rn,gs=document.createElement("DIV"),Kr=[],vs="",Qr=!1,ho=t=>{if(!Qr&&t?(Qr=!0,vueApp.musicWidget(!0)):Qr&&!t&&(Qr=!1,vueApp.musicWidget(!1)),vs!==t){vs=t;var f=decodeURI(t);console.log("Music metadata",f),data=JSON.parse(f),vueApp.music.serverTracks=data,location.host=="localhost"||location.host=="localshelldev.bluewizard.com"?vueApp.music.serverTracks.albumArt="https://shellshock.io/data/img/albumArt/"+data.id+data.albumExt+"?"+data.query:vueApp.music.serverTracks.albumArt=dynamicContentPrefix+"data/img/albumArt/"+data.id+data.albumExt+"?"+data.query,vueApp.songChanged=!0}};function Oc(){we.onmessage=function(t){Z.init(t.data);for(var f;f=Z.isMoreDataAvailable();){var c=Z.unPackInt8U();switch(c){case he.playerInfo:var C=Z.unPackInt8U(),r=Z.unPackString(128),i=Z.unPackString(32),B=pe[C];if(B){B.dbId=r,B.ip=i;for(var Q=0;Q<zt.length;Q++)if(zt[Q].id===C){zt[Q].dbId=r,zt[Q].ip=i;break}}break;case he.musicInfo:var a=Z.unPackLongString();ho(a);break;case he.pause:var C=Z.unPackInt8U(),B=pe[C];B&&B.removeFromPlay();break;case he.eventModifier:console.log("eventModifier");var n=Ce.getBuffer();n.packInt8(he.eventModifier),n.send(we);break;case he.clientReady:Hs=!0,It=-1,ai=0,Ln(),uo(),vueApp.delayInGamePlayButtons(),ta?setTimeout(()=>{vueApp.onGamePauseUi(),$n()},200):la(),ae.autoDetail?es():(kr(ae.highRes),Fr(ae.shadowsEnabled));var n=Ce.getBuffer();n.packInt8(he.ping),n.send(we);break;case he.addPlayer:var Pe=Z.unPackInt8U(),s=Z.unPackString(),o=Z.unPackString(),l=Z.unPackInt8U();o=Aa(o,80);var u={id:Pe,uniqueId:s,name:o,charClass:l,team:Z.unPackInt8U(),primaryWeaponItem:O.catalog.findItemById(Z.unPackInt16U()),secondaryWeaponItem:O.catalog.findItemById(Z.unPackInt16U()),shellColor:Z.unPackInt8U(),hatItem:O.catalog.findItemById(Z.unPackInt16U()),stampItem:O.catalog.findItemById(Z.unPackInt16U()),grenadeItem:O.catalog.findItemById(Z.unPackInt16U()),meleeItem:O.catalog.findItemById(Z.unPackInt16U()),x:Z.unPackFloat(),y:Z.unPackFloat(),z:Z.unPackFloat(),dx:Z.unPackFloat(),dy:Z.unPackFloat(),dz:Z.unPackFloat(),yaw:Z.unPackRadU(),pitch:Z.unPackRad(),score:Z.unPackInt32U(),kills:Z.unPackInt16U(),deaths:Z.unPackInt16U(),streak:Z.unPackInt16U(),totalKills:Z.unPackInt32U(),totalDeaths:Z.unPackInt32U(),bestGameStreak:Z.unPackInt16U(),bestOverallStreak:Z.unPackInt16U(),shield:Z.unPackInt8U(),hp:Z.unPackInt8U(),playing:Z.unPackInt8U(),weaponIdx:Z.unPackInt8U(),controlKeys:Z.unPackInt8U(),upgradeProductId:Z.unPackInt8U(),activeShellStreaks:Z.unPackInt8U(),social:Z.unPackLongString(),hideBadge:Z.unPackInt8U()};if(u.gameData={},u.gameData.mapIdx=Z.unPackInt8U(),u.gameData.private=Z.unPackInt8U(),u.gameData.gameType=Z.unPackInt8U(),u.stats={},ja.forEach(Fi=>u.stats[Fi]=0),u.stats.kills=u.kills,u.stats.deaths=u.deaths,u.stats.streak=u.streak,u.name=jo(u.name),!pe[u.id]){ue==u.id||nr?(u.normalName=u.name,u.safeName=u.name):(u.normalName=u.name.replace(/<|>/g,""),u.safeName=ka(),(u.normalName.length==0||Qs(u.normalName))&&(u.normalName=u.safeName),ae.safeNames?u.name=u.safeName:u.name=u.normalName);let Fi=jn(s);Fi?(u.muted=Fi.muted,u.muted&&!ae.safeNames&&(u.name=u.safeName)):u.muted=!1,po(u)}break;case he.removePlayer:var C=Z.unPackInt8U();Zc(C);break;case he.spawnItem:var Pe=Z.unPackInt16U(),h=Z.unPackInt8U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat();ca.spawnItem(Pe,h,Ge,Se,ze);break;case he.collectItem:var C=Z.unPackInt8U(),h=Z.unPackInt8U(),d=Z.unPackInt8U(),Pe=Z.unPackInt16U();ca.collectItem(h,Pe),C==ue&&q.collectItem(h,d);break;case he.die:var p=Z.unPackInt8U(),m=Z.unPackInt8U(),_=Z.unPackInt8U(),v=pe[p],S=pe[m],P=Z.unPackInt8U(),x=Z.unPackInt8U();S.lastDmgType=P,v.lastDmgType=x,p==ue&&m!=ue?Et.updateTerminus(getKeyByValue(vt,v.charClass),dt[x].name,"deaths"):m==ue&&p==ue&&(Et.updateTerminus(getKeyByValue(vt,v.charClass),"Grenade","deaths",!0),ga("send","event","weapon","deathBy","Suicide"));var R;if(v){Ee.scoreKill(S,v)&&ha(),R=v.name;var w=new T.Vector3(v.x,v.y+.32,v.z);qe.play("shell_burst",w);var I=Math.randomInt(0,10)+1;qe.play("death_scream"+I,w),lo(v,100),_s(v,100),Vc(v,80,.2,40),Gc(v),v.die(),v.actor.mesh.position.x=v.x,v.actor.mesh.position.y=v.y,v.actor.mesh.position.z=v.z}else R="N/A";var F;if(S){if(m===ue&&p!==m&&(Et.streak=S.bestGameStreak,Et.updateTerminus(getKeyByValue(vt,S.charClass),dt[x].name,"kills"),(dt[x].name==="Grenade"||dt[x].name==="Melee")&&ga("send","event","weapon","killedWith",dt[x].name)),F=S.name,!S.isDead()){if(S.scoreKill(),m==ue){var ki=document.getElementById("bestStreak");ki.innerText="x"+S.bestOverallStreak}m==ue&&(wa++,Xi=Math.max(Xi,S.stats.streak))}}else F="N/A";if(p!=ue){if(m==ue){rn&&clearTimeout(rn);var k=document.getElementById("killBox");k.style.display="block",vueApp.killedName=R;var E=document.getElementById("KILL_STREAK");q.stats.streak>1?E.innerText=q.stats.streak+"-KILL STREAK":E.innerText="";var g=1.5,y=mt.set(function(){k.style.transform="scale("+g+","+g+")",g-=.05,g<=1&&(g=1,mt.clear(y))},33);rn=setTimeout(()=>{xe&&(k.style.display="none")},4e3)}}else{ci=!0,ne.parent=null,ne.position=new T.Vector3(Ne.actor.mesh.position.x,Ne.actor.mesh.position.y+.2,Ne.actor.mesh.position.z),S&&(ne.lockedTarget=S.actor.head);var M=document.getElementById("deathBox");M.style.display="block",vueApp.killName=F;var g=2,y=mt.set(function(){M.style.transform="scale("+g+","+g+")",g-=.05,g<=1&&xe&&(mt.clear(y),g=1)},33);Hr++;let xl=Gr&&!O.productBlockAds&&!pokiActive?12:_-1;io(xl),Eo(),Ei.set(function(){xe&&(M.style.display="none",Wt==ue&&la())},3e3)}S&&v&&iu(S,v),Mi();break;case he.chat:var C=Z.unPackInt8U(),D=Z.unPackString();qn(D,C);break;case he.metaGameState:Ee._unPackState(Z);break;case he.syncMe:var Pe=Z.unPackInt8U(),V=Z.unPackInt8U(),G=Z.unPackInt8U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat(),_e=Z.unPackInt8U(),U=Z.unPackInt8U(),z=Z.unPackInt8U(),B=pe[Pe];B.serverStateIdx=G;var H=B.x,W=B.y,X=B.z,K=B.dx,j=B.dy,ee=B.dz,$=B.yaw,L=B.pitch,Q=V,J=B.stateBuffer[Q],te=Math.mod(B.stateIdx-V,Dt)+Vt*8;if(B.lastWeaponChange>te&&(U!==J.rounds||z!==J.store)){for(var re=V;re!=B.stateIdx;re=Math.mod(re+1,Dt)){var le=B.stateBuffer[re];U-=le.shots,le.rounds=U}B.weapon.ammo.rounds=U,B.weapon.ammo.store=z,hi()}if(_e)var ie=Math.length3(J.x-Ge,J.y-Se,J.z-ze);else var ie=Math.length2(J.x-Ge,J.z-ze);if(Ue!=0){if(ie<.1){var ce=Vt*2;B.totalCorrections=ce,B.corrections=ce,B.corrected.dx=Ge-J.x,B.corrected.dy=Se-J.y,B.corrected.dz=ze-J.z;break}var ce=Vt*2}else{if(ie<.02)break;var ce=Vt*2}B.totalCorrections=ce,B.x=Ge,B.y=Se,B.z=ze,B.dx=J.dx,B.dy=J.dy,B.dz=J.dz,B.climbing=J.climbing,B.jumping=J.jumping;for(var de=q.controlKeys;Q!=B.stateIdx;Q=Math.mod(Q+1,Dt))J=B.stateBuffer[Q],B.controlKeys=J.controlKeys,B.yaw=J.yaw,B.update(!0);if(B.climbing)var ie=Math.length3(B.x-H,B.y-W,B.z-X);else var ie=Math.length2(B.x-H,B.z-X);ie<.2?(B.corrections=ce,B.corrected.dx=B.x-H,B.corrected.dy=B.y-W,B.corrected.dz=B.z-X,B.x=H,B.y=W,B.z=X,B.dx=K,B.dy=j,B.dz=ee):B.corrections=0,B.yaw=$,B.pitch=L,B.controlKeys=de;break;case he.syncThem:var Pe=Z.unPackInt8U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat(),_e=Z.unPackInt8U(),B=pe[Pe];if(!B||B.id==ue){for(var Q=0;Q<Vt;Q++)Z.unPackInt8U(),Z.unPackRadU(),Z.unPackRad();break}B.stateIdx=0;for(var Q=0;Q<Vt;Q++)B.stateBuffer[Q].controlKeys=Z.unPackInt8U(),B.stateBuffer[Q].yaw=Z.unPackRadU(),B.stateBuffer[Q].pitch=Z.unPackRad();B.x=Ge,(!B.jumping||Math.abs(B.y-Se)>.5)&&(B.y=Se),B.z=ze,B.stateBuffer[0].x=Ge,B.stateBuffer[0].y=Se,B.stateBuffer[0].z=ze,B.climbing=_e;break;case he.fire:var Pe=Z.unPackInt8U();St.x=Z.unPackFloat(),St.y=Z.unPackFloat(),St.z=Z.unPackFloat(),Si.x=Z.unPackFloat(),Si.y=Z.unPackFloat(),Si.z=Z.unPackFloat();var B=pe[Pe];if(!B)break;Pe!=ue&&(B.weapon.actor.fire(),B.weapon.fireMunitions(St,Si),--B.weapon.tracer<0&&(B.weapon.tracer=B.weapon.constructor.tracer)),mathSeed=Rt;break;case he.melee:var Pe=Z.unPackInt8U();pe[Pe]&&(pe[Pe].meleeCountdown=17,pe[Pe].actor.melee());break;case he.throwGrenade:var Pe=Z.unPackInt8U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat(),Fe=Z.unPackFloat(),ge=Z.unPackFloat(),Qe=Z.unPackFloat(),B=pe[Pe];if(!B)break;B.grenadeCount--,Pe!=ue?(B.actor.head.rotation.x=B.pitch,B.actor.mesh.rotation.y=B.yaw):hi(),B.actor.throwGrenade(),Zt.throwGrenade(B,{x:Ge,y:Se,z:ze},{x:Fe,y:ge,z:Qe});break;case he.explode:var me=Z.unPackInt8U(),ve=Z.unPackInt16U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat(),be=Z.unPackInt8U(),Te=Z.unPackFloat();let Ha=null;me>0&&(Ha=O.catalog.findItemById(ve)),Ic(Ge,Se,ze,be,Te,Ha),St.set(Ge,Se,ze),me==se.Grenade?qe.play(Ha.item_data.sound||"grenade",St):qe.play("gun_rpegg_rocket_hit",St);break;case he.reload:var Pe=Z.unPackInt8U();pe[Pe]&&pe[Pe].reload();break;case he.swapWeapon:var Pe=Z.unPackInt8U(),He=Z.unPackInt8U();pe[Pe]&&pe[Pe].swapWeapon(He);break;case he.hitMe:var at=Z.unPackInt8U(),Fe=Z.unPackFloat(),Qe=Z.unPackFloat();q.hp=at,q.actor.hit(),wi.hit(Fe,Qe);break;case he.hitMeHardBoiled:var De=Z.unPackInt8U(),at=Z.unPackInt8U(),Fe=Z.unPackFloat(),Qe=Z.unPackFloat();q.hp=at,q.hardBoiledValue=De,q.actor.hit(),wi.hit(Fe,Qe),Or();break;case he.hitThem:var Pe=Z.unPackInt8U(),at=Z.unPackInt8U(),B=pe[Pe];if(!B)break;B.hp=at,B.lastDmgType=B.weapon.constructor.id,B.actor.hit(),at>0&&_s(B,Math.clamp(B.hp-at,0,100));break;case he.respawn:Ra=!1;var Pe=Z.unPackInt8U(),Rt=Z.unPackInt16U(),Ge=Z.unPackFloat(),Se=Z.unPackFloat(),ze=Z.unPackFloat(),dr=Z.unPackInt8U(),Ga=Z.unPackInt8U(),Ua=Z.unPackInt8U(),cl=Z.unPackInt8U(),ul=Z.unPackInt8U(),B=pe[Pe];B&&(B.actor.removeFromPlay(),B.randomGen.setSeed(Rt),B.weapons[0].ammo.rounds=dr,B.weapons[0].ammo.store=Ga,B.weapons[1].ammo.rounds=Ua,B.weapons[1].ammo.store=cl,B.grenades=ul,B.respawn(Ge,Se,ze),Pe==ue?(to(),fo(),canvas.requestPointerLock({unadjustedMovement:ae.fastPollMouse}),console.log("CommCode.respawn received from server for this player"),_t.init(),Xn(),Ie.show(),Ie.showDot(),di&&ut.focus()):Mi());break;case he.changeCharacter:var Pe=Z.unPackInt8U(),hl=Z.unPackInt8U(),fl=Z.unPackInt16U(),dl=Z.unPackInt16U(),pl=Z.unPackInt8U(),ml=Z.unPackInt16U(),_l=Z.unPackInt16U(),gl=Z.unPackInt16U(),vl=Z.unPackInt16U(),yl=O.catalog.findItemById(fl),bl=O.catalog.findItemById(dl),Sl=O.catalog.findItemById(ml),Tl=O.catalog.findItemById(_l),El=O.catalog.findItemById(gl),Pl=O.catalog.findItemById(vl),B=pe[Pe];B&&B.changeCharacter(hl,yl,bl,pl,Sl,Tl,El,Pl);break;case he.switchTeam:var Pe=Z.unPackInt8U(),Wr=Z.unPackInt8U(),B=pe[Pe];B&&(Pe==ue&&(Wi=Wr,vueApp.setTeam(Wi),Ee.teamScore[Wr]>=Ee.teamScore[B.team]&&Ee.teamScore[Wr]>0&&(B.canTakeTeamBonus=!1)),B.team=Wr,B.score=0,B.stats.kills=0,B.stats.streak=0,B.bestGameStreak=0,(!Z.isMoreDataAvailable()||Z.peekInt8U()!==he.switchTeam)&&(Nn(),Mi()));break;case he.switchTeamFail:vueApp.showGenericPopup("ui_game_fairteams_header","ui_game_fairteams_text","ok");break;case he.ping:ping=Date.now()-Tn,Ea+=ping,Ri++;var ki=document.getElementById("ping");ping<100?ki.style.color="#0f0":ping<150?ki.style.color="#ff0":ping<200?ki.style.color="#f90":ki.style.color="#f00",ki.innerText=ping+"ms",setTimeout(function(){if(we){var Fi=Ce.getBuffer();Fi.packInt8(he.ping),Fi.send(we),Tn=Date.now()}},1e3);break;case he.gameLocked:notify(vueApp.loc.ui_game_locked,1e4);break;case he.updateBalance:var cs=Z.unPackInt32U();console.log("updating balance from server: "+cs),O.playerAccount.currentBalance=cs;break;case he.expireUpgrade:console.log("upgrade has expired"),Qi();break;case he.beginShellStreak:var Pe=Z.unPackInt8U(),za=Z.unPackInt8U(),B=pe[Pe];B.beginShellStreak(za);break;case he.endShellStreak:var Pe=Z.unPackInt8U(),za=Z.unPackInt8U(),B=pe[Pe];B.endShellStreak(za);break;default:console.log("CommCode error: "+c+"/"+String.fromCharCode(c)+" - previous cmd: "+JSON.stringify(Kr));break}Kr.push(c),Kr.length>4&&Kr.shift()}},we.onclose=t=>{Ar(t.code)}}function fo(){Ie.hide(),Ie.hideDot(),Oi.hide(),Ie.setPowerful(!1),ne.fov=1.25,At=!1,document.getElementById("grenadeThrowContainer").style.visibility="hidden",document.getElementById("eggBreakerContainer").className="off"}function ys(t){var f=document.getElementById("shellStreakMessage");f.innerText=t,f.className="appear";var f=document.getElementById("shellStreakCaption");f.innerText="x"+q.stats.streak+" Shellstreak",f.style.visibility="visible",setTimeout(()=>{document.getElementById("shellStreakMessage").className="disappear";var c=document.getElementById("shellStreakCaption");c.style.visibility="hidden"},3e3)}function Nn(){for(var t=0;t<playerLimit;t++){var f=pe[t];f&&f.actor&&f.actor.updateTeam()}}var an=Math.PI/2;async function Wc(t,f){if(console.log("loadMap()"),Y.init(oe),$t)Re=JSON.parse(localStore.getItem("mapBackup"));else{var c=zi[t].filename,r=await fetch("maps/"+c+".json?"+zi[t].hash);Re=await r.json(),console.log("MAP: "+c),vueApp.setGameDataUi(Re.name)}vueApp.showSpinner("building_map","ui_game_waitforit",!0),Re.sun?oe.sunLight={direction:new T.Vector3(Re.sun.direction.x,Re.sun.direction.y,Re.sun.direction.z),diffuse:T.Color3.FromHexString(Re.sun.color)}:oe.sunLight={direction:new T.Vector3(.2,1,.1),diffuse:new T.Color3.White},Re.ambient?oe.ambientColor=T.Color3.FromHexString(Re.ambient):oe.ambientColor=new T.Color3(.2,.2,.2),Re.fog?(console.log("FOG:",Re.fog),Re.fog.density>0?(oe.fogMode=T.Scene.FOGMODE_EXP2,oe.fogColor=T.Color3.FromHexString(Re.fog.color),oe.fogDensity=Re.fog.density,oe.fogEnabled=!0):(oe.fogEnabled=!1,oe.fogDensity=0)):(oe.fogMode=T.Scene.FOGMODE_EXP2,oe.fogColor=new T.Color4(.5,.55,.6,1),oe.fogDensity=.01),Re.extents.x.min=0,Re.extents.y.min=0,Re.extents.z.min=0;var i=tc(Re,function(o){alert(`The following map meshes were not found:

`+o+`
Try clearing your cache and reload the page!`)});if(Pr.createMapCells(oe,i,Re,null,null,(o,l)=>{vueApp.showSpinner("building_map","ui_game_lights"),jt=Pr.stripTris(ye.data,it,o,l),jt.position.set(.5,.5,.5),jt.receiveShadows=!0,n()}),ri=[],Tt==_i.king)for(var a=1;a<=fn;a++)Pr.createMapCells(oe,i,Re,"DYNAMIC.capture-zone.none",a,(o,l)=>{if(o){let u=new T.Vector3;for(let h of l)u.x+=h.x,u.y+=h.y,u.z+=h.z;u.scaleInPlace(1/l.length),u.x+=.5,u.y+=.6,u.z+=.5,o.capIconPosition=u,o.position.set(.5,.5,.5),o.material=oe.getMaterialByName("colorized"),ri.push(o)}});async function n(){var o;if($t?(o=localStorage.getItem("lightmap"),o=JSON.parse(o)):o=await Xc("maps/"+c+".lightmap?"+zi[t].hash,(S,P)=>{vueApp.showSpinnerLoadProgress(Math.ceil(S/P*100))}),o){for(var l=jt.getVerticesData(T.VertexBuffer.ColorKind),u=0,h=0;u<o.length;u+=3,h+=4)l[h]=o[u]/255,l[h+1]=o[u+1]/255,l[h+2]=o[u+2]/255;jt.updateVerticesData(T.VertexBuffer.ColorKind,l)}if(jt.material=oe.getMaterialByName("map"),jt.freezeWorldMatrix(),!ks){var d=Re.skybox||"default",p=T.MeshBuilder.CreateBox("skyBox",{size:100},oe);p.infiniteDistance=!0;var m=new T.StandardMaterial("skyBox",oe);m.backFaceCulling=!1,m.fogEnabled=!1,m.reflectionTexture=new T.CubeTexture("img/skyboxes/"+d+"/skybox",oe),m.reflectionTexture.coordinatesMode=T.Texture.SKYBOX_MODE,m.diffuseColor=new T.Color3(0,0,0),m.specularColor=new T.Color3(0,0,0),p.material=m}let v=Date.now()-$s;v>3e3?s():setTimeout(()=>s(),3e3-v)}function s(){console.log("Now complete"),$t&&Ft.hide(),setTimeout(()=>{vueApp.hideSpinner()},600),vueApp.hideLoadingScreenAd(),ga("send","timing","load","mapLoaded",Math.round(performance.now())-Math.round(ws),Re.name),f()}}async function Xc(t,f){for(var c=await fetch(t),r=c.body.getReader(),i=+c.headers.get("Content-Length"),a=0,n=[];;){var{done:s,value:o}=await r.read();if(s)break;n.push(o),a+=o.length,f&&f(a,i)}var l=new Uint8Array(a),u=0;for(var h of n)l.set(h,u),u+=h.length;return lightmap=new Uint8Array(l),lightmap}function Lc(){var t=performance.now();if(cr=t,!Er){Ri>10&&(sr=Math.max(sr,ping));var f=1e3/30,c=2;for(_t.update();oa<t;){if(oa+=f,Ci)q.actor.updateLerp(),q.update();else{for(var r=0;r<playerLimit;r++){var i=pe[r];i&&(i.chatLineCap=Math.min(i.chatLineCap+c/120,3),i.playing&&(i.actor.updateLerp(),i.update()))}lt&&lt.update()}q&&(q.weapon&&q.weapon.ammo.rounds==0&&(q.stateIdx%20==0?document.getElementById("ammo").style.color="#f00":q.stateIdx%20==10&&(document.getElementById("ammo").style.color="#fff")),At==!0&&(Gi=Math.min(Gi+.03,1),Gi>0&&(document.getElementById("grenadeThrowContainer").style.visibility="visible",document.getElementById("grenadeThrow").style.height=Gi*100+"%"))),Ci||Zt.updateLogic(),Ee.update()}var a=T.Matrix.Invert(ne.getViewMatrix());gn.copyFrom(T.Vector3.TransformNormal(new T.Vector3(0,0,-1),a)),gn.normalize(),BAWK.update(),fi.update()}}var bs=performance.now();function Nc(){var t=performance.now(),f=Math.min((t-bs)/(1e3/60),8);if(bs=t,ai>=0){var c=O.engine.getFps();ai+=c,Pi++}if(Pi%10==0){As=ai/Pi;var r=document.getElementById("FPS");r.innerText=Math.floor(c+.5),Ne&&!(Ne.activeShellStreaks&je.HardBoiled)&&Or()}if(Ri>10&&(sr=Math.max(sr,ping)),Ci)q.actor.update(f);else{for(var i=0;i<playerLimit;i++){var a=pe[i];a&&(a.chatLineCap=Math.min(a.chatLineCap+f/120,3),a.playing&&(a.actor.handsToWeaponSkeleton(),a.actor&&a.actor.update(f)))}lt&&lt.actor.update(f)}q&&(wi.update(f),Ie.update(f)),Ci||(Zt.updateActors(f),ca.update(f),Yi(Bt,f),Yi(Hi,f),Yi(aa,f),Yi(na,f),Yi(yolkManager,f),Yi(sa,f)),Zi&&(en+=.002*f,ne.position.x=Math.sin(en)*ye.height+ye.width/2,ne.position.z=Math.cos(en)*ye.height+ye.depth/2,ne.setTarget(new T.Vector3(ye.width/2,ye.height/4,ye.depth/2))),gt&&ui.update(f)}function ua(t,f,c,r,i){let a=f.player;if(a.lastDamageGivenType=f.dmgTypeId,t.lastDamageTakenType=f.dmgTypeId,!(!t.playing||t.shield>0)){var n=Math.max(0,Math.floor(t.hp-c));n>0&&lo(t,Math.clamp(c,0,100))}}function Or(){if(Ne.activeShellStreaks&je.HardBoiled){var f=document.getElementById("hardBoiledContainer");f.style.visibility!="visible"&&(f.style.visibility="visible",document.getElementById("healthContainer").style.visibility="hidden");var t=Math.floor(Ne.hardBoiledValue);document.getElementById("hardBoiledValue").innerText=t;var f=document.getElementById("hardBoiledShieldFill");f.style.clipPath="inset("+(100-t)+"% 0 0 0)"}else{var f=document.getElementById("healthContainer");f.style.visibility!="visible"&&(f.style.visibility="visible",document.getElementById("hardBoiledContainer").style.visibility="hidden");var c=document.getElementById("healthBar"),r=document.getElementById("healthHp"),i=2.3-Ne.hp/43.478;c.setAttribute("stroke-dashoffset",i*6.2832+"em");var t=Math.floor(Ne.hp);r.innerText=t}}var Tn;function jc(){if(q){var t=Ce.getBuffer();t.packInt8(he.syncMe),t.packInt8(Math.mod(q.stateIdx-Vt,Dt)),t.packInt8(q.serverStateIdx);for(var f=Math.mod(q.stateIdx-Vt,Dt),c=0;c<Vt;c++){var r=Math.mod(f+c,Dt);t.packInt8(q.stateBuffer[r].controlKeys),t.packInt8(q.stateBuffer[r].shots),t.packRadU(q.stateBuffer[r].yaw),t.packRad(q.stateBuffer[r].pitch),q.stateBuffer[Math.mod(r-Dt/2,Dt)].shots=0}t.send(we)}}function Kc(){if(ci){console.log("Team switch requested");var t=Ce.getBuffer();t.packInt8(he.switchTeam),t.send(we)}}function Qc(){if(xe){Ee.suppressSound=!0;var t=Ce.getBuffer();t.packInt8(he.refreshGameState),t.send(we)}}function po(t){t.id==ue&&(Wt=t.id);var f=new fe(t,oe);if(f.id==ue)q=f,Ne=f,q.ws=we,hi();else{let c=zt.findIndex(r=>r.uniqueId===t.uniqueId);c>=0&&zt.splice(c,1),zt.push({id:t.id,uniqueId:t.uniqueId,name:t.name,muted:t.muted,isGameOwner:t.isGameOwner}),zt.length>50&&zt.shift()}f.playing||f.actor.removeFromPlay(),pe[t.id]=f,Mi()}function Zc(t){var f=pe[t];if(t==ue){console.log("Tried to remove ME");return}f&&(f.actor.remove(),Wt===t&&ui.unlock(),delete pe[t],Mi())}function En(t){if(t){try{let f=JSON.parse(t);if(f.length>0&&hasValue(f[0]))return f.find(c=>c.active)}catch{}return!1}return!1}function qc(t){return t.hideBadge?!1:t.upgradeProductId&&t.upgradeProductId>0||t.social.length>2&&t.social.includes('"active": true')}function jn(t){for(let f=0;f<playerLimit;f++)if(pe[f]&&pe[f].uniqueId===t)return pe[f];return zt.find(f=>f.uniqueId===t)}function mo(t,f,c){let r=jn(t);if(r)return function(){var i={uniqueId:t,isGameOwner:r.isGameOwner,muted:r.muted,playerName:r.name,muteFunc:function(){Bc(t)},bootFunc:function(){Jc(t)},banFunc:function(a,n){$c(t,a,n)},infoFunc:function(){eu(t)},reportFunc:function(a){Yc(t,a)},social:f,vipMember:c};vueApp.showPlayerActionsPopup(i)}}function Mi(){Ti[0]=0,Ti[1]=0,Ti[2]=0;for(var t=[],c=0;c<playerLimit;c++)pe[c]&&(t.push(c),Ti[pe[c].team]++);fi.sortPlayerList(t);var f=document.getElementById("playerList").children,c;for(c=0;c<t.length;c++){var r=pe[t[c]],i=f[c],a=i.children[0],n=a.children[0],s=a.children[1],o=i.children[1];if(n.classList.add("playerSlot--name"),s.classList.add("playerSlot--score"),o.classList.add("playerSlot--icons"),i.style.display="block",i.style.opacity=1,n.innerText=r.name,r.id!=ue){let S=r.hideBadge?!1:En(r.social),P=r.upgradeProductId&&r.upgradeProductId>0&&!r.hideBadge;i.onclick=mo(r.uniqueId,S,P),i.style.pointerEvents="all",i.style.cursor="pointer",r.playing||(i.style.opacity=.3)}s.innerText=r.score,a.classList.add("playerSlot--name-score");let l="playerSlot--name-score",u="playerSlot-player-is-me",h="playerSlot-player-is-them",d="";gt&&si===li.firstPerson&&r.id===ui.playerIdx&&(d="playerSlot-spectating"),r.id==ue?a.className=`${l} ${u} ${Ht.meClass[r.team]}`:a.className=`${d} ${l} ${h} ${Ht.themClass[r.team]}`,o.innerText="";let p=document.createElement("i"),m=document.createElement("i"),_=document.createElement("i");p.className="fas fa-egg hidden text_gold vip-egg";let v=En(r.social);v&&(p.className=`fab ${SOCIALMEDIA[v.id]} hidden`),m.className="fas fa-ban hidden",qc(r)&&p.classList.remove("hidden"),r.muted&&m.classList.remove("hidden"),_.className="fas fa-exclamation-triangle red hidden",Ds===r.uniqueId&&_.classList.remove("hidden"),o.appendChild(p),o.appendChild(m),o.appendChild(_)}for(;c<playerLimit;)f[c].style.display="none",c++}function Jc(t){var f=Ce.getBuffer();f.packInt8(he.bootPlayer),f.packString(t),f.send(we)}function $c(t,f,c){var r=Ce.getBuffer();r.packInt8(he.banPlayer),r.packString(t),r.packString(f),r.packInt8(c),r.send(we)}function Bc(t){for(let c=0;c<playerLimit;c++){var f=pe[c];if(f&&f.id!==ue&&f.uniqueId===t){f.muted?(f.muted=!1,ae.safeNames||(f.name=f.normalName)):(f.muted=!0,ae.safeNames||(f.name=f.safeName)),f.actor.setupNameSprite(),Mi();break}}var f=zt.find(c=>c.id!==ue&&c.uniqueId===t);f&&(f.muted=!f.muted)}function Yc(t,f){var c=Ce.getBuffer();c.packInt8(he.reportPlayer),c.packString(t),c.packInt8(f),c.send(we),vueApp.showGenericPopup("report_confirm_title","report_confirm_message","ok")}function eu(t){let f=jn(t);if(!f)return;let c=new BroadcastChannel("ShellShockersAdmin");c.postMessage({cmd:"getPlayer",id:f.dbId,ip:f.ip}),c.close()}function hi(){if(q){var t=document.getElementById("weaponName");t.innerHTML=q.weapon.constructor.weaponName,t=document.getElementById("ammo"),t.style.color="#fff";var f=q.weapon.ammo,c=Math.max(Math.min(f.rounds,f.capacity),0),r=Math.max(Math.min(f.store,f.storeMax),0);t.innerHTML=c+"/"+r;for(var i=1;i<=3;i++)q.grenadeCount>=i?document.getElementById("grenade"+i).src="img/ico_grenade.png?v=1":document.getElementById("grenade"+i).src="img/ico_grenadeEmpty.png?v=1"}}var Li=null;function Kn(){Li=null,document.addEventListener("keydown",bo),document.addEventListener("keyup",So)}function Qn(){document.removeEventListener("keydown",bo),document.removeEventListener("keyup",So)}function _o(t,f){var c;if(gt)c=ar[t].spectate[f],c||(c=ar[t].game[f]),si===li.firstPerson&&(f==="ARROWUP"&&(c="up"),f==="ARROWDOWN"&&(c="down"));else var c=ar[t].game[f];return c}function wr(t,f){if(!(!gt&&(!q.playing||!document.pointerLockElement))){var c=_o(t,f);vr(c)}}function vr(t){switch(t){case"up":case"down":case"left":case"right":case"jump":case"ascend":case"descend":var f=Le[t];Ue|=f;break;case"inspect":document.pointerLockElement&&q&&q.actor.inspect();break;case"melee":document.pointerLockElement&&q&&_t.add(_t.melee);var f=Le[t];Ue|=f;break;case"fire":document.pointerLockElement&&q&&_t.add(_t.fire);var f=Le[t];Ue|=f;break;case"grenade":document.pointerLockElement&&q&&!At&&q.canSwapOrReload()&&q.grenadeCount>0&&(At=!0,Gi=-.15);break;case"scope":var f=Le[t];ae.holdToAim?Ue|=f:q.scope?Ue^=Ue&f:Ue|=f;break;case"reload":_t.add(_t.reload);break;case"swap_weapon":_t.add(_t.swap);break;case"toggle_freecam":gt&&(si===li.freeCamera?(si=li.firstPerson,ui.firstPerson()):(si=li.freeCamera,ui.freeCamera()));break}}function Ir(t,f){if(!(!gt&&(!q.playing||!document.pointerLockElement))){var c=_o(t,f);yr(c)}}function yr(t){switch(t){case"fire":var f=Le[t];Ue^=Ue&f;break;case"scope":if(ae.holdToAim){q.scopeOut();var f=Le[t];Ue^=Ue&f}break;case"grenade":document.pointerLockElement&&q&&At&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden",At=!1,q.throwGrenade(Gi));break;case"up":if(gt&&si===li.firstPerson){ui.spectateNextPlayer(-1),Ue=0;break}case"down":if(gt&&si===li.firstPerson){ui.spectateNextPlayer(1),Ue=0;break}case"left":case"right":case"jump":case"melee":case"ascend":case"descend":var f=Le[t];Ue^=Ue&f;break}}var _r;function tu(){if(!_r){_r=window.open("","","name=Debug"),_r.document.write("<pre>");return}for(var t=0;t<playerLimit;t++){var f=pe[t];if(f){var c={name:f.name,hp:f.hp,playing:f.playing,posX:f.x,posY:f.y,posZ:f.z,actorX:f.actor.mesh.position.x,actorY:f.actor.mesh.position.y,actorZ:f.actor.mesh.position.z,transformEnabled:f.actor.mesh.isEnabled(),transformVisible:f.actor.mesh.isVisible,transformFrozen:f.actor.mesh.isWorldMatrixFrozen,shellEnabled:f.actor.bodyMesh.isEnabled(),shellVisible:f.actor.bodyMesh.isVisible,shellFrozen:f.actor.bodyMesh.isWorldMatrixFrozen,weaponEnabled:f.weapon.actor.gunMesh.isEnabled(),weaponVisible:f.weapon.actor.gunMesh.isVisible};_r.document.write(JSON.stringify(c)+`
`)}}_r.document.write("<hr>")}function iu(t,f){var c=[` ${ke("ingame_kill_text_scrambled")} `,` ${ke("ingame_kill_text_beat")} `,` ${ke("ingame_kill_text_poached")} `,` ${ke("ingame_kill_text_whipped")} `,` ${ke("ingame_kill_text_fried")} `,` ${ke("ingame_kill_text_cracked")} `],r='<span style="color: '+Ht.text[t.team]+'">'+t.name+"</span>"+c[Math.randomInt(0,c.length)]+'<span style="color: '+Ht.text[f.team]+'">'+f.name+"</span>",i=(Ai.innerHTML.match(/<br>/g)||[]).length;i>4&&(Ai.innerHTML=Ai.innerHTML.substr(Ai.innerHTML.search("<br>")+4)),Ai.innerHTML+=r+"<br>"}function Zn(){canvas.focus(),ut.style.display="block",ut.value=ke("ingame_press_enter_to_chat"),ut.style.background="transparent",ut.blur(),di=!1}function qn(t,f,c,r){let i=document.createElement("div"),a=document.createElement("span"),n=document.createElement("div"),s=document.createElement("span"),o=document.createElement("i"),l=!1,u=!1,h=!1;if(i.classList.add("chat-item"),n.style.display="inline-block",f>253)f===255?(s.textContent="SERVER: ",n.style.color="#ff0"):f===254&&(s.textContent="MOD: ",n.style.color="#0f0"),s.classList.add("chat-player-name","ss_marginright_xs"),n.appendChild(s);else{let p=pe[f];if(gs.innerHTML=t,t=gs.textContent.trim(),f===ue||f!==null&&p&&!p.muted&&t.length>0&&!Qs(t)&&t.indexOf("<")<0)l=!!(p.upgradeProductId&&p.upgradeProductId>0),u=En(p.social),u&&!p.hideBadge?(o.classList.add("fab",SOCIALMEDIA[u.id]),o.classList.add("ss_marginright_xs")):l&&!p.hideBadge&&(o.classList.add("fas","fa-egg","hidden","text_gold","vip-egg"),o.classList.add("ss_marginright_xs")),h=p.uniqueId,s.classList.add("chat-player-name","ss_marginright_xs"),s.textContent=p.name+": ",console.log(p.name,t),n.style.color=Ht.text[p.team],n.appendChild(o),n.appendChild(s);else if(f!==null)return}let d=vi.querySelectorAll(".chat-item");d.length>4&&d[0].remove(),r&&(t=t.format(r)),a.innerHTML=t,i.appendChild(n),i.appendChild(a),i.classList.add("clickme"),i.onclick=()=>{!h&&c?c():h!=q.uniqueId&&(s.classList.add("clickme"),mo(h,u,l)())},vi.appendChild(i),Vi&&(Vi.scrollTop=Vi.scrollHeight)}function go(t){var f=Ce.getBuffer();f.packInt8(he.chat),f.packString(t),f.send(we)}function ru(t){t=t||window.event;var f=t.key;switch(ut.value=Aa(ut.value,280),f){case"Enter":var c=ut.value.trim();c!=""&&c.indexOf("<")<0&&(go(c),nr||qn(c,ue),q.chatLineCap--,Jr++,Jr===1&&ga("send","event","game","stats","chat",Jr));case"Tab":t.preventDefault(),t.stopPropagation(),yo();break}}function vo(){q.chatLineCap>0&&(Qn(),ut.style.background="rgba(0, 0, 0, 0.5)",ut.value="",ut.focus(),Li=null,di=!0)}function yo(){Zn(),Kn()}function bo(t){t=t||window.event;var f=t.key;if(f!=Li){if(Li=f,!At&&Ue==0&&f=="Enter"&&ae.enableChat){vo();return}di||f=="Tab"&&(c="ESCAPE",t.preventDefault(),Ec("down"));var c=(""+f).toLocaleUpperCase();if(c==" "&&(c="SPACE",t.preventDefault()),Yo){if(c=="`"){tu();return}if(c=="\\"){Ci=!0;for(var r=0;r<oe.particleSystems.length;r++)oe.particlesPaused=!0;for(var r=0;r<playerLimit;r++)pe[r]&&pe[r].actor&&(pe[r].actor.mesh.setVisible(!0),pe[r].actor.showNameSprite(),pe[r].actor.positionNameSprite());we.close()}}wr("keyboard",c)}}function So(t){t=t||window.event;var f=t.key;f==Li&&(Li=null);var c=(""+f).toLocaleUpperCase();c==" "&&(c="SPACE",t.preventDefault()),Ir("keyboard",c)}function Jn(){this.crosshairs=new T.AbstractMesh("",oe),this.crosshairs.setEnabled(!1),this.crosshairs.position.z=2;var t=[new T.Vector3(-1,0,0),new T.Vector3(1,0,0)],f=T.MeshBuilder.CreateLines("",{points:t},oe);f.layerMask=536870912,f.color=T.Color3.Black(),f.parent=this.crosshairs,t=[new T.Vector3(0,-1,0),new T.Vector3(0,1,0)],f=T.MeshBuilder.CreateLines("",{points:t},oe),f.layerMask=536870912,f.color=T.Color3.Black(),f.parent=this.crosshairs}Jn.prototype.show=function(){var t=O.engine.getRenderHeight();this.crosshairs.scaling.x=t/2,this.crosshairs.scaling.y=t/2,this.crosshairs.setEnabled(!0),document.getElementById("scopeBorder").style.display="flex",ne.viewport.width=t/O.engine.getRenderWidth(),ne.viewport.x=.5-ne.viewport.width*.5};Jn.prototype.hide=function(){this.crosshairs.setEnabled(!1),document.getElementById("scopeBorder").style.display="none",ne.viewport.width=1,ne.viewport.x=0};function Ia(){this.mesh=new T.Mesh("hitIndicator",oe),this.mesh.updatable=!0,this.mesh.hasVertexAlpha=!0,this.positions=[0,0,0,0,.5,0,.5,.5,0,.5,0,0,.5,-.5,0,0,-.5,0,-.5,-.5,0,-.5,0,0,-.5,.5,0];var t=[0,1,8,0,2,1,0,2,1,0,3,2,0,3,2,0,4,3,0,4,3,0,5,4,0,5,4,0,6,5,0,6,5,0,7,6,0,7,6,0,8,7,0,8,7,0,1,8];this.colors=new Array(48).fill(0);for(var f=0;f<48;f+=4)this.colors[f]=1,this.colors[f+1]=.9,this.colors[f+2]=0,this.colors[f+3]=-.5;var c=new T.VertexData;c.positions=this.positions,c.indices=t,c.colors=this.colors,c.applyToMesh(this.mesh,!0),this.mesh.layerMask=536870912,this.mesh.material=oe.getMaterialByName("ui"),this.resize()}Ia.prototype.resize=function(){this.mesh.scaling.x=O.engine.getRenderWidth(),this.mesh.scaling.y=O.engine.getRenderHeight()};Ia.prototype.update=function(t){for(var f=7;f<48;f+=4)this.colors[f]-=(this.colors[f]+.5)/10*t;var c=Math.pow(.9,t);q&&q.playing&&(ne.position.x*=c,ne.position.z*=c),this.mesh.updateVerticesData(T.VertexBuffer.ColorKind,this.colors,!0)};Ia.prototype.hit=function(t,f){var c=-Math.atan2(t,-f),r=Math.radRange(c-q.yaw+.393);r=Math.floor(r/Math.PI2*8);var i=new T.Vector2(-this.positions[r*3+3],-this.positions[r*3+4]).normalize();ne.position.x=i.x*.03,ne.position.z=i.y*.03,this.colors[r*4+7]=2};function pi(){this.crosshairs=[],this.shotBrackets=[];for(var t=0;t<4;t++)this.crosshairs.push(document.getElementById("crosshair"+t)),this.shotBrackets.push(document.getElementById("shotBracket"+t));this.crosshairReticle=document.getElementById("crosshairContainer"),this.readyBrackets=document.getElementById("readyBrackets"),this.shotReticle=document.getElementById("shotReticleContainer"),this.redDotReticle=document.getElementById("redDotReticle"),this.reticleDot=document.getElementById("reticleDot")}pi.prototype.show=function(){if(document.getElementById("reticleContainer").className="",q.weapon.constructor.readySpread){this.readyBrackets.className="notReady";var t=.625*100+"vw";this.readyBrackets.style.width=t,this.readyBrackets.style.height=t}else this.readyBrackets.className="hideme";this.redDotReticle.className="hideme",this.crosshairReticle.className=q.weapon.constructor===Oe?"hideme":"",this.shotReticle.className=q.weapon.constructor===Oe?"":"hideme"};pi.prototype.hide=function(){document.getElementById("reticleContainer").className="hideme"};pi.prototype.hideDot=function(){this.reticleDot.className="hideme"};pi.prototype.showDot=function(){ae.centerDot&&(this.reticleDot.className="")};pi.prototype.fireDenied=function(){this.readyBrackets.className="";var t=this;setTimeout(function(){t.readyBrackets.className="notReady"},10)};pi.prototype.setPowerful=function(t){for(var f=0;f<4;f++){var c=this.crosshairs[f],r=this.shotBrackets[f];t?(c.classList.remove("normal"),c.classList.add("powerful"),r.classList.remove("normal"),r.classList.add("powerful")):(c.classList.add("normal"),c.classList.remove("powerful"),r.classList.add("normal"),r.classList.remove("powerful"))}};pi.prototype.update=function(t){if(ne.forwardRay=ne.getForwardRay(),ne.forwardRay.origin=q.actor.eye.getAbsolutePosition(),q.weapon){var f=q.weapon.accuracy;if(q.weapon.constructor===Oe){var c=f*(200/ne.fov);this.shotReticle.style.width=c+"vh",this.shotReticle.style.height=c+"vh"}else for(var c=f*(50/ne.fov),r=0;r<4;r++){var i=this.crosshairs[r];i.style.transform="rotate("+r*90+"deg) translateY(calc("+c+"vh + 0.12em))"}ne.forwardRay.direction.scaleInPlace(1e3);var a=Y.rayCollidesWithMap(ne.forwardRay.origin,ne.forwardRay.direction,Y.projectileCollidesWithCell);if(a){var n=T.Vector3.Distance(ne.forwardRay.origin,a.pick.pickedPoint);ne.forwardRay.range=n,q.weapon.constructor.minRange&&(n-.01>=q.weapon.constructor.minRange?this.readyBrackets.className="ready":this.readyBrackets.className="notReady")}else q.weapon.constructor.minRange&&(this.readyBrackets.className="ready"),ne.forwardRay.range=1e6;q.weapon.constructor.burst&&(ne.fov-q.weapon.actor.scopeFov<.006?this.redDotReticle.className="":this.redDotReticle.className="hideme")}};pi.prototype.resize=function(){};function au(){let t=vueData.gameTypes.find(({value:c})=>c===Tt),f=vueData.googleAnalytics;Ch([[f.cat.play,f.action.shareGameCopy,`Map - ${Re.name}`,""],[f.cat.play,f.action.shareGameCopy,t.locKey?`Game type - ${t.locKey}`:"n/a",""],[f.cat.play,f.action.shareGameCopy,`Play type - ${tr}`,""]])}function $n(){var t=dynamicContentPrefix==""?parsedUrl.root:dynamicContentPrefix,f=t+"#"+xr;let c=crazysdk.inviteLink({crazyShare:xr}),r=crazyGamesActive?c:f;vueApp.showShareLinkPopup(r),ta=!1}function nu(t){t.select(),au();try{navigator.clipboard?navigator.clipboard.writeText(t.value):document.execCommand("copy")}catch{console.log("Unable to copy to clipboard")}}function To(t,f){if(Ci)return!0;for(var c=f||t.getBoundingInfo().boundingBox.center.z,r=t.position.x-ne.globalPosition.x,i=t.position.y+c-ne.globalPosition.y,a=t.position.z-ne.globalPosition.z,n=Math.length3(r,i,a),s=Math.normalize3({x:r,y:i,z:a},.9),o=ne.globalPosition.x,l=ne.globalPosition.y,u=ne.globalPosition.z,h=0,d=0;d<n-.9&&(o+=s.x,l+=s.y,u+=s.z,!(o<0||o>=ye.width||u<0||u>=ye.depth||l<0||l>=ye.height));d+=.9){var p=ye.data[Math.floor(o)][Math.floor(l)][Math.floor(u)];if(p.idx){var m=it[p.idx];if(m.colliderType=="full"&&!m.softness&&(h++,h==2))return!1}}return!0}function su(){O.engine.stopRenderLoop(),kt.startRendering()}function ou(t){O.engine.stopRenderLoop(),Ln(t),_n=!0,di&&ut.focus()}function lu(){ut=document.getElementById("chatIn"),vi=document.getElementById("chatOut"),Ai=document.getElementById("killTicker");var t=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},f=document.getElementById("playerList");t(f);for(var c=document.getElementById("playerSlot"),r=0;r<20;r++){var i=c.cloneNode(!0);f.appendChild(i)}vi.innerHTML="",ae.enableChat==!0&&(Zn(),vi.style.display="block",ut.style.display="block"),Ai.innerHTML="",vi.value="",document.getElementById("killBox").style.display="none",document.getElementById("deathBox").style.display="none",document.getElementById("scopeBorder").style.display="none",document.getElementById("spatulaPlayer").className="drop",document.getElementById("spectate").style.display="none",document.getElementById("teamScores").style.display=Tt==_i.ctf?"block":"none",document.getElementById("captureContainer").style.display=Tt==_i.king?"block":"none",document.getElementById("captureIconContainer").style.display="none",document.getElementById("shellStreakMessage").classList.remove("appear"),document.getElementById("shellStreakMessage").classList.add("disappear"),document.getElementById("shellStreakCaption").style.visibility="hidden",document.getElementById("eggBreakerContainer").className="off",document.getElementById("playerList").style.pointerEvents="auto",Ie&&Ie.setPowerful(!1),console.log("resetGameUI")}function ha(){for(var t=1;t<=2;t++){var f=document.getElementById("teamScoreNum"+t);f.innerText=Ee.teamScore[t];var c=document.getElementById("teamScore"+t);lt&&(lt.controlledByTeam==t?c.classList.replace("inactive","active"):lt.lastControlTeam!=t&&c.classList.replace("active","inactive"))}}function cu(){console.log("Event listeners added"),canvas.focus(),canvas.style.pointerEvents="all",canvas.addEventListener("mousedown",ro,!1),canvas.addEventListener("mouseup",ao,!1),canvas.addEventListener("pointermove",no),canvas.addEventListener("wheel",so),addEventListener("gamepadbuttondown",Po)}function Eo(){console.log("Event listeners removed"),canvas.style.pointerEvents="none",canvas.removeEventListener("mousedown",ro),canvas.removeEventListener("mouseup",ao),canvas.removeEventListener("pointermove",no),canvas.removeEventListener("wheel",so),removeEventListener("gamepadbuttondown",Po)}function Po(t){t.detail==8&&document.exitPointerLock()}var Ni=class{constructor(){this.teamScore=[0,0,0],this.suppressSound=!0,this.lastLeadingTeam=1}update(){}scoreKill(f,c){}_unPackState(f){this.unPackState(f),this.suppressSound=!1}playSound(f){this.suppressSound||BAWK.play(f)}resetRound(){q&&(q.canTakeTeamBonus=!0)}getTeamWithMostKills(){let f=this.lastLeadingTeam,c=[0,0,0];for(let r=0;r<playerLimit;r++){let i=pe[r];i&&(c[i.team]+=i.score)}return c[1]>c[2]?f=1:c[2]>c[1]&&(f=2),this.lastLeadingTeam=f,f}getTeamWithHighestScore(){let f=this.lastLeadingTeam;return this.teamScore[1]>this.teamScore[2]?f=1:this.teamScore[2]>this.teamScore[1]&&(f=2),this.lastLeadingTeam=f,f}static otherTeam(f){return f.team==1?2:1}},hr=class{constructor(){}update(){}render(){}sortPlayerList(){}sortPlayerListByKills(f){f.sort((c,r)=>pe[r].score-pe[c].score)}sortPlayerListByTeamKills(f){this.sortPlayerListByKills(f);let c=Ee.getTeamWithMostKills();this.sortPlayerListByLeadingTeam(f,c)}sortPlayerListByTeamScore(f){this.sortPlayerListByKills(f);let c=Ee.getTeamWithHighestScore();this.sortPlayerListByLeadingTeam(f,c)}sortPlayerListByLeadingTeam(f,c){f.sort((r,i)=>pe[i].team==c?1:pe[r].team==c?-1:0)}timeToPlayVideoAd(){return null}playSound(f){Ee.suppressSound||BAWK.play(f)}},Pn=class extends Ni{constructor(){super()}},xn=class extends hr{constructor(){super()}sortPlayerList(f){this.sortPlayerListByKills(f)}},Mn=class extends Ni{constructor(){super()}scoreKill(f){this.teamScore[f]++}unPackState(f){this.teamScore[1]=f.unPackInt16U(),this.teamScore[2]=f.unPackInt16U()}},Cn=class extends hr{constructor(){super()}sortPlayerList(f){this.sortPlayerListByTeamKills(f)}},Rn=class extends Ni{constructor(){super()}scoreKill(f,c){!lt.actor&&lt.controlledBy==c.id&&lt.drop();var r=Ni.otherTeam(c);lt.controlledByTeam==r&&(this.teamScore[r]++,ha())}unPackState(f){this.teamScore[1]=f.unPackInt16U(),this.teamScore[2]=f.unPackInt16U();let c={x:f.unPackFloat(),y:f.unPackFloat(),z:f.unPackFloat()},r=f.unPackInt8U(),i=f.unPackInt8U();if(!lt)lt=new xi(oe,c),lt.controlledBy=r,lt.controlledByTeam=i;else if(lt.controlledBy!=r){var a=["",'<h1 class="blueTeam">'+vueApp.loc.team_blue+"</h1>",'<h1 class="redTeam">'+vueApp.loc.team_red+"</h1>"];if(r==255){if(q.playing){var n=document.getElementById("gameMessage");n.innerHTML=a[lt.controlledByTeam],n.innerHTML+=ke("ingame_dropped_the_spatula"),n.className="show",setTimeout(function(){document.getElementById("gameMessage").className="hide"},3e3)}lt.drop(c)}else{if(q.playing){var n=document.getElementById("gameMessage");n.innerHTML=a[i],n.innerHTML+=ke("ingame_captured_the_spatula"),n.className="show",setTimeout(function(){document.getElementById("gameMessage").className="hide"},3e3)}lt.capture(pe[r])}}ha()}},wn=class extends hr{constructor(){super()}sortPlayerList(f){this.sortPlayerListByTeamScore(f)}},tt=class t extends Ni{constructor(){super(),this.activeZone=null,this.teams=null,this.progress=null,this.numCapturing=null,this.teamsBalanced=!1,this.state=t.state.capturing}update(){if(this.activeZone){if(this.state==t.state.takeover)this.progress>0&&(this.progress-=t.takeOverSpeed);else if(this.state==t.state.capturing&&(this.teams==1||this.teams==2)){let f=t.captureSpeeds[this.numCapturing-1];this.progress+=f}}}unPackState(f){let c=this.activeZone;switch(this.state=f.unPackInt8U(),this.activeZone=f.unPackInt8U(),this.teams=f.unPackInt8U(),this.progress=f.unPackInt16U(),this.numCapturing=f.unPackInt8U(),this.teamScore[1]=f.unPackInt8U(),this.teamScore[2]=f.unPackInt8U(),this.state){case t.state.win:Zt.removeAll(),Er=!0,fi.win(),this.playSound("kotc_roundend");break;case t.state.start:if(Er&&(Er=!1,this.resetRound(),Ti[1]+Ti[2]>2)){var r=document.getElementById("gameMessage");r.innerHTML=ke("ingame_coop_shuffle"),r.className="show",setTimeout(function(){document.getElementById("gameMessage").className="hide"},3e3)}break;case t.state.score:this.playSound("kotc_pointscore");break;case t.state.contested:this.playSound("kotc_contested");break}this.activeZone&&this.activeZone!=c&&this.playSound("kotc_zonespawn"),fi.setCaptureState(this.teams)}},Dr=class t extends hr{constructor(){super(),this.captureBarEl=document.getElementById("captureBar"),this.captureBarTextEl=document.getElementById("captureBarText"),this.captureIconContainer=document.getElementById("captureIconContainer"),this.captureIcon=document.getElementById("captureIcon"),this.captureRingContainer=document.getElementById("captureRingContainer"),this.captureRing=document.getElementById("captureRing"),this.captureIconCaption=document.getElementById("captureIconCaption"),this.previousCapturingTeam=0,this.teamScoreEl=[null,document.getElementById("captureScoreBlue"),document.getElementById("captureScoreRed")]}update(){if(Ee.activeZone==0){this.captureBarTextEl.innerHTML=="&nbsp;"&&(Ti[1]==0||Ti[2]==0)&&(this.captureBarTextEl.innerText=ke("ingame_coop_waiting"));return}if(Ee.state==tt.state.takeover){let f=Math.max(Ee.progress,0);this.setBarProgress(1-f/tt.takeOverTime);let c=Math.cos(cr/100%(Math.PI*2))*.5+.5;T.Color3.LerpToRef(ii[Ee.teams==1?2:1].lightZone,t.zoneColor.takeover,c,t.color),ri[Ee.activeZone-1].colorMult=t.color}else if(Ee.teams==1||Ee.teams==2){let f=Math.min(Ee.progress,1200);this.setBarProgress(f/1200)}if(Ee.state==tt.state.contested){let f=Math.cos(cr/100%(Math.PI*2))*.5+.5;T.Color3.LerpToRef(ii[1].lightZone,ii[2].lightZone,f,t.color),ri[Ee.activeZone-1].colorMult=t.color}if(q&&Ee.activeZone){let f=ri[Ee.activeZone-1].capIconPosition,c=Math.length3(q.x-f.x,q.y-f.y,q.z-f.z),r=Math.max(0,Math.min(c*.5-1+Math.abs(q.y-f.y+.4)*.5,.6));this.captureIconContainer.style.opacity=r,this.captureIconCaption.innerText=Math.floor(c*2)+"M"}}render(){let f=this.captureIconContainer;if(!Ee.activeZone){f.classList.remove("on");return}f.classList.add("on");let c=ne.getViewMatrix().multiply(ne.getProjectionMatrix()),r=ri[Ee.activeZone-1].capIconPosition,i=O.engine.getHardwareScalingLevel(),a=O.engine.getRenderWidth()*i,n=O.engine.getRenderHeight()*i,s=T.Vector3.TransformCoordinates(r,c);s.y*=-1;let o=ne.getDirection(T.Vector3.Forward()),l=ne.globalPosition,u=r.x-l.x,h=r.y-l.y,d=r.z-l.z,p=Math.length3(u,h,d),m=(o.x*u+o.y*h+o.z*d)/p,_=s.x,v=s.y,S,P;if(m<0){_*=-1,v*=-1,S=Math.min(1,1/Math.abs(_)),P=Math.min(1,1/Math.abs(v)),_*=P,v*=S;let x;Math.abs(_)>Math.abs(v)?_=Math.sign(_):v=Math.sign(v)}else S=Math.min(1,1/Math.abs(_)),P=Math.min(1,1/Math.abs(v)),_*=P,v*=S;_=_*(a/2)+a/2,v=v*(n/2)+n/2,_=Math.max(Math.min(_,a*.9),a*.1),v=Math.max(Math.min(v,n*.9),n*.1),f.style.transform="translate("+_+"px,"+v+"px)"}setCaptureState(f){this.teamScoreEl[1].innerText=Ee.teamScore[1]+" / "+tt.goalScore,this.teamScoreEl[2].innerText=Ee.teamScore[2]+" / "+tt.goalScore;let c=null;switch(Ee.activeZone&&(c=ri[Ee.activeZone-1]),Ee.state){case tt.state.win:this.captureBarTextEl.innerText=ke("ingame_coop_nextround"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case tt.state.score:case tt.state.start:this.captureBarTextEl.innerHTML="&nbsp;",this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),this.previousCapturingTeam=0;break;case tt.state.unclaimed:this.captureBarTextEl.innerText=ke("ingame_coop_find"),this.captureBarEl.className="empty",this.captureRing.className="empty",this.captureIcon.setAttribute("class","empty"),c.colorMult=t.zoneColor.unclaimed;break;case tt.state.capturing:var r=["","blue","red"];this.captureBarTextEl.innerText=ke(ii[f].name).toUpperCase()+" "+ke("ingame_coop_capturing")+" ("+Ee.numCapturing+"X)",this.captureBarEl.className=r[f],this.captureRing.className=r[f],this.captureIcon.setAttribute("class",r[f]),f>0&&f!=this.previousCapturingTeam&&(this.previousCapturingTeam=f,q.team==f?this.playSound("kotc_capturing_player"):this.playSound("kotc_capturing_opponents")),c.colorMult=ii[f].lightZone;break;case tt.state.abandoned:var r=["","blueAbandoned","redAbandoned"];this.captureBarTextEl.innerText=ke(ii[f].name).toUpperCase()+" "+ke("ingame_coop_capturing"),this.captureBarEl.className=r[f],this.captureRing.className=r[f],this.captureIcon.setAttribute("class",r[f]),c.colorMult=ii[f].darkZone;break;case tt.state.contested:this.captureBarTextEl.innerText=ke("ingame_coop_contested"),this.captureBarEl.className="contested",this.captureRing.className="contested",this.captureIcon.setAttribute("class","contested");break;case tt.state.takeover:this.captureBarTextEl.innerText=ke("ingame_coop_takeover"),this.captureBarEl.className="takeover",this.captureRing.className="takeover",this.captureIcon.setAttribute("class","takeover");break}for(let i=0;i<ri.length;i++){let a=ri[i];a.visibility=Ee.activeZone==i+1}}setBarProgress(f){let c=this.captureBarEl.style;c.transform="scaleX("+f+")";let r=(1-f)*100;this.captureRingContainer.style.transform="translateY("+r+"%)",this.captureRing.style.transform="translateY("+-r+"%)"}win(){this.setCaptureState(0);let f=document.getElementById("bigMessageContainer");f.style.display="block";let c=Ee.teamScore[1]>Ee.teamScore[2]?1:2;document.documentElement.style.setProperty("--ss-big-message-border-color",ii[c].lightColor),document.getElementById("bigMessage").innerHTML='<span class="bigMessageText" style="color: var(--ss-big-message-border-color)">'+ke(ii[c].name).toUpperCase()+'</span><span class="bigMessageText">&nbsp;'+ke("ingame_coop_win")+"</span>",c==q.team&&q.canTakeTeamBonus?document.getElementById("bigMessageCaption").innerHTML=ke("ingame_coop_bonus")+' +250 <img src="img/ico_goldenEgg.png" style="height: 2em; vertical-align: text-top" />':document.getElementById("bigMessageCaption").innerHTML=ke("ingame_coop_nextroundbig"),setTimeout(()=>{f.style.display="none"},5e3)}timeToPlayVideoAd(){return Ee.teamScore[1]===4||Ee.teamScore[2]===4?!1:null}sortPlayerList(f){this.sortPlayerListByTeamScore(f)}};Dr.zoneColor={unclaimed:new T.Color3(.3,.3,.3),takeover:new T.Color3(.8,.8,.8)};Dr.color=new T.Color3;function br(t){return getComputedStyle(document.documentElement).getPropertyValue(t)}function Zr(t){let f=br(t);return f=f.match(/^\s*rgba?\((\d+),\s*(\d+),\s*(\d+)(,\s*\d+\.*\d+)?\)\s*$/),T.Color3.FromInts(f[1],f[2],f[3])}var ii=[null,{name:"team_blue",lightColor:br("--ss-team-blue-light"),darkColor:br("--ss-team-blue-dark"),lightZone:Zr("--ss-team-blue-light"),darkZone:Zr("--ss-team-blue-dark")},{name:"team_red",lightColor:br("--ss-team-red-light"),darkColor:br("--ss-team-red-dark"),lightZone:Zr("--ss-team-red-light"),darkZone:Zr("--ss-team-red-dark")}],uu=[{logic:Pn,ui:xn},{logic:Mn,ui:Cn},{logic:Rn,ui:wn},{logic:tt,ui:Dr}];window.console=function(t){(!window.console||!t)&&(t={});var f=[];return{dir:function(){t.dir&&t.dir.apply(t,arguments)},log:function(){this.addLog(arguments),t.log&&t.log.apply(t,arguments)},warn:function(){this.addLog(arguments),t.warn&&t.warn.apply(t,arguments)},error:function(){this.addLog(arguments),t.error&&t.error.apply(t,arguments)},info:function(){this.addLog(arguments),t.info&&t.info.apply(t,arguments)},addLog:function(c){var r=c[0];typeof r=="object"&&(r=JSON.stringify(r)),f.push(r),f.length>100&&f.shift()},logArray:function(){return f},clearLog:function(){f=[]},debug:function(c){t.log(c)}}}(window.console);function hu(){return O.playerAccount.getEquippedItems()}function fu(t){switch(t){case se.Hat:return O.catalog.hats;case se.Stamp:return O.catalog.stamps;case se.Primary:return O.catalog.forClass[O.playerAccount.classIdx].forWeaponSlot[nt.Primary];case se.Secondary:return O.catalog.forClass[O.playerAccount.classIdx].forWeaponSlot[nt.Secondary];case se.Grenade:return O.catalog.grenades;case se.Melee:return O.catalog.melee;default:return[]}}function du(t,f){return O.catalog.getTaggedItems(t,f)}function pu(){return O.catalog.getPremiumItems()}function xo(t){return O.playerAccount.isItemOwned(t)}function mu(t,f,c){t.item_type_id===se.Stamp?itemRenderer.renderStampToCanvas(t,f,c):itemRenderer.renderToCanvas(t,f,c)}function _u(t,f){if(f=f||t.item_type_id,t===null||xo(t)||t.unlock==="default")switch(f){case se.Hat:O.playerAccount.hatItem=t;break;case se.Stamp:O.playerAccount.stampItem=t;break;case se.Primary:O.playerAccount.pickWeapon(nt.Primary,t);break;case se.Secondary:O.playerAccount.pickWeapon(nt.Secondary,t);break;case se.Grenade:O.playerAccount.grenadeItem=t;break;case se.Melee:O.playerAccount.meleeItem=t;break}}function gu(t){O.playerAccount.colorIdx=t,kt.poseWithColor(t)}function Da(){let t=O.playerAccount.getEquippedItems();t[se.Grenade]=null,t[se.Melee]=null,kt.posingItems={[se.Primary]:null,[se.Secondary]:null,[se.Grenade]:null,[se.Melee]:null,[se.Hat]:null,[se.Stamp]:null},kt.poseWithItems(t),kt.poseWithColor(O.playerAccount.colorIdx)}O.resetPaperDoll=Da;function vu(){Wl=new Date,O.playerAccount=new Ji;let t=localStore.getItem("localLoadOut");if(t){let f=JSON.parse(t);vueApp.$nextTick(()=>O.playerAccount.applyLocalLoadout(f.items))}console.log("Start account search with Firebase..."),parsedUrl.query.sandbox&&firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION),firebase.auth().onAuthStateChanged(function(f){zn&&!hasValue(f)||(f?(bt=f,bt.isAnonymous?(console.log("Firebase: anonymous user"),Un=bt,Yt||(Gs=!0)):(console.log("Firebase: auth provider: "+bt.providerData[0].providerId),!bt.emailVerified&&bt.providerData[0].providerId=="password"&&(console.log("Firebase: email not yet verified"),un=!0)),Mo()):(console.log("Firebase: no account found"),yu()))})}function Mo(){if(!Sr&&(Sr=!0,zn=!1,Yt=!0,bt.getIdToken(!0).then(f=>{ac(f,Su,Eu,Pu)}).catch(function(f){console.log(f),Sr=!1}),bt.providerData.length>0&&(Xl=bt.providerData[0].providerId),bt.photoURL&&bt.providerData&&bt.providerData.length>0)){var t=bt.photoURL;vueApp.photoUrl=t}}function yu(){console.log("No account created yet :("),Sr=!1,Ta=!0,Yt=!1,Yn(),vueApp.authCompleted()}var In=null;function bu(t){return vueApp.showSpinner("connecting","please_wait"),firebase.auth().signInAnonymously().then(()=>{firebase.auth().onAuthStateChanged(f=>{Yt=!0,Ql=!0,f!==null&&t&&f.isAnonymous&&(Yt=!1,In=t)})}).catch(function(f){console.debug("Failed Firebase anonymous signin, code: {0}, msg: {1}".format(f.code,f.message))})}function Co(){console.log("sending Firebase email verification"),bt.sendEmailVerification()}function Su(t){if(t.hasOwnProperty("dateModified")&&t.hasOwnProperty("dateCreated")&&(Wn=Math.floor(Math.abs(new Date(t.dateModified)-new Date(t.dateCreated))/36e5)>1),t.hasOwnProperty("banRemaining")){var f=t.banRemaining;let c,r=f.split(":"),i=parseInt(r[0]),a=parseInt(r[1]);i>24?c=`${Math.floor(i/24)} ${ke("time_days")}`:i>0?c=`${i} ${ke("time_hours")}`:c=`${a} ${ke("time_minutes")}`,vueApp.showBannedPopup(c)}else t.error?console.log("accountDataResponse Error: "+JSON.stringify(accountDataResponse.error)):(O.playerAccount.signedIn(bt,t),vueApp.authCompleted(),Ta=!0,setTimeout(()=>O.playerAccount.syncToServer(),1e3),Ur(!0),Hn&&(Nl&&tryMidMonthNewYolkerReward(),O.showSigninBonus&&(Fo(),O.showSigninBonus=!1),Yn()),Un!==null?ga("set","vip_status","NoVIP"):(parsedUrl.query.signInPrompt&&parsedUrl.query.closeAfterSign&&window.close(),_c(c=>{c.outData===null?ga("set","vip_status","NoVIP"):c.outData[0].hasOwnProperty("active")&&c.outData[0].active?ga("set","vip_status","IsVIP"):ga("set","vip_status","WasVIP")},c=>console.log("api_getPlayerSubStatus error",c)),Tu()),console.log("Signed in"),!Yt&&In!==null&&(console.log("Nonaccount is now anon. Time for play"),Yt=!0,ts(!1),Oo(In)));Gs=!1}function Tu(){gc(t=>{switch(console.log("Twitch Entitlements status",t),t.status){case"SUCCESS":t.eggsGiven>0&&zr();let f=[];hasValue(t.itemIds)&&t.itemIds.length>0&&(f=O.catalog.findItemsByIds(t.itemIds),f.forEach(c=>{O.playerAccount.isItemOwned(c)||(O.playerAccount.inventory.push(c),console.log("Reward item given, id: "+c.id))})),vueApp.showGiveStuffPopup("give_stuff_twitch_title",t.eggsGiven,f,t.type);break;case"ACCOUNT_DEACTIVATED":console.log("Twitch ACCOUNT_DEACTIVATED");break;default:break}},t=>console.log("api_twitchPlayerEntitlements error",t))}function Eu(){console.log("authorization failed"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInAuthFailed),Ft.hide(),vueApp.authCompleted()}function Pu(t){if(console.log("auth ws closed, code: "+t),t===1006){vueApp.showGenericPopup("signin_failed_title","signin_failed","ok");return}Sr=!1}function Ro(){Za||(Za=new firebaseui.auth.AuthUI(firebase.auth()));var t=xu();Za.start("#firebaseui-auth-container",t),Hn=!0}function xu(){return{autoUpgradeAnonymousUsers:!0,callbacks:{signInSuccessWithAuthResult:Mu,signInFailure:Cu,uiShown:function(t){console.log("UI: showed firebase UI");let f=document.querySelector(".firebaseui-idp-list");if(f){let c=document.createElement("li"),r=document.createElement("button"),i=document.createElement("span"),a=document.createElement("img"),n=document.createElement("span");r.onclick=()=>{vueApp.fbTransferAccountSignin()},r.className="firebaseui-idp-button mdl-button mdl-js-button mdl-button--raised firebaseui-idp-facebook firebaseui-id-idp-button",r.style.backgroundColor="#3b5998",n.className="firebaseui-idp-text firebaseui-idp-text-long",n.textContent="Sign in with Facebook",i.className="firebaseui-idp-icon-wrapper",a.className="firebaseui-idp-icon",a.src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg",c.className="firebaseui-list-item",i.appendChild(a),r.appendChild(i),r.appendChild(n),c.appendChild(r),f.appendChild(c)}}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!1},firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"http://www.bluewizard.com/terms"}}function Mu(t,f){bt=t.user;var c=bt.emailVerified,r=t.credential,i=t.additionalUserInfo.isNewUser,a=t.additionalUserInfo.providerId,n=t.operationType;return vueApp.hideFirebaseSignIn(),a=="password"&&!c&&Co(),console.log("Authing Firebase ID"),Mo(),!1}function Cu(t){if(vueApp.hideFirebaseSignIn(),console.log("Firebase: sign in failure, error code: "+t.code),t.code==="firebaseui/anonymous-upgrade-merge-conflict")zn=!0,firebase.auth().signInWithCredential(t.credential),Un.delete(),setTimeout(()=>{vueApp.$nextTick(()=>{vueApp.urlParamSet=vueApp.urlParams?!0:null,vueApp.shellShockUrlParamaterEvents()})},2e3);else return Promise.resolve()}function Ru(){firebase.auth().signOut().then(function(){O.playerAccount=new Ji,O.playerAccount.loggingOut(),productBlockAds=!1,!pokiActive&&!crazyGamesActive&&(Io(),vueApp.showTitleScreenAd()),setTimeout(()=>vueApp.setDarkOverlay(!1),1500)},function(t){console.log(t)}),ga("set","dimension4","noVip"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.signIn,vueData.googleAnalytics.label.signInOut),vueApp.photoUrl=null,Yn(),Ur(!0),Hn=!1}var we,Ee,fi,wu=!1,q,ue;function Iu(t){let f="",c=document.createElement("canvas").getContext("webgl");f+=c.getParameter(c.VERSION);let r=c.getExtension("WEBGL_debug_renderer_info");r!=null&&(f+=c.getParameter(r.UNMASKED_RENDERER_WEBGL),f+=c.getParameter(r.UNMASKED_VENDOR_WEBGL)),f+=navigator.userAgent+navigator.language,yi=1;for(let n in f)yi=yi*f.charCodeAt(n)%Number.MAX_SAFE_INTEGER;yi+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER;var i={apiKey:"AIzaSyDP4SIjKaw6A4c-zvfYxICpbEjn1rRnN50",authDomain:"shellshockio-181719.firebaseapp.com",databaseURL:"https://shellshockio-181719.firebaseio.com",projectId:"shellshockio-181719",storageBucket:"shellshockio-181719.appspot.com",messagingSenderId:"68327206324"};firebase.initializeApp(i),parsedUrl.query.testMap&&($t=!0),Qa=getStoredString("lastVersionPlayed",Ot),localStore.setItem("lastVersionPlayed",Ot),$a=getStoredString("languageSelected",null);let a=hasValue($a)?$a:wo();if(Tt=getStoredNumber("gameType",Xa.filter(n=>n.shortName==="Spatula")[0].value),Qa&&Qa!=Ot){zo();return}qi(),ni=new Vn,ni.init(),O.catalog=new Ls,O.catalog.getPremiumGunMeshNames(),Qt.connect(),Hh(),ko(),Du(),vueData.maps=zi,Go(a,startVue)}function Du(){let t=getStoredString("selectedLanguage",null);if(!hasValue(t))return;let f=wo();t!=="en"&&t===f&&(console.log("Updating to new localStore for language setting"),localStore.setItem("languageSelected",f),ga("send","event",{eventCategory:vueData.googleAnalytics.cat.playerStats,eventAction:vueData.googleAnalytics.action.langBeforeUpdate,eventLabel:t})),localStore.removeItem("selectedLanguage"),console.log("selectedLanguage item removed")}function wo(){let t=Ja.includes("-")?Ja.split("-")[0].toLowerCase():Ja,f=vueData.languages,c=null;for(let r=0;r<f.length;r++)if(f[r].code===t){c=!0;break}return hasValue(c)?t:"en"}function Io(){Kt=new mn,Kt.init(),Gr=Kt.isAdBlocking()}function ku(){if(vueApp.chwRewardIds=[...vueApp.chwRewardIds,...Jl],window.addEventListener("beforeinstallprompt",f=>{console.log("pwa Ready"),Us=f,Ll=!0}),window.addEventListener("appinstalled",f=>{ga("send","event","pwa","install","success")}),window.mobileAndTabletcheck()){let f=location.protocol+"//"+location.host;window.location.href="http://onelink.to/c95n2x";return}if(qu()||Ju())return;$u(),{canvasWrapper:Kl,canvas}=vueApp.getGameElements(),O.engine=new T.Engine(canvas,!0,{preserveDrawingBuffer:!0,stencil:!0},!1),O.engineCaps=O.engine.getCaps(),O.engine.disableManifestCheck=crazyGamesActive,O.engine.enableOfflineSupport=!crazyGamesActive,yi=1;let t=navigator.userAgent+navigator.language+O.engine.getGlInfo().renderer;for(let f in t)yi=yi*t.charCodeAt(f)%Number.MAX_SAFE_INTEGER;yi+=(navigator.hardwareConcurrency+navigator.maxTouchPoints)%Number.MAX_SAFE_INTEGER,itemRenderer=new Va,Fu(()=>{navigator.onLine&&!$t?vu():(O.playerAccount=new Ji,Ta=!0),Vr.init(),el(),ol(),Rh(),xs("data/shellNews.json",f),xs("data/shellYouTube.json",c);function f(r){vueApp.newsfeedItems=r}function c(r){vueApp.youtubeStreams=r}if(console.log("From EU: "+isFromEU),oi(),ae.autoDetail||kr(ae.highRes),$t){Jt.x=parsedUrl.query.x,Jt.y=parsedUrl.query.y,Jt.z=parsedUrl.query.z,Jt.pitch=parsedUrl.query.pitch,Jt.yaw=parsedUrl.query.yaw,playerLimit=1,we={send:function(){}},xe=!0,vueApp.setInGame(xe),O.engine.stopRenderLoop(),Ys();return}kt=new Ye,Au(),On=new An,Uh(),parsedUrl.query.openSettings&&vueApp.showSettingsPopup(),parsedUrl.query.test&&(Fs=!0),parsedUrl.query.noSkybox&&(ks=!0),Oh(),vueApp.eggStoreItems=ni.getStoreItems(),vueApp.premiumShopItems=ni.getShopItems(),vueApp.subStoreItems=ni.getSubscriptions(),pokiActive&&vueApp.isPlayingPoki(),Cs=!0})}var Nt;function Fu(t){Nt=new T.Scene(O.engine);let f=new T.TargetCamera("camera",T.Vector3.Zero(),Nt);Nt.activeCameras.push(f),console.log("loadResources()"),Ca(Nt),Yl(()=>{console.log("sounds loaded"),Bl(Nt,()=>{console.log("object meshes loaded"),itemRenderer.calculateItemAlignments(),Nt.clearCachedVertexData(),$l(Nt,()=>{console.log("map meshes loaded");var c={name:"SPECIAL.spatula.none"};it.push(c),Nt.cleanCachedTextureBuffer(),t()})})})}function Au(){Rs=!0}function Do(){return hasValue(vueApp)&&vueApp.ready&&Cs&&Ta&&Rs}var Vu=0;function ko(){if(Vu>=100){vueApp.showGenericPopup("uh_oh","error","ok"),ga("send","event",vueData.googleAnalytics.cat.playerStats,vueData.googleAnalytics.action.error,vueData.googleAnalytics.label.waitForGameReadyTimeout);return}Do()?Uu():setTimeout(ko,200)}function Gu(){let t=document.getElementById("changelog-link");t&&t.addEventListener("click",f=>{f.preventDefault(),vueApp.hideChangelogPopup(),vueApp.showScavengerHuntPopup(),ga("send","event","changelog","clicked","showScavengerHuntPopup")})}function Uu(){if(!$t){var t=document.getElementById("onesignal-bell-container");t&&(t.style.display="none"),Gu(),ga("send","event","ads","ad blocker",Gr.toString()),Da(),Qt.getRegions().then(()=>{os(),Fl=!0,qo(),Ou(),Wu()||Ao()||Qu()||ju()||Zu()||Lu()||Vo()||Ku()||Bn()||Nu()||Xu(),Hu(),Zs(f=>{f.length>0&&f[0].type===1&&(vueApp.doubleEggWeekend=!0)},()=>console.log("scheduledEventError")),vueApp.hideSpinner(),Ft.hide(),t&&(t.style.display="none"),console.log("After Game Ready"),vueApp.shellShockUrlParamaterEvents(),zu(),ga("send","timing","load","homeLoaded",Math.round(performance.now()),"home"),Io(),Qi(()=>vueApp.showTitleScreenAd(),()=>vueApp.showTitleScreenAd()),Ws=!0})}}function Fo(){return O.showSigninBonus?(vueApp.ui.bonus.showing=!0,vueApp.showPurchasesPopup([{type:"currency",data:{ids:[],items:[],eggs:vueApp.ui.bonus.amount}}]),!0):!1}function Ao(){if(un){un=!1,vueApp.showResendEmail();return}Fo()}function zu(){hc(c=>{if(c.result==="SUCCESS"&&!c.read){let r=()=>setTimeout(()=>fc(()=>console.log("Notifications: SUCCESS"),()=>console.log("Notification: ERROR")),500),i=[];Object.entries(c.data.type).forEach(a=>{let n=c.data.type[a[0]].ids,s=c.data.type[a[0]].eggs;(n.length>0||s>0)&&(c.data.type[a[0]].items=n.length>0?O.catalog.findItemsByIds([...new Set(n)]):[],i.push({type:a[0],data:c.data.type[a[0]]}))}),i.length>0&&!c.data.read&&vueApp.showPurchasesPopup(i,r)}},(c,r)=>{r&&console.log("Notification check error",r,c)})}function Hu(){return Yt?O.playerAccount.isItemOwned({id:16020})?(vueApp.hasMobileReward=!0,!0):!1:!0}function Ou(){var t=getStoredString("lastUsername",ka());vueApp.setPlayerName(t)}function Wu(){parsedUrl.hash&&parsedUrl.query.observe?(console.log("TRYING TO JOIN GAME AUTOMATICALLY",parsedUrl.hash),nr=!0,Ds=parsedUrl.query.watchPlayer):nr=!1;let t="crazyShare"in parsedUrl.query;if(!parsedUrl.hash&&!t)return!1;let f=t?parsedUrl.query.crazyShare:parsedUrl.hash;return vueApp.showJoinPrivateGamePopup(f),!0}function Xu(){var t=new URLSearchParams(document.location.search);return t.has("storeItem")===!1?!1:(vueApp.showPopupEggStoreSingle(t.get("storeItem")),!0)}function Lu(){var t=new URLSearchParams(document.location.search);if(t.has("showItem")===!1)return!1;var f=parseInt(t.get("showItem")),c=Number.isInteger(f)&&O.catalog.findItemById(f)!==null&&Ul===!1;if(c===!1)return!1;var r=O.catalog.findItemById(f);return vueApp.showItemOnEquipScreen(r),!0}function Vo(t){return ir=t||ir,ir===null?!1:(vueApp.showTaggedItemsOnEquipScreen(ir),!0)}function Bn(){if(ea===null||O.playerAccount.isUpgraded())return!1;vueApp.showChicknWinnerPopup(),ea=null}function Nu(){var t=new URLSearchParams(document.location.search);if(!t.has("purchase"))return!1;if(O.playerAccount.isAnonymous)return vueApp.showGenericPopup("uh_oh","anon_account","ok"),!1;var f=t.get("purchase");return vueApp.showPopupEggStoreSingle(f),!0}function ju(){var t=new URLSearchParams(document.location.search);return t.has("signInPrompt")===!1?!1:(Ro(),vueApp.$refs.firebaseSignInPopup.show(),!0)}function Ku(){return O.vipSubEnded?(vueApp.vipEndedPopup(),!0):!1}function Qu(){var t=new URLSearchParams(document.location.search);if(!t.has("invoice_id")&&!localStore.getItem("xsollaPurchase"))return!1;localStore.removeItem("xsollaPurchase"),window.history.replaceState(null,null,"/"),bc(t.get("invoice_id"),f=>{if(f.result==="SUCCESS"&&(f.details.item_id||f.details.amount)){let c=null;if(f.details.item_id){let r=O.catalog.findItemById(f.details.item_id);c=O.playerAccount.isItemOwned(r)?r:null}return c&&vueApp.showItem(c),vueApp.showGiveStuffPopup("give_stuff_twitch_title",f.details.amount,hasValue(c)?[c]:c),!0}return!1},f=>!1)}function Zu(){let t,f=new URLSearchParams(document.location.search);if(Os.forEach(s=>{f.has(s)&&(t=s)}),!hasValue(t))return!1;console.log("tryUrlParam reward",t);let c=Date.now(),r=localStore.getItem(t),i=432e6;if(hasValue(r)){let s=Number(r)+i;if(c<s)return console.log(t+" reward already given!"),!1}function a(s){is(s,{success(){localStore.setItem(t,c)},prevGiven(){this.success()},expired(){this.succces()},playerNotFound(){vueApp.showGenericPopup("player_not_found_title","player_not_found_desc","ok")},error(){this.playerNotFound()},default(){this.playerNotFound()}})}function n(){console.log(t,"error")}return mc(t,a,n),!0}function Yn(){let t=["lastPreRoll","localLoadOut","showBigAd","lastUsername"];vueApp.ui.socialMedia.footer.forEach(f=>t.push(f.reward+"Rewarded")),t.push(...Os),t.forEach(f=>{localStore.getItem(f)&&localStore.removeItem(f)})}function Go(t,f){fetch(("language/{0}.json?"+Ot).format(t)).then(function(c){c.json().then(function(r){f(t,r)})})}function ke(t){return vueData.loc[t]||"["+t+"]"}function ka(){var t,f,c=["Captain","Lord","Supreme","Master","Pro","Noob"],r=["Egg","Yolk","Shell","Cluck","Chick","Bird"];do f=Math.randomInt(1,99);while(f==69);return Math.randomInt(0,2)==0?t=c[Math.randomInt(0,c.length)]+r[Math.randomInt(0,r.length)]+f:t=r[Math.randomInt(0,r.length)]+c[Math.randomInt(0,c.length)]+f,t}function qu(){return navigator.userAgent.indexOf("Edge")>=0?(vueApp.showUnsupportedPlatformPopup("unsupported_oldmsedge"),!0):!1}function Ju(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var t=[];T.Engine.isSupported()||t.push('{0} (<a href="https://shellshock.io/faq.html#webgl" target="_window">{1}</a>)'.format(vueApp.loc.missing_webgl,vueApp.loc.missing_moreinfo)),(!document.exitPointerLock||navigator.userAgent.indexOf("10.1.2 Safari")>=0)&&t.push('{0} (<a href="https://shellshock.io/faq.html#pointerlock" target="_window">{1}</a>)'.format(vueApp.loc.missing_pointerlock,vueApp.loc.missing_moreinfo)),localStore||t.push(vueApp.loc.missing_localstorage);var f=new KeyboardEvent("");return f.key===void 0&&t.push(vueApp.loc.missing_keyboardevent),vueApp.missingFeatures=t,t.length>0?(vueApp.showMissingFeaturesPopup(),!0):!1}function $u(){if(isChrome84=navigator.userAgent.indexOf("Chrome/84")!==-1,isChrome84&&(T.chrome84BugWorkaround=!0),localStore.getItem("ssChrome84Bug"))return!1;if(isChrome84)return localStore.setItem("ssChrome84Bug",!0),!0}function Bu(){Dn=null;let t="color:red; font-size:60px; font-weight: bold; text-shadow: 0 0 2px black;",f="font-size: 18px;";console.log("%cSTOP!",t),console.log("%cThis is a browser feature intended for developers. If someone told you to copy and paste something here, there is a good chance that they are attempting to gain access to your account and personal information!",f)}var Dn=null;function qi(){clearTimeout(Dn),Dn=setTimeout(()=>Bu(),500),canvas&&(canvas.style.width="100%",canvas.style.height="100%"),O.engine&&(O.engine.resize(),ae&&ae.highRes&&O.engine.setHardwareScalingLevel(ae.highRes)),xe&&(wi&&wi.resize(),Ie&&Ie.resize())}function Yu(t){console.log("setting chat: "+t),t?(ae.enableChat=!0,localStore.setItem("enableChat",!0),xe&&(ut.value=ke("ingame_press_enter_to_chat"),vi.style.display="block",ut.style.display="block")):(ae.enableChat=!1,localStore.setItem("enableChat",!1),xe&&(vi.style.display="none",ut.style.display="none"))}function eh(t){if(xe){for(var f=0;f<playerLimit;f++){var c=pe[f];c&&(t?c.name=c.safeName:c.name=c.normalName,c.actor.setupNameSprite())}Mi()}}function es(){rr&&mt.clear(rr),console.log("Auto detail enabled"),rr=mt.set(()=>{var t=ai/Pi;t<40&&O.engine.getFps()<40&&(oe.shadowsEnabled?(Fr(!1),ae.shadows=!1):(kr(!1),ae.highRes=!1,Uo()),tl())},4e3)}function Uo(){rr&&(mt.clear(rr),rr=null)}function kr(t){console.log("setting high resolution: "+t),O.engine.setHardwareScalingLevel(t?1:2),th()}function Fr(t){console.log("setting shadows: "+t),oe.shadowsEnabled=t,t?jt&&xe&&(jt.material=oe.getMaterialByName("map")):jt&&xe&&(jt.material=oe.getMaterialByName("mapNoShadow"))}function th(){Ie&&Ie.resize(),wi&&wi.resize(),Oi&&Oi.crosshairs.isEnabled()&&Oi.show()}function zo(){var t=window.indexedDB.deleteDatabase("babylonjs");t.onerror=function(f){window.location.reload(!0)},t.onsuccess=function(f){window.location.reload(!0)}}function ih(){xe&&ae.enableChat==!0&&Zn()}function rh(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement){var t=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;t&&t.call(document)}else{var f=document.documentElement,t=f.requestFullscreen||f.webkitRequestFullscreen||f.mozRequestFullScreen||f.msRequestFullscreen;t&&t.call(f)}}function Fa(){O.engine.resize()}document.onfullscreenchange=Fa;document.onmsfullscreenchange=Fa;document.onmozfullscreenchange=Fa;document.onwebkitfullscreenchange=Fa;function ah(t){O.playerAccount.setClass(t)}function Ho(t){O.playerAccount.syncToServer(t)}function ts(t){zs=t,vueApp.disablePlayButton(t)}function Oo(t){if(!zs){if(ts(!0),kt.scale(),Yt&&(Yr=getSetIncrementStoredNum("timesPlayed",1)),!O.productBlockAds){var f=getStoredNumber("lastPreRoll",0),c=!1;if(f==0&&(f=Date.now(),localStore.setItem("lastPreRoll",f)),(Wn||Yr>1)&&(c=!0),Pa||Date.now()>f+24e4&&c){console.log("play() calls PVA"),Kt.play("shellshock.io_preroll",()=>Ss(t)),vueApp.hideTitleScreenAd(),vueApp.hideHeaderAd();return}}Ss(t)}}function Ss(t){if(console.log("play(): "+JSON.stringify(t)),vueApp.setDarkOverlay(!1),vueApp.showSpinner("connecting","please_wait",!0),vueApp.showLoadingScreenAd(),!Yt){console.log("Create account now."),cn=!0,vueApp.onTutorialPopupClick(),ga("send","event","tutorial","newUserPopup"),bu(t);return}(!hasValue(t.playerName)||t.playerName.length===0||/^ *$/.test(t.playerName))&&(t.playerName=ka(),vueApp.setPlayerName(t.playerName)),localStore.setItem("lastUsername",t.playerName),t.playType===vueApp.playTypes.joinPrivate?Qt.joinPrivateGame(t).then(f=>{sn=f.private,t.subdomain=f.subdomain,t.id=f.id,xr=f.id,t.uuid=f.uuid,vueApp.currentRegionId=f.region,Ts(t)}).catch(f=>Ar(f)):Qt.findGame(t).then(f=>{sn=f.private,t.subdomain=f.subdomain,t.id=f.id,xr=f.id,t.uuid=f.uuid,vueApp.currentRegionId=f.region,Ts(t)}).catch(f=>{Qt.getRegions().then(()=>os()),Ar(f)})}function Ts(t){console.log("prepareToJoinGame",t),document.body.scrollTop=document.documentElement.scrollTop=0,ws=performance.now(),vueApp.hideTitleScreenAd(),vueApp.hideHeaderAd(),nh(t)}function Wo(t){let f=dynamicContentRoot||window.location.hostname;return f=f.split("."),f.length>2&&(f=f.slice(-2)),f=f.join("."),`${t}.${f}`}var Xo=null;function nh(t){vueApp.mediaTabsCancelRotate(),console.log("joinGame(), params: "+JSON.stringify(t)),Xo=null,t.playerName=Aa(t.playerName,80),ta=!1,t.playType===vueApp.playTypes.createPrivate?(console.log("create private game"),ta=!0):t.playType===vueApp.playTypes.joinPrivate&&console.log("join private game"),Hl=t.playType;let f=0;function c(){let r=`${isHttps()?"wss":"ws"}://`+Wo(t.subdomain)+"/game/"+t.id;console.log("Connecting to: "+r),we=new WebSocket(r),we.binaryType="arraybuffer",we.onopen=function(i){console.log("WebSocket opened")},we.onclose=function(i){i.code===et.sessionNotFound?(console.log(`Connect attempt #${f} - code: ${i.code}`),++f>10?Ar(i.code):setTimeout(c,1e3)):Ar(i.code)},we.onmessage=function(i){switch(Z.init(i.data),cmd=Z.unPackInt8U(),cmd){case he.socketReady:ga("send","event","play game","class",O.classes[O.playerAccount.classIdx].name);let s=getStoredBool("hideBadge",0)?1:0;ph();var a=Ce.getBuffer();nr?a.packInt8(he.observeGame):a.packInt8(he.joinGame),a.packInt8(O.playerAccount.classIdx),a.packString(t.playerName),a.packString(t.uuid),a.packInt8(s),O.playerAccount.firebaseId&&(a.packInt32(O.playerAccount.session),a.packString(O.playerAccount.firebaseId),a.packString(O.playerAccount.sessionId)),a.send(we);break;case he.musicInfo:var n=Z.unPackLongString();ho(n);break;case he.gameJoined:console.log("CommCode.gameJoined received"),teamScore=[0,0,0],ue=Z.unPackInt8U(),Wi=Z.unPackInt8U(),Tt=Z.unPackInt8U(),Mr=Z.unPackInt8U(),playerLimit=Z.unPackInt8U(),qr=Z.unPackInt8U()==1;let o=Z.unPackInt8U()==1,l=Z.unPackInt8U();qr&&(on=Z.unPackInt8U()==1);let u=uu[Tt];Ee=new u.logic,fi=new u.ui,ha(),wu=Tt==_i.teams||Tt==_i.ctf,console.log("game joined: game type:  "+Tt),vueApp.gameJoined(Tt,Wi),console.log("is game owner: "+qr),xe=!0,vueApp.setInGame(xe);let h=vueData.gameTypes.find(({value:d})=>d===Tt);tr=t.playType===vueApp.playTypes.createPrivate?"createPrivate":sn?"joinPrivate":t.joinCode!==""?"joinPublicByInvite":"joinPublic",Et=new dn,kn=!1,ga("send","event",vueData.googleAnalytics.cat.play,tr,`Map - ${zi[Mr].name}`),ga("send","event",vueData.googleAnalytics.cat.play,tr,`Game type - ${h.locKey}`),ga("send","event",vueData.googleAnalytics.cat.play,tr,vueData.googleAnalytics.action.playerLimit,playerLimit),ga("send","event",vueData.googleAnalytics.cat.play,tr,vueData.googleAnalytics.action.timesPlayed,Yr),Ys();break}}}c()}function Ar(t){if(ts(!1),vueApp.mediaTabsStartRotate(),Zs(r=>{r.length===0?vueApp.doubleEggWeekend=!1:r[0].type},()=>console.log("scheduledEventError")),Ci)return;let f=!1;switch(Object.keys(et).forEach(r=>{et[r]===t&&(console.log("Socket Closed: "+r),f=!0)}),f||console.log("Socket Closed: "+t),t){case et.uuidNotFound:console.log("UUID invalid"),ga("send","event","Websocket","onclose","UUID not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case et.sessionNotFound:console.log("Session not found"),ga("send","event","Websocket","onclose","Session not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect","session_expired_msg","ok");break;case et.gameNotFound:console.log("Game not found"),ga("send","event","Websocket","onclose","Game not found"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_not_found","game_not_found_msg","ok");break;case et.gameFull:case et.gameMaxPlayersExceeded:console.log("Game full"),ga("send","event","Websocket","onclose","Game full"),vueApp.hideSpinner(),vueApp.showGenericPopup("game_full","game_full_msg","ok");break;case et.mainMenu:ga("send","event","Websocket","onclose","Return to main menu");break;case et.regionFull:ga("send","event","Websocket","onclose","Region full"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case et.clusterFullCpu:ga("send","event","Websocket","onclose","Game Cluster max CPU"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case et.clusterFullMem:ga("send","event","Websocket","onclose","Game Cluster max RAM"),vueApp.hideSpinner(),vueApp.showGenericPopup("server_full","server_full_msg","ok");break;case et.booted:xe?vueApp.leaveGame():vueApp.hideSpinner(),vueApp.showGenericPopup("connection_lost","booted","ok");break;case et.gameIdleExceeded:vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","inactivity","ok");break;default:if(xe)ga("send","event","Websocket","onclose","Connection Lost"),vueApp.leaveGame(),vueApp.showGenericPopup("connection_lost","connection_lost_msg","ok");else{var c="";switch(Xo){case he.loginRequired:c="login_required";break;default:c="generic_conn_failed";break}vueApp.hideSpinner(),vueApp.showGenericPopup("cannot_connect",c,"ok")}}}var mt={intervals:{},set:function(t,f){var c=setInterval.apply(window,[t,f].concat([].slice.call(arguments,2)));return mt.intervals[c]=!0,c},clear:function(t){return delete mt.intervals[t],clearInterval(t)},clearAll:function(){for(var t=Object.keys(mt.intervals),f=t.length;f-- >0;)clearInterval(t.shift());mt.intervals={}}},Ei={timeouts:{},set:function(t,f){var c=setTimeout.apply(window,[t,f].concat([].slice.call(arguments,2)));return Ei.timeouts[c]=!0,c},clear:function(t){return delete Ei.timeouts[t],clearTimeout(t)},clearAll:function(){for(var t=Object.keys(Ei.timeouts),f=t.length;f-- >0;)clearTimeout(t.shift());Ei.timeouts={}}};function sh(t){O.engine&&O.engine.stopRenderLoop(),ue=0,Wt=0,xe?(q&&(O.playerAccount.kills+=wa,O.playerAccount.deaths+=Hr,O.playerAccount.streak=Math.max(Xi,O.playerAccount.streak),Et.streak=Xi),mt.clearAll(),Ei.clearAll(),clearInterval(Bs),we.close(et.mainMenu),we=null,Qn(),document.exitPointerLock(),Br>0&&(Bo(Br,zi[Mr].name),Et.end(),Lo(),No(),oh()),oe.dispose(),xe=!1,vueApp.setInGame(xe),ol(),os(),kt=new Ye,t(),jh(),vueApp.hideRespawnDisplayAd()):vueApp.switchToHomeUi(),rs()}var kn=!1;function oh(){if(kn)return;kn=!0;let t=Qo();if(Object.keys(t).length===0||(t.kills&&ga("send","event","player stats","game_stats","total_kills",t.kills),t.deaths&&ga("send","event","player stats","game_stats","total_deaths",t.deaths),!t.hasOwnProperty("charClass")))return;let f=Object.keys(t.charClass);f.length!==0&&f.forEach(c=>{let r=c==="Ranger"?"Free Ranger":c;(t.charClass[c].kills||t.charClass[c].deaths)&&(ga("send","event","player stats","kills",r,t.charClass[c].kills),ga("send","event","player stats","deaths",r,t.charClass[c].deaths),ga("send","event","player stats","kill ratio",r,Math.floor(t.charClass[c].kills/Math.max(t.charClass[c].kills+t.charClass[c].deaths,1)*100)))})}function Lo(t){if(q&&(Et.kills>0||Et.deaths>0)){let f="player stats",c=O.classes[q.charClass].name;Et.kills===0&&Et.deaths>0?ga("send","event",f,"rageQuit",c,Et.deaths):ga("send","event",f,"best kill streak",c,Xi),t&&t()}}function No(){Ri>10&&(ga("send","timing","game","ping",Math.floor(Ea/Ri),vueData.currentRegionId),ga("send","event","game","stats","fps",Math.ceil(ai/Pi)))}function lh(t,f){var c=Vs.getContext("2d");return c.font="bold "+f+"px Nunito, sans-serif",c.measureText(t).width}function Aa(t,f){f=f||80;var c=Vs.getContext("2d");for(c.font="1em Nunito, sans-serif";;){var r=c.measureText(t);if(r.width<f)break;t=t.substr(0,t.length-1)}return t}var ch=[{start:688,end:879},{start:6832,end:6911},{start:7424,end:7679},{start:8352,end:11263},{start:43392,end:43487},{start:57344,end:63743},{start:64256,end:65023},{start:65056,end:65071},{start:65136,end:65279},{start:65520,end:65535}];function jo(t){let f="";for(let c of t){let r=c.codePointAt(0),i=!0;if(r>65535||r==21325||r==21328)i=!1;else for(let a of ch)r>=a.start&&r<=a.end&&(i=!1);i&&(f+=c)}return f}function uh(t){Tt=t,localStore.setItem("gameType",t)}var Ko=["dGV4dENvbnRlbnQ=","b2JzZXJ2ZQ==","TXV0YXRpb25PYnNlcnZlcg==","bGVuZ3Ro","dGFyZ2V0","b3V0ZXJUZXh0"];(function(t,f){var c=function(r){for(;--r;)t.push(t.shift())};c(++f)})(Ko,458);var Mt=function(t,f){t=t-0;var c=Ko[t];Mt.IFPkJC===void 0&&(function(){var i=function(){var s;try{s=Function('return (function() {}.constructor("return this")( ));')()}catch{s=window}return s},a=i(),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.atob||(a.atob=function(s){for(var o=String(s).replace(/=+$/,""),l="",u=0,h,d,p=0;d=o.charAt(p++);~d&&(h=u%4?h*64+d:d,u++%4)?l+=String.fromCharCode(255&h>>(-2*u&6)):0)d=n.indexOf(d);return l})}(),Mt.vaQvzy=function(i){for(var a=atob(i),n=[],s=0,o=a.length;s<o;s++)n+="%"+("00"+a.charCodeAt(s).toString(16)).slice(-2);return decodeURIComponent(n)},Mt.QEYrQv={},Mt.IFPkJC=!![]);var r=Mt.QEYrQv[t];return r===void 0?(c=Mt.vaQvzy(c),Mt.QEYrQv[t]=c):c=r,c},hh=0,fh=new window[Mt("0x0")](t=>{for(var f=0;f<t[Mt("0x1")];f++){var c=t[f];(c[Mt("0x2")][Mt("0x3")][Mt("0x1")]>3e6||c.target[Mt("0x4")].length>3e6)&&(hh=255)}});fh[Mt("0x5")](document,{childList:!![],subtree:!![]});function dh(t){let f=t+"Rewarded";if(ds[f]>=1){localStore.setItem(f,!0);return}ds[f]++;let c=function(a){vueApp.hideSpinner(),is(a,{name:"Social media reward",success(){localStore.setItem(f,!0)},prevGiven(){this.success()},expired(){this.succces()},notFound(){localStore.setItem(f,!1)},playerNotFound(){localStore.getItem(f)&&localStore.removeItem(f)},error(){this.playerNotFound()},default(){this.playerNotFound()}})},r=function(a){console.log("servicesWs Error: "+JSON.stringify(a,["message","arguments","type","name"])),vueApp.showGenericPopup("uh_oh","generic_conn_failed","ok"),vueApp.hideSpinner()};vueApp.showSpinner();let i={};i.tag=La[t],dc(i,c,r)}function is(t,f,c){let r=c||"reward_title";if(hasValue(f.name)||(f.name="Game reward"),t.error)console.log(f.name+" Error: "+JSON.stringify(t.error));else switch(console.log(f.name+" response: "+t.result),t.result){case"SUCCESS":f.success!==void 0&&f.success();var i=0;hasValue(t.eggsGiven)&&t.eggsGiven>0&&(i=t.eggsGiven,zr());var a=[];hasValue(t.itemIds)&&t.itemIds.length>0&&(a=O.catalog.findItemsByIds(t.itemIds),a.forEach(n=>{O.playerAccount.isItemOwned(n)||(O.playerAccount.inventory.push(n),console.log(f.name+" Reward item given, id: "+n.id))})),vueApp.showGiveStuffPopup(r,i,a,c);break;case"REWARD_PREV_GIVEN":f.prevGiven!==void 0&&f.prevGiven(),vueApp.showGenericPopup("uh_oh","reward_already","ok");break;case"REWARD_EXPIRED":f.expired!==void 0&&f.expired(),vueApp.showGenericPopup("uh_oh","reward_expired","ok");break;case"REWARD_NOT_FOUND":f.notFound!==void 0&&f.notFound(),vueApp.showGenericPopup("uh_oh","reward_not_found","ok");break;case"PLAYER_NOT_FOUND":f.playerNotFound!==void 0&&f.playerNotFound();break;case"ERROR":f.error!==void 0&&f.error(),console.log(f.name+" error: "+t.error),vueApp.showGenericPopup("uh_oh","error","ok");break;default:f.default!==void 0&&allbacks.default(),vueApp.showGenericPopup("uh_oh","error","ok");break}}function er(t,f){return ga("send","event","play game",t,f)}function ph(){er("primaryGun",O.playerAccount.getPrimaryWeapon().name),er("SecondaryGun",O.playerAccount.getSecondaryWeapon().name),typeof EGGCOLOR<"u"&&er("eggColor",Object.keys(EGGCOLOR).find(t=>EGGCOLOR[t]===O.playerAccount.colorIdx)),O.playerAccount.hatItem!==null&&er("hat",O.playerAccount.hatItem.name),O.playerAccount.stampItem!==null&&er("stamp",O.playerAccount.stampItem.name),O.playerAccount.grenadeItem!==null&&O.playerAccount.grenadeItem.hasOwnProperty("name")&&er("grenade",O.playerAccount.grenadeItem.name)}var mh=()=>window.self===window.top,_h=()=>{let t=window.location!=window.parent.location?document.referrer:document.location.href,f=new URL(t).hostname.replace(/(www.)/,"").split(".");if(!Array.isArray(f)&&!f.length)return!1;let c=f.length-2;return{domain:f,index:c}};var gh=()=>{if(mh())return console.log("Not playing in iframe"),!0;console.log("Playing in iframe");let t=["poki","poki-gdn","poki.compoki","games.poki","crazygames","1001juegos","ioground","gogy","playgamesio","iogames","iogames","wingsiofree","vseigru","miniclip","red-ball4","speelspelletjes","onlinegame","addictinggames"],f=_h(),c=f.domain,r=f.index;return!0};function rs(){function t(c){c&&(O.playerAccount.setStats(c.statsLifetime,c.statsCurrent),O.playerAccount.eggsSpent=c.eggsSpent,O.playerAccount.eggsSpentMonthly=c.eggsSpentMonthly),vueApp.statsLoading()}function f(c){console.log("Player stats error",c),vueApp.statsLoading()}yc(t,f)}function vh(t,f,c,r){if(O.playerAccount.isItemOwned({id:t})){console.log(f,"already owned!!!");return}Sc(f,i=>{is(i,{name:f,success(){if(c)c();else return},error(){if(r)r();else return}},f)},i=>{console.log(f," error",i)})}function yh(){vh(16039,"giveBasketBrosReward")}function Qo(){return Et?Et.getStats():{}}function Zo(){vueApp.openPhotoBooth()}function bh(t){return ni.getBundlesByItemId(t)}function Sh(t){return ni.getProductTitleByEggVaule(t)}function Th(){return ni.getBundles()}var Vr=class t{static init(){if(this.getGamepads=(navigator.getGamepads||navigator.webkitGetGamepads).bind(navigator),!this.getGamepads){console.log("Gamepad API not detected");return}this.index=null,this.buttonThreshold=.1,this.assist=1,t.detectControllerType(getStoredString("controllerId",ke("p_settings_nocontroller"))),addEventListener("gamepadconnected",f=>{this.buttonState=[],this.lastMoveX=0,this.lastMoveZ=0,this.index=f.gamepad.index;var c=navigator.getGamepads()[f.gamepad.index];console.log("Gamepad connected at index: "+c.index+": "+c.id+". It has "+c.buttons.length+" buttons and "+c.axes.length+" axes."),ga("send","event","game","settings","controller connected",c.id),addEventListener("gamepadbuttondown",this.onButtonDown),addEventListener("gamepadbuttonup",this.onButtonUp),t.detectControllerType(c.id),this.poll(),this.assistInterval=setInterval(t.calculateAssist,67)}),addEventListener("gamepaddisconnected",f=>{f.gamepad.index==this.index&&(cancelAnimationFrame(this.pollLoop),clearInterval(this.assistInterval),this.index=null,removeEventListener("gamepadbuttondown",this.onButtonDown),removeEventListener("gamepadbuttonup",this.onButtonUp),console.log("Gamepad disconnected"),t.detectControllerType(ke("p_settings_nocontroller")))})}static detectControllerType(f){/xbox|xinput/i.test(f)?vueData.controllerType="xbox":/54c/i.test(f)?vueData.controllerType="ps":/pro controller/i.test(f)?vueData.controllerType="switchpro":vueData.controllerType="generic",vueData.controllerId=f,localStore.setItem("controllerId",f)}static applyDeadZone(f){if(isNaN(f))return 0;var c=ae.deadzone,r=(Math.abs(f)-c)/(1-c);return r<0&&(r=0),r*(f>0?1:-1)}static poll(){var f=t.getGamepads(),c=f[t.index];if(c){if(q&&q.playing&&document.pointerLockElement||gt){var r=t.calculateAssist(),i=ae.controllerSpeed*.0025+.005;q.scope&&(i*=.2,r*=2);var a=t.applyDeadZone(c.axes[2]),n=t.applyDeadZone(c.axes[3]),s=Math.length2(a,n);i*=r,q.yaw=Math.radAdd(q.yaw,a*i),q.pitch=Math.max(Math.min(q.pitch+n*ae.controllerInvert*i,1.5),-1.5);var o=t.applyDeadZone(c.axes[0]),l=t.applyDeadZone(c.axes[1]);o<0&&t.lastMoveX>=0?vr("left"):o>=0&&t.lastMoveX<0&&yr("left"),o>0&&t.lastMoveX<=0?vr("right"):o<=0&&t.lastMoveX>0&&yr("right"),l<0&&t.lastMoveZ>=0?vr("up"):l>=0&&t.lastMoveZ<0&&yr("up"),l>0&&t.lastMoveZ<=0?vr("down"):l<=0&&t.lastMoveZ>0&&yr("down"),t.lastMoveX=o,t.lastMoveZ=l}for(var u in c.buttons)c.buttons[u].value>t.buttonThreshold&&!t.buttonState[u]?(t.buttonState[u]=!0,dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:u}))):c.buttons[u].value<=t.buttonThreshold&&t.buttonState[u]&&(t.buttonState[u]=!1,dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:u})))}t.pollLoop=requestAnimationFrame(t.poll)}static calculateAssist(){if(!q||!q.playing)return 1;var f=t.v1,c=t.v2,r=ne.forwardRay.origin,i=ne.forwardRay.direction,a=null,n=null,s=1e7;for(var o of pe)if(o&&o.id!=ue&&o.playing&&o.actor&&o.actor.mesh.isVisible&&(o.team==0||o.team!=q.team)){var l=T.Vector3.Distance(o.actor.mesh.position,r);f.copyFrom(o.actor.mesh.position),f.y+=.3,f.subtractToRef(r,c),c.normalize(),i.normalize();var u=T.Vector3.Dot(c,i),h=(1-u)*l*.5;l<ne.forwardRay.range+1&&h<=.05&&l<s&&(a=o,s=l,n=h)}return a?Math.max(n*(1/.05),.2):1}static onButtonDown(f){q&&wr("gamepad",f.detail)}static onButtonUp(f){q&&Ir("gamepad",f.detail)}};Vr.v1=new T.Vector3;Vr.v2=new T.Vector3;var Es=0;function qo(){isFromEU&&(Es>8||(typeof googletag<"u"?(Ze=localStore.getItem("consent"),Ze?(Ze=JSON.parse(Ze),googletag.consented=Ze&&Ze.ofAge&&Ze.targetedAds||!isFromEU,vueApp.setPrivacySettings(Ze.ofAge,Ze.targetedAds)):(Ze={ofAge:!1,targetedAds:!1},vueApp.showGdprNotification()),console.log("AIP consent: "+googletag.consented)):setTimeout(()=>{Es++,qo()},1e3)))}function Eh(){ga("send","event","privacy","age gate","agree"),Ze={ofAge:!0,targetedAds:!0},googletag.consented=!0,vueApp.setPrivacySettings(!0,!0),localStore.setItem("consent",JSON.stringify(Ze))}function Ph(){ga("send","event","privacy","age gate","disagree"),googletag.consented=!1,vueApp.setPrivacySettings(!1,!1),localStore.setItem("consent",JSON.stringify(Ze))}function xh(t){Ze.ofAge=t,ga("send","event","privacy","of age",t?"yes":"no"),t||(Ze.targetedAds=!1,googletag.consented=!1),localStore.setItem("consent",JSON.stringify(Ze))}function Mh(t){Ze.targetedAds=t,googletag.consented=t,ga("send","event","privacy","targetedAds",t?"yes":"no"),localStore.setItem("consent",JSON.stringify(Ze))}(function(t,f,c,r,i,a,n){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,a=f.createElement(c),n=f.getElementsByTagName(c)[0],a.async=1,a.src=r,n.parentNode.insertBefore(a,n),a.onload=function(){window.ga&&ga.create&&(Jo=window.ga,window.ga=$o)}})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");var Jo=window.ga,$o=function(){Jo.apply(window,arguments);var t=arguments[0];switch(t){case"create":break;case"set":{var f=arguments[1],c=arguments[2],r={};r[f]=c,gtag("set","user_properties",r);break}case"send":{var i={hitType:arguments[1]};switch(i.hitType){case"pageview":gtag("pageview",{page_location:location.href});break;case"event":typeof arguments[2]=="object"?i=Object.assign(i,arguments[2]):(i.eventCategory=arguments[2],i.eventAction=arguments[3],i.eventLabel=arguments[4],i.eventValue=arguments[5],typeof arguments[6]=="object"&&(i=Object.assign(i,arguments[6]))),gtag("event",i.eventAction,i);break;case"timing":i.timingCategory=arguments[2],i.timingVar=arguments[3],i.timingValue=arguments[4],i.timingLabel=arguments[5],gtag("event","timing_complete",i);break}break}}};window.ga=$o;ga("set","anonymizeIp",!isFromEU);ga("create","UA-105800112-1",{cookieDomain:"auto",siteSpeedSampleRate:10,cookieFlags:"samesite=none;secure"});ga("send","pageview");ga("set","account","web");var Ch=(t,f)=>{f=f||"event",t.forEach(c=>{ga("send",f,{eventCategory:c[0],eventAction:c[1],eventLabel:c[2],eventValue:c[3]})})},Bo=(t,f)=>{f=f||"";let c=Date.now()-t;ga("send","timing","game","play time",c),fbq("trackCustom","EndGame",{timePlayed:c}),f&&ga("send","timing","Maps",f,c)},Ps=[new T.Color3(1,1,0),new T.Color3(0,.5,1),new T.Color3(1,0,0)];function Ii(t){this.grenade=t,this.scene=t.scene,this.meshes={};for(let f=0;f<O.catalog.grenades.length;f++){let c=O.catalog.grenades[f],r=pt(c.item_data.meshName,this.scene);r.material=this.scene.getMaterialByName("emissive"),this.meshes[c.id]=r,r.setEnabled(!1)}this.mesh=null,this.beep=!1,this.flashColor=null}Ii.prototype.dispose=function(){for(let t of Object.values(this.meshes))t.dispose()};Ii.prototype.throw=function(){this.mesh=this.meshes[this.grenade.player.grenadeItem.id],this.mesh.setEnabled(!0),this.mesh.position.x=this.grenade.x,this.mesh.position.y=this.grenade.y,this.mesh.position.z=this.grenade.z,this.grenade.player.id==ue?this.flashColor=Ps[0]:this.flashColor=Ps[this.grenade.player.team],qe.play("grenade_pin",this.mesh.position),this.bounce()};Ii.prototype.update=function(t){this.grenade.resting||(this.mesh.position.x+=(this.grenade.x-this.mesh.position.x)*.5,this.mesh.position.y+=(this.grenade.y-this.mesh.position.y)*.5,this.mesh.position.z+=(this.grenade.z-this.mesh.position.z)*.5,this.mesh.rotation.x+=this.rx,this.mesh.rotation.y+=this.ry,this.mesh.rotation.z+=this.rz),Math.sqrt(this.grenade.ttl*2)%2>1?(this.beep==!1&&(qe.play("grenade_beep",this.mesh.position),this.beep=!0),this.mesh.emissiveColor=this.flashColor):(this.mesh.emissiveColor=T.Color3.Black(),this.beep=!1)};Ii.prototype.remove=function(){this.mesh.setEnabled(!1)};Ii.prototype.bounce=function(){var t=Math.length3(this.grenade.dx,this.grenade.dy,this.grenade.dz);this.rx=(Math.random()*2-1)*t,this.ry=(Math.random()*2-1)*t,this.rz=(Math.random()*2-1)*t};Ii.prototype.stop=function(){this.rx=0,this.ry=0,this.rz=0};var ei=class{constructor(f,c){this.gun=f,this.meshName=c,this.scene=f.scene,this.standardMeshName=f.constructor.standardMeshName,this.playerActor=f.player.actor,this.skeleton=xa("gun_"+this.standardMeshName+"_skeleton",this.scene),this.roundsFired=0,this.dryFireSound="gun_eggk47_dry_fire"}setup(f){this.gunMesh=pt(this.meshName,this.scene,this.playerActor.gunContainer),this.gunMesh.material=or("standard",this.scene),this.gunMesh.skeleton=this.skeleton,this.gunMesh.setEnabled(!1),f&&(this.muzzleFlash=pt("muzzleFlash",this.scene,this.playerActor.gunContainer),this.muzzleFlash.material=or("muzzleFlash",this.scene),this.muzzleFlash.setEnabled(!1),this.muzzleFlash.position.x=.25,this.muzzleFlash.position.z=f,this.muzzleFlash.scaling.copyFromFloats(.7,.7,.7)),this.gun.player.id==ue&&(this.gunMesh.setRenderingGroupId(2),this.muzzleFlash&&this.muzzleFlash.setRenderingGroupId(2))}addSoundEvent(f,c,r){var i=this.skeleton.getAnimationRange(f);c+=i.from;function a(s,o){return function(){qe.play(s,o,!0)}}var n=new T.AnimationEvent(c,a(r,this.gun.player.actor.mesh.position));this.skeleton.bones[0].animations[0].addEvent(n)}dispose(){this.gunMesh.dispose()}inspect(){this.skeleton.beginAnimation("inspect")}restPose(){let f=this.skeleton;var c=f.getAnimationRange("fire");oe!==void 0&&oe.beginAnimation(f,c.from,c.from)}stow(){qe.play("weapon_swap",this.gun.player.actor.mesh.position,!0),this.scene.beginAnimation(this.playerActor.gunContainer,0,25,!1,1,()=>{this.gunMesh.setEnabled(!1),this.gun.equip()})}equip(f){this.gun.player.meleeWeapon.actor.weaponMesh.setEnabled(!1),this.playerActor.setWeaponSkeleton(this.skeleton),this.playerActor.gunContainer.setEnabled(!1),this.scene.beginAnimation(this.playerActor.gunContainer,30,55,!1,f||1),this.gunMesh.setEnabled(!0),this.roundsFired=0,setTimeout(()=>{this.playerActor.gunContainer.setEnabled(!0)},1)}dryFire(){qe.play(this.dryFireSound,this.gun.player.actor.mesh.position,!0)}denyFire(){Ie.fireDenied(),qe.play(this.dryFireSound,this.gun.player.actor.mesh.position,!0),qe.play(this.denyFireSound,this.gun.player.actor.mesh.position,!0)}fire(){if((!this.gun.constructor.burst||this.roundsFired%this.gun.constructor.burst==0)&&(this.fireSound&&qe.play(this.fireSound,this.gun.player.actor.mesh.position,!0),this.skeleton.beginAnimation("fire")),this.roundsFired++,this.muzzleFlash){this.muzzleFlash.rotation.z=Math.random()*3.141,this.muzzleFlash.setEnabled(!0);var f=this;setTimeout(function(){f.muzzleFlash.setEnabled(!1)},33)}}reload(){this.gun.longReloadTime==this.gun.shortReloadTime?this.skeleton.beginAnimation("reload",!1,this.gun.constructor.reloadTimeMod):this.gun.ammo.rounds>0?this.skeleton.beginAnimation("shortReload",!1,this.gun.constructor.reloadTimeMod):this.skeleton.beginAnimation("longReload",!1,this.gun.constructor.reloadTimeMod)}getFireSound(f,c,r){if(Tr[f].includes(c)){let i=c+"_fire";return BAWK.sounds[i]?i:r}return r}update(){}},fa=class extends ei{constructor(f,c){super(f,c),this.scopeFov=.9,this.scopeY=.0438,this.setup(.6),this.fireSound=this.getFireSound("Soldier",c,"gun_eggk47_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",123,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},da=class extends ei{constructor(f,c){super(f,c),this.scopeFov=1,this.scopeY=.072,this.setup(.6),this.fireSound=this.getFireSound("Scrambler",c,"gun_dozenGauge_fire"),this.addSoundEvent("reload",0,"gun_dozenGauge_open"),this.addSoundEvent("reload",80,"gun_dozenGauge_load"),this.addSoundEvent("reload",115,"gun_dozenGauge_close")}},pa=class extends ei{constructor(f,c){super(f,c),this.scopeFov=.5,this.scopeY=.0345,this.setup(.6),this.fireSound=this.getFireSound("Ranger",c,"gun_csg1_fire"),this.addSoundEvent("shortReload",25,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",125,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_csg1_pull_action"),this.addSoundEvent("longReload",75,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",160,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",190,"gun_csg1_release_action")}},ma=class extends ei{constructor(f,c){super(f,c),this.scopeFov=1.1,this.scopeY=.069,this.setup(.48),this.fireSound=this.getFireSound("Secondary",c,"gun_cluck9mm_fire"),this.addSoundEvent("shortReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("shortReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",15,"gun_cluck9mm_remove_mag"),this.addSoundEvent("longReload",110,"gun_cluck9mm_insert_mag"),this.addSoundEvent("longReload",155,"gun_eggk47_full_cycle")}},_a=class extends ei{constructor(f,c){super(f,c),this.scopeFov=.9,this.scopeY=.1-.0862,this.setup(.51),this.fireSound=this.getFireSound("Eggsploder",c,"gun_rpegg_fire"),this.denyFireSound="gun_rpegg_deny_fire",this.addSoundEvent("reload",115,"gun_rpegg_load")}},va=class extends ei{constructor(f,c){super(f,c),this.scopeFov=1,this.scopeY=.1-.09635,this.setup(.55),this.fireSound=this.getFireSound("Whipper",c,"gun_smg_fire"),this.addSoundEvent("shortReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("shortReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",30,"gun_eggk47_remove_mag"),this.addSoundEvent("longReload",150,"gun_eggk47_insert_mag"),this.addSoundEvent("longReload",185,"gun_smg_cycle")}},ya=class extends ei{constructor(f,c){super(f,c),this.scopeFov=.4,this.scopeY=.1-.03507,this.setup(.6),this.fireSound=this.getFireSound("Crackshot",c,"gun_m24_fire"),this.addSoundEvent("reload",10,"gun_m24_bolt_open"),this.addSoundEvent("reload",75,"gun_eggk47_insert_mag"),this.addSoundEvent("reload",94,"gun_m24_bolt_close")}},ba=class extends ei{constructor(f,c){super(f,c),this.scopeFov=.7,this.scopeY=.0385,this.setup(.6),this.fireSound=this.getFireSound("TriHard",c,"gun_aug_fire"),this.addSoundEvent("shortReload",28,"gun_aug_remove_mag"),this.addSoundEvent("shortReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",28,"gun_aug_remove_mag"),this.addSoundEvent("longReload",118,"gun_aug_insert_mag"),this.addSoundEvent("longReload",153,"gun_aug_cycle")}};function Rh(){getRequest("data/housePromo.json?"+Date.now(),function(t,f){if(Object.keys(HouseAds).length===0&&HouseAds.constructor===Object)ot={big:[],small:[],bigBanner:[],houseAdPercentChance:100,smHouseAds:[],shellLogo:[]};else{let c={socialMedia:"",premFeat:""};ot=HouseAds,wh(),console.log("special items tag: "+ot.specialItemsTag),hasValue(ot.specialItemsTag)&&O.catalog.getTaggedItems(ot.specialItemsTag).length>0?vueApp.useSpecialItemsTag(ot.specialItemsTag):vueApp.disableSpecialItems(),hasValue(ot.featuredSocialMedia)&&(c.socialMedia=ot.featuredSocialMedia),hasValue(ot.premFeatured)&&(c.premFeat=ot.premFeatured,Zl[c.premFeat]=!0),ot.smHouseAds.length>0&&vueApp.ui.houseAds.homeScreen.push(...ot.smHouseAds),vueApp.useTags(c)}zl=!0})}function xs(t,f){getRequest(t+"?"+Date.now(),(c,r)=>{let i=[];if(c===404)console.log("Accept it and move on.");else try{let a=JSON.parse(r);a.length>0&&a.forEach(n=>i.push(n))}catch(a){console.log("News request error: ",a)}f(i)})}function wh(){for(var t=[],f=0;f<ot.small.length;f++)ot.small[f].active&&(t.push(f),ot.small[f].weighted&&t.push(f));t.length>0&&vueApp.useHouseAdSmall(ot.small[t[Math.floor(Math.random()*t.length)]])}function Ih(t){ga("send","event",{eventCategory:"House banner ad",eventAction:"click",eventLabel:t.label}),as(t)}function Dh(t){ga("send","event",{eventCategory:"Big ad",eventAction:"click",eventLabel:t.label}),as(t)}function kh(t){return t.link||t.linksToTaggedItems||t.linksToItemId||t.linksToNugget||t.linksToPhotoBooth}function Fh(t){isString(t.linksToItemId)&&(t.linksToItemId=parseInt(t.linksToItemId,10));var f=catalog.findItemById(t.linksToItemId);vueApp.showItemOnEquipScreen(f)}function as(t){switch(t.linksTo){case"linksToTaggedItems":break;case"linksToItemId":Fh(t);break;case"linksToNugget":ea=!0,Bn();break;case"linksToPhotoBooth":Zo();break;case"linksToVipStore":vueApp.showSubStorePopup();break;case"linkToShop":vueApp.openEquipSwitchTo(parseInt(t.linkToShop,10));break;case"linkToChw":vueApp.showNuggyPopup();break;case"linkToBlackFriday":vueApp.showEggStorePopup();break;case"linkToEggOrg":vueApp.showSelectedTaggedItemsOnEquipScreen("EGGORG");break;case"linkToTwitch":window.open(dynamicContentPrefix+"twitch?utm_medium=referral&utm_campaign=featureslot","_blank");break;case"linkToMobile":vueApp.showGetMobilePopup();break;default:t.link.length>1&&crazyGamesActive?window.open(t.link[1],"_window"):window.open(t.link[0],"_window");break}ga("send","event","home-display-ad","click",t.label.toLowerCase().replace(/ /g,"-"))}function Ah(t){function f(c){ga("send","event","newsItem","clicked",c)}if("linksToItemId"in t){let c=O.catalog.findItemById(parseInt(t.linksToItemId,10));vueApp.showItemOnEquipScreen(c),f(`item=${c.name}`);return}if("linksToTaggedItems"in t){t.linksToTaggedItems==1?ir=ot.specialItemsTag:ir=t.linksToTaggedItems,ln=!0,Vo(),f(`tagged=${t.linksToTaggedItems}`);return}if("linksToChangeLog"in t){vueApp.showChangelogPopup(),f("sschangelog");return}if("link"in t){window.open(t.link,"_window"),f(t.link);return}if("linksToPhotoBooth"in t){Zo(),f("openPhotoBooth");return}if("linksToNugget"in t&&(ea=!0,Bn(),f("nugget")),"linksToEggStoreItem"in t){vueApp.showPopupEggStoreSingle(t.linksToEggStoreItem),f(`skuItem=${t.linksToEggStoreItem}`);return}"linksToVipStore"in t&&(vueApp.showSubStorePopup(),f(`skuItem=${t.linksToVipStore}`)),"linksToKotc"in t&&vueApp.showKotcInstrucPopup()}var Vh=t=>{if(!ot.length)return;let f=ot[t].filter(n=>n.active);if(!f.length)return;let c=[],r=f.filter(n=>n.label.includes("VIP")).length,i=Math.round(50/100*f.length/r);isFinite(i)||(i=1);let a=f.map(n=>{let s=n.label.toUpperCase();return n.priority=1,s.includes("VIP")&&(n.priority=i),n});for(let n=0;n<a.length;++n)for(let s=0;s<a[n].priority;++s)c.push(a[n]);return c[Math.floor(Math.random()*c.length)]};function Di(t){this.kind=t,this.scene=oe}Di.prototype.update=function(t){this.mesh.rotation.y+=.03*t};Di.prototype.remove=function(){this.mesh.setEnabled(!1)};function ns(){Di.call(this,Pt.AMMO),this.mesh=this.scene.getMeshByName("ammo").createInstance(""),this.mesh.setEnabled(!1),xt&&xt.getShadowMap().renderList.push(this.mesh)}ns.prototype=Object.create(Di.prototype);ns.prototype.constructor=Di;function ss(){Di.call(this,Pt.GRENADE),this.mesh=this.scene.getMeshByName("grenadeItem").createInstance(""),this.mesh.setEnabled(!1),xt&&xt.getShadowMap().renderList.push(this.mesh)}ss.prototype=Object.create(Di.prototype);ss.prototype.constructor=Di;function Pt(){this.pools=[new qt(function(){return new Pt.Constructors[Pt.AMMO]},100),new qt(function(){return new Pt.Constructors[Pt.GRENADE]},20)]}Pt.AMMO=0;Pt.GRENADE=1;Pt.Constructors=[ns,ss];Pt.prototype.update=function(t){for(var f=0;f<this.pools.length;f++)this.pools[f].forEachActive(function(c){c.update(t),c.mesh.isVisible=To(c.mesh)})};Pt.prototype.spawnItem=function(t,f,c,r,i){var a=this.pools[f].retrieve(t);a.mesh.setEnabled(!0),a.mesh.position.x=c,a.mesh.position.y=r,a.mesh.position.z=i,Fs&&a.mesh.freezeWorldMatrix()};Pt.prototype.collectItem=function(t,f){var c=this.pools[t];c.recycle(c.objects[f]),c.objects[f].remove()};Pt.prototype.recycleAllItems=function(){for(var t=this,f=0;f<this.pools.length;f++)this.pools[f].forEachActive(function(c){t.pools[f].recycle(c),c.remove()})};function Va(){this.scene=new T.Scene(O.engine),this.scene.clearColor=new T.Color4(0,0,0,0),this.canvas=O.engine.getRenderingCanvas(),this.scene.sunLight={direction:new T.Vector3(.2,1,.1),diffuse:new T.Color3.White},this.meshRenderStaging={},Ca(this.scene),this.camera=new T.ArcRotateCamera("",0,0,0,new T.Vector3(0,0,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.fov=.5,this.camera.maxZ=100,this.camera.minZ=.01,this.stampSprites=new T.SpriteManager("","img/stamps.png?v="+Ot,1024,128,this.scene),this.stampSprite=new T.Sprite("",this.stampSprites),this.stampSprite.size=1}Va.prototype.renderToCanvas=function(t,f,c){let r=t.item_data.meshName;this.camera.alpha=0,this.camera.beta=Math.PI90;var i=pt(r,this.scene);i.layerMask=1,this.camera.layerMask=1,i.computeWorldMatrix(),this.camera.computeWorldMatrix();let a=this.meshRenderStaging[r];i.position.copyFrom(a.position),i.rotation.copyFrom(a.rotation),this.camera.radius=a.radius,this.scene.render(),i.dispose();var n=f.getContext("2d");n.clearRect(0,0,256,256),n.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),c&&c()};Va.prototype.renderStampToCanvas=function(t,f,c){var r=t.item_data.x,i=t.item_data.y;this.stampSprites.layerMask=2,this.camera.layerMask=2,this.stampSprite.cellIndex=r+i*32,this.camera.alpha=0,this.camera.beta=0,this.camera.radius=2.5,this.scene.render();var a=f.getContext("2d");a.clearRect(0,0,256,256),a.drawImage(this.canvas,(this.canvas.width-this.canvas.height)/2,0,this.canvas.height,this.canvas.height,0,0,256,256),this.camera.layerMask=0,this.scene.render(),c&&c()};Va.prototype.calculateItemAlignments=function(){let t=[...O.catalog.hats,...O.catalog.grenades,...O.catalog.melee];for(let o=0;o<vt.length;o++)t.push(...O.catalog.forClass[o].forWeaponSlot[nt.Primary]),t.push(...O.catalog.forClass[o].forWeaponSlot[nt.Secondary]);this.camera.alpha=0,this.camera.beta=Math.PI90,this.camera.radius=1,O.engine.setSize(256,256);for(let o of t){let l=o.item_data.meshName,u=pt(l,this.scene);var f=u.getVerticesData(T.VertexBuffer.PositionKind);if(!f){alert(`${u.name} is referenced in items.js, but is missing mesh data`);continue}let h;switch(o.item_type_id){case se.Hat:h={radius:1.3,rotation:new T.Vector3(.25,2,0),position:new T.Vector3(0,-.25,0)};break;case se.Grenade:h={radius:.4,rotation:new T.Vector3(0,-1.3,0),position:new T.Vector3(0,-.01,0)};break;case se.Melee:h={radius:.4,rotation:new T.Vector3(-.5,4,-1.2),position:new T.Vector3(0,.02,.12)};break;case se.Primary:h={radius:1.3,rotation:new T.Vector3(-.7,0,0),position:new T.Vector3(0,-.1,-.1)};break;case se.Secondary:h={radius:1,rotation:new T.Vector3(0,0,0),position:new T.Vector3(0,.05,-.32)};break;default:}if(u.position.copyFrom(h.position),u.rotation.copyFrom(h.rotation),u.computeWorldMatrix(),this.camera.radius=h.radius,o.item_type_id!==se.Grenade){this.scene.updateTransformMatrix();for(var c={x:1e4,y:1e4},r={x:-1e4,y:-1e4},i=0;i<f.length;i+=3){var a=T.Vector3.Project(new T.Vector3(f[i],f[i+1],f[i+2]),u.getWorldMatrix(),this.scene.getTransformMatrix(),this.camera.viewport.toGlobal(O.engine));c.x=Math.min(c.x,a.x),r.x=Math.max(r.x,a.x),c.y=Math.min(c.y,a.y),r.y=Math.max(r.y,a.y)}var n=(r.x+c.x)/2-128,s=(r.y+c.y)/2-128;h.position.z-=n/512,h.position.y+=s/512}u.dispose(),this.meshRenderStaging[l]=h}qi()};var Qt=class{static connect(){return new Promise((f,c)=>{var r=dynamicContentRoot||location.host,i=`${isHttps()?"wss":"ws"}://`+"ilovelagtrain.hs.vc/~/uv//mvL81DTXonADEH/6785tMq6NJEkJyE+HtciDVX2UMOUlH/zpNWw2l/matchmaker/";this.ws=new Gn(i),this.ws.onopen=()=>{f(this.ws)},this.ws.onmessage=a=>this.handleMatchmakerMessage(a),this.ws.onerror=()=>{}})}static getRegions(){return new Promise((f,c)=>{this.ws.send('{ "command": "regionList" }'),this.ws.onmessage=r=>{let i=JSON.parse(r.data);switch(i.command){case"regionList":this.ws.onerror=a=>{},this.regionList=i.regionList;for(let a of this.regionList)a.locKey="server_"+a.id,a.ping=null;vueApp.regionList=this.regionList,f();break;default:this.handleMatchmakerMessage(r);break}},this.ws.onerror=r=>{c(r),this.handleError(r)}})}static joinPrivateGame(f){return new Promise((c,r)=>{let i={command:"joinGame",id:f.joinCode.toUpperCase(),observe:f.observe,sessionId:O.playerAccount.sessionId};this.ws.send(JSON.stringify(i)),this.ws.onmessage=a=>{let n=JSON.parse(a.data);if(n.error)r(et[n.error]);else switch(n.command){case"gameFound":this.ws.onerror=s=>{},c(n);break;default:this.handleMatchmakerMessage(a);break}},this.ws.onerror=a=>{r(a),this.handleError(a)}})}static findGame(f){return new Promise((c,r)=>{let a={command:"findGame",region:vueApp.currentRegionId,playType:f.playType,gameType:f.gameType,sessionId:O.playerAccount.sessionId};f.playType===vueData.playTypes.createPrivate&&(a.map=f.mapIdx),this.ws.send(JSON.stringify(a)),this.ws.onmessage=n=>{let s=JSON.parse(n.data);if(s.error)r(et[s.error]);else switch(s.command){case"gameFound":this.ws.onerror=o=>{},c(s);break;default:this.handleMatchmakerMessage(n);break}},this.ws.onerror=n=>{r(n),this.handleError(n)}})}static handleMatchmakerMessage(f){let c=JSON.parse(f.data);switch(c.command){case"notice":this.handleNotices(c.notices);break}}static handleNotices(f){Object.keys(f).forEach(c=>{switch(c){case"announcement":vueData.announcementMessage=f[c];break;case"version":if(f[c]!==Ot)if(!localStorage.getItem("cacheNuked"))localStorage.setItem("cacheNuked",!0),zo();else{console.log("Wrong client version");let r=setInterval(()=>{vueApp&&(clearInterval(r),vueApp.showGenericPopup("wrong_version","wrong_version_msg","ok"))},100)}else localStorage.removeItem("cacheNuked");break}})}static handleError(f){this.ws.onerror=c=>{},Ft.hide(),vueApp.hideSpinner(),console.log("Failed to connect to Matchmaker",f),vueApp.showGenericPopup("matchmaker_offline","matchmaker_offline_msg","ok")}},Fn=class{constructor(f,c){this.weapon=f,this.meshName=c,this.scene=f.scene,this.player=f.player,this.playerActor=f.player.actor,this.skeleton=xa("melee_skeleton",this.scene),this.weaponMesh=pt(this.meshName,this.scene,this.playerActor.gunContainer),this.weaponMesh.skeleton=this.skeleton,this.weaponMesh.material=or("standard",this.scene),this.weaponMesh.setEnabled(!1),this.swingSounds=this.getSwingSounds(c),this.weapon.player.id==ue&&this.weaponMesh.setRenderingGroupId(2)}getSwingSounds(f){return Tr.Melee.includes(f)?Object.keys(BAWK.sounds).filter(c=>c.startsWith(f)):["melee_whisk_a","melee_whisk_b"]}dispose(){this.weaponMesh.dispose()}stow(){this.weaponMesh.setEnabled(!1)}attack(){this.skeleton.beginAnimation("melee"),setTimeout(()=>{let f=Math.randomInt(0,this.swingSounds.length);qe.play(this.swingSounds[f],this.playerActor.mesh.position,!0)},68)}};function Ye(){this.posingItems={[se.Primary]:null,[se.Secondary]:null,[se.Grenade]:null,[se.Melee]:null,[se.Hat]:null,[se.Stamp]:null},this.grenadeOnHip=!1,this.camX=0,this.camY=.35,this.camRadius=3.4,this.rotY=0,this.rotX=0,this.jump=0,this.turnCountdown=60,this.buyingItem=null,this.autoUpdate=!0,this.scaleSizes=[1,1.25,1.5],this.dmg=100,this.setupScene(),this.onResourcesLoaded()}Ye.prototype.onResourcesLoaded=function(){var t=this;this.startRendering();try{let r=function(i){this.scene=t.scene,this.id=-1,this.name="",this.x=0,this.y=0,this.z=0,this.hp=100,this.hatItem=O.playerAccount.hatItem,this.stampItem=O.playerAccount.stampItem,this.shellColor=O.playerAccount.colorIdx,this.meleeItem=O.playerAccount.meleeItem,this.actor=new Me(this),this.actor.mesh.rotation.y=t.rotY,this.meleeWeapon=new lr(this),this.weapon=new O.classes[i].weapon(this,f)};var f=O.playerAccount.getPrimaryWeapon().item_data.meshName;this.dualAvatar=new r(O.playerAccount.classIdx),this.dualAvatar.actor.bodyMesh.setEnabled(!1),this.dualAvatar.actor.hands.material.backFaceCulling=!1,this.dualAvatar.actor.foreBone.setScale(T.Vector3.Zero()),this.dualAvatar.actor.setupStowAnims(0,!0),this.dualAvatar.weapon.actor.equip(),this.avatar=new r(O.playerAccount.classIdx),this.avatar.actor.foreBone.setScale(T.Vector3.Zero()),this.avatar.actor.setupStowAnims(0),this.avatar.weapon.actor.equip();var c=Date.now();this.scene.registerBeforeRender(function(){var i=Date.now(),a=i-c;c=i,a/=17,t.update(a)})}catch(r){console.log(r)}this.manualOrientation=!1,this.isMouseDown=!1,this.drag=!1,this.equipContainer=document.getElementById("equip_purchase_top"),this.dollContainer=document.getElementById("paper_doll_container"),this.equipContainer.addEventListener("mousemove",r=>{if(this.manualOrientation=!0,r.target.id!=="equip_purchase_top")return!1;this.drag=!1,this.pointEggEvent(r)}),this.dollContainer.addEventListener("mousemove",r=>{this.manualOrientation=!0,this.drag=!1,this.pointEggEvent(r)}),this.equipContainer.addEventListener("pointerleave",r=>{this.manualOrientation=!1,this.isMouseDown=!1}),this.dollContainer.addEventListener("pointerleave",r=>{this.manualOrientation=!1,this.isMouseDown=!1}),this.equipContainer.addEventListener("mousedown",r=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)}),this.dollContainer.addEventListener("mousedown",r=>{this.autoUpdate||(this.isMouseDown=!0,this.drag=!0)}),this.equipContainer.addEventListener("mouseup",r=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)}),this.dollContainer.addEventListener("mouseup",r=>{this.isMouseDown=!1,clearInterval(this.mouseIntval)}),this.dollContainer.addEventListener("click",r=>{this.autoUpdate||this.eggDamage()}),this.equipContainer.addEventListener("click",r=>{this.autoUpdate||this.eggDamage()})};Ye.prototype.pointEggEvent=function(t){(this.autoUpdate&&!this.isMouseDown||!this.autoUpdate&&this.isMouseDown)&&this.pointEgg(t)};Ye.prototype.pointEgg=function(t){var f=t.target.getBoundingClientRect();this.rotY=-((t.x-f.left)/f.width)*4+2,this.rotX=((t.y-f.top)/f.height-.5)*1.5};Ye.prototype.startRendering=function(){var t=this;O.engine.runRenderLoop(function(){t.scene.render()})};Ye.prototype.avatars=function(t){t(this.avatar),t(this.dualAvatar)};Ye.prototype.update=function(t){if(this.camera.target.x+=(this.camX-this.camera.target.x)/5,this.camera.target.y+=(this.camY-this.camera.target.y)/5,this.camera.radius+=(this.camRadius-this.camera.radius)/5,this.jump-=t*.002,this.avatars(i=>{i.actor.head.rotation.x+=(this.rotX-i.actor.head.rotation.x)/5,i.actor.mesh.rotation.y+=(this.rotY-i.actor.mesh.rotation.y)/5,i.actor.mesh.rotation.x=i.actor.head.rotation.x*.5,i.actor.mesh.position.x=-i.actor.mesh.rotation.y*.1,i.actor.mesh.position.y=Math.max(0,i.actor.mesh.position.y+this.jump*t)}),!this.manualOrientation&&this.autoUpdate&&(this.turnCountdown-=t,this.turnCountdown<=0)){var f=Math.random()*.6-.4,c=Math.random()*2-1+this.camX*.5,r=Math.length2(f-this.rotX,c-this.rotY);this.rotX=f,this.rotY=c,this.jump=Math.min(.01,r/100),this.turnCountdown=Math.random()*90+30}this.fakeShadow.position.x=this.avatar.actor.mesh.position.x,this.fakeShadow.position.z=this.avatar.actor.mesh.position.z};Ye.prototype.setupScene=function(){this.scene=new T.Scene(O.engine),Ca(this.scene),this.scene.autoClear=!0,this.scene.clearColor=new T.Color4(0,0,0,0),this.scene.fogMode=T.Scene.FOGMODE_EXP2,this.scene.fogDensity=.06;var t=new T.Color3(.35,.65,.8);this.scene.fogColor=t,this.scene.sunLight={direction:new T.Vector3(.2,1,.1),diffuse:new T.Color3.White},this.camera=new T.ArcRotateCamera("",Math.PI*.5,1.5,this.camRadius,new T.Vector3(this.camX,this.camY,0),this.scene),this.scene.activeCameras.push(this.camera),this.camera.maxZ=10,this.camera.fov=.5,this.camera.minZ=.1;var f=new T.StandardMaterial("shadowMat",this.scene);f.emissiveColor=new T.Color3(.07,.57,.74),f.alpha=.5,this.fakeShadow=T.MeshBuilder.CreateDisc("fakeShadow",{radius:.25},this.scene),this.fakeShadow.material=f,this.fakeShadow.rotation.x=Math.PI/2,this.fakeShadow.position.y=0,this.scene.render(),Is=new T.Texture("img/stamps.png?v="+Ot,this.scene)};Ye.prototype.poseWithItems=function(t){this.poseWithHat(t[se.Hat]),this.poseWithStamp(t[se.Stamp]),this.poseWithPrimaryWeapon(t[se.Primary]),this.poseWithSecondaryWeapon(t[se.Secondary]),this.poseWithGrenade(t[se.Grenade]),this.poseWithMelee(t[se.Melee])};Ye.prototype.poseWithPrimaryWeapon=function(t){if(t!==void 0&&!(t!==null&&this.posingItems[se.Primary]===t)){if(this.avatar.weapon.actor.dispose(),t!==null){let f=t.instantiateNew(this.avatar);this.avatar.weapon=f;let c=this.avatar.actor;c.setWeaponSkeleton(f.actor.skeleton),c.gripBone.setScale(new T.Vector3(1,-1,1)),c.gripBone.position=c.weaponGripBone.position,c.gripBone.setRotationQuaternion(c.weaponGripBone.rotationQuaternion),this.dualAvatar.actor.foreBone.setScale(T.Vector3.Zero()),f.actor.gunMesh.setEnabled(!0)}this.posingItems[se.Primary]=t,this.posingItems[se.Melee]!==null&&this.poseWithMelee(this.posingItems[se.Melee],!0)}};Ye.prototype.poseWithSecondaryWeapon=function(t){if(t!==void 0&&!(t!==null&&this.posingItems[se.Secondary]===t)){if(this.dualAvatar.weapon.actor.dispose(),t!==null){let f=t.instantiateNew(this.dualAvatar);this.dualAvatar.weapon=f;let c=this.dualAvatar.actor;if(c.setWeaponSkeleton(f.actor.skeleton),c.gripBone.position=c.weaponGripBone.position,c.gripBone.setRotationQuaternion(c.weaponGripBone.rotationQuaternion),f.actor.gunMesh.setEnabled(!0),c.gripBone.setScale(new T.Vector3(1,-1,1)),this.avatar.actor.foreBone.setScale(T.Vector3.Zero()),this.posingItems[se.Grenade]!==null&&!this.grenadeOnHip){let r=this.dualAvatar.grenade.actor.mesh;r.parent=this.dualAvatar.actor.mesh,r.position.set(.29,.17,-.08),r.rotation.y=Math.PI+.3,r.rotation.z=-.3,this.grenadeOnHip=!0}}this.posingItems[se.Secondary]=t,this.posingItems[se.Grenade]!==null&&this.poseWithGrenade(this.posingItems[se.Grenade],!0)}};Ye.prototype.poseWithGrenade=function(t,f){if(t!==void 0&&!(!f&&t!==null&&this.posingItems[se.Grenade]===t)){if(this.dualAvatar.grenade&&this.dualAvatar.grenade.actor.dispose(),t!==null){this.dualAvatar.grenade=t.instantiateNew(this.dualAvatar);let c=this.dualAvatar.grenade.actor.mesh;if(c.setEnabled(!0),this.posingItems[se.Secondary]!==null)c.parent=this.dualAvatar.actor.mesh,c.position.set(.29,.17,-.08),c.rotation.y=Math.PI+.3,c.rotation.z=-.3,this.grenadeOnHip=!0;else{c.position.set(-.25,0,.3),c.rotation.y=Math.PI;let r=this.avatar.actor;this.dualAvatar.actor.gripBone.setScale(T.Vector3.Zero()),r.foreBone.setScale(new T.Vector3(-1,1,1)),this.grenadeOnHip=!1,r.foreBone.position=new T.Vector3(-.25,-.11,.28),r.foreBone.setRotation(new T.Vector3(-1.7,3,0)),c.parent=r.head}}this.posingItems[se.Grenade]=t}};Ye.prototype.poseWithMelee=function(t,f){if(t!==void 0&&!(!f&&t!==null&&this.posingItems[se.Melee]===t)){if(this.avatar.meleeWeapon&&this.avatar.meleeWeapon.actor.dispose(),t!==null){let c=t.instantiateNew(this.avatar);this.avatar.meleeWeapon=c;let r=c.actor.weaponMesh;r.setEnabled(!0),this.posingItems[se.Primary]!==null?(r.parent=this.avatar.actor.mesh,r.position.set(-.53,-.02,.07),r.rotation.x=-2.1,r.rotation.y=-.3):(r.parent=this.avatar.actor.gunContainer,this.avatar.actor.gripBone.setScale(new T.Vector3(1,-1,1)),this.avatar.actor.gripBone.position=this.avatar.actor.weaponGripBone.position,this.avatar.actor.gripBone.setRotationQuaternion(this.avatar.actor.weaponGripBone.rotationQuaternion),this.dualAvatar.actor.foreBone.setScale(T.Vector3.Zero()),this.avatar.actor.wieldMelee())}this.posingItems[se.Melee]=t}};Ye.prototype.poseWithHat=function(t){t!==void 0&&(t!==null&&this.posingItems[se.Hat]===t||(this.avatar.actor.removeHat(),t!==null&&this.avatar.actor.wearHat(t),this.posingItems[se.Hat]=t))};Ye.prototype.poseWithStamp=function(t){t!==void 0&&(t!==null&&this.posingItems[se.Stamp]===t||(this.avatar.actor.removeStamp(),t!==null&&this.avatar.actor.applyStamp(t),this.posingItems[se.Stamp]=t))};Ye.prototype.poseWithColor=function(t){t>=7&&!O.playerAccount.isSubscriber&&(t=0,vueApp.equip.colorIdx=0),this.avatar.actor.setShellColor(t),this.dualAvatar.actor.setShellColor(t),vueApp.setShellColor(t)};Ye.prototype.photoBoothHideItem=function(t){switch(t.value){case se.Hat:hasValue(this.posingItems[t.value])?this.poseWithHat(null):this.poseWithHat(O.playerAccount.hatItem);break;case se.Stamp:this.posingItems[t.value]?this.poseWithStamp(null):this.poseWithStamp(O.playerAccount.stampItem);break;case se.Grenade:this.posingItems[t.value]?this.poseWithGrenade(null):this.poseWithGrenade(O.playerAccount.grenadeItem);break;case se.Melee:this.posingItems[t.value]?this.poseWithMelee(null):this.poseWithMelee(O.playerAccount.meleeItem);break;case se.Primary:this.posingItems[t.value]?this.poseWithPrimaryWeapon(null):this.poseWithPrimaryWeapon(O.playerAccount.getPrimaryWeapon());break;case se.Secondary:this.posingItems[t.value]?this.poseWithSecondaryWeapon(null):this.poseWithSecondaryWeapon(O.playerAccount.getSecondaryWeapon());break;default:break}this.posingItems[se.Grenade]===null&&this.posingItems[se.Secondary]===null&&(this.dualAvatar.actor.gripBone.setScale(T.Vector3.Zero()),this.avatar.actor.foreBone.setScale(new T.Vector3(1,-1,1)),this.avatar.actor.foreBone.position=new T.Vector3(-.34,-.12,.1),this.avatar.actor.foreBone.setRotation(new T.Vector3(.3,1.5,-1.2))),this.posingItems[se.Primary]===null&&this.posingItems[se.Melee]===null?(this.avatar.actor.gripBone.setScale(T.Vector3.Zero()),this.dualAvatar.actor.foreBone.setScale(new T.Vector3(1,-1,1)),this.dualAvatar.actor.foreBone.position=new T.Vector3(-.34,-.12,.1),this.dualAvatar.actor.foreBone.setRotation(new T.Vector3(.3,1.5,-1.2))):(this.avatar.actor.gripBone.setScale(new T.Vector3(1,-1,1)),this.dualAvatar.actor.foreBone.setScale(T.Vector3.Zero()))};Ye.prototype.scale=function(t){t===void 0&&(t=0),this.avatar.actor.mesh.scaling=new T.Vector3(this.scaleSizes[t],this.scaleSizes[t],this.scaleSizes[t]),this.dualAvatar.actor.mesh.scaling=new T.Vector3(this.scaleSizes[t],this.scaleSizes[t],this.scaleSizes[t]),this.fakeShadow.scaling=new T.Vector3(this.scaleSizes[t],this.scaleSizes[t],this.scaleSizes[t])};Ye.prototype.eggDamage=function(t){t?this.avatar.hp=100:On.open&&this.drag&&(this.avatar.hp=this.dmg>0?this.dmg-=25:this.dmg+=100)};Ye.prototype.photoBoothOpen=function(){this.poseWithItems(O.playerAccount.getEquippedItems()),this.autoUpdate=!1,this.fakeShadow.material.emissiveColor=new T.Color3(0,0,0)};Ye.prototype.photoBoothClose=function(){this.autoUpdate=!0,this.fakeShadow.material.emissiveColor=new T.Color3(.07,.57,.74),this.eggDamage(!0),Da()};var An=class{constructor(){this.isOpen=!1,this.zoomMsgRead=!1}hideItem(f){xe&&!this.isOpen&&(f=null),kt.photoBoothHideItem(f)}eggDollSize(f){xe&&!this.isOpen&&(f=0),kt.scale(f)}zoooMsg(){this.zoomMsgRead||(localStore.setItem("photoBoothZooming",!0),this.zoomMsgRead=localStore.getItem("photoBoothZooming"),vueApp.showGenericPopup("screen_photo_booth_zoom_title","screen_photo_booth_zoom_msg","ok"))}getScreenshot(f){if(this.zoooMsg(),!(!this.isOpen&&xe)){if(f){this.getScreenshotWithCrop();return}html2canvas(document.body,{allowTaint:!1,logging:!1,backgroundColor:null}).then(c=>vueApp.screenGrabDone(c.toDataURL()))}}getScreenshotWithCrop(){if(this.zoooMsg(),!this.isOpen&&xe)return;let f=document.createElement("canvas").getContext("2d"),c={allowTaint:!1,logging:!1,backgroundColor:null},r=window.innerWidth,i=r/2,a=window.innerHeight;return c.height=a,c.width=r,c.x=Math.round(c.x),html2canvas(document.body,c).then(n=>{f.canvas.width=i,f.canvas.height=a,f.drawImage(n,-Math.max(0,(r-i)/2||0),-(+c.y||0)),vueApp.screenGrabDone(f.canvas.toDataURL())})}open(){if(xe){this.close();return}this.isOpen=!0,this.zoomMsgRead=localStorage.getItem("photoBoothZooming"),vueApp.$refs.photoBooth.open(),kt.photoBoothOpen()}close(){this.isOpen=!1,this.eggDollSize(0),vueApp.$refs.photoBooth.close(),kt.photoBoothClose()}};function os(t){console.log("Pinging regions");var f=1e6;let c=document.location.protocol=="https:"?"wss":"ws";for(let r of Qt.regionList)(function(i){let a=`${isHttps()?"wss":"ws"}://`+Wo(i.sub)+"/game/";var n=new WebSocket(a),s;n.onopen=l=>{console.log("Pinging "+i.id),n.send(JSON.stringify({command:"ping"})),s=Date.now()},n.onmessage=l=>{clearTimeout(o),r.ping=Date.now()-s,vueApp.regionList=Qt.regionList.filter(u=>u.ping!==null).sort((u,h)=>u.ping<h.ping?-1:u.ping>h.ping?1:0),r.ping<f&&(f=r.ping,vueApp.currentRegionId=r.id)},n.onerror=l=>{clearTimeout(o),r.ping=null};var o=setTimeout(()=>{r.ping=null,n.close()},4e3)})(r)}function Gh(t){let f=Qt.regionList.find(function(c){return c.id===t});hasValue(f)||(f=Qt.regionList[0]),vueApp.currentRegionId=f.id,localStore.setItem("selectedRegionId",f.id)}var yt;function Me(t){this.player=t,this.scene=t.scene,this.mesh=new T.TransformNode,this.hat=null,this.bodyMesh=pt("egg",this.scene,this.mesh),this.bodyMesh._scene=this.scene,this.bodyMesh.position.y=.32,this.bodyMesh.player=this.player,this.lerpToPosition=new T.Vector3,this.positionLerp=0,this.lerpFromPosition=new T.Vector3,this.lerpTargetPosition=new T.Vector3,this.bodyMesh.material=or("eggShell",this.scene),this.bodyMesh.material.setTexture("textureSampler",Is),this.head=new T.TransformNode,this.head.parent=this.mesh,this.head.position.y=.3,this.head.position.z=0,this.gunContainer=new T.TransformNode,this.gunContainer.parent=this.head,this.gunContainer.rotation.y=-.14,this.gunContainer.rotation.x=-.035,this.setupStowAnims(),this.eye=new T.TransformNode,this.eye.position.y=.1,this.eye.position.x=0,this.eye.parent=this.head,this.hands=pt("hands",this.scene,this.gunContainer),this.hands.skeleton=xa("hands_skeleton",this.scene),this.hands.material=or("standard",this.scene),this.gripBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("gripHand")],this.foreBone=this.hands.skeleton.bones[this.hands.skeleton.getBoneIndexByName("foreHand")],this.player.shield>0&&(this.bodyMesh.overlayColor=fe.OverlayColor.green,this.hands.overlayColor=fe.OverlayColor.green,this.bodyMesh.renderOverlay=!0,this.hands.renderOverlay=!0),this.setShellColor(this.player.shellColor),yt=0,this.mesh.position.x=this.player.x,this.mesh.position.y=this.player.y,this.mesh.position.z=this.player.z,this.player.id!=ue&&(this.wearHat(this.player.hatItem),this.applyStamp(this.player.stampItem)),$t&&this.hands.setEnabled(!1),this.bobbleIntensity=0,this.zoomed=!1,this.hitSoundDelay=0,this.auraSprite=null,this.auraSpriteFrame=0;for(var f=0;f<Object.keys(je).length;f++){var c=Math.pow(2,f);this.player.activeShellStreaks&c&&this.beginShellStreak(c)}xe?(xt&&xt.getShadowMap().renderList.push(this.bodyMesh),this.player.id==ue?this.hands.setRenderingGroupId(2):(this.setupNameSprite(),this.showSprites()),xe&&this.updateTeam()):this.bodyMesh.outlineColor=Ht.outline[0]}Me.prototype.wearHat=function(t){this.removeHat(),t!==null&&(this.hat=pt(t.item_data.meshName,this.scene,this.bodyMesh),this.hat.position.y=-.02)};Me.prototype.removeHat=function(){this.hat!==void 0&&this.hat!==null&&this.hat.dispose()};Me.prototype.applyStamp=function(t){this.removeStamp(),t!==null&&(this.bodyMesh.stampU=t.item_data.x/32,this.bodyMesh.stampV=1-t.item_data.y/32)};Me.prototype.removeStamp=function(){this.bodyMesh.stampU=0,this.bodyMesh.stampV=1};Me.prototype.drawTextOnNameTexture=function(t,f,c,r,i,a){var n=[{x:0,y:-4},{x:-4,y:0},{x:4,y:0},{x:0,y:4}],s=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}],o=this.player.id%4*512,l=2048-Math.floor(this.player.id/4)*256;f+=o,c=-c+l,a&&(f+=256-lh(t,r)/2);for(var u=0;u<4;u++)Rr.drawText(t,f+n[u].x,c+n[u].y,"bold "+r+"px Nunito, sans-serif","rgba(0, 0, 0, 0.5)","transparent");for(var u=0;u<4;u++)Rr.drawText(t,f+s[u].x,c+s[u].y,"bold "+r+"px Nunito, sans-serif",i,"transparent")};Me.prototype.setupNameSprite=function(){var t=this.player.id%4*512,f=2048-Math.floor(this.player.id/4)*256;Rr.clearRect(t,f-256,512,256),this.drawTextOnNameTexture(this.player.name,0,32,60,"white",!0)};Me.prototype.updateTeam=function(){this.player.team==Wi||gt?this.bodyMesh.outlineColor=Ht.outline[this.player.team]:this.bodyMesh.outlineColor=Ht.outline[0],this.nameSprite&&(this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.color=Ht.textColor[this.player.team])};Me.prototype.update=function(t){var f=Math.cos(this.player.bobble)*this.bobbleIntensity,c=Math.abs(Math.sin(this.player.bobble)*this.bobbleIntensity),r=Math.sin(this.player.bobble*2)*this.bobbleIntensity;if(this.player.shield>0){var i=Math.random()*.7+.2;this.bodyMesh.overlayAlpha=i,this.hands.overlayAlpha=i}if(this.player.activeShellStreaks&je.EggBreaker){var i=Math.cos(cr/100)*.5+.5;this.bodyMesh.overlayAlpha=i,this.hands.overlayAlpha=i}t=Math.min(t,1);var a=.333*t;if(this.player.id==ue)if(this.player.scope&&this.player.isAtReady(!0))ne.fov=ne.fov+(this.player.weapon.actor.scopeFov-ne.fov)*a,this.gunContainer.rotation.y*=a,this.gunContainer.rotation.x*=a,this.gunContainer.position.x+=(-.24999999-this.gunContainer.position.x)*a,this.gunContainer.position.y+=(this.player.weapon.actor.scopeY-this.gunContainer.position.y)*a,this.gunContainer.position.z+=(-.05-this.gunContainer.position.z)*a,this.player.weapon.hasScope&&!this.zoomed&&ne.fov<this.player.weapon.actor.scopeFov+.05&&(Oi.show(),this.gunContainer.setEnabled(!1),this.zoomed=!0);else{ne.fov=ne.fov+(1.25-ne.fov)*a;var n=1-a;this.gunContainer.rotation.y+=(-.14+f*2-this.gunContainer.rotation.y)*a,this.gunContainer.rotation.x+=(-.035+r*.75-this.gunContainer.rotation.x)*a,this.gunContainer.position.x*=n,this.gunContainer.position.y*=n,this.gunContainer.position.z*=n,this.zoomed&&ne.fov>this.player.weapon.actor.scopeFov+.05&&(Oi.hide(),this.gunContainer.setEnabled(!0),this.zoomed=!1)}else if(this.gunContainer.rotation.y+=(-.14+f*2-this.gunContainer.rotation.y)*a,this.gunContainer.rotation.x+=(-.035+r*.75-this.gunContainer.rotation.x)*a,this.player.team>0&&(this.player.team==Wi||gt)&&this.nameSprite){var s=Math.length3(this.player.x-q.x,this.player.y-q.y,this.player.z-q.z),o=Math.pow(s,1.25);this.nameSprite.width=o/10+.6,this.nameSprite.height=o/20+.3}if(this.lerpToPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),T.Vector3.LerpToRef(this.lerpFromPosition,this.lerpToPosition,Math.min(this.positionLerp,1),this.lerpTargetPosition),this.positionLerp+=t/2,this.mesh.position.x+=(this.lerpTargetPosition.x-this.mesh.position.x)*.5,this.mesh.position.y+=(this.lerpTargetPosition.y-this.mesh.position.y)*.5,this.mesh.position.z+=(this.lerpTargetPosition.z-this.mesh.position.z)*.5,this.player.id!==ue){var l=Math.radDifference(this.player.yaw,this.mesh.rotation.y),u=Math.radDifference(this.player.pitch,this.head.rotation.x);this.mesh.rotation.y+=l/2*t,this.head.rotation.x+=u/2*t}else this.mesh.rotation.y=this.player.yaw,this.head.rotation.x=this.player.pitch;this.bodyMesh.rotation.x=this.head.rotation.x/4;var h;if(!this.player.onGround&&!this.player.climbing?h=0:h=Math.length3(this.player.dx,this.player.dy,this.player.dz),this.bobbleIntensity+=(h-this.bobbleIntensity)/10,this.bodyMesh.rotation.z=f*5,this.bodyMesh.position.y=c*1.5+.32,yt>0)if(yt*=.9,yt<.001)yt=0;else{var d=Math.random()*yt-yt*.5,p=Math.random()*yt-yt*.5,m=Math.random()*yt-yt*.5;this.eye.rotation.x+=(d-this.eye.rotation.x)/10,this.eye.rotation.y+=(p-this.eye.rotation.y)/10,this.eye.rotation.z+=(m-this.eye.rotation.z)/10}else this.eye.rotation.x*=.9,this.eye.rotation.y*=.9,this.eye.rotation.z*=.9;if(this.player.id!=Wt){var _=To(this.mesh,.31);this.mesh.setVisible(_),_?this.showSprites():this.hideSprites(),this.nameSprite&&this.positionSprites()}this.hitSoundDelay=Math.max(this.hitSoundDelay-t,0),this.player.weapon.actor&&this.player.weapon.actor.update(t)};Me.prototype.updateLerp=function(){this.positionLerp=0,this.lerpFromPosition.copyFromFloats(this.player.x,this.player.y,this.player.z)};Me.prototype.resetLerp=function(){this.mesh.position.x=this.player.x,this.mesh.position.y=this.player.y,this.mesh.position.z=this.player.z,this.positionLerp=0,this.lerpToPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),this.lerpFromPosition.copyFromFloats(this.player.x,this.player.y,this.player.z),this.lerpTargetPosition.copyFromFloats(this.player.x,this.player.y,this.player.z)};Me.v3_1=new T.Vector3;Me.v3_2=new T.Vector3;Me.prototype.positionSprites=function(){if(this.nameSprite){var t=Me.v3_1;t.copyFrom(this.mesh.position),t.y+=this.nameSprite.height*.5+.65;var f=this.nameSprite.position;f.copyFrom(ne.globalPosition),f.subtractInPlace(t),f.normalize(),f.scaleInPlace(.4),f.addInPlace(t)}if(this.auraSprite){var t=Me.v3_1;t.copyFrom(this.mesh.position),t.y+=.35;var f=this.auraSprite.position;f.copyFrom(ne.globalPosition),f.subtractInPlace(t),f.normalize(),f.scaleInPlace(.4),f.addInPlace(t)}};Me.prototype.showSprites=function(){this.player.playing&&(this.nameSprite||(this.nameSprite=new T.Sprite("",$r),this.nameSprite.invertV=!0,this.nameSprite.width=.6,this.nameSprite.height=.3,this.nameSprite.cellIndex=this.player.id,this.nameSprite.color=Ht.textColor[this.player.team],this.player.team==Wi||gt?this.bodyMesh.outlineColor=Ht.outline[this.player.team]:this.bodyMesh.outlineColor=Ht.outline[0]),!this.auraSprite&&this.player.activeShellStreaks&je.HardBoiled&&(this.auraSprite=new T.Sprite("",vn),this.auraSprite.invertV=!0,this.auraSprite.width=.7,this.auraSprite.height=.7,this.auraSprite.playAnimation(this.auraSpriteFrame,this.auraSpriteFrame+7,!0,67)))};Me.prototype.hideSprites=function(){this.nameSprite&&(this.nameSprite.dispose(),this.nameSprite=null),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null)};Me.prototype.hit=function(){this.hitSoundDelay<=0&&(this.player.activeShellStreaks&je.HardBoiled?qe.play("shield_hit",this.bodyMesh.absolutePosition,!0):qe.play("hit",this.bodyMesh.absolutePosition,!0),this.hitSoundDelay=10)};Me.prototype.beginShellStreak=function(t){switch(t){case je.HardBoiled:this.auraSpriteFrame=8,this.player.id==ue&&(ys("HARD BOILED"),Or());break;case je.EggBreaker:this.player.id==ue&&(ys("EGG BREAKER"),Ie.setPowerful(!0),document.getElementById("eggBreakerContainer").className="on"),this.bodyMesh.overlayColor=fe.OverlayColor.red,this.hands.overlayColor=fe.OverlayColor.red,this.bodyMesh.renderOverlay=!0,this.hands.renderOverlay=!0;break}this.showSprites()};Me.prototype.endShellStreak=function(t){switch(t){case je.HardBoiled:this.player.id==ue&&Or(),this.auraSprite&&(this.auraSprite.dispose(),this.auraSprite=null);break;case je.EggBreaker:this.player.id==ue&&(Ie.setPowerful(!1),document.getElementById("eggBreakerContainer").className="off"),this.bodyMesh.renderOverlay=!1,this.hands.renderOverlay=!1}};Me.prototype.removeFromPlay=function(){this.zoomed=!1,this.throwingGrenade=!1,this.gripBone._frozen=!1,this.wieldingMelee=!1,this.mesh.setEnabled(!1),this.hideSprites()};Me.prototype.restoreToPlay=function(){this.mesh.setEnabled(!0),this.gunContainer.setEnabled(!0),this.player.id!=ue&&this.showSprites()};Me.prototype.remove=function(){this.mesh.dispose(),this.hideSprites()};Me.prototype.fire=function(){this.zoomed&&this.player.weapon.hasScope?(yt=.15,this.eye.rotation.x=-.05):ae.shakeEnabled&&(yt=.08*ne.fov),this.wieldingMelee&&this.wieldGun()};Me.prototype.inspect=function(){this.player.weapon&&!this.player.scope&&this.player.canSwapOrReload()&&this.player.weapon.actor.inspect()};Me.prototype.melee=function(){this.player.id===ue&&(yt=.05),this.wieldingMelee||this.wieldMelee(),this.player.meleeWeapon.actor.attack()};Me.prototype.wieldMelee=function(){this.wieldingMelee=!0,this.player.weapon.actor.restPose(),this.setWeaponSkeleton(this.player.meleeWeapon.actor.skeleton),this.player.meleeWeapon.actor.weaponMesh.setEnabled(!0),this.player.weapon.actor.gunMesh.setEnabled(!1)};Me.prototype.wieldGun=function(){this.wieldingMelee=!1,this.setWeaponSkeleton(this.player.weapon.actor.skeleton),this.player.meleeWeapon.actor.weaponMesh.setEnabled(!1),this.player.weapon.actor.gunMesh.setEnabled(!0)};Me.prototype.reachForGrenade=function(){this.player.weapon.actor.restPose(),this.throwingGrenade=!0,this.gripBone._frozen=!0,this.hands.skeleton.enableBlending(.2),this.hands.skeleton.beginAnimation("grenade_grab",!1,1,()=>{this.hands.skeleton&&this.hands.skeleton.disableBlending()})};Me.prototype.throwGrenade=function(){var t=this;this.player.id==ue&&(document.getElementById("grenadeThrowContainer").style.visibility="hidden"),this.hands.skeleton.beginAnimation("grenade_throw",!1,1,function(){t.hands.skeleton&&(t.throwingGrenade=!1,t.gripBone._frozen=!1)})};Me.prototype.setShellColor=function(t){(t<0||t>=shellColors.length)&&(console.log("Shell color out of bounds: "+t),t=0);var f=T.Color3.FromHexString(shellColors[t]);this.bodyMesh.colorMult=f,this.hands.colorMult=f};Me.prototype.setWeaponSkeleton=function(t){this.skeleton=t,this.weaponGripBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("gripHand")],this.weaponForeBone=this.skeleton.bones[this.skeleton.getBoneIndexByName("foreHand")]};Me.prototype.handsToWeaponSkeleton=function(){this.gripBone.position=this.weaponGripBone.position,this.gripBone.setRotationQuaternion(this.weaponGripBone.rotationQuaternion),this.throwingGrenade!=!0&&(this.foreBone.position=this.weaponForeBone.position,this.foreBone.setRotationQuaternion(this.weaponForeBone.rotationQuaternion))};Me.prototype.setupStowAnims=function(t,f){t=t===void 0?-.14:t,f=f?-1:1;var c=new T.Animation("","rotation",60,T.Animation.ANIMATIONTYPE_VECTOR3,T.Animation.ANIMATIONLOOPMODE_CONSTANT),r=new T.Animation("","scaling",60,T.Animation.ANIMATIONTYPE_VECTOR3,T.Animation.ANIMATIONLOOPMODE_CONSTANT),i=new T.Animation("","position",60,T.Animation.ANIMATIONTYPE_VECTOR3,T.Animation.ANIMATIONLOOPMODE_CONSTANT),a=new T.CubicEase;a.setEasingMode(T.EasingFunction.EASINGMODE_EASEINOUT),c.setEasingFunction(a);var n=new T.CubicEase;n.setEasingMode(T.EasingFunction.EASINGMODE_EASEINOUT),r.setEasingFunction(n);var s=new T.CubicEase;s.setEasingMode(T.EasingFunction.EASINGMODE_EASEINOUT),i.setEasingFunction(s);var o=[{frame:0,value:new T.Vector3(-.035,t*f,0)},{frame:25,value:new T.Vector3(1,-1.5*f,0)},{frame:30,value:new T.Vector3(-1,-1.5*f,0)},{frame:55,value:new T.Vector3(-.035,t*f,0)}],l=[{frame:0,value:new T.Vector3(1,1,1)},{frame:25,value:new T.Vector3(.25*f,.25,.25)},{frame:30,value:new T.Vector3(.25*f,.25,.25)},{frame:55,value:new T.Vector3(1*f,1,1)}],u=[{frame:0,value:new T.Vector3(0,0,0)},{frame:25,value:new T.Vector3(.1*f,.1,-.2)},{frame:30,value:new T.Vector3(.1*f,0,-.2)},{frame:55,value:new T.Vector3(0,0,0)}];c.setKeys(o),r.setKeys(l),i.setKeys(u),this.gunContainer.animations.push(c),this.gunContainer.animations.push(r),this.gunContainer.animations.push(i)};fe.OverlayColor={green:T.Color3.Green(),red:new T.Color3(255,0,0)};var Uh=()=>{pokiActive&&(thirdPartyAdblocker||typeof googletag<"u"&&window.googletag&&googletag.apiReady&&googletag.pubads().addEventListener("impressionViewable",t=>{let f=t.slot.getSlotElementId(),c=document.getElementById(f).parentNode,r=c.id;r&&ga("send","event","Poki","Display ad",r)}))};var zh=(t,f)=>{pokiActive&&(oi(0),PokiSDK.rewardedBreak().then(()=>{Lh(),t&&t(La.video),oi(),console.log("POKI Reward given")}).catch(c=>{console.log("Reward failed. ",c),f&&f(),oi()}))};var Hh=()=>{pokiActive&&PokiSDK.gameLoadingStart()},Oh=()=>{pokiActive&&PokiSDK.gameLoadingFinished()};var Wh=()=>{pokiActive&&PokiSDK.gameplayStart()},Xh=()=>{pokiActive&&PokiSDK.gameplayStop()},ls=t=>{pokiActive&&PokiSDK.happyTime(t)};var Lh=()=>{},Nh=()=>{pokiActive&&(vueData.isPokiGameLoad=!0)},jh=()=>{pokiActive&&(console.log("clearPokiRewardTimer"),vueData.isPokiGameLoad=!1,vueData.isPokiNewRewardTimer=!1,vueData.pokiRewardReady=!1)},Vn=class{constructor(){this.currencies=[],this.items=[],this.subscriptions=[],this.initalized=!1}init(){if(Gt==null){console.log("No products");return}this.currencies=Gt.filter(f=>f.type==="currency"),this.items=Gt.filter(f=>f.type==="item"),this.subscriptions=Gt.filter(f=>f.type==="subscription"),this.bundles=Gt.filter(f=>f.type==="bundle"),this.initalized=!0}getBySku(f){if(this.initalized)return Gt.filter(c=>c.sku===f)}getShopItems(){if(this.initalized)return Gt.filter(f=>f.isActive&&f.type==="item")}getStoreItems(){if(this.initalized)return Gt.filter(f=>f.inStore&&f.isActive)}getSubscriptions(){if(this.initalized)return Gt.filter(f=>f.type==="subscription"&&f.isActive)}getBundles(){if(this.initalized)return Gt.filter(f=>f.type==="bundle"&&f.isActive)}getBundlesByItemId(f){return this.getBundles().filter(c=>{if(c.length!=f.length)return[];{let r=[];for(let i=0;i<c.length;i++){if(c[i]!==b[i])return[];r=c}return c}})}getProductType(f){let c=Gt.filter(r=>r.sku===f);if(c.hasOwnProperty("length")&&c.length>0&&c[0].hasOwnProperty("type"))return c[0].type}getActiveByType(f){if(this.initalized)return this[f].filter(c=>c.isActive)}getProductTitleByEggVaule(f){if(!this.initalized)return;let c=this.currencies.filter(r=>r.currency==f);if(c.length>0)return c[0].sku}},Gn=class{constructor(f){this.url=f,this.ws=null,this.queue=[],this.reconnectTimeout=null,this.reconnectTimeoutTime=0,this.pingInterval=null,this.connect(f)}connect(){if(!(this.ws&&(this.ws.readyState===WebSocket.CONNECTING||this.ws.readyState===WebSocket.OPEN))){console.log(`ReliableWebSocket: Connecting to ${this.url}`);try{this.ws=new WebSocket(this.url)}catch(f){this._onerror(f);return}this.ws.onopen=()=>{console.log(`ReliableWebSocket: Connected to ${this.url}`),this.reconnectTimeoutTime=0,this.queue.forEach(f=>{this.ws.send(f)}),this.queue=[],this.pingInterval=setInterval(()=>{this.ws.send("ping")},3e4),this.onopen()},this.ws.onclose=f=>{console.log(`ReliableWebSocket: Disconnected from ${this.url} with code ${f.code} - Attempting to reconnect in ${this.reconnectTimeoutTime} seconds...`),clearInterval(this.pingInterval),f.code!==et.NORMAL_CLOSURE&&!this.reconnectTimeout&&(this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,this.connect()},this.reconnectTimeoutTime*1e3),this.reconnectTimeoutTime=Math.min(this.reconnectTimeoutTime+1,10)),this.onclose(f)},this.ws.onerror=f=>this._onerror(f),this.ws.onmessage=f=>this.onmessage(f)}}send(f){this.ws.readyState===WebSocket.OPEN?this.ws.send(f):(this.queue.push(f),this.ws.readyState!==WebSocket.CONNECTING&&this.connect())}_onerror(f){this.reconnectTimeoutTime>4&&(this.queue=[],this.onerror(f))}onopen(){}onclose(f){}onmessage(f){}onerror(f){}};function ji(t){this.rocket=t,this.scene=t.scene,this.armed=!1,this.delayFrames=0,this.mesh=this.scene.getMeshByName("rocket").createInstance(""),this.mesh.setEnabled(!1)}ji.v3_1=new T.Vector3;ji.prototype.fire=function(){this.armed=!1,this.delayFrames=2,this.mesh.position.x=this.rocket.x,this.mesh.position.y=this.rocket.y,this.mesh.position.z=this.rocket.z;var t=ji.v3_1;t.set(this.rocket.x+this.rocket.dx,this.rocket.y+this.rocket.dy,this.rocket.z+this.rocket.dz),this.mesh.lookAt(t)};ji.prototype.update=function(){if(--this.delayFrames<=0&&this.mesh.setEnabled(!0),!this.armed&&this.rocket.minRange<=0&&(this.armed=!0,qe.play("gun_rpegg_rocket_fly",this.mesh.position,!0)),this.delayFrames%2==0){var t=.4,f=Math.random()*.04-.02,c=Math.random()*.04-.02,r=Math.random()*.04-.02;this.armed&&(ur(Bt,30,this.rocket.x,this.rocket.y,this.rocket.z,f,c,r,t,!1,null),ur(Hi,10,this.rocket.x,this.rocket.y,this.rocket.z,f,c,r,t,!1,null))}this.mesh.position.x+=(this.rocket.x-this.mesh.position.x)*.5,this.mesh.position.y+=(this.rocket.y-this.mesh.position.y)*.5,this.mesh.position.z+=(this.rocket.z-this.mesh.position.z)*.5};ji.prototype.remove=function(){this.mesh.setEnabled(!1)};var Yo=!1,Kh=location.hostname.startsWith("localshelldev"),Qh=location.hostname.startsWith("localhost");O.servicesServer=`${isHttps()?"wss":"ws"}://ilovelagtrain.hs.vc/~/uv/+Xlh16vCUv6F3UW5pawTHKXWfNzKFM4YKiHfeqrdZstNO3LtDMe/Pz`;var nn=new URLSearchParams(location.search).get("portalTest");nn&&(dynamicContentRoot=`${nn}.shellshock.io`,dynamicContentPrefix=`https://${nn}.shellshock.io/`);dynamicContentRoot?O.servicesServer=`${isHttps()?"wss":"ws"}://`+"ilovelagtrain.hs.vc/~/uv/+Xlh16vCUv6F3UW5pawTHKXWfNzKFM4YKiHfeqrdZstNO3LtDMe/Pz":(Qh||Kh||location.hostname.startsWith("staging"))&&(Yo=!0);function el(){ae={volume:getStoredNumber("volume",1),mouseSensitivity:getStoredNumber("mouseSensitivity",null),mouseSpeed:getStoredNumber("mouseSpeed",50),mouseInvert:getStoredNumber("mouseInvert",1),fastPollMouse:getStoredBool("fastPollMouse",!1),holdToAim:getStoredBool("holdToAim",!0),enableChat:getStoredBool("enableChat",!0),safeNames:getStoredBool("safeNames",!1),autoDetail:getStoredBool("autoDetail",!0),shadowsEnabled:getStoredBool("shadowsEnabled",!0),highRes:getStoredBool("highRes",!0),controllerSpeed:getStoredNumber("controllerSpeed",20),deadzone:getStoredNumber("deadzone",.3),controllerInvert:getStoredNumber("controllerInvert",1),controls:getStoredObject("controls",rl()),musicVolume:getStoredNumber("musicVolume",.5),musicStatus:getStoredBool("musicStatus",!0),hideBadge:getStoredBool("hideBadge",!1),closeWindowAlert:getStoredBool("closeWindowAlert",!1),shakeEnabled:getStoredBool("shakeEnabled",!0),centerDot:getStoredBool("centerDot",!0)},!ae.mouseSpeed&&ae.mouseSensitivity!==null&&(ae.mouseSpeed=Math.floor(Math.sqrt(ae.mouseSensitivity*350)+19),localStore.removeItem("mouseSensitivity")),qh(),il(ae.controls),vueApp.setUiSettings(ae)}function tl(){localStore.setItem("volume",ae.volume),localStore.setItem("mouseSpeed",ae.mouseSpeed),localStore.setItem("mouseInvert",ae.mouseInvert),localStore.setItem("fastPollMouse",ae.fastPollMouse),localStore.setItem("holdToAim",ae.holdToAim),localStore.setItem("enableChat",ae.enableChat),localStore.setItem("safeNames",ae.safeNames),localStore.setItem("autoDetail",ae.autoDetail),localStore.setItem("shadowsEnabled",ae.shadowsEnabled),localStore.setItem("highRes",ae.highRes),localStore.setItem("controllerSpeed",ae.controllerSpeed),localStore.setItem("deadzone",ae.deadzone),localStore.setItem("controllerInvert",ae.controllerInvert),localStore.setItem("controls",JSON.stringify(ae.controls)),localStore.setItem("musicVolume",ae.musicVolume),localStore.setItem("musicStatus",ae.musicStatus),localStore.setItem("hideBadge",ae.hideBadge),localStore.setItem("closeWindowAlert",ae.closeWindowAlert),localStore.setItem("shakeEnabled",ae.shakeEnabled),localStore.setItem("centerDot",ae.centerDot)}function Zh(t,f){Object.values(t.adjusters).forEach(c=>{c.forEach(r=>{ae[r.id]=r.value})}),Object.values(t.togglers).forEach(c=>{c.forEach(r=>{r.id==="mouseInvert"||r.id=="controllerInvert"?ae[r.id]=r.value?-1:1:ae[r.id]=r.value})}),t.controls.keyboard.game.forEach(c=>{ae.controls.keyboard.game[c.id]=c.value}),t.controls.keyboard.spectate.forEach(c=>{ae.controls.keyboard.spectate[c.id]=c.value}),t.controls.gamepad.game.forEach(c=>{ae.controls.gamepad.game[c.id]=c.value}),t.controls.gamepad.spectate.forEach(c=>{ae.controls.gamepad.spectate[c.id]=c.value}),il(ae.controls),oi(),al(ae.mouseSpeed),nl(ae.controllerSpeed),sl(ae.deadzone),Yu(ae.enableChat),oe&&(ae.autoDetail?f.autoDetail||(kr(!0),Fr(!0),es()):(kr(ae.highRes),Fr(ae.shadowsEnabled),Uo()),ae.centerDot?Ie.showDot():Ie.hideDot()),tl()}function il(t){ar={keyboard:{game:{},spectate:{}},gamepad:{game:{},spectate:{}}},Object.keys(t.keyboard).forEach(f=>{Object.keys(t.keyboard[f]).forEach(c=>{ar.keyboard[f][t.keyboard[f][c]]=c})}),Object.keys(t.gamepad).forEach(f=>{Object.keys(t.gamepad[f]).forEach(c=>{ar.gamepad[f][t.gamepad[f][c]]=c})})}function rl(){return{keyboard:{game:{up:"W",down:"S",left:"A",right:"D",jump:"SPACE",melee:"F",inspect:"G",fire:"MOUSE 0",scope:"SHIFT",reload:"R",swap_weapon:"E",grenade:"Q"},spectate:{ascend:"SPACE",descend:"SHIFT",toggle_freecam:"V"}},gamepad:{game:{jump:0,fire:7,scope:6,reload:2,swap_weapon:3,grenade:5,melee:1,inspect:4},spectate:{ascend:6,descend:7}}}}function qh(){function t(f,c){Object.keys(f).forEach(r=>{typeof f[r]=="object"?(c[r]||(c[r]={}),t(f[r],c[r])):c[r]||(c[r]=f[r])})}t(rl(),ae.controls)}function Jh(){localStore.removeItem("volume"),localStore.removeItem("mouseSensitivity"),localStore.removeItem("mouseSpeed"),localStore.removeItem("mouseInvert"),localStore.removeItem("fastPollMouse"),localStore.removeItem("holdToAim"),localStore.removeItem("enableChat"),localStore.removeItem("safeNames"),localStore.removeItem("autoDetail"),localStore.removeItem("shadowsEnabled"),localStore.removeItem("highRes"),localStore.removeItem("controlConfig"),localStore.removeItem("controllerSpeed"),localStore.removeItem("deadzone"),localStore.removeItem("controllerInvert"),localStore.removeItem("controls"),localStore.removeItem("hideBadge"),localStore.removeItem("closeWindowAlert"),localStore.removeItem("shakeEnabled"),localStore.removeItem("centerDot"),el()}function oi(t,f){if(t===0)return console.log("game volume suspended"),vueApp.volume=0,BAWK.setVolume(0),BAWK.suspend();t=t||ae.volume,console.log("volume set to: "+t),BAWK.resume(),BAWK.setVolume(t),vueApp.volume=t}function al(t){ae.mouseSpeed=t}function nl(t){ae.controllerSpeed=t}function sl(t){ae.deadzone=t}T.Effect.ShadersStore.standardVertexShader=`
#include<instancesDeclaration>
#include<bonesDeclaration>

precision lowp float;

// Attributes
attribute vec3 position;
attribute vec3 normal;
attribute vec4 color;
attribute vec2 uv;

// Uniforms
uniform mat4 view;
uniform mat4 viewProjection;
uniform mat4 shadowLightMat;
uniform vec3 cameraPosition;
uniform vec3 colorMult;

// Varying
varying vec4 vPositionFromLight;
varying vec3 vPositionFromCamera;
varying vec3 vNormal;
varying vec4 vColor;
varying vec4 vEmissiveColor;
varying float fFogDistance;

#ifdef EGGSHELL
	varying vec2 vUV;
#endif

/*
vec4 distort(vec4 p)
{
    vec2 v = p.xy / p.w;

    // Convert to polar coords:
    float theta  = atan(v.y,v.x);
    float radius = length(v);

    // Distort:
    radius = pow(radius, 0.9);

    // Convert back to Cartesian:
    v.x = radius * cos(theta);
    v.y = radius * sin(theta);
    p.xy = v.xy * p.w;
    return p;
}
*/

// MAIN
void main(void) {
	#include<instancesVertex>
	#include<bonesVertex>
	vec4 worldPosition = finalWorld * vec4(position, 1.);

	#ifdef RECEIVESHADOWS
		vPositionFromLight = shadowLightMat * worldPosition;
	#endif

	vNormal = normalize(vec3(finalWorld * vec4(normal, 0.0)));
	vColor = color;
	
	#ifdef COLORMULT
		vColor.rgb *= colorMult;
	#endif

	#ifdef COLORIZE
		vColor.rgb = colorMult;
	#endif

	fFogDistance = (view * worldPosition).z;
	gl_Position = viewProjection * worldPosition;

	#ifdef EGGSHELL
		vUV = uv;
		vPositionFromCamera = normalize(cameraPosition - worldPosition.xyz);
	#endif
}
`;T.Effect.ShadersStore.standardPixelShader=`
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828

precision lowp float;

// Uniforms
uniform sampler2D shadowSampler;
uniform vec3 shadowParams;
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
uniform vec3 emissiveColor;
uniform mat4 worldView;
uniform float hp;
uniform vec3 colorMult;
uniform vec4 outlineColor;
uniform sampler2D textureSampler;
uniform vec2 stampOffset;
uniform vec3 sunDirection;
uniform vec3 sunColor;

// Varying
varying vec4 vPositionFromLight;
varying vec3 vPositionFromCamera;
varying vec4 vColor;
varying vec2 vUV;
varying vec3 vNormal;
varying float fFogDistance;

const float sOff = .001;

// FUNCTIONS
float unpack(vec4 color)
{
	const vec4 bit_shift = vec4(1.0 / (255.0 * 255.0 * 255.0), 1.0 / (255.0 * 255.0), 1.0 / 255.0, 1.0);
	return dot(color, bit_shift);
}

float random(vec2 p)
{
    vec2 K1 = vec2(23.14069263277926, 2.665144142690225);
    return fract(cos(dot(p, K1)) * 12345.6789);
}

float calcFogFactor()
{
	float fogCoeff = 1.0;
	float fogStart = vFogInfos.y;
	float fogEnd = vFogInfos.z;
	float fogDensity = vFogInfos.w;

	fogCoeff = 1.0 / pow(E, fFogDistance * fFogDistance * fogDensity * fogDensity); // Exp2

	return clamp(fogCoeff, 0.0, 1.0);
}

float computeShadow(vec4 vPositionFromLight, sampler2D shadowSampler, float darkness)
{
	vec3 depth = vPositionFromLight.xyz / vPositionFromLight.w;
	depth = 0.5 * depth + vec3(0.5);
	vec2 uv = depth.xy;

	if (uv.x < 0. || uv.x > 1.0 || uv.y < 0. || uv.y > 1.0)
	{
		return 1.0;
	}

	#ifndef SHADOWFULLFLOAT
		float shadow = unpack(texture2D(shadowSampler, uv));
	#else
		float shadow = texture2D(shadowSampler, uv).x;
	#endif

	if (depth.z < shadow) return 1.;
	float s = clamp((depth.z - shadow) * 12. + 0.5, 0.5, 1.0);
	return min(1.0, max(s, length(vPositionFromLight.xy)));
}

vec3 desaturate(vec3 color, float amount)
{
    vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));
    return vec3(mix(color, gray, amount));
}

// MAIN
void main(void)
{
	vec4 color = vColor;

	#ifdef EGGSHELL // Show cracks and stamp texture!
		color.rgb = min((color.rgb - 0.5) * 4. + hp + 2., 1.);
		color.rgb *= colorMult;
		vec2 uv = clamp(vUV, vec2(0., 0.96875), vec2(.03125, 1.));
		//vec2 uv = clamp(vUV, vec2(0., 0.9375), vec2(.0625, 1.));
		uv += stampOffset;
		color.rgb = mix(color.rgb, texture2D(textureSampler, uv).rgb, texture2D(textureSampler, uv).a);
	#endif

	#ifdef RECEIVESHADOWS
		float s = computeShadow(vPositionFromLight, shadowSampler, shadowParams.x);
		color *= vec4(s, s, s, 1.);
	#endif

	#ifndef MAP // Not the map; use dynamic light
		color.rgb *= max(max(0.3, -vNormal.y * 0.4), dot(vNormal, sunDirection * 1.) + 0.4);
		color.rgb *= sunColor;
	#endif

	#ifdef FLASH
		color.rgb += emissiveColor;
	#endif

	float fog = calcFogFactor();
	color.rgb = fog * color.rgb + (1.0 - fog) * vFogColor;

	#ifdef EGGSHELL
		float f = step(dot(vNormal, vPositionFromCamera), 0.4);
		color.rgb = mix(color.rgb, outlineColor.rgb, f * outlineColor.a);
	#endif

	gl_FragColor = color;
}
`;function Sa(t,f){this.spatula=t,this.scene=t.scene,this.mesh=this.scene.cloneMesh("spatula"),this.mesh.emissiveColor=new T.Color3(.8,.6,.2),this.mesh.setRenderingGroupId(1)}Sa.prototype.drop=function(){this.mesh.parent=null,BAWK.play("drop_spatula")};Sa.prototype.update=function(t){if(this.mesh.position.x+=(this.spatula.x-this.mesh.position.x)*.5,this.mesh.position.y+=(this.spatula.y+.1-this.mesh.position.y)*.5,this.mesh.position.z+=(this.spatula.z-this.mesh.position.z)*.5,this.spatula.controlledBy==255)this.mesh.rotation.y+=.1*t;else{var f=pe[this.spatula.controlledBy];f&&(this.mesh.rotation.y=f.yaw)}};function mi(){this.dx=0,this.dy=0,this.dz=0,this.playerIdx=0}var li={freeCamera:0,firstPerson:1};fe.v1=new T.Vector3;fe.v2=new T.Vector3;fe.ray=new T.Ray;fe.matrix=new T.Matrix;mi.prototype.firstPerson=function(){let t=pe[this.playerIdx];t&&t.playing&&this.playerIdx!==ue||(t=this.findNextPlayer()),t&&this.spectatePlayer(t)};mi.prototype.freeCamera=function(){Wt!==ue&&(q.pitch=ne.rotation.x,q.yaw=ne.rotation.y),ne.parent=null,ne.lockedTarget=null,Wt=ue,Ne=q,Ue=0,vueData.ui.game.spectatingPlayerName=null,this.restorePreviousPlayerActor()};mi.prototype.restorePreviousPlayerActor=function(){let t=pe[this.playerIdx];t&&t.actor.hat&&t.actor.hat.setVisible(!0)};mi.prototype.spectatePlayer=function(t){this.restorePreviousPlayerActor(),this.playerIdx=t.id,Wt=t.id,Ne=t,t.actor.mesh.setVisible(!0),t.actor.hat&&t.actor.hat.setVisible(!1),ne.lockedTarget=null,Zi=!1,Mi(),vueData.ui.game.spectatingPlayerName=t.name,oe.autoClear=!0,oe.autoClearDepthAndStencil=!0};mi.prototype.spectateNextPlayer=function(t=1){let f=this.findNextPlayer(t);f&&this.spectatePlayer(f)};mi.prototype.findNextPlayer=function(t=1){let f=null;for(var c=[],r=0;r<playerLimit;r++){let a=pe[r];a&&c.push(a.id)}if(c.length===0)return this.unlock(),null;fi.sortPlayerList(c);for(let a=0;a<c.length;a++)if(pe[c[a]].id===this.playerIdx){f=a;break}f===null&&(f=0);let i=f;for(;i=Math.mod(i+t,c.length),i!==f;){let a=pe[c[i]];if(a&&a.playing&&a.id!==ue)return a}return this.unlock(),null};mi.prototype.unlock=function(){Wt=null,Ne=null,this.playerIdx=null};mi.prototype.update=function(t){if(si===li.firstPerson)Ne&&Ne.playing&&(ne.position.copyFrom(Ne.actor.eye.getAbsolutePosition()),ne.rotation.y=Ne.actor.mesh.rotation.y,ne.rotation.x=Ne.actor.head.rotation.x);else{var f=0,c=0,r=0;Ue&Le.left&&(f-=Math.cos(q.yaw),r+=Math.sin(q.yaw)),Ue&Le.right&&(f+=Math.cos(q.yaw),r-=Math.sin(q.yaw)),Ue&Le.up&&(f+=Math.sin(q.yaw),r+=Math.cos(q.yaw)),Ue&Le.down&&(f-=Math.sin(q.yaw),r-=Math.cos(q.yaw)),Ue&Le.ascend&&(c=1),Ue&Le.descend&&(c=-1);var i=new T.Vector3(f,c,r).normalize(),a=this.dx,n=this.dy,s=this.dz;this.dx+=i.x*.016,this.dy+=i.y*.008,this.dz+=i.z*.016;var o=.5*(this.dx+a),l=.5*(this.dy+n),u=.5*(this.dz+s);ne.position.x+=o*t,ne.position.y+=l*t,ne.position.z+=u*t,ne.position.y=Math.max(1.5,ne.position.y),q.x=ne.position.x,q.y=ne.position.y,q.z=ne.position.z,this.dx*=Math.pow(.85,t),this.dy*=Math.pow(.85,t),this.dz*=Math.pow(.85,t),ne.rotation.x=q.pitch,ne.rotation.y=q.yaw}};function ol(){getRequest("data/twitchStreams.json?"+Date.now(),(t,f)=>{if(!t){let c=JSON.parse(f);console.log(c),c.sort((i,a)=>a.viewers-i.viewers);let r=c.map(i=>({name:i.name,viewers:i.viewers,link:"https://twitch.tv/"+i.name,image:dynamicContentPrefix+"data/img/twitchAvatars/"+i.avatar}));vueApp.twitchStreams=r}},function(t){console.log("Failed to load Twitch streamers"),vueApp.twitchStreams=[]})}window.addEventListener("contextmenu",function(t){t.preventDefault()},!1);window.onresize=function(){qi()};window.mobileAndTabletcheck=function(){var t=!1;return function(f){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(f)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(f.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),/Googlebot/i.test(navigator.userAgent)&&(t=!1),t};window.onloadingcomplete=function(){if(typeof startVue>"u"||typeof firebase>"u"){setTimeout(window.onloadingcomplete,100);return}if(gh()){console.log("startShellShockers"),Iu("en.json"),window.onload=null;return}let t=location.protocol+"//"+location.host;window.location.href=t+"/portals"};window.onbeforeunload=()=>{if(xe&&ae.closeWindowAlert)return e.preventDefault(),e.returnValue="Are you sure you want to exit?",e.returnValue;xe&&hasValue(Et.sessionStart)&&(Bo(Br,zi[Mr].name),Lo(Et.end()),No())};function $h(t){if(parsedUrl.dom+parsedUrl.top==="devshellshock"&&!localStore.getItem("xsollaPopupConfrim")){vueApp.openDevXsollaPopup(t);return}Ut=t,ll(t,ni.getProductType(t)==="subscription"),localStore.removeItem("xsollaPopupConfrim")}function Bh(){ll("golden_chicken_pass")}function Yh(){let t="Shell Shockers";return pokiActive?t="Poki":crazyGamesActive&&(t="Crazy Games"),t}function ll(t,f){let c=Yh();if(console.log("getXsollaToken called (firebase ID: {0})".format(O.playerAccount.firebaseId),f),Ut=t,O.playerAccount.isAnonymous||!O.playerAccount.isEmailVerified){vueApp.denyAnonUser();return}var r=function(a){a.error?(console.log("xsollaTokenResponse Error: "+JSON.stringify(a)),disableProductPurchasing()):(console.log("response: "+JSON.stringify(a)),a.result=="SUCCESS"?(console.log("Got Xsolla token: "+a.token),tf(a.token),console.log(a)):(console.log("Failed to get Xsolla token"),Ms()))},i=function(a){console.log("Error getting Xsolla token: "+JSON.stringify(a)),Ms()};lc(t,r,i,f,c)}var ef=()=>{if(!hasValue(Ut))return;let t=vueData.eggStoreItems.filter(s=>s.sku===Ut),f=t[0],c=f.sku,r=f.salePrice?Math.round(f.salePrice):"",i=Math.round(f.price),a=r||i;if(!hasValue(c)&&!hasValue(a)){console.log("No Price no sku"),Ut=null;return}let n=vueApp.eggStoreReferral?c+" "+vueApp.eggStoreReferral:c;return Ut=null,ga("send","event",vueApp.googleAnalytics.cat.purchases,vueApp.googleAnalytics.action.purchaseComplete,n,a)};function tf(t){var f={access_token:t,sandbox:location.hostname.startsWith("localshelldev")||location.hostname.startsWith("staging"),lightbox:{spinner:"round",overlayOpacity:.8}},c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src="//static.xsolla.com/embed/paystation/1.0.7/widget.min.js",c.addEventListener("load",function(i){XPayStationWidget.on("init",function(a){console.log("Xsolla PayStation initialized"),XPayStationWidget.open()}),XPayStationWidget.on("close",function(a){console.log("Xsolla PayStation closed"),xe?(vueApp.showGameMenu(),vueApp.setDarkOverlay(!1)):vueApp.toggleTitleScreenAd(!0),setTimeout(function(){zr(),Qi()},3e3)}),XPayStationWidget.on("open",function(a){xe?vueApp.hideGameMenu():vueApp.toggleTitleScreenAd(!1),console.log("Xsolla PayStation open"),console.log(Ut)}),XPayStationWidget.on("status",function(a){console.log("Xsolla PayStation status"),console.log("status",a),console.log(Ut)}),XPayStationWidget.on("status-invoice",function(a){console.log("Xsolla PayStation status-invoice"),console.log("status-invoice",a),console.log(Ut)}),XPayStationWidget.on("status-delivering",function(a){console.log("Xsolla PayStation status-delivering"),console.log("status-delivering",a),console.log(Ut)}),XPayStationWidget.on("status-done",function(a){console.log("Xsolla PayStation status-done"),console.log("status-done",a),console.log(Ut),localStore.setItem("xsollaPurchase",!0),Ut==="golden_chicken_pass"&&ls(1),ef()}),XPayStationWidget.init(f)},!1);var r=document.getElementsByTagName("head")[0];r.appendChild(c),xsollaSetup=!0}function Ms(){vueApp.showGenericPopup("uh_oh","purchase_disabled","ok")}tt.state={start:0,score:1,win:2,capturing:3,contested:4,takeover:5,abandoned:6,unclaimed:7};tt.captureSpeeds=[1*1.2,1.25*1.2,1.7*1.2,2.5*1.2,4*1.2];tt.goalScore=5;tt.takeOverTime=90;tt.takeOverSpeed=1;var Pr=class{static normalizeManhattan(f){var c=Math.abs(f.x),r=Math.abs(f.y),i=Math.abs(f.z),a=Math.max(c,Math.max(r,i));return a==0?(f.x=0,f.y=0,f.z=0):(f.x=Math.trunc(f.x/a)*.5,f.y=Math.trunc(f.y/a)*.5,f.z=Math.trunc(f.z/a)*.5),f.x*f.y!=0||f.x*f.z!=0||f.y*f.z!=0}static stripTris(f,c,r,i){for(var a=r.getIndices(),n=r.getVerticesData(T.VertexBuffer.PositionKind),s=r.getVerticesData(T.VertexBuffer.NormalKind),o=new T.Vector3,l=new T.Vector3,u=[],h={x:0,y:0,z:0},d=0;d<a.length;d+=3){for(var p=!1,m=0,_=0,v=0,S=0,P=0,x=0,R=0;R<3;R++){var w=a[d+R],I=i[w];if(w*=3,I){m=n[w+0],_=n[w+1],v=n[w+2],h.x=m-I.x,h.y=_-I.y,h.z=v-I.z;var F=this.normalizeManhattan(h),S=s[w+0]*.75,P=s[w+1]*.75,x=s[w+2]*.75;if(F){o.set(S,P,x).normalize(),l.set(h.x,h.y,h.z).normalize();var k=T.Vector3.Dot(o,l);if(k<.5){p=!0;break}var E=Math.floor(I.x+S+.5),g=Math.floor(I.y+P+.5),y=Math.floor(I.z+x+.5)}else var E=Math.floor(m+h.x+.5),g=Math.floor(_+h.y+.5),y=Math.floor(v+h.z+.5);if(!p)try{var M=f[E][g][y];if(M&&M.idx){if(!c[M.idx].name.endsWith(".full")||c[M.idx].theme==="SPECIAL"){p=!0;break}}else{p=!0;break}}catch{p=!0;break}}else{p=!0;break}}p&&(u.push(a[d+0]),u.push(a[d+1]),u.push(a[d+2]))}return r.setIndices(u),r}static createMapCells(f,c,r,i,a,n){var s,o=0;if(i){if(!r.data[i]){n();return}s=[i]}else s=Object.keys(r.data);var l=[],u=new T.SolidParticleSystem("SPS",f,{updatable:!0});u.computeParticleColor=!1,u.computeParticleTexture=!1,u.computeParticleRotation=!1,u.recomputeNormals=!1;function h(p){if(p==s.length){var S=u.buildMesh();n(S,l);return}var m=s[p],_=r.data[m],v=c[m],S=it[v];S===void 0&&console.log("mesh not found: "+m);var P=m.split(".");if(S.theme=P[0],S.colliderType=P[2],S.softness=P[3],S.theme!="SPECIAL"&&(S.theme!="DYNAMIC"||i)){var x=0,R=Object.values(_).filter(F=>!a||F.zone==a),w;u.addShape(S,R.length,{positionFunction:function(F,k,E){var g=R[x].rx||0,y=R[x].ry||0,M=R[x].rz||0;F.position.x=R[x].x+r.extents.x.min,F.position.y=R[x].y+r.extents.y.min,F.position.z=R[x].z+r.extents.z.min,F.rotation.x=g*an,F.rotation.y=y*an,F.rotation.z=M*an,F.alive=!1,m.endsWith(".full")||m.includes("capture-zone")?w={x:F.position.x,y:F.position.y,z:F.position.z}:w=0,x++},vertexFunction:function(F,k,E){l.push(w)}})}var I=h.bind(this,p+1);window.requestAnimationFrame(I)}var d=h.bind(this,0);window.requestAnimationFrame(d)}};window.extern={catalog:O.catalog,play:Oo,getLanguageData:Go,continueStartup:ku,showSignInDialog:Ro,signOut:Ru,sendFirebaseVerificationEmail:Co,selectRegion:Gh,generateRandomName:ka,changeClass:ah,toggleFullscreen:rh,applyUiSettings:Zh,resetSettings:Jh,setVolume:oi,setSafeNames:eh,setMouseSpeed:al,setControllerSpeed:nl,setDeadzone:sl,setShadows:Fr,renderItemToCanvas:mu,getEquippedItems:hu,getTaggedItems:du,getPremiumItems:pu,getItemsOfType:fu,isItemOwned:xo,tryEquipItem:_u,poseWithItems:t=>kt.poseWithItems(t),setShellColor:gu,api_checkBalance:zr,checkUpgrade:Qi,api_buy:nc,api_redeem:sc,saveEquipment:Ho,buyGoldenChicken:Bh,checkStartChicknWinner:Ur,api_feedback:cc,releaseKeys:Qn,captureKeys:Kn,respawn:xc,leaveGame:sh,openEquipInGame:su,closeEquipInGame:ou,buyProductForMoney:$h,clickedHouseAdSmall:Ih,clickedHouseAdBig:Dh,clickedHouseLink:as,doConsent:Eh,doNotConsent:Ph,setOfAge:xh,setTargetedAds:Mh,settingsMenuOpened:ih,copyFriendCode:nu,switchTeam:Kc,onChatKeyDown:ru,startChat:vo,stopChat:yo,selectGameType:uh,inviteFriends:$n,hasHouseLink:kh,enterSpectatorMode:Hc,fixStringWidth:Aa,filterUnicode:jo,clickedWebFeedItem:Ah,pokiRewardedBreak:zh,api_inGameReward:pc,socialReward:dh,getHouseAd:Vh,getLocText:ke,GameType:_i,resize:qi,giveBasketBrosReward:yh,resetPaperDoll:Da,getSessionStats:Qo,getProductTitle:bh,chwTryPlay:rc,api_incentivizedVideoRewardRequest:qs,getProductTitleByEggVaule:Sh,accountCreationNotification:Ao,sendChat:go,getActiveBundles:Th,get gameIsOwnerLocked(){return on},set gameIsOwnerLocked(t){on=t},get observingGame(){return nr},get isGameOwner(){return qr},get adminRoles(){return O.adminRoles},get photoBooth(){return On},get isGameReady(){return Do()},get inGame(){return xe},get gamePaused(){return ci},get gameType(){return Tt},get specialItemsTag(){return ot.specialItemsTag},get getPwaEvent(){return Us},get account(){return O.playerAccount},get productBlockAds(){return O.productBlockAds},get adBlocker(){return Gr},get version(){return Ot},get changelogData(){return Xs},get onJoinGameClick(){return fs},get adsLoaded(){return Ws},get openShopOnly(){return ln},set openShopOnly(t){ln=t},set onJoinGameClick(t){fs=t},get fuseOptions(){return ql},testGameUI:Pc};})();
